import{_ as Yt,a as R,b as C,c as te,d as Tt,e as It,f as ut,g as is,h as as}from"./tslib.fbc0a98a.js";import{d as WC}from"./detect-browser.d7c72d32.js";import{f as qT,m as wl,a as jf,b as KT,c as QT,e as JT,n as kr,d as Mn,g as Ae,h as Te,s as vr,i as Ge,j as Xa,k as Zt,t as os,l as tM,o as ji,p as Da,q as eM,r as Ft,u as sn,v as Ya,w as jC,x as fr,y as rM,z as nM,A as Xi,B as XC,C as iM,D as _e,E as aM,F as oM,G as Ll,H as mv,I as Fl,J as kl,K as xv,L as qs,M as Pc,N as Md,O as sM,P as zo,Q as uM,R as lM,S as cM,T as fM,U as wd,V as Ks}from"./gl-matrix.c2437e13.js";import{d as hM}from"./d3-ease.bfc908e9.js";import{i as Ld,a as vM,r as pM}from"./d3-interpolate.665e47cb.js";import{t as dM}from"./d3-timer.6741c69d.js";import{f as gM,a as yM}from"./fecha.ef6414c7.js";import{b as mM}from"./size-sensor.7cca16de.js";import{e as xM,l as _M,a as CM,b as EM,p as SM,c as bM,q as AM}from"./d3-regression.4466db0e.js";import{p as TM}from"./pdfast.2fc51c02.js";import{n as YC,a as Fd,z as MM,c as wM,s as LM,b as FM,d as kd}from"./fmin.8492c6cb.js";import{p as kM,h as _v,d as Od,i as OM,a as RM}from"./d3-hierarchy.4fd7c209.js";import{_ as H,a as $,b as tt,c as B,d as et,e as I,f as ZC,g as kt,h as U,i as IM,j as Mt,r as st,k as it,l as S,m as Ct,n as St,o as un,p as Ol,q as nl}from"./@babel.be5ddd47.js";import{e as dn,E as Cv}from"./eventemitter3.3d9765e0.js";import{l as Y}from"./lodash.ef6c1e61.js";import{e as Za}from"./earcut.4d74f7f8.js";import{S as DM}from"./supercluster.abc15f5a.js";import{A as qC}from"./@amap.5b2c865e.js";import{i as xt,a as At,p as PM,C as Ev,d as BM}from"./inversify.38084d30.js";import"./reflect-metadata.3fe451f5.js";import{r as NM}from"./l7regl.2a91b919.js";import{c as Sv}from"./d3-color.a7c99788.js";import{W as KC}from"./viewport-mercator-project.62b3b7d0.js";import{m as Uo}from"./mapbox-gl.c8f2a290.js";import{g as Rd,r as Id}from"./lodash-es.713ac9bb.js";import{d as Qs,r as zM,b as UM,f as QC,g as JC,c as HM,p as $M,a as GM,u as VM}from"./@turf.a0d7264f.js";import{g as WM}from"./inversify-inject-decorators.291eaadb.js";import{c as jM,W as XM}from"./web-worker-helper.c63107ea.js";import{l as YM}from"./l7-tiny-sdf.ee02d60a.js";import{H as Co}from"./l7hammerjs.49a4e0a9.js";import{e as ZM,u as qM}from"./element-resize-event.75df3e49.js";import{g as Xf,V as KM}from"./@mapbox.2ba86c27.js";import{c as QM}from"./d3-dsv.07c19228.js";import{p as JM}from"./pbf.93eb2711.js";import{g as tw}from"./geojson-vt.c7257b5b.js";import{h as ew}from"./d3-hexbin.b5781642.js";import{e as Dd}from"./d3-array.7ec74193.js";import{l as rw,p as nw,a as iw,i as aw,s as ow,t as sw,q as uw,b as lw,c as cw,o as Yf,d as fw}from"./d3-scale.0ac3b5a7.js";const Rl=Object.freeze(Object.defineProperty({__proto__:null,get Base(){return Kr},get Circle(){return WR},get Ellipse(){return XR},get Image(){return ZR},get Line(){return KR},get Marker(){return tI},get Path(){return up},get Polygon(){return lI},get Polyline(){return fI},get Rect(){return dI},get Text(){return yI}},Symbol.toStringTag,{value:"Module"})),Il=Object.freeze(Object.defineProperty({__proto__:null,get Base(){return Pr},get Circle(){return TI},get Dom(){return wI},get Ellipse(){return FI},get Image(){return OI},get Line(){return II},get Marker(){return PI},get Path(){return NI},get Polygon(){return UI},get Polyline(){return $I},get Rect(){return WI},get Text(){return qI}},Symbol.toStringTag,{value:"Module"}));var gr=function(r){return r!==null&&typeof r!="function"&&isFinite(r.length)},Ni=function(r,n){return gr(r)?r.indexOf(n)>-1:!1},Pe=function(r,n){if(!gr(r))return r;for(var t=[],e=0;e<r.length;e++){var i=r[e];n(i,e)&&t.push(i)}return t},hw=function(r,n){return n===void 0&&(n=[]),Pe(r,function(t){return!Ni(n,t)})},vw={}.toString,mi=function(r,n){return vw.call(r)==="[object "+n+"]"};const rt=function(r){return mi(r,"Function")};var G=function(r){return r==null};const V=function(r){return Array.isArray?Array.isArray(r):mi(r,"Array")},wt=function(r){var n=typeof r;return r!==null&&n==="object"||n==="function"};function w(r,n){if(!!r){var t;if(V(r))for(var e=0,i=r.length;e<i&&(t=n(r[e],e),t!==!1);e++);else if(wt(r)){for(var a in r)if(r.hasOwnProperty(a)&&(t=n(r[a],a),t===!1))break}}}var oo=Object.keys?function(r){return Object.keys(r)}:function(r){var n=[];return w(r,function(t,e){rt(r)&&e==="prototype"||n.push(e)}),n};function tE(r,n){var t=oo(n),e=t.length;if(G(r))return!e;for(var i=0;i<e;i+=1){var a=t[i];if(n[a]!==r[a]||!(a in r))return!1}return!0}var Zf=function(r){return typeof r=="object"&&r!==null},fn=function(r){if(!Zf(r)||!mi(r,"Object"))return!1;if(Object.getPrototypeOf(r)===null)return!0;for(var n=r;Object.getPrototypeOf(n)!==null;)n=Object.getPrototypeOf(n);return Object.getPrototypeOf(r)===n};function jr(r,n){if(!V(r))return null;var t;if(rt(n)&&(t=n),fn(n)&&(t=function(i){return tE(i,n)}),t){for(var e=0;e<r.length;e+=1)if(t(r[e]))return r[e]}return null}function eE(r,n,t){t===void 0&&(t=0);for(var e=t;e<r.length;e++)if(n(r[e],e))return e;return-1}var pw=function(r,n){for(var t=null,e=0;e<r.length;e++){var i=r[e],a=i[n];if(!G(a)){V(a)?t=a[0]:t=a;break}}return t},yr=function(r){if(!V(r))return[];for(var n=[],t=0;t<r.length;t++)n=n.concat(r[t]);return n};const We=function(r){if(!!V(r))return r.reduce(function(n,t){return Math.max(n,t)},r[0])},er=function(r){if(!!V(r))return r.reduce(function(n,t){return Math.min(n,t)},r[0])};var rE=function(r){var n=r.filter(function(o){return!isNaN(o)});if(!n.length)return{min:0,max:0};if(V(r[0])){for(var t=[],e=0;e<r.length;e++)t=t.concat(r[e]);n=t}var i=We(n),a=er(n);return{min:a,max:i}},dw=Array.prototype.splice,gw=function(n,t){if(!gr(n))return[];for(var e=n?t.length:0,i=e-1;e--;){var a=void 0,o=t[e];(e===i||o!==a)&&(a=o,dw.call(n,o,1))}return n},ze=function(r,n,t){if(!V(r)&&!fn(r))return r;var e=t;return w(r,function(i,a){e=n(e,i,a)}),e},yw=function(r,n){var t=[];if(!gr(r))return t;for(var e=-1,i=[],a=r.length;++e<a;){var o=r[e];n(o,e,r)&&(t.push(o),i.push(e))}return gw(r,i),t};const lt=function(r){return mi(r,"String")};function mw(r,n){var t;if(rt(n))t=function(i,a){return n(i)-n(a)};else{var e=[];lt(n)?e.push(n):V(n)&&(e=n),t=function(i,a){for(var o=0;o<e.length;o+=1){var s=e[o];if(i[s]>a[s])return 1;if(i[s]<a[s])return-1}return 0}}return r.sort(t),r}function qa(r,n){n===void 0&&(n=new Map);var t=[];if(Array.isArray(r))for(var e=0,i=r.length;e<i;e++){var a=r[e];n.has(a)||(t.push(a),n.set(a,!0))}return t}const Yr=function(r,n){for(var t=[],e={},i=0;i<r.length;i++){var a=r[i],o=a[n];if(!G(o)){V(o)||(o=[o]);for(var s=0;s<o.length;s++){var u=o[s];e[u]||(t.push(u),e[u]=!0)}}}return t};function pr(r){if(gr(r))return r[0]}function pe(r){if(gr(r)){var n=r;return n[n.length-1]}}var bv=function(r,n){for(var t=0;t<r.length;t++)if(!n(r[t],t))return!1;return!0},Dl=function(r,n){for(var t=0;t<r.length;t++)if(n(r[t],t))return!0;return!1},xw=Object.prototype.hasOwnProperty;function dr(r,n){if(!n||!V(r))return{};for(var t={},e=rt(n)?n:function(s){return s[n]},i,a=0;a<r.length;a++){var o=r[a];i=e(o),xw.call(t,i)?t[i].push(o):t[i]=[o]}return t}function nE(r,n){if(!n)return{0:r};if(!rt(n)){var t=V(n)?n:n.replace(/\s+/g,"").split("*");n=function(e){for(var i="_",a=0,o=t.length;a<o;a++)i+=e[t[a]]&&e[t[a]].toString();return i}}return dr(r,n)}const _w=function(r,n){if(!n)return[r];var t=nE(r,n),e=[];for(var i in t)e.push(t[i]);return e};var Kt=function(r,n,t){return r<n?n:r>t?t:r},Bc=function(r,n){var t=n.toString(),e=t.indexOf(".");if(e===-1)return Math.round(r);var i=t.substr(e+1).length;return i>20&&(i=20),parseFloat(r.toFixed(i))},dt=function(r){return mi(r,"Number")},Cw=1e-5;function we(r,n,t){return t===void 0&&(t=Cw),Math.abs(r-n)<t}const iE=function(r,n){if(!!V(r)){for(var t,e=-1/0,i=0;i<r.length;i++){var a=r[i],o=rt(n)?n(a):a[n];o>e&&(t=a,e=o)}return t}},Ew=function(r,n){if(!!V(r)){for(var t,e=1/0,i=0;i<r.length;i++){var a=r[i],o=rt(n)?n(a):a[n];o<e&&(t=a,e=o)}return t}};var Av=function(r,n){return(r%n+n)%n},Sw=Math.PI/180,Tv=function(r){return Sw*r};const si=function(r,n){return r.hasOwnProperty(n)};var Pl=Object.values?function(r){return Object.values(r)}:function(r){var n=[];return w(r,function(t,e){rt(r)&&e==="prototype"||n.push(t)}),n};const Ds=function(r){return G(r)?"":r.toString()};var la=function(r){return Ds(r).toLowerCase()};function Ps(r,n){return!r||!n?r:r.replace(/\\?\{([^{}]+)\}/g,function(t,e){return t.charAt(0)==="\\"?t.slice(1):n[e]===void 0?"":n[e]})}var ca=function(r){var n=Ds(r);return n.charAt(0).toUpperCase()+n.substring(1)},bw={}.toString,Aw=function(r){return bw.call(r).replace(/^\[object /,"").replace(/]$/,"")},ui=function(r){return mi(r,"Boolean")},aE=function(r){return mi(r,"Date")},Tw=function(r){return r===null},Mw=Object.prototype,ww=function(r){var n=r&&r.constructor,t=typeof n=="function"&&n.prototype||Mw;return r===t},Je=function(r){return r===void 0},oE=function(r){return r instanceof Element||r instanceof HTMLDocument};function Lw(r){var n=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(t){return setTimeout(t,16)};return n(r)}function Fw(r){var n=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.msCancelAnimationFrame||clearTimeout;n(r)}function Nc(r,n){for(var t in n)n.hasOwnProperty(t)&&t!=="constructor"&&n[t]!==void 0&&(r[t]=n[t])}function zt(r,n,t,e){return n&&Nc(r,n),t&&Nc(r,t),e&&Nc(r,e),r}var Ve=function(r){if(typeof r!="object"||r===null)return r;var n;if(V(r)){n=[];for(var t=0,e=r.length;t<e;t++)typeof r[t]=="object"&&r[t]!=null?n[t]=Ve(r[t]):n[t]=r[t]}else{n={};for(var i in r)typeof r[i]=="object"&&r[i]!=null?n[i]=Ve(r[i]):n[i]=r[i]}return n};function sE(r,n,t){var e;return function(){var i=this,a=arguments,o=function(){e=null,t||r.apply(i,a)},s=t&&!e;clearTimeout(e),e=setTimeout(o,n),s&&r.apply(i,a)}}const so=function(r,n){if(!rt(r))throw new TypeError("Expected a function");var t=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];var a=n?n.apply(this,e):e[0],o=t.cache;if(o.has(a))return o.get(a);var s=r.apply(this,e);return o.set(a,s),s};return t.cache=new Map,t};var kw=5;function uE(r,n,t,e){t=t||0,e=e||kw;for(var i in n)if(n.hasOwnProperty(i)){var a=n[i];a!==null&&fn(a)?(fn(r[i])||(r[i]={}),t<e?uE(r[i],a,t+1,e):r[i]=n[i]):V(a)?(r[i]=[],r[i]=r[i].concat(a)):a!==void 0&&(r[i]=a)}}var J=function(r){for(var n=[],t=1;t<arguments.length;t++)n[t-1]=arguments[t];for(var e=0;e<n.length;e+=1)uE(r,n[e]);return r},lE=function(r,n){if(!gr(r))return-1;var t=Array.prototype.indexOf;if(t)return t.call(r,n);for(var e=-1,i=0;i<r.length;i++)if(r[i]===n){e=i;break}return e},Ow=Object.prototype.hasOwnProperty;function nr(r){if(G(r))return!0;if(gr(r))return!r.length;var n=Aw(r);if(n==="Map"||n==="Set")return!r.size;if(ww(r))return!Object.keys(r).length;for(var t in r)if(Ow.call(r,t))return!1;return!0}var Dt=function(r,n){if(r===n)return!0;if(!r||!n||lt(r)||lt(n))return!1;if(gr(r)||gr(n)){if(r.length!==n.length)return!1;for(var t=!0,e=0;e<r.length&&(t=Dt(r[e],n[e]),!!t);e++);return t}if(Zf(r)||Zf(n)){var i=Object.keys(r),a=Object.keys(n);if(i.length!==a.length)return!1;for(var t=!0,e=0;e<i.length&&(t=Dt(r[i[e]],n[i[e]]),!!t);e++);return t}return!1},ie=function(r,n){if(!gr(r))return r;for(var t=[],e=0;e<r.length;e++){var i=r[e];t.push(n(i,e))}return t},Rw=function(r){return r};const Iw=function(r,n){n===void 0&&(n=Rw);var t={};return wt(r)&&!G(r)&&Object.keys(r).forEach(function(e){t[e]=n(r[e],e)}),t},F=function(r,n,t){for(var e=0,i=lt(n)?n.split("."):n;r&&e<i.length;)r=r[i[e++]];return r===void 0||e<i.length?t:r},he=function(r,n,t){var e=r,i=lt(n)?n.split("."):n;return i.forEach(function(a,o){o<i.length-1?(wt(e[a])||(e[a]=dt(i[o+1])?[]:{}),e=e[a]):e[a]=t}),r};var Dw=Object.prototype.hasOwnProperty;const li=function(r,n){if(r===null||!fn(r))return{};var t={};return w(n,function(e){Dw.call(r,e)&&(t[e]=r[e])}),t},Bl=function(r,n){return ze(r,function(t,e,i){return n.includes(i)||(t[i]=e),t},{})},Mv=function(r,n,t){var e,i,a,o,s=0;t||(t={});var u=function(){s=t.leading===!1?0:Date.now(),e=null,o=r.apply(i,a),e||(i=a=null)},l=function(){var c=Date.now();!s&&t.leading===!1&&(s=c);var f=n-(c-s);return i=this,a=arguments,f<=0||f>n?(e&&(clearTimeout(e),e=null),s=c,o=r.apply(i,a),e||(i=a=null)):!e&&t.trailing!==!1&&(e=setTimeout(u,f)),o};return l.cancel=function(){clearTimeout(e),s=0,e=i=a=null},l},Pw=function(r){return gr(r)?Array.prototype.slice.call(r):[]};var Js={};const Ir=function(r){return r=r||"g",Js[r]?Js[r]+=1:Js[r]=1,r+Js[r]},ti=function(){};function Ee(r){return G(r)?0:gr(r)?r.length:Object.keys(r).length}var tu;const eu=so(function(r,n){n===void 0&&(n={});var t=n.fontSize,e=n.fontFamily,i=n.fontWeight,a=n.fontStyle,o=n.fontVariant;return tu||(tu=document.createElement("canvas").getContext("2d")),tu.font=[a,o,i,t+"px",e].join(" "),tu.measureText(lt(r)?r:"").width},function(r,n){return n===void 0&&(n={}),Yt([r],Pl(n)).join("")}),Bw=function(r,n,t,e){e===void 0&&(e="...");var i=16,a=eu(e,t),o=lt(r)?r:Ds(r),s=n,u=[],l,c;if(eu(r,t)<=n)return r;for(;l=o.substr(0,i),c=eu(l,t),!(c+a>s&&c>s);)if(u.push(l),s-=c,o=o.substr(i),!o)return u.join("");for(;l=o.substr(0,1),c=eu(l,t),!(c+a>s);)if(u.push(l),s-=c,o=o.substr(1),!o)return u.join("");return""+u.join("")+e};var Nw=function(){function r(){this.map={}}return r.prototype.has=function(n){return this.map[n]!==void 0},r.prototype.get=function(n,t){var e=this.map[n];return e===void 0?t:e},r.prototype.set=function(n,t){this.map[n]=t},r.prototype.clear=function(){this.map={}},r.prototype.delete=function(n){delete this.map[n]},r.prototype.size=function(){return Object.keys(this.map).length},r}(),ue;(function(r){r.FORE="fore",r.MID="mid",r.BG="bg"})(ue||(ue={}));var Z;(function(r){r.TOP="top",r.TOP_LEFT="top-left",r.TOP_RIGHT="top-right",r.RIGHT="right",r.RIGHT_TOP="right-top",r.RIGHT_BOTTOM="right-bottom",r.LEFT="left",r.LEFT_TOP="left-top",r.LEFT_BOTTOM="left-bottom",r.BOTTOM="bottom",r.BOTTOM_LEFT="bottom-left",r.BOTTOM_RIGHT="bottom-right",r.RADIUS="radius",r.CIRCLE="circle",r.NONE="none"})(Z||(Z={}));var Ce;(function(r){r.AXIS="axis",r.GRID="grid",r.LEGEND="legend",r.TOOLTIP="tooltip",r.ANNOTATION="annotation",r.SLIDER="slider",r.SCROLLBAR="scrollbar",r.OTHER="other"})(Ce||(Ce={}));var za={FORE:3,MID:2,BG:1},_t;(function(r){r.BEFORE_RENDER="beforerender",r.AFTER_RENDER="afterrender",r.BEFORE_PAINT="beforepaint",r.AFTER_PAINT="afterpaint",r.BEFORE_CHANGE_DATA="beforechangedata",r.AFTER_CHANGE_DATA="afterchangedata",r.BEFORE_CLEAR="beforeclear",r.AFTER_CLEAR="afterclear",r.BEFORE_DESTROY="beforedestroy",r.BEFORE_CHANGE_SIZE="beforechangesize",r.AFTER_CHANGE_SIZE="afterchangesize"})(_t||(_t={}));var ni;(function(r){r.BEFORE_DRAW_ANIMATE="beforeanimate",r.AFTER_DRAW_ANIMATE="afteranimate",r.BEFORE_RENDER_LABEL="beforerenderlabel",r.AFTER_RENDER_LABEL="afterrenderlabel"})(ni||(ni={}));var Ye;(function(r){r.MOUSE_ENTER="plot:mouseenter",r.MOUSE_DOWN="plot:mousedown",r.MOUSE_MOVE="plot:mousemove",r.MOUSE_UP="plot:mouseup",r.MOUSE_LEAVE="plot:mouseleave",r.TOUCH_START="plot:touchstart",r.TOUCH_MOVE="plot:touchmove",r.TOUCH_END="plot:touchend",r.TOUCH_CANCEL="plot:touchcancel",r.CLICK="plot:click",r.DBLCLICK="plot:dblclick",r.CONTEXTMENU="plot:contextmenu",r.LEAVE="plot:leave",r.ENTER="plot:enter"})(Ye||(Ye={}));var il;(function(r){r.ACTIVE="active",r.INACTIVE="inactive",r.SELECTED="selected",r.DEFAULT="default"})(il||(il={}));var Pa=["color","shape","size"],Vt="_origin",Pd=1,Bd=1,Nd=.25,cE={};function zw(r){var n=cE[r];if(!n)throw new Error("G engine '".concat(r,"' is not exist, please register it at first."));return n}function fE(r,n){cE[r]=n}function ma(r,n,t){if(r){if(typeof r.addEventListener=="function")return r.addEventListener(n,t,!1),{remove:function(){r.removeEventListener(n,t,!1)}};if(typeof r.attachEvent=="function")return r.attachEvent("on"+n,t),{remove:function(){r.detachEvent("on"+n,t)}}}}var Ho,zc,hE,qf;function Uw(){Ho=document.createElement("table"),zc=document.createElement("tr"),hE=/^\s*<(\w+|!)[^>]*>/,qf={tr:document.createElement("tbody"),tbody:Ho,thead:Ho,tfoot:Ho,td:zc,th:zc,"*":document.createElement("div")}}function wn(r){Ho||Uw();var n=hE.test(r)&&RegExp.$1;(!n||!(n in qf))&&(n="*");var t=qf[n];r=typeof r=="string"?r.replace(/(^\s*)|(\s*$)/g,""):r,t.innerHTML=""+r;var e=t.childNodes[0];return e&&t.contains(e)&&t.removeChild(e),e}function Qe(r,n,t){var e;try{e=window.getComputedStyle?window.getComputedStyle(r,null)[n]:r.style[n]}catch{}finally{e=e===void 0?t:e}return e}function Hw(r,n){var t=Qe(r,"height",n);return t==="auto"&&(t=r.offsetHeight),parseFloat(t)}function $w(r,n){var t=Hw(r,n),e=parseFloat(Qe(r,"borderTopWidth"))||0,i=parseFloat(Qe(r,"paddingTop"))||0,a=parseFloat(Qe(r,"paddingBottom"))||0,o=parseFloat(Qe(r,"borderBottomWidth"))||0,s=parseFloat(Qe(r,"marginTop"))||0,u=parseFloat(Qe(r,"marginBottom"))||0;return t+e+o+i+a+s+u}function Gw(r,n){var t=Qe(r,"width",n);return t==="auto"&&(t=r.offsetWidth),parseFloat(t)}function Vw(r,n){var t=Gw(r,n),e=parseFloat(Qe(r,"borderLeftWidth"))||0,i=parseFloat(Qe(r,"paddingLeft"))||0,a=parseFloat(Qe(r,"paddingRight"))||0,o=parseFloat(Qe(r,"borderRightWidth"))||0,s=parseFloat(Qe(r,"marginRight"))||0,u=parseFloat(Qe(r,"marginLeft"))||0;return t+e+o+i+a+u+s}function Xt(r,n){if(r)for(var t in n)n.hasOwnProperty(t)&&(r.style[t]=n[t]);return r}function Ww(r){var n=getComputedStyle(r);return{width:(r.clientWidth||parseInt(n.width,10))-parseInt(n.paddingLeft,10)-parseInt(n.paddingRight,10),height:(r.clientHeight||parseInt(n.height,10))-parseInt(n.paddingTop,10)-parseInt(n.paddingBottom,10)}}function zd(r){return typeof r=="number"&&!isNaN(r)}function Ud(r,n,t,e){var i=t,a=e;if(n){var o=Ww(r);i=o.width?o.width:i,a=o.height?o.height:a}return{width:Math.max(zd(i)?i:Pd,Pd),height:Math.max(zd(a)?a:Bd,Bd)}}function jw(r){var n=r.parentNode;n&&n.removeChild(r)}var Xw="*",fa=function(){function r(){this._events={}}return r.prototype.on=function(n,t,e){return this._events[n]||(this._events[n]=[]),this._events[n].push({callback:t,once:!!e}),this},r.prototype.once=function(n,t){return this.on(n,t,!0)},r.prototype.emit=function(n){for(var t=this,e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];var a=this._events[n]||[],o=this._events[Xw]||[],s=function(u){for(var l=u.length,c=0;c<l;c++)if(!!u[c]){var f=u[c],h=f.callback,v=f.once;v&&(u.splice(c,1),u.length===0&&delete t._events[n],l--,c--),h.apply(t,e)}};s(a),s(o)},r.prototype.off=function(n,t){if(!n)this._events={};else if(!t)delete this._events[n];else{for(var e=this._events[n]||[],i=e.length,a=0;a<i;a++)e[a].callback===t&&(e.splice(a,1),i--,a--);e.length===0&&delete this._events[n]}return this},r.prototype.getEvents=function(){return this._events},r}(),wv=function(r){R(n,r);function n(t){var e=r.call(this)||this;e.destroyed=!1;var i=t.visible,a=i===void 0?!0:i;return e.visible=a,e}return n.prototype.show=function(){var t=this.visible;t||this.changeVisible(!0)},n.prototype.hide=function(){var t=this.visible;t&&this.changeVisible(!1)},n.prototype.destroy=function(){this.off(),this.destroyed=!0},n.prototype.changeVisible=function(t){this.visible!==t&&(this.visible=t)},n}(fa),Yo=`	
\v\f\r \xA0\u1680\u180E\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029`,Yw=new RegExp("([a-z])["+Yo+",]*((-?\\d*\\.?\\d*(?:e[\\-+]?\\d+)?["+Yo+"]*,?["+Yo+"]*)+)","ig"),Zw=new RegExp("(-?\\d*\\.?\\d*(?:e[\\-+]?\\d+)?)["+Yo+"]*,?["+Yo+"]*","ig"),Ba=function(r){if(!r)return null;if(V(r))return r;var n={a:7,c:6,o:2,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,u:3,z:0},t=[];return String(r).replace(Yw,function(e,i,a){var o=[],s=i.toLowerCase();if(a.replace(Zw,function(u,l){l&&o.push(+l)}),s==="m"&&o.length>2&&(t.push([i].concat(o.splice(0,2))),s="l",i=i==="m"?"l":"L"),s==="o"&&o.length===1&&t.push([i,o[0]]),s==="r")t.push([i].concat(o));else for(;o.length>=n[s]&&(t.push([i].concat(o.splice(0,n[s]))),!!n[s]););return r}),t},Kf=function(r,n){for(var t=[],e=0,i=r.length;i-2*!n>e;e+=2){var a=[{x:+r[e-2],y:+r[e-1]},{x:+r[e],y:+r[e+1]},{x:+r[e+2],y:+r[e+3]},{x:+r[e+4],y:+r[e+5]}];n?e?i-4===e?a[3]={x:+r[0],y:+r[1]}:i-2===e&&(a[2]={x:+r[0],y:+r[1]},a[3]={x:+r[2],y:+r[3]}):a[0]={x:+r[i-2],y:+r[i-1]}:i-4===e?a[3]=a[2]:e||(a[0]={x:+r[e],y:+r[e+1]}),t.push(["C",(-a[0].x+6*a[1].x+a[2].x)/6,(-a[0].y+6*a[1].y+a[2].y)/6,(a[1].x+6*a[2].x-a[3].x)/6,(a[1].y+6*a[2].y-a[3].y)/6,a[2].x,a[2].y])}return t},ru=function(r,n,t,e,i){var a=[];if(i===null&&e===null&&(e=t),r=+r,n=+n,t=+t,e=+e,i!==null){var o=Math.PI/180,s=r+t*Math.cos(-e*o),u=r+t*Math.cos(-i*o),l=n+t*Math.sin(-e*o),c=n+t*Math.sin(-i*o);a=[["M",s,l],["A",t,t,0,+(i-e>180),0,u,c]]}else a=[["M",r,n],["m",0,-e],["a",t,e,0,1,1,0,2*e],["a",t,e,0,1,1,0,-2*e],["z"]];return a},Qf=function(r){if(r=Ba(r),!r||!r.length)return[["M",0,0]];var n=[],t=0,e=0,i=0,a=0,o=0,s,u;r[0][0]==="M"&&(t=+r[0][1],e=+r[0][2],i=t,a=e,o++,n[0]=["M",t,e]);for(var l=r.length===3&&r[0][0]==="M"&&r[1][0].toUpperCase()==="R"&&r[2][0].toUpperCase()==="Z",c=void 0,f=void 0,h=o,v=r.length;h<v;h++){if(n.push(c=[]),f=r[h],s=f[0],s!==s.toUpperCase())switch(c[0]=s.toUpperCase(),c[0]){case"A":c[1]=f[1],c[2]=f[2],c[3]=f[3],c[4]=f[4],c[5]=f[5],c[6]=+f[6]+t,c[7]=+f[7]+e;break;case"V":c[1]=+f[1]+e;break;case"H":c[1]=+f[1]+t;break;case"R":u=[t,e].concat(f.slice(1));for(var p=2,d=u.length;p<d;p++)u[p]=+u[p]+t,u[++p]=+u[p]+e;n.pop(),n=n.concat(Kf(u,l));break;case"O":n.pop(),u=ru(t,e,f[1],f[2]),u.push(u[0]),n=n.concat(u);break;case"U":n.pop(),n=n.concat(ru(t,e,f[1],f[2],f[3])),c=["U"].concat(n[n.length-1].slice(-2));break;case"M":i=+f[1]+t,a=+f[2]+e;break;default:for(var p=1,d=f.length;p<d;p++)c[p]=+f[p]+(p%2?t:e)}else if(s==="R")u=[t,e].concat(f.slice(1)),n.pop(),n=n.concat(Kf(u,l)),c=["R"].concat(f.slice(-2));else if(s==="O")n.pop(),u=ru(t,e,f[1],f[2]),u.push(u[0]),n=n.concat(u);else if(s==="U")n.pop(),n=n.concat(ru(t,e,f[1],f[2],f[3])),c=["U"].concat(n[n.length-1].slice(-2));else for(var g=0,y=f.length;g<y;g++)c[g]=f[g];if(s=s.toUpperCase(),s!=="O")switch(c[0]){case"Z":t=+i,e=+a;break;case"H":t=c[1];break;case"V":e=c[1];break;case"M":i=c[c.length-2],a=c[c.length-1];break;default:t=c[c.length-2],e=c[c.length-1]}}return n},nu=function(r,n,t,e){return[r,n,t,e,t,e]},Hd=function(r,n,t,e,i,a){var o=.3333333333333333,s=2/3;return[o*r+s*t,o*n+s*e,o*i+s*t,o*a+s*e,i,a]},vE=function(r,n,t,e,i,a,o,s,u,l){t===e&&(t+=1);var c=Math.PI*120/180,f=Math.PI/180*(+i||0),h=[],v,p,d,g,y,m=function(jt,Jt,xe){var Nr=jt*Math.cos(xe)-Jt*Math.sin(xe),zr=jt*Math.sin(xe)+Jt*Math.cos(xe);return{x:Nr,y:zr}};if(l)p=l[0],d=l[1],g=l[2],y=l[3];else{v=m(r,n,-f),r=v.x,n=v.y,v=m(s,u,-f),s=v.x,u=v.y,r===s&&n===u&&(s+=1,u+=1);var x=(r-s)/2,_=(n-u)/2,E=x*x/(t*t)+_*_/(e*e);E>1&&(E=Math.sqrt(E),t=E*t,e=E*e);var b=t*t,M=e*e,T=(a===o?-1:1)*Math.sqrt(Math.abs((b*M-b*_*_-M*x*x)/(b*_*_+M*x*x)));g=T*t*_/e+(r+s)/2,y=T*-e*x/t+(n+u)/2,p=Math.asin(((n-y)/e).toFixed(9)),d=Math.asin(((u-y)/e).toFixed(9)),p=r<g?Math.PI-p:p,d=s<g?Math.PI-d:d,p<0&&(p=Math.PI*2+p),d<0&&(d=Math.PI*2+d),o&&p>d&&(p=p-Math.PI*2),!o&&d>p&&(d=d-Math.PI*2)}var k=d-p;if(Math.abs(k)>c){var L=d,O=s,D=u;d=p+c*(o&&d>p?1:-1),s=g+t*Math.cos(d),u=y+e*Math.sin(d),h=vE(s,u,t,e,i,0,o,O,D,[d,L,g,y])}k=d-p;var W=Math.cos(p),j=Math.sin(p),ot=Math.cos(d),z=Math.sin(d),X=Math.tan(k/4),K=4/3*t*X,Q=4/3*e*X,q=[r,n],at=[r+K*j,n-Q*W],pt=[s+K*z,u-Q*ot],mt=[s,u];if(at[0]=2*q[0]-at[0],at[1]=2*q[1]-at[1],l)return[at,pt,mt].concat(h);h=[at,pt,mt].concat(h).join().split(",");for(var ft=[],vt=0,Lt=h.length;vt<Lt;vt++)ft[vt]=vt%2?m(h[vt-1],h[vt],f).y:m(h[vt],h[vt+1],f).x;return ft},Jf=function(r,n){var t=Qf(r),e=n&&Qf(n),i={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},a={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},o=[],s=[],u="",l="",c,f=function(x,_,E){var b,M;if(!x)return["C",_.x,_.y,_.x,_.y,_.x,_.y];switch(!(x[0]in{T:1,Q:1})&&(_.qx=_.qy=null),x[0]){case"M":_.X=x[1],_.Y=x[2];break;case"A":x=["C"].concat(vE.apply(0,[_.x,_.y].concat(x.slice(1))));break;case"S":E==="C"||E==="S"?(b=_.x*2-_.bx,M=_.y*2-_.by):(b=_.x,M=_.y),x=["C",b,M].concat(x.slice(1));break;case"T":E==="Q"||E==="T"?(_.qx=_.x*2-_.qx,_.qy=_.y*2-_.qy):(_.qx=_.x,_.qy=_.y),x=["C"].concat(Hd(_.x,_.y,_.qx,_.qy,x[1],x[2]));break;case"Q":_.qx=x[1],_.qy=x[2],x=["C"].concat(Hd(_.x,_.y,x[1],x[2],x[3],x[4]));break;case"L":x=["C"].concat(nu(_.x,_.y,x[1],x[2]));break;case"H":x=["C"].concat(nu(_.x,_.y,x[1],_.y));break;case"V":x=["C"].concat(nu(_.x,_.y,_.x,x[1]));break;case"Z":x=["C"].concat(nu(_.x,_.y,_.X,_.Y));break}return x},h=function(x,_){if(x[_].length>7){x[_].shift();for(var E=x[_];E.length;)o[_]="A",e&&(s[_]="A"),x.splice(_++,0,["C"].concat(E.splice(0,6)));x.splice(_,1),c=Math.max(t.length,e&&e.length||0)}},v=function(x,_,E,b,M){x&&_&&x[M][0]==="M"&&_[M][0]!=="M"&&(_.splice(M,0,["M",b.x,b.y]),E.bx=0,E.by=0,E.x=x[M][1],E.y=x[M][2],c=Math.max(t.length,e&&e.length||0))};c=Math.max(t.length,e&&e.length||0);for(var p=0;p<c;p++){t[p]&&(u=t[p][0]),u!=="C"&&(o[p]=u,p&&(l=o[p-1])),t[p]=f(t[p],i,l),o[p]!=="A"&&u==="C"&&(o[p]="C"),h(t,p),e&&(e[p]&&(u=e[p][0]),u!=="C"&&(s[p]=u,p&&(l=s[p-1])),e[p]=f(e[p],a,l),s[p]!=="A"&&u==="C"&&(s[p]="C"),h(e,p)),v(t,e,i,a,p),v(e,t,a,i,p);var d=t[p],g=e&&e[p],y=d.length,m=e&&g.length;i.x=d[y-2],i.y=d[y-1],i.bx=parseFloat(d[y-4])||i.x,i.by=parseFloat(d[y-3])||i.y,a.bx=e&&(parseFloat(g[m-4])||a.x),a.by=e&&(parseFloat(g[m-3])||a.y),a.x=e&&g[m-2],a.y=e&&g[m-1]}return e?[t,e]:t},qw=/,?([a-z]),?/gi,pE=function(r){return r.join(",").replace(qw,"$1")},$d=function(r,n,t,e,i){var a=-3*n+9*t-9*e+3*i,o=r*a+6*n-12*t+6*e;return r*o-3*n+3*t},Gd=function(r,n,t,e,i,a,o,s,u){u===null&&(u=1),u=u>1?1:u<0?0:u;for(var l=u/2,c=12,f=[-.1252,.1252,-.3678,.3678,-.5873,.5873,-.7699,.7699,-.9041,.9041,-.9816,.9816],h=[.2491,.2491,.2335,.2335,.2032,.2032,.1601,.1601,.1069,.1069,.0472,.0472],v=0,p=0;p<c;p++){var d=l*f[p]+l,g=$d(d,r,t,i,o),y=$d(d,n,e,a,s),m=g*g+y*y;v+=h[p]*Math.sqrt(m)}return l*v},Kw=function(r,n,t,e,i,a,o,s){for(var u=[],l=[[],[]],c,f,h,v,p=0;p<2;++p){if(p===0?(f=6*r-12*t+6*i,c=-3*r+9*t-9*i+3*o,h=3*t-3*r):(f=6*n-12*e+6*a,c=-3*n+9*e-9*a+3*s,h=3*e-3*n),Math.abs(c)<1e-12){if(Math.abs(f)<1e-12)continue;v=-h/f,v>0&&v<1&&u.push(v);continue}var d=f*f-4*h*c,g=Math.sqrt(d);if(!(d<0)){var y=(-f+g)/(2*c);y>0&&y<1&&u.push(y);var m=(-f-g)/(2*c);m>0&&m<1&&u.push(m)}}for(var x=u.length,_=x,E;x--;)v=u[x],E=1-v,l[0][x]=E*E*E*r+3*E*E*v*t+3*E*v*v*i+v*v*v*o,l[1][x]=E*E*E*n+3*E*E*v*e+3*E*v*v*a+v*v*v*s;return l[0][_]=r,l[1][_]=n,l[0][_+1]=o,l[1][_+1]=s,l[0].length=l[1].length=_+2,{min:{x:Math.min.apply(0,l[0]),y:Math.min.apply(0,l[1])},max:{x:Math.max.apply(0,l[0]),y:Math.max.apply(0,l[1])}}},Qw=function(r,n,t,e,i,a,o,s){if(!(Math.max(r,t)<Math.min(i,o)||Math.min(r,t)>Math.max(i,o)||Math.max(n,e)<Math.min(a,s)||Math.min(n,e)>Math.max(a,s))){var u=(r*e-n*t)*(i-o)-(r-t)*(i*s-a*o),l=(r*e-n*t)*(a-s)-(n-e)*(i*s-a*o),c=(r-t)*(a-s)-(n-e)*(i-o);if(!!c){var f=u/c,h=l/c,v=+f.toFixed(2),p=+h.toFixed(2);if(!(v<+Math.min(r,t).toFixed(2)||v>+Math.max(r,t).toFixed(2)||v<+Math.min(i,o).toFixed(2)||v>+Math.max(i,o).toFixed(2)||p<+Math.min(n,e).toFixed(2)||p>+Math.max(n,e).toFixed(2)||p<+Math.min(a,s).toFixed(2)||p>+Math.max(a,s).toFixed(2)))return{x:f,y:h}}}},Bn=function(r,n,t){return n>=r.x&&n<=r.x+r.width&&t>=r.y&&t<=r.y+r.height},dE=function(r,n,t,e,i){if(i)return[["M",+r+ +i,n],["l",t-i*2,0],["a",i,i,0,0,1,i,i],["l",0,e-i*2],["a",i,i,0,0,1,-i,i],["l",i*2-t,0],["a",i,i,0,0,1,-i,-i],["l",0,i*2-e],["a",i,i,0,0,1,i,-i],["z"]];var a=[["M",r,n],["l",t,0],["l",0,e],["l",-t,0],["z"]];return a.parsePathArray=pE,a},th=function(r,n,t,e){return r===null&&(r=n=t=e=0),n===null&&(n=r.y,t=r.width,e=r.height,r=r.x),{x:r,y:n,width:t,w:t,height:e,h:e,x2:r+t,y2:n+e,cx:r+t/2,cy:n+e/2,r1:Math.min(t,e)/2,r2:Math.max(t,e)/2,r0:Math.sqrt(t*t+e*e)/2,path:dE(r,n,t,e),vb:[r,n,t,e].join(" ")}},Jw=function(r,n){return r=th(r),n=th(n),Bn(n,r.x,r.y)||Bn(n,r.x2,r.y)||Bn(n,r.x,r.y2)||Bn(n,r.x2,r.y2)||Bn(r,n.x,n.y)||Bn(r,n.x2,n.y)||Bn(r,n.x,n.y2)||Bn(r,n.x2,n.y2)||(r.x<n.x2&&r.x>n.x||n.x<r.x2&&n.x>r.x)&&(r.y<n.y2&&r.y>n.y||n.y<r.y2&&n.y>r.y)},Vd=function(r,n,t,e,i,a,o,s){V(r)||(r=[r,n,t,e,i,a,o,s]);var u=Kw.apply(null,r);return th(u.min.x,u.min.y,u.max.x-u.min.x,u.max.y-u.min.y)},Wd=function(r,n,t,e,i,a,o,s,u){var l=1-u,c=Math.pow(l,3),f=Math.pow(l,2),h=u*u,v=h*u,p=c*r+f*3*u*t+l*3*u*u*i+v*o,d=c*n+f*3*u*e+l*3*u*u*a+v*s,g=r+2*u*(t-r)+h*(i-2*t+r),y=n+2*u*(e-n)+h*(a-2*e+n),m=t+2*u*(i-t)+h*(o-2*i+t),x=e+2*u*(a-e)+h*(s-2*a+e),_=l*r+u*t,E=l*n+u*e,b=l*i+u*o,M=l*a+u*s,T=90-Math.atan2(g-m,y-x)*180/Math.PI;return{x:p,y:d,m:{x:g,y},n:{x:m,y:x},start:{x:_,y:E},end:{x:b,y:M},alpha:T}},tL=function(r,n,t){var e=Vd(r),i=Vd(n);if(!Jw(e,i))return t?0:[];for(var a=Gd.apply(0,r),o=Gd.apply(0,n),s=~~(a/8),u=~~(o/8),l=[],c=[],f={},h=t?0:[],v=0;v<s+1;v++){var p=Wd.apply(0,r.concat(v/s));l.push({x:p.x,y:p.y,t:v/s})}for(var v=0;v<u+1;v++){var p=Wd.apply(0,n.concat(v/u));c.push({x:p.x,y:p.y,t:v/u})}for(var v=0;v<s;v++)for(var d=0;d<u;d++){var g=l[v],y=l[v+1],m=c[d],x=c[d+1],_=Math.abs(y.x-g.x)<.001?"y":"x",E=Math.abs(x.x-m.x)<.001?"y":"x",b=Qw(g.x,g.y,y.x,y.y,m.x,m.y,x.x,x.y);if(b){if(f[b.x.toFixed(4)]===b.y.toFixed(4))continue;f[b.x.toFixed(4)]=b.y.toFixed(4);var M=g.t+Math.abs((b[_]-g[_])/(y[_]-g[_]))*(y.t-g.t),T=m.t+Math.abs((b[E]-m[E])/(x[E]-m[E]))*(x.t-m.t);M>=0&&M<=1&&T>=0&&T<=1&&(t?h+=1:h.push({x:b.x,y:b.y,t1:M,t2:T}))}}return h},eL=function(r,n,t){r=Jf(r),n=Jf(n);for(var e,i,a,o,s,u,l,c,f,h,v=t?0:[],p=0,d=r.length;p<d;p++){var g=r[p];if(g[0]==="M")e=s=g[1],i=u=g[2];else{g[0]==="C"?(f=[e,i].concat(g.slice(1)),e=f[6],i=f[7]):(f=[e,i,e,i,s,u,s,u],e=s,i=u);for(var y=0,m=n.length;y<m;y++){var x=n[y];if(x[0]==="M")a=l=x[1],o=c=x[2];else{x[0]==="C"?(h=[a,o].concat(x.slice(1)),a=h[6],o=h[7]):(h=[a,o,a,o,l,c,l,c],a=l,o=c);var _=tL(f,h,t);if(t)v+=_;else{for(var E=0,b=_.length;E<b;E++)_[E].segment1=p,_[E].segment2=y,_[E].bez1=f,_[E].bez2=h;v=v.concat(_)}}}}}return v},rL=function(r,n){return eL(r,n)};function nL(r,n){var t=[],e=[];function i(a,o){if(a.length===1)t.push(a[0]),e.push(a[0]);else{for(var s=[],u=0;u<a.length-1;u++)u===0&&t.push(a[0]),u===a.length-2&&e.push(a[u+1]),s[u]=[(1-o)*a[u][0]+o*a[u+1][0],(1-o)*a[u][1]+o*a[u+1][1]];i(s,o)}}return r.length&&i(r,n),{left:t,right:e.reverse()}}function iL(r,n,t){var e=[[r[1],r[2]]];t=t||2;var i=[];n[0]==="A"?(e.push(n[6]),e.push(n[7])):n[0]==="C"?(e.push([n[1],n[2]]),e.push([n[3],n[4]]),e.push([n[5],n[6]])):n[0]==="S"||n[0]==="Q"?(e.push([n[1],n[2]]),e.push([n[3],n[4]])):e.push([n[1],n[2]]);for(var a=e,o=1/t,s=0;s<t-1;s++){var u=o/(1-o*s),l=nL(a,u);i.push(l.left),a=l.right}i.push(a);var c=i.map(function(f){var h=[];return f.length===4&&(h.push("C"),h=h.concat(f[2])),f.length>=3&&(f.length===3&&h.push("Q"),h=h.concat(f[1])),f.length===2&&h.push("L"),h=h.concat(f[f.length-1]),h});return c}var aL=function(r,n,t){if(t===1)return[[].concat(r)];var e=[];if(n[0]==="L"||n[0]==="C"||n[0]==="Q")e=e.concat(iL(r,n,t));else{var i=[].concat(r);i[0]==="M"&&(i[0]="L");for(var a=0;a<=t-1;a++)e.push(i)}return e},oL=function(r,n){if(r.length===1)return r;var t=r.length-1,e=n.length-1,i=t/e,a=[];if(r.length===1&&r[0][0]==="M"){for(var o=0;o<e-t;o++)r.push(r[0]);return r}for(var o=0;o<e;o++){var s=Math.floor(i*o);a[s]=(a[s]||0)+1}var u=a.reduce(function(l,c,f){return f===t?l.concat(r[t]):l.concat(aL(r[f],r[f+1],c))},[]);return u.unshift(r[0]),(n[e]==="Z"||n[e]==="z")&&u.push("Z"),u},sL=function(r,n){if(r.length!==n.length)return!1;var t=!0;return w(r,function(e,i){if(e!==n[i])return t=!1,!1}),t};function uL(r,n,t){var e=null,i=t;return n<i&&(i=n,e="add"),r<i&&(i=r,e="del"),{type:e,min:i}}var lL=function(r,n){var t=r.length,e=n.length,i,a,o=0;if(t===0||e===0)return null;for(var s=[],u=0;u<=t;u++)s[u]=[],s[u][0]={min:u};for(var l=0;l<=e;l++)s[0][l]={min:l};for(var u=1;u<=t;u++){i=r[u-1];for(var l=1;l<=e;l++){a=n[l-1],sL(i,a)?o=0:o=1;var c=s[u-1][l].min+1,f=s[u][l-1].min+1,h=s[u-1][l-1].min+o;s[u][l]=uL(c,f,h)}}return s},gE=function(r,n){var t=lL(r,n),e=r.length,i=n.length,a=[],o=1,s=1;if(t[e][i].min!==e){for(var u=1;u<=e;u++){var l=t[u][u].min;s=u;for(var c=o;c<=i;c++)t[u][c].min<l&&(l=t[u][c].min,s=c);o=s,t[u][o].type&&a.push({index:u-1,type:t[u][o].type})}for(var u=a.length-1;u>=0;u--)o=a[u].index,a[u].type==="add"?r.splice(o,0,[].concat(r[o])):r.splice(o,1)}e=r.length;var f=i-e;if(e<i)for(var u=0;u<f;u++)r[e-1][0]==="z"||r[e-1][0]==="Z"?r.splice(e-2,0,r[e-2]):r.push(r[e-1]),e+=1;return r};function Uc(r,n,t){for(var e=[].concat(r),i,a=1/(t+1),o=yE(n)[0],s=1;s<=t;s++)a*=s,i=Math.floor(r.length*a),i===0?e.unshift([o[0]*a+r[i][0]*(1-a),o[1]*a+r[i][1]*(1-a)]):e.splice(i,0,[o[0]*a+r[i][0]*(1-a),o[1]*a+r[i][1]*(1-a)]);return e}function yE(r){var n=[];switch(r[0]){case"M":n.push([r[1],r[2]]);break;case"L":n.push([r[1],r[2]]);break;case"A":n.push([r[6],r[7]]);break;case"Q":n.push([r[3],r[4]]),n.push([r[1],r[2]]);break;case"T":n.push([r[1],r[2]]);break;case"C":n.push([r[5],r[6]]),n.push([r[1],r[2]]),n.push([r[3],r[4]]);break;case"S":n.push([r[3],r[4]]),n.push([r[1],r[2]]);break;case"H":n.push([r[1],r[1]]);break;case"V":n.push([r[1],r[1]]);break}return n}var eh=function(r,n){if(r.length<=1)return r;for(var t,e=0;e<n.length;e++)if(r[e][0]!==n[e][0])switch(t=yE(r[e]),n[e][0]){case"M":r[e]=["M"].concat(t[0]);break;case"L":r[e]=["L"].concat(t[0]);break;case"A":r[e]=[].concat(n[e]),r[e][6]=t[0][0],r[e][7]=t[0][1];break;case"Q":if(t.length<2)if(e>0)t=Uc(t,r[e-1],1);else{r[e]=n[e];break}r[e]=["Q"].concat(t.reduce(function(i,a){return i.concat(a)},[]));break;case"T":r[e]=["T"].concat(t[0]);break;case"C":if(t.length<3)if(e>0)t=Uc(t,r[e-1],2);else{r[e]=n[e];break}r[e]=["C"].concat(t.reduce(function(i,a){return i.concat(a)},[]));break;case"S":if(t.length<2)if(e>0)t=Uc(t,r[e-1],1);else{r[e]=n[e];break}r[e]=["S"].concat(t.reduce(function(i,a){return i.concat(a)},[]));break;default:r[e]=n[e]}return r};const Lv=Object.freeze(Object.defineProperty({__proto__:null,catmullRomToBezier:Kf,fillPath:oL,fillPathByDiff:gE,formatPath:eh,intersection:rL,parsePathArray:pE,parsePathString:Ba,pathToAbsolute:Qf,pathToCurve:Jf,rectPath:dE},Symbol.toStringTag,{value:"Module"}));var Bs=function(){function r(n,t){this.bubbles=!0,this.target=null,this.currentTarget=null,this.delegateTarget=null,this.delegateObject=null,this.defaultPrevented=!1,this.propagationStopped=!1,this.shape=null,this.fromShape=null,this.toShape=null,this.propagationPath=[],this.type=n,this.name=n,this.originalEvent=t,this.timeStamp=t.timeStamp}return r.prototype.preventDefault=function(){this.defaultPrevented=!0,this.originalEvent.preventDefault&&this.originalEvent.preventDefault()},r.prototype.stopPropagation=function(){this.propagationStopped=!0},r.prototype.toString=function(){var n=this.type;return"[Event (type="+n+")]"},r.prototype.save=function(){},r.prototype.restore=function(){},r}();function mE(r,n){var t=r.indexOf(n);t!==-1&&r.splice(t,1)}var jd=typeof window<"u"&&typeof window.document<"u";function xE(r,n){if(r.isCanvas())return!0;for(var t=n.getParent(),e=!1;t;){if(t===r){e=!0;break}t=t.getParent()}return e}function ss(r){return r.cfg.visible&&r.cfg.capture}var Nl=function(r){R(n,r);function n(t){var e=r.call(this)||this;e.destroyed=!1;var i=e.getDefaultCfg();return e.cfg=zt(i,t),e}return n.prototype.getDefaultCfg=function(){return{}},n.prototype.get=function(t){return this.cfg[t]},n.prototype.set=function(t,e){this.cfg[t]=e},n.prototype.destroy=function(){this.cfg={destroyed:!0},this.off(),this.destroyed=!0},n}(fa);function Oa(r,n,t){var e=[0,0,0,0,0,0,0,0,0];return KT(e,t),wl(r,e,n)}function Fv(r,n,t){var e=[0,0,0,0,0,0,0,0,0];return qT(e,t),wl(r,e,n)}function _E(r,n,t){var e=[0,0,0,0,0,0,0,0,0];return QT(e,t),wl(r,e,n)}function cL(r,n,t){return wl(r,t,n)}function ve(r,n){for(var t=r?[].concat(r):[1,0,0,0,1,0,0,0,1],e=0,i=n.length;e<i;e++){var a=n[e];switch(a[0]){case"t":Oa(t,t,[a[1],a[2]]);break;case"s":_E(t,t,[a[1],a[2]]);break;case"r":Fv(t,t,a[1]);break;case"m":cL(t,t,a[1]);break}}return t}function fL(r,n){return r[0]*n[1]-n[0]*r[1]}function kv(r,n,t){var e=jf(r,n),i=fL(r,n)>=0;return t?i?Math.PI*2-e:e:i?e:Math.PI*2-e}function Xd(r,n){var t=[],e=r[0],i=r[1],a=r[2],o=r[3],s=r[4],u=r[5],l=r[6],c=r[7],f=r[8],h=n[0],v=n[1],p=n[2],d=n[3],g=n[4],y=n[5],m=n[6],x=n[7],_=n[8];return t[0]=h*e+v*o+p*l,t[1]=h*i+v*s+p*c,t[2]=h*a+v*u+p*f,t[3]=d*e+g*o+y*l,t[4]=d*i+g*s+y*c,t[5]=d*a+g*u+y*f,t[6]=m*e+x*o+_*l,t[7]=m*i+x*s+_*c,t[8]=m*a+x*u+_*f,t}function Sn(r,n){var t=[],e=n[0],i=n[1];return t[0]=r[0]*e+r[3]*i+r[6],t[1]=r[1]*e+r[4]*i+r[7],t}function zl(r){var n=[],t=r[0],e=r[1],i=r[2],a=r[3],o=r[4],s=r[5],u=r[6],l=r[7],c=r[8],f=c*o-s*l,h=-c*a+s*u,v=l*a-o*u,p=t*f+e*h+i*v;return p?(p=1/p,n[0]=f*p,n[1]=(-c*e+i*l)*p,n[2]=(s*e-i*o)*p,n[3]=h*p,n[4]=(c*t-i*u)*p,n[5]=(-s*t+i*a)*p,n[6]=v*p,n[7]=(-l*t+e*u)*p,n[8]=(o*t-e*a)*p,n):null}var Eo=ve,Hc="matrix",hL=["zIndex","capture","visible","type"],vL=["repeat"],pL=":",dL="*";function gL(r){for(var n=[],t=0;t<r.length;t++)V(r[t])?n.push([].concat(r[t])):n.push(r[t]);return n}function yL(r,n){var t={},e=n.attrs;for(var i in r)t[i]=e[i];return t}function mL(r,n){var t={},e=n.attr();return w(r,function(i,a){vL.indexOf(a)===-1&&!Dt(e[a],i)&&(t[a]=i)}),t}function xL(r,n){if(n.onFrame)return r;var t=n.startTime,e=n.delay,i=n.duration,a=Object.prototype.hasOwnProperty;return w(r,function(o){t+e<o.startTime+o.delay+o.duration&&i>o.delay&&w(n.toAttrs,function(s,u){a.call(o.toAttrs,u)&&(delete o.toAttrs[u],delete o.fromAttrs[u])})}),r}var CE=function(r){R(n,r);function n(t){var e=r.call(this,t)||this;e.attrs={};var i=e.getDefaultAttrs();return zt(i,t.attrs),e.attrs=i,e.initAttrs(i),e.initAnimate(),e}return n.prototype.getDefaultCfg=function(){return{visible:!0,capture:!0,zIndex:0}},n.prototype.getDefaultAttrs=function(){return{matrix:this.getDefaultMatrix(),opacity:1}},n.prototype.onCanvasChange=function(t){},n.prototype.initAttrs=function(t){},n.prototype.initAnimate=function(){this.set("animable",!0),this.set("animating",!1)},n.prototype.isGroup=function(){return!1},n.prototype.getParent=function(){return this.get("parent")},n.prototype.getCanvas=function(){return this.get("canvas")},n.prototype.attr=function(){for(var t,e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];var a=e[0],o=e[1];if(!a)return this.attrs;if(wt(a)){for(var s in a)this.setAttr(s,a[s]);return this.afterAttrsChange(a),this}return e.length===2?(this.setAttr(a,o),this.afterAttrsChange((t={},t[a]=o,t)),this):this.attrs[a]},n.prototype.isClipped=function(t,e){var i=this.getClip();return i&&!i.isHit(t,e)},n.prototype.setAttr=function(t,e){var i=this.attrs[t];i!==e&&(this.attrs[t]=e,this.onAttrChange(t,e,i))},n.prototype.onAttrChange=function(t,e,i){t==="matrix"&&this.set("totalMatrix",null)},n.prototype.afterAttrsChange=function(t){if(this.cfg.isClipShape){var e=this.cfg.applyTo;e&&e.onCanvasChange("clip")}else this.onCanvasChange("attr")},n.prototype.show=function(){return this.set("visible",!0),this.onCanvasChange("show"),this},n.prototype.hide=function(){return this.set("visible",!1),this.onCanvasChange("hide"),this},n.prototype.setZIndex=function(t){this.set("zIndex",t);var e=this.getParent();return e&&e.sort(),this},n.prototype.toFront=function(){var t=this.getParent();if(!!t){var e=t.getChildren();this.get("el");var i=e.indexOf(this);e.splice(i,1),e.push(this),this.onCanvasChange("zIndex")}},n.prototype.toBack=function(){var t=this.getParent();if(!!t){var e=t.getChildren();this.get("el");var i=e.indexOf(this);e.splice(i,1),e.unshift(this),this.onCanvasChange("zIndex")}},n.prototype.remove=function(t){t===void 0&&(t=!0);var e=this.getParent();e?(mE(e.getChildren(),this),e.get("clearing")||this.onCanvasChange("remove")):this.onCanvasChange("remove"),t&&this.destroy()},n.prototype.resetMatrix=function(){this.attr(Hc,this.getDefaultMatrix()),this.onCanvasChange("matrix")},n.prototype.getMatrix=function(){return this.attr(Hc)},n.prototype.setMatrix=function(t){this.attr(Hc,t),this.onCanvasChange("matrix")},n.prototype.getTotalMatrix=function(){var t=this.cfg.totalMatrix;if(!t){var e=this.attr("matrix"),i=this.cfg.parentMatrix;i&&e?t=Xd(i,e):t=e||i,this.set("totalMatrix",t)}return t},n.prototype.applyMatrix=function(t){var e=this.attr("matrix"),i=null;t&&e?i=Xd(t,e):i=e||t,this.set("totalMatrix",i),this.set("parentMatrix",t)},n.prototype.getDefaultMatrix=function(){return null},n.prototype.applyToMatrix=function(t){var e=this.attr("matrix");return e?Sn(e,t):t},n.prototype.invertFromMatrix=function(t){var e=this.attr("matrix");if(e){var i=zl(e);if(i)return Sn(i,t)}return t},n.prototype.setClip=function(t){var e=this.getCanvas(),i=null;if(t){var a=this.getShapeBase(),o=ca(t.type),s=a[o];s&&(i=new s({type:t.type,isClipShape:!0,applyTo:this,attrs:t.attrs,canvas:e}))}return this.set("clipShape",i),this.onCanvasChange("clip"),i},n.prototype.getClip=function(){var t=this.cfg.clipShape;return t||null},n.prototype.clone=function(){var t=this,e=this.attrs,i={};w(e,function(s,u){V(e[u])?i[u]=gL(e[u]):i[u]=e[u]});var a=this.constructor,o=new a({attrs:i});return w(hL,function(s){o.set(s,t.get(s))}),o},n.prototype.destroy=function(){var t=this.destroyed;t||(this.attrs={},r.prototype.destroy.call(this))},n.prototype.isAnimatePaused=function(){return this.get("_pause").isPaused},n.prototype.animate=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(!(!this.get("timeline")&&!this.get("canvas"))){this.set("animating",!0);var i=this.get("timeline");i||(i=this.get("canvas").get("timeline"),this.set("timeline",i));var a=this.get("animations")||[];i.timer||i.initTimer();var o=t[0],s=t[1],u=t[2],l=u===void 0?"easeLinear":u,c=t[3],f=c===void 0?ti:c,h=t[4],v=h===void 0?0:h,p,d,g,y,m;rt(o)?(p=o,o={}):wt(o)&&o.onFrame&&(p=o.onFrame,d=o.repeat),wt(s)?(m=s,s=m.duration,l=m.easing||"easeLinear",v=m.delay||0,d=m.repeat||d||!1,f=m.callback||ti,g=m.pauseCallback||ti,y=m.resumeCallback||ti):(dt(f)&&(v=f,f=null),rt(l)?(f=l,l="easeLinear"):l=l||"easeLinear");var x=mL(o,this),_={fromAttrs:yL(x,this),toAttrs:x,duration:s,easing:l,repeat:d,callback:f,pauseCallback:g,resumeCallback:y,delay:v,startTime:i.getTime(),id:Ir(),onFrame:p,pathFormatted:!1};a.length>0?a=xL(a,_):i.addAnimator(this),a.push(_),this.set("animations",a),this.set("_pause",{isPaused:!1})}},n.prototype.stopAnimate=function(t){var e=this;t===void 0&&(t=!0);var i=this.get("animations");w(i,function(a){t&&(a.onFrame?e.attr(a.onFrame(1)):e.attr(a.toAttrs)),a.callback&&a.callback()}),this.set("animating",!1),this.set("animations",[])},n.prototype.pauseAnimate=function(){var t=this.get("timeline"),e=this.get("animations"),i=t.getTime();return w(e,function(a){a._paused=!0,a._pauseTime=i,a.pauseCallback&&a.pauseCallback()}),this.set("_pause",{isPaused:!0,pauseTime:i}),this},n.prototype.resumeAnimate=function(){var t=this.get("timeline"),e=t.getTime(),i=this.get("animations"),a=this.get("_pause").pauseTime;return w(i,function(o){o.startTime=o.startTime+(e-a),o._paused=!1,o._pauseTime=null,o.resumeCallback&&o.resumeCallback()}),this.set("_pause",{isPaused:!1}),this.set("animations",i),this},n.prototype.emitDelegation=function(t,e){var i=this,a=e.propagationPath;this.getEvents();var o;t==="mouseenter"?o=e.fromShape:t==="mouseleave"&&(o=e.toShape);for(var s=function(f){var h=a[f],v=h.get("name");if(v){if((h.isGroup()||h.isCanvas&&h.isCanvas())&&o&&xE(h,o))return"break";V(v)?w(v,function(p){i.emitDelegateEvent(h,p,e)}):u.emitDelegateEvent(h,v,e)}},u=this,l=0;l<a.length;l++){var c=s(l);if(c==="break")break}},n.prototype.emitDelegateEvent=function(t,e,i){var a=this.getEvents(),o=e+pL+i.type;(a[o]||a[dL])&&(i.name=o,i.currentTarget=t,i.delegateTarget=this,i.delegateObject=t.get("delegateObject"),this.emit(o,i))},n.prototype.translate=function(t,e){t===void 0&&(t=0),e===void 0&&(e=0);var i=this.getMatrix(),a=Eo(i,[["t",t,e]]);return this.setMatrix(a),this},n.prototype.move=function(t,e){var i=this.attr("x")||0,a=this.attr("y")||0;return this.translate(t-i,e-a),this},n.prototype.moveTo=function(t,e){return this.move(t,e)},n.prototype.scale=function(t,e){var i=this.getMatrix(),a=Eo(i,[["s",t,e||t]]);return this.setMatrix(a),this},n.prototype.rotate=function(t){var e=this.getMatrix(),i=Eo(e,[["r",t]]);return this.setMatrix(i),this},n.prototype.rotateAtStart=function(t){var e=this.attr(),i=e.x,a=e.y,o=this.getMatrix(),s=Eo(o,[["t",-i,-a],["r",t],["t",i,a]]);return this.setMatrix(s),this},n.prototype.rotateAtPoint=function(t,e,i){var a=this.getMatrix(),o=Eo(a,[["t",-t,-e],["r",i],["t",t,e]]);return this.setMatrix(o),this},n}(Nl),Yd={},rh="_INDEX";function EE(r,n){if(r.set("canvas",n),r.isGroup()){var t=r.get("children");t.length&&t.forEach(function(e){EE(e,n)})}}function SE(r,n){if(r.set("timeline",n),r.isGroup()){var t=r.get("children");t.length&&t.forEach(function(e){SE(e,n)})}}function _L(r,n,t){t===void 0&&(t=!0),t?n.destroy():(n.set("parent",null),n.set("canvas",null)),mE(r.getChildren(),n)}function CL(r){return function(n,t){var e=r(n,t);return e===0?n[rh]-t[rh]:e}}var bE=function(r){R(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.isCanvas=function(){return!1},n.prototype.getBBox=function(){var t=1/0,e=-1/0,i=1/0,a=-1/0,o=[],s=[],u=this.getChildren().filter(function(c){return c.get("visible")&&(!c.isGroup()||c.isGroup()&&c.getChildren().length>0)});u.length>0?(w(u,function(c){var f=c.getBBox();o.push(f.minX,f.maxX),s.push(f.minY,f.maxY)}),t=er(o),e=We(o),i=er(s),a=We(s)):(t=0,e=0,i=0,a=0);var l={x:t,y:i,minX:t,minY:i,maxX:e,maxY:a,width:e-t,height:a-i};return l},n.prototype.getCanvasBBox=function(){var t=1/0,e=-1/0,i=1/0,a=-1/0,o=[],s=[],u=this.getChildren().filter(function(c){return c.get("visible")&&(!c.isGroup()||c.isGroup()&&c.getChildren().length>0)});u.length>0?(w(u,function(c){var f=c.getCanvasBBox();o.push(f.minX,f.maxX),s.push(f.minY,f.maxY)}),t=er(o),e=We(o),i=er(s),a=We(s)):(t=0,e=0,i=0,a=0);var l={x:t,y:i,minX:t,minY:i,maxX:e,maxY:a,width:e-t,height:a-i};return l},n.prototype.getDefaultCfg=function(){var t=r.prototype.getDefaultCfg.call(this);return t.children=[],t},n.prototype.onAttrChange=function(t,e,i){if(r.prototype.onAttrChange.call(this,t,e,i),t==="matrix"){var a=this.getTotalMatrix();this._applyChildrenMarix(a)}},n.prototype.applyMatrix=function(t){var e=this.getTotalMatrix();r.prototype.applyMatrix.call(this,t);var i=this.getTotalMatrix();i!==e&&this._applyChildrenMarix(i)},n.prototype._applyChildrenMarix=function(t){var e=this.getChildren();w(e,function(i){i.applyMatrix(t)})},n.prototype.addShape=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=t[0],a=t[1];wt(i)?a=i:a.type=i;var o=Yd[a.type];o||(o=ca(a.type),Yd[a.type]=o);var s=this.getShapeBase(),u=new s[o](a);return this.add(u),u},n.prototype.addGroup=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=t[0],a=t[1],o;if(rt(i))a?o=new i(a):o=new i({parent:this});else{var s=i||{},u=this.getGroupBase();o=new u(s)}return this.add(o),o},n.prototype.getCanvas=function(){var t;return this.isCanvas()?t=this:t=this.get("canvas"),t},n.prototype.getShape=function(t,e,i){if(!ss(this))return null;var a=this.getChildren(),o;if(this.isCanvas())o=this._findShape(a,t,e,i);else{var s=[t,e,1];s=this.invertFromMatrix(s),this.isClipped(s[0],s[1])||(o=this._findShape(a,s[0],s[1],i))}return o},n.prototype._findShape=function(t,e,i,a){for(var o=null,s=t.length-1;s>=0;s--){var u=t[s];if(ss(u)&&(u.isGroup()?o=u.getShape(e,i,a):u.isHit(e,i)&&(o=u)),o)break}return o},n.prototype.add=function(t){var e=this.getCanvas(),i=this.getChildren(),a=this.get("timeline"),o=t.getParent();o&&_L(o,t,!1),t.set("parent",this),e&&EE(t,e),a&&SE(t,a),i.push(t),t.onCanvasChange("add"),this._applyElementMatrix(t)},n.prototype._applyElementMatrix=function(t){var e=this.getTotalMatrix();e&&t.applyMatrix(e)},n.prototype.getChildren=function(){return this.get("children")},n.prototype.sort=function(){var t=this.getChildren();w(t,function(e,i){return e[rh]=i,e}),t.sort(CL(function(e,i){return e.get("zIndex")-i.get("zIndex")})),this.onCanvasChange("sort")},n.prototype.clear=function(){if(this.set("clearing",!0),!this.destroyed){for(var t=this.getChildren(),e=t.length-1;e>=0;e--)t[e].destroy();this.set("children",[]),this.onCanvasChange("clear"),this.set("clearing",!1)}},n.prototype.destroy=function(){this.get("destroyed")||(this.clear(),r.prototype.destroy.call(this))},n.prototype.getFirst=function(){return this.getChildByIndex(0)},n.prototype.getLast=function(){var t=this.getChildren();return this.getChildByIndex(t.length-1)},n.prototype.getChildByIndex=function(t){var e=this.getChildren();return e[t]},n.prototype.getCount=function(){var t=this.getChildren();return t.length},n.prototype.contain=function(t){var e=this.getChildren();return e.indexOf(t)>-1},n.prototype.removeChild=function(t,e){e===void 0&&(e=!0),this.contain(t)&&t.remove(e)},n.prototype.findAll=function(t){var e=[],i=this.getChildren();return w(i,function(a){t(a)&&e.push(a),a.isGroup()&&(e=e.concat(a.findAll(t)))}),e},n.prototype.find=function(t){var e=null,i=this.getChildren();return w(i,function(a){if(t(a)?e=a:a.isGroup()&&(e=a.find(t)),e)return!1}),e},n.prototype.findById=function(t){return this.find(function(e){return e.get("id")===t})},n.prototype.findByClassName=function(t){return this.find(function(e){return e.get("className")===t})},n.prototype.findAllByName=function(t){return this.findAll(function(e){return e.get("name")===t})},n}(CE),AE={};function EL(r){return AE[r.toLowerCase()]||hM[r]}function TE(r,n){AE[r.toLowerCase()]=n}var SL=function(r){return["fill","stroke","fillStyle","strokeStyle"].includes(r)},bL=function(r){return/^[r,R,L,l]{1}[\s]*\(/.test(r)},Zd=[1,0,0,0,1,0,0,0,1];function AL(r,n,t){var e={},i=n.fromAttrs,a=n.toAttrs;if(!r.destroyed){var o;for(var s in a)if(!Dt(i[s],a[s]))if(s==="path"){var u=a[s],l=i[s];u.length>l.length?(u=Ba(a[s]),l=Ba(i[s]),l=gE(l,u),l=eh(l,u),n.fromAttrs.path=l,n.toAttrs.path=u):n.pathFormatted||(u=Ba(a[s]),l=Ba(i[s]),l=eh(l,u),n.fromAttrs.path=l,n.toAttrs.path=u,n.pathFormatted=!0),e[s]=[];for(var c=0;c<u.length;c++){for(var f=u[c],h=l[c],v=[],p=0;p<f.length;p++)dt(f[p])&&h&&dt(h[p])?(o=Ld(h[p],f[p]),v.push(o(t))):v.push(f[p]);e[s].push(v)}}else if(s==="matrix"){var d=vM(i[s]||Zd,a[s]||Zd),g=d(t);e[s]=g}else SL(s)&&bL(a[s])?e[s]=a[s]:rt(a[s])||(o=Ld(i[s],a[s]),e[s]=o(t));r.attr(e)}}function TL(r,n,t){var e=n.startTime,i=n.delay;if(t<e+i||n._paused)return!1;var a,o=n.duration,s=n.easing,u=EL(s);if(t=t-e-n.delay,n.repeat)a=t%o/o,a=u(a);else if(a=t/o,a<1)a=u(a);else return n.onFrame?r.attr(n.onFrame(1)):r.attr(n.toAttrs),!0;if(n.onFrame){var l=n.onFrame(a);r.attr(l)}else AL(r,n,a);return!1}var ML=function(){function r(n){this.animators=[],this.current=0,this.timer=null,this.canvas=n}return r.prototype.initTimer=function(){var n=this,t=!1,e,i,a;this.timer=dM(function(o){if(n.current=o,n.animators.length>0){for(var s=n.animators.length-1;s>=0;s--){if(e=n.animators[s],e.destroyed){n.removeAnimator(s);continue}if(!e.isAnimatePaused()){i=e.get("animations");for(var u=i.length-1;u>=0;u--)a=i[u],t=TL(e,a,o),t&&(i.splice(u,1),t=!1,a.callback&&a.callback())}i.length===0&&n.removeAnimator(s)}var l=n.canvas.get("autoDraw");l||n.canvas.draw()}})},r.prototype.addAnimator=function(n){this.animators.push(n)},r.prototype.removeAnimator=function(n){this.animators.splice(n,1)},r.prototype.isAnimating=function(){return!!this.animators.length},r.prototype.stop=function(){this.timer&&this.timer.stop()},r.prototype.stopAllAnimations=function(n){n===void 0&&(n=!0),this.animators.forEach(function(t){t.stopAnimate(n)}),this.animators=[],this.canvas.draw()},r.prototype.getTime=function(){return this.current},r}(),wL=40,qd=0,Kd=["mousedown","mouseup","dblclick","mouseout","mouseover","mousemove","mouseleave","mouseenter","touchstart","touchmove","touchend","dragenter","dragover","dragleave","drop","contextmenu","mousewheel"];function Qd(r,n,t){t.name=n,t.target=r,t.currentTarget=r,t.delegateTarget=r,r.emit(n,t)}function LL(r,n,t){if(t.bubbles){var e=void 0,i=!1;if(n==="mouseenter"?(e=t.fromShape,i=!0):n==="mouseleave"&&(i=!0,e=t.toShape),r.isCanvas()&&i)return;if(e&&xE(r,e)){t.bubbles=!1;return}t.name=n,t.currentTarget=r,t.delegateTarget=r,r.emit(n,t)}}var FL=function(){function r(n){var t=this;this.draggingShape=null,this.dragging=!1,this.currentShape=null,this.mousedownShape=null,this.mousedownPoint=null,this._eventCallback=function(e){var i=e.type;t._triggerEvent(i,e)},this._onDocumentMove=function(e){var i=t.canvas,a=i.get("el");if(a!==e.target&&(t.dragging||t.currentShape)){var o=t._getPointInfo(e);t.dragging&&t._emitEvent("drag",e,o,t.draggingShape)}},this._onDocumentMouseUp=function(e){var i=t.canvas,a=i.get("el");if(a!==e.target&&t.dragging){var o=t._getPointInfo(e);t.draggingShape&&t._emitEvent("drop",e,o,null),t._emitEvent("dragend",e,o,t.draggingShape),t._afterDrag(t.draggingShape,o,e)}},this.canvas=n.canvas}return r.prototype.init=function(){this._bindEvents()},r.prototype._bindEvents=function(){var n=this,t=this.canvas.get("el");w(Kd,function(e){t.addEventListener(e,n._eventCallback)}),document&&(document.addEventListener("mousemove",this._onDocumentMove),document.addEventListener("mouseup",this._onDocumentMouseUp))},r.prototype._clearEvents=function(){var n=this,t=this.canvas.get("el");w(Kd,function(e){t.removeEventListener(e,n._eventCallback)}),document&&(document.removeEventListener("mousemove",this._onDocumentMove),document.removeEventListener("mouseup",this._onDocumentMouseUp))},r.prototype._getEventObj=function(n,t,e,i,a,o){var s=new Bs(n,t);return s.fromShape=a,s.toShape=o,s.x=e.x,s.y=e.y,s.clientX=e.clientX,s.clientY=e.clientY,s.propagationPath.push(i),s},r.prototype._getShape=function(n,t){return this.canvas.getShape(n.x,n.y,t)},r.prototype._getPointInfo=function(n){var t=this.canvas,e=t.getClientByEvent(n),i=t.getPointByEvent(n);return{x:i.x,y:i.y,clientX:e.x,clientY:e.y}},r.prototype._triggerEvent=function(n,t){var e=this._getPointInfo(t),i=this._getShape(e,t),a=this["_on"+n],o=!1;if(a)a.call(this,e,i,t);else{var s=this.currentShape;n==="mouseenter"||n==="dragenter"||n==="mouseover"?(this._emitEvent(n,t,e,null,null,i),i&&this._emitEvent(n,t,e,i,null,i),n==="mouseenter"&&this.draggingShape&&this._emitEvent("dragenter",t,e,null)):n==="mouseleave"||n==="dragleave"||n==="mouseout"?(o=!0,s&&this._emitEvent(n,t,e,s,s,null),this._emitEvent(n,t,e,null,s,null),n==="mouseleave"&&this.draggingShape&&this._emitEvent("dragleave",t,e,null)):this._emitEvent(n,t,e,i,null,null)}if(o||(this.currentShape=i),i&&!i.get("destroyed")){var u=this.canvas,l=u.get("el");l.style.cursor=i.attr("cursor")||u.get("cursor")}},r.prototype._onmousedown=function(n,t,e){e.button===qd&&(this.mousedownShape=t,this.mousedownPoint=n,this.mousedownTimeStamp=e.timeStamp),this._emitEvent("mousedown",e,n,t,null,null)},r.prototype._emitMouseoverEvents=function(n,t,e,i){var a=this.canvas.get("el");e!==i&&(e&&(this._emitEvent("mouseout",n,t,e,e,i),this._emitEvent("mouseleave",n,t,e,e,i),(!i||i.get("destroyed"))&&(a.style.cursor=this.canvas.get("cursor"))),i&&(this._emitEvent("mouseover",n,t,i,e,i),this._emitEvent("mouseenter",n,t,i,e,i)))},r.prototype._emitDragoverEvents=function(n,t,e,i,a){i?(i!==e&&(e&&this._emitEvent("dragleave",n,t,e,e,i),this._emitEvent("dragenter",n,t,i,e,i)),a||this._emitEvent("dragover",n,t,i)):e&&this._emitEvent("dragleave",n,t,e,e,i),a&&this._emitEvent("dragover",n,t,i)},r.prototype._afterDrag=function(n,t,e){n&&(n.set("capture",!0),this.draggingShape=null),this.dragging=!1;var i=this._getShape(t,e);i!==n&&this._emitMouseoverEvents(e,t,n,i),this.currentShape=i},r.prototype._onmouseup=function(n,t,e){if(e.button===qd){var i=this.draggingShape;this.dragging?(i&&this._emitEvent("drop",e,n,t),this._emitEvent("dragend",e,n,i),this._afterDrag(i,n,e)):(this._emitEvent("mouseup",e,n,t),t===this.mousedownShape&&this._emitEvent("click",e,n,t),this.mousedownShape=null,this.mousedownPoint=null)}},r.prototype._ondragover=function(n,t,e){e.preventDefault();var i=this.currentShape;this._emitDragoverEvents(e,n,i,t,!0)},r.prototype._onmousemove=function(n,t,e){var i=this.canvas,a=this.currentShape,o=this.draggingShape;if(this.dragging)o&&this._emitDragoverEvents(e,n,a,t,!1),this._emitEvent("drag",e,n,o);else{var s=this.mousedownPoint;if(s){var u=this.mousedownShape,l=e.timeStamp,c=l-this.mousedownTimeStamp,f=s.clientX-n.clientX,h=s.clientY-n.clientY,v=f*f+h*h;c>120||v>wL?u&&u.get("draggable")?(o=this.mousedownShape,o.set("capture",!1),this.draggingShape=o,this.dragging=!0,this._emitEvent("dragstart",e,n,o),this.mousedownShape=null,this.mousedownPoint=null):!u&&i.get("draggable")?(this.dragging=!0,this._emitEvent("dragstart",e,n,null),this.mousedownShape=null,this.mousedownPoint=null):(this._emitMouseoverEvents(e,n,a,t),this._emitEvent("mousemove",e,n,t)):(this._emitMouseoverEvents(e,n,a,t),this._emitEvent("mousemove",e,n,t))}else this._emitMouseoverEvents(e,n,a,t),this._emitEvent("mousemove",e,n,t)}},r.prototype._emitEvent=function(n,t,e,i,a,o){var s=this._getEventObj(n,t,e,i,a,o);if(i){s.shape=i,Qd(i,n,s);for(var u=i.getParent();u;)u.emitDelegation(n,s),s.propagationStopped||LL(u,n,s),s.propagationPath.push(u),u=u.getParent()}else{var l=this.canvas;Qd(l,n,s)}},r.prototype.destroy=function(){this._clearEvents(),this.canvas=null,this.currentShape=null,this.draggingShape=null,this.mousedownPoint=null,this.mousedownShape=null,this.mousedownTimeStamp=null},r}(),Jd="px",tg=WC(),kL=tg&&tg.name==="firefox",Ul=function(r){R(n,r);function n(t){var e=r.call(this,t)||this;return e.initContainer(),e.initDom(),e.initEvents(),e.initTimeline(),e}return n.prototype.getDefaultCfg=function(){var t=r.prototype.getDefaultCfg.call(this);return t.cursor="default",t.supportCSSTransform=!1,t},n.prototype.initContainer=function(){var t=this.get("container");lt(t)&&(t=document.getElementById(t),this.set("container",t))},n.prototype.initDom=function(){var t=this.createDom();this.set("el",t);var e=this.get("container");e.appendChild(t),this.setDOMSize(this.get("width"),this.get("height"))},n.prototype.initEvents=function(){var t=new FL({canvas:this});t.init(),this.set("eventController",t)},n.prototype.initTimeline=function(){var t=new ML(this);this.set("timeline",t)},n.prototype.setDOMSize=function(t,e){var i=this.get("el");jd&&(i.style.width=t+Jd,i.style.height=e+Jd)},n.prototype.changeSize=function(t,e){this.setDOMSize(t,e),this.set("width",t),this.set("height",e),this.onCanvasChange("changeSize")},n.prototype.getRenderer=function(){return this.get("renderer")},n.prototype.getCursor=function(){return this.get("cursor")},n.prototype.setCursor=function(t){this.set("cursor",t);var e=this.get("el");jd&&e&&(e.style.cursor=t)},n.prototype.getPointByEvent=function(t){var e=this.get("supportCSSTransform");if(e){if(kL&&!G(t.layerX)&&t.layerX!==t.offsetX)return{x:t.layerX,y:t.layerY};if(!G(t.offsetX))return{x:t.offsetX,y:t.offsetY}}var i=this.getClientByEvent(t),a=i.x,o=i.y;return this.getPointByClient(a,o)},n.prototype.getClientByEvent=function(t){var e=t;return t.touches&&(t.type==="touchend"?e=t.changedTouches[0]:e=t.touches[0]),{x:e.clientX,y:e.clientY}},n.prototype.getPointByClient=function(t,e){var i=this.get("el"),a=i.getBoundingClientRect();return{x:t-a.left,y:e-a.top}},n.prototype.getClientByPoint=function(t,e){var i=this.get("el"),a=i.getBoundingClientRect();return{x:t+a.left,y:e+a.top}},n.prototype.draw=function(){},n.prototype.removeDom=function(){var t=this.get("el");t.parentNode.removeChild(t)},n.prototype.clearEvents=function(){var t=this.get("eventController");t.destroy()},n.prototype.isCanvas=function(){return!0},n.prototype.getParent=function(){return null},n.prototype.destroy=function(){var t=this.get("timeline");this.get("destroyed")||(this.clear(),t&&t.stop(),this.clearEvents(),this.removeDom(),r.prototype.destroy.call(this))},n}(bE),Hl=function(r){R(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.isGroup=function(){return!0},n.prototype.isEntityGroup=function(){return!1},n.prototype.clone=function(){for(var t=r.prototype.clone.call(this),e=this.getChildren(),i=0;i<e.length;i++){var a=e[i];t.add(a.clone())}return t},n}(bE),$l=function(r){R(n,r);function n(t){return r.call(this,t)||this}return n.prototype._isInBBox=function(t,e){var i=this.getBBox();return i.minX<=t&&i.maxX>=t&&i.minY<=e&&i.maxY>=e},n.prototype.afterAttrsChange=function(t){r.prototype.afterAttrsChange.call(this,t),this.clearCacheBBox()},n.prototype.getBBox=function(){var t=this.cfg.bbox;return t||(t=this.calculateBBox(),this.set("bbox",t)),t},n.prototype.getCanvasBBox=function(){var t=this.cfg.canvasBBox;return t||(t=this.calculateCanvasBBox(),this.set("canvasBBox",t)),t},n.prototype.applyMatrix=function(t){r.prototype.applyMatrix.call(this,t),this.set("canvasBBox",null)},n.prototype.calculateCanvasBBox=function(){var t=this.getBBox(),e=this.getTotalMatrix(),i=t.minX,a=t.minY,o=t.maxX,s=t.maxY;if(e){var u=Sn(e,[t.minX,t.minY]),l=Sn(e,[t.maxX,t.minY]),c=Sn(e,[t.minX,t.maxY]),f=Sn(e,[t.maxX,t.maxY]);i=Math.min(u[0],l[0],c[0],f[0]),o=Math.max(u[0],l[0],c[0],f[0]),a=Math.min(u[1],l[1],c[1],f[1]),s=Math.max(u[1],l[1],c[1],f[1])}var h=this.attrs;if(h.shadowColor){var v=h.shadowBlur,p=v===void 0?0:v,d=h.shadowOffsetX,g=d===void 0?0:d,y=h.shadowOffsetY,m=y===void 0?0:y,x=i-p+g,_=o+p+g,E=a-p+m,b=s+p+m;i=Math.min(i,x),o=Math.max(o,_),a=Math.min(a,E),s=Math.max(s,b)}return{x:i,y:a,minX:i,minY:a,maxX:o,maxY:s,width:o-i,height:s-a}},n.prototype.clearCacheBBox=function(){this.set("bbox",null),this.set("canvasBBox",null)},n.prototype.isClipShape=function(){return this.get("isClipShape")},n.prototype.isInShape=function(t,e){return!1},n.prototype.isOnlyHitBox=function(){return!1},n.prototype.isHit=function(t,e){var i=this.get("startArrowShape"),a=this.get("endArrowShape"),o=[t,e,1];o=this.invertFromMatrix(o);var s=o[0],u=o[1],l=this._isInBBox(s,u);return this.isOnlyHitBox()?l:!!(l&&!this.isClipped(s,u)&&(this.isInShape(s,u)||i&&i.isHit(s,u)||a&&a.isHit(s,u)))},n}(CE),ME=new Map;function Dr(r,n){ME.set(r,n)}function Gl(r){return ME.get(r)}function wE(r){var n=r.attr(),t=n.x,e=n.y,i=n.width,a=n.height;return{x:t,y:e,width:i,height:a}}function LE(r){var n=r.attr(),t=n.x,e=n.y,i=n.r;return{x:t-i,y:e-i,width:i*2,height:i*2}}function eg(r){return Math.min.apply(null,r)}function rg(r){return Math.max.apply(null,r)}function Ue(r,n,t,e){var i=r-t,a=n-e;return Math.sqrt(i*i+a*a)}function Gu(r,n){return Math.abs(r-n)<.001}function uo(r,n){var t=eg(r),e=eg(n),i=rg(r),a=rg(n);return{x:t,y:e,width:i-t,height:a-e}}function Vl(r){return(r+Math.PI*2)%(Math.PI*2)}const Le={box:function(r,n,t,e){return uo([r,t],[n,e])},length:function(r,n,t,e){return Ue(r,n,t,e)},pointAt:function(r,n,t,e,i){return{x:(1-i)*r+i*t,y:(1-i)*n+i*e}},pointDistance:function(r,n,t,e,i,a){var o=(t-r)*(i-r)+(e-n)*(a-n);if(o<0)return Ue(r,n,i,a);var s=(t-r)*(t-r)+(e-n)*(e-n);return o>s?Ue(t,e,i,a):this.pointToLine(r,n,t,e,i,a)},pointToLine:function(r,n,t,e,i,a){var o=[t-r,e-n];if(JT(o,[0,0]))return Math.sqrt((i-r)*(i-r)+(a-n)*(a-n));var s=[-o[1],o[0]];kr(s,s);var u=[i-r,a-n];return Math.abs(Mn(u,s))},tangentAngle:function(r,n,t,e){return Math.atan2(e-n,t-r)}};var OL=1e-4;function FE(r,n,t,e,i,a){var o,s=1/0,u=[t,e],l=20;a&&a>200&&(l=a/10);for(var c=1/l,f=c/10,h=0;h<=l;h++){var v=h*c,p=[i.apply(null,r.concat([v])),i.apply(null,n.concat([v]))],d=Ue(u[0],u[1],p[0],p[1]);d<s&&(o=v,s=d)}if(o===0)return{x:r[0],y:n[0]};if(o===1){var g=r.length;return{x:r[g-1],y:n[g-1]}}s=1/0;for(var h=0;h<32&&!(f<OL);h++){var y=o-f,m=o+f,p=[i.apply(null,r.concat([y])),i.apply(null,n.concat([y]))],d=Ue(u[0],u[1],p[0],p[1]);if(y>=0&&d<s)o=y,s=d;else{var x=[i.apply(null,r.concat([m])),i.apply(null,n.concat([m]))],_=Ue(u[0],u[1],x[0],x[1]);m<=1&&_<s?(o=m,s=_):f*=.5}}return{x:i.apply(null,r.concat([o])),y:i.apply(null,n.concat([o]))}}function RL(r,n){for(var t=0,e=r.length,i=0;i<e;i++){var a=r[i],o=n[i],s=r[(i+1)%e],u=n[(i+1)%e];t+=Ue(a,o,s,u)}return t/2}function Zn(r,n,t,e){var i=1-e;return i*i*r+2*e*i*n+e*e*t}function ng(r,n,t){var e=r+t-2*n;if(Gu(e,0))return[.5];var i=(r-n)/e;return i<=1&&i>=0?[i]:[]}function ig(r,n,t,e){return 2*(1-e)*(n-r)+2*e*(t-n)}function kE(r,n,t,e,i,a,o){var s=Zn(r,t,i,o),u=Zn(n,e,a,o),l=Le.pointAt(r,n,t,e,o),c=Le.pointAt(t,e,i,a,o);return[[r,n,l.x,l.y,s,u],[s,u,c.x,c.y,i,a]]}function nh(r,n,t,e,i,a,o){if(o===0)return(Ue(r,n,t,e)+Ue(t,e,i,a)+Ue(r,n,i,a))/2;var s=kE(r,n,t,e,i,a,.5),u=s[0],l=s[1];return u.push(o-1),l.push(o-1),nh.apply(null,u)+nh.apply(null,l)}const OE={box:function(r,n,t,e,i,a){var o=ng(r,t,i)[0],s=ng(n,e,a)[0],u=[r,i],l=[n,a];return o!==void 0&&u.push(Zn(r,t,i,o)),s!==void 0&&l.push(Zn(n,e,a,s)),uo(u,l)},length:function(r,n,t,e,i,a){return nh(r,n,t,e,i,a,3)},nearestPoint:function(r,n,t,e,i,a,o,s){return FE([r,t,i],[n,e,a],o,s,Zn)},pointDistance:function(r,n,t,e,i,a,o,s){var u=this.nearestPoint(r,n,t,e,i,a,o,s);return Ue(u.x,u.y,o,s)},interpolationAt:Zn,pointAt:function(r,n,t,e,i,a,o){return{x:Zn(r,t,i,o),y:Zn(n,e,a,o)}},divide:function(r,n,t,e,i,a,o){return kE(r,n,t,e,i,a,o)},tangentAngle:function(r,n,t,e,i,a,o){var s=ig(r,t,i,o),u=ig(n,e,a,o),l=Math.atan2(u,s);return Vl(l)}};function qn(r,n,t,e,i){var a=1-i;return a*a*a*r+3*n*i*a*a+3*t*i*i*a+e*i*i*i}function ag(r,n,t,e,i){var a=1-i;return 3*(a*a*(n-r)+2*a*i*(t-n)+i*i*(e-t))}function $c(r,n,t,e){var i=-3*r+9*n-9*t+3*e,a=6*r-12*n+6*t,o=3*n-3*r,s=[],u,l,c;if(Gu(i,0))Gu(a,0)||(u=-o/a,u>=0&&u<=1&&s.push(u));else{var f=a*a-4*i*o;Gu(f,0)?s.push(-a/(2*i)):f>0&&(c=Math.sqrt(f),u=(-a+c)/(2*i),l=(-a-c)/(2*i),u>=0&&u<=1&&s.push(u),l>=0&&l<=1&&s.push(l))}return s}function RE(r,n,t,e,i,a,o,s,u){var l=qn(r,t,i,o,u),c=qn(n,e,a,s,u),f=Le.pointAt(r,n,t,e,u),h=Le.pointAt(t,e,i,a,u),v=Le.pointAt(i,a,o,s,u),p=Le.pointAt(f.x,f.y,h.x,h.y,u),d=Le.pointAt(h.x,h.y,v.x,v.y,u);return[[r,n,f.x,f.y,p.x,p.y,l,c],[l,c,d.x,d.y,v.x,v.y,o,s]]}function ih(r,n,t,e,i,a,o,s,u){if(u===0)return RL([r,t,i,o],[n,e,a,s]);var l=RE(r,n,t,e,i,a,o,s,.5),c=l[0],f=l[1];return c.push(u-1),f.push(u-1),ih.apply(null,c)+ih.apply(null,f)}const Zo={extrema:$c,box:function(r,n,t,e,i,a,o,s){for(var u=[r,o],l=[n,s],c=$c(r,t,i,o),f=$c(n,e,a,s),h=0;h<c.length;h++)u.push(qn(r,t,i,o,c[h]));for(var h=0;h<f.length;h++)l.push(qn(n,e,a,s,f[h]));return uo(u,l)},length:function(r,n,t,e,i,a,o,s){return ih(r,n,t,e,i,a,o,s,3)},nearestPoint:function(r,n,t,e,i,a,o,s,u,l,c){return FE([r,t,i,o],[n,e,a,s],u,l,qn,c)},pointDistance:function(r,n,t,e,i,a,o,s,u,l,c){var f=this.nearestPoint(r,n,t,e,i,a,o,s,u,l,c);return Ue(f.x,f.y,u,l)},interpolationAt:qn,pointAt:function(r,n,t,e,i,a,o,s,u){return{x:qn(r,t,i,o,u),y:qn(n,e,a,s,u)}},divide:function(r,n,t,e,i,a,o,s,u){return RE(r,n,t,e,i,a,o,s,u)},tangentAngle:function(r,n,t,e,i,a,o,s,u){var l=ag(r,t,i,o,u),c=ag(n,e,a,s,u);return Vl(Math.atan2(c,l))}};function og(r,n){var t=Math.abs(r);return n>0?t:t*-1}const IL={box:function(r,n,t,e){return{x:r-t,y:n-e,width:t*2,height:e*2}},length:function(r,n,t,e){return Math.PI*(3*(t+e)-Math.sqrt((3*t+e)*(t+3*e)))},nearestPoint:function(r,n,t,e,i,a){var o=t,s=e;if(o===0||s===0)return{x:r,y:n};for(var u=i-r,l=a-n,c=Math.abs(u),f=Math.abs(l),h=o*o,v=s*s,p=Math.PI/4,d,g,y=0;y<4;y++){d=o*Math.cos(p),g=s*Math.sin(p);var m=(h-v)*Math.pow(Math.cos(p),3)/o,x=(v-h)*Math.pow(Math.sin(p),3)/s,_=d-m,E=g-x,b=c-m,M=f-x,T=Math.hypot(E,_),k=Math.hypot(M,b),L=T*Math.asin((_*M-E*b)/(T*k)),O=L/Math.sqrt(h+v-d*d-g*g);p+=O,p=Math.min(Math.PI/2,Math.max(0,p))}return{x:r+og(d,u),y:n+og(g,l)}},pointDistance:function(r,n,t,e,i,a){var o=this.nearestPoint(r,n,t,e,i,a);return Ue(o.x,o.y,i,a)},pointAt:function(r,n,t,e,i){var a=2*Math.PI*i;return{x:r+t*Math.cos(a),y:n+e*Math.sin(a)}},tangentAngle:function(r,n,t,e,i){var a=2*Math.PI*i,o=Math.atan2(e*Math.cos(a),-t*Math.sin(a));return Vl(o)}};function DL(r,n,t,e,i,a,o,s){return-1*t*Math.cos(i)*Math.sin(s)-e*Math.sin(i)*Math.cos(s)}function PL(r,n,t,e,i,a,o,s){return-1*t*Math.sin(i)*Math.sin(s)+e*Math.cos(i)*Math.cos(s)}function BL(r,n,t){return Math.atan(-n/r*Math.tan(t))}function NL(r,n,t){return Math.atan(n/(r*Math.tan(t)))}function sg(r,n,t,e,i,a){return t*Math.cos(i)*Math.cos(a)-e*Math.sin(i)*Math.sin(a)+r}function ug(r,n,t,e,i,a){return t*Math.sin(i)*Math.cos(a)+e*Math.cos(i)*Math.sin(a)+n}function zL(r,n,t,e){var i=Math.atan2(e*r,t*n);return(i+Math.PI*2)%(Math.PI*2)}function lg(r,n,t){return{x:r*Math.cos(t),y:n*Math.sin(t)}}function cg(r,n,t){var e=Math.cos(t),i=Math.sin(t);return[r*e-n*i,r*i+n*e]}const UL={box:function(r,n,t,e,i,a,o){for(var s=BL(t,e,i),u=1/0,l=-1/0,c=[a,o],f=-Math.PI*2;f<=Math.PI*2;f+=Math.PI){var h=s+f;a<o?a<h&&h<o&&c.push(h):o<h&&h<a&&c.push(h)}for(var f=0;f<c.length;f++){var v=sg(r,n,t,e,i,c[f]);v<u&&(u=v),v>l&&(l=v)}for(var p=NL(t,e,i),d=1/0,g=-1/0,y=[a,o],f=-Math.PI*2;f<=Math.PI*2;f+=Math.PI){var m=p+f;a<o?a<m&&m<o&&y.push(m):o<m&&m<a&&y.push(m)}for(var f=0;f<y.length;f++){var x=ug(r,n,t,e,i,y[f]);x<d&&(d=x),x>g&&(g=x)}return{x:u,y:d,width:l-u,height:g-d}},length:function(r,n,t,e,i,a,o){},nearestPoint:function(r,n,t,e,i,a,o,s,u){var l=cg(s-r,u-n,-i),c=l[0],f=l[1],h=IL.nearestPoint(0,0,t,e,c,f),v=zL(t,e,h.x,h.y);v<a?h=lg(t,e,a):v>o&&(h=lg(t,e,o));var p=cg(h.x,h.y,i);return{x:p[0]+r,y:p[1]+n}},pointDistance:function(r,n,t,e,i,a,o,s,u){var l=this.nearestPoint(r,n,t,e,s,u);return Ue(l.x,l.y,s,u)},pointAt:function(r,n,t,e,i,a,o,s){var u=(o-a)*s+a;return{x:sg(r,n,t,e,i,u),y:ug(r,n,t,e,i,u)}},tangentAngle:function(r,n,t,e,i,a,o,s){var u=(o-a)*s+a,l=DL(r,n,t,e,i,a,o,u),c=PL(r,n,t,e,i,a,o,u);return Vl(Math.atan2(c,l))}};function IE(r){for(var n=0,t=[],e=0;e<r.length-1;e++){var i=r[e],a=r[e+1],o=Ue(i[0],i[1],a[0],a[1]),s={from:i,to:a,length:o};t.push(s),n+=o}return{segments:t,totalLength:n}}function HL(r){if(r.length<2)return 0;for(var n=0,t=0;t<r.length-1;t++){var e=r[t],i=r[t+1];n+=Ue(e[0],e[1],i[0],i[1])}return n}function $L(r,n){if(n>1||n<0||r.length<2)return null;var t=IE(r),e=t.segments,i=t.totalLength;if(i===0)return{x:r[0][0],y:r[0][1]};for(var a=0,o=null,s=0;s<e.length;s++){var u=e[s],l=u.from,c=u.to,f=u.length/i;if(n>=a&&n<=a+f){var h=(n-a)/f;o=Le.pointAt(l[0],l[1],c[0],c[1],h);break}a+=f}return o}function GL(r,n){if(n>1||n<0||r.length<2)return 0;for(var t=IE(r),e=t.segments,i=t.totalLength,a=0,o=0,s=0;s<e.length;s++){var u=e[s],l=u.from,c=u.to,f=u.length/i;if(n>=a&&n<=a+f){o=Math.atan2(c[1]-l[1],c[0]-l[0]);break}a+=f}return o}function VL(r,n,t){for(var e=1/0,i=0;i<r.length-1;i++){var a=r[i],o=r[i+1],s=Le.pointDistance(a[0],a[1],o[0],o[1],n,t);s<e&&(e=s)}return e}const DE={box:function(r){for(var n=[],t=[],e=0;e<r.length;e++){var i=r[e];n.push(i[0]),t.push(i[1])}return uo(n,t)},length:function(r){return HL(r)},pointAt:function(r,n){return $L(r,n)},pointDistance:function(r,n,t){return VL(r,n,t)},tangentAngle:function(r,n){return GL(r,n)}};function fg(r,n){return!r||!n?r||n:{minX:Math.min(r.minX,n.minX),minY:Math.min(r.minY,n.minY),maxX:Math.max(r.maxX,n.maxX),maxY:Math.max(r.maxY,n.maxY)}}function Ov(r,n){var t=r.get("startArrowShape"),e=r.get("endArrowShape"),i=null,a=null;return t&&(i=t.getCanvasBBox(),n=fg(n,i)),e&&(a=e.getCanvasBBox(),n=fg(n,a)),n}function WL(r){for(var n=r.attr(),t=n.points,e=[],i=[],a=0;a<t.length;a++){var o=t[a];e.push(o[0]),i.push(o[1])}var s=uo(e,i),u=s.x,l=s.y,c=s.width,f=s.height,h={minX:u,minY:l,maxX:u+c,maxY:l+f};return h=Ov(r,h),{x:h.minX,y:h.minY,width:h.maxX-h.minX,height:h.maxY-h.minY}}function jL(r){for(var n=r.attr(),t=n.points,e=[],i=[],a=0;a<t.length;a++){var o=t[a];e.push(o[0]),i.push(o[1])}return uo(e,i)}var Gc=null;function Wl(){if(!Gc){var r=document.createElement("canvas");r.width=1,r.height=1,Gc=r.getContext("2d")}return Gc}function jl(r,n,t){var e=1;if(lt(r)&&(e=r.split(`
`).length),e>1){var i=XL(n,t);return n*e+i*(e-1)}return n}function XL(r,n){return n?n-r:r*.14}function YL(r,n){var t=Wl(),e=0;if(G(r)||r==="")return e;if(t.save(),t.font=n,lt(r)&&r.includes(`
`)){var i=r.split(`
`);w(i,function(a){var o=t.measureText(a).width;e<o&&(e=o)})}else e=t.measureText(r).width;return t.restore(),e}function Xl(r){var n=r.fontSize,t=r.fontFamily,e=r.fontWeight,i=r.fontStyle,a=r.fontVariant;return[i,a,e,n+"px",t].join(" ").trim()}function ZL(r){var n=r.attr(),t=n.x,e=n.y,i=n.text,a=n.fontSize,o=n.lineHeight,s=n.font;s||(s=Xl(n));var u=YL(i,s),l;if(!u)l={x:t,y:e,width:0,height:0};else{var c=n.textAlign,f=n.textBaseline,h=jl(i,a,o),v={x:t,y:e-h};c&&(c==="end"||c==="right"?v.x-=u:c==="center"&&(v.x-=u/2)),f&&(f==="top"?v.y+=h:f==="middle"&&(v.y+=h/2)),l={x:v.x,y:v.y,width:u,height:h}}return l}var qL=/[MLHVQTCSAZ]([^MLHVQTCSAZ]*)/ig,KL=/[^\s\,]+/ig;function QL(r){var n=r||[];if(V(n))return n;if(lt(n))return n=n.match(qL),w(n,function(t,e){if(t=t.match(KL),t[0].length>1){var i=t[0].charAt(0);t.splice(1,0,t[0].substr(1)),t[0]=i}w(t,function(a,o){isNaN(a)||(t[o]=+a)}),n[e]=t}),n}function JL(r,n,t,e){var i=[],a=!!e,o,s,u,l,c,f,h;if(a){u=e[0],l=e[1];for(var v=0,p=r.length;v<p;v+=1){var d=r[v];u=Ae([0,0],u,d),l=Te([0,0],l,d)}}for(var v=0,g=r.length;v<g;v+=1){var d=r[v];if(v===0&&!t)h=d;else if(v===g-1&&!t)f=d,i.push(h),i.push(f);else{var y=[v?v-1:g-1,v-1][t?0:1];o=r[y],s=r[t?(v+1)%g:v+1];var m=[0,0];m=vr(m,s,o),m=Ge(m,m,n);var x=Xa(d,o),_=Xa(d,s),E=x+_;E!==0&&(x/=E,_/=E);var b=Ge([0,0],m,-x),M=Ge([0,0],m,_);f=Zt([0,0],d,b),c=Zt([0,0],d,M),c=Ae([0,0],c,Te([0,0],s,d)),c=Te([0,0],c,Ae([0,0],s,d)),b=vr([0,0],c,d),b=Ge([0,0],b,-x/_),f=Zt([0,0],d,b),f=Ae([0,0],f,Te([0,0],o,d)),f=Te([0,0],f,Ae([0,0],o,d)),M=vr([0,0],d,f),M=Ge([0,0],M,_/x),c=Zt([0,0],d,M),a&&(f=Te([0,0],f,u),f=Ae([0,0],f,l),c=Te([0,0],c,u),c=Ae([0,0],c,l)),i.push(h),i.push(f),h=c}}return t&&i.push(i.shift()),i}function tF(r,n,t){n===void 0&&(n=!1),t===void 0&&(t=[[0,0],[1,1]]);for(var e=!!n,i=[],a=0,o=r.length;a<o;a+=2)i.push([r[a],r[a+1]]);for(var s=JL(i,.4,e,t),u=i.length,l=[],c,f,h,a=0;a<u-1;a+=1)c=s[a*2],f=s[a*2+1],h=i[a+1],l.push(["C",c[0],c[1],f[0],f[1],h[0],h[1]]);return e&&(c=s[u],f=s[u+1],h=i[0],l.push(["C",c[0],c[1],f[0],f[1],h[0],h[1]])),l}var qo=`	
\v\f\r \xA0\u1680\u180E\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029`,eF=new RegExp("([a-z])["+qo+",]*((-?\\d*\\.?\\d*(?:e[\\-+]?\\d+)?["+qo+"]*,?["+qo+"]*)+)","ig"),rF=new RegExp("(-?\\d*\\.?\\d*(?:e[\\-+]?\\d+)?)["+qo+"]*,?["+qo+"]*","ig");function Rv(r){if(!r)return null;if(V(r))return r;var n={a:7,c:6,o:2,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,u:3,z:0},t=[];return String(r).replace(eF,function(e,i,a){var o=[],s=i.toLowerCase();if(a.replace(rF,function(u,l){l&&o.push(+l)}),s==="m"&&o.length>2&&(t.push([i].concat(o.splice(0,2))),s="l",i=i==="m"?"l":"L"),s==="o"&&o.length===1&&t.push([i,o[0]]),s==="r")t.push([i].concat(o));else for(;o.length>=n[s]&&(t.push([i].concat(o.splice(0,n[s]))),!!n[s]););return""}),t}var nF=/[a-z]/;function hg(r,n){return[n[0]+(n[0]-r[0]),n[1]+(n[1]-r[1])]}function PE(r){var n=Rv(r);if(!n||!n.length)return[["M",0,0]];for(var t=!1,e=0;e<n.length;e++){var i=n[e][0];if(nF.test(i)||["V","H","T","S"].indexOf(i)>=0){t=!0;break}}if(!t)return n;var a=[],o=0,s=0,u=0,l=0,c=0,f=n[0];(f[0]==="M"||f[0]==="m")&&(o=+f[1],s=+f[2],u=o,l=s,c++,a[0]=["M",o,s]);for(var e=c,h=n.length;e<h;e++){var v=n[e],p=a[e-1],d=[],i=v[0],g=i.toUpperCase();if(i!==g)switch(d[0]=g,g){case"A":d[1]=v[1],d[2]=v[2],d[3]=v[3],d[4]=v[4],d[5]=v[5],d[6]=+v[6]+o,d[7]=+v[7]+s;break;case"V":d[1]=+v[1]+s;break;case"H":d[1]=+v[1]+o;break;case"M":u=+v[1]+o,l=+v[2]+s,d[1]=u,d[2]=l;break;default:for(var y=1,m=v.length;y<m;y++)d[y]=+v[y]+(y%2?o:s)}else d=n[e];switch(g){case"Z":o=+u,s=+l;break;case"H":o=d[1],d=["L",o,s];break;case"V":s=d[1],d=["L",o,s];break;case"T":o=d[1],s=d[2];var x=hg([p[1],p[2]],[p[3],p[4]]);d=["Q",x[0],x[1],o,s];break;case"S":o=d[d.length-2],s=d[d.length-1];var _=p.length,E=hg([p[_-4],p[_-3]],[p[_-2],p[_-1]]);d=["C",E[0],E[1],d[1],d[2],o,s];break;case"M":u=d[d.length-2],l=d[d.length-1];break;default:o=d[d.length-2],s=d[d.length-1]}a.push(d)}return a}function iu(r){return Math.sqrt(r[0]*r[0]+r[1]*r[1])}function ah(r,n){return iu(r)*iu(n)?(r[0]*n[0]+r[1]*n[1])/(iu(r)*iu(n)):1}function vg(r,n){return(r[0]*n[1]<r[1]*n[0]?-1:1)*Math.acos(ah(r,n))}function oh(r,n){return r[0]===n[0]&&r[1]===n[1]}function iF(r,n){var t=n[1],e=n[2],i=Av(Tv(n[3]),Math.PI*2),a=n[4],o=n[5],s=r[0],u=r[1],l=n[6],c=n[7],f=Math.cos(i)*(s-l)/2+Math.sin(i)*(u-c)/2,h=-1*Math.sin(i)*(s-l)/2+Math.cos(i)*(u-c)/2,v=f*f/(t*t)+h*h/(e*e);v>1&&(t*=Math.sqrt(v),e*=Math.sqrt(v));var p=t*t*(h*h)+e*e*(f*f),d=p?Math.sqrt((t*t*(e*e)-p)/p):1;a===o&&(d*=-1),isNaN(d)&&(d=0);var g=e?d*t*h/e:0,y=t?d*-e*f/t:0,m=(s+l)/2+Math.cos(i)*g-Math.sin(i)*y,x=(u+c)/2+Math.sin(i)*g+Math.cos(i)*y,_=[(f-g)/t,(h-y)/e],E=[(-1*f-g)/t,(-1*h-y)/e],b=vg([1,0],_),M=vg(_,E);return ah(_,E)<=-1&&(M=Math.PI),ah(_,E)>=1&&(M=0),o===0&&M>0&&(M=M-2*Math.PI),o===1&&M<0&&(M=M+2*Math.PI),{cx:m,cy:x,rx:oh(r,[l,c])?0:t,ry:oh(r,[l,c])?0:e,startAngle:b,endAngle:b+M,xRotation:i,arcFlag:a,sweepFlag:o}}function pg(r,n){return[n[0]+(n[0]-r[0]),n[1]+(n[1]-r[1])]}function BE(r){r=QL(r);for(var n=[],t=null,e=null,i=null,a=0,o=r.length,s=0;s<o;s++){var u=r[s];e=r[s+1];var l=u[0],c={command:l,prePoint:t,params:u,startTangent:null,endTangent:null};switch(l){case"M":i=[u[1],u[2]],a=s;break;case"A":var f=iF(t,u);c.arcParams=f;break}if(l==="Z")t=i,e=r[a+1];else{var h=u.length;t=[u[h-2],u[h-1]]}e&&e[0]==="Z"&&(e=r[a],n[a]&&(n[a].prePoint=t)),c.currentPoint=t,n[a]&&oh(t,n[a].currentPoint)&&(n[a].prePoint=c.prePoint);var v=e?[e[e.length-2],e[e.length-1]]:null;c.nextPoint=v;var p=c.prePoint;if(["L","H","V"].includes(l))c.startTangent=[p[0]-t[0],p[1]-t[1]],c.endTangent=[t[0]-p[0],t[1]-p[1]];else if(l==="Q"){var d=[u[1],u[2]];c.startTangent=[p[0]-d[0],p[1]-d[1]],c.endTangent=[t[0]-d[0],t[1]-d[1]]}else if(l==="T"){var g=n[s-1],d=pg(g.currentPoint,p);g.command==="Q"?(c.command="Q",c.startTangent=[p[0]-d[0],p[1]-d[1]],c.endTangent=[t[0]-d[0],t[1]-d[1]]):(c.command="TL",c.startTangent=[p[0]-t[0],p[1]-t[1]],c.endTangent=[t[0]-p[0],t[1]-p[1]])}else if(l==="C"){var y=[u[1],u[2]],m=[u[3],u[4]];c.startTangent=[p[0]-y[0],p[1]-y[1]],c.endTangent=[t[0]-m[0],t[1]-m[1]],c.startTangent[0]===0&&c.startTangent[1]===0&&(c.startTangent=[y[0]-m[0],y[1]-m[1]]),c.endTangent[0]===0&&c.endTangent[1]===0&&(c.endTangent=[m[0]-y[0],m[1]-y[1]])}else if(l==="S"){var g=n[s-1],y=pg(g.currentPoint,p),m=[u[1],u[2]];g.command==="C"?(c.command="C",c.startTangent=[p[0]-y[0],p[1]-y[1]],c.endTangent=[t[0]-m[0],t[1]-m[1]]):(c.command="SQ",c.startTangent=[p[0]-m[0],p[1]-m[1]],c.endTangent=[t[0]-m[0],t[1]-m[1]])}else if(l==="A"){var x=.001,_=c.arcParams||{},E=_.cx,b=E===void 0?0:E,M=_.cy,T=M===void 0?0:M,k=_.rx,L=k===void 0?0:k,O=_.ry,D=O===void 0?0:O,W=_.sweepFlag,j=W===void 0?0:W,ot=_.startAngle,z=ot===void 0?0:ot,X=_.endAngle,K=X===void 0?0:X;j===0&&(x*=-1);var Q=L*Math.cos(z-x)+b,q=D*Math.sin(z-x)+T;c.startTangent=[Q-i[0],q-i[1]];var at=L*Math.cos(z+K+x)+b,pt=D*Math.sin(z+K-x)+T;c.endTangent=[p[0]-at,p[1]-pt]}n.push(c)}return n}var dg=function(r,n,t){return r>=n&&r<=t};function aF(r,n,t,e){var i=.001,a={x:t.x-r.x,y:t.y-r.y},o={x:n.x-r.x,y:n.y-r.y},s={x:e.x-t.x,y:e.y-t.y},u=o.x*s.y-o.y*s.x,l=u*u,c=o.x*o.x+o.y*o.y,f=s.x*s.x+s.y*s.y,h=null;if(l>i*c*f){var v=(a.x*s.y-a.y*s.x)/u,p=(a.x*o.y-a.y*o.x)/u;dg(v,0,1)&&dg(p,0,1)&&(h={x:r.x+v*o.x,y:r.y+v*o.y})}return h}var oF=1e-6;function Vc(r){return Math.abs(r)<oF?0:r<0?-1:1}function sF(r,n,t){return(t[0]-r[0])*(n[1]-r[1])===(n[0]-r[0])*(t[1]-r[1])&&Math.min(r[0],n[0])<=t[0]&&t[0]<=Math.max(r[0],n[0])&&Math.min(r[1],n[1])<=t[1]&&t[1]<=Math.max(r[1],n[1])}function gg(r,n,t){var e=!1,i=r.length;if(i<=2)return!1;for(var a=0;a<i;a++){var o=r[a],s=r[(a+1)%i];if(sF(o,s,[n,t]))return!0;Vc(o[1]-t)>0!=Vc(s[1]-t)>0&&Vc(n-(t-o[1])*(o[0]-s[0])/(o[1]-s[1])-o[0])<0&&(e=!e)}return e}function yg(r){for(var n=[],t=r.length,e=0;e<t-1;e++){var i=r[e],a=r[e+1];n.push({from:{x:i[0],y:i[1]},to:{x:a[0],y:a[1]}})}if(n.length>1){var o=r[0],s=r[t-1];n.push({from:{x:s[0],y:s[1]},to:{x:o[0],y:o[1]}})}return n}function uF(r,n){var t=!1;return w(r,function(e){if(aF(e.from,e.to,n.from,n.to))return t=!0,!1}),t}function mg(r){var n=r.map(function(e){return e[0]}),t=r.map(function(e){return e[1]});return{minX:Math.min.apply(null,n),maxX:Math.max.apply(null,n),minY:Math.min.apply(null,t),maxY:Math.max.apply(null,t)}}function lF(r,n){return!(n.minX>r.maxX||n.maxX<r.minX||n.minY>r.maxY||n.maxY<r.minY)}function cF(r,n){if(r.length<2||n.length<2)return!1;var t=mg(r),e=mg(n);if(!lF(t,e))return!1;var i=!1;if(w(n,function(u){if(gg(r,u[0],u[1]))return i=!0,!1}),i||(w(r,function(u){if(gg(n,u[0],u[1]))return i=!0,!1}),i))return!0;var a=yg(r),o=yg(n),s=!1;return w(o,function(u){if(uF(a,u))return s=!0,!1}),s}function fF(r,n){for(var t=[],e=[],i=[],a=0;a<r.length;a++){var o=r[a],s=o.currentPoint,u=o.params,l=o.prePoint,c=void 0;switch(o.command){case"Q":c=OE.box(l[0],l[1],u[1],u[2],u[3],u[4]);break;case"C":c=Zo.box(l[0],l[1],u[1],u[2],u[3],u[4],u[5],u[6]);break;case"A":var f=o.arcParams;c=UL.box(f.cx,f.cy,f.rx,f.ry,f.xRotation,f.startAngle,f.endAngle);break;default:t.push(s[0]),e.push(s[1]);break}c&&(o.box=c,t.push(c.x,c.x+c.width),e.push(c.y,c.y+c.height)),n&&(o.command==="L"||o.command==="M")&&o.prePoint&&o.nextPoint&&i.push(o)}t=t.filter(function(y){return!Number.isNaN(y)&&y!==1/0&&y!==-1/0}),e=e.filter(function(y){return!Number.isNaN(y)&&y!==1/0&&y!==-1/0});var h=er(t),v=er(e),p=We(t),d=We(e);if(i.length===0)return{x:h,y:v,width:p-h,height:d-v};for(var a=0;a<i.length;a++){var o=i[a],s=o.currentPoint,g=void 0;s[0]===h?(g=au(o,n),h=h-g.xExtra):s[0]===p&&(g=au(o,n),p=p+g.xExtra),s[1]===v?(g=au(o,n),v=v-g.yExtra):s[1]===d&&(g=au(o,n),d=d+g.yExtra)}return{x:h,y:v,width:p-h,height:d-v}}function au(r,n){var t=r.prePoint,e=r.currentPoint,i=r.nextPoint,a=Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2),o=Math.pow(e[0]-i[0],2)+Math.pow(e[1]-i[1],2),s=Math.pow(t[0]-i[0],2)+Math.pow(t[1]-i[1],2),u=Math.acos((a+o-s)/(2*Math.sqrt(a)*Math.sqrt(o)));if(!u||Math.sin(u)===0||we(u,0))return{xExtra:0,yExtra:0};var l=Math.abs(Math.atan2(i[1]-e[1],i[0]-e[0])),c=Math.abs(Math.atan2(i[0]-e[0],i[1]-e[1]));l=l>Math.PI/2?Math.PI-l:l,c=c>Math.PI/2?Math.PI-c:c;var f={xExtra:Math.cos(u/2-l)*(n/2*(1/Math.sin(u/2)))-n/2||0,yExtra:Math.cos(c-u/2)*(n/2*(1/Math.sin(u/2)))-n/2||0};return f}function hF(r){var n=r.attr(),t=n.path,e=n.stroke,i=e?n.lineWidth:0,a=r.get("segments")||BE(t),o=fF(a,i),s=o.x,u=o.y,l=o.width,c=o.height,f={minX:s,minY:u,maxX:s+l,maxY:u+c};return f=Ov(r,f),{x:f.minX,y:f.minY,width:f.maxX-f.minX,height:f.maxY-f.minY}}function vF(r){var n=r.attr(),t=n.x1,e=n.y1,i=n.x2,a=n.y2,o=Math.min(t,i),s=Math.max(t,i),u=Math.min(e,a),l=Math.max(e,a),c={minX:o,maxX:s,minY:u,maxY:l};return c=Ov(r,c),{x:c.minX,y:c.minY,width:c.maxX-c.minX,height:c.maxY-c.minY}}function pF(r){var n=r.attr(),t=n.x,e=n.y,i=n.rx,a=n.ry;return{x:t-i,y:e-a,width:i*2,height:a*2}}Dr("rect",wE);Dr("image",wE);Dr("circle",LE);Dr("marker",LE);Dr("polyline",WL);Dr("polygon",jL);Dr("text",ZL);Dr("path",hF);Dr("line",vF);Dr("ellipse",pF);var xg=0,dF=1/2,gF=1/2,yF=.05,Yl=function(){function r(n){var t=n.xField,e=n.yField,i=n.adjustNames,a=i===void 0?["x","y"]:i,o=n.dimValuesMap;this.adjustNames=a,this.xField=t,this.yField=e,this.dimValuesMap=o}return r.prototype.isAdjust=function(n){return this.adjustNames.indexOf(n)>=0},r.prototype.getAdjustRange=function(n,t,e){var i=this.yField,a=e.indexOf(t),o=e.length,s,u;return!i&&this.isAdjust("y")?(s=0,u=1):o>1?(s=e[a===0?0:a-1],u=e[a===o-1?o-1:a+1],a!==0?s+=(t-s)/2:s-=(u-t)/2,a!==o-1?u-=(u-t)/2:u+=(t-e[o-2])/2):(s=t===0?0:t-.5,u=t===0?1:t+.5),{pre:s,next:u}},r.prototype.adjustData=function(n,t){var e=this,i=this.getDimValues(t);w(n,function(a,o){w(i,function(s,u){e.adjustDim(u,s,a,o)})})},r.prototype.groupData=function(n,t){return w(n,function(e){e[t]===void 0&&(e[t]=xg)}),dr(n,t)},r.prototype.adjustDim=function(n,t,e,i){},r.prototype.getDimValues=function(n){var t=this,e=t.xField,i=t.yField,a=zt({},this.dimValuesMap),o=[];if(e&&this.isAdjust("x")&&o.push(e),i&&this.isAdjust("y")&&o.push(i),o.forEach(function(u){a&&a[u]||(a[u]=Yr(n,u).sort(function(l,c){return l-c}))}),!i&&this.isAdjust("y")){var s="y";a[s]=[xg,1]}return a},r}(),NE={},zE=function(r){return NE[r.toLowerCase()]},Zl=function(r,n){if(zE(r))throw new Error("Adjust type '"+r+"' existed.");NE[r.toLowerCase()]=n};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var sh=function(r,n){return sh=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},sh(r,n)};function ql(r,n){sh(r,n);function t(){this.constructor=r}r.prototype=n===null?Object.create(n):(t.prototype=n.prototype,new t)}var ln=function(){return ln=Object.assign||function(n){for(var t,e=1,i=arguments.length;e<i;e++){t=arguments[e];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(n[a]=t[a])}return n},ln.apply(this,arguments)},mF=function(r){ql(n,r);function n(t){var e=r.call(this,t)||this;e.cacheMap={},e.adjustDataArray=[],e.mergeData=[];var i=t.marginRatio,a=i===void 0?dF:i,o=t.dodgeRatio,s=o===void 0?gF:o,u=t.dodgeBy,l=t.intervalPadding,c=t.dodgePadding,f=t.xDimensionLength,h=t.groupNum,v=t.defaultSize,p=t.maxColumnWidth,d=t.minColumnWidth,g=t.columnWidthRatio,y=t.customOffset;return e.marginRatio=a,e.dodgeRatio=s,e.dodgeBy=u,e.intervalPadding=l,e.dodgePadding=c,e.xDimensionLegenth=f,e.groupNum=h,e.defaultSize=v,e.maxColumnWidth=p,e.minColumnWidth=d,e.columnWidthRatio=g,e.customOffset=y,e}return n.prototype.process=function(t){var e=Ve(t),i=yr(e),a=this.dodgeBy,o=a?_w(i,a):e;return this.cacheMap={},this.adjustDataArray=o,this.mergeData=i,this.adjustData(o,i),this.adjustDataArray=[],this.mergeData=[],e},n.prototype.adjustDim=function(t,e,i,a){var o=this,s=this.customOffset,u=this.getDistribution(t),l=this.groupData(i,t);return w(l,function(c,f){var h;e.length===1?h={pre:e[0]-1,next:e[0]+1}:h=o.getAdjustRange(t,parseFloat(f),e),w(c,function(v){var p=v[t],d=u[p],g=d.indexOf(a);if(G(s))v[t]=o.getDodgeOffset(h,g,d.length);else{var y=h.pre,m=h.next;v[t]=rt(s)?s(v,h):(y+m)/2+s}})}),[]},n.prototype.getDodgeOffset=function(t,e,i){var a=this,o=a.dodgeRatio,s=a.marginRatio,u=a.intervalPadding,l=a.dodgePadding,c=t.pre,f=t.next,h=f-c,v;if(!G(u)&&G(l)&&u>=0){var p=this.getIntervalOnlyOffset(i,e);v=c+p}else if(!G(l)&&G(u)&&l>=0){var p=this.getDodgeOnlyOffset(i,e);v=c+p}else if(!G(u)&&!G(l)&&u>=0&&l>=0){var p=this.getIntervalAndDodgeOffset(i,e);v=c+p}else{var d=h*o/i,g=s*d,p=1/2*(h-i*d-(i-1)*g)+((e+1)*d+e*g)-1/2*d-1/2*h;v=(c+f)/2+p}return v},n.prototype.getIntervalOnlyOffset=function(t,e){var i=this,a=i.defaultSize,o=i.intervalPadding,s=i.xDimensionLegenth,u=i.groupNum,l=i.dodgeRatio,c=i.maxColumnWidth,f=i.minColumnWidth,h=i.columnWidthRatio,v=o/s,p=(1-(u-1)*v)/u*l/(t-1),d=((1-v*(u-1))/u-p*(t-1))/t;if(d=G(h)?d:1/u/t*h,!G(c)){var g=c/s;d=Math.min(d,g)}if(!G(f)){var y=f/s;d=Math.max(d,y)}d=a?a/s:d,p=((1-(u-1)*v)/u-t*d)/(t-1);var m=((1/2+e)*d+e*p+1/2*v)*u-v/2;return m},n.prototype.getDodgeOnlyOffset=function(t,e){var i=this,a=i.defaultSize,o=i.dodgePadding,s=i.xDimensionLegenth,u=i.groupNum,l=i.marginRatio,c=i.maxColumnWidth,f=i.minColumnWidth,h=i.columnWidthRatio,v=o/s,p=1*l/(u-1),d=((1-p*(u-1))/u-v*(t-1))/t;if(d=h?1/u/t*h:d,!G(c)){var g=c/s;d=Math.min(d,g)}if(!G(f)){var y=f/s;d=Math.max(d,y)}d=a?a/s:d,p=(1-(d*t+v*(t-1))*u)/(u-1);var m=((1/2+e)*d+e*v+1/2*p)*u-p/2;return m},n.prototype.getIntervalAndDodgeOffset=function(t,e){var i=this,a=i.intervalPadding,o=i.dodgePadding,s=i.xDimensionLegenth,u=i.groupNum,l=a/s,c=o/s,f=((1-l*(u-1))/u-c*(t-1))/t,h=((1/2+e)*f+e*c+1/2*l)*u-l/2;return h},n.prototype.getDistribution=function(t){var e=this.adjustDataArray,i=this.cacheMap,a=i[t];return a||(a={},w(e,function(o,s){var u=Yr(o,t);u.length||u.push(0),w(u,function(l){a[l]||(a[l]=[]),a[l].push(s)})}),i[t]=a),a},n}(Yl);function xF(r,n){return(n-r)*Math.random()+r}var _F=function(r){ql(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.process=function(t){var e=Ve(t),i=yr(e);return this.adjustData(e,i),e},n.prototype.adjustDim=function(t,e,i){var a=this,o=this.groupData(i,t);return w(o,function(s,u){return a.adjustGroup(s,t,parseFloat(u),e)})},n.prototype.getAdjustOffset=function(t){var e=t.pre,i=t.next,a=(i-e)*yF;return xF(e+a,i-a)},n.prototype.adjustGroup=function(t,e,i,a){var o=this,s=this.getAdjustRange(e,i,a);return w(t,function(u){u[e]=o.getAdjustOffset(s)}),t},n}(Yl),Wc=Nw,CF=function(r){ql(n,r);function n(t){var e=r.call(this,t)||this,i=t.adjustNames,a=i===void 0?["y"]:i,o=t.height,s=o===void 0?NaN:o,u=t.size,l=u===void 0?10:u,c=t.reverseOrder,f=c===void 0?!1:c;return e.adjustNames=a,e.height=s,e.size=l,e.reverseOrder=f,e}return n.prototype.process=function(t){var e=this,i=e.yField,a=e.reverseOrder,o=i?this.processStack(t):this.processOneDimStack(t);return a?this.reverse(o):o},n.prototype.reverse=function(t){return t.slice(0).reverse()},n.prototype.processStack=function(t){var e=this,i=e.xField,a=e.yField,o=e.reverseOrder,s=o?this.reverse(t):t,u=new Wc,l=new Wc;return s.map(function(c){return c.map(function(f){var h,v=F(f,i,0),p=F(f,[a]),d=v.toString();if(p=V(p)?p[1]:p,!G(p)){var g=p>=0?u:l;g.has(d)||g.set(d,0);var y=g.get(d),m=p+y;return g.set(d,m),ln(ln({},f),(h={},h[a]=[y,m],h))}return f})})},n.prototype.processOneDimStack=function(t){var e=this,i=this,a=i.xField,o=i.height,s=i.reverseOrder,u="y",l=s?this.reverse(t):t,c=new Wc;return l.map(function(f){return f.map(function(h){var v,p=e.size,d=h[a],g=p*2/o;c.has(d)||c.set(d,g/2);var y=c.get(d);return c.set(d,y+g),ln(ln({},h),(v={},v[u]=y,v))})})},n}(Yl),EF=function(r){ql(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.process=function(t){var e=yr(t),i=this,a=i.xField,o=i.yField,s=this.getXValuesMaxMap(e),u=Math.max.apply(Math,Object.keys(s).map(function(l){return s[l]}));return ie(t,function(l){return ie(l,function(c){var f,h,v=c[o],p=c[a];if(V(v)){var d=(u-s[p])/2;return ln(ln({},c),(f={},f[o]=ie(v,function(y){return d+y}),f))}var g=(u-v)/2;return ln(ln({},c),(h={},h[o]=[g,v+g],h))})})},n.prototype.getXValuesMaxMap=function(t){var e=this,i=this,a=i.xField,o=i.yField,s=dr(t,function(u){return u[a]});return Iw(s,function(u){return e.getDimMaxValue(u,o)})},n.prototype.getDimMaxValue=function(t,e){var i=ie(t,function(o){return F(o,e,[])}),a=yr(i);return Math.max.apply(Math,a)},n}(Yl);Zl("Dodge",mF);Zl("Jitter",_F);Zl("Stack",CF);Zl("Symmetric",EF);var _g=function(r,n){return lt(n)?n:r.invert(r.scale(n))},Ns=function(){function r(n){this.names=[],this.scales=[],this.linear=!1,this.values=[],this.callback=function(){return[]},this._parseCfg(n)}return r.prototype.mapping=function(){for(var n=this,t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=t.map(function(a,o){return n._toOriginParam(a,n.scales[o])});return this.callback.apply(this,i)},r.prototype.getLinearValue=function(n){var t=this.values.length-1,e=Math.floor(t*n),i=t*n-e,a=this.values[e],o=e===t?a:this.values[e+1];return a+(o-a)*i},r.prototype.getNames=function(){for(var n=this.scales,t=this.names,e=Math.min(n.length,t.length),i=[],a=0;a<e;a+=1)i.push(t[a]);return i},r.prototype.getFields=function(){return this.scales.map(function(n){return n.field})},r.prototype.getScale=function(n){return this.scales[this.names.indexOf(n)]},r.prototype.defaultCallback=function(){for(var n=this,t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return t.length===0?this.values:t.map(function(i,a){var o=n.scales[a];return o.type==="identity"?o.values[0]:n._getAttributeValue(o,i)})},r.prototype._parseCfg=function(n){var t=this,e=n.type,i=e===void 0?"base":e,a=n.names,o=a===void 0?[]:a,s=n.scales,u=s===void 0?[]:s,l=n.values,c=l===void 0?[]:l,f=n.callback;this.type=i,this.scales=u,this.values=c,this.names=o,this.callback=function(){for(var h=[],v=0;v<arguments.length;v++)h[v]=arguments[v];if(f){var p=f.apply(void 0,h);if(!G(p))return[p]}return t.defaultCallback.apply(t,h)}},r.prototype._getAttributeValue=function(n,t){if(n.isCategory&&!this.linear){var e=n.translate(t);return this.values[e%this.values.length]}var i=n.scale(t);return this.getLinearValue(i)},r.prototype._toOriginParam=function(n,t){return t.isLinear?n:V(n)?n.map(function(e){return _g(t,e)}):_g(t,n)},r}();/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var uh=function(r,n){return uh=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},uh(r,n)};function zs(r,n){uh(r,n);function t(){this.constructor=r}r.prototype=n===null?Object.create(n):(t.prototype=n.prototype,new t)}var SF=/rgba?\(([\s.,0-9]+)\)/,bF=/^l\s*\(\s*([\d.]+)\s*\)\s*(.*)/i,AF=/^r\s*\(\s*([\d.]+)\s*,\s*([\d.]+)\s*,\s*([\d.]+)\s*\)\s*(.*)/i,TF=/[\d.]+:(#[^\s]+|[^\)]+\))/gi,MF=function(r){return/^[r,R,L,l]{1}[\s]*\(/.test(r)},wF=function(){var r=document.createElement("i");return r.title="Web Colour Picker",r.style.display="none",document.body.appendChild(r),r},jc=function(r,n,t,e){return r[e]+(n[e]-r[e])*t};function UE(r){return"#"+Xc(r[0])+Xc(r[1])+Xc(r[2])}var HE=function(r){return[parseInt(r.substr(1,2),16),parseInt(r.substr(3,2),16),parseInt(r.substr(5,2),16)]},Xc=function(r){var n=Math.round(r).toString(16);return n.length===1?"0"+n:n},LF=function(r,n){var t=isNaN(Number(n))||n<0?0:n>1?1:Number(n),e=r.length-1,i=Math.floor(e*t),a=e*t-i,o=r[i],s=i===e?o:r[i+1];return UE([jc(o,s,a,0),jc(o,s,a,1),jc(o,s,a,2)])},ou,$E=function(r){if(r[0]==="#"&&r.length===7)return r;ou||(ou=wF()),ou.style.color=r;var n=document.defaultView.getComputedStyle(ou,"").getPropertyValue("color"),t=SF.exec(n),e=t[1].split(/\s*,\s*/).map(function(i){return Number(i)});return n=UE(e),n},FF=function(r){var n=lt(r)?r.split("-"):r,t=ie(n,function(e){return HE(e.indexOf("#")===-1?$E(e):e)});return function(e){return LF(t,e)}},kF=function(r){if(MF(r)){var n,t=void 0;if(r[0]==="l"){var e=bF.exec(r),i=+e[1]+90;t=e[2],n="linear-gradient("+i+"deg, "}else if(r[0]==="r"){n="radial-gradient(";var e=AF.exec(r);t=e[4]}var a=t.match(TF);return w(a,function(o,s){var u=o.split(":");n+=u[1]+" "+u[0]*100+"%",s!==a.length-1&&(n+=", ")}),n+=")",n}return r};const ii={rgb2arr:HE,gradient:FF,toRGB:so($E),toCSSGradient:kF};var OF=function(r){zs(n,r);function n(t){var e=r.call(this,t)||this;return e.type="color",e.names=["color"],lt(e.values)&&(e.linear=!0),e.gradient=ii.gradient(e.values),e}return n.prototype.getLinearValue=function(t){return this.gradient(t)},n}(Ns),RF=function(r){zs(n,r);function n(t){var e=r.call(this,t)||this;return e.type="opacity",e.names=["opacity"],e}return n}(Ns),IF=function(r){zs(n,r);function n(t){var e=r.call(this,t)||this;return e.names=["x","y"],e.type="position",e}return n.prototype.mapping=function(t,e){var i=this.scales,a=i[0],o=i[1];return G(t)||G(e)?[]:[V(t)?t.map(function(s){return a.scale(s)}):a.scale(t),V(e)?e.map(function(s){return o.scale(s)}):o.scale(e)]},n}(Ns),DF=function(r){zs(n,r);function n(t){var e=r.call(this,t)||this;return e.type="shape",e.names=["shape"],e}return n.prototype.getLinearValue=function(t){var e=Math.round((this.values.length-1)*t);return this.values[e]},n}(Ns),PF=function(r){zs(n,r);function n(t){var e=r.call(this,t)||this;return e.type="size",e.names=["size"],e}return n}(Ns),GE={};function BF(r){return GE[r]}function gn(r,n){GE[r]=n}var Iv=function(){function r(n){this.type="base",this.isCategory=!1,this.isLinear=!1,this.isContinuous=!1,this.isIdentity=!1,this.values=[],this.range=[0,1],this.ticks=[],this.__cfg__=n,this.initCfg(),this.init()}return r.prototype.translate=function(n){return n},r.prototype.change=function(n){zt(this.__cfg__,n),this.init()},r.prototype.clone=function(){return this.constructor(this.__cfg__)},r.prototype.getTicks=function(){var n=this;return ie(this.ticks,function(t,e){return wt(t)?t:{text:n.getText(t,e),tickValue:t,value:n.scale(t)}})},r.prototype.getText=function(n,t){var e=this.formatter,i=e?e(n,t):n;return G(i)||!rt(i.toString)?"":i.toString()},r.prototype.getConfig=function(n){return this.__cfg__[n]},r.prototype.init=function(){zt(this,this.__cfg__),this.setDomain(),nr(this.getConfig("ticks"))&&(this.ticks=this.calculateTicks())},r.prototype.initCfg=function(){},r.prototype.setDomain=function(){},r.prototype.calculateTicks=function(){var n=this.tickMethod,t=[];if(lt(n)){var e=BF(n);if(!e)throw new Error("There is no method to to calculate ticks!");t=e(this)}else rt(n)&&(t=n(this));return t},r.prototype.rangeMin=function(){return this.range[0]},r.prototype.rangeMax=function(){return this.range[1]},r.prototype.calcPercent=function(n,t,e){return dt(n)?(n-t)/(e-t):NaN},r.prototype.calcValue=function(n,t,e){return t+n*(e-t)},r}(),Kl=function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.type="cat",t.isCategory=!0,t}return n.prototype.buildIndexMap=function(){if(!this.translateIndexMap){this.translateIndexMap=new Map;for(var t=0;t<this.values.length;t++)this.translateIndexMap.set(this.values[t],t)}},n.prototype.translate=function(t){this.buildIndexMap();var e=this.translateIndexMap.get(t);return e===void 0&&(e=dt(t)?t:NaN),e},n.prototype.scale=function(t){var e=this.translate(t),i=this.calcPercent(e,this.min,this.max);return this.calcValue(i,this.rangeMin(),this.rangeMax())},n.prototype.invert=function(t){var e=this.max-this.min,i=this.calcPercent(t,this.rangeMin(),this.rangeMax()),a=Math.round(e*i)+this.min;return a<this.min||a>this.max?NaN:this.values[a]},n.prototype.getText=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];var a=t;return dt(t)&&!this.values.includes(t)&&(a=this.values[a]),r.prototype.getText.apply(this,Yt([a],e))},n.prototype.initCfg=function(){this.tickMethod="cat"},n.prototype.setDomain=function(){if(G(this.getConfig("min"))&&(this.min=0),G(this.getConfig("max"))){var t=this.values.length;this.max=t>1?t-1:t}this.translateIndexMap&&(this.translateIndexMap=void 0)},n}(Iv);function NF(r){return function(n,t,e,i){for(var a=G(e)?0:e,o=G(i)?n.length:i;a<o;){var s=a+o>>>1;r(n[s])>t?o=s:a=s+1}return a}}var Cg="format";function VE(r,n){var t=gM[Cg]||yM[Cg];return t(r,n)}function al(r){return lt(r)&&(r.indexOf("T")>0?r=new Date(r).getTime():r=new Date(r.replace(/-/gi,"/")).getTime()),aE(r)&&(r=r.getTime()),r}var Vr=1e3,Yi=60*Vr,Zi=60*Yi,bn=24*Zi,Ko=bn*31,Eg=bn*365,So=[["HH:mm:ss",Vr],["HH:mm:ss",Vr*10],["HH:mm:ss",Vr*30],["HH:mm",Yi],["HH:mm",Yi*10],["HH:mm",Yi*30],["HH",Zi],["HH",Zi*6],["HH",Zi*12],["YYYY-MM-DD",bn],["YYYY-MM-DD",bn*4],["YYYY-WW",bn*7],["YYYY-MM",Ko],["YYYY-MM",Ko*4],["YYYY-MM",Ko*6],["YYYY",bn*380]];function zF(r,n,t){var e=(n-r)/t,i=NF(function(o){return o[1]})(So,e)-1,a=So[i];return i<0?a=So[0]:i>=So.length&&(a=pe(So)),a}var UF=function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.type="timeCat",t}return n.prototype.translate=function(t){t=al(t);var e=this.values.indexOf(t);return e===-1&&(dt(t)&&t<this.values.length?e=t:e=NaN),e},n.prototype.getText=function(t,e){var i=this.translate(t);if(i>-1){var a=this.values[i],o=this.formatter;return a=o?o(a,e):VE(a,this.mask),a}return t},n.prototype.initCfg=function(){this.tickMethod="time-cat",this.mask="YYYY-MM-DD",this.tickCount=7},n.prototype.setDomain=function(){var t=this.values;w(t,function(e,i){t[i]=al(e)}),t.sort(function(e,i){return e-i}),r.prototype.setDomain.call(this)},n}(Kl),Ql=function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.isContinuous=!0,t}return n.prototype.scale=function(t){if(G(t))return NaN;var e=this.rangeMin(),i=this.rangeMax(),a=this.max,o=this.min;if(a===o)return e;var s=this.getScalePercent(t);return e+s*(i-e)},n.prototype.init=function(){r.prototype.init.call(this);var t=this.ticks,e=pr(t),i=pe(t);e<this.min&&(this.min=e),i>this.max&&(this.max=i),G(this.minLimit)||(this.min=e),G(this.maxLimit)||(this.max=i)},n.prototype.setDomain=function(){var t=rE(this.values),e=t.min,i=t.max;G(this.min)&&(this.min=e),G(this.max)&&(this.max=i),this.min>this.max&&(this.min=e,this.max=i)},n.prototype.calculateTicks=function(){var t=this,e=r.prototype.calculateTicks.call(this);return this.nice||(e=Pe(e,function(i){return i>=t.min&&i<=t.max})),e},n.prototype.getScalePercent=function(t){var e=this.max,i=this.min;return(t-i)/(e-i)},n.prototype.getInvertPercent=function(t){return(t-this.rangeMin())/(this.rangeMax()-this.rangeMin())},n}(Iv),Jl=function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.type="linear",t.isLinear=!0,t}return n.prototype.invert=function(t){var e=this.getInvertPercent(t);return this.min+e*(this.max-this.min)},n.prototype.initCfg=function(){this.tickMethod="wilkinson-extended",this.nice=!1},n}(Ql);function Kn(r,n){var t=Math.E,e;return n>=0?e=Math.pow(t,Math.log(n)/r):e=Math.pow(t,Math.log(-n)/r)*-1,e}function Ar(r,n){return r===1?1:Math.log(n)/Math.log(r)}function WE(r,n,t){G(t)&&(t=Math.max.apply(null,r));var e=t;return w(r,function(i){i>0&&i<e&&(e=i)}),e===t&&(e=t/n),e>1&&(e=1),e}var HF=function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.type="log",t}return n.prototype.invert=function(t){var e=this.base,i=Ar(e,this.max),a=this.rangeMin(),o=this.rangeMax()-a,s,u=this.positiveMin;if(u){if(t===0)return 0;s=Ar(e,u/e);var l=1/(i-s)*o;if(t<l)return t/l*u}else s=Ar(e,this.min);var c=(t-a)/o,f=c*(i-s)+s;return Math.pow(e,f)},n.prototype.initCfg=function(){this.tickMethod="log",this.base=10,this.tickCount=6,this.nice=!0},n.prototype.setDomain=function(){r.prototype.setDomain.call(this);var t=this.min;if(t<0)throw new Error("When you use log scale, the minimum value must be greater than zero!");t===0&&(this.positiveMin=WE(this.values,this.base,this.max))},n.prototype.getScalePercent=function(t){var e=this.max,i=this.min;if(e===i||t<=0)return 0;var a=this.base,o=this.positiveMin;o&&(i=o*1/a);var s;return t<o?s=t/o/(Ar(a,e)-Ar(a,i)):s=(Ar(a,t)-Ar(a,i))/(Ar(a,e)-Ar(a,i)),s},n}(Ql),$F=function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.type="pow",t}return n.prototype.invert=function(t){var e=this.getInvertPercent(t),i=this.exponent,a=Kn(i,this.max),o=Kn(i,this.min),s=e*(a-o)+o,u=s>=0?1:-1;return Math.pow(s,i)*u},n.prototype.initCfg=function(){this.tickMethod="pow",this.exponent=2,this.tickCount=5,this.nice=!0},n.prototype.getScalePercent=function(t){var e=this.max,i=this.min;if(e===i)return 0;var a=this.exponent,o=(Kn(a,t)-Kn(a,i))/(Kn(a,e)-Kn(a,i));return o},n}(Ql),GF=function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.type="time",t}return n.prototype.getText=function(t,e){var i=this.translate(t),a=this.formatter;return a?a(i,e):VE(i,this.mask)},n.prototype.scale=function(t){var e=t;return(lt(e)||aE(e))&&(e=this.translate(e)),r.prototype.scale.call(this,e)},n.prototype.translate=function(t){return al(t)},n.prototype.initCfg=function(){this.tickMethod="time-pretty",this.mask="YYYY-MM-DD",this.tickCount=7,this.nice=!1},n.prototype.setDomain=function(){var t=this.values,e=this.getConfig("min"),i=this.getConfig("max");if((!G(e)||!dt(e))&&(this.min=this.translate(this.min)),(!G(i)||!dt(i))&&(this.max=this.translate(this.max)),t&&t.length){var a=[],o=1/0,s=o,u=0;w(t,function(l){var c=al(l);if(isNaN(c))throw new TypeError("Invalid Time: "+l+" in time scale!");o>c?(s=o,o=c):s>c&&(s=c),u<c&&(u=c),a.push(c)}),t.length>1&&(this.minTickInterval=s-o),G(e)&&(this.min=o),G(i)&&(this.max=u)}},n}(Jl),jE=function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.type="quantize",t}return n.prototype.invert=function(t){var e=this.ticks,i=e.length,a=this.getInvertPercent(t),o=Math.floor(a*(i-1));if(o>=i-1)return pe(e);if(o<0)return pr(e);var s=e[o],u=e[o+1],l=o/(i-1),c=(o+1)/(i-1);return s+(a-l)/(c-l)*(u-s)},n.prototype.initCfg=function(){this.tickMethod="r-pretty",this.tickCount=5,this.nice=!0},n.prototype.calculateTicks=function(){var t=r.prototype.calculateTicks.call(this);return this.nice||(pe(t)!==this.max&&t.push(this.max),pr(t)!==this.min&&t.unshift(this.min)),t},n.prototype.getScalePercent=function(t){var e=this.ticks;if(t<pr(e))return 0;if(t>pe(e))return 1;var i=0;return w(e,function(a,o){if(t>=a)i=o;else return!1}),i/(e.length-1)},n}(Ql),VF=function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.type="quantile",t}return n.prototype.initCfg=function(){this.tickMethod="quantile",this.tickCount=5,this.nice=!0},n}(jE),XE={};function lh(r){return XE[r]}function yn(r,n){if(lh(r))throw new Error("type '"+r+"' existed.");XE[r]=n}var WF=function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.type="identity",t.isIdentity=!0,t}return n.prototype.calculateTicks=function(){return this.values},n.prototype.scale=function(t){return this.values[0]!==t&&dt(t)?t:this.range[0]},n.prototype.invert=function(t){var e=this.range;return t<e[0]||t>e[1]?NaN:this.values[0]},n}(Iv);function YE(r){var n=r.values,t=r.tickInterval,e=r.tickCount,i=r.showLast;if(dt(t)){var a=Pe(n,function(p,d){return d%t===0}),o=pe(n);return i&&pe(a)!==o&&a.push(o),a}var s=n.length,u=r.min,l=r.max;if(G(u)&&(u=0),G(l)&&(l=n.length-1),!dt(e)||e>=s)return n.slice(u,l+1);if(e<=0||l<=0)return[];for(var c=e===1?s:Math.floor(s/(e-1)),f=[],h=u,v=0;v<e&&!(h>=l);v++)h=Math.min(u+v*c,l),v===e-1&&i?f.push(n[l]):f.push(n[h]);return f}function jF(r){var n=r.min,t=r.max,e=r.nice,i=r.tickCount,a=new XF;return a.domain([n,t]),e&&a.nice(i),a.ticks(i)}var Yc=5,Sg=Math.sqrt(50),bg=Math.sqrt(10),Ag=Math.sqrt(2),XF=function(){function r(){this._domain=[0,1]}return r.prototype.domain=function(n){return n?(this._domain=Array.from(n,Number),this):this._domain.slice()},r.prototype.nice=function(n){var t,e;n===void 0&&(n=Yc);var i=this._domain.slice(),a=0,o=this._domain.length-1,s=this._domain[a],u=this._domain[o],l;return u<s&&(t=[u,s],s=t[0],u=t[1],e=[o,a],a=e[0],o=e[1]),l=Vu(s,u,n),l>0?(s=Math.floor(s/l)*l,u=Math.ceil(u/l)*l,l=Vu(s,u,n)):l<0&&(s=Math.ceil(s*l)/l,u=Math.floor(u*l)/l,l=Vu(s,u,n)),l>0?(i[a]=Math.floor(s/l)*l,i[o]=Math.ceil(u/l)*l,this.domain(i)):l<0&&(i[a]=Math.ceil(s*l)/l,i[o]=Math.floor(u*l)/l,this.domain(i)),this},r.prototype.ticks=function(n){return n===void 0&&(n=Yc),YF(this._domain[0],this._domain[this._domain.length-1],n||Yc)},r}();function YF(r,n,t){var e,i=-1,a,o,s;if(n=+n,r=+r,t=+t,r===n&&t>0)return[r];if((e=n<r)&&(a=r,r=n,n=a),(s=Vu(r,n,t))===0||!isFinite(s))return[];if(s>0)for(r=Math.ceil(r/s),n=Math.floor(n/s),o=new Array(a=Math.ceil(n-r+1));++i<a;)o[i]=(r+i)*s;else for(r=Math.floor(r*s),n=Math.ceil(n*s),o=new Array(a=Math.ceil(r-n+1));++i<a;)o[i]=(r-i)/s;return e&&o.reverse(),o}function Vu(r,n,t){var e=(n-r)/Math.max(0,t),i=Math.floor(Math.log(e)/Math.LN10),a=e/Math.pow(10,i);return i>=0?(a>=Sg?10:a>=bg?5:a>=Ag?2:1)*Math.pow(10,i):-Math.pow(10,-i)/(a>=Sg?10:a>=bg?5:a>=Ag?2:1)}function Tg(r,n,t){var e;return t==="ceil"?e=Math.ceil(r/n):t==="floor"?e=Math.floor(r/n):e=Math.round(r/n),e*n}function Dv(r,n,t){var e=Tg(r,t,"floor"),i=Tg(n,t,"ceil");e=Bc(e,t),i=Bc(i,t);for(var a=[],o=Math.max((i-e)/(Math.pow(2,12)-1),t),s=e;s<=i;s=s+o){var u=Bc(s,o);a.push(u)}return{min:e,max:i,ticks:a}}function Pv(r,n,t){var e,i=r.minLimit,a=r.maxLimit,o=r.min,s=r.max,u=r.tickCount,l=u===void 0?5:u,c=G(i)?G(n)?o:n:i,f=G(a)?G(t)?s:t:a;if(c>f&&(e=[c,f],f=e[0],c=e[1]),l<=2)return[c,f];for(var h=(f-c)/(l-1),v=[],p=0;p<l;p++)v.push(c+h*p);return v}function ZF(r){var n=r.min,t=r.max,e=r.tickInterval,i=r.minLimit,a=r.maxLimit,o=jF(r);return!G(i)||!G(a)?Pv(r,pr(o),pe(o)):e?Dv(n,t,e).ticks:o}function Ii(r){return Math.abs(r)<1e-15?r:parseFloat(r.toFixed(15))}var qF=[1,5,2,2.5,4,3],Mg=Number.EPSILON*100;function KF(r,n){return(r%n+n)%n}function QF(r){return Math.round(r*1e12)/1e12}function JF(r,n,t,e,i,a){var o=Ee(n),s=lE(n,r),u=0,l=KF(e,a);return(l<Mg||a-l<Mg)&&e<=0&&i>=0&&(u=1),1-s/(o-1)-t+u}function t5(r,n,t){var e=Ee(n),i=lE(n,r),a=1;return 1-i/(e-1)-t+a}function e5(r,n,t,e,i,a){var o=(r-1)/(a-i),s=(n-1)/(Math.max(a,e)-Math.min(t,i));return 2-Math.max(o/s,s/o)}function r5(r,n){return r>=n?2-(r-1)/(n-1):1}function n5(r,n,t,e){var i=n-r;return 1-.5*(Math.pow(n-e,2)+Math.pow(r-t,2))/Math.pow(.1*i,2)}function i5(r,n,t){var e=n-r;if(t>e){var i=(t-e)/2;return 1-Math.pow(i,2)/Math.pow(.1*e,2)}return 1}function a5(){return 1}function o5(r,n,t,e,i,a){t===void 0&&(t=5),e===void 0&&(e=!0),i===void 0&&(i=qF),a===void 0&&(a=[.25,.2,.5,.05]);var o=t<0?0:Math.round(t);if(Number.isNaN(r)||Number.isNaN(n)||typeof r!="number"||typeof n!="number"||!o)return{min:0,max:0,ticks:[]};if(n-r<1e-15||o===1)return{min:r,max:n,ticks:[r]};if(n-r>1e148){var s=t||5,u=(n-r)/s;return{min:r,max:n,ticks:Array(s).fill(null).map(function(at,pt){return Ii(r+u*pt)})}}for(var l={score:-2,lmin:0,lmax:0,lstep:0},c=1;c<1/0;){for(var f=0;f<i.length;f+=1){var h=i[f],v=t5(h,i,c);if(a[0]*v+a[1]+a[2]+a[3]<l.score){c=1/0;break}for(var p=2;p<1/0;){var d=r5(p,o);if(a[0]*v+a[1]+a[2]*d+a[3]<l.score)break;for(var g=(n-r)/(p+1)/c/h,y=Math.ceil(Math.log10(g));y<1/0;){var m=c*h*Math.pow(10,y),x=i5(r,n,m*(p-1));if(a[0]*v+a[1]*x+a[2]*d+a[3]<l.score)break;var _=Math.floor(n/m)*c-(p-1)*c,E=Math.ceil(r/m)*c;if(_<=E)for(var s=E-_,b=0;b<=s;b+=1){var M=_+b,T=M*(m/c),k=T+m*(p-1),L=m,O=JF(h,i,c,T,k,L),D=n5(r,n,T,k),W=e5(p,o,r,n,T,k),j=a5(),ot=a[0]*O+a[1]*D+a[2]*W+a[3]*j;ot>l.score&&(!e||T<=r&&k>=n)&&(l.lmin=T,l.lmax=k,l.lstep=L,l.score=ot)}y+=1}p+=1}}c+=1}var z=Ii(l.lmax),X=Ii(l.lmin),K=Ii(l.lstep),Q=Math.floor(QF((z-X)/K))+1,q=new Array(Q);q[0]=Ii(X);for(var f=1;f<Q;f++)q[f]=Ii(q[f-1]+K);return{min:Math.min(r,pr(q)),max:Math.max(n,pe(q)),ticks:q}}function s5(r){var n=r.min,t=r.max,e=r.tickCount,i=r.nice,a=r.tickInterval,o=r.minLimit,s=r.maxLimit,u=o5(n,t,e,i).ticks;return!G(o)||!G(s)?Pv(r,pr(u),pe(u)):a?Dv(n,t,a).ticks:u}function u5(r){var n=r.base,t=r.tickCount,e=r.min,i=r.max,a=r.values,o,s=Ar(n,i);if(e>0)o=Math.floor(Ar(n,e));else{var u=WE(a,n,i);o=Math.floor(Ar(n,u))}for(var l=s-o,c=Math.ceil(l/t),f=[],h=o;h<s+c;h=h+c)f.push(Math.pow(n,h));return e<=0&&f.unshift(0),f}function ZE(r,n,t){if(t===void 0&&(t=5),r===n)return{max:n,min:r,ticks:[r]};var e=t<0?0:Math.round(t);if(e===0)return{max:n,min:r,ticks:[]};var i=1.5,a=.5+1.5*i,o=n-r,s=o/e,u=Math.pow(10,Math.floor(Math.log10(s))),l=u;2*u-s<i*(s-l)&&(l=2*u,5*u-s<a*(s-l)&&(l=5*u,10*u-s<i*(s-l)&&(l=10*u)));for(var c=Math.ceil(n/l),f=Math.floor(r/l),h=Math.max(c*l,n),v=Math.min(f*l,r),p=Math.floor((h-v)/l)+1,d=new Array(p),g=0;g<p;g++)d[g]=Ii(v+g*l);return{min:v,max:h,ticks:d}}function l5(r){var n=r.exponent,t=r.tickCount,e=Math.ceil(Kn(n,r.max)),i=Math.floor(Kn(n,r.min)),a=ZE(i,e,t).ticks;return a.map(function(o){var s=o>=0?1:-1;return Math.pow(o,n)*s})}function c5(r,n){var t=r.length*n;return n===1?r[r.length-1]:n===0?r[0]:t%1!==0?r[Math.ceil(t)-1]:r.length%2===0?(r[t-1]+r[t])/2:r[t]}function f5(r){var n=r.tickCount,t=r.values;if(!t||!t.length)return[];for(var e=t.slice().sort(function(s,u){return s-u}),i=[],a=0;a<n;a++){var o=a/(n-1);i.push(c5(e,o))}return i}function h5(r){var n=r.min,t=r.max,e=r.tickCount,i=r.tickInterval,a=r.minLimit,o=r.maxLimit,s=ZE(n,t,e).ticks;return!G(a)||!G(o)?Pv(r,pr(s),pe(s)):i?Dv(n,t,i).ticks:s}function v5(r){var n=r.min,t=r.max,e=r.minTickInterval,i=r.tickInterval,a=r.tickCount;if(i)a=Math.ceil((t-n)/i);else{i=zF(n,t,a)[1];var o=(t-n)/i,s=o/a;s>1&&(i=i*Math.ceil(s)),e&&i<e&&(i=e)}i=Math.max(Math.floor((t-n)/(Math.pow(2,12)-1)),i);for(var u=[],l=n;l<t+i;l+=i)u.push(l);return u}function p5(r){var n=YE(C({showLast:!0},r));return n}function ol(r){return new Date(r).getFullYear()}function d5(r){return new Date(r,0,1).getTime()}function ch(r){return new Date(r).getMonth()}function g5(r,n){var t=ol(r),e=ol(n),i=ch(r),a=ch(n);return(e-t)*12+(a-i)%12}function y5(r,n){return new Date(r,n,1).getTime()}function m5(r,n){return Math.ceil((n-r)/bn)}function x5(r,n){return Math.ceil((n-r)/Zi)}function _5(r,n){return Math.ceil((n-r)/(60*1e3))}function C5(r){var n=r.min,t=r.max,e=r.minTickInterval,i=r.tickCount,a=r.tickInterval,o=[];a||(a=(t-n)/i,e&&a<e&&(a=e)),a=Math.max(Math.floor((t-n)/(Math.pow(2,12)-1)),a);var s=ol(n);if(a>Eg)for(var u=ol(t),l=Math.ceil(a/Eg),c=s;c<=u+l;c=c+l)o.push(d5(c));else if(a>Ko)for(var f=Math.ceil(a/Ko),h=ch(n),v=g5(n,t),c=0;c<=v+f;c=c+f)o.push(y5(s,c+h));else if(a>bn)for(var p=new Date(n),d=p.getFullYear(),g=p.getMonth(),y=p.getDate(),m=Math.ceil(a/bn),x=m5(n,t),c=0;c<x+m;c=c+m)o.push(new Date(d,g,y+c).getTime());else if(a>Zi)for(var p=new Date(n),d=p.getFullYear(),g=p.getMonth(),m=p.getDate(),_=p.getHours(),E=Math.ceil(a/Zi),b=x5(n,t),c=0;c<=b+E;c=c+E)o.push(new Date(d,g,m,_+c).getTime());else if(a>Yi)for(var M=_5(n,t),T=Math.ceil(a/Yi),c=0;c<=M+T;c=c+T)o.push(n+c*Yi);else{var k=a;k<Vr&&(k=Vr);for(var L=Math.floor(n/Vr)*Vr,O=Math.ceil((t-n)/Vr),D=Math.ceil(k/Vr),c=0;c<O+D;c=c+D)o.push(L+c*Vr)}return o.length>=512&&console.warn("Notice: current ticks length("+o.length+') >= 512, may cause performance issues, even out of memory. Because of the configure "tickInterval"(in milliseconds, current is '+a+") is too small, increase the value to solve the problem!"),o}gn("cat",YE);gn("time-cat",p5);gn("wilkinson-extended",s5);gn("r-pretty",h5);gn("time",v5);gn("time-pretty",C5);gn("log",u5);gn("pow",l5);gn("quantile",f5);gn("d3-linear",ZF);yn("cat",Kl);yn("category",Kl);yn("identity",WF);yn("linear",Jl);yn("log",HF);yn("pow",$F);yn("time",GF);yn("timeCat",UF);yn("quantize",jE);yn("quantile",VF);var qE={},KE=function(r){return qE[r.toLowerCase()]},Us=function(r,n){if(KE(r))throw new Error("Attribute type '"+r+"' existed.");qE[r.toLowerCase()]=n};Us("Color",OF);Us("Opacity",RF);Us("Position",IF);Us("Shape",DF);Us("Size",PF);var Bv=function(){function r(n){this.type="coordinate",this.isRect=!1,this.isHelix=!1,this.isPolar=!1,this.isReflectX=!1,this.isReflectY=!1;var t=n.start,e=n.end,i=n.matrix,a=i===void 0?[1,0,0,0,1,0,0,0,1]:i,o=n.isTransposed,s=o===void 0?!1:o;this.start=t,this.end=e,this.matrix=a,this.originalMatrix=te([],a),this.isTransposed=s}return r.prototype.initial=function(){this.center={x:(this.start.x+this.end.x)/2,y:(this.start.y+this.end.y)/2},this.width=Math.abs(this.end.x-this.start.x),this.height=Math.abs(this.end.y-this.start.y)},r.prototype.update=function(n){zt(this,n),this.initial()},r.prototype.convertDim=function(n,t){var e,i=this[t],a=i.start,o=i.end;return this.isReflect(t)&&(e=[o,a],a=e[0],o=e[1]),a+n*(o-a)},r.prototype.invertDim=function(n,t){var e,i=this[t],a=i.start,o=i.end;return this.isReflect(t)&&(e=[o,a],a=e[0],o=e[1]),(n-a)/(o-a)},r.prototype.applyMatrix=function(n,t,e){e===void 0&&(e=0);var i=this.matrix,a=[n,t,e];return os(a,a,i),a},r.prototype.invertMatrix=function(n,t,e){e===void 0&&(e=0);var i=this.matrix,a=tM([0,0,0,0,0,0,0,0,0],i),o=[n,t,e];return a&&os(o,o,a),o},r.prototype.convert=function(n){var t=this.convertPoint(n),e=t.x,i=t.y,a=this.applyMatrix(e,i,1);return{x:a[0],y:a[1]}},r.prototype.invert=function(n){var t=this.invertMatrix(n.x,n.y,1);return this.invertPoint({x:t[0],y:t[1]})},r.prototype.rotate=function(n){var t=this.matrix,e=this.center;return Oa(t,t,[-e.x,-e.y]),Fv(t,t,n),Oa(t,t,[e.x,e.y]),this},r.prototype.reflect=function(n){return n==="x"?this.isReflectX=!this.isReflectX:this.isReflectY=!this.isReflectY,this},r.prototype.scale=function(n,t){var e=this.matrix,i=this.center;return Oa(e,e,[-i.x,-i.y]),_E(e,e,[n,t]),Oa(e,e,[i.x,i.y]),this},r.prototype.translate=function(n,t){var e=this.matrix;return Oa(e,e,[n,t]),this},r.prototype.transpose=function(){return this.isTransposed=!this.isTransposed,this},r.prototype.getCenter=function(){return this.center},r.prototype.getWidth=function(){return this.width},r.prototype.getHeight=function(){return this.height},r.prototype.getRadius=function(){return this.radius},r.prototype.isReflect=function(n){return n==="x"?this.isReflectX:this.isReflectY},r.prototype.resetMatrix=function(n){this.matrix=n||te([],this.originalMatrix)},r}(),QE=function(r){R(n,r);function n(t){var e=r.call(this,t)||this;return e.isRect=!0,e.type="cartesian",e.initial(),e}return n.prototype.initial=function(){r.prototype.initial.call(this);var t=this.start,e=this.end;this.x={start:t.x,end:e.x},this.y={start:t.y,end:e.y}},n.prototype.convertPoint=function(t){var e,i=t.x,a=t.y;return this.isTransposed&&(e=[a,i],i=e[0],a=e[1]),{x:this.convertDim(i,"x"),y:this.convertDim(a,"y")}},n.prototype.invertPoint=function(t){var e,i=this.invertDim(t.x,"x"),a=this.invertDim(t.y,"y");return this.isTransposed&&(e=[a,i],i=e[0],a=e[1]),{x:i,y:a}},n}(Bv),E5=function(r){R(n,r);function n(t){var e=r.call(this,t)||this;e.isHelix=!0,e.type="helix";var i=t.startAngle,a=i===void 0?1.25*Math.PI:i,o=t.endAngle,s=o===void 0?7.25*Math.PI:o,u=t.innerRadius,l=u===void 0?0:u,c=t.radius;return e.startAngle=a,e.endAngle=s,e.innerRadius=l,e.radius=c,e.initial(),e}return n.prototype.initial=function(){r.prototype.initial.call(this);var t=(this.endAngle-this.startAngle)/(2*Math.PI)+1,e=Math.min(this.width,this.height)/2;this.radius&&this.radius>=0&&this.radius<=1&&(e=e*this.radius),this.d=Math.floor(e*(1-this.innerRadius)/t),this.a=this.d/(Math.PI*2),this.x={start:this.startAngle,end:this.endAngle},this.y={start:this.innerRadius*e,end:this.innerRadius*e+this.d*.99}},n.prototype.convertPoint=function(t){var e,i=t.x,a=t.y;this.isTransposed&&(e=[a,i],i=e[0],a=e[1]);var o=this.convertDim(i,"x"),s=this.a*o,u=this.convertDim(a,"y");return{x:this.center.x+Math.cos(o)*(s+u),y:this.center.y+Math.sin(o)*(s+u)}},n.prototype.invertPoint=function(t){var e,i=this.d+this.y.start,a=ji([0,0],[t.x,t.y],[this.center.x,this.center.y]),o=kv(a,[1,0],!0),s=o*this.a;Da(a)<s&&(s=Da(a));var u=Math.floor((Da(a)-s)/i);o=2*u*Math.PI+o;var l=this.a*o,c=Da(a)-l;c=we(c,0)?0:c;var f=this.invertDim(o,"x"),h=this.invertDim(c,"y");return f=we(f,0)?0:f,h=we(h,0)?0:h,this.isTransposed&&(e=[h,f],f=e[0],h=e[1]),{x:f,y:h}},n}(Bv),S5=function(r){R(n,r);function n(t){var e=r.call(this,t)||this;e.isPolar=!0,e.type="polar";var i=t.startAngle,a=i===void 0?-Math.PI/2:i,o=t.endAngle,s=o===void 0?Math.PI*3/2:o,u=t.innerRadius,l=u===void 0?0:u,c=t.radius;return e.startAngle=a,e.endAngle=s,e.innerRadius=l,e.radius=c,e.initial(),e}return n.prototype.initial=function(){for(r.prototype.initial.call(this);this.endAngle<this.startAngle;)this.endAngle+=Math.PI*2;var t=this.getOneBox(),e=t.maxX-t.minX,i=t.maxY-t.minY,a=Math.abs(t.minX)/e,o=Math.abs(t.minY)/i,s;this.height/i>this.width/e?(s=this.width/e,this.circleCenter={x:this.center.x-(.5-a)*this.width,y:this.center.y-(.5-o)*s*i}):(s=this.height/i,this.circleCenter={x:this.center.x-(.5-a)*s*e,y:this.center.y-(.5-o)*this.height}),this.polarRadius=this.radius,this.radius?this.radius>0&&this.radius<=1?this.polarRadius=s*this.radius:(this.radius<=0||this.radius>s)&&(this.polarRadius=s):this.polarRadius=s,this.x={start:this.startAngle,end:this.endAngle},this.y={start:this.innerRadius*this.polarRadius,end:this.polarRadius}},n.prototype.getRadius=function(){return this.polarRadius},n.prototype.convertPoint=function(t){var e,i=this.getCenter(),a=t.x,o=t.y;return this.isTransposed&&(e=[o,a],a=e[0],o=e[1]),a=this.convertDim(a,"x"),o=this.convertDim(o,"y"),{x:i.x+Math.cos(a)*o,y:i.y+Math.sin(a)*o}},n.prototype.invertPoint=function(t){var e,i=this.getCenter(),a=[t.x-i.x,t.y-i.y],o=this,s=o.startAngle,u=o.endAngle;this.isReflect("x")&&(e=[u,s],s=e[0],u=e[1]);var l=[1,0,0,0,1,0,0,0,1];Fv(l,l,s);var c=[1,0,0];os(c,c,l);var f=[c[0],c[1]],h=kv(f,a,u<s);we(h,Math.PI*2)&&(h=0);var v=Da(a),p=h/(u-s);p=u-s>0?p:-p;var d=this.invertDim(v,"y"),g={x:0,y:0};return g.x=this.isTransposed?d:p,g.y=this.isTransposed?p:d,g},n.prototype.getCenter=function(){return this.circleCenter},n.prototype.getOneBox=function(){var t=this.startAngle,e=this.endAngle;if(Math.abs(e-t)>=Math.PI*2)return{minX:-1,maxX:1,minY:-1,maxY:1};for(var i=[0,Math.cos(t),Math.cos(e)],a=[0,Math.sin(t),Math.sin(e)],o=Math.min(t,e);o<Math.max(t,e);o+=Math.PI/18)i.push(Math.cos(o)),a.push(Math.sin(o));return{minX:Math.min.apply(Math,i),maxX:Math.max.apply(Math,i),minY:Math.min.apply(Math,a),maxY:Math.max.apply(Math,a)}},n}(Bv),JE={},b5=function(r){return JE[r.toLowerCase()]},tc=function(r,n){JE[r.toLowerCase()]=n};tc("rect",QE);tc("cartesian",QE);tc("polar",S5);tc("helix",E5);function tS(r,n,t){var e=new Bs(n,t);e.target=r,e.propagationPath.push(r),r.emitDelegation(n,e);for(var i=r.getParent();i;)i.emitDelegation(n,e),e.propagationPath.push(i),i=i.getParent()}var eS=[1,0,0,0,1,0,0,0,1];function ta(r,n,t){if(t===void 0&&(t=eS),!n)return null;var e=ve(t,[["t",-r.x,-r.y],["r",n],["t",r.x,r.y]]);return e}function Nv(r,n){return!r.x&&!r.y?null:ve(n||eS,[["t",r.x,r.y]])}function A5(r){var n=[1,0,0],t=[0,0,0];return os(t,n,r),Math.atan2(t[1],t[0])}function su(r,n){var t=[0,0];return eM(t,n,r),t}function T5(r,n){var t=su(r,[n.minX,n.minY]),e=su(r,[n.maxX,n.minY]),i=su(r,[n.minX,n.maxY]),a=su(r,[n.maxX,n.maxY]),o=Math.min(t[0],e[0],i[0],a[0]),s=Math.max(t[0],e[0],i[0],a[0]),u=Math.min(t[1],e[1],i[1],a[1]),l=Math.max(t[1],e[1],i[1],a[1]);return{x:o,y:u,minX:o,minY:u,maxX:s,maxY:l,width:s-o,height:l-u}}function rS(r,n,t,e){if(n){var i=ta({x:t,y:e},n,r.getMatrix());r.setMatrix(i)}}function Qo(r,n,t){var e=Nv({x:n,y:t});r.attr("matrix",e)}function sl(r){var n=0,t=0,e=0,i=0;return dt(r)?n=t=e=i=r:V(r)&&(n=r[0],e=G(r[1])?r[0]:r[1],i=G(r[2])?r[0]:r[2],t=G(r[3])?e:r[3]),[n,e,i,t]}function zv(r){for(var n=r.childNodes,t=n.length,e=t-1;e>=0;e--)r.removeChild(n[e])}function fh(r,n){return!!r.className.match(new RegExp("(\\s|^)"+n+"(\\s|$)"))}function us(r){var n=r.start,t=r.end,e=Math.min(n.x,t.x),i=Math.min(n.y,t.y),a=Math.max(n.x,t.x),o=Math.max(n.y,t.y);return{x:e,y:i,minX:e,minY:i,maxX:a,maxY:o,width:a-e,height:o-i}}function M5(r){var n=r.map(function(s){return s.x}),t=r.map(function(s){return s.y}),e=Math.min.apply(Math,n),i=Math.min.apply(Math,t),a=Math.max.apply(Math,n),o=Math.max.apply(Math,t);return{x:e,y:i,minX:e,minY:i,maxX:a,maxY:o,width:a-e,height:o-i}}function ec(r,n,t,e){var i=r+t,a=n+e;return{x:r,y:n,width:t,height:e,minX:r,minY:n,maxX:isNaN(i)?0:i,maxY:isNaN(a)?0:a}}function qi(r,n,t){return(1-t)*r+n*t}function Ua(r,n,t){return{x:r.x+Math.cos(t)*n,y:r.y+Math.sin(t)*n}}function w5(r,n){var t=n.x-r.x,e=n.y-r.y;return Math.sqrt(t*t+e*e)}var ul=function(r,n,t){return t===void 0&&(t=Math.pow(Number.EPSILON,.5)),[r,n].includes(1/0)?Math.abs(r)===Math.abs(n):Math.abs(r-n)<t};function L5(r,n){var t=Math.max(r.minX,n.minX),e=Math.max(r.minY,n.minY),i=Math.min(r.maxX,n.maxX),a=Math.min(r.maxY,n.maxY);return ec(t,e,i-t,a-e)}function nS(r){var n=r.getClip(),t=n&&n.getBBox(),e;if(!r.isGroup())e=r.getBBox();else{var i=1/0,a=-1/0,o=1/0,s=-1/0,u=r.getChildren();u.length>0?w(u,function(l){if(l.get("visible")){if(l.isGroup()&&l.get("children").length===0)return!0;var c=nS(l),f=l.applyToMatrix([c.minX,c.minY,1]),h=l.applyToMatrix([c.minX,c.maxY,1]),v=l.applyToMatrix([c.maxX,c.minY,1]),p=l.applyToMatrix([c.maxX,c.maxY,1]),d=Math.min(f[0],h[0],v[0],p[0]),g=Math.max(f[0],h[0],v[0],p[0]),y=Math.min(f[1],h[1],v[1],p[1]),m=Math.max(f[1],h[1],v[1],p[1]);d<i&&(i=d),g>a&&(a=g),y<o&&(o=y),m>s&&(s=m)}}):(i=0,a=0,o=0,s=0),e=ec(i,o,a-i,s-o)}return t?L5(e,t):e}function F5(r,n){if(!(!r.getClip()&&!n.getClip())){var t=n.getClip();if(!t){r.setClip(null);return}var e={type:t.get("type"),attrs:t.attr()};r.setClip(e)}}function qe(r){return r+"px"}function iS(r,n,t,e){var i=w5(r,n),a=e/i,o=0;return t==="start"?o=0-a:t==="end"&&(o=1+a),{x:qi(r.x,n.x,o),y:qi(r.y,n.y,o)}}var k5={none:[],point:["x","y"],region:["start","end"],points:["points"],circle:["center","radius","startAngle","endAngle"]},aS=function(r){R(n,r);function n(t){var e=r.call(this,t)||this;return e.initCfg(),e}return n.prototype.getDefaultCfg=function(){return{id:"",name:"",type:"",locationType:"none",offsetX:0,offsetY:0,animate:!1,capture:!0,updateAutoRender:!1,animateOption:{appear:null,update:{duration:400,easing:"easeQuadInOut"},enter:{duration:400,easing:"easeQuadInOut"},leave:{duration:350,easing:"easeQuadIn"}},events:null,defaultCfg:{},visible:!0}},n.prototype.clear=function(){},n.prototype.update=function(t){var e=this,i=this.get("defaultCfg")||{};w(t,function(a,o){var s=e.get(o),u=a;s!==a&&(wt(a)&&i[o]&&(u=J({},i[o],a)),e.set(o,u))}),this.updateInner(t),this.afterUpdate(t)},n.prototype.updateInner=function(t){},n.prototype.afterUpdate=function(t){si(t,"visible")&&(t.visible?this.show():this.hide()),si(t,"capture")&&this.setCapture(t.capture)},n.prototype.getLayoutBBox=function(){return this.getBBox()},n.prototype.getLocationType=function(){return this.get("locationType")},n.prototype.getOffset=function(){return{offsetX:this.get("offsetX"),offsetY:this.get("offsetY")}},n.prototype.setOffset=function(t,e){this.update({offsetX:t,offsetY:e})},n.prototype.setLocation=function(t){var e=C({},t);this.update(e)},n.prototype.getLocation=function(){var t=this,e={},i=this.get("locationType"),a=k5[i];return w(a,function(o){e[o]=t.get(o)}),e},n.prototype.isList=function(){return!1},n.prototype.isSlider=function(){return!1},n.prototype.init=function(){},n.prototype.initCfg=function(){var t=this,e=this.get("defaultCfg");w(e,function(i,a){var o=t.get(a);if(wt(o)){var s=J({},i,o);t.set(a,s)}})},n}(Nl),Si="update_status",O5=["visible","tip","delegateObject"],R5=["container","group","shapesMap","isRegister","isUpdating","destroyed"],Be=function(r){R(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.getDefaultCfg=function(){var t=r.prototype.getDefaultCfg.call(this);return C(C({},t),{container:null,shapesMap:{},group:null,capture:!0,isRegister:!1,isUpdating:!1,isInit:!0})},n.prototype.remove=function(){this.clear();var t=this.get("group");t.remove()},n.prototype.clear=function(){var t=this.get("group");t.clear(),this.set("shapesMap",{}),this.clearOffScreenCache(),this.set("isInit",!0)},n.prototype.getChildComponentById=function(t){var e=this.getElementById(t),i=e&&e.get("component");return i},n.prototype.getElementById=function(t){return this.get("shapesMap")[t]},n.prototype.getElementByLocalId=function(t){var e=this.getElementId(t);return this.getElementById(e)},n.prototype.getElementsByName=function(t){var e=[];return w(this.get("shapesMap"),function(i){i.get("name")===t&&e.push(i)}),e},n.prototype.getContainer=function(){return this.get("container")},n.prototype.updateInner=function(t){this.offScreenRender(),this.get("updateAutoRender")&&this.render()},n.prototype.render=function(){var t=this.get("offScreenGroup");t||(t=this.offScreenRender());var e=this.get("group");this.updateElements(t,e),this.deleteElements(),this.applyOffset(),this.get("eventInitted")||(this.initEvent(),this.set("eventInitted",!0)),this.set("isInit",!1)},n.prototype.show=function(){var t=this.get("group");t.show(),this.set("visible",!0)},n.prototype.hide=function(){var t=this.get("group");t.hide(),this.set("visible",!1)},n.prototype.setCapture=function(t){var e=this.get("group");e.set("capture",t),this.set("capture",t)},n.prototype.destroy=function(){this.removeEvent(),this.remove(),r.prototype.destroy.call(this)},n.prototype.getBBox=function(){return this.get("group").getCanvasBBox()},n.prototype.getLayoutBBox=function(){var t=this.get("group"),e=this.getInnerLayoutBBox(),i=t.getTotalMatrix();return i&&(e=T5(i,e)),e},n.prototype.on=function(t,e,i){var a=this.get("group");return a.on(t,e,i),this},n.prototype.off=function(t,e){var i=this.get("group");return i&&i.off(t,e),this},n.prototype.emit=function(t,e){var i=this.get("group");i.emit(t,e)},n.prototype.init=function(){r.prototype.init.call(this),this.get("group")||this.initGroup(),this.offScreenRender()},n.prototype.getInnerLayoutBBox=function(){return this.get("offScreenBBox")||this.get("group").getBBox()},n.prototype.delegateEmit=function(t,e){var i=this.get("group");e.target=i,i.emit(t,e),tS(i,t,e)},n.prototype.createOffScreenGroup=function(){var t=this.get("group"),e=t.getGroupBase(),i=new e({delegateObject:this.getDelegateObject()});return i},n.prototype.applyOffset=function(){var t=this.get("offsetX"),e=this.get("offsetY");this.moveElementTo(this.get("group"),{x:t,y:e})},n.prototype.initGroup=function(){var t=this.get("container");this.set("group",t.addGroup({id:this.get("id"),name:this.get("name"),capture:this.get("capture"),visible:this.get("visible"),isComponent:!0,component:this,delegateObject:this.getDelegateObject()}))},n.prototype.offScreenRender=function(){this.clearOffScreenCache();var t=this.createOffScreenGroup();return this.renderInner(t),this.set("offScreenGroup",t),this.set("offScreenBBox",nS(t)),t},n.prototype.addGroup=function(t,e){this.appendDelegateObject(t,e);var i=t.addGroup(e);return this.get("isRegister")&&this.registerElement(i),i},n.prototype.addShape=function(t,e){this.appendDelegateObject(t,e);var i=t.addShape(e);return this.get("isRegister")&&this.registerElement(i),i},n.prototype.addComponent=function(t,e){var i=e.id,a=e.component,o=Tt(e,["id","component"]),s=new a(C(C({},o),{id:i,container:t,updateAutoRender:this.get("updateAutoRender")}));return s.init(),s.render(),this.get("isRegister")&&this.registerElement(s.get("group")),s},n.prototype.initEvent=function(){},n.prototype.removeEvent=function(){var t=this.get("group");t.off()},n.prototype.getElementId=function(t){var e=this.get("id"),i=this.get("name");return e+"-"+i+"-"+t},n.prototype.registerElement=function(t){var e=t.get("id");this.get("shapesMap")[e]=t},n.prototype.unregisterElement=function(t){var e=t.get("id");delete this.get("shapesMap")[e]},n.prototype.moveElementTo=function(t,e){var i=Nv(e);t.attr("matrix",i)},n.prototype.addAnimation=function(t,e,i){var a=e.attr("opacity");G(a)&&(a=1),e.attr("opacity",0),e.animate({opacity:a},i)},n.prototype.removeAnimation=function(t,e,i){e.animate({opacity:0},i)},n.prototype.updateAnimation=function(t,e,i,a){e.animate(i,a)},n.prototype.updateElements=function(t,e){var i=this,a=this.get("animate"),o=this.get("animateOption"),s=t.getChildren().slice(0),u;w(s,function(l){var c=l.get("id"),f=i.getElementById(c),h=l.get("name");if(f)if(l.get("isComponent")){var v=l.get("component"),p=f.get("component"),d=li(v.cfg,hw(oo(v.cfg),R5));p.update(d),f.set(Si,"update")}else{var g=i.getReplaceAttrs(f,l);a&&o.update?i.updateAnimation(h,f,g,o.update):f.attr(g),l.isGroup()&&i.updateElements(l,f),w(O5,function(_){f.set(_,l.get(_))}),F5(f,l),u=f,f.set(Si,"update")}else{e.add(l);var y=e.getChildren();if(y.splice(y.length-1,1),u){var m=y.indexOf(u);y.splice(m+1,0,l)}else y.unshift(l);if(i.registerElement(l),l.set(Si,"add"),l.get("isComponent")){var v=l.get("component");v.set("container",e)}else l.isGroup()&&i.registerNewGroup(l);if(u=l,a){var x=i.get("isInit")?o.appear:o.enter;x&&i.addAnimation(h,l,x)}}})},n.prototype.clearUpdateStatus=function(t){var e=t.getChildren();w(e,function(i){i.set(Si,null)})},n.prototype.clearOffScreenCache=function(){var t=this.get("offScreenGroup");t&&t.destroy(),this.set("offScreenGroup",null),this.set("offScreenBBox",null)},n.prototype.getDelegateObject=function(){var t,e=this.get("name"),i=(t={},t[e]=this,t.component=this,t);return i},n.prototype.appendDelegateObject=function(t,e){var i=t.get("delegateObject");e.delegateObject||(e.delegateObject={}),zt(e.delegateObject,i)},n.prototype.getReplaceAttrs=function(t,e){var i=t.attr(),a=e.attr();return w(i,function(o,s){a[s]===void 0&&(a[s]=void 0)}),a},n.prototype.registerNewGroup=function(t){var e=this,i=t.getChildren();w(i,function(a){e.registerElement(a),a.set(Si,"add"),a.isGroup()&&e.registerNewGroup(a)})},n.prototype.deleteElements=function(){var t=this,e=this.get("shapesMap"),i=[];w(e,function(s,u){!s.get(Si)||s.destroyed?i.push([u,s]):s.set(Si,null)});var a=this.get("animate"),o=this.get("animateOption");w(i,function(s){var u=s[0],l=s[1];if(!l.destroyed){var c=l.get("name");if(a&&o.leave){var f=zt({callback:function(){t.removeElement(l)}},o.leave);t.removeAnimation(c,l,f)}else t.removeElement(l)}delete e[u]})},n.prototype.removeElement=function(t){if(t.get("isGroup")){var e=t.get("component");e&&e.destroy()}t.remove()},n}(aS),Zc="\u2026";function I5(r){for(var n=0,t=0;t<r.length;t++)n+=Di(r,t);return n}function Di(r,n){return r.charCodeAt(n)>0&&r.charCodeAt(n)<128?1:2}function D5(r,n,t){t===void 0&&(t="tail");var e=r.length,i="";if(t==="tail"){for(var a=0,o=0;a<n;){var s=Di(r,o);if(a+s<=n)i+=r[o],a+=Di(r,o),o++;else break}i+=Zc}else if(t==="head"){for(var a=0,o=e-1;a<n;){var s=Di(r,o);if(a+s<=n)i+=r[o],a+=Di(r,o),o--;else break}i=Zc+i}else{for(var u="",l="",a=0,c=0,f=e-1;a<n;){var h=Di(r,c),v=!1;h+a<=n&&(u+=r[c],c++,a+=h,v=!0);var p=Di(r,f);if(p+a<=n&&(l=r[f]+l,a+=p,f--,v=!0),!v)break}i=u+Zc+l}return i}var P5="\u2026",B5=2,N5=400;function z5(r){for(var n=r.map(function(u){var l=u.attr("text");return G(l)?"":""+l}),t=0,e=0,i=0;i<n.length;i+=1){for(var a=0,o=0;o<=n[i].length;o+=1){var s=n[i].charCodeAt(o);s>=19968&&s<=40869?a+=2:a+=1}a>t&&(t=a,e=i)}return r[e].getBBox().width}function hh(r){if(r.length>N5)return z5(r);var n=0;return w(r,function(t){var e=t.getBBox(),i=e.width;n<i&&(n=i)}),n}function U5(r,n){var t=n.getCanvasBBox();return r?t.width:t.height}function Jo(r,n,t,e){var i;e===void 0&&(e="tail");var a=(i=n.attr("text"))!==null&&i!==void 0?i:"";if(e==="tail"){var o=li(n.attr(),["fontSize","fontFamily","fontWeight","fontStyle","fontVariant"]),s=Bw(a,t,o,"\u2026");return a!==s?(n.attr("text",s),n.set("tip",a),!0):(n.set("tip",null),!1)}var u=U5(r,n),l=I5(a),c=!1;if(t<u){var f=Math.floor(t/u*l)-B5,h=void 0;f>=0?h=D5(a,f,e):h=P5,h&&(n.attr("text",h),c=!0)}return c?n.set("tip",a):n.set("tip",null),c}function rc(r,n){var t=n.x,e=n.y,i=n.content,a=n.style,o=n.id,s=n.name,u=n.rotate,l=n.maxLength,c=n.autoEllipsis,f=n.isVertical,h=n.ellipsisPosition,v=n.background,p=r.addGroup({id:o+"-group",name:s+"-group",attrs:{x:t,y:e}}),d=p.addShape({type:"text",id:o,name:s,attrs:C({x:0,y:0,text:i},a)}),g=sl(F(v,"padding",0));if(l&&c){var y=l-(g[1]+g[3]);Jo(!f,d,y,h)}if(v){var m=F(v,"style",{}),x=d.getCanvasBBox(),_=x.minX,E=x.minY,b=x.width,M=x.height,T=p.addShape("rect",{id:o+"-bg",name:o+"-bg",attrs:C({x:_-g[3],y:E-g[0],width:b+g[1]+g[3],height:M+g[0]+g[2]},m)});T.toBack()}Qo(p,t,e),rS(p,u,t,e)}const bt={fontFamily:`
  BlinkMacSystemFont, "Segoe UI", Roboto,"Helvetica Neue",
  Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei",
  SimSun, "sans-serif"`,textColor:"#2C3542",activeTextColor:"#333333",uncheckedColor:"#D8D8D8",lineColor:"#416180",regionColor:"#CCD7EB",verticalAxisRotate:-Math.PI/4,horizontalAxisRotate:Math.PI/4,descriptionIconStroke:"#fff",descriptionIconFill:"rgba(58, 73, 101, .25)"};var H5=function(r){R(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.getDefaultCfg=function(){var t=r.prototype.getDefaultCfg.call(this);return C(C({},t),{name:"annotation",type:"line",locationType:"region",start:null,end:null,style:{},text:null,defaultCfg:{style:{fill:bt.textColor,fontSize:12,textAlign:"center",textBaseline:"bottom",fontFamily:bt.fontFamily},text:{position:"center",autoRotate:!0,content:null,offsetX:0,offsetY:0,style:{stroke:bt.lineColor,lineWidth:1}}}})},n.prototype.renderInner=function(t){this.renderLine(t),this.get("text")&&this.renderLabel(t)},n.prototype.renderLine=function(t){var e=this.get("start"),i=this.get("end"),a=this.get("style");this.addShape(t,{type:"line",id:this.getElementId("line"),name:"annotation-line",attrs:C({x1:e.x,y1:e.y,x2:i.x,y2:i.y},a)})},n.prototype.getLabelPoint=function(t,e,i){var a;return i==="start"?a=0:i==="center"?a=.5:lt(i)&&i.indexOf("%")!==-1?a=parseInt(i,10)/100:dt(i)?a=i:a=1,(a>1||a<0)&&(a=1),{x:qi(t.x,e.x,a),y:qi(t.y,e.y,a)}},n.prototype.renderLabel=function(t){var e=this.get("text"),i=this.get("start"),a=this.get("end"),o=e.position,s=e.content,u=e.style,l=e.offsetX,c=e.offsetY,f=e.autoRotate,h=e.maxLength,v=e.autoEllipsis,p=e.ellipsisPosition,d=e.background,g=e.isVertical,y=g===void 0?!1:g,m=this.getLabelPoint(i,a,o),x=m.x+l,_=m.y+c,E={id:this.getElementId("line-text"),name:"annotation-line-text",x,y:_,content:s,style:u,maxLength:h,autoEllipsis:v,ellipsisPosition:p,background:d,isVertical:y};if(f){var b=[a.x-i.x,a.y-i.y];E.rotate=Math.atan2(b[1],b[0])}rc(t,E)},n}(Be),$5=function(r){R(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.getDefaultCfg=function(){var t=r.prototype.getDefaultCfg.call(this);return C(C({},t),{name:"annotation",type:"text",locationType:"point",x:0,y:0,content:"",rotate:null,style:{},background:null,maxLength:null,autoEllipsis:!0,isVertical:!1,ellipsisPosition:"tail",defaultCfg:{style:{fill:bt.textColor,fontSize:12,textAlign:"center",textBaseline:"middle",fontFamily:bt.fontFamily}}})},n.prototype.setLocation=function(t){this.set("x",t.x),this.set("y",t.y),this.resetLocation()},n.prototype.renderInner=function(t){var e=this.getLocation(),i=e.x,a=e.y,o=this.get("content"),s=this.get("style"),u=this.getElementId("text"),l=this.get("name")+"-text",c=this.get("maxLength"),f=this.get("autoEllipsis"),h=this.get("isVertical"),v=this.get("ellipsisPosition"),p=this.get("background"),d=this.get("rotate"),g={id:u,name:l,x:i,y:a,content:o,style:s,maxLength:c,autoEllipsis:f,isVertical:h,ellipsisPosition:v,background:p,rotate:d};rc(t,g)},n.prototype.resetLocation=function(){var t=this.getElementByLocalId("text-group");if(t){var e=this.getLocation(),i=e.x,a=e.y,o=this.get("rotate");Qo(t,i,a),rS(t,o,i,a)}},n}(Be),G5=function(r){R(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.getDefaultCfg=function(){var t=r.prototype.getDefaultCfg.call(this);return C(C({},t),{name:"annotation",type:"arc",locationType:"circle",center:null,radius:100,startAngle:-Math.PI/2,endAngle:Math.PI*3/2,style:{stroke:"#999",lineWidth:1}})},n.prototype.renderInner=function(t){this.renderArc(t)},n.prototype.getArcPath=function(){var t=this.getLocation(),e=t.center,i=t.radius,a=t.startAngle,o=t.endAngle,s=Ua(e,i,a),u=Ua(e,i,o),l=o-a>Math.PI?1:0,c=[["M",s.x,s.y]];if(o-a===Math.PI*2){var f=Ua(e,i,a+Math.PI);c.push(["A",i,i,0,l,1,f.x,f.y]),c.push(["A",i,i,0,l,1,u.x,u.y])}else c.push(["A",i,i,0,l,1,u.x,u.y]);return c},n.prototype.renderArc=function(t){var e=this.getArcPath(),i=this.get("style");this.addShape(t,{type:"path",id:this.getElementId("arc"),name:"annotation-arc",attrs:C({path:e},i)})},n}(Be),V5=function(r){R(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.getDefaultCfg=function(){var t=r.prototype.getDefaultCfg.call(this);return C(C({},t),{name:"annotation",type:"region",locationType:"region",start:null,end:null,style:{},defaultCfg:{style:{lineWidth:0,fill:bt.regionColor,opacity:.4}}})},n.prototype.renderInner=function(t){this.renderRegion(t)},n.prototype.renderRegion=function(t){var e=this.get("start"),i=this.get("end"),a=this.get("style"),o=us({start:e,end:i});this.addShape(t,{type:"rect",id:this.getElementId("region"),name:"annotation-region",attrs:C({x:o.x,y:o.y,width:o.width,height:o.height},a)})},n}(Be),W5=function(r){R(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.getDefaultCfg=function(){var t=r.prototype.getDefaultCfg.call(this);return C(C({},t),{name:"annotation",type:"image",locationType:"region",start:null,end:null,src:null,style:{}})},n.prototype.renderInner=function(t){this.renderImage(t)},n.prototype.getImageAttrs=function(){var t=this.get("start"),e=this.get("end"),i=this.get("style"),a=us({start:t,end:e}),o=this.get("src");return C({x:a.x,y:a.y,img:o,width:a.width,height:a.height},i)},n.prototype.renderImage=function(t){this.addShape(t,{type:"image",id:this.getElementId("image"),name:"annotation-image",attrs:this.getImageAttrs()})},n}(Be),j5=function(r){R(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.getDefaultCfg=function(){var t=r.prototype.getDefaultCfg.call(this);return C(C({},t),{name:"annotation",type:"dataMarker",locationType:"point",x:0,y:0,point:{},line:{},text:{},direction:"upward",autoAdjust:!0,coordinateBBox:null,defaultCfg:{point:{display:!0,style:{r:3,fill:"#FFFFFF",stroke:"#1890FF",lineWidth:2}},line:{display:!0,length:20,style:{stroke:bt.lineColor,lineWidth:1}},text:{content:"",display:!0,style:{fill:bt.textColor,opacity:.65,fontSize:12,textAlign:"start",fontFamily:bt.fontFamily}}}})},n.prototype.renderInner=function(t){F(this.get("line"),"display")&&this.renderLine(t),F(this.get("text"),"display")&&this.renderText(t),F(this.get("point"),"display")&&this.renderPoint(t),this.get("autoAdjust")&&this.autoAdjust(t)},n.prototype.applyOffset=function(){this.moveElementTo(this.get("group"),{x:this.get("x")+this.get("offsetX"),y:this.get("y")+this.get("offsetY")})},n.prototype.renderPoint=function(t){var e=this.getShapeAttrs().point;this.addShape(t,{type:"circle",id:this.getElementId("point"),name:"annotation-point",attrs:e})},n.prototype.renderLine=function(t){var e=this.getShapeAttrs().line;this.addShape(t,{type:"path",id:this.getElementId("line"),name:"annotation-line",attrs:e})},n.prototype.renderText=function(t){var e=this.getShapeAttrs().text,i=e.x,a=e.y,o=e.text,s=Tt(e,["x","y","text"]),u=this.get("text"),l=u.background,c=u.maxLength,f=u.autoEllipsis,h=u.isVertival,v=u.ellipsisPosition,p={x:i,y:a,id:this.getElementId("text"),name:"annotation-text",content:o,style:s,background:l,maxLength:c,autoEllipsis:f,isVertival:h,ellipsisPosition:v};rc(t,p)},n.prototype.autoAdjust=function(t){var e=this.get("direction"),i=this.get("x"),a=this.get("y"),o=F(this.get("line"),"length",0),s=this.get("coordinateBBox"),u=t.getBBox(),l=u.minX,c=u.maxX,f=u.minY,h=u.maxY,v=t.findById(this.getElementId("text-group")),p=t.findById(this.getElementId("text")),d=t.findById(this.getElementId("line"));if(!!s){if(v){if(i+l<=s.minX){var g=s.minX-(i+l);Qo(v,v.attr("x")+g,v.attr("y"))}if(i+c>=s.maxX){var g=i+c-s.maxX;Qo(v,v.attr("x")-g,v.attr("y"))}}if(e==="upward"&&a+f<=s.minY||e!=="upward"&&a+h>=s.maxY){var y=void 0,m=void 0;e==="upward"&&a+f<=s.minY?(y="top",m=1):(y="bottom",m=-1),p.attr("textBaseline",y),d&&d.attr("path",[["M",0,0],["L",0,o*m]]),Qo(v,v.attr("x"),(o+2)*m)}}},n.prototype.getShapeAttrs=function(){var t=F(this.get("line"),"display"),e=F(this.get("point"),"style",{}),i=F(this.get("line"),"style",{}),a=F(this.get("text"),"style",{}),o=this.get("direction"),s=t?F(this.get("line"),"length",0):0,u=o==="upward"?-1:1;return{point:C({x:0,y:0},e),line:C({path:[["M",0,0],["L",0,s*u]]},i),text:C({x:0,y:(s+2)*u,text:F(this.get("text"),"content",""),textBaseline:o==="upward"?"bottom":"top"},a)}},n}(Be),X5=function(r){R(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.getDefaultCfg=function(){var t=r.prototype.getDefaultCfg.call(this);return C(C({},t),{name:"annotation",type:"dataRegion",locationType:"points",points:[],lineLength:0,region:{},text:{},defaultCfg:{region:{style:{lineWidth:0,fill:bt.regionColor,opacity:.4}},text:{content:"",style:{textAlign:"center",textBaseline:"bottom",fontSize:12,fill:bt.textColor,fontFamily:bt.fontFamily}}}})},n.prototype.renderInner=function(t){var e=F(this.get("region"),"style",{});F(this.get("text"),"style",{});var i=this.get("lineLength")||0,a=this.get("points");if(!!a.length){var o=M5(a),s=[];s.push(["M",a[0].x,o.minY-i]),a.forEach(function(l){s.push(["L",l.x,l.y])}),s.push(["L",a[a.length-1].x,a[a.length-1].y-i]),this.addShape(t,{type:"path",id:this.getElementId("region"),name:"annotation-region",attrs:C({path:s},e)});var u=C({id:this.getElementId("text"),name:"annotation-text",x:(o.minX+o.maxX)/2,y:o.minY-i},this.get("text"));rc(t,u)}},n}(Be),Y5=function(r){R(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.getDefaultCfg=function(){var t=r.prototype.getDefaultCfg.call(this);return C(C({},t),{name:"annotation",type:"regionFilter",locationType:"region",start:null,end:null,color:null,shape:[]})},n.prototype.renderInner=function(t){var e=this,i=this.get("start"),a=this.get("end"),o=this.addGroup(t,{id:this.getElementId("region-filter"),capture:!1});w(this.get("shapes"),function(u,l){var c=u.get("type"),f=Ve(u.attr());e.adjustShapeAttrs(f),e.addShape(o,{id:e.getElementId("shape-"+c+"-"+l),capture:!1,type:c,attrs:f})});var s=us({start:i,end:a});o.setClip({type:"rect",attrs:{x:s.minX,y:s.minY,width:s.width,height:s.height}})},n.prototype.adjustShapeAttrs=function(t){var e=this.get("color");t.fill&&(t.fill=t.fillStyle=e),t.stroke=t.strokeStyle=e},n}(Be),Z5=function(r){R(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.getDefaultCfg=function(){var t=r.prototype.getDefaultCfg.call(this);return C(C({},t),{name:"annotation",type:"shape",draw:ti})},n.prototype.renderInner=function(t){var e=this.get("render");rt(e)&&e(t)},n}(Be),Mr="g2-tooltip",ls="g2-tooltip-custom",On="g2-tooltip-title",cs="g2-tooltip-list",nc="g2-tooltip-list-item",ic="g2-tooltip-marker",ac="g2-tooltip-value",oS="g2-tooltip-name",Uv="g2-tooltip-crosshair-x",Hv="g2-tooltip-crosshair-y";const q5=Object.freeze(Object.defineProperty({__proto__:null,CONTAINER_CLASS:Mr,CONTAINER_CLASS_CUSTOM:ls,TITLE_CLASS:On,LIST_CLASS:cs,LIST_ITEM_CLASS:nc,MARKER_CLASS:ic,VALUE_CLASS:ac,NAME_CLASS:oS,CROSSHAIR_X:Uv,CROSSHAIR_Y:Hv},Symbol.toStringTag,{value:"Module"}));var $v=function(r){R(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.getDefaultCfg=function(){var t=r.prototype.getDefaultCfg.call(this);return C(C({},t),{container:null,containerTpl:"<div></div>",updateAutoRender:!0,containerClassName:"",parent:null})},n.prototype.getContainer=function(){return this.get("container")},n.prototype.show=function(){var t=this.get("container");t.style.display="",this.set("visible",!0)},n.prototype.hide=function(){var t=this.get("container");t.style.display="none",this.set("visible",!1)},n.prototype.setCapture=function(t){var e=this.getContainer(),i=t?"auto":"none";e.style.pointerEvents=i,this.set("capture",t)},n.prototype.getBBox=function(){var t=this.getContainer(),e=parseFloat(t.style.left)||0,i=parseFloat(t.style.top)||0;return ec(e,i,t.clientWidth,t.clientHeight)},n.prototype.clear=function(){var t=this.get("container");zv(t)},n.prototype.destroy=function(){this.removeEvent(),this.removeDom(),r.prototype.destroy.call(this)},n.prototype.init=function(){r.prototype.init.call(this),this.initContainer(),this.initDom(),this.resetStyles(),this.applyStyles(),this.initEvent(),this.initCapture(),this.initVisible()},n.prototype.initCapture=function(){this.setCapture(this.get("capture"))},n.prototype.initVisible=function(){this.get("visible")?this.show():this.hide()},n.prototype.initDom=function(){},n.prototype.initContainer=function(){var t=this.get("container");if(G(t)){t=this.createDom();var e=this.get("parent");lt(e)&&(e=document.getElementById(e),this.set("parent",e)),e.appendChild(t),this.get("containerId")&&t.setAttribute("id",this.get("containerId")),this.set("container",t)}else lt(t)&&(t=document.getElementById(t),this.set("container",t));this.get("parent")||this.set("parent",t.parentNode)},n.prototype.resetStyles=function(){var t=this.get("domStyles"),e=this.get("defaultStyles");t?t=J({},e,t):t=e,this.set("domStyles",t)},n.prototype.applyStyles=function(){var t=this.get("domStyles");if(!!t){var e=this.getContainer();this.applyChildrenStyles(e,t);var i=this.get("containerClassName");if(i&&fh(e,i)){var a=t[i];Xt(e,a)}}},n.prototype.applyChildrenStyles=function(t,e){var i=this;w(e,function(a,o){var s=t.getElementsByClassName(o);w(s,function(u){var l=i.get("containerClassName"),c=a;fh(u,Mr)&&l===ls&&(c=C(C({},a),{visibility:"unset",position:"unset"})),Xt(u,c)})})},n.prototype.applyStyle=function(t,e){var i=this.get("domStyles");Xt(e,i[t])},n.prototype.createDom=function(){var t=this.get("containerTpl");return wn(t)},n.prototype.initEvent=function(){},n.prototype.removeDom=function(){var t=this.get("container");t&&t.parentNode&&t.parentNode.removeChild(t)},n.prototype.removeEvent=function(){},n.prototype.updateInner=function(t){si(t,"domStyles")&&(this.resetStyles(),this.applyStyles()),this.resetPosition()},n.prototype.resetPosition=function(){},n}(aS),K5=function(r){R(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.getDefaultCfg=function(){var t=r.prototype.getDefaultCfg.call(this);return C(C({},t),{name:"annotation",type:"html",locationType:"point",x:0,y:0,containerTpl:'<div class="g2-html-annotation" style="position:absolute"></div>',alignX:"left",alignY:"top",html:"",zIndex:7})},n.prototype.render=function(){var t=this.getContainer(),e=this.get("html");zv(t);var i=rt(e)?e(t):e;if(oE(i))t.appendChild(i);else if(lt(i)||dt(i)){var a=wn(""+i);a&&t.appendChild(a)}this.resetPosition()},n.prototype.resetPosition=function(){var t=this.getContainer(),e=this.getLocation(),i=e.x,a=e.y,o=this.get("alignX"),s=this.get("alignY"),u=this.get("offsetX"),l=this.get("offsetY"),c=Vw(t),f=$w(t),h={x:i,y:a};o==="middle"?h.x-=Math.round(c/2):o==="right"&&(h.x-=Math.round(c)),s==="middle"?h.y-=Math.round(f/2):s==="bottom"&&(h.y-=Math.round(f)),u&&(h.x+=u),l&&(h.y+=l),Xt(t,{position:"absolute",left:h.x+"px",top:h.y+"px",zIndex:this.get("zIndex")})},n}($v);const Q5=Object.freeze(Object.defineProperty({__proto__:null,Line:H5,Text:$5,Arc:G5,Region:V5,Image:W5,DataMarker:j5,DataRegion:X5,RegionFilter:Y5,Shape:Z5,Html:K5},Symbol.toStringTag,{value:"Module"}));function $o(r,n,t){var e=n+"Style",i=null;return w(t,function(a,o){r[o]&&a[e]&&(i||(i={}),zt(i,a[e]))}),i}var sS=function(r){R(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.getDefaultCfg=function(){var t=r.prototype.getDefaultCfg.call(this);return C(C({},t),{name:"axis",ticks:[],line:{},tickLine:{},subTickLine:null,title:null,label:{},verticalFactor:1,verticalLimitLength:null,overlapOrder:["autoRotate","autoEllipsis","autoHide"],tickStates:{},optimize:{},defaultCfg:{line:{style:{lineWidth:1,stroke:bt.lineColor}},tickLine:{style:{lineWidth:1,stroke:bt.lineColor},alignTick:!0,length:5,displayWithLabel:!0},subTickLine:{style:{lineWidth:1,stroke:bt.lineColor},count:4,length:2},label:{autoRotate:!0,autoHide:!1,autoEllipsis:!1,style:{fontSize:12,fill:bt.textColor,fontFamily:bt.fontFamily,fontWeight:"normal"},offset:10,offsetX:0,offsetY:0},title:{autoRotate:!0,spacing:5,position:"center",style:{fontSize:12,fill:bt.textColor,textBaseline:"middle",fontFamily:bt.fontFamily,textAlign:"center"},iconStyle:{fill:bt.descriptionIconFill,stroke:bt.descriptionIconStroke},description:""},tickStates:{active:{labelStyle:{fontWeight:500},tickLineStyle:{lineWidth:2}},inactive:{labelStyle:{fill:bt.uncheckedColor}}},optimize:{enable:!0,threshold:400}},theme:{}})},n.prototype.renderInner=function(t){this.get("line")&&this.drawLine(t),this.drawTicks(t),this.get("title")&&this.drawTitle(t)},n.prototype.isList=function(){return!0},n.prototype.getItems=function(){return this.get("ticks")},n.prototype.setItems=function(t){this.update({ticks:t})},n.prototype.updateItem=function(t,e){zt(t,e),this.clear(),this.render()},n.prototype.clearItems=function(){var t=this.getElementByLocalId("label-group");t&&t.clear()},n.prototype.setItemState=function(t,e,i){t[e]=i,this.updateTickStates(t)},n.prototype.hasState=function(t,e){return!!t[e]},n.prototype.getItemStates=function(t){var e=this.get("tickStates"),i=[];return w(e,function(a,o){t[o]&&i.push(o)}),i},n.prototype.clearItemsState=function(t){var e=this,i=this.getItemsByState(t);w(i,function(a){e.setItemState(a,t,!1)})},n.prototype.getItemsByState=function(t){var e=this,i=this.getItems();return Pe(i,function(a){return e.hasState(a,t)})},n.prototype.getSidePoint=function(t,e){var i=this,a=i.getSideVector(e,t);return{x:t.x+a[0],y:t.y+a[1]}},n.prototype.getTextAnchor=function(t){var e;return we(t[0],0)?e="center":t[0]>0?e="start":t[0]<0&&(e="end"),e},n.prototype.getTextBaseline=function(t){var e;return we(t[1],0)?e="middle":t[1]>0?e="top":t[1]<0&&(e="bottom"),e},n.prototype.processOverlap=function(t){},n.prototype.drawLine=function(t){var e=this.getLinePath(),i=this.get("line");this.addShape(t,{type:"path",id:this.getElementId("line"),name:"axis-line",attrs:zt({path:e},i.style)})},n.prototype.getTickLineItems=function(t){var e=this,i=[],a=this.get("tickLine"),o=a.alignTick,s=a.length,u=1,l=t.length;return l>=2&&(u=t[1].value-t[0].value),w(t,function(c){var f=c.point;o||(f=e.getTickPoint(c.value-u/2));var h=e.getSidePoint(f,s);i.push({startPoint:f,tickValue:c.value,endPoint:h,tickId:c.id,id:"tickline-"+c.id})}),i},n.prototype.getSubTickLineItems=function(t){var e=[],i=this.get("subTickLine"),a=i.count,o=t.length;if(o>=2)for(var s=0;s<o-1;s++)for(var u=t[s],l=t[s+1],c=0;c<a;c++){var f=(c+1)/(a+1),h=(1-f)*u.tickValue+f*l.tickValue,v=this.getTickPoint(h),p=this.getSidePoint(v,i.length);e.push({startPoint:v,endPoint:p,tickValue:h,id:"sub-"+u.id+"-"+c})}return e},n.prototype.getTickLineAttrs=function(t,e,i,a){var o=this.get(e).style,s={points:[t.startPoint,t.endPoint]},u=F(this.get("theme"),["tickLine","style"],{});o=rt(o)?zt({},u,o(s,i,a)):o;var l=t.startPoint,c=t.endPoint;return C({x1:l.x,y1:l.y,x2:c.x,y2:c.y},o)},n.prototype.drawTick=function(t,e,i,a,o){this.addShape(e,{type:"line",id:this.getElementId(t.id),name:"axis-"+i,attrs:this.getTickLineAttrs(t,i,a,o)})},n.prototype.drawTickLines=function(t){var e=this,i=this.get("ticks"),a=this.get("subTickLine"),o=this.getTickLineItems(i),s=this.addGroup(t,{name:"axis-tickline-group",id:this.getElementId("tickline-group")}),u=this.get("tickLine");if(w(o,function(c,f){if(u.displayWithLabel){var h=e.getElementId("label-"+c.tickId);t.findById(h)&&e.drawTick(c,s,"tickLine",f,o)}else e.drawTick(c,s,"tickLine",f,o)}),a){var l=this.getSubTickLineItems(o);w(l,function(c,f){e.drawTick(c,s,"subTickLine",f,l)})}},n.prototype.processTicks=function(){var t=this,e=this.get("ticks");w(e,function(i){i.point=t.getTickPoint(i.value),G(i.id)&&(i.id=i.name)})},n.prototype.drawTicks=function(t){var e=this;this.optimizeTicks(),this.processTicks(),this.get("label")&&this.drawLabels(t),this.get("tickLine")&&this.drawTickLines(t);var i=this.get("ticks");w(i,function(a){e.applyTickStates(a,t)})},n.prototype.optimizeTicks=function(){var t=this.get("optimize"),e=this.get("ticks");if(t&&t.enable&&t.threshold>0){var i=Ee(e);if(i>t.threshold){var a=Math.ceil(i/t.threshold),o=e.filter(function(s,u){return u%a===0});this.set("ticks",o),this.set("originalTicks",e)}}},n.prototype.getLabelAttrs=function(t,e,i){var a=this.get("label"),o=a.offset,s=a.offsetX,u=a.offsetY,l=a.rotate,c=a.formatter,f=this.getSidePoint(t.point,o),h=this.getSideVector(o,f),v=c?c(t.name,t,e):t.name,p=a.style;p=rt(p)?F(this.get("theme"),["label","style"],{}):p;var d=zt({x:f.x+s,y:f.y+u,text:v,textAlign:this.getTextAnchor(h),textBaseline:this.getTextBaseline(h)},p);return l&&(d.matrix=ta(f,l)),d},n.prototype.drawLabels=function(t){var e=this,i=this.get("ticks"),a=this.addGroup(t,{name:"axis-label-group",id:this.getElementId("label-group")});w(i,function(h,v){e.addShape(a,{type:"text",name:"axis-label",id:e.getElementId("label-"+h.id),attrs:e.getLabelAttrs(h,v,i),delegateObject:{tick:h,item:h,index:v}})}),this.processOverlap(a);var o=a.getChildren(),s=F(this.get("theme"),["label","style"],{}),u=this.get("label"),l=u.style,c=u.formatter;if(rt(l)){var f=o.map(function(h){return F(h.get("delegateObject"),"tick")});w(o,function(h,v){var p=h.get("delegateObject").tick,d=c?c(p.name,p,v):p.name,g=zt({},s,l(d,v,f));h.attr(g)})}},n.prototype.getTitleAttrs=function(){var t=this.get("title"),e=t.style,i=t.position,a=t.offset,o=t.spacing,s=o===void 0?0:o,u=t.autoRotate,l=e.fontSize,c=.5;i==="start"?c=0:i==="end"&&(c=1);var f=this.getTickPoint(c),h=this.getSidePoint(f,a||s+l/2),v=zt({x:h.x,y:h.y,text:t.text},e),p=t.rotate,d=p;if(G(p)&&u){var g=this.getAxisVector(f),y=[1,0];d=kv(g,y,!0)}if(d){var m=ta(h,d);v.matrix=m}return v},n.prototype.drawTitle=function(t){var e,i=this.getTitleAttrs(),a=this.addShape(t,{type:"text",id:this.getElementId("title"),name:"axis-title",attrs:i});!((e=this.get("title"))===null||e===void 0)&&e.description&&this.drawDescriptionIcon(t,a,i.matrix)},n.prototype.drawDescriptionIcon=function(t,e,i){var a=this.addGroup(t,{name:"axis-description",id:this.getElementById("description")}),o=e.getBBox(),s=o.maxX,u=o.maxY,l=o.height,c=this.get("title").iconStyle,f=4,h=l/2,v=h/6,p=s+f,d=u-l/2,g=[p+h,d-h],y=g[0],m=g[1],x=[y+h,m+h],_=x[0],E=x[1],b=[y,E+h],M=b[0],T=b[1],k=[p,m+h],L=k[0],O=k[1],D=[p+h,d-l/4],W=D[0],j=D[1],ot=[W,j+v],z=ot[0],X=ot[1],K=[z,X+v],Q=K[0],q=K[1],at=[Q,q+h*3/4],pt=at[0],mt=at[1];this.addShape(a,{type:"path",id:this.getElementId("title-description-icon"),name:"axis-title-description-icon",attrs:C({path:[["M",y,m],["A",h,h,0,0,1,_,E],["A",h,h,0,0,1,M,T],["A",h,h,0,0,1,L,O],["A",h,h,0,0,1,y,m],["M",W,j],["L",z,X],["M",Q,q],["L",pt,mt]],lineWidth:v,matrix:i},c)}),this.addShape(a,{type:"rect",id:this.getElementId("title-description-rect"),name:"axis-title-description-rect",attrs:{x:p,y:d-l/2,width:l,height:l,stroke:"#000",fill:"#000",opacity:0,matrix:i,cursor:"pointer"}})},n.prototype.applyTickStates=function(t,e){var i=this.getItemStates(t);if(i.length){var a=this.get("tickStates"),o=this.getElementId("label-"+t.id),s=e.findById(o);if(s){var u=$o(t,"label",a);u&&s.attr(u)}var l=this.getElementId("tickline-"+t.id),c=e.findById(l);if(c){var f=$o(t,"tickLine",a);f&&c.attr(f)}}},n.prototype.updateTickStates=function(t){var e=this.getItemStates(t),i=this.get("tickStates"),a=this.get("label"),o=this.getElementByLocalId("label-"+t.id),s=this.get("tickLine"),u=this.getElementByLocalId("tickline-"+t.id);if(e.length){if(o){var l=$o(t,"label",i);l&&o.attr(l)}if(u){var c=$o(t,"tickLine",i);c&&u.attr(c)}}else o&&o.attr(a.style),u&&u.attr(s.style)},n}(Be);function Gv(r,n,t,e){var i=n.getChildren(),a=!1;return w(i,function(o){var s=Jo(r,o,t,e);a=a||s}),a}function J5(){return uS}function tk(r,n,t){return Gv(r,n,t,"head")}function uS(r,n,t){return Gv(r,n,t,"tail")}function ek(r,n,t){return Gv(r,n,t,"middle")}const rk=Object.freeze(Object.defineProperty({__proto__:null,getDefault:J5,ellipsisHead:tk,ellipsisTail:uS,ellipsisMiddle:ek},Symbol.toStringTag,{value:"Module"}));function nk(r){var n=r.attr("matrix");return n&&n[0]!==1}function lS(r){var n=nk(r)?A5(r.attr("matrix")):0;return n%360}function vh(r,n,t,e){var i=!1,a=lS(n),o=Math.abs(r?t.attr("y")-n.attr("y"):t.attr("x")-n.attr("x")),s=(r?t.attr("y")>n.attr("y"):t.attr("x")>n.attr("x"))?n.getBBox():t.getBBox();if(r){var u=Math.abs(Math.cos(a));ul(u,0,Math.PI/180)?i=s.width+e>o:i=s.height/u+e>o}else{var u=Math.abs(Math.sin(a));ul(u,0,Math.PI/180)?i=s.width+e>o:i=s.height/u+e>o}return i}function fs(r,n,t,e){var i=(e==null?void 0:e.minGap)||0,a=n.getChildren().slice().filter(function(v){return v.get("visible")});if(!a.length)return!1;var o=!1;t&&a.reverse();for(var s=a.length,u=a[0],l=u,c=1;c<s;c++){var f=a[c];f.getBBox();var h=vh(r,l,f,i);h?(f.hide(),o=!0):l=f}return o}function cS(r,n,t){var e=(t==null?void 0:t.minGap)||0,i=n.getChildren().slice();if(i.length<2)return!1;var a=!1,o=i[0],s=o.getBBox(),u=i[1],l=i.length,c=lS(o),f=Math.abs(r?u.attr("y")-o.attr("y"):u.attr("x")-o.attr("x")),h=0;if(r){var v=Math.abs(Math.cos(c));if(ul(v,0,Math.PI/180)){var p=hh(i);h=(p+e)/f}else h=(s.height/v+e)/f}else{var v=Math.abs(Math.sin(c));if(ul(v,0,Math.PI/180)){var p=hh(i);h=(p+e)/f}else h=(s.height/v+e)/f}if(h>1){h=Math.ceil(h);for(var d=0;d<l;d++)d%h!==0&&(i[d].hide(),a=!0)}return a}function ik(){return fS}function ak(r,n,t,e){return fs(r,n,!1,e)}function ok(r,n,t,e){return fs(r,n,!0,e)}function sk(r,n,t,e){var i=(e==null?void 0:e.minGap)||0,a=n.getChildren().slice();if(a.length<=2)return!1;for(var o=!1,s=a.length,u=a[0],l=a[s-1],c=u,f=1;f<s-1;f++){var h=a[f];h.getBBox();var v=vh(r,c,h,i);v?(h.hide(),o=!0):c=h}var p=vh(r,c,l,i);return p&&(c.hide(),o=!0),o}function fS(r,n,t,e){var i=cS(r,n,e);return fs(r,n,!1)&&(i=!0),i}function uk(r,n,t,e){var i=n.getChildren().slice(),a=cS(r,n,e);if(i.length>2){var o=i[0],s=i[i.length-1];o.get("visible")||(o.show(),fs(r,n,!1,e)&&(a=!0)),s.get("visible")||(s.show(),fs(r,n,!0,e)&&(a=!0))}return a}const lk=Object.freeze(Object.defineProperty({__proto__:null,getDefault:ik,reserveFirst:ak,reserveLast:ok,reserveBoth:sk,equidistance:fS,equidistanceWithReverseBoth:uk},Symbol.toStringTag,{value:"Module"}));function ck(r,n){w(r,function(t){var e=t.attr("x"),i=t.attr("y"),a=ta({x:e,y:i},n);t.attr("matrix",a)})}function hS(r,n,t,e){var i=n.getChildren();if(!i.length||!r&&i.length<2)return!1;var a=hh(i),o=!1;if(r)o=!!t&&a>t;else{var s=Math.abs(i[1].attr("x")-i[0].attr("x"));o=a>s}if(o){var u=e(t,a);ck(i,u)}return o}function fk(){return vS}function vS(r,n,t,e){return hS(r,n,t,function(){return dt(e)?e:r?bt.verticalAxisRotate:bt.horizontalAxisRotate})}function hk(r,n,t){return hS(r,n,t,function(e,i){if(!e)return r?bt.verticalAxisRotate:bt.horizontalAxisRotate;if(r)return-Math.acos(e/i);var a=0;return e>i?a=Math.PI/4:(a=Math.asin(e/i),a>Math.PI/4&&(a=Math.PI/4)),a})}const vk=Object.freeze(Object.defineProperty({__proto__:null,getDefault:fk,fixedAngle:vS,unfixedAngle:hk},Symbol.toStringTag,{value:"Module"})),pS=Object.freeze(Object.defineProperty({__proto__:null,autoHide:lk,autoRotate:vk,autoEllipsis:rk},Symbol.toStringTag,{value:"Module"}));var pk=function(r){R(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.getDefaultCfg=function(){var t=r.prototype.getDefaultCfg.call(this);return C(C({},t),{type:"line",locationType:"region",start:null,end:null})},n.prototype.getLinePath=function(){var t=this.get("start"),e=this.get("end"),i=[];return i.push(["M",t.x,t.y]),i.push(["L",e.x,e.y]),i},n.prototype.getInnerLayoutBBox=function(){var t=this.get("start"),e=this.get("end"),i=r.prototype.getInnerLayoutBBox.call(this),a=Math.min(t.x,e.x,i.x),o=Math.min(t.y,e.y,i.y),s=Math.max(t.x,e.x,i.maxX),u=Math.max(t.y,e.y,i.maxY);return{x:a,y:o,minX:a,minY:o,maxX:s,maxY:u,width:s-a,height:u-o}},n.prototype.isVertical=function(){var t=this.get("start"),e=this.get("end");return we(t.x,e.x)},n.prototype.isHorizontal=function(){var t=this.get("start"),e=this.get("end");return we(t.y,e.y)},n.prototype.getTickPoint=function(t){var e=this,i=e.get("start"),a=e.get("end"),o=a.x-i.x,s=a.y-i.y;return{x:i.x+o*t,y:i.y+s*t}},n.prototype.getSideVector=function(t){var e=this.getAxisVector(),i=kr([0,0],e),a=this.get("verticalFactor"),o=[i[1],i[0]*-1];return Ge([0,0],o,t*a)},n.prototype.getAxisVector=function(){var t=this.get("start"),e=this.get("end");return[e.x-t.x,e.y-t.y]},n.prototype.processOverlap=function(t){var e=this,i=this.isVertical(),a=this.isHorizontal();if(!(!i&&!a)){var o=this.get("label"),s=this.get("title"),u=this.get("verticalLimitLength"),l=o.offset,c=u,f=0,h=0;s&&(f=s.style.fontSize,h=s.spacing),c&&(c=c-l-h-f);var v=this.get("overlapOrder");if(w(v,function(g){o[g]&&e.canProcessOverlap(g)&&e.autoProcessOverlap(g,o[g],t,c)}),s&&G(s.offset)){var p=t.getCanvasBBox(),d=i?p.width:p.height;s.offset=l+d+h+f/2}}},n.prototype.canProcessOverlap=function(t){var e=this.get("label");return t==="autoRotate"?G(e.rotate):!0},n.prototype.autoProcessOverlap=function(t,e,i,a){var o=this,s=this.isVertical(),u=!1,l=pS[t];if(e===!0)this.get("label"),u=l.getDefault()(s,i,a);else if(rt(e))u=e(s,i,a);else if(wt(e)){var c=e;l[c.type]&&(u=l[c.type](s,i,a,c.cfg))}else l[e]&&(u=l[e](s,i,a));if(t==="autoRotate"){if(u){var f=i.getChildren(),h=this.get("verticalFactor");w(f,function(p){var d=p.attr("textAlign");if(d==="center"){var g=h>0?"end":"start";p.attr("textAlign",g)}})}}else if(t==="autoHide"){var v=i.getChildren().slice(0);w(v,function(p){p.get("visible")||(o.get("isRegister")&&o.unregisterElement(p),p.remove())})}},n}(sS),dk=function(r){R(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.getDefaultCfg=function(){var t=r.prototype.getDefaultCfg.call(this);return C(C({},t),{type:"circle",locationType:"circle",center:null,radius:null,startAngle:-Math.PI/2,endAngle:Math.PI*3/2})},n.prototype.getLinePath=function(){var t=this.get("center"),e=t.x,i=t.y,a=this.get("radius"),o=a,s=this.get("startAngle"),u=this.get("endAngle"),l=[];if(Math.abs(u-s)===Math.PI*2)l=[["M",e,i-o],["A",a,o,0,1,1,e,i+o],["A",a,o,0,1,1,e,i-o],["Z"]];else{var c=this.getCirclePoint(s),f=this.getCirclePoint(u),h=Math.abs(u-s)>Math.PI?1:0,v=s>u?0:1;l=[["M",e,i],["L",c.x,c.y],["A",a,o,0,h,v,f.x,f.y],["L",e,i]]}return l},n.prototype.getTickPoint=function(t){var e=this.get("startAngle"),i=this.get("endAngle"),a=e+(i-e)*t;return this.getCirclePoint(a)},n.prototype.getSideVector=function(t,e){var i=this.get("center"),a=[e.x-i.x,e.y-i.y],o=this.get("verticalFactor"),s=Da(a);return Ge(a,a,o*t/s),a},n.prototype.getAxisVector=function(t){var e=this.get("center"),i=[t.x-e.x,t.y-e.y];return[i[1],-1*i[0]]},n.prototype.getCirclePoint=function(t,e){var i=this.get("center");return e=e||this.get("radius"),{x:i.x+Math.cos(t)*e,y:i.y+Math.sin(t)*e}},n.prototype.canProcessOverlap=function(t){var e=this.get("label");return t==="autoRotate"?G(e.rotate):!0},n.prototype.processOverlap=function(t){var e=this,i=this.get("label"),a=this.get("title"),o=this.get("verticalLimitLength"),s=i.offset,u=o,l=0,c=0;a&&(l=a.style.fontSize,c=a.spacing),u&&(u=u-s-c-l);var f=this.get("overlapOrder");if(w(f,function(v){i[v]&&e.canProcessOverlap(v)&&e.autoProcessOverlap(v,i[v],t,u)}),a&&G(a.offset)){var h=t.getCanvasBBox().height;a.offset=s+h+c+l/2}},n.prototype.autoProcessOverlap=function(t,e,i,a){var o=this,s=!1,u=pS[t];if(a>0)if(e===!0)s=u.getDefault()(!1,i,a);else if(rt(e))s=e(!1,i,a);else if(wt(e)){var l=e;u[l.type]&&(s=u[l.type](!1,i,a,l.cfg))}else u[e]&&(s=u[e](!1,i,a));if(t==="autoRotate"){if(s){var c=i.getChildren(),f=this.get("verticalFactor");w(c,function(v){var p=v.attr("textAlign");if(p==="center"){var d=f>0?"end":"start";v.attr("textAlign",d)}})}}else if(t==="autoHide"){var h=i.getChildren().slice(0);w(h,function(v){v.get("visible")||(o.get("isRegister")&&o.unregisterElement(v),v.remove())})}},n}(sS),Vv=function(r){R(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.getDefaultCfg=function(){var t=r.prototype.getDefaultCfg.call(this);return C(C({},t),{name:"crosshair",type:"base",line:{},text:null,textBackground:{},capture:!1,defaultCfg:{line:{style:{lineWidth:1,stroke:bt.lineColor}},text:{position:"start",offset:10,autoRotate:!1,content:null,style:{fill:bt.textColor,textAlign:"center",textBaseline:"middle",fontFamily:bt.fontFamily}},textBackground:{padding:5,style:{stroke:bt.lineColor}}}})},n.prototype.renderInner=function(t){this.get("line")&&this.renderLine(t),this.get("text")&&(this.renderText(t),this.renderBackground(t))},n.prototype.renderText=function(t){var e=this.get("text"),i=e.style,a=e.autoRotate,o=e.content;if(!G(o)){var s=this.getTextPoint(),u=null;if(a){var l=this.getRotateAngle();u=ta(s,l)}this.addShape(t,{type:"text",name:"crosshair-text",id:this.getElementId("text"),attrs:C(C(C({},s),{text:o,matrix:u}),i)})}},n.prototype.renderLine=function(t){var e=this.getLinePath(),i=this.get("line"),a=i.style;this.addShape(t,{type:"path",name:"crosshair-line",id:this.getElementId("line"),attrs:C({path:e},a)})},n.prototype.renderBackground=function(t){var e=this.getElementId("text"),i=t.findById(e),a=this.get("textBackground");if(a&&i){var o=i.getBBox(),s=sl(a.padding),u=a.style,l=this.addShape(t,{type:"rect",name:"crosshair-text-background",id:this.getElementId("text-background"),attrs:C({x:o.x-s[3],y:o.y-s[0],width:o.width+s[1]+s[3],height:o.height+s[0]+s[2],matrix:i.attr("matrix")},u)});l.toBack()}},n}(Be),dS=function(r){R(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.getDefaultCfg=function(){var t=r.prototype.getDefaultCfg.call(this);return C(C({},t),{type:"line",locationType:"region",start:null,end:null})},n.prototype.getRotateAngle=function(){var t=this.getLocation(),e=t.start,i=t.end,a=this.get("text").position,o=Math.atan2(i.y-e.y,i.x-e.x),s=a==="start"?o-Math.PI/2:o+Math.PI/2;return s},n.prototype.getTextPoint=function(){var t=this.getLocation(),e=t.start,i=t.end,a=this.get("text"),o=a.position,s=a.offset;return iS(e,i,o,s)},n.prototype.getLinePath=function(){var t=this.getLocation(),e=t.start,i=t.end;return[["M",e.x,e.y],["L",i.x,i.y]]},n}(Vv),gk=function(r){R(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.getDefaultCfg=function(){var t=r.prototype.getDefaultCfg.call(this);return C(C({},t),{type:"circle",locationType:"circle",center:null,radius:100,startAngle:-Math.PI/2,endAngle:Math.PI*3/2})},n.prototype.getRotateAngle=function(){var t=this.getLocation(),e=t.startAngle,i=t.endAngle,a=this.get("text").position,o=a==="start"?e+Math.PI/2:i-Math.PI/2;return o},n.prototype.getTextPoint=function(){var t=this.get("text"),e=t.position,i=t.offset,a=this.getLocation(),o=a.center,s=a.radius,u=a.startAngle,l=a.endAngle,c=e==="start"?u:l,f=this.getRotateAngle()-Math.PI,h=Ua(o,s,c),v=Math.cos(f)*i,p=Math.sin(f)*i;return{x:h.x+v,y:h.y+p}},n.prototype.getLinePath=function(){var t=this.getLocation(),e=t.center,i=t.radius,a=t.startAngle,o=t.endAngle,s=null;if(o-a===Math.PI*2){var u=e.x,l=e.y;s=[["M",u,l-i],["A",i,i,0,1,1,u,l+i],["A",i,i,0,1,1,u,l-i],["Z"]]}else{var c=Ua(e,i,a),f=Ua(e,i,o),h=Math.abs(o-a)>Math.PI?1:0,v=a>o?0:1;s=[["M",c.x,c.y],["A",i,i,0,h,v,f.x,f.y]]}return s},n}(Vv),hs="g2-crosshair",ph=hs+"-line",dh=hs+"-text",bo;const yk=(bo={},bo[""+hs]={position:"relative"},bo[""+ph]={position:"absolute",backgroundColor:"rgba(0, 0, 0, 0.25)"},bo[""+dh]={position:"absolute",color:bt.textColor,fontFamily:bt.fontFamily},bo);var mk=function(r){R(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.getDefaultCfg=function(){var t=r.prototype.getDefaultCfg.call(this);return C(C({},t),{name:"crosshair",type:"html",locationType:"region",start:{x:0,y:0},end:{x:0,y:0},capture:!1,text:null,containerTpl:'<div class="'+hs+'"></div>',crosshairTpl:'<div class="'+ph+'"></div>',textTpl:'<span class="'+dh+'">{content}</span>',domStyles:null,containerClassName:hs,defaultStyles:yk,defaultCfg:{text:{position:"start",content:null,align:"center",offset:10}}})},n.prototype.render=function(){this.resetText(),this.resetPosition()},n.prototype.initCrossHair=function(){var t=this.getContainer(),e=this.get("crosshairTpl"),i=wn(e);t.appendChild(i),this.applyStyle(ph,i),this.set("crosshairEl",i)},n.prototype.getTextPoint=function(){var t=this.getLocation(),e=t.start,i=t.end,a=this.get("text"),o=a.position,s=a.offset;return iS(e,i,o,s)},n.prototype.resetText=function(){var t=this.get("text"),e=this.get("textEl");if(t){var i=t.content;if(!e){var a=this.getContainer(),o=Ps(this.get("textTpl"),t);e=wn(o),a.appendChild(e),this.applyStyle(dh,e),this.set("textEl",e)}e.innerHTML=i}else e&&e.remove()},n.prototype.isVertical=function(t,e){return t.x===e.x},n.prototype.resetPosition=function(){var t=this.get("crosshairEl");t||(this.initCrossHair(),t=this.get("crosshairEl"));var e=this.get("start"),i=this.get("end"),a=Math.min(e.x,i.x),o=Math.min(e.y,i.y);this.isVertical(e,i)?Xt(t,{width:"1px",height:qe(Math.abs(i.y-e.y))}):Xt(t,{height:"1px",width:qe(Math.abs(i.x-e.x))}),Xt(t,{top:qe(o),left:qe(a)}),this.alignText()},n.prototype.alignText=function(){var t=this.get("textEl");if(t){var e=this.get("text").align,i=t.clientWidth,a=this.getTextPoint();switch(e){case"center":a.x=a.x-i/2;break;case"right":a.x=a.x-i}Xt(t,{top:qe(a.y),left:qe(a.x)})}},n.prototype.updateInner=function(t){si(t,"text")&&this.resetText(),r.prototype.updateInner.call(this,t)},n}($v);const wg=Object.freeze(Object.defineProperty({__proto__:null,Line:dS,Circle:gk,Base:Vv,Html:mk},Symbol.toStringTag,{value:"Module"}));var gS=function(r){R(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.getDefaultCfg=function(){var t=r.prototype.getDefaultCfg.call(this);return C(C({},t),{name:"grid",line:{},alternateColor:null,capture:!1,items:[],closed:!1,defaultCfg:{line:{type:"line",style:{lineWidth:1,stroke:bt.lineColor}}}})},n.prototype.getLineType=function(){var t=this.get("line")||this.get("defaultCfg").line;return t.type},n.prototype.renderInner=function(t){this.drawGrid(t)},n.prototype.getAlternatePath=function(t,e){var i=this.getGridPath(t),a=e.slice(0).reverse(),o=this.getGridPath(a,!0),s=this.get("closed");return s?i=i.concat(o):(o[0][0]="L",i=i.concat(o),i.push(["Z"])),i},n.prototype.getPathStyle=function(){return this.get("line").style},n.prototype.drawGrid=function(t){var e=this,i=this.get("line"),a=this.get("items"),o=this.get("alternateColor"),s=null;w(a,function(u,l){var c=u.id||l;if(i){var f=e.getPathStyle();f=rt(f)?f(u,l,a):f;var h=e.getElementId("line-"+c),v=e.getGridPath(u.points);e.addShape(t,{type:"path",name:"grid-line",id:h,attrs:zt({path:v},f)})}if(o&&l>0){var p=e.getElementId("region-"+c),d=l%2===0;if(lt(o))d&&e.drawAlternateRegion(p,t,s.points,u.points,o);else{var g=d?o[1]:o[0];e.drawAlternateRegion(p,t,s.points,u.points,g)}}s=u})},n.prototype.drawAlternateRegion=function(t,e,i,a,o){var s=this.getAlternatePath(i,a);this.addShape(e,{type:"path",id:t,name:"grid-region",attrs:{path:s,fill:o}})},n}(Be);function xk(r,n,t,e){var i=t-r,a=e-n;return Math.sqrt(i*i+a*a)}var _k=function(r){R(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.getDefaultCfg=function(){var t=r.prototype.getDefaultCfg.call(this);return C(C({},t),{type:"circle",center:null,closed:!0})},n.prototype.getGridPath=function(t,e){var i=this.getLineType(),a=this.get("closed"),o=[];if(t.length)if(i==="circle"){var s=this.get("center"),u=t[0],l=xk(s.x,s.y,u.x,u.y),c=e?0:1;a?(o.push(["M",s.x,s.y-l]),o.push(["A",l,l,0,0,c,s.x,s.y+l]),o.push(["A",l,l,0,0,c,s.x,s.y-l]),o.push(["Z"])):w(t,function(f,h){h===0?o.push(["M",f.x,f.y]):o.push(["A",l,l,0,0,c,f.x,f.y])})}else w(t,function(f,h){h===0?o.push(["M",f.x,f.y]):o.push(["L",f.x,f.y])}),a&&o.push(["Z"]);return o},n}(gS),Ck=function(r){R(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.getDefaultCfg=function(){var t=r.prototype.getDefaultCfg.call(this);return C(C({},t),{type:"line"})},n.prototype.getGridPath=function(t){var e=[];return w(t,function(i,a){a===0?e.push(["M",i.x,i.y]):e.push(["L",i.x,i.y])}),e},n}(gS),yS=function(r){R(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.getDefaultCfg=function(){var t=r.prototype.getDefaultCfg.call(this);return C(C({},t),{name:"legend",layout:"horizontal",locationType:"point",x:0,y:0,offsetX:0,offsetY:0,title:null,background:null})},n.prototype.getLayoutBBox=function(){var t=r.prototype.getLayoutBBox.call(this),e=this.get("maxWidth"),i=this.get("maxHeight"),a=t.width,o=t.height;return e&&(a=Math.min(a,e)),i&&(o=Math.min(o,i)),ec(t.minX,t.minY,a,o)},n.prototype.setLocation=function(t){this.set("x",t.x),this.set("y",t.y),this.resetLocation()},n.prototype.resetLocation=function(){var t=this.get("x"),e=this.get("y"),i=this.get("offsetX"),a=this.get("offsetY");this.moveElementTo(this.get("group"),{x:t+i,y:e+a})},n.prototype.applyOffset=function(){this.resetLocation()},n.prototype.getDrawPoint=function(){return this.get("currentPoint")},n.prototype.setDrawPoint=function(t){return this.set("currentPoint",t)},n.prototype.renderInner=function(t){this.resetDraw(),this.get("title")&&this.drawTitle(t),this.drawLegendContent(t),this.get("background")&&this.drawBackground(t)},n.prototype.drawBackground=function(t){var e=this.get("background"),i=t.getBBox(),a=sl(e.padding),o=C({x:0,y:0,width:i.width+a[1]+a[3],height:i.height+a[0]+a[2]},e.style),s=this.addShape(t,{type:"rect",id:this.getElementId("background"),name:"legend-background",attrs:o});s.toBack()},n.prototype.drawTitle=function(t){var e=this.get("currentPoint"),i=this.get("title"),a=i.spacing,o=i.style,s=i.text,u=this.addShape(t,{type:"text",id:this.getElementId("title"),name:"legend-title",attrs:C({text:s,x:e.x,y:e.y},o)}),l=u.getBBox();this.set("currentPoint",{x:e.x,y:l.maxY+a})},n.prototype.resetDraw=function(){var t=this.get("background"),e={x:0,y:0};if(t){var i=sl(t.padding);e.x=i[3],e.y=i[0]}this.set("currentPoint",e)},n}(Be),qc={marker:{style:{inactiveFill:"#000",inactiveOpacity:.45,fill:"#000",opacity:1,size:12}},text:{style:{fill:"#ccc",fontSize:12}}},uu={fill:bt.textColor,fontSize:12,textAlign:"start",textBaseline:"middle",fontFamily:bt.fontFamily,fontWeight:"normal",lineHeight:12},Kc="navigation-arrow-right",Qc="navigation-arrow-left",Lg={right:90*Math.PI/180,left:(360-90)*Math.PI/180,up:0,down:180*Math.PI/180},Ek=function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.currentPageIndex=1,t.totalPagesCnt=1,t.pageWidth=0,t.pageHeight=0,t.startX=0,t.startY=0,t.onNavigationBack=function(){var e=t.getElementByLocalId("item-group");if(t.currentPageIndex>1){t.currentPageIndex-=1,t.updateNavigation();var i=t.getCurrentNavigationMatrix();t.get("animate")?e.animate({matrix:i},100):e.attr({matrix:i})}},t.onNavigationAfter=function(){var e=t.getElementByLocalId("item-group");if(t.currentPageIndex<t.totalPagesCnt){t.currentPageIndex+=1,t.updateNavigation();var i=t.getCurrentNavigationMatrix();t.get("animate")?e.animate({matrix:i},100):e.attr({matrix:i})}},t}return n.prototype.getDefaultCfg=function(){var t=r.prototype.getDefaultCfg.call(this);return C(C({},t),{name:"legend",type:"category",itemSpacing:24,itemMarginBottom:8,maxItemWidth:null,itemWidth:null,itemHeight:null,itemName:{},itemValue:null,maxWidth:null,maxHeight:null,marker:{},radio:null,items:[],itemStates:{},itemBackground:{},pageNavigator:{},defaultCfg:{title:{spacing:5,style:{fill:bt.textColor,fontSize:12,textAlign:"start",textBaseline:"top"}},background:{padding:5,style:{stroke:bt.lineColor}},itemBackground:{style:{opacity:0,fill:"#fff"}},pageNavigator:qc,itemName:{spacing:16,style:uu},marker:{spacing:8,style:{r:6,symbol:"circle"}},itemValue:{alignRight:!1,formatter:null,style:uu,spacing:6},itemStates:{active:{nameStyle:{opacity:.8}},unchecked:{nameStyle:{fill:bt.uncheckedColor},markerStyle:{fill:bt.uncheckedColor,stroke:bt.uncheckedColor}},inactive:{nameStyle:{fill:bt.uncheckedColor},markerStyle:{opacity:.2}}}}})},n.prototype.isList=function(){return!0},n.prototype.getItems=function(){return this.get("items")},n.prototype.setItems=function(t){this.update({items:t})},n.prototype.updateItem=function(t,e){zt(t,e),this.clear(),this.render()},n.prototype.clearItems=function(){var t=this.getElementByLocalId("item-group");t&&t.clear()},n.prototype.setItemState=function(t,e,i){t[e]=i;var a=this.getElementByLocalId("item-"+t.id);if(a){var o=this.getItems(),s=o.indexOf(t),u=this.createOffScreenGroup(),l=this.drawItem(t,s,this.getItemHeight(),u);this.updateElements(l,a),this.clearUpdateStatus(a)}},n.prototype.hasState=function(t,e){return!!t[e]},n.prototype.getItemStates=function(t){var e=this.get("itemStates"),i=[];return w(e,function(a,o){t[o]&&i.push(o)}),i},n.prototype.clearItemsState=function(t){var e=this,i=this.getItemsByState(t);w(i,function(a){e.setItemState(a,t,!1)})},n.prototype.getItemsByState=function(t){var e=this,i=this.getItems();return Pe(i,function(a){return e.hasState(a,t)})},n.prototype.drawLegendContent=function(t){this.processItems(),this.drawItems(t)},n.prototype.processItems=function(){var t=this.get("items");w(t,function(e){e.id||(e.id=e.name)})},n.prototype.drawItems=function(t){var e=this,i=this.addGroup(t,{id:this.getElementId("item-container-group"),name:"legend-item-container-group"}),a=this.addGroup(i,{id:this.getElementId("item-group"),name:"legend-item-group"}),o=this.getItemHeight(),s=this.get("itemWidth"),u=this.get("itemSpacing"),l=this.get("itemMarginBottom"),c=this.get("currentPoint"),f=c.x,h=c.y,v=this.get("layout"),p=this.get("items"),d=!1,g=0,y=this.get("maxWidth"),m=this.get("maxHeight");w(p,function(x,_){var E=e.drawItem(x,_,o,a),b=E.getBBox(),M=s||b.width;M>g&&(g=M),v==="horizontal"?(y&&y<c.x+M-f&&(d=!0,c.x=f,c.y+=o+l),e.moveElementTo(E,c),c.x+=M+u):(m&&m<c.y+o+l-h&&(d=!0,c.x+=g+u,c.y=h,g=0),e.moveElementTo(E,c),c.y+=o+l)}),d&&this.get("flipPage")&&(this.pageHeight=0,this.pageWidth=0,this.totalPagesCnt=1,this.startX=f,this.startY=h,this.adjustNavigation(t,a))},n.prototype.getItemHeight=function(){var t=this.get("itemHeight");if(!t){var e=(this.get("itemName")||{}).style;if(rt(e)){var i=this.getItems();i.forEach(function(a,o){var s=C(C({},uu),e(a,o,i)).fontSize;t<s&&(t=s)})}else e&&(t=e.fontSize)}return t},n.prototype.drawMarker=function(t,e,i,a){var o=C(C(C({x:0,y:a/2},e.style),{symbol:F(i.marker,"symbol","circle")}),F(i.marker,"style",{})),s=this.addShape(t,{type:"marker",id:this.getElementId("item-"+i.id+"-marker"),name:"legend-item-marker",attrs:o}),u=s.getBBox();s.attr("x",u.width/2);var l=s.attr(),c=l.stroke,f=l.fill;return c&&s.set("isStroke",!0),f&&s.set("isFill",!0),s},n.prototype.drawItemText=function(t,e,i,a,o,s,u){var l=i.formatter,c=i.style,f=C(C({x:s,y:o/2,text:l?l(a[e],a,u):a[e]},uu),rt(c)?c(a,u,this.getItems()):c);return this.addShape(t,{type:"text",id:this.getElementId("item-"+a.id+"-"+e),name:"legend-item-"+e,attrs:f})},n.prototype.drawRadio=function(t,e,i,a,o){var s,u,l=e.style||{},c=(s=l.r)!==null&&s!==void 0?s:a/2,f=c*3.6/8,h=[o+c,a/2-c],v=h[0],p=h[1],d=[v+c,p+c],g=d[0],y=d[1],m=[v,y+c],x=m[0],_=m[1],E=[o,p+c],b=E[0],M=E[1],T=i.showRadio,k=C(C({path:[["M",v,p],["A",c,c,0,0,1,g,y],["L",g-f,y],["L",g,y],["A",c,c,0,0,1,x,_],["L",x,_-f],["L",x,_],["A",c,c,0,0,1,b,M],["L",b+f,M],["L",b,M],["A",c,c,0,0,1,v,p],["L",v,p+f]],stroke:"#000000",fill:"#ffffff"},l),{opacity:T?(u=l==null?void 0:l.opacity)!==null&&u!==void 0?u:.45:0}),L=this.addShape(t,{type:"path",id:this.getElementId("item-"+i.id+"-radio"),name:"legend-item-radio",attrs:k});return L.set("tip",e.tip),L},n.prototype.drawItem=function(t,e,i,a){var o="item-"+t.id,s=this.addGroup(a,{name:"legend-item-container",id:this.getElementId("item-container-"+o),delegateObject:{item:t,index:e}}),u=this.addGroup(s,{name:"legend-item",id:this.getElementId(o),delegateObject:{item:t,index:e}}),l=this.get("marker"),c=this.get("itemName"),f=this.get("itemValue"),h=this.get("itemBackground"),v=this.get("radio"),p=this.getLimitItemWidth(),d=0;if(l){var g=this.drawMarker(u,l,t,i),y=l.spacing,m=F(t,["marker","spacing"]);dt(m)&&(y=m),d=g.getBBox().maxX+y}if(c){var x=this.drawItemText(u,"name",c,t,i,d,e);p&&Jo(!0,x,Kt(p-d,0,p)),d=x.getBBox().maxX+c.spacing}if(f){var _=this.drawItemText(u,"value",f,t,i,d,e);p&&(f.alignRight?(_.attr({textAlign:"right",x:p}),Jo(!0,_,Kt(p-d,0,p),"head")):Jo(!0,_,Kt(p-d,0,p))),d=_.getBBox().maxX+f.spacing}if(v&&this.drawRadio(u,v,t,i,d),h){var E=u.getBBox(),b=this.addShape(u,{type:"rect",name:"legend-item-background",id:this.getElementId(o+"-background"),attrs:C({x:0,y:0,width:E.width,height:i},h.style)});b.toBack()}return this.applyItemStates(t,u),u},n.prototype.adjustNavigation=function(t,e){var i=this,a=this.startX,o=this.startY,s=this.get("layout"),u=e.findAll(function(L){return L.get("name")==="legend-item"}),l=this.get("maxWidth"),c=this.get("maxHeight"),f=this.get("itemWidth"),h=this.get("itemSpacing"),v=this.getItemHeight(),p=J({},qc,this.get("pageNavigator")),d=this.drawNavigation(t,s,"00/00",p),g=d.getBBox(),y={x:a,y:o},m=1,x=0,_=0,E=0,b=this.get("itemMarginBottom");if(s==="horizontal"){var M=this.get("maxRow")||1,T=v+(M===1?0:b);this.pageHeight=T*M,w(u,function(L){var O=L.getBBox(),D=f||O.width;(x&&x<y.x+D+h||l<y.x+D+h+g.width)&&(m===1&&(x=y.x+h,i.pageWidth=x,i.moveElementTo(d,{x:l-h-g.width-g.minX,y:y.y+v/2-g.height/2-g.minY})),m+=1,y.x=a,y.y+=T),i.moveElementTo(L,y),L.getParent().setClip({type:"rect",attrs:{x:y.x,y:y.y,width:D+h,height:v}}),y.x+=D+h})}else{w(u,function(L){var O=L.getBBox();O.width>_&&(_=O.width)}),E=_,_+=h,l&&(_=Math.min(l,_),E=Math.min(l,E)),this.pageWidth=_,this.pageHeight=c-Math.max(g.height,v+b);var k=Math.floor(this.pageHeight/(v+b));w(u,function(L,O){O!==0&&O%k===0&&(m+=1,y.x+=_,y.y=o),i.moveElementTo(L,y),L.getParent().setClip({type:"rect",attrs:{x:y.x,y:y.y,width:_,height:v}}),y.y+=v+b}),this.totalPagesCnt=m,this.moveElementTo(d,{x:a+E/2-g.width/2-g.minX,y:c-g.height-g.minY})}this.pageHeight&&this.pageWidth&&e.getParent().setClip({type:"rect",attrs:{x:this.startX,y:this.startY,width:this.pageWidth,height:this.pageHeight}}),s==="horizontal"&&this.get("maxRow")?this.totalPagesCnt=Math.ceil(m/this.get("maxRow")):this.totalPagesCnt=m,this.currentPageIndex>this.totalPagesCnt&&(this.currentPageIndex=1),this.updateNavigation(d),e.attr("matrix",this.getCurrentNavigationMatrix())},n.prototype.drawNavigation=function(t,e,i,a){var o={x:0,y:0},s=this.addGroup(t,{id:this.getElementId("navigation-group"),name:"legend-navigation"}),u=F(a.marker,"style",{}),l=u.size,c=l===void 0?12:l,f=Tt(u,["size"]),h=this.drawArrow(s,o,Qc,e==="horizontal"?"up":"left",c,f);h.on("click",this.onNavigationBack);var v=h.getBBox();o.x+=v.width+2;var p=this.addShape(s,{type:"text",id:this.getElementId("navigation-text"),name:"navigation-text",attrs:C({x:o.x,y:o.y+c/2,text:i,textBaseline:"middle"},F(a.text,"style"))}),d=p.getBBox();o.x+=d.width+2;var g=this.drawArrow(s,o,Kc,e==="horizontal"?"down":"right",c,f);return g.on("click",this.onNavigationAfter),s},n.prototype.updateNavigation=function(t){var e=J({},qc,this.get("pageNavigator")),i=e.marker.style,a=i.fill,o=i.opacity,s=i.inactiveFill,u=i.inactiveOpacity,l=this.currentPageIndex+"/"+this.totalPagesCnt,c=t?t.getChildren()[1]:this.getElementByLocalId("navigation-text"),f=t?t.findById(this.getElementId(Qc)):this.getElementByLocalId(Qc),h=t?t.findById(this.getElementId(Kc)):this.getElementByLocalId(Kc);c.attr("text",l),f.attr("opacity",this.currentPageIndex===1?u:o),f.attr("fill",this.currentPageIndex===1?s:a),f.attr("cursor",this.currentPageIndex===1?"not-allowed":"pointer"),h.attr("opacity",this.currentPageIndex===this.totalPagesCnt?u:o),h.attr("fill",this.currentPageIndex===this.totalPagesCnt?s:a),h.attr("cursor",this.currentPageIndex===this.totalPagesCnt?"not-allowed":"pointer");var v=f.getBBox().maxX+2;c.attr("x",v),v+=c.getBBox().width+2,this.updateArrowPath(h,{x:v,y:0})},n.prototype.drawArrow=function(t,e,i,a,o,s){var u=e.x,l=e.y,c=this.addShape(t,{type:"path",id:this.getElementId(i),name:i,attrs:C({size:o,direction:a,path:[["M",u+o/2,l],["L",u,l+o],["L",u+o,l+o],["Z"]],cursor:"pointer"},s)});return c.attr("matrix",ta({x:u+o/2,y:l+o/2},Lg[a])),c},n.prototype.updateArrowPath=function(t,e){var i=e.x,a=e.y,o=t.attr(),s=o.size,u=o.direction,l=ta({x:i+s/2,y:a+s/2},Lg[u]);t.attr("path",[["M",i+s/2,a],["L",i,a+s],["L",i+s,a+s],["Z"]]),t.attr("matrix",l)},n.prototype.getCurrentNavigationMatrix=function(){var t=this,e=t.currentPageIndex,i=t.pageWidth,a=t.pageHeight,o=this.get("layout"),s=o==="horizontal"?{x:0,y:a*(1-e)}:{x:i*(1-e),y:0};return Nv(s)},n.prototype.applyItemStates=function(t,e){var i=this.getItemStates(t),a=i.length>0;if(a){var o=e.getChildren(),s=this.get("itemStates");w(o,function(u){var l=u.get("name"),c=l.split("-")[2],f=$o(t,c,s);f&&(u.attr(f),c==="marker"&&!(u.get("isStroke")&&u.get("isFill"))&&(u.get("isStroke")&&u.attr("fill",null),u.get("isFill")&&u.attr("stroke",null)))})}},n.prototype.getLimitItemWidth=function(){var t=this.get("itemWidth"),e=this.get("maxItemWidth");return e?t&&(e=t<=e?t:e):t&&(e=t),e},n}(yS),Sk=1.4,Fg=.4,bk=function(r){R(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.getDefaultCfg=function(){var t=r.prototype.getDefaultCfg.call(this);return C(C({},t),{type:"continue",min:0,max:100,value:null,colors:[],track:{},rail:{},label:{},handler:{},slidable:!0,tip:null,step:null,maxWidth:null,maxHeight:null,defaultCfg:{label:{align:"rail",spacing:5,formatter:null,style:{fontSize:12,fill:bt.textColor,textBaseline:"middle",fontFamily:bt.fontFamily}},handler:{size:10,style:{fill:"#fff",stroke:"#333"}},track:{},rail:{type:"color",size:20,defaultLength:100,style:{fill:"#DCDEE2"}},title:{spacing:5,style:{fill:bt.textColor,fontSize:12,textAlign:"start",textBaseline:"top"}}}})},n.prototype.isSlider=function(){return!0},n.prototype.getValue=function(){return this.getCurrentValue()},n.prototype.getRange=function(){return{min:this.get("min"),max:this.get("max")}},n.prototype.setRange=function(t,e){this.update({min:t,max:e})},n.prototype.setValue=function(t){var e=this.getValue();this.set("value",t);var i=this.get("group");this.resetTrackClip(),this.get("slidable")&&this.resetHandlers(i),this.delegateEmit("valuechanged",{originValue:e,value:t})},n.prototype.initEvent=function(){var t=this.get("group");this.bindSliderEvent(t),this.bindRailEvent(t),this.bindTrackEvent(t)},n.prototype.drawLegendContent=function(t){this.drawRail(t),this.drawLabels(t),this.fixedElements(t),this.resetTrack(t),this.resetTrackClip(t),this.get("slidable")&&this.resetHandlers(t)},n.prototype.bindSliderEvent=function(t){this.bindHandlersEvent(t)},n.prototype.bindHandlersEvent=function(t){var e=this;t.on("legend-handler-min:drag",function(i){var a=e.getValueByCanvasPoint(i.x,i.y),o=e.getCurrentValue(),s=o[1];s<a&&(s=a),e.setValue([a,s])}),t.on("legend-handler-max:drag",function(i){var a=e.getValueByCanvasPoint(i.x,i.y),o=e.getCurrentValue(),s=o[0];s>a&&(s=a),e.setValue([s,a])})},n.prototype.bindRailEvent=function(t){},n.prototype.bindTrackEvent=function(t){var e=this,i=null;t.on("legend-track:dragstart",function(a){i={x:a.x,y:a.y}}),t.on("legend-track:drag",function(a){if(!!i){var o=e.getValueByCanvasPoint(i.x,i.y),s=e.getValueByCanvasPoint(a.x,a.y),u=e.getCurrentValue(),l=u[1]-u[0],c=e.getRange(),f=s-o;f<0?u[0]+f>c.min?e.setValue([u[0]+f,u[1]+f]):e.setValue([c.min,c.min+l]):f>0&&(f>0&&u[1]+f<c.max?e.setValue([u[0]+f,u[1]+f]):e.setValue([c.max-l,c.max])),i={x:a.x,y:a.y}}}),t.on("legend-track:dragend",function(a){i=null})},n.prototype.drawLabels=function(t){this.drawLabel("min",t),this.drawLabel("max",t)},n.prototype.drawLabel=function(t,e){var i=this.get("label"),a=i.style,o=i.align,s=i.formatter,u=this.get(t),l=this.getLabelAlignAttrs(t,o),c="label-"+t;this.addShape(e,{type:"text",id:this.getElementId(c),name:"legend-label-"+t,attrs:C(C({x:0,y:0,text:rt(s)?s(u):u},a),l)})},n.prototype.getLabelAlignAttrs=function(t,e){var i=this.isVertical(),a="center",o="middle";return i?(a="start",e!=="rail"?t==="min"?o="top":o="bottom":o="top"):e!=="rail"?(o="top",t==="min"?a="start":a="end"):(a="start",o="middle"),{textAlign:a,textBaseline:o}},n.prototype.getRailPath=function(t,e,i,a){var o=this.get("rail"),s=o.size,u=o.defaultLength,l=o.type,c=this.isVertical(),f=u,h=i,v=a;h||(h=c?s:f),v||(v=c?f:s);var p=[];return l==="color"?(p.push(["M",t,e]),p.push(["L",t+h,e]),p.push(["L",t+h,e+v]),p.push(["L",t,e+v]),p.push(["Z"])):(p.push(["M",t+h,e]),p.push(["L",t+h,e+v]),p.push(["L",t,e+v]),p.push(["Z"])),p},n.prototype.drawRail=function(t){var e=this.get("rail"),i=e.style;this.addShape(t,{type:"path",id:this.getElementId("rail"),name:"legend-rail",attrs:C({path:this.getRailPath(0,0)},i)})},n.prototype.getTrackColor=function(t){var e=t.length;if(!e)return null;if(e===1)return t[0];var i;this.isVertical()?i="l(90)":i="l(0)";for(var a=0;a<e;a++){var o=a/(e-1);i+=" "+o+":"+t[a]}return i},n.prototype.getTrackPath=function(t){var e=this.getRailShape(t),i=e.attr("path");return Ve(i)},n.prototype.getClipTrackAttrs=function(t){var e=this.getCurrentValue(),i=e[0],a=e[1],o=this.getRailBBox(t),s=this.getPointByValue(i,t),u=this.getPointByValue(a,t),l=this.isVertical(),c,f,h,v;return l?(c=o.minX,f=s.y,h=o.width,v=u.y-s.y):(c=s.x,f=o.minY,h=u.x-s.x,v=o.height),{x:c,y:f,width:h,height:v}},n.prototype.getTrackAttrs=function(t){var e=this.get("track"),i=this.get("colors"),a=this.getTrackPath(t);return zt({path:a,fill:this.getTrackColor(i)},e.style)},n.prototype.resetTrackClip=function(t){var e=t||this.get("group"),i=this.getElementId("track"),a=e.findById(i),o=a.getClip(),s=this.getClipTrackAttrs(t);o?o.attr(s):a.setClip({type:"rect",attrs:s})},n.prototype.resetTrack=function(t){var e=this.getElementId("track"),i=t.findById(e),a=this.getTrackAttrs(t);i?i.attr(a):this.addShape(t,{type:"path",id:e,draggable:this.get("slidable"),name:"legend-track",attrs:a})},n.prototype.getPointByValue=function(t,e){var i=this.getRange(),a=i.min,o=i.max,s=(t-a)/(o-a),u=this.getRailBBox(e),l=this.isVertical(),c={x:0,y:0};return l?(c.x=u.minX+u.width/2,c.y=qi(u.minY,u.maxY,s)):(c.x=qi(u.minX,u.maxX,s),c.y=u.minY+u.height/2),c},n.prototype.getRailShape=function(t){var e=t||this.get("group");return e.findById(this.getElementId("rail"))},n.prototype.getRailBBox=function(t){var e=this.getRailShape(t),i=e.getBBox();return i},n.prototype.getRailCanvasBBox=function(){var t=this.get("group"),e=t.findById(this.getElementId("rail")),i=e.getCanvasBBox();return i},n.prototype.isVertical=function(){return this.get("layout")==="vertical"},n.prototype.getValueByCanvasPoint=function(t,e){var i=this.getRange(),a=i.min,o=i.max,s=this.getRailCanvasBBox(),u=this.isVertical(),l=this.get("step"),c;u?c=(e-s.minY)/s.height:c=(t-s.minX)/s.width;var f=qi(a,o,c);if(l){var h=Math.round((f-a)/l);f=a+h*l}return f>o&&(f=o),f<a&&(f=a),f},n.prototype.getCurrentValue=function(){var t=this.get("value");if(!t){var e=this.get("values");return e?[Math.max(Math.min.apply(Math,Yt(e,[this.get("max")])),this.get("min")),Math.min(Math.max.apply(Math,Yt(e,[this.get("min")])),this.get("max"))]:[this.get("min"),this.get("max")]}return t},n.prototype.resetHandlers=function(t){var e=this.getCurrentValue(),i=e[0],a=e[1];this.resetHandler(t,"min",i),this.resetHandler(t,"max",a)},n.prototype.getHandlerPath=function(t,e){var i=this.isVertical(),a=[],o=t.size,s=e.x,u=e.y,l=o*Sk,c=o/2,f=o/6;if(i){var h=s+l*Fg;a.push(["M",s,u]),a.push(["L",h,u+c]),a.push(["L",s+l,u+c]),a.push(["L",s+l,u-c]),a.push(["L",h,u-c]),a.push(["Z"]),a.push(["M",h,u+f]),a.push(["L",s+l-2,u+f]),a.push(["M",h,u-f]),a.push(["L",s+l-2,u-f])}else{var v=u+l*Fg;a.push(["M",s,u]),a.push(["L",s-c,v]),a.push(["L",s-c,u+l]),a.push(["L",s+c,u+l]),a.push(["L",s+c,v]),a.push(["Z"]),a.push(["M",s-f,v]),a.push(["L",s-f,u+l-2]),a.push(["M",s+f,v]),a.push(["L",s+f,u+l-2])}return a},n.prototype.resetHandler=function(t,e,i){var a=this.getPointByValue(i,t),o=this.get("handler"),s=this.getHandlerPath(o,a),u=this.getElementId("handler-"+e),l=t.findById(u),c=this.isVertical();l?l.attr("path",s):this.addShape(t,{type:"path",name:"legend-handler-"+e,draggable:!0,id:u,attrs:C(C({path:s},o.style),{cursor:c?"ns-resize":"ew-resize"})})},n.prototype.fixedElements=function(t){var e=t.findById(this.getElementId("rail")),i=t.findById(this.getElementId("label-min")),a=t.findById(this.getElementId("label-max")),o=this.getDrawPoint();this.isVertical()?this.fixedVertail(i,a,e,o):this.fixedHorizontal(i,a,e,o)},n.prototype.fitRailLength=function(t,e,i,a){var o=this.isVertical(),s=o?"height":"width",u=this.get("label"),l=u.align,c=u.spacing,f=this.get("max"+ca(s));if(f){var h=l==="rail"?i[s]+t[s]+e[s]+c*2:i[s],v=h-f;v>0&&this.changeRailLength(a,s,i[s]-v)}},n.prototype.changeRailLength=function(t,e,i){var a=t.getBBox(),o;e==="height"?o=this.getRailPath(a.x,a.y,a.width,i):o=this.getRailPath(a.x,a.y,i,a.height),t.attr("path",o)},n.prototype.changeRailPosition=function(t,e,i){var a=t.getBBox(),o=this.getRailPath(e,i,a.width,a.height);t.attr("path",o)},n.prototype.fixedHorizontal=function(t,e,i,a){var o=this.get("label"),s=o.align,u=o.spacing,l=i.getBBox(),c=t.getBBox(),f=e.getBBox(),h=l.height;this.fitRailLength(c,f,l,i),l=i.getBBox(),s==="rail"?(t.attr({x:a.x,y:a.y+h/2}),this.changeRailPosition(i,a.x+c.width+u,a.y),e.attr({x:a.x+c.width+l.width+u*2,y:a.y+h/2})):s==="top"?(t.attr({x:a.x,y:a.y}),e.attr({x:a.x+l.width,y:a.y}),this.changeRailPosition(i,a.x,a.y+c.height+u)):(this.changeRailPosition(i,a.x,a.y),t.attr({x:a.x,y:a.y+l.height+u}),e.attr({x:a.x+l.width,y:a.y+l.height+u}))},n.prototype.fixedVertail=function(t,e,i,a){var o=this.get("label"),s=o.align,u=o.spacing,l=i.getBBox(),c=t.getBBox(),f=e.getBBox();if(this.fitRailLength(c,f,l,i),l=i.getBBox(),s==="rail")t.attr({x:a.x,y:a.y}),this.changeRailPosition(i,a.x,a.y+c.height+u),e.attr({x:a.x,y:a.y+c.height+l.height+u*2});else if(s==="right")t.attr({x:a.x+l.width+u,y:a.y}),this.changeRailPosition(i,a.x,a.y),e.attr({x:a.x+l.width+u,y:a.y+l.height});else{var h=Math.max(c.width,f.width);t.attr({x:a.x,y:a.y}),this.changeRailPosition(i,a.x+h+u,a.y),e.attr({x:a.x,y:a.y+l.height})}},n}(yS),$r;const Ak=($r={},$r[""+Mr]={position:"absolute",visibility:"visible",zIndex:8,transition:"visibility 0.2s cubic-bezier(0.23, 1, 0.32, 1), left 0.4s cubic-bezier(0.23, 1, 0.32, 1), top 0.4s cubic-bezier(0.23, 1, 0.32, 1)",backgroundColor:"rgba(255, 255, 255, 0.9)",boxShadow:"0px 0px 10px #aeaeae",borderRadius:"3px",color:"rgb(87, 87, 87)",fontSize:"12px",fontFamily:bt.fontFamily,lineHeight:"20px",padding:"10px 10px 6px 10px"},$r[""+ls]={position:"absolute",zIndex:8,transition:"visibility 0.2s cubic-bezier(0.23, 1, 0.32, 1), left 0.4s cubic-bezier(0.23, 1, 0.32, 1), top 0.4s cubic-bezier(0.23, 1, 0.32, 1)"},$r[""+On]={marginBottom:"4px"},$r[""+cs]={margin:"0px",listStyleType:"none",padding:"0px"},$r[""+nc]={listStyleType:"none",marginBottom:"4px"},$r[""+ic]={width:"8px",height:"8px",borderRadius:"50%",display:"inline-block",marginRight:"8px"},$r[""+ac]={display:"inline-block",float:"right",marginLeft:"30px"},$r[""+Uv]={position:"absolute",width:"1px",backgroundColor:"rgba(0, 0, 0, 0.25)"},$r[""+Hv]={position:"absolute",height:"1px",backgroundColor:"rgba(0, 0, 0, 0.25)"},$r);function Tk(r,n,t,e,i){var a={left:r<i.x,right:r+t>i.x+i.width,top:n<i.y,bottom:n+e>i.y+i.height};return a}function Mk(r,n,t,e,i,a){var o=r,s=n;switch(a){case"left":o=r-e-t,s=n-i/2;break;case"right":o=r+t,s=n-i/2;break;case"top":o=r-e/2,s=n-i-t;break;case"bottom":o=r-e/2,s=n+t;break;default:o=r+t,s=n-i-t;break}return{x:o,y:s}}function wk(r,n,t,e,i,a,o){var s=Mk(r,n,t,e,i,a);if(o){var u=Tk(s.x,s.y,e,i,o);a==="auto"?(u.right&&(s.x=Math.max(0,r-e-t)),u.top&&(s.y=Math.max(0,n-i-t))):a==="top"||a==="bottom"?(u.left&&(s.x=o.x),u.right&&(s.x=o.x+o.width-e),a==="top"&&u.top&&(s.y=n+t),a==="bottom"&&u.bottom&&(s.y=n-i-t)):(u.top&&(s.y=o.y),u.bottom&&(s.y=o.y+o.height-i),a==="left"&&u.left&&(s.x=r+t),a==="right"&&u.right&&(s.x=r-e-t))}return s}function Lk(r,n){var t=!1;return w(n,function(e){if(si(r,e))return t=!0,!1}),t}var Fk=function(r){R(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.getDefaultCfg=function(){var t=r.prototype.getDefaultCfg.call(this);return C(C({},t),{name:"tooltip",type:"html",x:0,y:0,items:[],customContent:null,containerTpl:'<div class="'+Mr+'"><div class="'+On+'"></div><ul class="'+cs+'"></ul></div>',itemTpl:'<li class="'+nc+`" data-index={index}>
          <span class="`+ic+`" style="background:{color}"></span>
          <span class="`+oS+`">{name}</span>:
          <span class="`+ac+`">{value}</span>
        </li>`,xCrosshairTpl:'<div class="'+Uv+'"></div>',yCrosshairTpl:'<div class="'+Hv+'"></div>',title:null,showTitle:!0,region:null,crosshairsRegion:null,containerClassName:Mr,crosshairs:null,offset:10,position:"right",domStyles:null,defaultStyles:Ak})},n.prototype.render=function(){this.get("customContent")?this.renderCustomContent():(this.resetTitle(),this.renderItems()),this.resetPosition()},n.prototype.clear=function(){this.clearCrosshairs(),this.setTitle(""),this.clearItemDoms()},n.prototype.show=function(){var t=this.getContainer();!t||this.destroyed||(this.set("visible",!0),Xt(t,{visibility:"visible"}),this.setCrossHairsVisible(!0))},n.prototype.hide=function(){var t=this.getContainer();!t||this.destroyed||(this.set("visible",!1),Xt(t,{visibility:"hidden"}),this.setCrossHairsVisible(!1))},n.prototype.getLocation=function(){return{x:this.get("x"),y:this.get("y")}},n.prototype.setLocation=function(t){this.set("x",t.x),this.set("y",t.y),this.resetPosition()},n.prototype.setCrossHairsVisible=function(t){var e=t?"":"none",i=this.get("xCrosshairDom"),a=this.get("yCrosshairDom");i&&Xt(i,{display:e}),a&&Xt(a,{display:e})},n.prototype.setCustomContainer=function(){var t=document.createElement("div");t.className=ls,this.set("container",t),this.set("containerClassName",ls)},n.prototype.initContainer=function(){if(r.prototype.initContainer.call(this),this.get("customContent")){this.get("container")&&this.get("container").remove(),this.setCustomContainer();var t=this.getHtmlContentNode(),e=this.get("container");e.appendChild(t),this.get("parent").appendChild(e),this.resetStyles(),this.applyStyles()}},n.prototype.updateInner=function(t){this.get("customContent")?this.renderCustomContent():(Lk(t,["title","showTitle"])&&this.resetTitle(),si(t,"items")&&this.renderItems()),r.prototype.updateInner.call(this,t)},n.prototype.initDom=function(){this.cacheDoms()},n.prototype.removeDom=function(){r.prototype.removeDom.call(this),this.clearCrosshairs()},n.prototype.resetPosition=function(){var t=this.get("x"),e=this.get("y"),i=this.get("offset"),a=this.getOffset(),o=a.offsetX,s=a.offsetY,u=this.get("position"),l=this.get("region"),c=this.getContainer(),f=this.getBBox(),h=f.width,v=f.height,p;l&&(p=us(l));var d=wk(t,e,i,h,v,u,p);Xt(c,{left:qe(d.x+o),top:qe(d.y+s)}),this.resetCrosshairs()},n.prototype.renderCustomContent=function(){var t=this.getHtmlContentNode(),e=this.get("container"),i=fh(e,Mr);if(i){this.setCustomContainer(),e=this.get("container");var a=this.get("parent"),o=a.querySelector("."+Mr);a.removeChild(o)}e.innerHTML="",e.appendChild(t),i&&this.get("parent").appendChild(e),this.resetStyles(),this.applyStyles()},n.prototype.getHtmlContentNode=function(){var t,e=this.get("customContent");if(e){var i=e(this.get("title"),this.get("items"));oE(i)?t=i:t=wn(i)}return t},n.prototype.cacheDoms=function(){var t=this.getContainer(),e=t.getElementsByClassName(On)[0],i=t.getElementsByClassName(cs)[0];this.set("titleDom",e),this.set("listDom",i)},n.prototype.resetTitle=function(){var t=this.get("title"),e=this.get("showTitle");e&&t?this.setTitle(t):this.setTitle("")},n.prototype.setTitle=function(t){var e=this.get("titleDom");e&&(e.innerText=t)},n.prototype.resetCrosshairs=function(){var t=this.get("crosshairsRegion"),e=this.get("crosshairs");if(!t||!e)this.clearCrosshairs();else{var i=us(t),a=this.get("xCrosshairDom"),o=this.get("yCrosshairDom");e==="x"?(this.resetCrosshair("x",i),o&&(o.remove(),this.set("yCrosshairDom",null))):e==="y"?(this.resetCrosshair("y",i),a&&(a.remove(),this.set("xCrosshairDom",null))):(this.resetCrosshair("x",i),this.resetCrosshair("y",i)),this.setCrossHairsVisible(this.get("visible"))}},n.prototype.resetCrosshair=function(t,e){var i=this.checkCrosshair(t),a=this.get(t);t==="x"?Xt(i,{left:qe(a),top:qe(e.y),height:qe(e.height)}):Xt(i,{top:qe(a),left:qe(e.x),width:qe(e.width)})},n.prototype.checkCrosshair=function(t){var e=t+"CrosshairDom",i=t+"CrosshairTpl",a="CROSSHAIR_"+t.toUpperCase(),o=q5[a],s=this.get(e),u=this.get("parent");return s||(s=wn(this.get(i)),this.applyStyle(o,s),u.appendChild(s),this.set(e,s)),s},n.prototype.renderItems=function(){this.clearItemDoms();var t=this.get("items"),e=this.get("itemTpl"),i=this.get("listDom");i&&(w(t,function(a){var o=ii.toCSSGradient(a.color),s=C(C({},a),{color:o}),u=Ps(e,s),l=wn(u);i.appendChild(l)}),this.applyChildrenStyles(i,this.get("domStyles")))},n.prototype.clearItemDoms=function(){this.get("listDom")&&zv(this.get("listDom"))},n.prototype.clearCrosshairs=function(){var t=this.get("xCrosshairDom"),e=this.get("yCrosshairDom");t&&t.remove(),e&&e.remove(),this.set("xCrosshairDom",null),this.set("yCrosshairDom",null)},n}($v),kk={opacity:0},Ok={stroke:"#C5C5C5",strokeOpacity:.85},Rk={fill:"#CACED4",opacity:.85};function Ik(r){return ie(r,function(n,t){var e=t===0?"M":"L",i=n[0],a=n[1];return[e,i,a]})}function mS(r){return Ik(r)}function Dk(r){if(r.length<=2)return mS(r);var n=[];w(r,function(o){Dt(o,n.slice(n.length-2))||n.push(o[0],o[1])});var t=tF(n,!1),e=pr(r),i=e[0],a=e[1];return t.unshift(["M",i,a]),t}function Pk(r,n,t,e){e===void 0&&(e=!0);var i=new Jl({values:r}),a=new Kl({values:ie(r,function(s,u){return u})}),o=ie(r,function(s,u){return[a.scale(u)*n,t-i.scale(s)*t]});return e?Dk(o):mS(o)}function Bk(r,n){var t=new Jl({values:r}),e=t.max<0?t.max:Math.max(0,t.min);return n-t.scale(e)*n}function Nk(r,n,t,e){var i=Yt(r),a=Bk(e,t);return i.push(["L",n,a]),i.push(["L",0,a]),i.push(["Z"]),i}var zk=function(r){R(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.getDefaultCfg=function(){var t=r.prototype.getDefaultCfg.call(this);return C(C({},t),{name:"trend",x:0,y:0,width:200,height:16,smooth:!0,isArea:!1,data:[],backgroundStyle:kk,lineStyle:Ok,areaStyle:Rk})},n.prototype.renderInner=function(t){var e=this.cfg,i=e.width,a=e.height,o=e.data,s=e.smooth,u=e.isArea,l=e.backgroundStyle,c=e.lineStyle,f=e.areaStyle;this.addShape(t,{id:this.getElementId("background"),type:"rect",attrs:C({x:0,y:0,width:i,height:a},l)});var h=Pk(o,i,a,s);if(this.addShape(t,{id:this.getElementId("line"),type:"path",attrs:C({path:h},c)}),u){var v=Nk(h,i,a,o);this.addShape(t,{id:this.getElementId("area"),type:"path",attrs:C({path:v},f)})}},n.prototype.applyOffset=function(){var t=this.cfg,e=t.x,i=t.y;this.moveElementTo(this.get("group"),{x:e,y:i})},n}(Be),xS={fill:"#F7F7F7",stroke:"#BFBFBF",radius:2,opacity:1,cursor:"ew-resize",highLightFill:"#FFF"},kg=function(r){R(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.getDefaultCfg=function(){var t=r.prototype.getDefaultCfg.call(this);return C(C({},t),{name:"handler",x:0,y:0,width:10,height:24,style:xS})},n.prototype.renderInner=function(t){var e=this.cfg,i=e.width,a=e.height,o=e.style,s=o.fill,u=o.stroke,l=o.radius,c=o.opacity,f=o.cursor;this.addShape(t,{type:"rect",id:this.getElementId("background"),attrs:{x:0,y:0,width:i,height:a,fill:s,stroke:u,radius:l,opacity:c,cursor:f}});var h=1/3*i,v=2/3*i,p=1/4*a,d=3/4*a;this.addShape(t,{id:this.getElementId("line-left"),type:"line",attrs:{x1:h,y1:p,x2:h,y2:d,stroke:u,cursor:f}}),this.addShape(t,{id:this.getElementId("line-right"),type:"line",attrs:{x1:v,y1:p,x2:v,y2:d,stroke:u,cursor:f}})},n.prototype.applyOffset=function(){this.moveElementTo(this.get("group"),{x:this.get("x"),y:this.get("y")})},n.prototype.initEvent=function(){this.bindEvents()},n.prototype.bindEvents=function(){var t=this;this.get("group").on("mouseenter",function(){var e=t.get("style").highLightFill;t.getElementByLocalId("background").attr("fill",e),t.draw()}),this.get("group").on("mouseleave",function(){var e=t.get("style").fill;t.getElementByLocalId("background").attr("fill",e),t.draw()})},n.prototype.draw=function(){var t=this.get("container").get("canvas");t&&t.draw()},n}(Be),Uk={fill:"#416180",opacity:.05},Hk={fill:"#5B8FF9",opacity:.15,cursor:"move"},Wu=10,$k={width:Wu,height:24},Gk={textBaseline:"middle",fill:"#000",opacity:.45},Vk="sliderchange",Wk=function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.onMouseDown=function(e){return function(i){t.currentTarget=e;var a=i.originalEvent;a.stopPropagation(),a.preventDefault(),t.prevX=F(a,"touches.0.pageX",a.pageX),t.prevY=F(a,"touches.0.pageY",a.pageY);var o=t.getContainerDOM();o.addEventListener("mousemove",t.onMouseMove),o.addEventListener("mouseup",t.onMouseUp),o.addEventListener("mouseleave",t.onMouseUp),o.addEventListener("touchmove",t.onMouseMove),o.addEventListener("touchend",t.onMouseUp),o.addEventListener("touchcancel",t.onMouseUp)}},t.onMouseMove=function(e){var i=t.cfg.width,a=[t.get("start"),t.get("end")];e.stopPropagation(),e.preventDefault();var o=F(e,"touches.0.pageX",e.pageX),s=F(e,"touches.0.pageY",e.pageY),u=o-t.prevX,l=t.adjustOffsetRange(u/i);t.updateStartEnd(l),t.updateUI(t.getElementByLocalId("foreground"),t.getElementByLocalId("minText"),t.getElementByLocalId("maxText")),t.prevX=o,t.prevY=s,t.draw(),t.emit(Vk,[t.get("start"),t.get("end")].sort()),t.delegateEmit("valuechanged",{originValue:a,value:[t.get("start"),t.get("end")]})},t.onMouseUp=function(){t.currentTarget&&(t.currentTarget=void 0);var e=t.getContainerDOM();e&&(e.removeEventListener("mousemove",t.onMouseMove),e.removeEventListener("mouseup",t.onMouseUp),e.removeEventListener("mouseleave",t.onMouseUp),e.removeEventListener("touchmove",t.onMouseMove),e.removeEventListener("touchend",t.onMouseUp),e.removeEventListener("touchcancel",t.onMouseUp))},t}return n.prototype.setRange=function(t,e){this.set("minLimit",t),this.set("maxLimit",e);var i=this.get("start"),a=this.get("end"),o=Kt(i,t,e),s=Kt(a,t,e);!this.get("isInit")&&(i!==o||a!==s)&&this.setValue([o,s])},n.prototype.getRange=function(){return{min:this.get("minLimit")||0,max:this.get("maxLimit")||1}},n.prototype.setValue=function(t){var e=this.getRange();if(V(t)&&t.length===2){var i=[this.get("start"),this.get("end")];this.update({start:Kt(t[0],e.min,e.max),end:Kt(t[1],e.min,e.max)}),this.get("updateAutoRender")||this.render(),this.delegateEmit("valuechanged",{originValue:i,value:t})}},n.prototype.getValue=function(){return[this.get("start"),this.get("end")]},n.prototype.getDefaultCfg=function(){var t=r.prototype.getDefaultCfg.call(this);return C(C({},t),{name:"slider",x:0,y:0,width:100,height:16,backgroundStyle:{},foregroundStyle:{},handlerStyle:{},textStyle:{},defaultCfg:{backgroundStyle:Uk,foregroundStyle:Hk,handlerStyle:$k,textStyle:Gk}})},n.prototype.update=function(t){var e=t.start,i=t.end,a=C({},t);G(e)||(a.start=Kt(e,0,1)),G(i)||(a.end=Kt(i,0,1)),r.prototype.update.call(this,a),this.minHandler=this.getChildComponentById(this.getElementId("minHandler")),this.maxHandler=this.getChildComponentById(this.getElementId("maxHandler")),this.trend=this.getChildComponentById(this.getElementId("trend"))},n.prototype.init=function(){this.set("start",Kt(this.get("start"),0,1)),this.set("end",Kt(this.get("end"),0,1)),r.prototype.init.call(this)},n.prototype.render=function(){r.prototype.render.call(this),this.updateUI(this.getElementByLocalId("foreground"),this.getElementByLocalId("minText"),this.getElementByLocalId("maxText"))},n.prototype.renderInner=function(t){var e=this.cfg;e.start,e.end;var i=e.width,a=e.height,o=e.trendCfg,s=o===void 0?{}:o,u=e.minText,l=e.maxText,c=e.backgroundStyle,f=c===void 0?{}:c,h=e.foregroundStyle,v=h===void 0?{}:h,p=e.textStyle,d=p===void 0?{}:p,g=J({},xS,this.cfg.handlerStyle);Ee(F(s,"data"))&&(this.trend=this.addComponent(t,C({component:zk,id:this.getElementId("trend"),x:0,y:0,width:i,height:a},s))),this.addShape(t,{id:this.getElementId("background"),type:"rect",attrs:C({x:0,y:0,width:i,height:a},f)}),this.addShape(t,{id:this.getElementId("minText"),type:"text",attrs:C({y:a/2,textAlign:"right",text:u,silent:!1},d)}),this.addShape(t,{id:this.getElementId("maxText"),type:"text",attrs:C({y:a/2,textAlign:"left",text:l,silent:!1},d)}),this.addShape(t,{id:this.getElementId("foreground"),name:"foreground",type:"rect",attrs:C({y:0,height:a},v)});var y=F(g,"width",Wu),m=F(g,"height",24);this.minHandler=this.addComponent(t,{component:kg,id:this.getElementId("minHandler"),name:"handler-min",x:0,y:(a-m)/2,width:y,height:m,cursor:"ew-resize",style:g}),this.maxHandler=this.addComponent(t,{component:kg,id:this.getElementId("maxHandler"),name:"handler-max",x:0,y:(a-m)/2,width:y,height:m,cursor:"ew-resize",style:g})},n.prototype.applyOffset=function(){this.moveElementTo(this.get("group"),{x:this.get("x"),y:this.get("y")})},n.prototype.initEvent=function(){this.bindEvents()},n.prototype.updateUI=function(t,e,i){var a=this.cfg,o=a.start,s=a.end,u=a.width,l=a.minText,c=a.maxText,f=a.handlerStyle,h=a.height,v=o*u,p=s*u;this.trend&&(this.trend.update({width:u,height:h}),this.get("updateAutoRender")||this.trend.render()),t.attr("x",v),t.attr("width",p-v);var d=F(f,"width",Wu);e.attr("text",l),i.attr("text",c);var g=this._dodgeText([v,p],e,i),y=g[0],m=g[1];this.minHandler&&(this.minHandler.update({x:v-d/2}),this.get("updateAutoRender")||this.minHandler.render()),w(y,function(x,_){return e.attr(_,x)}),this.maxHandler&&(this.maxHandler.update({x:p-d/2}),this.get("updateAutoRender")||this.maxHandler.render()),w(m,function(x,_){return i.attr(_,x)})},n.prototype.bindEvents=function(){var t=this.get("group");t.on("handler-min:mousedown",this.onMouseDown("minHandler")),t.on("handler-min:touchstart",this.onMouseDown("minHandler")),t.on("handler-max:mousedown",this.onMouseDown("maxHandler")),t.on("handler-max:touchstart",this.onMouseDown("maxHandler"));var e=t.findById(this.getElementId("foreground"));e.on("mousedown",this.onMouseDown("foreground")),e.on("touchstart",this.onMouseDown("foreground"))},n.prototype.adjustOffsetRange=function(t){var e=this.cfg,i=e.start,a=e.end;switch(this.currentTarget){case"minHandler":{var o=0-i,s=1-i;return Math.min(s,Math.max(o,t))}case"maxHandler":{var o=0-a,s=1-a;return Math.min(s,Math.max(o,t))}case"foreground":{var o=0-i,s=1-a;return Math.min(s,Math.max(o,t))}}},n.prototype.updateStartEnd=function(t){var e=this.cfg,i=e.start,a=e.end;switch(this.currentTarget){case"minHandler":i+=t;break;case"maxHandler":a+=t;break;case"foreground":i+=t,a+=t;break}this.set("start",i),this.set("end",a)},n.prototype._dodgeText=function(t,e,i){var a,o,s=this.cfg,u=s.handlerStyle,l=s.width,c=2,f=F(u,"width",Wu),h=t[0],v=t[1],p=!1;h>v&&(a=[v,h],h=a[0],v=a[1],o=[i,e],e=o[0],i=o[1],p=!0);var d=e.getBBox(),g=i.getBBox(),y=d.width>h-c?{x:h+f/2+c,textAlign:"left"}:{x:h-f/2-c,textAlign:"right"},m=g.width>l-v-c?{x:v-f/2-c,textAlign:"right"}:{x:v+f/2+c,textAlign:"left"};return p?[m,y]:[y,m]},n.prototype.draw=function(){var t=this.get("container"),e=t&&t.get("canvas");e&&e.draw()},n.prototype.getContainerDOM=function(){var t=this.get("container"),e=t&&t.get("canvas");return e&&e.get("container")},n}(Be),jk={trackColor:"rgba(0,0,0,0)",thumbColor:"rgba(0,0,0,0.15)",size:8,lineCap:"round"},Jc={default:jk,hover:{thumbColor:"rgba(0,0,0,0.2)"}},Xk=function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.clearEvents=ti,t.onStartEvent=function(e){return function(i){t.isMobile=e,i.originalEvent.preventDefault();var a=e?F(i.originalEvent,"touches.0.clientX"):i.clientX,o=e?F(i.originalEvent,"touches.0.clientY"):i.clientY;t.startPos=t.cfg.isHorizontal?a:o,t.bindLaterEvent()}},t.bindLaterEvent=function(){var e=t.getContainerDOM(),i=[];t.isMobile?i=[ma(e,"touchmove",t.onMouseMove),ma(e,"touchend",t.onMouseUp),ma(e,"touchcancel",t.onMouseUp)]:i=[ma(e,"mousemove",t.onMouseMove),ma(e,"mouseup",t.onMouseUp),ma(e,"mouseleave",t.onMouseUp)],t.clearEvents=function(){i.forEach(function(a){a.remove()})}},t.onMouseMove=function(e){var i=t.cfg,a=i.isHorizontal,o=i.thumbOffset;e.preventDefault();var s=t.isMobile?F(e,"touches.0.clientX"):e.clientX,u=t.isMobile?F(e,"touches.0.clientY"):e.clientY,l=a?s:u,c=l-t.startPos;t.startPos=l,t.updateThumbOffset(o+c)},t.onMouseUp=function(e){e.preventDefault(),t.clearEvents()},t.onTrackClick=function(e){var i=t.cfg,a=i.isHorizontal,o=i.x,s=i.y,u=i.thumbLen,l=t.getContainerDOM(),c=l.getBoundingClientRect(),f=e.clientX,h=e.clientY,v=a?f-c.left-o-u/2:h-c.top-s-u/2,p=t.validateRange(v);t.updateThumbOffset(p)},t.onThumbMouseOver=function(){var e=t.cfg.theme.hover.thumbColor;t.getElementByLocalId("thumb").attr("stroke",e),t.draw()},t.onThumbMouseOut=function(){var e=t.cfg.theme.default.thumbColor;t.getElementByLocalId("thumb").attr("stroke",e),t.draw()},t}return n.prototype.setRange=function(t,e){this.set("minLimit",t),this.set("maxLimit",e);var i=this.getValue(),a=Kt(i,t,e);i!==a&&!this.get("isInit")&&this.setValue(a)},n.prototype.getRange=function(){var t=this.get("minLimit")||0,e=this.get("maxLimit")||1;return{min:t,max:e}},n.prototype.setValue=function(t){var e=this.getRange(),i=this.getValue();this.update({thumbOffset:(this.get("trackLen")-this.get("thumbLen"))*Kt(t,e.min,e.max)}),this.delegateEmit("valuechange",{originalValue:i,value:this.getValue()})},n.prototype.getValue=function(){return Kt(this.get("thumbOffset")/(this.get("trackLen")-this.get("thumbLen")),0,1)},n.prototype.getDefaultCfg=function(){var t=r.prototype.getDefaultCfg.call(this);return C(C({},t),{name:"scrollbar",isHorizontal:!0,minThumbLen:20,thumbOffset:0,theme:Jc})},n.prototype.renderInner=function(t){this.renderTrackShape(t),this.renderThumbShape(t)},n.prototype.applyOffset=function(){this.moveElementTo(this.get("group"),{x:this.get("x"),y:this.get("y")})},n.prototype.initEvent=function(){this.bindEvents()},n.prototype.renderTrackShape=function(t){var e=this.cfg,i=e.trackLen,a=e.theme,o=a===void 0?{default:{}}:a,s=J({},Jc,o).default,u=s.lineCap,l=s.trackColor,c=s.size,f=F(this.cfg,"size",c),h=this.get("isHorizontal")?{x1:0+f/2,y1:f/2,x2:i-f/2,y2:f/2,lineWidth:f,stroke:l,lineCap:u}:{x1:f/2,y1:0+f/2,x2:f/2,y2:i-f/2,lineWidth:f,stroke:l,lineCap:u};return this.addShape(t,{id:this.getElementId("track"),name:"track",type:"line",attrs:h})},n.prototype.renderThumbShape=function(t){var e=this.cfg,i=e.thumbOffset,a=e.thumbLen,o=e.theme,s=J({},Jc,o).default,u=s.size,l=s.lineCap,c=s.thumbColor,f=F(this.cfg,"size",u),h=this.get("isHorizontal")?{x1:i+f/2,y1:f/2,x2:i+a-f/2,y2:f/2,lineWidth:f,stroke:c,lineCap:l,cursor:"default"}:{x1:f/2,y1:i+f/2,x2:f/2,y2:i+a-f/2,lineWidth:f,stroke:c,lineCap:l,cursor:"default"};return this.addShape(t,{id:this.getElementId("thumb"),name:"thumb",type:"line",attrs:h})},n.prototype.bindEvents=function(){var t=this.get("group");t.on("mousedown",this.onStartEvent(!1)),t.on("mouseup",this.onMouseUp),t.on("touchstart",this.onStartEvent(!0)),t.on("touchend",this.onMouseUp);var e=t.findById(this.getElementId("track"));e.on("click",this.onTrackClick);var i=t.findById(this.getElementId("thumb"));i.on("mouseover",this.onThumbMouseOver),i.on("mouseout",this.onThumbMouseOut)},n.prototype.getContainerDOM=function(){var t=this.get("container"),e=t&&t.get("canvas");return e&&e.get("container")},n.prototype.validateRange=function(t){var e=this.cfg,i=e.thumbLen,a=e.trackLen,o=t;return t+i>a?o=a-i:t+i<i&&(o=0),o},n.prototype.draw=function(){var t=this.get("container"),e=t&&t.get("canvas");e&&e.draw()},n.prototype.updateThumbOffset=function(t){var e=this.cfg,i=e.thumbOffset,a=e.isHorizontal,o=e.thumbLen,s=e.size,u=this.validateRange(t);if(u!==i){var l=this.getElementByLocalId("thumb");a?l.attr({x1:u+s/2,x2:u+o-s/2}):l.attr({y1:u+s/2,y2:u+o-s/2}),this.emitOffsetChange(u)}},n.prototype.emitOffsetChange=function(t){var e=this.cfg,i=e.thumbOffset,a=e.trackLen,o=e.thumbLen;this.cfg.thumbOffset=t,this.emit("scrollchange",{thumbOffset:t,ratio:Kt(t/(a-o),0,1)}),this.delegateEmit("valuechange",{originalValue:i,value:t})},n}(Be),Yk=pk,Zk=dk,qk=Ck,Kk=_k,Og=Ek,Qk=bk,oc=Fk;function Jk(r){if(nr(r))return null;var n=r[0].x,t=r[0].x,e=r[0].y,i=r[0].y;return w(r,function(a){n=n>a.x?a.x:n,t=t<a.x?a.x:t,e=e>a.y?a.y:e,i=i<a.y?a.y:i}),{minX:n,maxX:t,minY:e,maxY:i,centerX:(n+t)/2,centerY:(e+i)/2}}function Rg(r){return Array.from(new Set(r)).length===1}function Ig(r){return(er(r)+We(r))/2}function fe(r,n,t,e){return{x:r+t*Math.cos(e),y:n+t*Math.sin(e)}}function ai(r,n,t,e,i,a){a===void 0&&(a=0);var o=fe(r,n,t,e),s=fe(r,n,t,i),u=fe(r,n,a,e),l=fe(r,n,a,i);if(i-e===Math.PI*2){var c=fe(r,n,t,e+Math.PI),f=fe(r,n,a,e+Math.PI),h=[["M",o.x,o.y],["A",t,t,0,1,1,c.x,c.y],["A",t,t,0,1,1,s.x,s.y],["M",u.x,u.y]];return a&&(h.push(["A",a,a,0,1,0,f.x,f.y]),h.push(["A",a,a,0,1,0,l.x,l.y])),h.push(["M",o.x,o.y]),h.push(["Z"]),h}var v=i-e<=Math.PI?0:1,p=[["M",o.x,o.y],["A",t,t,0,v,1,s.x,s.y],["L",l.x,l.y]];return a&&p.push(["A",a,a,0,v,0,u.x,u.y]),p.push(["L",o.x,o.y]),p.push(["Z"]),p}function _S(r,n,t,e,i){var a=fe(r,n,t,e),o=fe(r,n,t,i);if(we(i-e,Math.PI*2)){var s=fe(r,n,t,e+Math.PI);return[["M",a.x,a.y],["A",t,t,0,1,1,s.x,s.y],["A",t,t,0,1,1,a.x,a.y],["A",t,t,0,1,0,s.x,s.y],["A",t,t,0,1,0,a.x,a.y],["Z"]]}var u=i-e<=Math.PI?0:1;return[["M",a.x,a.y],["A",t,t,0,u,1,o.x,o.y]]}function vs(r,n){var t=r.points,e=Jk(t),i,a,o=n.startAngle,s=n.endAngle,u=s-o;return n.isTransposed?(i=e.maxY*u,a=e.minY*u):(i=e.maxX*u,a=e.minX*u),i+=o,a+=o,{startAngle:a,endAngle:i}}function tO(r,n){if(dt(r)&&dt(n))return[r,n];if(r=r,n=n,Rg(r)||Rg(n))return[Ig(r),Ig(n)];for(var t=-1,e=0,i=0,a,o=r.length-1,s,u=0;++t<r.length;)a=o,o=t,u+=s=r[a]*n[o]-r[o]*n[a],e+=(r[a]+r[o])*s,i+=(n[a]+n[o])*s;return u*=3,[e/u,i/u]}function CS(r,n){var t=r.attr(),e=n.attr();return w(t,function(i,a){e[a]===void 0&&(e[a]=void 0)}),e}function Na(r,n,t){var e=Math.min(n,t),i=Math.max(n,t);return r>=e&&r<=i}function eO(r,n,t){if(lt(r))return r.padEnd(n,t);if(V(r)){var e=r.length;if(e<n)for(var i=n-e,a=0;a<i;a++)r.push(t)}return r}function Ke(r,n){return typeof r=="object"&&n.forEach(function(t){delete r[t]}),r}function Jn(r,n,t){var e,i;n===void 0&&(n=[]),t===void 0&&(t=new Map);try{for(var a=It(r),o=a.next();!o.done;o=a.next()){var s=o.value;t.has(s)||(n.push(s),t.set(s,!0))}}catch(u){e={error:u}}finally{try{o&&!o.done&&(i=a.return)&&i.call(a)}finally{if(e)throw e.error}}return n}var je=function(){function r(n,t,e,i){n===void 0&&(n=0),t===void 0&&(t=0),e===void 0&&(e=0),i===void 0&&(i=0),this.x=n,this.y=t,this.height=i,this.width=e}return r.fromRange=function(n,t,e,i){return new r(n,t,e-n,i-t)},r.fromObject=function(n){return new r(n.minX,n.minY,n.width,n.height)},Object.defineProperty(r.prototype,"minX",{get:function(){return this.x},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"maxX",{get:function(){return this.x+this.width},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"minY",{get:function(){return this.y},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"maxY",{get:function(){return this.y+this.height},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"tl",{get:function(){return{x:this.x,y:this.y}},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"tr",{get:function(){return{x:this.maxX,y:this.y}},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"bl",{get:function(){return{x:this.x,y:this.maxY}},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"br",{get:function(){return{x:this.maxX,y:this.maxY}},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"top",{get:function(){return{x:this.x+this.width/2,y:this.minY}},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"right",{get:function(){return{x:this.maxX,y:this.y+this.height/2}},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"bottom",{get:function(){return{x:this.x+this.width/2,y:this.maxY}},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"left",{get:function(){return{x:this.minX,y:this.y+this.height/2}},enumerable:!1,configurable:!0}),r.prototype.isEqual=function(n){return this.x===n.x&&this.y===n.y&&this.width===n.width&&this.height===n.height},r.prototype.contains=function(n){return n.minX>=this.minX&&n.maxX<=this.maxX&&n.minY>=this.minY&&n.maxY<=this.maxY},r.prototype.clone=function(){return new r(this.x,this.y,this.width,this.height)},r.prototype.add=function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];var e=this.clone();return w(n,function(i){e.x=Math.min(i.x,e.x),e.y=Math.min(i.y,e.y),e.width=Math.max(i.maxX,e.maxX)-e.x,e.height=Math.max(i.maxY,e.maxY)-e.y}),e},r.prototype.merge=function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];var e=this.clone();return w(n,function(i){e.x=Math.max(i.x,e.x),e.y=Math.max(i.y,e.y),e.width=Math.min(i.maxX,e.maxX)-e.x,e.height=Math.min(i.maxY,e.maxY)-e.y}),e},r.prototype.cut=function(n,t){var e=n.width,i=n.height;switch(t){case Z.TOP:case Z.TOP_LEFT:case Z.TOP_RIGHT:return r.fromRange(this.minX,this.minY+i,this.maxX,this.maxY);case Z.RIGHT:case Z.RIGHT_TOP:case Z.RIGHT_BOTTOM:return r.fromRange(this.minX,this.minY,this.maxX-e,this.maxY);case Z.BOTTOM:case Z.BOTTOM_LEFT:case Z.BOTTOM_RIGHT:return r.fromRange(this.minX,this.minY,this.maxX,this.maxY-i);case Z.LEFT:case Z.LEFT_TOP:case Z.LEFT_BOTTOM:return r.fromRange(this.minX+e,this.minY,this.maxX,this.maxY);default:return this}},r.prototype.shrink=function(n){var t=ut(n,4),e=t[0],i=t[1],a=t[2],o=t[3];return new r(this.x+o,this.y+e,this.width-o-i,this.height-e-a)},r.prototype.expand=function(n){var t=ut(n,4),e=t[0],i=t[1],a=t[2],o=t[3];return new r(this.x-o,this.y-e,this.width+o+i,this.height+e+a)},r.prototype.exceed=function(n){return[Math.max(-this.minY+n.minY,0),Math.max(this.maxX-n.maxX,0),Math.max(this.maxY-n.maxY,0),Math.max(-this.minX+n.minX,0)]},r.prototype.collide=function(n){return this.minX<n.maxX&&this.maxX>n.minX&&this.minY<n.maxY&&this.maxY>n.minY},r.prototype.size=function(){return this.width*this.height},r.prototype.isPointIn=function(n){return n.x>=this.minX&&n.x<=this.maxX&&n.y>=this.minY&&n.y<=this.maxY},r}();function rO(r){return[[r.minX,r.minY],[r.maxX,r.minY],[r.maxX,r.maxY],[r.minX,r.maxY]]}function Hs(r){if(r.isPolar&&!r.isTransposed)return(r.endAngle-r.startAngle)*r.getRadius();var n=r.convert({x:0,y:0}),t=r.convert({x:1,y:0});return Math.sqrt(Math.pow(t.x-n.x,2)+Math.pow(t.y-n.y,2))}function nO(r){if(r.isPolar){var n=r.startAngle,t=r.endAngle;return t-n===Math.PI*2}return!1}function sc(r,n){var t=r.getCenter();return Math.sqrt(Math.pow(n.x-t.x,2)+Math.pow(n.y-t.y,2))}function iO(r,n){var t=!1;if(r)if(r.type==="theta"){var e=r.start,i=r.end;t=Na(n.x,e.x,i.x)&&Na(n.y,e.y,i.y)}else{var a=r.invert(n);t=Na(a.x,0,1)&&Na(a.y,0,1)}return t}function Ka(r,n){var t=r.getCenter();return Math.atan2(n.y-t.y,n.x-t.x)}function Wv(r,n){n===void 0&&(n=0);var t=r.start,e=r.end,i=r.getWidth(),a=r.getHeight();if(r.isPolar){var o=r.startAngle,s=r.endAngle,u=r.getCenter(),l=r.getRadius();return{type:"path",startState:{path:ai(u.x,u.y,l+n,o,o)},endState:function(f){var h=(s-o)*f+o,v=ai(u.x,u.y,l+n,o,h);return{path:v}},attrs:{path:ai(u.x,u.y,l+n,o,s)}}}var c;return r.isTransposed?c={height:a+n*2}:c={width:i+n*2},{type:"rect",startState:{x:t.x-n,y:e.y-n,width:r.isTransposed?i+n*2:0,height:r.isTransposed?0:a+n*2},endState:c,attrs:{x:t.x-n,y:e.y-n,width:i+n*2,height:a+n*2}}}function aO(r,n){n===void 0&&(n=0);var t=r.start,e=r.end,i=r.getWidth(),a=r.getHeight(),o=Math.min(t.x,e.x),s=Math.min(t.y,e.y);return je.fromRange(o-n,s-n,o+i+n,s+a+n)}var oO=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]+)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/;function sO(r){var n="linear";return oO.test(r)?n="timeCat":lt(r)&&(n="cat"),n}function ES(r,n,t,e){return n===void 0&&(n={}),n.type?n.type:r.type!=="identity"&&Pa.includes(t)&&["interval"].includes(e)||r.isCategory?"cat":r.type}function uO(r,n,t){var e=n||[];if(dt(r)||G(pw(e,r))&&nr(t)){var i=lh("identity");return new i({field:r.toString(),values:[r]})}var a=Yr(e,r),o=F(t,"type",sO(a[0])),s=lh(o);return new s(C({field:r,values:a},t))}function lO(r,n){if(r.type!=="identity"&&n.type!=="identity"){var t={};for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e]);r.change(t)}}function ps(r){return r.alias||r.field}function SS(r,n,t){var e=r.values,i=e.length,a;if(i===1)a=[.5,1];else{var o=1,s=0;nO(n)?n.isTransposed?(o=F(t,"widthRatio.multiplePie",1/1.3),s=1/i*o,a=[s/2,1-s/2]):a=[0,1-1/i]:(s=1/i/2,a=[s,1-s])}return a}function cO(r){var n=r.values.filter(function(t){return!G(t)&&!isNaN(t)});return Math.max.apply(Math,te(te([],ut(n),!1),[G(r.max)?-1/0:r.max],!1))}function fO(r){var n,t;switch(r){case Z.TOP:n={x:0,y:1},t={x:1,y:1};break;case Z.RIGHT:n={x:1,y:0},t={x:1,y:1};break;case Z.BOTTOM:n={x:0,y:0},t={x:1,y:0};break;case Z.LEFT:n={x:0,y:0},t={x:0,y:1};break;default:n=t={x:0,y:0}}return{start:n,end:t}}function hO(r){var n,t;return r.isTransposed?(n={x:0,y:0},t={x:1,y:0}):(n={x:0,y:0},t={x:0,y:1}),{start:n,end:t}}function lu(r,n){var t={start:{x:0,y:0},end:{x:0,y:0}};r.isRect?t=fO(n):r.isPolar&&(t=hO(r));var e=t.start,i=t.end;return{start:r.convert(e),end:r.convert(i)}}function bS(r){var n=r.start,t=r.end;return n.x===t.x}function Dg(r,n){var t=r.start,e=r.end,i=bS(r);return i?(t.y-e.y)*(n.x-t.x)>0?1:-1:(e.x-t.x)*(t.y-n.y)>0?-1:1}function cu(r,n){var t=F(r,["components","axis"],{});return J({},F(t,["common"],{}),J({},F(t,[n],{})))}function Pg(r,n,t){var e=F(r,["components","axis"],{});return J({},F(e,["common","title"],{}),J({},F(e,[n,"title"],{})),t)}function tf(r){var n=r.x,t=r.y,e=r.circleCenter,i=t.start>t.end,a=r.isTransposed?r.convert({x:i?0:1,y:0}):r.convert({x:0,y:i?0:1}),o=[a.x-e.x,a.y-e.y],s=[1,0],u=a.y>e.y?jf(o,s):jf(o,s)*-1,l=u+(n.end-n.start),c=Math.sqrt(Math.pow(a.x-e.x,2)+Math.pow(a.y-e.y,2));return{center:e,radius:c,startAngle:u,endAngle:l}}function ll(r,n){return ui(r)?r===!1?!1:{}:F(r,[n])}function Bg(r,n){return F(r,"position",n)}function Ng(r,n){return F(n,["title","text"],ps(r))}var lo=function(){function r(n,t){this.destroyed=!1,this.facets=[],this.view=n,this.cfg=J({},this.getDefaultCfg(),t)}return r.prototype.init=function(){this.container||(this.container=this.createContainer());var n=this.view.getData();this.facets=this.generateFacets(n)},r.prototype.render=function(){this.renderViews()},r.prototype.update=function(){},r.prototype.clear=function(){this.clearFacetViews()},r.prototype.destroy=function(){this.clear(),this.container&&(this.container.remove(!0),this.container=void 0),this.destroyed=!0,this.view=void 0,this.facets=[]},r.prototype.facetToView=function(n){var t=n.region,e=n.data,i=n.padding,a=i===void 0?this.cfg.padding:i,o=this.view.createView({region:t,padding:a});o.data(e||[]),n.view=o,this.beforeEachView(o,n);var s=this.cfg.eachView;return s&&s(o,n),this.afterEachView(o,n),o},r.prototype.createContainer=function(){var n=this.view.getLayer(ue.FORE);return n.addGroup()},r.prototype.renderViews=function(){this.createFacetViews()},r.prototype.createFacetViews=function(){var n=this;return this.facets.map(function(t){return n.facetToView(t)})},r.prototype.clearFacetViews=function(){var n=this;w(this.facets,function(t){t.view&&(n.view.removeView(t.view),t.view=void 0)})},r.prototype.parseSpacing=function(){var n=this.view.viewBBox,t=n.width,e=n.height,i=this.cfg.spacing;return i.map(function(a,o){return dt(a)?a/(o===0?t:e):parseFloat(a)/100})},r.prototype.getFieldValues=function(n,t){var e=[],i={};return w(n,function(a){var o=a[t];!G(o)&&!i[o]&&(e.push(o),i[o]=!0)}),e},r.prototype.getRegion=function(n,t,e,i){var a=ut(this.parseSpacing(),2),o=a[0],s=a[1],u=(1+o)/(t===0?1:t)-o,l=(1+s)/(n===0?1:n)-s,c={x:(u+o)*e,y:(l+s)*i},f={x:c.x+u,y:c.y+l};return{start:c,end:f}},r.prototype.getDefaultCfg=function(){return{eachView:void 0,showTitle:!0,spacing:[0,0],padding:10,fields:[]}},r.prototype.getDefaultTitleCfg=function(){var n=this.view.getTheme().fontFamily;return{style:{fontSize:14,fill:"#666",fontFamily:n}}},r.prototype.processAxis=function(n,t){var e=n.getOptions(),i=e.coordinate,a=n.geometries,o=F(i,"type","rect");if(o==="rect"&&a.length){G(e.axes)&&(e.axes={});var s=e.axes,u=ut(a[0].getXYFields(),2),l=u[0],c=u[1],f=ll(s,l),h=ll(s,c);f!==!1&&(e.axes[l]=this.getXAxisOption(l,s,f,t)),h!==!1&&(e.axes[c]=this.getYAxisOption(c,s,h,t))}},r.prototype.getFacetDataFilter=function(n){return function(t){return bv(n,function(e){var i=e.field,a=e.value;return!G(a)&&i?t[i]===a:!0})}},r}(),AS={},vO=function(r){return AS[la(r)]},co=function(r,n){AS[la(r)]=n},ee=function(){function r(n,t){this.context=n,this.cfg=t,n.addAction(this)}return r.prototype.applyCfg=function(n){zt(this,n)},r.prototype.init=function(){this.applyCfg(this.cfg)},r.prototype.destroy=function(){this.context.removeAction(this),this.context=null},r}(),pO=function(r){R(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.execute=function(){this.callback&&this.callback(this.context)},n.prototype.destroy=function(){r.prototype.destroy.call(this),this.callback=null},n}(ee),jv={};function dO(r,n){var t=jv[r],e=null;if(t){var i=t.ActionClass,a=t.cfg;e=new i(n,a),e.name=r,e.init()}return e}function uc(r){var n=jv[r];return F(n,"ActionClass")}function ct(r,n,t){jv[r]={ActionClass:n,cfg:t}}function gO(r,n){var t=new pO(n);return t.callback=r,t.name="callback",t}function yO(r,n){var t=[];if(r.length){t.push(["M",r[0].x,r[0].y]);for(var e=1,i=r.length;e<i;e+=1){var a=r[e];t.push(["L",a.x,a.y])}n&&t.push(["Z"])}return t}function gh(r,n){for(var t=[r[0]],e=1,i=r.length;e<i;e=e+2){var a=n.convert({x:r[e],y:r[e+1]});t.push(a.x,a.y)}return t}function TS(r,n){var t=n.isTransposed,e=r[1],i=r[6],a=r[7],o=n.convert({x:i,y:a}),s=t?0:1;return["A",e,e,0,0,s,o.x,o.y]}function mO(r,n,t){var e=t.isTransposed,i=t.startAngle,a=t.endAngle,o=r[0].toLowerCase()==="a"?{x:r[6],y:r[7]}:{x:r[1],y:r[2]},s={x:n[1],y:n[2]},u=[],l=e?"y":"x",c=Math.abs(s[l]-o[l])*(a-i),f=s[l]>=o[l]?1:0,h=c>Math.PI?1:0,v=t.convert(s),p=sc(t,v);if(p>=.5)if(c===Math.PI*2){var d={x:(s.x+o.x)/2,y:(s.y+o.y)/2},g=t.convert(d);u.push(["A",p,p,0,h,f,g.x,g.y]),u.push(["A",p,p,0,h,f,v.x,v.y])}else u.push(["A",p,p,0,h,f,v.x,v.y]);return u}function xO(r){w(r,function(n,t){var e=n;if(e[0].toLowerCase()==="a"){var i=r[t-1],a=r[t+1];a&&a[0].toLowerCase()==="a"?i&&i[0].toLowerCase()==="l"&&(i[0]="M"):i&&i[0].toLowerCase()==="a"&&a&&a[0].toLowerCase()==="l"&&(a[0]="M")}})}var _O=function(r,n,t,e){var i,a=[],o=!!e,s,u,l,c,f,h,v;if(o){i=ut(e,2),l=i[0],c=i[1];for(var p=0,d=r.length;p<d;p++){var g=r[p];l=Ae([0,0],l,g),c=Te([0,0],c,g)}}for(var p=0,y=r.length;p<y;p++){var g=r[p];if(p===0&&!t)v=g;else if(p===y-1&&!t)h=g,a.push(v),a.push(h);else{s=r[t?p?p-1:y-1:p-1],u=r[t?(p+1)%y:p+1];var m=[0,0];m=vr(m,u,s),m=Ge(m,m,n);var x=Xa(g,s),_=Xa(g,u),E=x+_;E!==0&&(x/=E,_/=E);var b=Ge([0,0],m,-x),M=Ge([0,0],m,_);h=Zt([0,0],g,b),f=Zt([0,0],g,M),f=Ae([0,0],f,Te([0,0],u,g)),f=Te([0,0],f,Ae([0,0],u,g)),b=vr([0,0],f,g),b=Ge([0,0],b,-x/_),h=Zt([0,0],g,b),h=Ae([0,0],h,Te([0,0],s,g)),h=Te([0,0],h,Ae([0,0],s,g)),M=vr([0,0],g,h),M=Ge([0,0],M,_/x),f=Zt([0,0],g,M),o&&(h=Te([0,0],h,l),h=Ae([0,0],h,c),f=Te([0,0],f,l),f=Ae([0,0],f,c)),a.push(v),a.push(h),v=f}}return t&&a.push(a.shift()),a};function MS(r,n,t){for(var e=!!n,i=[],a=0,o=r.length;a<o;a+=2)i.push([r[a],r[a+1]]);for(var s=_O(i,.4,e,t),u=i.length,l=[],c,f,h,a=0;a<u-1;a++)c=s[a*2],f=s[a*2+1],h=i[a+1],l.push(["C",c[0],c[1],f[0],f[1],h[0],h[1]]);return e&&(c=s[u],f=s[u+1],h=i[0],l.push(["C",c[0],c[1],f[0],f[1],h[0],h[1]])),l}function $s(r,n){return yO(r,n)}function cl(r,n,t){var e=[],i=r[0],a=null;if(r.length<=2)return $s(r,n);for(var o=0,s=r.length;o<s;o++){var u=r[o];(!a||!(a.x===u.x&&a.y===u.y))&&(e.push(u.x),e.push(u.y),a=u)}var l=t||[[0,0],[1,1]],c=MS(e,n,l);return c.unshift(["M",i.x,i.y]),c}function CO(r,n){var t=[];return w(n,function(e){var i=e[0];switch(i.toLowerCase()){case"m":case"l":case"c":t.push(gh(e,r));break;case"a":t.push(TS(e,r));break;case"z":default:t.push(e);break}}),t}function EO(r,n){var t=[],e,i,a,o;return w(n,function(s,u){var l=s[0];switch(l.toLowerCase()){case"m":case"c":case"q":t.push(gh(s,r));break;case"l":e=n[u-1],i=s,a=r.isTransposed,o=a?e[e.length-2]===i[1]:e[e.length-1]===i[2],o?t=t.concat(mO(e,i,r)):t.push(gh(s,r));break;case"a":t.push(TS(s,r));break;case"z":default:t.push(s);break}}),xO(t),t}function wS(r,n){var t=r.event,e=t.target,i=e.getCanvasBBox();return i.width>=n||i.height>=n?i:null}function SO(r,n){var t=r.event,e=t.target,i=e.getCanvasBBox();return i.width>=n||i.height>=n?e.attr("path"):null}function ci(r){var n=r.event,t,e=n.target;return e&&(t=e.get("element")),t}function ea(r){var n=r.event,t=n.target,e;return t&&(e=t.get("delegateObject")),e}function LS(r){var n=r.event.gEvent;return!(n&&n.fromShape&&n.toShape&&n.fromShape.get("element")===n.toShape.get("element"))}function ds(r){return r&&r.component&&r.component.isList()}function FS(r){return r&&r.component&&r.component.isSlider()}function gs(r){var n=r.event,t=n.target;return t&&t.get("name")==="mask"}function Xv(r,n){var t=r.event.target;if(t.get("type")==="path"){var e=SO(r,n);return e?TO(r.view,e):void 0}var i=wS(r,n);return i?Yv(r.view,i):null}function kS(r,n,t){var e=wS(r,t);if(!e)return null;var i=r.view,a=yh(i,n,{x:e.x,y:e.y}),o=yh(i,n,{x:e.maxX,y:e.maxY}),s={minX:a.x,minY:a.y,maxX:o.x,maxY:o.y};return Yv(n,s)}function Fe(r){var n=r.geometries,t=[];return w(n,function(e){var i=e.elements;t=t.concat(i)}),r.views&&r.views.length&&w(r.views,function(e){t=t.concat(Fe(e))}),t}function bO(r,n,t){var e=Fe(r);return e.filter(function(i){return Zr(i,n)===t})}function OS(r,n){var t=r.geometries,e=[];return w(t,function(i){var a=i.getElementsBy(function(o){return o.hasState(n)});e=e.concat(a)}),e}function Zr(r,n){var t=r.getModel(),e=t.data,i;return V(e)?i=e[0][n]:i=e[n],i}function AO(r,n){return!(n.minX>r.maxX||n.maxX<r.minX||n.minY>r.maxY||n.maxY<r.minY)}function Yv(r,n){var t=Fe(r),e=[];return w(t,function(i){var a=i.shape,o=a.getCanvasBBox();AO(n,o)&&e.push(i)}),e}function zg(r){var n=[];return w(r,function(t){var e=t[0];if(e!=="A")for(var i=1;i<t.length;i=i+2)n.push([t[i],t[i+1]]);else{var a=t.length;n.push([t[a-2],t[a-1]])}}),n}function TO(r,n){var t=Fe(r),e=zg(n),i=t.filter(function(a){var o=a.shape,s;if(o.get("type")==="path")s=zg(o.attr("path"));else{var u=o.getCanvasBBox();s=rO(u)}return cF(e,s)});return i}function RS(r){return r.getComponents().map(function(n){return n.component})}function Zv(r,n){var t=n.x-r.x,e=n.y-r.y;return Math.sqrt(t*t+e*e)}function MO(r,n){if(r.length<=2)return $s(r,!1);var t=r[0],e=[];w(r,function(a){e.push(a.x),e.push(a.y)});var i=MS(e,n,null);return i.unshift(["M",t.x,t.y]),i}function Ug(r,n){return r.x<=n.x&&r.maxX>=n.x&&r.y<=n.y&&r.maxY>n.y}function hn(r){var n=r.parent,t=null;return n&&(t=n.views.filter(function(e){return e!==r})),t}function wO(r,n){var t=r.getCoordinate();return t.invert(n)}function yh(r,n,t){var e=wO(r,t);return n.getCoordinate().convert(e)}function IS(r,n,t,e){var i=!1;return w(r,function(a){if(a[t]===n[t]&&a[e]===n[e])return i=!0,!1}),i}function Qa(r,n){var t=r.getScaleByField(n);return!t&&r.views&&w(r.views,function(e){if(t=Qa(e,n),t)return!1}),t}var LO=function(){function r(n){this.actions=[],this.event=null,this.cacheMap={},this.view=n}return r.prototype.cache=function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];if(n.length===1)return this.cacheMap[n[0]];n.length===2&&(this.cacheMap[n[0]]=n[1])},r.prototype.getAction=function(n){return this.actions.find(function(t){return t.name===n})},r.prototype.addAction=function(n){this.actions.push(n)},r.prototype.removeAction=function(n){var t=this.actions,e=this.actions.indexOf(n);e>=0&&t.splice(e,1)},r.prototype.getCurrentPoint=function(){var n=this.event;if(n)if(n.target instanceof HTMLElement){var t=this.view.getCanvas(),e=t.getPointByClient(n.clientX,n.clientY);return e}else return{x:n.x,y:n.y};return null},r.prototype.getCurrentShape=function(){return F(this.event,["gEvent","shape"])},r.prototype.isInPlot=function(){var n=this.getCurrentPoint();return n?this.view.isPointInPlot(n):!1},r.prototype.isInShape=function(n){var t=this.getCurrentShape();return t?t.get("name")===n:!1},r.prototype.isInComponent=function(n){var t=RS(this.view),e=this.getCurrentPoint();return e?!!t.find(function(i){var a=i.getBBox();return n?i.get("name")===n&&Ug(a,e):Ug(a,e)}):!1},r.prototype.destroy=function(){w(this.actions.slice(),function(n){n.destroy()}),this.view=null,this.event=null,this.actions=null,this.cacheMap=null},r}(),FO=function(){function r(n,t){this.view=n,this.cfg=t}return r.prototype.init=function(){this.initEvents()},r.prototype.initEvents=function(){},r.prototype.clearEvents=function(){},r.prototype.destroy=function(){this.clearEvents()},r}();function Hg(r,n,t){var e=r.split(":"),i=e[0],a=n.getAction(i)||dO(i,n);if(!a)throw new Error("There is no action named ".concat(i));var o=e[1];return{action:a,methodName:o,arg:t}}function $g(r){var n=r.action,t=r.methodName,e=r.arg;if(n[t])n[t](e);else throw new Error("Action(".concat(n.name,") doesn't have a method called ").concat(t))}var sr={START:"start",SHOW_ENABLE:"showEnable",END:"end",ROLLBACK:"rollback",PROCESSING:"processing"},kO=function(r){R(n,r);function n(t,e){var i=r.call(this,t,e)||this;return i.callbackCaches={},i.emitCaches={},i.steps=e,i}return n.prototype.init=function(){this.initContext(),r.prototype.init.call(this)},n.prototype.destroy=function(){r.prototype.destroy.call(this),this.steps=null,this.context&&(this.context.destroy(),this.context=null),this.callbackCaches=null,this.view=null},n.prototype.initEvents=function(){var t=this;w(this.steps,function(e,i){w(e,function(a){var o=t.getActionCallback(i,a);o&&t.bindEvent(a.trigger,o)})})},n.prototype.clearEvents=function(){var t=this;w(this.steps,function(e,i){w(e,function(a){var o=t.getActionCallback(i,a);o&&t.offEvent(a.trigger,o)})})},n.prototype.initContext=function(){var t=this.view,e=new LO(t);this.context=e;var i=this.steps;w(i,function(a){w(a,function(o){if(rt(o.action))o.actionObject={action:gO(o.action,e),methodName:"execute"};else if(lt(o.action))o.actionObject=Hg(o.action,e,o.arg);else if(V(o.action)){var s=o.action,u=V(o.arg)?o.arg:[o.arg];o.actionObject=[],w(s,function(l,c){o.actionObject.push(Hg(l,e,u[c]))})}})})},n.prototype.isAllowStep=function(t){var e=this.currentStepName,i=this.steps;if(e===t||t===sr.SHOW_ENABLE)return!0;if(t===sr.PROCESSING)return e===sr.START;if(t===sr.START)return e!==sr.PROCESSING;if(t===sr.END)return e===sr.PROCESSING||e===sr.START;if(t===sr.ROLLBACK){if(i[sr.END])return e===sr.END;if(e===sr.START)return!0}return!1},n.prototype.isAllowExecute=function(t,e){if(this.isAllowStep(t)){var i=this.getKey(t,e);return e.once&&this.emitCaches[i]?!1:e.isEnable?e.isEnable(this.context):!0}return!1},n.prototype.enterStep=function(t){this.currentStepName=t,this.emitCaches={}},n.prototype.afterExecute=function(t,e){t!==sr.SHOW_ENABLE&&this.currentStepName!==t&&this.enterStep(t);var i=this.getKey(t,e);this.emitCaches[i]=!0},n.prototype.getKey=function(t,e){return t+e.trigger+e.action},n.prototype.getActionCallback=function(t,e){var i=this,a=this.context,o=this.callbackCaches,s=e.actionObject;if(e.action&&s){var u=this.getKey(t,e);if(!o[u]){var l=function(c){a.event=c,i.isAllowExecute(t,e)?(V(s)?w(s,function(f){a.event=c,$g(f)}):(a.event=c,$g(s)),i.afterExecute(t,e),e.callback&&(a.event=c,e.callback(a))):a.event=null};e.debounce?o[u]=sE(l,e.debounce.wait,e.debounce.immediate):e.throttle?o[u]=Mv(l,e.throttle.wait,{leading:e.throttle.leading,trailing:e.throttle.trailing}):o[u]=l}return o[u]}return null},n.prototype.bindEvent=function(t,e){var i=t.split(":");i[0]==="window"?window.addEventListener(i[1],e):i[0]==="document"?document.addEventListener(i[1],e):this.view.on(t,e)},n.prototype.offEvent=function(t,e){var i=t.split(":");i[0]==="window"?window.removeEventListener(i[1],e):i[0]==="document"?document.removeEventListener(i[1],e):this.view.off(t,e)},n}(FO),DS={};function OO(r){return DS[la(r)]}function gt(r,n){DS[la(r)]=n}function RO(r,n,t){var e=OO(r);if(!e)return null;if(fn(e)){var i=zt(Ve(e),t);return new kO(n,i)}else{var a=e;return new a(n,t)}}function IO(r){return{title:{autoRotate:!0,position:"center",spacing:r.axisTitleSpacing,style:{fill:r.axisTitleTextFillColor,fontSize:r.axisTitleTextFontSize,lineHeight:r.axisTitleTextLineHeight,textBaseline:"middle",fontFamily:r.fontFamily},iconStyle:{fill:r.axisDescriptionIconFillColor}},label:{autoRotate:!1,autoEllipsis:!1,autoHide:{type:"equidistance",cfg:{minGap:6}},offset:r.axisLabelOffset,style:{fill:r.axisLabelFillColor,fontSize:r.axisLabelFontSize,lineHeight:r.axisLabelLineHeight,fontFamily:r.fontFamily}},line:{style:{lineWidth:r.axisLineBorder,stroke:r.axisLineBorderColor}},grid:{line:{type:"line",style:{stroke:r.axisGridBorderColor,lineWidth:r.axisGridBorder,lineDash:r.axisGridLineDash}},alignTick:!0,animate:!0},tickLine:{style:{lineWidth:r.axisTickLineBorder,stroke:r.axisTickLineBorderColor},alignTick:!0,length:r.axisTickLineLength},subTickLine:null,animate:!0}}function DO(r){return{title:null,marker:{symbol:"circle",spacing:r.legendMarkerSpacing,style:{r:r.legendCircleMarkerSize,fill:r.legendMarkerColor}},itemName:{spacing:5,style:{fill:r.legendItemNameFillColor,fontFamily:r.fontFamily,fontSize:r.legendItemNameFontSize,lineHeight:r.legendItemNameLineHeight,fontWeight:r.legendItemNameFontWeight,textAlign:"start",textBaseline:"middle"}},itemStates:{active:{nameStyle:{opacity:.8}},unchecked:{nameStyle:{fill:"#D8D8D8"},markerStyle:{fill:"#D8D8D8",stroke:"#D8D8D8"}},inactive:{nameStyle:{fill:"#D8D8D8"},markerStyle:{opacity:.2}}},flipPage:!0,pageNavigator:{marker:{style:{size:r.legendPageNavigatorMarkerSize,inactiveFill:r.legendPageNavigatorMarkerInactiveFillColor,inactiveOpacity:r.legendPageNavigatorMarkerInactiveFillOpacity,fill:r.legendPageNavigatorMarkerFillColor,opacity:r.legendPageNavigatorMarkerFillOpacity}},text:{style:{fill:r.legendPageNavigatorTextFillColor,fontSize:r.legendPageNavigatorTextFontSize}}},animate:!1,maxItemWidth:200,itemSpacing:r.legendItemSpacing,itemMarginBottom:r.legendItemMarginBottom,padding:r.legendPadding}}function PS(r){var n,t={point:{default:{fill:r.pointFillColor,r:r.pointSize,stroke:r.pointBorderColor,lineWidth:r.pointBorder,fillOpacity:r.pointFillOpacity},active:{stroke:r.pointActiveBorderColor,lineWidth:r.pointActiveBorder},selected:{stroke:r.pointSelectedBorderColor,lineWidth:r.pointSelectedBorder},inactive:{fillOpacity:r.pointInactiveFillOpacity,strokeOpacity:r.pointInactiveBorderOpacity}},hollowPoint:{default:{fill:r.hollowPointFillColor,lineWidth:r.hollowPointBorder,stroke:r.hollowPointBorderColor,strokeOpacity:r.hollowPointBorderOpacity,r:r.hollowPointSize},active:{stroke:r.hollowPointActiveBorderColor,strokeOpacity:r.hollowPointActiveBorderOpacity},selected:{lineWidth:r.hollowPointSelectedBorder,stroke:r.hollowPointSelectedBorderColor,strokeOpacity:r.hollowPointSelectedBorderOpacity},inactive:{strokeOpacity:r.hollowPointInactiveBorderOpacity}},area:{default:{fill:r.areaFillColor,fillOpacity:r.areaFillOpacity,stroke:null},active:{fillOpacity:r.areaActiveFillOpacity},selected:{fillOpacity:r.areaSelectedFillOpacity},inactive:{fillOpacity:r.areaInactiveFillOpacity}},hollowArea:{default:{fill:null,stroke:r.hollowAreaBorderColor,lineWidth:r.hollowAreaBorder,strokeOpacity:r.hollowAreaBorderOpacity},active:{fill:null,lineWidth:r.hollowAreaActiveBorder},selected:{fill:null,lineWidth:r.hollowAreaSelectedBorder},inactive:{strokeOpacity:r.hollowAreaInactiveBorderOpacity}},interval:{default:{fill:r.intervalFillColor,fillOpacity:r.intervalFillOpacity},active:{stroke:r.intervalActiveBorderColor,lineWidth:r.intervalActiveBorder},selected:{stroke:r.intervalSelectedBorderColor,lineWidth:r.intervalSelectedBorder},inactive:{fillOpacity:r.intervalInactiveFillOpacity,strokeOpacity:r.intervalInactiveBorderOpacity}},hollowInterval:{default:{fill:r.hollowIntervalFillColor,stroke:r.hollowIntervalBorderColor,lineWidth:r.hollowIntervalBorder,strokeOpacity:r.hollowIntervalBorderOpacity},active:{stroke:r.hollowIntervalActiveBorderColor,lineWidth:r.hollowIntervalActiveBorder,strokeOpacity:r.hollowIntervalActiveBorderOpacity},selected:{stroke:r.hollowIntervalSelectedBorderColor,lineWidth:r.hollowIntervalSelectedBorder,strokeOpacity:r.hollowIntervalSelectedBorderOpacity},inactive:{stroke:r.hollowIntervalInactiveBorderColor,lineWidth:r.hollowIntervalInactiveBorder,strokeOpacity:r.hollowIntervalInactiveBorderOpacity}},line:{default:{stroke:r.lineBorderColor,lineWidth:r.lineBorder,strokeOpacity:r.lineBorderOpacity,fill:null,lineAppendWidth:10,lineCap:"round",lineJoin:"round"},active:{lineWidth:r.lineActiveBorder},selected:{lineWidth:r.lineSelectedBorder},inactive:{strokeOpacity:r.lineInactiveBorderOpacity}}},e=IO(r),i=DO(r);return{background:r.backgroundColor,defaultColor:r.brandColor,subColor:r.subColor,semanticRed:r.paletteSemanticRed,semanticGreen:r.paletteSemanticGreen,padding:"auto",fontFamily:r.fontFamily,columnWidthRatio:1/2,maxColumnWidth:null,minColumnWidth:null,roseWidthRatio:.9999999,multiplePieWidthRatio:1/1.3,colors10:r.paletteQualitative10,colors20:r.paletteQualitative20,sequenceColors:r.paletteSequence,shapes:{point:["hollow-circle","hollow-square","hollow-bowtie","hollow-diamond","hollow-hexagon","hollow-triangle","hollow-triangle-down","circle","square","bowtie","diamond","hexagon","triangle","triangle-down","cross","tick","plus","hyphen","line"],line:["line","dash","dot","smooth"],area:["area","smooth","line","smooth-line"],interval:["rect","hollow-rect","line","tick"]},sizes:[1,10],geometries:{interval:{rect:{default:{style:t.interval.default},active:{style:t.interval.active},inactive:{style:t.interval.inactive},selected:{style:function(a){var o=a.geometry.coordinate;if(o.isPolar&&o.isTransposed){var s=vs(a.getModel(),o),u=s.startAngle,l=s.endAngle,c=(u+l)/2,f=7.5,h=f*Math.cos(c),v=f*Math.sin(c);return{matrix:ve(null,[["t",h,v]])}}return t.interval.selected}}},"hollow-rect":{default:{style:t.hollowInterval.default},active:{style:t.hollowInterval.active},inactive:{style:t.hollowInterval.inactive},selected:{style:t.hollowInterval.selected}},line:{default:{style:t.hollowInterval.default},active:{style:t.hollowInterval.active},inactive:{style:t.hollowInterval.inactive},selected:{style:t.hollowInterval.selected}},tick:{default:{style:t.hollowInterval.default},active:{style:t.hollowInterval.active},inactive:{style:t.hollowInterval.inactive},selected:{style:t.hollowInterval.selected}},funnel:{default:{style:t.interval.default},active:{style:t.interval.active},inactive:{style:t.interval.inactive},selected:{style:t.interval.selected}},pyramid:{default:{style:t.interval.default},active:{style:t.interval.active},inactive:{style:t.interval.inactive},selected:{style:t.interval.selected}}},line:{line:{default:{style:t.line.default},active:{style:t.line.active},inactive:{style:t.line.inactive},selected:{style:t.line.selected}},dot:{default:{style:C(C({},t.line.default),{lineCap:null,lineDash:[1,1]})},active:{style:C(C({},t.line.active),{lineCap:null,lineDash:[1,1]})},inactive:{style:C(C({},t.line.inactive),{lineCap:null,lineDash:[1,1]})},selected:{style:C(C({},t.line.selected),{lineCap:null,lineDash:[1,1]})}},dash:{default:{style:C(C({},t.line.default),{lineCap:null,lineDash:[5.5,1]})},active:{style:C(C({},t.line.active),{lineCap:null,lineDash:[5.5,1]})},inactive:{style:C(C({},t.line.inactive),{lineCap:null,lineDash:[5.5,1]})},selected:{style:C(C({},t.line.selected),{lineCap:null,lineDash:[5.5,1]})}},smooth:{default:{style:t.line.default},active:{style:t.line.active},inactive:{style:t.line.inactive},selected:{style:t.line.selected}},hv:{default:{style:t.line.default},active:{style:t.line.active},inactive:{style:t.line.inactive},selected:{style:t.line.selected}},vh:{default:{style:t.line.default},active:{style:t.line.active},inactive:{style:t.line.inactive},selected:{style:t.line.selected}},hvh:{default:{style:t.line.default},active:{style:t.line.active},inactive:{style:t.line.inactive},selected:{style:t.line.selected}},vhv:{default:{style:t.line.default},active:{style:t.line.active},inactive:{style:t.line.inactive},selected:{style:t.line.selected}}},polygon:{polygon:{default:{style:t.interval.default},active:{style:t.interval.active},inactive:{style:t.interval.inactive},selected:{style:t.interval.selected}}},point:{circle:{default:{style:t.point.default},active:{style:t.point.active},inactive:{style:t.point.inactive},selected:{style:t.point.selected}},square:{default:{style:t.point.default},active:{style:t.point.active},inactive:{style:t.point.inactive},selected:{style:t.point.selected}},bowtie:{default:{style:t.point.default},active:{style:t.point.active},inactive:{style:t.point.inactive},selected:{style:t.point.selected}},diamond:{default:{style:t.point.default},active:{style:t.point.active},inactive:{style:t.point.inactive},selected:{style:t.point.selected}},hexagon:{default:{style:t.point.default},active:{style:t.point.active},inactive:{style:t.point.inactive},selected:{style:t.point.selected}},triangle:{default:{style:t.point.default},active:{style:t.point.active},inactive:{style:t.point.inactive},selected:{style:t.point.selected}},"triangle-down":{default:{style:t.point.default},active:{style:t.point.active},inactive:{style:t.point.inactive},selected:{style:t.point.selected}},"hollow-circle":{default:{style:t.hollowPoint.default},active:{style:t.hollowPoint.active},inactive:{style:t.hollowPoint.inactive},selected:{style:t.hollowPoint.selected}},"hollow-square":{default:{style:t.hollowPoint.default},active:{style:t.hollowPoint.active},inactive:{style:t.hollowPoint.inactive},selected:{style:t.hollowPoint.selected}},"hollow-bowtie":{default:{style:t.hollowPoint.default},active:{style:t.hollowPoint.active},inactive:{style:t.hollowPoint.inactive},selected:{style:t.hollowPoint.selected}},"hollow-diamond":{default:{style:t.hollowPoint.default},active:{style:t.hollowPoint.active},inactive:{style:t.hollowPoint.inactive},selected:{style:t.hollowPoint.selected}},"hollow-hexagon":{default:{style:t.hollowPoint.default},active:{style:t.hollowPoint.active},inactive:{style:t.hollowPoint.inactive},selected:{style:t.hollowPoint.selected}},"hollow-triangle":{default:{style:t.hollowPoint.default},active:{style:t.hollowPoint.active},inactive:{style:t.hollowPoint.inactive},selected:{style:t.hollowPoint.selected}},"hollow-triangle-down":{default:{style:t.hollowPoint.default},active:{style:t.hollowPoint.active},inactive:{style:t.hollowPoint.inactive},selected:{style:t.hollowPoint.selected}},cross:{default:{style:t.hollowPoint.default},active:{style:t.hollowPoint.active},inactive:{style:t.hollowPoint.inactive},selected:{style:t.hollowPoint.selected}},tick:{default:{style:t.hollowPoint.default},active:{style:t.hollowPoint.active},inactive:{style:t.hollowPoint.inactive},selected:{style:t.hollowPoint.selected}},plus:{default:{style:t.hollowPoint.default},active:{style:t.hollowPoint.active},inactive:{style:t.hollowPoint.inactive},selected:{style:t.hollowPoint.selected}},hyphen:{default:{style:t.hollowPoint.default},active:{style:t.hollowPoint.active},inactive:{style:t.hollowPoint.inactive},selected:{style:t.hollowPoint.selected}},line:{default:{style:t.hollowPoint.default},active:{style:t.hollowPoint.active},inactive:{style:t.hollowPoint.inactive},selected:{style:t.hollowPoint.selected}}},area:{area:{default:{style:t.area.default},active:{style:t.area.active},inactive:{style:t.area.inactive},selected:{style:t.area.selected}},smooth:{default:{style:t.area.default},active:{style:t.area.active},inactive:{style:t.area.inactive},selected:{style:t.area.selected}},line:{default:{style:t.hollowArea.default},active:{style:t.hollowArea.active},inactive:{style:t.hollowArea.inactive},selected:{style:t.hollowArea.selected}},"smooth-line":{default:{style:t.hollowArea.default},active:{style:t.hollowArea.active},inactive:{style:t.hollowArea.inactive},selected:{style:t.hollowArea.selected}}},schema:{candle:{default:{style:t.hollowInterval.default},active:{style:t.hollowInterval.active},inactive:{style:t.hollowInterval.inactive},selected:{style:t.hollowInterval.selected}},box:{default:{style:t.hollowInterval.default},active:{style:t.hollowInterval.active},inactive:{style:t.hollowInterval.inactive},selected:{style:t.hollowInterval.selected}}},edge:{line:{default:{style:t.line.default},active:{style:t.line.active},inactive:{style:t.line.inactive},selected:{style:t.line.selected}},vhv:{default:{style:t.line.default},active:{style:t.line.active},inactive:{style:t.line.inactive},selected:{style:t.line.selected}},smooth:{default:{style:t.line.default},active:{style:t.line.active},inactive:{style:t.line.inactive},selected:{style:t.line.selected}},arc:{default:{style:t.line.default},active:{style:t.line.active},inactive:{style:t.line.inactive},selected:{style:t.line.selected}}},violin:{violin:{default:{style:t.line.default},active:{style:t.line.active},inactive:{style:t.line.inactive},selected:{style:t.line.selected}},smooth:{default:{style:t.line.default},active:{style:t.line.active},inactive:{style:t.line.inactive},selected:{style:t.line.selected}},hollow:{default:{style:t.hollowArea.default},active:{style:t.hollowArea.active},inactive:{style:t.hollowArea.inactive},selected:{style:t.hollowArea.selected}},"hollow-smooth":{default:{style:t.hollowArea.default},active:{style:t.hollowArea.active},inactive:{style:t.hollowArea.inactive},selected:{style:t.hollowArea.selected}}}},components:{axis:{common:e,top:{position:"top",grid:null,title:null,verticalLimitLength:1/2},bottom:{position:"bottom",grid:null,title:null,verticalLimitLength:1/2},left:{position:"left",title:null,line:null,tickLine:null,verticalLimitLength:1/3},right:{position:"right",title:null,line:null,tickLine:null,verticalLimitLength:1/3},circle:{title:null,grid:J({},e.grid,{line:{type:"line"}})},radius:{title:null,grid:J({},e.grid,{line:{type:"circle"}})}},legend:{common:i,right:{layout:"vertical",padding:r.legendVerticalPadding},left:{layout:"vertical",padding:r.legendVerticalPadding},top:{layout:"horizontal",padding:r.legendHorizontalPadding},bottom:{layout:"horizontal",padding:r.legendHorizontalPadding},continuous:{title:null,background:null,track:{},rail:{type:"color",size:r.sliderRailHeight,defaultLength:r.sliderRailWidth,style:{fill:r.sliderRailFillColor,stroke:r.sliderRailBorderColor,lineWidth:r.sliderRailBorder}},label:{align:"rail",spacing:4,formatter:null,style:{fill:r.sliderLabelTextFillColor,fontSize:r.sliderLabelTextFontSize,lineHeight:r.sliderLabelTextLineHeight,textBaseline:"middle",fontFamily:r.fontFamily}},handler:{size:r.sliderHandlerWidth,style:{fill:r.sliderHandlerFillColor,stroke:r.sliderHandlerBorderColor}},slidable:!0,padding:i.padding}},tooltip:{showContent:!0,follow:!0,showCrosshairs:!1,showMarkers:!0,shared:!1,enterable:!1,position:"auto",marker:{symbol:"circle",stroke:"#fff",shadowBlur:10,shadowOffsetX:0,shadowOffsetY:0,shadowColor:"rgba(0,0,0,0.09)",lineWidth:2,r:4},crosshairs:{line:{style:{stroke:r.tooltipCrosshairsBorderColor,lineWidth:r.tooltipCrosshairsBorder}},text:null,textBackground:{padding:2,style:{fill:"rgba(0, 0, 0, 0.25)",lineWidth:0,stroke:null}},follow:!1},domStyles:(n={},n["".concat(Mr)]={position:"absolute",visibility:"hidden",zIndex:8,transition:"left 0.4s cubic-bezier(0.23, 1, 0.32, 1) 0s, top 0.4s cubic-bezier(0.23, 1, 0.32, 1) 0s",backgroundColor:r.tooltipContainerFillColor,opacity:r.tooltipContainerFillOpacity,boxShadow:r.tooltipContainerShadow,borderRadius:"".concat(r.tooltipContainerBorderRadius,"px"),color:r.tooltipTextFillColor,fontSize:"".concat(r.tooltipTextFontSize,"px"),fontFamily:r.fontFamily,lineHeight:"".concat(r.tooltipTextLineHeight,"px"),padding:"0 12px 0 12px"},n["".concat(On)]={marginBottom:"12px",marginTop:"12px"},n["".concat(cs)]={margin:0,listStyleType:"none",padding:0},n["".concat(nc)]={listStyleType:"none",padding:0,marginBottom:"12px",marginTop:"12px",marginLeft:0,marginRight:0},n["".concat(ic)]={width:"8px",height:"8px",borderRadius:"50%",display:"inline-block",marginRight:"8px"},n["".concat(ac)]={display:"inline-block",float:"right",marginLeft:"30px"},n)},annotation:{arc:{style:{stroke:r.annotationArcBorderColor,lineWidth:r.annotationArcBorder},animate:!0},line:{style:{stroke:r.annotationLineBorderColor,lineDash:r.annotationLineDash,lineWidth:r.annotationLineBorder},text:{position:"start",autoRotate:!0,style:{fill:r.annotationTextFillColor,stroke:r.annotationTextBorderColor,lineWidth:r.annotationTextBorder,fontSize:r.annotationTextFontSize,textAlign:"start",fontFamily:r.fontFamily,textBaseline:"bottom"}},animate:!0},text:{style:{fill:r.annotationTextFillColor,stroke:r.annotationTextBorderColor,lineWidth:r.annotationTextBorder,fontSize:r.annotationTextFontSize,textBaseline:"middle",textAlign:"start",fontFamily:r.fontFamily},animate:!0},region:{top:!1,style:{lineWidth:r.annotationRegionBorder,stroke:r.annotationRegionBorderColor,fill:r.annotationRegionFillColor,fillOpacity:r.annotationRegionFillOpacity},animate:!0},image:{top:!1,animate:!0},dataMarker:{top:!0,point:{style:{r:3,stroke:r.brandColor,lineWidth:2}},line:{style:{stroke:r.annotationLineBorderColor,lineWidth:r.annotationLineBorder},length:r.annotationDataMarkerLineLength},text:{style:{textAlign:"start",fill:r.annotationTextFillColor,stroke:r.annotationTextBorderColor,lineWidth:r.annotationTextBorder,fontSize:r.annotationTextFontSize,fontFamily:r.fontFamily}},direction:"upward",autoAdjust:!0,animate:!0},dataRegion:{style:{region:{fill:r.annotationRegionFillColor,fillOpacity:r.annotationRegionFillOpacity},text:{textAlign:"center",textBaseline:"bottom",fill:r.annotationTextFillColor,stroke:r.annotationTextBorderColor,lineWidth:r.annotationTextBorder,fontSize:r.annotationTextFontSize,fontFamily:r.fontFamily}},animate:!0}},slider:{common:{padding:[8,8,8,8],backgroundStyle:{fill:r.cSliderBackgroundFillColor,opacity:r.cSliderBackgroundFillOpacity},foregroundStyle:{fill:r.cSliderForegroundFillColor,opacity:r.cSliderForegroundFillOpacity},handlerStyle:{width:r.cSliderHandlerWidth,height:r.cSliderHandlerHeight,fill:r.cSliderHandlerFillColor,opacity:r.cSliderHandlerFillOpacity,stroke:r.cSliderHandlerBorderColor,lineWidth:r.cSliderHandlerBorder,radius:r.cSliderHandlerBorderRadius,highLightFill:r.cSliderHandlerHighlightFillColor},textStyle:{fill:r.cSliderTextFillColor,opacity:r.cSliderTextFillOpacity,fontSize:r.cSliderTextFontSize,lineHeight:r.cSliderTextLineHeight,fontWeight:r.cSliderTextFontWeight,stroke:r.cSliderTextBorderColor,lineWidth:r.cSliderTextBorder}}},scrollbar:{common:{padding:[8,8,8,8]},default:{style:{trackColor:r.scrollbarTrackFillColor,thumbColor:r.scrollbarThumbFillColor}},hover:{style:{thumbColor:r.scrollbarThumbHighlightFillColor}}}},labels:{offset:12,style:{fill:r.labelFillColor,fontSize:r.labelFontSize,fontFamily:r.fontFamily,stroke:r.labelBorderColor,lineWidth:r.labelBorder},fillColorDark:r.labelFillColorDark,fillColorLight:r.labelFillColorLight,autoRotate:!0},innerLabels:{style:{fill:r.innerLabelFillColor,fontSize:r.innerLabelFontSize,fontFamily:r.fontFamily,stroke:r.innerLabelBorderColor,lineWidth:r.innerLabelBorder},autoRotate:!0},overflowLabels:{style:{fill:r.overflowLabelFillColor,fontSize:r.overflowLabelFontSize,fontFamily:r.fontFamily,stroke:r.overflowLabelBorderColor,lineWidth:r.overflowLabelBorder}},pieLabels:{labelHeight:14,offset:10,labelLine:{style:{lineWidth:r.labelLineBorder}},autoRotate:!0}}}var Bt={100:"#000",95:"#0D0D0D",85:"#262626",65:"#595959",45:"#8C8C8C",25:"#BFBFBF",15:"#D9D9D9",6:"#F0F0F0"},xa={100:"#FFFFFF",95:"#F2F2F2",85:"#D9D9D9",65:"#A6A6A6",45:"#737373",25:"#404040",15:"#262626",6:"#0F0F0F"},PO=["#5B8FF9","#5AD8A6","#5D7092","#F6BD16","#6F5EF9","#6DC8EC","#945FB9","#FF9845","#1E9493","#FF99C3"],BO=["#5B8FF9","#CDDDFD","#5AD8A6","#CDF3E4","#5D7092","#CED4DE","#F6BD16","#FCEBB9","#6F5EF9","#D3CEFD","#6DC8EC","#D3EEF9","#945FB9","#DECFEA","#FF9845","#FFE0C7","#1E9493","#BBDEDE","#FF99C3","#FFE0ED"],NO=["#B8E1FF","#9AC5FF","#7DAAFF","#5B8FF9","#3D76DD","#085EC0","#0047A5","#00318A","#001D70"],BS=function(r){r===void 0&&(r={});var n=r.paletteQualitative10,t=n===void 0?PO:n,e=r.paletteQualitative20,i=e===void 0?BO:e,a=r.brandColor,o=a===void 0?t[0]:a,s={backgroundColor:"transparent",brandColor:o,subColor:"rgba(0,0,0,0.05)",paletteQualitative10:t,paletteQualitative20:i,paletteSemanticRed:"#F4664A",paletteSemanticGreen:"#30BF78",paletteSemanticYellow:"#FAAD14",paletteSequence:NO,fontFamily:`"Segoe UI", Roboto, "Helvetica Neue", Arial,
    "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol",
    "Noto Color Emoji"`,axisLineBorderColor:Bt[25],axisLineBorder:1,axisLineDash:null,axisTitleTextFillColor:Bt[65],axisTitleTextFontSize:12,axisTitleTextLineHeight:12,axisTitleTextFontWeight:"normal",axisTitleSpacing:12,axisDescriptionIconFillColor:xa[85],axisTickLineBorderColor:Bt[25],axisTickLineLength:4,axisTickLineBorder:1,axisSubTickLineBorderColor:Bt[15],axisSubTickLineLength:2,axisSubTickLineBorder:1,axisLabelFillColor:Bt[45],axisLabelFontSize:12,axisLabelLineHeight:12,axisLabelFontWeight:"normal",axisLabelOffset:8,axisGridBorderColor:Bt[15],axisGridBorder:1,axisGridLineDash:null,legendTitleTextFillColor:Bt[45],legendTitleTextFontSize:12,legendTitleTextLineHeight:21,legendTitleTextFontWeight:"normal",legendMarkerColor:o,legendMarkerSpacing:8,legendMarkerSize:4,legendCircleMarkerSize:4,legendSquareMarkerSize:4,legendLineMarkerSize:5,legendItemNameFillColor:Bt[65],legendItemNameFontSize:12,legendItemNameLineHeight:12,legendItemNameFontWeight:"normal",legendItemSpacing:24,legendItemMarginBottom:12,legendPadding:[8,8,8,8],legendHorizontalPadding:[8,0,8,0],legendVerticalPadding:[0,8,0,8],legendPageNavigatorMarkerSize:12,legendPageNavigatorMarkerInactiveFillColor:Bt[100],legendPageNavigatorMarkerInactiveFillOpacity:.45,legendPageNavigatorMarkerFillColor:Bt[100],legendPageNavigatorMarkerFillOpacity:1,legendPageNavigatorTextFillColor:Bt[45],legendPageNavigatorTextFontSize:12,sliderRailFillColor:Bt[15],sliderRailBorder:0,sliderRailBorderColor:null,sliderRailWidth:100,sliderRailHeight:12,sliderLabelTextFillColor:Bt[45],sliderLabelTextFontSize:12,sliderLabelTextLineHeight:12,sliderLabelTextFontWeight:"normal",sliderHandlerFillColor:Bt[6],sliderHandlerWidth:10,sliderHandlerHeight:14,sliderHandlerBorder:1,sliderHandlerBorderColor:Bt[25],annotationArcBorderColor:Bt[15],annotationArcBorder:1,annotationLineBorderColor:Bt[25],annotationLineBorder:1,annotationLineDash:null,annotationTextFillColor:Bt[65],annotationTextFontSize:12,annotationTextLineHeight:12,annotationTextFontWeight:"normal",annotationTextBorderColor:null,annotationTextBorder:0,annotationRegionFillColor:Bt[100],annotationRegionFillOpacity:.06,annotationRegionBorder:0,annotationRegionBorderColor:null,annotationDataMarkerLineLength:16,tooltipCrosshairsBorderColor:Bt[25],tooltipCrosshairsBorder:1,tooltipCrosshairsLineDash:null,tooltipContainerFillColor:"rgb(255, 255, 255)",tooltipContainerFillOpacity:.95,tooltipContainerShadow:"0px 0px 10px #aeaeae",tooltipContainerBorderRadius:3,tooltipTextFillColor:Bt[65],tooltipTextFontSize:12,tooltipTextLineHeight:12,tooltipTextFontWeight:"bold",labelFillColor:Bt[65],labelFillColorDark:"#2c3542",labelFillColorLight:"#ffffff",labelFontSize:12,labelLineHeight:12,labelFontWeight:"normal",labelBorderColor:null,labelBorder:0,innerLabelFillColor:xa[100],innerLabelFontSize:12,innerLabelLineHeight:12,innerLabelFontWeight:"normal",innerLabelBorderColor:null,innerLabelBorder:0,overflowLabelFillColor:Bt[65],overflowLabelFontSize:12,overflowLabelLineHeight:12,overflowLabelFontWeight:"normal",overflowLabelBorderColor:xa[100],overflowLabelBorder:1,labelLineBorder:1,labelLineBorderColor:Bt[25],cSliderRailHieght:16,cSliderBackgroundFillColor:"#416180",cSliderBackgroundFillOpacity:.05,cSliderForegroundFillColor:"#5B8FF9",cSliderForegroundFillOpacity:.15,cSliderHandlerHeight:24,cSliderHandlerWidth:10,cSliderHandlerFillColor:"#F7F7F7",cSliderHandlerFillOpacity:1,cSliderHandlerHighlightFillColor:"#FFF",cSliderHandlerBorderColor:"#BFBFBF",cSliderHandlerBorder:1,cSliderHandlerBorderRadius:2,cSliderTextFillColor:"#000",cSliderTextFillOpacity:.45,cSliderTextFontSize:12,cSliderTextLineHeight:12,cSliderTextFontWeight:"normal",cSliderTextBorderColor:null,cSliderTextBorder:0,scrollbarTrackFillColor:"rgba(0,0,0,0)",scrollbarThumbFillColor:"rgba(0,0,0,0.15)",scrollbarThumbHighlightFillColor:"rgba(0,0,0,0.2)",pointFillColor:o,pointFillOpacity:.95,pointSize:4,pointBorder:1,pointBorderColor:xa[100],pointBorderOpacity:1,pointActiveBorderColor:Bt[100],pointSelectedBorder:2,pointSelectedBorderColor:Bt[100],pointInactiveFillOpacity:.3,pointInactiveBorderOpacity:.3,hollowPointSize:4,hollowPointBorder:1,hollowPointBorderColor:o,hollowPointBorderOpacity:.95,hollowPointFillColor:xa[100],hollowPointActiveBorder:1,hollowPointActiveBorderColor:Bt[100],hollowPointActiveBorderOpacity:1,hollowPointSelectedBorder:2,hollowPointSelectedBorderColor:Bt[100],hollowPointSelectedBorderOpacity:1,hollowPointInactiveBorderOpacity:.3,lineBorder:2,lineBorderColor:o,lineBorderOpacity:1,lineActiveBorder:3,lineSelectedBorder:3,lineInactiveBorderOpacity:.3,areaFillColor:o,areaFillOpacity:.25,areaActiveFillColor:o,areaActiveFillOpacity:.5,areaSelectedFillColor:o,areaSelectedFillOpacity:.5,areaInactiveFillOpacity:.3,hollowAreaBorderColor:o,hollowAreaBorder:2,hollowAreaBorderOpacity:1,hollowAreaActiveBorder:3,hollowAreaActiveBorderColor:Bt[100],hollowAreaSelectedBorder:3,hollowAreaSelectedBorderColor:Bt[100],hollowAreaInactiveBorderOpacity:.3,intervalFillColor:o,intervalFillOpacity:.95,intervalActiveBorder:1,intervalActiveBorderColor:Bt[100],intervalActiveBorderOpacity:1,intervalSelectedBorder:2,intervalSelectedBorderColor:Bt[100],intervalSelectedBorderOpacity:1,intervalInactiveBorderOpacity:.3,intervalInactiveFillOpacity:.3,hollowIntervalBorder:2,hollowIntervalBorderColor:o,hollowIntervalBorderOpacity:1,hollowIntervalFillColor:xa[100],hollowIntervalActiveBorder:2,hollowIntervalActiveBorderColor:Bt[100],hollowIntervalSelectedBorder:3,hollowIntervalSelectedBorderColor:Bt[100],hollowIntervalSelectedBorderOpacity:1,hollowIntervalInactiveBorderOpacity:.3};return C(C({},s),r)};BS();function fl(r){var n=r.styleSheet,t=n===void 0?{}:n,e=Tt(r,["styleSheet"]),i=BS(t);return J({},PS(i),e)}var zO=fl({}),mh={default:zO};function ts(r){return F(mh,la(r),mh.default)}function UO(r,n){mh[la(r)]=fl(n)}function Gg(r,n,t){var e=t.translate(r),i=t.translate(n);return we(e,i)}function HO(r,n){var t=n.coordinate,e=n.getXScale(),i=e.range,a=i[i.length-1],o=i[0],s=t.invert(r),u=s.x;return t.isPolar&&u>(1+a)/2&&(u=o),e.translate(e.invert(u))}function Vg(r,n,t){var e=t.coordinate,i=t.getYScale(),a=i.field,o=e.invert(n),s=i.invert(o.y),u=jr(r,function(l){var c=l[Vt];return c[a][0]<=s&&c[a][1]>=s});return u||r[r.length-1]}var $O=so(function(r){if(r.isCategory)return 1;for(var n=r.values,t=n.length,e=r.translate(n[0]),i=e,a=0;a<t;a++){var o=n[a],s=r.translate(o);s<e&&(e=s),s>i&&(i=s)}return(i-e)/(t-1)});function GO(r,n,t){var e=n.getAttribute("position"),i=e.getFields(),a=n.scales,o=rt(t)||!t?i[0]:t,s=a[o],u=s?s.getText(r[o]):r[o]||o;return rt(t)?t(u,r):u}function VO(r){var n=Pl(r.attributes);return Pe(n,function(t){return Ni(Pa,t.type)})}function NS(r){var n,t,e=VO(r),i;try{for(var a=It(e),o=a.next();!o.done;o=a.next()){var s=o.value,u=s.getScale(s.type);if(u&&u.isLinear){var l=F(r.scaleDefs,u.field),c=ES(u,l,s.type,r.type);if(c!=="cat"){i=u;break}}}}catch(v){n={error:v}}finally{try{o&&!o.done&&(t=a.return)&&t.call(a)}finally{if(n)throw n.error}}var f=r.getXScale(),h=r.getYScale();return i||h||f}function WO(r,n){var t=n.field,e=r[t];if(V(e)){var i=e.map(function(a){return n.getText(a)});return i.join("-")}return n.getText(e)}function jO(r,n){var t,e=n.getGroupScales();if(e.length&&(t=e[0]),t){var i=t.field;return t.getText(r[i])}var a=NS(n);return ps(a)}function zS(r,n,t){if(n.length===0)return null;var e=t.type,i=t.getXScale(),a=t.getYScale(),o=i.field,s=a.field,u=null;if(e==="heatmap"||e==="point"){for(var l=t.coordinate,c=l.invert(r),f=i.invert(c.x),h=a.invert(c.y),v=1/0,p=0;p<n.length;p++){var d=n[p],g=d[Vt],y=Math.pow(g[o]-f,2)+Math.pow(g[s]-h,2);y<v&&(v=y,u=d)}return u}var m=n[0],x=n[n.length-1],_=HO(r,t),E=m[Vt][o],b=m[Vt][s],M=x[Vt][o],T=a.isLinear&&V(b);if(V(E)){for(var p=0;p<n.length;p++){var k=n[p],g=k[Vt];if(i.translate(g[o][0])<=_&&i.translate(g[o][1])>=_)if(T)V(u)||(u=[]),u.push(k);else{u=k;break}}V(u)&&(u=Vg(u,r,t))}else{var L=void 0;if(!i.isLinear&&i.type!=="timeCat"){for(var p=0;p<n.length;p++){var k=n[p],g=k[Vt];if(Gg(g[o],_,i))if(T)V(u)||(u=[]),u.push(k);else{u=k;break}else i.translate(g[o])<=_&&(x=k,L=n[p+1])}V(u)&&(u=Vg(u,r,t))}else{if((_>i.translate(M)||_<i.translate(E))&&(_>i.max||_<i.min))return null;for(var O=0,D=n.length-1,W=void 0;O<=D;){W=Math.floor((O+D)/2);var j=n[W][Vt][o];if(Gg(j,_,i))return n[W];i.translate(j)<=i.translate(_)?(O=W+1,x=n[W],L=n[W+1]):(D===0&&(x=n[0]),D=W-1)}}x&&L&&Math.abs(i.translate(x[Vt][o])-_)>Math.abs(i.translate(L[Vt][o])-_)&&(x=L)}var ot=$O(t.getXScale());return!u&&Math.abs(i.translate(x[Vt][o])-_)<=ot/2&&(u=x),u}function qv(r,n,t,e){var i,a;t===void 0&&(t=""),e===void 0&&(e=!1);var o=r[Vt],s=GO(o,n,t),u=n.tooltipOption,l=n.theme.defaultColor,c=[],f,h;function v(k,L){if(e||!G(L)&&L!==""){var O={title:s,data:o,mappingData:r,name:k,value:L,color:r.color||l,marker:!0};c.push(O)}}if(wt(u)){var p=u.fields,d=u.callback;if(d){var g=p.map(function(k){return r[Vt][k]}),y=d.apply(void 0,te([],ut(g),!1)),m=C({data:r[Vt],mappingData:r,title:s,color:r.color||l,marker:!0},y);c.push(m)}else{var x=n.scales;try{for(var _=It(p),E=_.next();!E.done;E=_.next()){var b=E.value;if(!G(o[b])){var M=x[b];f=ps(M),h=M.getText(o[b]),v(f,h)}}}catch(k){i={error:k}}finally{try{E&&!E.done&&(a=_.return)&&a.call(_)}finally{if(i)throw i.error}}}}else{var T=NS(n);h=WO(o,T),f=jO(o,n),v(f,h)}return c}function Wg(r,n,t,e){var i,a,o=e.showNil,s=[],u=r.dataArray;if(!nr(u)){r.sort(u);try{for(var l=It(u),c=l.next();!c.done;c=l.next()){var f=c.value,h=zS(n,f,r);if(h){var v=r.getElementId(h),p=r.elementsMap[v];if(r.type==="heatmap"||p.visible){var d=qv(h,r,t,o);d.length&&s.push(d)}}}}catch(g){i={error:g}}finally{try{c&&!c.done&&(a=l.return)&&a.call(l)}finally{if(i)throw i.error}}}return s}function jg(r,n,t,e){var i=e.showNil,a=[],o=r.container,s=o.getShape(n.x,n.y);if(s&&s.get("visible")&&s.get("origin")){var u=s.get("origin").mappingData,l=qv(u,r,t,i);l.length&&a.push(l)}return a}function xh(r,n,t){var e,i,a=[],o=r.geometries,s=t.shared,u=t.title,l=t.reversed;try{for(var c=It(o),f=c.next();!f.done;f=c.next()){var h=f.value;if(h.visible&&h.tooltipOption!==!1){var v=h.type,p=void 0;["point","edge","polygon"].includes(v)?p=jg(h,n,u,t):["area","line","path","heatmap"].includes(v)||s!==!1?p=Wg(h,n,u,t):p=jg(h,n,u,t),p.length&&(l&&p.reverse(),a.push(p))}}}catch(d){e={error:d}}finally{try{f&&!f.done&&(i=c.return)&&i.call(c)}finally{if(e)throw e.error}}return a}function XO(r,n,t){var e,i,a=xh(r,n,t);try{for(var o=It(r.views),s=o.next();!s.done;s=o.next()){var u=s.value;a=a.concat(xh(u,n,t))}}catch(l){e={error:l}}finally{try{s&&!s.done&&(i=o.return)&&i.call(o)}finally{if(e)throw e.error}}return a}function YO(r){return!dt(r)&&!V(r)}function Kv(r){r===void 0&&(r=0);var n=V(r)?r:[r];switch(n.length){case 0:n=[0,0,0,0];break;case 1:n=new Array(4).fill(n[0]);break;case 2:n=te(te([],ut(n),!1),ut(n),!1);break;case 3:n=te(te([],ut(n),!1),[n[1]],!1);break;default:n=n.slice(0,4);break}return n}var Qv={};function ha(r,n){Qv[r]=n}function ZO(){return Object.keys(Qv)}function qO(r){return Qv[r]}var KO=function(){function r(n){this.option=this.wrapperOption(n)}return r.prototype.update=function(n){return this.option=this.wrapperOption(n),this},r.prototype.hasAction=function(n){var t=this.option.actions;return Dl(t,function(e){return e[0]===n})},r.prototype.create=function(n,t){var e=this.option,i=e.type,a=e.cfg,o=i==="theta",s=C({start:n,end:t},a),u=b5(o?"polar":i);return this.coordinate=new u(s),this.coordinate.type=i,o&&(this.hasAction("transpose")||this.transpose()),this.execActions(),this.coordinate},r.prototype.adjust=function(n,t){return this.coordinate.update({start:n,end:t}),this.coordinate.resetMatrix(),this.execActions(["scale","rotate","translate"]),this.coordinate},r.prototype.rotate=function(n){return this.option.actions.push(["rotate",n]),this},r.prototype.reflect=function(n){return this.option.actions.push(["reflect",n]),this},r.prototype.scale=function(n,t){return this.option.actions.push(["scale",n,t]),this},r.prototype.transpose=function(){return this.option.actions.push(["transpose"]),this},r.prototype.getOption=function(){return this.option},r.prototype.getCoordinate=function(){return this.coordinate},r.prototype.wrapperOption=function(n){return C({type:"rect",actions:[],cfg:{}},n)},r.prototype.execActions=function(n){var t=this,e=this.option.actions;w(e,function(i){var a,o=ut(i),s=o[0],u=o.slice(1),l=G(n)?!0:n.includes(s);l&&(a=t.coordinate)[s].apply(a,te([],ut(u),!1))})},r}(),re=function(){function r(n,t,e){this.view=n,this.gEvent=t,this.data=e,this.type=t.type}return r.fromData=function(n,t,e){return new r(n,new Bs(t,{}),e)},Object.defineProperty(r.prototype,"target",{get:function(){return this.gEvent.target},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"event",{get:function(){return this.gEvent.originalEvent},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"x",{get:function(){return this.gEvent.x},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"y",{get:function(){return this.gEvent.y},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"clientX",{get:function(){return this.gEvent.clientX},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"clientY",{get:function(){return this.gEvent.clientY},enumerable:!1,configurable:!0}),r.prototype.toString=function(){return"[Event (type=".concat(this.type,")]")},r.prototype.clone=function(){return new r(this.view,this.gEvent,this.data)},r}();function QO(r){var n=r.getController("axis"),t=r.getController("legend"),e=r.getController("annotation"),i=r.getController("slider"),a=r.getController("scrollbar");[n,i,a,t,e].forEach(function(o){o&&o.layout()})}var JO=function(){function r(){this.scales=new Map,this.syncScales=new Map}return r.prototype.createScale=function(n,t,e,i){var a=e,o=this.getScaleMeta(i);if(t.length===0&&o){var s=o.scale,u={type:s.type};s.isCategory&&(u.values=s.values),a=J(u,o.scaleDef,e)}var l=uO(n,t,a);return this.cacheScale(l,e,i),l},r.prototype.sync=function(n,t){var e=this;this.syncScales.forEach(function(i,a){var o=Number.MAX_SAFE_INTEGER,s=Number.MIN_SAFE_INTEGER,u=[];w(i,function(l){var c=e.getScale(l);s=dt(c.max)?Math.max(s,c.max):s,o=dt(c.min)?Math.min(o,c.min):o,w(c.values,function(f){u.includes(f)||u.push(f)})}),w(i,function(l){var c=e.getScale(l);if(c.isContinuous)c.change({min:o,max:s,values:u});else if(c.isCategory){var f=c.range,h=e.getScaleMeta(l);u&&!F(h,["scaleDef","range"])&&(f=SS(J({},c,{values:u}),n,t)),c.change({values:u,range:f})}})})},r.prototype.cacheScale=function(n,t,e){var i=this.getScaleMeta(e);i&&i.scale.type===n.type?(lO(i.scale,n),i.scaleDef=t):(i={key:e,scale:n,scaleDef:t},this.scales.set(e,i));var a=this.getSyncKey(i);if(i.syncKey=a,this.removeFromSyncScales(e),a){var o=this.syncScales.get(a);o||(o=[],this.syncScales.set(a,o)),o.push(e)}},r.prototype.getScale=function(n){var t=this.getScaleMeta(n);if(!t){var e=pe(n.split("-")),i=this.syncScales.get(e);i&&i.length&&(t=this.getScaleMeta(i[0]))}return t&&t.scale},r.prototype.deleteScale=function(n){var t=this.getScaleMeta(n);if(t){var e=t.syncKey,i=this.syncScales.get(e);if(i&&i.length){var a=i.indexOf(n);a!==-1&&i.splice(a,1)}}this.scales.delete(n)},r.prototype.clear=function(){this.scales.clear(),this.syncScales.clear()},r.prototype.removeFromSyncScales=function(n){var t=this;this.syncScales.forEach(function(e,i){var a=e.indexOf(n);if(a!==-1)return e.splice(a,1),e.length===0&&t.syncScales.delete(i),!1})},r.prototype.getSyncKey=function(n){var t=n.scale,e=n.scaleDef,i=t.field,a=F(e,["sync"]);return a===!0?i:a===!1?void 0:a},r.prototype.getScaleMeta=function(n){return this.scales.get(n)},r}(),ju=function(){function r(n,t,e,i){n===void 0&&(n=0),t===void 0&&(t=0),e===void 0&&(e=0),i===void 0&&(i=0),this.top=n,this.right=t,this.bottom=e,this.left=i}return r.instance=function(n,t,e,i){return n===void 0&&(n=0),t===void 0&&(t=0),e===void 0&&(e=0),i===void 0&&(i=0),new r(n,t,e,i)},r.prototype.max=function(n){var t=ut(n,4),e=t[0],i=t[1],a=t[2],o=t[3];return this.top=Math.max(this.top,e),this.right=Math.max(this.right,i),this.bottom=Math.max(this.bottom,a),this.left=Math.max(this.left,o),this},r.prototype.shrink=function(n){var t=ut(n,4),e=t[0],i=t[1],a=t[2],o=t[3];return this.top+=e,this.right+=i,this.bottom+=a,this.left+=o,this},r.prototype.inc=function(n,t){var e=n.width,i=n.height;switch(t){case Z.TOP:case Z.TOP_LEFT:case Z.TOP_RIGHT:this.top+=i;break;case Z.RIGHT:case Z.RIGHT_TOP:case Z.RIGHT_BOTTOM:this.right+=e;break;case Z.BOTTOM:case Z.BOTTOM_LEFT:case Z.BOTTOM_RIGHT:this.bottom+=i;break;case Z.LEFT:case Z.LEFT_TOP:case Z.LEFT_BOTTOM:this.left+=e;break}return this},r.prototype.getPadding=function(){return[this.top,this.right,this.bottom,this.left]},r.prototype.clone=function(){return new(r.bind.apply(r,te([void 0],ut(this.getPadding()),!1)))},r}();function tR(r){var n=r.padding;if(!YO(n))return new(ju.bind.apply(ju,te([void 0],ut(Kv(n)),!1)));var t=r.viewBBox,e=new ju,i=[],a=[],o=[];return w(r.getComponents(),function(s){var u=s.type;u===Ce.AXIS?i.push(s):[Ce.LEGEND,Ce.SLIDER,Ce.SCROLLBAR].includes(u)?a.push(s):u!==Ce.GRID&&u!==Ce.TOOLTIP&&o.push(s)}),w(i,function(s){var u=s.component,l=u.getLayoutBBox(),c=new je(l.x,l.y,l.width,l.height),f=c.exceed(t);e.max(f)}),w(a,function(s){var u=s.component,l=s.direction,c=u.getLayoutBBox(),f=u.get("padding"),h=new je(c.x,c.y,c.width,c.height).expand(f);e.inc(h,l)}),w(o,function(s){var u=s.component,l=s.direction,c=u.getLayoutBBox(),f=new je(c.x,c.y,c.width,c.height);e.inc(f,l)}),e}function eR(r,n,t){var e=t.instance();n.forEach(function(i){i.autoPadding=e.max(i.autoPadding.getPadding())})}var US=function(r){R(n,r);function n(t){var e=r.call(this,{visible:t.visible})||this;e.views=[],e.geometries=[],e.controllers=[],e.interactions={},e.limitInPlot=!1,e.options={data:[],animate:!0},e.usedControllers=ZO(),e.scalePool=new JO,e.layoutFunc=QO,e.isPreMouseInPlot=!1,e.isDataChanged=!1,e.isCoordinateChanged=!1,e.createdScaleKeys=new Map,e.onCanvasEvent=function(x){var _=x.name;if(!_.includes(":")){var E=e.createViewEvent(x);e.doPlotEvent(E),e.emit(_,E)}},e.onDelegateEvents=function(x){var _=x.name;if(!!_.includes(":")){var E=e.createViewEvent(x);e.emit(_,E)}};var i=t.id,a=i===void 0?Ir("view"):i,o=t.parent,s=t.canvas,u=t.backgroundGroup,l=t.middleGroup,c=t.foregroundGroup,f=t.region,h=f===void 0?{start:{x:0,y:0},end:{x:1,y:1}}:f,v=t.padding,p=t.appendPadding,d=t.theme,g=t.options,y=t.limitInPlot,m=t.syncViewPadding;return e.parent=o,e.canvas=s,e.backgroundGroup=u,e.middleGroup=l,e.foregroundGroup=c,e.region=h,e.padding=v,e.appendPadding=p,e.options=C(C({},e.options),g),e.limitInPlot=y,e.id=a,e.syncViewPadding=m,e.themeObject=wt(d)?J({},ts("default"),fl(d)):ts(d),e.init(),e}return n.prototype.setLayout=function(t){this.layoutFunc=t},n.prototype.init=function(){this.calculateViewBBox(),this.initEvents(),this.initComponentController(),this.initOptions()},n.prototype.render=function(t,e){t===void 0&&(t=!1),this.emit(_t.BEFORE_RENDER,re.fromData(this,_t.BEFORE_RENDER,e)),this.paint(t),this.emit(_t.AFTER_RENDER,re.fromData(this,_t.AFTER_RENDER,e)),this.visible===!1&&this.changeVisible(!1)},n.prototype.clear=function(){var t=this;this.emit(_t.BEFORE_CLEAR),this.filteredData=[],this.coordinateInstance=void 0,this.isDataChanged=!1,this.isCoordinateChanged=!1;for(var e=this.geometries,i=0;i<e.length;i++)e[i].clear(),e[i].container.remove(!0),e[i].labelsContainer.remove(!0);this.geometries=[];for(var a=this.controllers,i=0;i<a.length;i++)a[i].name==="annotation"?a[i].clear(!0):a[i].clear();this.createdScaleKeys.forEach(function(s,u){t.getRootView().scalePool.deleteScale(u)}),this.createdScaleKeys.clear();for(var o=this.views,i=0;i<o.length;i++)o[i].clear();this.emit(_t.AFTER_CLEAR)},n.prototype.destroy=function(){this.emit(_t.BEFORE_DESTROY);var t=this.interactions;w(t,function(s){s&&s.destroy()}),this.clear();for(var e=this.controllers,i=0,a=e.length;i<a;i++){var o=e[i];o.destroy()}this.backgroundGroup.remove(!0),this.middleGroup.remove(!0),this.foregroundGroup.remove(!0),r.prototype.destroy.call(this)},n.prototype.changeVisible=function(t){r.prototype.changeVisible.call(this,t);for(var e=this.geometries,i=0,a=e.length;i<a;i++){var o=e[i];o.changeVisible(t)}for(var s=this.controllers,i=0,a=s.length;i<a;i++){var u=s[i];u.changeVisible(t)}return this.foregroundGroup.set("visible",t),this.middleGroup.set("visible",t),this.backgroundGroup.set("visible",t),this.getCanvas().draw(),this},n.prototype.data=function(t){return he(this.options,"data",t),this.isDataChanged=!0,this},n.prototype.source=function(t){return console.warn("This method will be removed at G2 V4.1. Please use chart.data() instead."),this.data(t)},n.prototype.filter=function(t,e){return rt(e)?(he(this.options,["filters",t],e),this):(!e&&F(this.options,["filters",t])&&delete this.options.filters[t],this)},n.prototype.axis=function(t,e){return ui(t)?he(this.options,["axes"],t):he(this.options,["axes",t],e),this},n.prototype.legend=function(t,e){return ui(t)?he(this.options,["legends"],t):lt(t)?(he(this.options,["legends",t],e),fn(e)&&(e==null?void 0:e.selected)&&he(this.options,["filters",t],function(i){var a;return(a=e==null?void 0:e.selected[i])!==null&&a!==void 0?a:!0})):he(this.options,["legends"],t),this},n.prototype.scale=function(t,e){var i=this;return lt(t)?he(this.options,["scales",t],e):wt(t)&&w(t,function(a,o){he(i.options,["scales",o],a)}),this},n.prototype.tooltip=function(t){return he(this.options,"tooltip",t),this},n.prototype.annotation=function(){return this.getController("annotation")},n.prototype.guide=function(){return console.warn("This method will be removed at G2 V4.1. Please use chart.annotation() instead."),this.annotation()},n.prototype.coordinate=function(t,e){return lt(t)?he(this.options,"coordinate",{type:t,cfg:e}):he(this.options,"coordinate",t),this.coordinateController.update(this.options.coordinate),this.coordinateController},n.prototype.coord=function(t,e){return console.warn("This method will be removed at G2 V4.1. Please use chart.coordinate() instead."),this.coordinate(t,e)},n.prototype.facet=function(t,e){this.facetInstance&&this.facetInstance.destroy();var i=vO(t);if(!i)throw new Error("facet '".concat(t,"' is not exist!"));return this.facetInstance=new i(this,C(C({},e),{type:t})),this},n.prototype.animate=function(t){return he(this.options,"animate",t),this},n.prototype.updateOptions=function(t){return this.clear(),zt(this.options,t),this.views.forEach(function(e){return e.destroy()}),this.views=[],this.initOptions(),this.coordinateBBox=this.viewBBox,this},n.prototype.option=function(t,e){if(n.prototype[t])throw new Error(`Can't use built in variable name "`.concat(t,'", please change another one.'));return he(this.options,t,e),this},n.prototype.theme=function(t){return this.themeObject=wt(t)?J({},this.themeObject,fl(t)):ts(t),this},n.prototype.interaction=function(t,e){var i=this.interactions[t];i&&i.destroy();var a=RO(t,this,e);return a&&(a.init(),this.interactions[t]=a),this},n.prototype.removeInteraction=function(t){var e=this.interactions[t];e&&(e.destroy(),this.interactions[t]=void 0)},n.prototype.changeData=function(t){this.isDataChanged=!0,this.emit(_t.BEFORE_CHANGE_DATA,re.fromData(this,_t.BEFORE_CHANGE_DATA,null)),this.data(t),this.paint(!0);for(var e=this.views,i=0,a=e.length;i<a;i++){var o=e[i];o.changeData(t)}this.emit(_t.AFTER_CHANGE_DATA,re.fromData(this,_t.AFTER_CHANGE_DATA,null))},n.prototype.createView=function(t){this.parent&&this.parent.parent&&console.warn("The view nesting recursive feature will be removed at G2 V4.1. Please avoid to use it.");var e={data:this.options.data,scales:Ve(this.options.scales),axes:Ve(this.options.axes),coordinate:Ve(this.coordinateController.getOption()),tooltip:Ve(this.options.tooltip),legends:Ve(this.options.legends),animate:this.options.animate,visible:this.visible},i=new n(C(C({parent:this,canvas:this.canvas,backgroundGroup:this.backgroundGroup.addGroup({zIndex:za.BG}),middleGroup:this.middleGroup.addGroup({zIndex:za.MID}),foregroundGroup:this.foregroundGroup.addGroup({zIndex:za.FORE}),theme:this.themeObject,padding:this.padding},t),{options:C(C({},e),F(t,"options",{}))}));return this.views.push(i),i},n.prototype.view=function(t){return console.warn("This method will be removed at G2 V4.1. Please use chart.createView() instead."),this.createView(t)},n.prototype.removeView=function(t){var e=yw(this.views,function(i){return i===t})[0];return e&&e.destroy(),e},n.prototype.getCoordinate=function(){return this.coordinateInstance},n.prototype.getTheme=function(){return this.themeObject},n.prototype.getXScale=function(){var t=this.geometries[0];return t?t.getXScale():null},n.prototype.getYScales=function(){var t={},e=[];return this.geometries.forEach(function(i){var a=i.getYScale(),o=a.field;t[o]||(t[o]=!0,e.push(a))}),e},n.prototype.getScalesByDim=function(t){for(var e=this.geometries,i={},a=0,o=e.length;a<o;a++){var s=e[a],u=t==="x"?s.getXScale():s.getYScale();u&&!i[u.field]&&(i[u.field]=u)}return i},n.prototype.getScale=function(t,e){var i=e||this.getScaleKey(t);return this.getRootView().scalePool.getScale(i)},n.prototype.getScaleByField=function(t,e){return this.getScale(t,e)},n.prototype.getOptions=function(){return this.options},n.prototype.getData=function(){return this.filteredData},n.prototype.getOriginalData=function(){return this.options.data},n.prototype.getPadding=function(){return this.autoPadding.getPadding()},n.prototype.getGeometries=function(){return this.geometries},n.prototype.getElements=function(){return ze(this.geometries,function(t,e){return t.concat(e.getElements())},[])},n.prototype.getElementsBy=function(t){return this.getElements().filter(function(e){return t(e)})},n.prototype.getLayer=function(t){return t===ue.BG?this.backgroundGroup:t===ue.MID?this.middleGroup:t===ue.FORE?this.foregroundGroup:this.foregroundGroup},n.prototype.isPointInPlot=function(t){return iO(this.getCoordinate(),t)},n.prototype.getLegendAttributes=function(){return yr(this.geometries.map(function(t){return t.getGroupAttributes()}))},n.prototype.getGroupScales=function(){var t=this.geometries.map(function(e){return e.getGroupScales()});return Jn(yr(t))},n.prototype.getCanvas=function(){return this.getRootView().canvas},n.prototype.getRootView=function(){for(var t=this;;){if(t.parent){t=t.parent;continue}break}return t},n.prototype.getXY=function(t){var e=this.getCoordinate(),i=this.getScalesByDim("x"),a=this.getScalesByDim("y"),o,s;if(w(t,function(u,l){i[l]&&(o=i[l].scale(u)),a[l]&&(s=a[l].scale(u))}),!G(o)&&!G(s))return e.convert({x:o,y:s})},n.prototype.getController=function(t){return jr(this.controllers,function(e){return e.name===t})},n.prototype.showTooltip=function(t){var e=this.getController("tooltip");return e&&e.showTooltip(t),this},n.prototype.hideTooltip=function(){var t=this.getController("tooltip");return t&&t.hideTooltip(),this},n.prototype.lockTooltip=function(){var t=this.getController("tooltip");return t&&t.lockTooltip(),this},n.prototype.unlockTooltip=function(){var t=this.getController("tooltip");return t&&t.unlockTooltip(),this},n.prototype.isTooltipLocked=function(){var t=this.getController("tooltip");return t&&t.isTooltipLocked()},n.prototype.getTooltipItems=function(t){var e=this.getController("tooltip");return e?e.getTooltipItems(t):[]},n.prototype.getSnapRecords=function(t){for(var e=this.geometries,i=[],a=0,o=e.length;a<o;a++){var s=e[a],u=s.dataArray;s.sort(u);for(var l=void 0,c=0,f=u.length;c<f;c++){var h=u[c];l=zS(t,h,s),l&&i.push(l)}}for(var v=this.views,a=0,o=v.length;a<o;a++){var p=v[a],d=p.getSnapRecords(t);i=i.concat(d)}return i},n.prototype.getComponents=function(){for(var t=[],e=this.controllers,i=0,a=e.length;i<a;i++){var o=e[i];t=t.concat(o.getComponents())}return t},n.prototype.filterData=function(t){var e=this.options.filters;return Ee(e)===0?t:Pe(t,function(i,a){var o=Object.keys(e);return o.every(function(s){var u=e[s];return u(i[s],i,a)})})},n.prototype.filterFieldData=function(t,e){var i=this.options.filters,a=F(i,t);return Je(a)?e:e.filter(function(o,s){return a(o[t],o,s)})},n.prototype.adjustCoordinate=function(){var t=this.getCoordinate(),e=t.start,i=t.end,a=this.coordinateBBox.bl,o=this.coordinateBBox.tr;if(Dt(e,a)&&Dt(i,o)){this.isCoordinateChanged=!1;return}this.isCoordinateChanged=!0,this.coordinateInstance=this.coordinateController.adjust(a,o)},n.prototype.paint=function(t){this.renderDataRecursive(t),this.syncScale(),this.emit(_t.BEFORE_PAINT),this.renderPaddingRecursive(t),this.renderLayoutRecursive(t),this.renderBackgroundStyleShape(),this.renderPaintRecursive(t),this.emit(_t.AFTER_PAINT),this.isDataChanged=!1},n.prototype.renderBackgroundStyleShape=function(){if(!this.parent){var t=F(this.themeObject,"background");if(t){this.backgroundStyleRectShape||(this.backgroundStyleRectShape=this.backgroundGroup.addShape("rect",{attrs:{},zIndex:-1,capture:!1}),this.backgroundStyleRectShape.toBack());var e=this.viewBBox,i=e.x,a=e.y,o=e.width,s=e.height;this.backgroundStyleRectShape.attr({fill:t,x:i,y:a,width:o,height:s})}else this.backgroundStyleRectShape&&(this.backgroundStyleRectShape.remove(!0),this.backgroundStyleRectShape=void 0)}},n.prototype.renderPaddingRecursive=function(t){this.calculateViewBBox(),this.adjustCoordinate(),this.initComponents(t),this.autoPadding=tR(this).shrink(Kv(this.appendPadding)),this.coordinateBBox=this.viewBBox.shrink(this.autoPadding.getPadding()),this.adjustCoordinate();var e=this.controllers.find(function(u){return u.name==="tooltip"});e.update();for(var i=this.views,a=0,o=i.length;a<o;a++){var s=i[a];s.renderPaddingRecursive(t)}},n.prototype.renderLayoutRecursive=function(t){var e=this.syncViewPadding===!0?eR:rt(this.syncViewPadding)?this.syncViewPadding:void 0;e&&(e(this,this.views,ju),this.views.forEach(function(u){u.coordinateBBox=u.viewBBox.shrink(u.autoPadding.getPadding()),u.adjustCoordinate()})),this.doLayout();for(var i=this.views,a=0,o=i.length;a<o;a++){var s=i[a];s.renderLayoutRecursive(t)}},n.prototype.renderPaintRecursive=function(t){var e=this.middleGroup;if(this.limitInPlot){var i=Wv(this.coordinateInstance),a=i.type,o=i.attrs;e.setClip({type:a,attrs:o})}else e.setClip(void 0);this.paintGeometries(t),this.renderComponents(t);for(var s=this.views,u=0,l=s.length;u<l;u++){var c=s[u];c.renderPaintRecursive(t)}},n.prototype.createScale=function(t,e,i,a){var o=F(this.options.scales,[t]),s=C(C({},o),i);return this.parent?this.parent.createScale(t,e,s,a):this.scalePool.createScale(t,e,s,a)},n.prototype.renderDataRecursive=function(t){this.doFilterData(),this.createCoordinate(),this.initGeometries(t),this.renderFacet(t);for(var e=this.views,i=0,a=e.length;i<a;i++){var o=e[i];o.renderDataRecursive(t)}},n.prototype.calculateViewBBox=function(){var t,e,i,a;if(this.parent){var o=this.parent.coordinateBBox;t=o.x,e=o.y,i=o.width,a=o.height}else t=0,e=0,i=this.canvas.get("width"),a=this.canvas.get("height");var s=this.region,u=s.start,l=s.end,c=new je(t+i*u.x,e+a*u.y,i*(l.x-u.x),a*(l.y-u.y));(!this.viewBBox||!this.viewBBox.isEqual(c))&&(this.viewBBox=new je(t+i*u.x,e+a*u.y,i*(l.x-u.x),a*(l.y-u.y))),this.coordinateBBox=this.viewBBox},n.prototype.initEvents=function(){this.foregroundGroup.on("*",this.onDelegateEvents),this.middleGroup.on("*",this.onDelegateEvents),this.backgroundGroup.on("*",this.onDelegateEvents),this.canvas.on("*",this.onCanvasEvent)},n.prototype.initComponentController=function(){for(var t=this.usedControllers,e=0,i=t.length;e<i;e++){var a=t[e],o=qO(a);o&&this.controllers.push(new o(this))}},n.prototype.createViewEvent=function(t){var e=t.shape,i=t.name,a=e?e.get("origin"):null,o=new re(this,t,a);return o.type=i,o},n.prototype.doPlotEvent=function(t){var e=t.type,i=t.x,a=t.y,o={x:i,y:a},s=["mousedown","mouseup","mousemove","mouseleave","mousewheel","touchstart","touchmove","touchend","touchcancel","click","dblclick","contextmenu"];if(s.includes(e)){var u=this.isPointInPlot(o),l=t.clone();if(u){var c="plot:".concat(e);l.type=c,this.emit(c,l),(e==="mouseleave"||e==="touchend")&&(this.isPreMouseInPlot=!1)}e==="mousemove"||e==="touchmove"?(this.isPreMouseInPlot&&!u?(e==="mousemove"&&(l.type=Ye.MOUSE_LEAVE,this.emit(Ye.MOUSE_LEAVE,l)),l.type=Ye.LEAVE,this.emit(Ye.LEAVE,l)):!this.isPreMouseInPlot&&u&&(e==="mousemove"&&(l.type=Ye.MOUSE_ENTER,this.emit(Ye.MOUSE_ENTER,l)),l.type=Ye.ENTER,this.emit(Ye.ENTER,l)),this.isPreMouseInPlot=u):(e==="mouseleave"||e==="touchend")&&this.isPreMouseInPlot&&(e==="mouseleave"&&(l.type=Ye.MOUSE_LEAVE,this.emit(Ye.MOUSE_LEAVE,l)),l.type=Ye.LEAVE,this.emit(Ye.LEAVE,l),this.isPreMouseInPlot=!1)}},n.prototype.doFilterData=function(){var t=this.options.data;this.filteredData=this.filterData(t)},n.prototype.initGeometries=function(t){this.createOrUpdateScales();for(var e=this.getCoordinate(),i=F(this.options,"scales",{}),a=this.geometries,o=0,s=a.length;o<s;o++){var u=a[o];u.scales=this.getGeometryScales();var l={coordinate:e,scaleDefs:i,data:this.filteredData,theme:this.themeObject,isDataChanged:this.isDataChanged,isCoordinateChanged:this.isCoordinateChanged};t?u.update(l):u.init(l)}this.adjustScales()},n.prototype.createOrUpdateScales=function(){for(var t=this.getScaleFields(),e=this.getGroupedFields(),i=this.getOptions(),a=i.data,o=i.scales,s=o===void 0?{}:o,u=this.filteredData,l=0,c=t.length;l<c;l++){var f=t[l],h=s[f],v=this.getScaleKey(f);this.createScale(f,e.includes(f)?a:u,h,v),this.createdScaleKeys.set(v,!0)}},n.prototype.syncScale=function(){this.getRootView().scalePool.sync(this.getCoordinate(),this.theme)},n.prototype.getGeometryScales=function(){for(var t=this.getScaleFields(),e={},i=0;i<t.length;i++){var a=t[i];e[a]=this.getScaleByField(a)}return e},n.prototype.getScaleFields=function(){for(var t=[],e=new Map,i=this.geometries,a=0;a<i.length;a++){var o=i[a],s=o.getScaleFields();Jn(s,t,e)}return t},n.prototype.getGroupedFields=function(){for(var t=[],e=new Map,i=this.geometries,a=0;a<i.length;a++){var o=i[a],s=o.getGroupFields();Jn(s,t,e)}return t},n.prototype.adjustScales=function(){this.adjustCategoryScaleRange()},n.prototype.adjustCategoryScaleRange=function(){var t=this,e=te([this.getXScale()],ut(this.getYScales()),!1).filter(function(o){return!!o}),i=this.getCoordinate(),a=this.options.scales;w(e,function(o){var s=o.field,u=o.values,l=o.isCategory,c=o.isIdentity;(l||c)&&u&&!F(a,[s,"range"])&&(o.range=SS(o,i,t.theme))})},n.prototype.initComponents=function(t){for(var e=this.controllers,i=0;i<e.length;i++){var a=e[i];t?a.update():(a.clear(),a.render())}},n.prototype.doLayout=function(){this.layoutFunc(this)},n.prototype.createCoordinate=function(){var t=this.coordinateBBox.bl,e=this.coordinateBBox.tr;this.coordinateInstance=this.coordinateController.create(t,e)},n.prototype.paintGeometries=function(t){for(var e=this.options.animate,i=this.getCoordinate(),a={x:this.viewBBox.x,y:this.viewBBox.y,minX:this.viewBBox.minX,minY:this.viewBBox.minY,maxX:this.viewBBox.maxX,maxY:this.viewBBox.maxY,width:this.viewBBox.width,height:this.viewBBox.height},o=this.geometries,s=0;s<o.length;s++){var u=o[s];u.coordinate=i,u.canvasRegion=a,e||u.animate(!1),u.paint(t)}},n.prototype.renderComponents=function(t){for(var e=this.getComponents(),i=0;i<e.length;i++){var a=e[i];a.component.render()}},n.prototype.renderFacet=function(t){this.facetInstance&&(t?this.facetInstance.update():(this.facetInstance.clear(),this.facetInstance.init(),this.facetInstance.render()))},n.prototype.initOptions=function(){var t=this,e=this.options,i=e.geometries,a=i===void 0?[]:i,o=e.interactions,s=o===void 0?[]:o,u=e.views,l=u===void 0?[]:u,c=e.annotations,f=c===void 0?[]:c,h=e.coordinate,v=e.events,p=e.facets;this.coordinateController?h&&this.coordinateController.update(h):this.coordinateController=new KO(h);for(var d=0;d<a.length;d++){var g=a[d];this.createGeometry(g)}for(var y=0;y<s.length;y++){var m=s[y],x=m.type,_=m.cfg;this.interaction(x,_)}for(var E=0;E<l.length;E++){var b=l[E];this.createView(b)}for(var M=this.getController("annotation"),T=0;T<f.length;T++){var k=f[T];M.annotation(k)}v&&w(v,function(L,O){t.on(O,L)}),p&&w(p,function(L){var O=L.type,D=Tt(L,["type"]);t.facet(O,D)})},n.prototype.createGeometry=function(t){var e=t.type,i=t.cfg,a=i===void 0?{}:i;if(this[e]){var o=this[e](a);w(t,function(s,u){rt(o[u])&&o[u](s)})}},n.prototype.getScaleKey=function(t){return"".concat(this.id,"-").concat(t)},n}(wv);function mn(r,n){US.prototype[r.toLowerCase()]=function(t){t===void 0&&(t={});var e=C({container:this.middleGroup.addGroup(),labelsContainer:this.foregroundGroup.addGroup()},t),i=new n(e);return this.geometries.push(i),i}}var rR=function(r){R(n,r);function n(t){var e=this,i=t.container,a=t.width,o=t.height,s=t.autoFit,u=s===void 0?!1:s,l=t.padding,c=t.appendPadding,f=t.renderer,h=f===void 0?"canvas":f,v=t.pixelRatio,p=t.localRefresh,d=p===void 0?!0:p,g=t.visible,y=g===void 0?!0:g,m=t.supportCSSTransform,x=m===void 0?!1:m,_=t.defaultInteractions,E=_===void 0?["tooltip","legend-filter","legend-active","continuous-filter","ellipsis-text","axis-description"]:_,b=t.options,M=t.limitInPlot,T=t.theme,k=t.syncViewPadding,L=lt(i)?document.getElementById(i):i,O=wn('<div style="position:relative;"></div>');L.appendChild(O);var D=Ud(L,u,a,o),W=zw(h),j=new W.Canvas(C({container:O,pixelRatio:v,localRefresh:d,supportCSSTransform:x},D));return e=r.call(this,{parent:null,canvas:j,backgroundGroup:j.addGroup({zIndex:za.BG}),middleGroup:j.addGroup({zIndex:za.MID}),foregroundGroup:j.addGroup({zIndex:za.FORE}),padding:l,appendPadding:c,visible:y,options:b,limitInPlot:M,theme:T,syncViewPadding:k})||this,e.onResize=sE(function(){e.forceFit()},300),e.ele=L,e.canvas=j,e.width=D.width,e.height=D.height,e.autoFit=u,e.localRefresh=d,e.renderer=h,e.wrapperElement=O,e.updateCanvasStyle(),e.bindAutoFit(),e.initDefaultInteractions(E),e}return n.prototype.initDefaultInteractions=function(t){var e=this;w(t,function(i){e.interaction(i)})},n.prototype.aria=function(t){var e="aria-label";t===!1?this.ele.removeAttribute(e):this.ele.setAttribute(e,t.label)},n.prototype.changeSize=function(t,e){return this.width===t&&this.height===e?this:(this.emit(_t.BEFORE_CHANGE_SIZE),this.width=t,this.height=e,this.canvas.changeSize(t,e),this.render(!0),this.emit(_t.AFTER_CHANGE_SIZE),this)},n.prototype.clear=function(){r.prototype.clear.call(this),this.aria(!1)},n.prototype.destroy=function(){r.prototype.destroy.call(this),this.unbindAutoFit(),this.canvas.destroy(),jw(this.wrapperElement),this.wrapperElement=null},n.prototype.changeVisible=function(t){return r.prototype.changeVisible.call(this,t),this.wrapperElement.style.display=t?"":"none",this},n.prototype.forceFit=function(){if(!this.destroyed){var t=Ud(this.ele,!0,this.width,this.height),e=t.width,i=t.height;this.changeSize(e,i)}},n.prototype.updateCanvasStyle=function(){Xt(this.canvas.get("el"),{display:"inline-block",verticalAlign:"middle"})},n.prototype.bindAutoFit=function(){this.autoFit&&window.addEventListener("resize",this.onResize)},n.prototype.unbindAutoFit=function(){this.autoFit&&window.removeEventListener("resize",this.onResize)},n}(US),fo=function(){function r(n){this.visible=!0,this.components=[],this.view=n}return r.prototype.clear=function(n){w(this.components,function(t){t.component.destroy()}),this.components=[]},r.prototype.destroy=function(){this.clear()},r.prototype.getComponents=function(){return this.components},r.prototype.changeVisible=function(n){this.visible!==n&&(this.components.forEach(function(t){n?t.component.show():t.component.hide()}),this.visible=n)},r}();function nR(r){for(var n=[],t=function(i){var a=r[i],o=jr(n,function(s){return s.color===a.color&&s.name===a.name&&s.value===a.value&&s.title===a.title});o||n.push(a)},e=0;e<r.length;e++)t(e);return n}var HS=function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.isLocked=!1,t}return Object.defineProperty(n.prototype,"name",{get:function(){return"tooltip"},enumerable:!1,configurable:!0}),n.prototype.init=function(){},n.prototype.isVisible=function(){var t=this.view.getOptions().tooltip;return t!==!1},n.prototype.render=function(){},n.prototype.showTooltip=function(t){if(this.point=t,!!this.isVisible()){var e=this.view,i=this.getTooltipItems(t);if(!i.length){this.hideTooltip();return}var a=this.getTitle(i),o={x:i[0].x,y:i[0].y};e.emit("tooltip:show",re.fromData(e,"tooltip:show",C({items:i,title:a},t)));var s=this.getTooltipCfg(),u=s.follow,l=s.showMarkers,c=s.showCrosshairs,f=s.showContent,h=s.marker,v=this.items,p=this.title;if(!Dt(p,a)||!Dt(v,i)?(e.emit("tooltip:change",re.fromData(e,"tooltip:change",C({items:i,title:a},t))),(rt(f)?f(i):f)&&(this.tooltip||this.renderTooltip(),this.tooltip.update(zt({},s,{items:this.getItemsAfterProcess(i),title:a},u?t:{})),this.tooltip.show()),l&&this.renderTooltipMarkers(i,h)):(this.tooltip&&u&&(this.tooltip.update(t),this.tooltip.show()),this.tooltipMarkersGroup&&this.tooltipMarkersGroup.show()),this.items=i,this.title=a,c){var d=F(s,["crosshairs","follow"],!1);this.renderCrosshairs(d?t:o,s)}}},n.prototype.hideTooltip=function(){var t=this.getTooltipCfg().follow;if(!t){this.point=null;return}var e=this.tooltipMarkersGroup;e&&e.hide();var i=this.xCrosshair,a=this.yCrosshair;i&&i.hide(),a&&a.hide();var o=this.tooltip;o&&o.hide(),this.view.emit("tooltip:hide",re.fromData(this.view,"tooltip:hide",{})),this.point=null},n.prototype.lockTooltip=function(){this.isLocked=!0,this.tooltip&&this.tooltip.setCapture(!0)},n.prototype.unlockTooltip=function(){this.isLocked=!1;var t=this.getTooltipCfg();this.tooltip&&this.tooltip.setCapture(t.capture)},n.prototype.isTooltipLocked=function(){return this.isLocked},n.prototype.clear=function(){var t=this,e=t.tooltip,i=t.xCrosshair,a=t.yCrosshair,o=t.tooltipMarkersGroup;e&&(e.hide(),e.clear()),i&&i.clear(),a&&a.clear(),o&&o.clear(),e!=null&&e.get("customContent")&&(this.tooltip.destroy(),this.tooltip=null),this.title=null,this.items=null},n.prototype.destroy=function(){this.tooltip&&this.tooltip.destroy(),this.xCrosshair&&this.xCrosshair.destroy(),this.yCrosshair&&this.yCrosshair.destroy(),this.guideGroup&&this.guideGroup.remove(!0),this.reset()},n.prototype.reset=function(){this.items=null,this.title=null,this.tooltipMarkersGroup=null,this.tooltipCrosshairsGroup=null,this.xCrosshair=null,this.yCrosshair=null,this.tooltip=null,this.guideGroup=null,this.isLocked=!1,this.point=null},n.prototype.changeVisible=function(t){if(this.visible!==t){var e=this,i=e.tooltip,a=e.tooltipMarkersGroup,o=e.xCrosshair,s=e.yCrosshair;t?(i&&i.show(),a&&a.show(),o&&o.show(),s&&s.show()):(i&&i.hide(),a&&a.hide(),o&&o.hide(),s&&s.hide()),this.visible=t}},n.prototype.getTooltipItems=function(t){var e,i,a,o,s,u,l=this.findItemsFromView(this.view,t);if(l.length){l=yr(l);try{for(var c=It(l),f=c.next();!f.done;f=c.next()){var h=f.value;try{for(var v=(a=void 0,It(h)),p=v.next();!p.done;p=v.next()){var d=p.value,g=d.mappingData,y=g.x,m=g.y;d.x=V(y)?y[y.length-1]:y,d.y=V(m)?m[m.length-1]:m}}catch(L){a={error:L}}finally{try{p&&!p.done&&(o=v.return)&&o.call(v)}finally{if(a)throw a.error}}}}catch(L){e={error:L}}finally{try{f&&!f.done&&(i=c.return)&&i.call(c)}finally{if(e)throw e.error}}var x=this.getTooltipCfg().shared;if(x===!1&&l.length>1){var _=l[0],E=Math.abs(t.y-_[0].y);try{for(var b=It(l),M=b.next();!M.done;M=b.next()){var T=M.value,k=Math.abs(t.y-T[0].y);k<=E&&(_=T,E=k)}}catch(L){s={error:L}}finally{try{M&&!M.done&&(u=b.return)&&u.call(b)}finally{if(s)throw s.error}}l=[_]}return nR(yr(l))}return[]},n.prototype.layout=function(){},n.prototype.update=function(){if(this.point&&this.showTooltip(this.point),this.tooltip){var t=this.view.getCanvas();this.tooltip.set("region",{start:{x:0,y:0},end:{x:t.get("width"),y:t.get("height")}})}},n.prototype.isCursorEntered=function(t){if(this.tooltip){var e=this.tooltip.getContainer(),i=this.tooltip.get("capture");if(e&&i){var a=e.getBoundingClientRect(),o=a.x,s=a.y,u=a.width,l=a.height;return new je(o,s,u,l).isPointIn(t)}}return!1},n.prototype.getTooltipCfg=function(){var t=this.view,e=t.getOptions().tooltip,i=this.processCustomContent(e),a=t.getTheme(),o=F(a,["components","tooltip"],{}),s=F(i,"enterable",o.enterable);return J({},o,i,{capture:!!(s||this.isLocked)})},n.prototype.processCustomContent=function(t){if(ui(t)||!F(t,"customContent"))return t;var e=t.customContent,i=function(a,o){var s=e(a,o)||"";return lt(s)?'<div class="g2-tooltip">'+s+"</div>":s};return C(C({},t),{customContent:i})},n.prototype.getTitle=function(t){var e=t[0].title||t[0].name;return this.title=e,e},n.prototype.renderTooltip=function(){var t=this.view.getCanvas(),e={start:{x:0,y:0},end:{x:t.get("width"),y:t.get("height")}},i=this.getTooltipCfg(),a=new oc(C(C({parent:t.get("el").parentNode,region:e},i),{visible:!1,crosshairs:null}));a.init(),this.tooltip=a},n.prototype.renderTooltipMarkers=function(t,e){var i,a,o=this.getTooltipMarkersGroup(),s=this.view.getRootView(),u=s.limitInPlot;try{for(var l=It(t),c=l.next();!c.done;c=l.next()){var f=c.value,h=f.x,v=f.y;if(u||(o==null?void 0:o.getClip())){var p=Wv(s.getCoordinate()),d=p.type,g=p.attrs;o==null||o.setClip({type:d,attrs:g})}else o==null||o.setClip(void 0);var y=this.view.getTheme(),m=F(y,["components","tooltip","marker"],{}),x=C(C({fill:f.color,symbol:"circle",shadowColor:f.color},rt(e)?C(C({},m),e(f)):e),{x:h,y:v});o.addShape("marker",{attrs:x})}}catch(_){i={error:_}}finally{try{c&&!c.done&&(a=l.return)&&a.call(l)}finally{if(i)throw i.error}}},n.prototype.renderCrosshairs=function(t,e){var i=F(e,["crosshairs","type"],"x");i==="x"?(this.yCrosshair&&this.yCrosshair.hide(),this.renderXCrosshairs(t,e)):i==="y"?(this.xCrosshair&&this.xCrosshair.hide(),this.renderYCrosshairs(t,e)):i==="xy"&&(this.renderXCrosshairs(t,e),this.renderYCrosshairs(t,e))},n.prototype.renderXCrosshairs=function(t,e){var i=this.getViewWithGeometry(this.view).getCoordinate(),a,o;if(i.isRect)i.isTransposed?(a={x:i.start.x,y:t.y},o={x:i.end.x,y:t.y}):(a={x:t.x,y:i.end.y},o={x:t.x,y:i.start.y});else{var s=Ka(i,t),u=i.getCenter(),l=i.getRadius();o=fe(u.x,u.y,l,s),a=u}var c=J({start:a,end:o,container:this.getTooltipCrosshairsGroup()},F(e,"crosshairs",{}),this.getCrosshairsText("x",t,e));delete c.type;var f=this.xCrosshair;f?f.update(c):(f=new dS(c),f.init()),f.render(),f.show(),this.xCrosshair=f},n.prototype.renderYCrosshairs=function(t,e){var i=this.getViewWithGeometry(this.view).getCoordinate(),a,o;if(i.isRect){var s=void 0,u=void 0;i.isTransposed?(s={x:t.x,y:i.end.y},u={x:t.x,y:i.start.y}):(s={x:i.start.x,y:t.y},u={x:i.end.x,y:t.y}),a={start:s,end:u},o="Line"}else a={center:i.getCenter(),radius:sc(i,t),startAngle:i.startAngle,endAngle:i.endAngle},o="Circle";a=J({container:this.getTooltipCrosshairsGroup()},a,F(e,"crosshairs",{}),this.getCrosshairsText("y",t,e)),delete a.type;var l=this.yCrosshair;l?i.isRect&&l.get("type")==="circle"||!i.isRect&&l.get("type")==="line"?(l=new wg[o](a),l.init()):l.update(a):(l=new wg[o](a),l.init()),l.render(),l.show(),this.yCrosshair=l},n.prototype.getCrosshairsText=function(t,e,i){var a=F(i,["crosshairs","text"]),o=F(i,["crosshairs","follow"]),s=this.items;if(a){var u=this.getViewWithGeometry(this.view),l=s[0],c=u.getXScale(),f=u.getYScales()[0],h=void 0,v=void 0;if(o){var p=this.view.getCoordinate().invert(e);h=c.invert(p.x),v=f.invert(p.y)}else h=l.data[c.field],v=l.data[f.field];var d=t==="x"?h:v;return rt(a)?a=a(t,d,s,e):a.content=d,{text:a}}},n.prototype.getGuideGroup=function(){if(!this.guideGroup){var t=this.view.foregroundGroup;this.guideGroup=t.addGroup({name:"tooltipGuide",capture:!1})}return this.guideGroup},n.prototype.getTooltipMarkersGroup=function(){var t=this.tooltipMarkersGroup;return t&&!t.destroyed?(t.clear(),t.show()):(t=this.getGuideGroup().addGroup({name:"tooltipMarkersGroup"}),t.toFront(),this.tooltipMarkersGroup=t),t},n.prototype.getTooltipCrosshairsGroup=function(){var t=this.tooltipCrosshairsGroup;return t||(t=this.getGuideGroup().addGroup({name:"tooltipCrosshairsGroup",capture:!1}),t.toBack(),this.tooltipCrosshairsGroup=t),t},n.prototype.findItemsFromView=function(t,e){var i,a;if(t.getOptions().tooltip===!1)return[];var o=this.getTooltipCfg(),s=xh(t,e,o);try{for(var u=It(t.views),l=u.next();!l.done;l=u.next()){var c=l.value;s=s.concat(this.findItemsFromView(c,e))}}catch(f){i={error:f}}finally{try{l&&!l.done&&(a=u.return)&&a.call(u)}finally{if(i)throw i.error}}return s},n.prototype.getViewWithGeometry=function(t){var e=this;return t.geometries.length?t:jr(t.views,function(i){return e.getViewWithGeometry(i)})},n.prototype.getItemsAfterProcess=function(t){var e=this.getTooltipCfg().customItems,i=e||function(a){return a};return i(t)},n}(fo),$S={};function GS(r){return $S[r.toLowerCase()]}function mr(r,n){$S[r.toLowerCase()]=n}var Ja={appear:{duration:450,easing:"easeQuadOut"},update:{duration:400,easing:"easeQuadInOut"},enter:{duration:400,easing:"easeQuadInOut"},leave:{duration:350,easing:"easeQuadIn"}},iR={interval:function(r){return{enter:{animation:r.isRect?r.isTransposed?"scale-in-x":"scale-in-y":"fade-in"},update:{animation:r.isPolar&&r.isTransposed?"sector-path-update":null},leave:{animation:"fade-out"}}},line:{enter:{animation:"fade-in"},leave:{animation:"fade-out"}},path:{enter:{animation:"fade-in"},leave:{animation:"fade-out"}},point:{appear:{animation:"zoom-in"},enter:{animation:"zoom-in"},leave:{animation:"zoom-out"}},area:{enter:{animation:"fade-in"},leave:{animation:"fade-out"}},polygon:{enter:{animation:"fade-in"},leave:{animation:"fade-out"}},schema:{enter:{animation:"fade-in"},leave:{animation:"fade-out"}},edge:{enter:{animation:"fade-in"},leave:{animation:"fade-out"}},label:{appear:{animation:"fade-in",delay:450},enter:{animation:"fade-in"},update:{animation:"position-update"},leave:{animation:"fade-out"}}},Xg={line:function(){return{animation:"wave-in"}},area:function(){return{animation:"wave-in"}},path:function(){return{animation:"fade-in"}},interval:function(r){var n;return r.isRect?n=r.isTransposed?"grow-in-x":"grow-in-y":(n="grow-in-xy",r.isPolar&&r.isTransposed&&(n="wave-in")),{animation:n}},schema:function(r){var n;return r.isRect?n=r.isTransposed?"grow-in-x":"grow-in-y":n="grow-in-xy",{animation:n}},polygon:function(){return{animation:"fade-in",duration:500}},edge:function(){return{animation:"fade-in"}}};function aR(r,n){return{delay:rt(r.delay)?r.delay(n):r.delay,easing:rt(r.easing)?r.easing(n):r.easing,duration:rt(r.duration)?r.duration(n):r.duration,callback:r.callback,repeat:r.repeat}}function VS(r,n,t){var e=iR[r];return e&&(rt(e)&&(e=e(n)),e=J({},Ja,e),t)?e[t]:e}function Ha(r,n,t){var e=F(r.get("origin"),"data",Vt),i=n.animation,a=aR(n,e);if(i){var o=GS(i);o&&o(r,a,t)}else r.animate(t.toAttrs,a)}function oR(r,n,t,e,i){if(Xg[t]){var a=Xg[t](e),o=GS(F(a,"animation",""));if(o){var s=C(C(C({},Ja.appear),a),n);r.stopAnimate(),o(r,s,{coordinate:e,minYPoint:i,toAttrs:null})}}}var Jv="element-background",WS=function(r){R(n,r);function n(t){var e=r.call(this,t)||this;e.labelShape=[],e.states=[];var i=t.shapeFactory,a=t.container,o=t.offscreenGroup,s=t.elementIndex,u=t.visible,l=u===void 0?!0:u;return e.shapeFactory=i,e.container=a,e.offscreenGroup=o,e.visible=l,e.elementIndex=s,e}return n.prototype.draw=function(t,e){e===void 0&&(e=!1),this.model=t,this.data=t.data,this.shapeType=this.getShapeType(t),this.drawShape(t,e),this.visible===!1&&this.changeVisible(!1)},n.prototype.update=function(t){var e=this,i=e.shapeFactory,a=e.shape;if(!!a){this.model=t,this.data=t.data,this.shapeType=this.getShapeType(t),this.setShapeInfo(a,t);var o=this.getOffscreenGroup(),s=i.drawShape(this.shapeType,t,o);s.cfg.data=this.data,s.cfg.origin=t,s.cfg.element=this,this.syncShapeStyle(a,s,this.getStates(),this.getAnimateCfg("update"))}},n.prototype.destroy=function(){var t=this,e=t.shapeFactory,i=t.shape;if(i){var a=this.getAnimateCfg("leave");a?Ha(i,a,{coordinate:e.coordinate,toAttrs:C({},i.attr())}):i.remove(!0)}this.states=[],this.shapeFactory=void 0,this.container=void 0,this.shape=void 0,this.animate=void 0,this.geometry=void 0,this.labelShape=[],this.model=void 0,this.data=void 0,this.offscreenGroup=void 0,this.statesStyle=void 0,r.prototype.destroy.call(this)},n.prototype.changeVisible=function(t){r.prototype.changeVisible.call(this,t),t?(this.shape&&this.shape.show(),this.labelShape&&this.labelShape.forEach(function(e){e.show()})):(this.shape&&this.shape.hide(),this.labelShape&&this.labelShape.forEach(function(e){e.hide()}))},n.prototype.setState=function(t,e){var i=this,a=i.states,o=i.shapeFactory,s=i.model,u=i.shape,l=i.shapeType,c=a.indexOf(t);if(e){if(c>-1)return;a.push(t),(t==="active"||t==="selected")&&(u==null||u.toFront())}else{if(c===-1)return;if(a.splice(c,1),t==="active"||t==="selected"){var f=this.geometry,h=f.sortZIndex,v=f.zIndexReversed,p=v?this.geometry.elements.length-this.elementIndex:this.elementIndex;h?u.setZIndex(p):u.set("zIndex",p)}}var d=o.drawShape(l,s,this.getOffscreenGroup());a.length?this.syncShapeStyle(u,d,a,null):this.syncShapeStyle(u,d,["reset"],null),d.remove(!0);var g={state:t,stateStatus:e,element:this,target:this.container};this.container.emit("statechange",g),tS(this.shape,"statechange",g)},n.prototype.clearStates=function(){var t=this,e=this.states;w(e,function(i){t.setState(i,!1)}),this.states=[]},n.prototype.hasState=function(t){return this.states.includes(t)},n.prototype.getStates=function(){return this.states},n.prototype.getData=function(){return this.data},n.prototype.getModel=function(){return this.model},n.prototype.getBBox=function(){var t=this,e=t.shape,i=t.labelShape,a={x:0,y:0,minX:0,minY:0,maxX:0,maxY:0,width:0,height:0};return e&&(a=e.getCanvasBBox()),i&&i.forEach(function(o){var s=o.getCanvasBBox();a.x=Math.min(s.x,a.x),a.y=Math.min(s.y,a.y),a.minX=Math.min(s.minX,a.minX),a.minY=Math.min(s.minY,a.minY),a.maxX=Math.max(s.maxX,a.maxX),a.maxY=Math.max(s.maxY,a.maxY)}),a.width=a.maxX-a.minX,a.height=a.maxY-a.minY,a},n.prototype.getStatesStyle=function(){if(!this.statesStyle){var t=this,e=t.shapeType,i=t.geometry,a=t.shapeFactory,o=i.stateOption,s=a.defaultShapeType,u=a.theme[e]||a.theme[s];this.statesStyle=J({},u,o)}return this.statesStyle},n.prototype.getStateStyle=function(t,e){var i=this.getStatesStyle(),a=F(i,[t,"style"],{}),o=a[e]||a;return rt(o)?o(this):o},n.prototype.getAnimateCfg=function(t){var e=this,i=this.animate;if(i){var a=i[t];return a&&C(C({},a),{callback:function(){var o;rt(a.callback)&&a.callback(),(o=e.geometry)===null||o===void 0||o.emit(ni.AFTER_DRAW_ANIMATE)}})}return null},n.prototype.drawShape=function(t,e){var i;e===void 0&&(e=!1);var a=this,o=a.shapeFactory,s=a.container,u=a.shapeType;if(this.shape=o.drawShape(u,t,s),this.shape){this.setShapeInfo(this.shape,t);var l=this.shape.cfg.name;l?lt(l)&&(this.shape.cfg.name=["element",l]):this.shape.cfg.name=["element",this.shapeFactory.geometryType];var c=e?"enter":"appear",f=this.getAnimateCfg(c);f&&((i=this.geometry)===null||i===void 0||i.emit(ni.BEFORE_DRAW_ANIMATE),Ha(this.shape,f,{coordinate:o.coordinate,toAttrs:C({},this.shape.attr())}))}},n.prototype.getOffscreenGroup=function(){if(!this.offscreenGroup){var t=this.container.getGroupBase();this.offscreenGroup=new t({})}return this.offscreenGroup},n.prototype.setShapeInfo=function(t,e){var i=this;if(t.cfg.origin=e,t.cfg.element=this,t.isGroup()){var a=t.get("children");a.forEach(function(o){i.setShapeInfo(o,e)})}},n.prototype.syncShapeStyle=function(t,e,i,a,o){var s=this,u;if(i===void 0&&(i=[]),o===void 0&&(o=0),!(!t||!e)){var l=t.get("clipShape"),c=e.get("clipShape");if(this.syncShapeStyle(l,c,i,a),t.isGroup())for(var f=t.get("children"),h=e.get("children"),v=0;v<f.length;v++)this.syncShapeStyle(f[v],h[v],i,a,o+v);else{if(!nr(i)&&!Dt(i,["reset"])){var p=t.get("name");V(p)&&(p=p[1]),w(i,function(g){if(e.get("name")!==Jv){var y=s.getStateStyle(g,p||o);e.attr(y)}})}var d=CS(t,e);this.animate?a?((u=this.geometry)===null||u===void 0||u.emit(ni.BEFORE_DRAW_ANIMATE),Ha(t,a,{coordinate:this.shapeFactory.coordinate,toAttrs:d,shapeModel:this.model})):nr(i)?t.attr(d):(t.stopAnimate(),t.animate(d,{duration:300})):t.attr(d)}}},n.prototype.getShapeType=function(t){var e=F(t,"shape");return V(e)?e[0]:e},n}(wv),jS={},XS={};function sR(r){return jS[r.toLowerCase()]}function Gs(r,n){jS[r.toLowerCase()]=n}function uR(r){return XS[r.toLowerCase()]}function ar(r,n){XS[r.toLowerCase()]=n}var lR={coordinate:null,defaultShapeType:null,theme:null,getShapePoints:function(r,n){var t=this.getShape(r);return t.getPoints?t.getPoints(n):this.getDefaultPoints(n)},getShape:function(r){var n=this[r]||this[this.defaultShapeType];return n.coordinate=this.coordinate,n},getDefaultPoints:function(){return[]},getDefaultStyle:function(r){return F(r,[this.defaultShapeType,"default","style"],{})},getMarker:function(r,n){var t=this.getShape(r);if(!t.getMarker){var e=this.defaultShapeType;t=this.getShape(e)}var i=this.theme,a=F(i,[r,"default"],{}),o=t.getMarker(n);return J({},a,o)},drawShape:function(r,n,t){var e=this.getShape(r);return e.draw(n,t)}},cR={coordinate:null,parsePath:function(r){var n=this.coordinate,t=Rv(r);return n.isPolar?t=EO(n,t):t=CO(n,t),t},parsePoint:function(r){var n=this.coordinate;return n.convert(r)},parsePoints:function(r){var n=this.coordinate;return r.map(function(t){return n.convert(t)})},draw:function(r,n){}},tp={};function xi(r,n){var t=ca(r),e=C(C(C({},lR),n),{geometryType:r});return tp[t]=e,e}function Pt(r,n,t){var e=ca(r),i=tp[e],a=C(C({},cR),t);return i[n]=a,a}function Yg(r){var n=ca(r);return tp[n]}function fR(r,n,t){var e,i;if(t===void 0&&(t={}),!n)return[r];var a=nE(r,n),o=[];if(n.length===1&&t[n[0]]){var s=t[n[0]];try{for(var u=It(s),l=u.next();!l.done;l=u.next()){var c=l.value,f=a["_".concat(c)];f&&o.push(f)}}catch(p){e={error:p}}finally{try{l&&!l.done&&(i=u.return)&&i.call(u)}finally{if(e)throw e.error}}}else for(var h in a)if(a.hasOwnProperty(h)){var v=a[h];o.push(v)}return o}function YS(r,n){return Dl(["color","shape","size","x","y","isInCircle","data","style","defaultStyle","points","mappingData"],function(t){return!Dt(r[t],n[t])})}function Ao(r){return V(r)?r:r.split("*")}function ZS(r,n){for(var t=[],e=[],i=[],a=new Map,o=0;o<n.length;o++){var s=n[o];r[s]?e.push(s):t.push(s),a.set(s,!0)}return Object.keys(r).forEach(function(u){a.has(u)||i.push(u)}),{added:t,updated:e,removed:i}}var _i=function(r){R(n,r);function n(t){var e=r.call(this,t)||this;e.type="base",e.attributes={},e.elements=[],e.elementsMap={},e.animateOption=!0,e.attributeOption={},e.lastElementsMap={},e.generatePoints=!1,e.beforeMappingData=null,e.adjusts={},e.idFields=[],e.hasSorted=!1,e.isCoordinateChanged=!1;var i=t.container,a=t.labelsContainer,o=t.coordinate,s=t.data,u=t.sortable,l=u===void 0?!1:u,c=t.visible,f=c===void 0?!0:c,h=t.theme,v=t.scales,p=v===void 0?{}:v,d=t.scaleDefs,g=d===void 0?{}:d,y=t.intervalPadding,m=t.dodgePadding,x=t.maxColumnWidth,_=t.minColumnWidth,E=t.columnWidthRatio,b=t.roseWidthRatio,M=t.multiplePieWidthRatio,T=t.zIndexReversed,k=t.sortZIndex,L=t.useDeferredLabel;return e.container=i,e.labelsContainer=a,e.coordinate=o,e.data=s,e.sortable=l,e.visible=f,e.userTheme=h,e.scales=p,e.scaleDefs=g,e.intervalPadding=y,e.dodgePadding=m,e.maxColumnWidth=x,e.minColumnWidth=_,e.columnWidthRatio=E,e.roseWidthRatio=b,e.multiplePieWidthRatio=M,e.zIndexReversed=T,e.sortZIndex=k,e.useDeferredLabel=L?typeof L=="number"?L:1/0:null,e}return n.prototype.position=function(t){var e=t;fn(t)||(e={fields:Ao(t)});var i=F(e,"fields");return i.length===1&&(i.unshift("1"),he(e,"fields",i)),he(this.attributeOption,"position",e),this},n.prototype.color=function(t,e){return this.createAttrOption("color",t,e),this},n.prototype.shape=function(t,e){return this.createAttrOption("shape",t,e),this},n.prototype.size=function(t,e){return this.createAttrOption("size",t,e),this},n.prototype.adjust=function(t){var e=t;return(lt(t)||fn(t))&&(e=[t]),w(e,function(i,a){wt(i)||(e[a]={type:i})}),this.adjustOption=e,this},n.prototype.style=function(t,e){if(lt(t)){var i=Ao(t);this.styleOption={fields:i,callback:e}}else{var a=t,i=a.fields,o=a.callback,s=a.cfg;i||o||s?this.styleOption=t:this.styleOption={cfg:t}}return this},n.prototype.tooltip=function(t,e){if(lt(t)){var i=Ao(t);this.tooltipOption={fields:i,callback:e}}else this.tooltipOption=t;return this},n.prototype.animate=function(t){return this.animateOption=t,this},n.prototype.label=function(t,e,i){if(lt(t)){var a={},o=Ao(t);a.fields=o,rt(e)?a.callback=e:fn(e)&&(a.cfg=e),i&&(a.cfg=i),this.labelOption=a}else this.labelOption=t;return this},n.prototype.state=function(t){return this.stateOption=t,this},n.prototype.customInfo=function(t){return this.customOption=t,this},n.prototype.init=function(t){t===void 0&&(t={}),this.setCfg(t),this.initAttributes(),this.processData(this.data),this.adjustScale()},n.prototype.update=function(t){t===void 0&&(t={});var e=t.data,i=t.isDataChanged,a=t.isCoordinateChanged,o=this,s=o.attributeOption,u=o.lastAttributeOption;Dt(s,u)?e&&(i||!Dt(e,this.data))?(this.setCfg(t),this.initAttributes(),this.processData(e)):this.setCfg(t):this.init(t),this.adjustScale(),this.isCoordinateChanged=a},n.prototype.paint=function(t){var e=this;t===void 0&&(t=!1),this.animateOption&&(this.animateOption=J({},VS(this.type,this.coordinate),this.animateOption)),this.defaultSize=void 0,this.elementsMap={},this.elements=[];var i=this.getOffscreenGroup();i.clear();var a=this.beforeMappingData,o=this.beforeMapping(a);this.dataArray=new Array(o.length);for(var s=0;s<o.length;s++){var u=o[s];this.dataArray[s]=this.mapping(u)}if(this.updateElements(this.dataArray,t),this.lastElementsMap=this.elementsMap,this.canDoGroupAnimation(t)){var l=this.container,c=this.type,f=this.coordinate,h=F(this.animateOption,"appear"),v=this.getYScale(),p=f.convert({x:0,y:v.scale(this.getYMinValue())});oR(l,h,c,f,p)}if(this.labelOption){var d=this.useDeferredLabel,g=function(){return e.renderLabels(yr(e.dataArray),t)}.bind(this);if(typeof d=="number"){var y=typeof d=="number"&&d!==1/0?d:0;if(!window.requestIdleCallback)setTimeout(g,y);else{var m=y&&y!==1/0?{timeout:y}:void 0;window.requestIdleCallback(g,m)}}else g()}this.lastAttributeOption=C({},this.attributeOption),this.visible===!1&&this.changeVisible(!1)},n.prototype.clear=function(){var t=this,e=t.container,i=t.geometryLabel,a=t.offscreenGroup;e&&e.clear(),i&&i.clear(),a&&a.clear(),this.scaleDefs=void 0,this.attributes={},this.scales={},this.elementsMap={},this.lastElementsMap={},this.elements=[],this.adjusts={},this.dataArray=null,this.beforeMappingData=null,this.lastAttributeOption=void 0,this.defaultSize=void 0,this.idFields=[],this.groupScales=void 0,this.hasSorted=!1,this.isCoordinateChanged=!1},n.prototype.destroy=function(){this.clear();var t=this.container;t.remove(!0),this.offscreenGroup&&(this.offscreenGroup.remove(!0),this.offscreenGroup=null),this.geometryLabel&&(this.geometryLabel.destroy(),this.geometryLabel=null),this.theme=void 0,this.shapeFactory=void 0,r.prototype.destroy.call(this)},n.prototype.getGroupScales=function(){return this.groupScales},n.prototype.getAttribute=function(t){return this.attributes[t]},n.prototype.getXScale=function(){return this.getAttribute("position").scales[0]},n.prototype.getYScale=function(){return this.getAttribute("position").scales[1]},n.prototype.getGroupAttributes=function(){var t=[];return w(this.attributes,function(e){Pa.includes(e.type)&&t.push(e)}),t},n.prototype.getDefaultValue=function(t){var e,i=this.getAttribute(t);return i&&nr(i.scales)&&(e=i.values[0]),e},n.prototype.getAttributeValues=function(t,e){for(var i=[],a=t.scales,o=0,s=a.length;o<s;o++){var u=a[o],l=u.field;u.isIdentity?i.push(u.values):i.push(e[l])}return t.mapping.apply(t,te([],ut(i),!1))},n.prototype.getAdjust=function(t){return this.adjusts[t]},n.prototype.getCoordinate=function(){return this.coordinate},n.prototype.getData=function(){return this.data},n.prototype.getShapeMarker=function(t,e){var i=this.getShapeFactory();return i.getMarker(t,e)},n.prototype.getElementsBy=function(t){return this.elements.filter(function(e){return t(e)})},n.prototype.getElements=function(){return this.elements},n.prototype.getElementId=function(t){t=V(t)?t[0]:t;var e=t[Vt];if(this.idFields.length){for(var i=e[this.idFields[0]],a=1;a<this.idFields.length;a++)i+="-"+e[this.idFields[a]];return i}var o=this.type,s=this.getXScale(),u=this.getYScale(),l=s.field||"x",c=u.field||"y",f=e[c],h;s.type==="identity"?h=s.values[0]:h=e[l];var v;o==="interval"||o==="schema"?v="".concat(h):o==="line"||o==="area"||o==="path"?v=o:v="".concat(h,"-").concat(f);for(var p=this.groupScales,a=0,d=p.length;a<d;a++){var g=p[a],y=g.field;v="".concat(v,"-").concat(e[y])}var m=this.getAdjust("dodge");if(m){var x=m.dodgeBy;x&&(v="".concat(v,"-").concat(e[x]))}return this.getAdjust("jitter")&&(v="".concat(v,"-").concat(t.x,"-").concat(t.y)),v},n.prototype.getScaleFields=function(){var t=[],e=new Map,i=this,a=i.attributeOption,o=i.labelOption,s=i.tooltipOption;for(var u in a)if(a.hasOwnProperty(u)){var l=a[u];l.fields?Jn(l.fields,t,e):l.values&&Jn(l.values,t,e)}return o&&o.fields&&Jn(o.fields,t,e),wt(s)&&s.fields&&Jn(s.fields,t,e),t},n.prototype.changeVisible=function(t){r.prototype.changeVisible.call(this,t);for(var e=this.elements,i=0,a=e.length;i<a;i++){var o=e[i];o.changeVisible(t)}t?(this.container&&this.container.show(),this.labelsContainer&&this.labelsContainer.show()):(this.container&&this.container.hide(),this.labelsContainer&&this.labelsContainer.hide())},n.prototype.getFields=function(){var t=new Map,e=[];return Object.values(this.attributeOption).forEach(function(i){var a=(i==null?void 0:i.fields)||[];a.forEach(function(o){t.has(o)||e.push(o),t.set(o,!0)})},[]),e},n.prototype.getGroupFields=function(){for(var t=[],e=new Map,i=0,a=Pa.length;i<a;i++){var o=Pa[i],s=this.attributeOption[o];s&&s.fields&&Jn(s.fields,t,e)}return t},n.prototype.getXYFields=function(){var t=ut(this.attributeOption.position.fields,2),e=t[0],i=t[1];return[e,i]},n.prototype.getXField=function(){return F(this.getXYFields(),[0])},n.prototype.getYField=function(){return F(this.getXYFields(),[1])},n.prototype.getShapes=function(){return this.elements.map(function(t){return t.shape})},n.prototype.getOffscreenGroup=function(){if(!this.offscreenGroup){var t=this.container.getGroupBase();this.offscreenGroup=new t({})}return this.offscreenGroup},n.prototype.sort=function(t){if(!this.hasSorted)for(var e=this.getXScale(),i=e.field,a=0;a<t.length;a++){var o=t[a];o.sort(function(s,u){return e.translate(s[Vt][i])-e.translate(u[Vt][i])})}this.hasSorted=!0},n.prototype.adjustScale=function(){var t=this.getYScale();t&&this.getAdjust("stack")&&this.updateStackRange(t,this.beforeMappingData)},n.prototype.getShapeFactory=function(){var t=this.shapeType;if(!!Yg(t))return this.shapeFactory||(this.shapeFactory=Ve(Yg(t))),this.shapeFactory.coordinate=this.coordinate,this.shapeFactory.theme=this.theme.geometries[t]||{},this.shapeFactory},n.prototype.createShapePointsCfg=function(t){var e=this.getXScale(),i=this.getYScale(),a=this.normalizeValues(t[e.field],e),o;return i?o=this.normalizeValues(t[i.field],i):o=t.y?t.y:.1,{x:a,y:o,y0:i?i.scale(this.getYMinValue()):void 0}},n.prototype.createElement=function(t,e,i){i===void 0&&(i=!1);var a=this.container,o=this.getDrawCfg(t),s=this.getShapeFactory(),u=new WS({shapeFactory:s,container:a,offscreenGroup:this.getOffscreenGroup(),elementIndex:e});return u.animate=this.animateOption,u.geometry=this,u.draw(o,i),u},n.prototype.getDrawCfg=function(t){var e=t[Vt],i={mappingData:t,data:e,x:t.x,y:t.y,color:t.color,size:t.size,isInCircle:this.coordinate.isPolar,customInfo:this.customOption},a=t.shape;!a&&this.getShapeFactory()&&(a=this.getShapeFactory().defaultShapeType),i.shape=a;var o=this.theme.geometries[this.shapeType];i.defaultStyle=F(o,[a,"default"],{}).style,!i.defaultStyle&&this.getShapeFactory()&&(i.defaultStyle=this.getShapeFactory().getDefaultStyle(o));var s=this.styleOption;return s&&(i.style=this.getStyleCfg(s,e)),this.generatePoints&&(i.points=t.points,i.nextPoints=t.nextPoints),i},n.prototype.updateElements=function(t,e){var i,a,o,s,u,l;e===void 0&&(e=!1);for(var c=new Map,f=[],h=new Map,v=0,p=0;p<t.length;p++)for(var d=t[p],g=0;g<d.length;g++){var y=d[g],m=this.getElementId(y),x=c.has(m)?"".concat(m,"-").concat(p,"-").concat(g):m;f.push(x),c.set(x,y),h.set(x,v),v++}this.elements=new Array(v);var _=ZS(this.lastElementsMap,f),E=_.added,b=_.updated,M=_.removed;try{for(var T=It(E),k=T.next();!k.done;k=T.next()){var m=k.value,y=c.get(m),p=h.get(m),L=this.createElement(y,p,e);this.elements[p]=L,this.elementsMap[m]=L,L.shape&&L.shape.set("zIndex",this.zIndexReversed?this.elements.length-p:p)}}catch(X){i={error:X}}finally{try{k&&!k.done&&(a=T.return)&&a.call(T)}finally{if(i)throw i.error}}try{for(var O=It(b),D=O.next();!D.done;D=O.next()){var m=D.value,L=this.lastElementsMap[m],y=c.get(m),W=this.getDrawCfg(y),j=L.getModel(),p=h.get(m);(this.isCoordinateChanged||YS(W,j))&&(L.animate=this.animateOption,L.update(W)),this.elements[p]=L,this.elementsMap[m]=L,L.shape&&L.shape.set("zIndex",this.zIndexReversed?this.elements.length-p:p)}}catch(X){o={error:X}}finally{try{D&&!D.done&&(s=O.return)&&s.call(O)}finally{if(o)throw o.error}}this.container&&this.container.sort();try{for(var ot=It(M),z=ot.next();!z.done;z=ot.next()){var m=z.value,L=this.lastElementsMap[m];L.animate=this.animateOption,L.destroy()}}catch(X){u={error:X}}finally{try{z&&!z.done&&(l=ot.return)&&l.call(ot)}finally{if(u)throw u.error}}},n.prototype.getLabelType=function(){var t=this,e=t.labelOption,i=t.coordinate,a=t.type,o=i.type,s=i.isTransposed,u=F(e,["cfg","type"]);return u||(o==="polar"?u=s?"pie":"polar":o==="theta"?u="pie":a==="interval"||a==="polygon"?u="interval":u="base"),u},n.prototype.getYMinValue=function(){var t=this.getYScale(),e=t.min,i=t.max,a;return e>=0?a=e:i<=0?a=i:a=0,a},n.prototype.createAttrOption=function(t,e,i){if(G(e)||wt(e))wt(e)&&Dt(Object.keys(e),["values"])?he(this.attributeOption,t,{fields:e.values}):he(this.attributeOption,t,e);else{var a={};dt(e)?a.values=[e]:a.fields=Ao(e),i&&(rt(i)?a.callback=i:a.values=i),he(this.attributeOption,t,a)}},n.prototype.initAttributes=function(){var t=this,e=this,i=e.attributes,a=e.attributeOption,o=e.theme,s=e.shapeType;this.groupScales=[];var u={},l=function(h){if(a.hasOwnProperty(h)){var v=a[h];if(!v)return{value:void 0};var p=C({},v),d=p.callback,g=p.values,y=p.fields,m=y===void 0?[]:y,x=m.map(function(E){var b=t.scales[E];if(!u[E]&&Pa.includes(h)){var M=ES(b,F(t.scaleDefs,E),h,t.type);M==="cat"&&(t.groupScales.push(b),u[E]=!0)}return b});p.scales=x,h!=="position"&&x.length===1&&x[0].type==="identity"?p.values=x[0].values:!d&&!g&&(h==="size"?p.values=o.sizes:h==="shape"?p.values=o.shapes[s]||[]:h==="color"&&(x.length?p.values=x[0].values.length<=10?o.colors10:o.colors20:p.values=o.colors10));var _=KE(h);i[h]=new _(p)}};for(var c in a){var f=l(c);if(typeof f=="object")return f.value}},n.prototype.processData=function(t){var e,i;this.hasSorted=!1;for(var a=this.getAttribute("position").scales,o=a.filter(function(M){return M.isCategory}),s=this.groupData(t),u=[],l=0,c=s.length;l<c;l++){for(var f=s[l],h=[],v=0,p=f.length;v<p;v++){var d=f[v],g={};for(var y in d)g[y]=d[y];g[Vt]=d;try{for(var m=(e=void 0,It(o)),x=m.next();!x.done;x=m.next()){var _=x.value,E=_.field;g[E]=_.translate(g[E])}}catch(M){e={error:M}}finally{try{x&&!x.done&&(i=m.return)&&i.call(m)}finally{if(e)throw e.error}}h.push(g)}u.push(h)}var b=this.adjustData(u);return this.beforeMappingData=b,b},n.prototype.adjustData=function(t){var e=this.adjustOption,i=this,a=i.intervalPadding,o=i.dodgePadding,s=i.theme,u=this.maxColumnWidth||s.maxColumnWidth,l=this.minColumnWidth||s.minColumnWidth,c=this.columnWidthRatio||s.columnWidthRatio,f=t;if(e){var h=this.getXScale(),v=this.getYScale(),p=h.field,d=v?v.field:null,g=Hs(this.coordinate),y=h.values.length,m=this.getAttribute("size"),x=void 0;m&&(x=m.values[0]);for(var _=0,E=e.length;_<E;_++){var b=e[_],M=C({xField:p,yField:d,intervalPadding:a,dodgePadding:o,xDimensionLength:g,groupNum:y,defaultSize:x,maxColumnWidth:u,minColumnWidth:l,columnWidthRatio:c},b),T=b.type;if(T==="dodge"){var k=[];if(h.isCategory||h.type==="identity")k.push("x");else if(!v)k.push("y");else throw new Error("dodge is not support linear attribute, please use category attribute!");M.adjustNames=k,M.dodgeRatio=c}else if(T==="stack"){var L=this.coordinate;if(!v){M.height=L.getHeight();var O=this.getDefaultValue("size")||3;M.size=O}!L.isTransposed&&G(M.reverseOrder)&&(M.reverseOrder=!0)}var D=zE(T);M.dimValuesMap={},h&&h.values&&(M.dimValuesMap[h.field]=h.values.map(function(j){return h.translate(j)}));var W=new D(M);f=W.process(f),this.adjusts[T]=W}}return f},n.prototype.groupData=function(t){for(var e=this.getGroupScales(),i=this.scaleDefs,a={},o=[],s=0;s<e.length;s++){var u=e[s],l=u.field;o.push(l),F(i,[l,"values"])&&(a[l]=i[l].values)}return fR(t,o,a)},n.prototype.updateStackRange=function(t,e){for(var i=yr(e),a=t.field,o=t.min,s=t.max,u=0;u<i.length;u++){var l=i[u],c=Math.min.apply(null,l[a]),f=Math.max.apply(null,l[a]);c<o&&(o=c),f>s&&(s=f)}var h=this.scaleDefs,v={};o<t.min&&!F(h,[a,"min"])&&(v.min=o),s>t.max&&!F(h,[a,"max"])&&(v.max=s),t.change(v)},n.prototype.beforeMapping=function(t){var e=t;if(this.sortable&&this.sort(e),this.generatePoints)for(var i=0,a=e.length;i<a;i++){var o=e[i];this.generateShapePoints(o);var s=e[i+1];s&&(this.generateShapePoints(s),o[0].nextPoints=s[0].points)}return e},n.prototype.generateShapePoints=function(t){for(var e=this.getShapeFactory(),i=this.getAttribute("shape"),a=0;a<t.length;a++){var o=t[a],s=this.createShapePointsCfg(o),u=i?this.getAttributeValues(i,o):null,l=e.getShapePoints(u,s);o.points=l}},n.prototype.normalizeValues=function(t,e){var i=[];if(V(t))for(var a=0;a<t.length;a++){var o=t[a];i.push(e.scale(o))}else i=e.scale(t);return i},n.prototype.mapping=function(t){for(var e=this.attributes,i=[],a=0;a<t.length;a++){var o=t[a],s={_origin:o[Vt],points:o.points,nextPoints:o.nextPoints};for(var u in e)if(e.hasOwnProperty(u)){var l=e[u],c=l.names,f=this.getAttributeValues(l,o);if(c.length>1)for(var h=0;h<f.length;h+=1){var v=f[h],p=c[h];s[p]=V(v)&&v.length===1?v[0]:v}else s[c[0]]=f.length===1?f[0]:f}this.convertPoint(s),i.push(s)}return i},n.prototype.convertPoint=function(t){var e=t.x,i=t.y,a,o,s,u=this.coordinate;if(V(e)&&V(i)){a=[],o=[];for(var l=0,c=0,f=e.length,h=i.length;l<f&&c<h;l+=1,c+=1)s=u.convert({x:e[l],y:i[c]}),a.push(s.x),o.push(s.y)}else if(V(i)){o=[];for(var v=0;v<i.length;v++){var p=i[v];s=u.convert({x:e,y:p}),a&&a!==s.x?(V(a)||(a=[a]),a.push(s.x)):a=s.x,o.push(s.y)}}else if(V(e)){a=[];for(var v=0;v<e.length;v++){var d=e[v];s=u.convert({x:d,y:i}),o&&o!==s.y?(V(o)||(o=[o]),o.push(s.y)):o=s.y,a.push(s.x)}}else{var g=u.convert({x:e,y:i});a=g.x,o=g.y}t.x=a,t.y=o},n.prototype.getStyleCfg=function(t,e){var i=t.fields,a=i===void 0?[]:i,o=t.callback,s=t.cfg;if(s)return s;var u=a.map(function(l){return e[l]});return o.apply(void 0,te([],ut(u),!1))},n.prototype.setCfg=function(t){var e=this,i=t.coordinate,a=t.data,o=t.theme,s=t.scaleDefs;i&&(this.coordinate=i),a&&(this.data=a),s&&(this.scaleDefs=s,this.idFields=[],w(s,function(u,l){u&&u.key&&e.idFields.push(l)})),o&&(this.theme=this.userTheme?J({},o,this.userTheme):o)},n.prototype.renderLabels=function(t,e){return e===void 0&&(e=!1),is(this,void 0,void 0,function(){var i,a,o,s,u,l,c,f,h,v,p,d,g=this;return as(this,function(y){switch(y.label){case 0:return i=this.geometryLabel,this.emit(ni.BEFORE_RENDER_LABEL),i||(a=this.getLabelType(),o=sR(a),i=new o(this),this.geometryLabel=i),[4,i.render(t,e)];case 1:y.sent(),s=i.labelsRenderer.shapesMap,u=new Map,w(s,function(m,x){for(var _=m.getChildren()||[],E=0;E<_.length;E++){var b=_[E],M=g.elementsMap[b.get("elementId")||x.split(" ")[0]];if(M){b.cfg.name=["element","label"],b.cfg.element=M;var T=u.get(M)||new Set;T.add(m),u.set(M,T)}}});try{for(l=It(u.entries()),c=l.next();!c.done;c=l.next())f=ut(c.value,2),h=f[0],v=f[1],h.labelShape=te([],ut(v),!1)}catch(m){p={error:m}}finally{try{c&&!c.done&&(d=l.return)&&d.call(l)}finally{if(p)throw p.error}}return this.emit(ni.AFTER_RENDER_LABEL),[2]}})})},n.prototype.canDoGroupAnimation=function(t){return!t&&this.animateOption&&(F(this.animateOption,"appear")===void 0||F(this.animateOption,"appear")&&F(this.animateOption,["appear","animation"])===void 0)},n}(wv),lc=ve;function Vs(r,n,t){var e=lc(r.getMatrix(),[["t",n,t]]);r.setMatrix(e)}function hR(r,n){var t=r.attr(),e=t.x,i=t.y,a=lc(r.getMatrix(),[["t",-e,-i],["r",n],["t",e,i]]);return a}function ep(r,n){var t=hR(r,n);r.setMatrix(t)}function vR(r,n){var t=r.getBBox(),e=(t.minX+t.maxX)/2,i=(t.minY+t.maxY)/2;r.applyToMatrix([e,i,1]);var a=lc(r.getMatrix(),[["t",-e,-i],["s",n,n],["t",e,i]]);r.setMatrix(a)}function fi(r){return r.find(function(n){return n.get("type")==="text"})}function qS(r,n,t){t===void 0&&(t=[0,0,0,0]);var e=r&&r.getChildren()[0];if(e){var i=e.clone();n!=null&&n.rotate&&ep(i,-n.rotate);var a=i.getCanvasBBox(),o=a.x,s=a.y,u=a.width,l=a.height;i.destroy();var c=t;return G(c)?c=[2,2,2,2]:dt(c)&&(c=new Array(4).fill(c)),{x:o-c[3],y:s-c[0],width:u+c[1]+c[3],height:l+c[0]+c[2],rotation:(n==null?void 0:n.rotate)||0}}return{x:0,y:0,width:0,height:0,rotation:0}}function pR(r,n,t){t===void 0&&(t=0);var e=Math.max(0,Math.min(r.x+r.width+t,n.x+n.width+t)-Math.max(r.x-t,n.x-t)),i=Math.max(0,Math.min(r.y+r.height+t,n.y+n.height+t)-Math.max(r.y-t,n.y-t));return e*i}function dR(r,n){var t=r.getBBox();return Dl(n,function(e){var i=e.getBBox();return pR(t,i,2)>0})}function KS(r,n,t){var e=t.data,i=t.origin,a=t.animateCfg,o=t.coordinate,s=F(a,"update");r.set("data",e),r.set("origin",i),r.set("animateCfg",a),r.set("coordinate",o),r.set("visible",n.get("visible")),(r.getChildren()||[]).forEach(function(u,l){var c=n.getChildByIndex(l);if(!c)r.removeChild(u),u.remove(!0);else{u.set("data",e),u.set("origin",i),u.set("animateCfg",a),u.set("coordinate",o);var f=CS(u,c);s?Ha(u,s,{toAttrs:f,coordinate:o}):u.attr(f),c.isGroup()&&KS(u,c,t)}}),w(n.getChildren(),function(u,l){l>=r.getCount()&&(u.destroyed||r.add(u))})}var gR=function(){function r(n){this.shapesMap={};var t=n.layout,e=n.container;this.layout=t,this.container=e}return r.prototype.render=function(n,t,e){return e===void 0&&(e=!1),is(this,void 0,void 0,function(){var i,a,o,s,u,l,c,f,h=this;return as(this,function(v){switch(v.label){case 0:if(i={},a=this.createOffscreenGroup(),!n.length)return[3,2];try{for(o=It(n),s=o.next();!s.done;s=o.next())u=s.value,u&&(i[u.id]=this.renderLabel(u,a))}catch(p){c={error:p}}finally{try{s&&!s.done&&(f=o.return)&&f.call(o)}finally{if(c)throw c.error}}return[4,this.doLayout(n,t,i)];case 1:v.sent(),this.renderLabelLine(n,i),this.renderLabelBackground(n,i),this.adjustLabel(n,i),v.label=2;case 2:return l=this.shapesMap,w(i,function(p,d){if(p.destroyed)delete i[d];else{if(l[d]){var g=p.get("data"),y=p.get("origin"),m=p.get("coordinate"),x=p.get("animateCfg"),_=l[d];KS(_,i[d],{data:g,origin:y,animateCfg:x,coordinate:m}),i[d]=_}else{if(h.container.destroyed)return;h.container.add(p);var E=F(p.get("animateCfg"),e?"enter":"appear");E&&Ha(p,E,{toAttrs:C({},p.attr()),coordinate:p.get("coordinate")})}delete l[d]}}),w(l,function(p){var d=F(p.get("animateCfg"),"leave");d?Ha(p,d,{toAttrs:null,coordinate:p.get("coordinate")}):p.remove(!0)}),this.shapesMap=i,a.destroy(),[2]}})})},r.prototype.clear=function(){this.container.clear(),this.shapesMap={}},r.prototype.destroy=function(){this.container.destroy(),this.shapesMap=null},r.prototype.renderLabel=function(n,t){var e=n.id,i=n.elementId,a=n.data,o=n.mappingData,s=n.coordinate,u=n.animate,l=n.content,c=n.capture,f={id:e,elementId:i,capture:c,data:a,origin:C(C({},o),{data:o[Vt]}),coordinate:s},h=t.addGroup(C({name:"label",animateCfg:this.animate===!1||u===null||u===!1?!1:J({},this.animate,u)},f)),v;if(l.isGroup&&l.isGroup()||l.isShape&&l.isShape()){var p=l.getCanvasBBox(),d=p.width,g=p.height,y=F(n,"textAlign","left"),m=n.x,x=n.y-g/2;y==="center"?m=m-d/2:(y==="right"||y==="end")&&(m=m-d),Vs(l,m,x),v=l,h.add(l)}else{var _=F(n,["style","fill"]);v=h.addShape("text",C({attrs:C(C({x:n.x,y:n.y,textAlign:n.textAlign,textBaseline:F(n,"textBaseline","middle"),text:n.content},n.style),{fill:Tw(_)?n.color:_})},f))}return n.rotate&&ep(v,n.rotate),h},r.prototype.doLayout=function(n,t,e){return is(this,void 0,void 0,function(){var i,a=this;return as(this,function(o){switch(o.label){case 0:return this.layout?(i=V(this.layout)?this.layout:[this.layout],[4,Promise.all(i.map(function(s){var u=uR(F(s,"type",""));if(!!u){var l=[],c=[];return w(e,function(f,h){l.push(f),c.push(t[f.get("elementId")])}),u(n,l,c,a.region,s.cfg)}}))]):[3,2];case 1:o.sent(),o.label=2;case 2:return[2]}})})},r.prototype.renderLabelLine=function(n,t){w(n,function(e){var i=F(e,"coordinate");if(!(!e||!i)){var a=i.getCenter(),o=i.getRadius();if(!!e.labelLine){var s=F(e,"labelLine",{}),u=e.id,l=s.path;if(!l){var c=fe(a.x,a.y,o,e.angle);l=[["M",c.x,c.y],["L",e.x,e.y]]}var f=t[u];f.destroyed||f.addShape("path",{capture:!1,attrs:C({path:l,stroke:e.color?e.color:F(e,["style","fill"],"#000"),fill:null},s.style),id:u,origin:e.mappingData,data:e.data,coordinate:e.coordinate})}}})},r.prototype.renderLabelBackground=function(n,t){w(n,function(e){var i=F(e,"coordinate"),a=F(e,"background");if(!(!a||!i)){var o=e.id,s=t[o];if(!s.destroyed){var u=s.getChildren()[0];if(u){var l=qS(s,e,a.padding),c=l.rotation,f=Tt(l,["rotation"]),h=s.addShape("rect",{attrs:C(C({},f),a.style||{}),id:o,origin:e.mappingData,data:e.data,coordinate:e.coordinate});if(h.setZIndex(-1),c){var v=u.getMatrix();h.setMatrix(v)}}}}})},r.prototype.createOffscreenGroup=function(){var n=this.container,t=n.getGroupBase(),e=new t({});return e},r.prototype.adjustLabel=function(n,t){w(n,function(e){if(e){var i=e.id,a=t[i];if(!a.destroyed){var o=a.findAll(function(s){return s.get("type")!=="path"});w(o,function(s){s&&(e.offsetX&&s.attr("x",s.attr("x")+e.offsetX),e.offsetY&&s.attr("y",s.attr("y")+e.offsetY))})}}})},r}();function Zg(r){var n=0;return w(r,function(t){n+=t}),n/r.length}var cc=function(){function r(n){this.geometry=n}return r.prototype.getLabelItems=function(n){var t=this,e=[],i=this.getLabelCfgs(n);return w(n,function(a,o){var s=i[o];if(!s||G(a.x)||G(a.y)){e.push(null);return}var u=V(s.content)?s.content:[s.content];s.content=u;var l=u.length;w(u,function(c,f){if(G(c)||c===""){e.push(null);return}var h=C(C({},s),t.getLabelPoint(s,a,f));h.textAlign||(h.textAlign=t.getLabelAlign(h,f,l)),h.offset<=0&&(h.labelLine=null),e.push(h)})}),e},r.prototype.render=function(n,t){return t===void 0&&(t=!1),is(this,void 0,void 0,function(){var e,i,a;return as(this,function(o){switch(o.label){case 0:return e=this.getLabelItems(n),i=this.getLabelsRenderer(),a=this.getGeometryShapes(),[4,i.render(e,a,t)];case 1:return o.sent(),[2]}})})},r.prototype.clear=function(){var n=this.labelsRenderer;n&&n.clear()},r.prototype.destroy=function(){var n=this.labelsRenderer;n&&n.destroy(),this.labelsRenderer=null},r.prototype.getCoordinate=function(){return this.geometry.coordinate},r.prototype.getDefaultLabelCfg=function(n,t){var e=this.geometry,i=e.type,a=e.theme;return i==="polygon"||i==="interval"&&t==="middle"||n<0&&!["line","point","path"].includes(i)?F(a,"innerLabels",{}):F(a,"labels",{})},r.prototype.getThemedLabelCfg=function(n){var t=this.geometry,e=this.getDefaultLabelCfg(),i=t.type,a=t.theme,o;return i==="polygon"||n.offset<0&&!["line","point","path"].includes(i)?o=J({},e,a.innerLabels,n):o=J({},e,a.labels,n),o},r.prototype.setLabelPosition=function(n,t,e,i){},r.prototype.getLabelOffset=function(n){var t=this.getCoordinate(),e=this.getOffsetVector(n);return t.isTransposed?e[0]:e[1]},r.prototype.getLabelOffsetPoint=function(n,t,e){var i=n.offset,a=this.getCoordinate(),o=a.isTransposed,s=o?"x":"y",u=o?1:-1,l={x:0,y:0};return t>0||e===1?l[s]=i*u:l[s]=i*u*-1,l},r.prototype.getLabelPoint=function(n,t,e){var i=this.getCoordinate(),a=n.content.length;function o(g,y,m){m===void 0&&(m=!1);var x=g;return V(x)&&(n.content.length===1?m?x=Zg(x):x.length<=2?x=x[g.length-1]:x=Zg(x):x=x[y]),x}var s={content:n.content[e],x:0,y:0,start:{x:0,y:0},color:"#fff"},u=V(t.shape)?t.shape[0]:t.shape,l=u==="funnel"||u==="pyramid";if(this.geometry.type==="polygon"){var c=tO(t.x,t.y);s.x=c[0],s.y=c[1]}else this.geometry.type==="interval"&&!l?(s.x=o(t.x,e,!0),s.y=o(t.y,e)):(s.x=o(t.x,e),s.y=o(t.y,e));if(l){var f=F(t,"nextPoints"),h=F(t,"points");if(f){var v=i.convert(h[1]),p=i.convert(f[1]);s.x=(v.x+p.x)/2,s.y=(v.y+p.y)/2}else if(u==="pyramid"){var v=i.convert(h[1]),p=i.convert(h[2]);s.x=(v.x+p.x)/2,s.y=(v.y+p.y)/2}}n.position&&this.setLabelPosition(s,t,e,n.position);var d=this.getLabelOffsetPoint(n,e,a);return s.start={x:s.x,y:s.y},s.x+=d.x,s.y+=d.y,s.color=t.color,s},r.prototype.getLabelAlign=function(n,t,e){var i="center",a=this.getCoordinate();if(a.isTransposed){var o=n.offset;o<0?i="right":o===0?i="center":i="left",e>1&&t===0&&(i==="right"?i="left":i==="left"&&(i="right"))}return i},r.prototype.getLabelId=function(n){var t=this.geometry,e=t.type,i=t.getXScale(),a=t.getYScale(),o=n[Vt],s=t.getElementId(n);return e==="line"||e==="area"?s+=" ".concat(o[i.field]):e==="path"&&(s+=" ".concat(o[i.field],"-").concat(o[a.field])),s},r.prototype.getLabelsRenderer=function(){var n=this.geometry,t=n.labelsContainer,e=n.labelOption,i=n.canvasRegion,a=n.animateOption,o=this.geometry.coordinate,s=this.labelsRenderer;return s||(s=new gR({container:t,layout:F(e,["cfg","layout"],{type:this.defaultLayout})}),this.labelsRenderer=s),s.region=i,s.animate=a?VS("label",o):!1,s},r.prototype.getLabelCfgs=function(n){var t=this,e=this.geometry,i=e.labelOption,a=e.scales,o=e.coordinate,s=i,u=s.fields,l=s.callback,c=s.cfg,f=u.map(function(v){return a[v]}),h=[];return w(n,function(v,p){var d=v[Vt],g=t.getLabelText(d,f),y;if(l){var m=u.map(function(M){return d[M]});if(y=l.apply(void 0,te([],ut(m),!1)),G(y)){h.push(null);return}}var x=C(C({id:t.getLabelId(v),elementId:t.geometry.getElementId(v),data:d,mappingData:v,coordinate:o},c),y);rt(x.position)&&(x.position=x.position(d,v,p));var _=t.getLabelOffset(x.offset||0),E=t.getDefaultLabelCfg(_,x.position);x=J({},E,x),x.offset=t.getLabelOffset(x.offset||0);var b=x.content;rt(b)?x.content=b(d,v,p):Je(b)&&(x.content=g[0]),h.push(x)}),h},r.prototype.getLabelText=function(n,t){var e=[];return w(t,function(i){var a=n[i.field];V(a)?a=a.map(function(o){return i.getText(o)}):a=i.getText(a),G(a)||a===""?e.push(null):e.push(a)}),e},r.prototype.getOffsetVector=function(n){n===void 0&&(n=0);var t=this.getCoordinate(),e=0;return dt(n)&&(e=n),t.isTransposed?t.applyMatrix(e,0):t.applyMatrix(0,e)},r.prototype.getGeometryShapes=function(){var n=this.geometry,t={};return w(n.elementsMap,function(e,i){t[i]=e.shape}),w(n.getOffscreenGroup().getChildren(),function(e){var i=n.getElementId(e.get("origin").mappingData);t[i]=e}),t},r}();function _h(r,n,t){if(!r)return t;var e;if(r.callback&&r.callback.length>1){var i=Array(r.callback.length-1).fill("");e=r.mapping.apply(r,te([n],ut(i),!1)).join("")}else e=r.mapping(n).join("");return e||t}var ra={hexagon:function(r,n,t){var e=t/2*Math.sqrt(3);return[["M",r,n-t],["L",r+e,n-t/2],["L",r+e,n+t/2],["L",r,n+t],["L",r-e,n+t/2],["L",r-e,n-t/2],["Z"]]},bowtie:function(r,n,t){var e=t-1.5;return[["M",r-t,n-e],["L",r+t,n+e],["L",r+t,n-e],["L",r-t,n+e],["Z"]]},cross:function(r,n,t){return[["M",r-t,n-t],["L",r+t,n+t],["M",r+t,n-t],["L",r-t,n+t]]},tick:function(r,n,t){return[["M",r-t/2,n-t],["L",r+t/2,n-t],["M",r,n-t],["L",r,n+t],["M",r-t/2,n+t],["L",r+t/2,n+t]]},plus:function(r,n,t){return[["M",r-t,n],["L",r+t,n],["M",r,n-t],["L",r,n+t]]},hyphen:function(r,n,t){return[["M",r-t,n],["L",r+t,n]]},line:function(r,n,t){return[["M",r,n-t],["L",r,n+t]]}},yR=["line","cross","tick","plus","hyphen"];function mR(r,n){return rt(n)?n(r):J({},r,n)}function xR(r,n){var t=r.symbol;if(lt(t)&&yR.indexOf(t)!==-1){var e=F(r,"style",{}),i=F(e,"lineWidth",1),a=e.stroke||e.fill||n;r.style=J({},r.style,{lineWidth:i,stroke:a,fill:null})}}function QS(r){var n=r.symbol;lt(n)&&ra[n]&&(r.symbol=ra[n])}function ef(r){return r.startsWith(Z.LEFT)||r.startsWith(Z.RIGHT)?"vertical":"horizontal"}function JS(r,n,t,e,i){var a=t.getScale(t.type);if(a.isCategory){var o=a.field,s=n.getAttribute("color"),u=n.getAttribute("shape"),l=r.getTheme().defaultColor,c=n.coordinate.isPolar;return a.getTicks().map(function(f,h){var v,p=f.text,d=f.value,g=p,y=a.invert(d),m=r.filterFieldData(o,[(v={},v[o]=y,v)]).length===0;w(r.views,function(M){var T;M.filterFieldData(o,[(T={},T[o]=y,T)]).length||(m=!0)});var x=_h(s,y,l),_=_h(u,y,"point"),E=n.getShapeMarker(_,{color:x,isInPolar:c}),b=i;return rt(b)&&(b=b(g,h,C({name:g,value:y},J({},e,E)))),E=J({},e,E,Ke(C({},b),["style"])),xR(E,x),b&&b.style&&(E.style=mR(E.style,b.style)),QS(E),{id:y,name:g,value:y,marker:E,unchecked:m}})}return[]}function _R(r,n,t){return t.map(function(e,i){var a=n;rt(a)&&(a=a(e.name,i,J({},r,e)));var o=rt(e.marker)?e.marker(e.name,i,J({},r,e)):e.marker,s=J({},r,a,o);return QS(s),e.marker=s,e})}function qg(r,n){var t=F(r,["components","legend"],{});return J({},F(t,["common"],{}),J({},F(t,[n],{})))}function rf(r){return r?!1:r==null||isNaN(r)}function Kg(r){if(V(r))return rf(r[1].y);var n=r.y;return V(n)?rf(n[0]):rf(n)}function fc(r,n,t){if(n===void 0&&(n=!1),t===void 0&&(t=!0),!r.length||r.length===1&&!t)return[];if(n){for(var e=[],i=0,a=r.length;i<a;i++){var o=r[i];Kg(o)||e.push(o)}return[e]}for(var s=[],u=[],i=0,a=r.length;i<a;i++){var o=r[i];Kg(o)?u.length&&(u.length===1&&!t||s.push(u),u=[]):u.push(o)}return u.length&&s.push(u),s}function tb(r){for(var n=[],t=0;t<r.length;t++){var e=r[t];if(e){var i=t===0?"M":"L";n.push([i,e.x,e.y])}}var a=r[0];return a&&(n.push(["L",a.x,a.y]),n.push(["z"])),n}function eb(r){for(var n=r.length/2,t=[],e=[],i=0;i<r.length;i++)i<n?t.push(r[i]):e.push(r[i]);var a=cl(t,!1),o=cl(e,!1);e.length&&a.push(["L",e[0].x,e[0].y]),o.shift();var s=a.concat(o);return t.length&&s.push(["L",t[0].x,t[0].y]),s.push(["z"]),s}function ce(r,n,t,e){e===void 0&&(e="");var i=r.style,a=i===void 0?{}:i,o=r.defaultStyle,s=r.color,u=r.size,l=C(C({},o),a);return s&&(n&&(a.stroke||(l.stroke=s)),t&&(a.fill||(l.fill=s))),e&&G(a[e])&&!G(u)&&(l[e]=u),l}function rb(r){return J({},{fill:"#CCD6EC",fillOpacity:.3},F(r,["background","style"]))}function rp(r){var n=r.x,t=V(r.y)?r.y:[r.y];return t.map(function(e,i){return{x:V(n)?n[i]:n,y:e}})}var CR={line:function(r,n,t){return[["M",r-t,n],["L",r+t,n]]},dot:function(r,n,t){return[["M",r-t,n],["L",r+t,n]]},dash:function(r,n,t){return[["M",r-t,n],["L",r+t,n]]},smooth:function(r,n,t){return[["M",r-t,n],["A",t/2,t/2,0,1,1,r,n],["A",t/2,t/2,0,1,0,r+t,n]]},hv:function(r,n,t){return[["M",r-t-1,n-2.5],["L",r,n-2.5],["L",r,n+2.5],["L",r+t+1,n+2.5]]},vh:function(r,n,t){return[["M",r-t-1,n+2.5],["L",r,n+2.5],["L",r,n-2.5],["L",r+t+1,n-2.5]]},hvh:function(r,n,t){return[["M",r-(t+1),n+2.5],["L",r-t/2,n+2.5],["L",r-t/2,n-2.5],["L",r+t/2,n-2.5],["L",r+t/2,n+2.5],["L",r+t+1,n+2.5]]},vhv:function(r,n){return[["M",r-5,n+2.5],["L",r-5,n],["L",r,n],["L",r,n-3],["L",r,n+3],["L",r+6.5,n+3]]}};function nb(r,n){var t=r.color;return{symbol:CR[n],style:{lineWidth:2,r:6,stroke:t}}}function ER(r,n,t){for(var e=r.isStack,i=r.connectNulls,a=r.isInCircle,o=r.showSinglePoint,s=ce(r,!0,!1,"lineWidth"),u=fc(r.points,i,o),l=[],c=0,f=u.length;c<f;c++){var h=u[c];l=l.concat(ib(h,a,e,n,t,s))}return s.path=l,s}function Ch(r,n,t,e,i){if(r.length===1)return[["M",r[0].x,r[0].y-i.lineWidth/2],["L",r[0].x,r[0].y],["L",r[0].x,r[0].y+i.lineWidth/2]];var a;return t?(n&&r.length&&r.push({x:r[0].x,y:r[0].y}),a=cl(r,!1,e)):(a=$s(r,!1),n&&a.push(["Z"])),a}function SR(r,n,t,e,i,a){var o=[],s=[];w(r,function(c){var f=rp(c);o.push(f[1]),s.push(f[0])});var u=Ch(o,n,e,i,a),l=Ch(s,n,e,i,a);return t?u:u.concat(l)}function ib(r,n,t,e,i,a){if(r.length){var o=r[0];return V(o.y)?SR(r,n,t,e,i,a):Ch(r,n,e,i,a)}return[]}xi("line",{defaultShapeType:"line"});w(["line","dot","dash","smooth"],function(r){Pt("line",r,{draw:function(n,t){var e=r==="smooth",i;if(e){var a=this.coordinate,o=a.start,s=a.end;i=[[o.x,s.y],[s.x,o.y]]}var u=ER(n,e,i),l=t.addShape({type:"path",attrs:u,name:"line",capture:!e});return l},getMarker:function(n){return nb(n,r)}})});var ir={getLegendItems:JS,translate:Vs,rotate:ep,zoom:vR,transform:lc,getAngle:vs,getSectorPath:ai,polarToCartesian:fe,getDelegationObject:ea,getTooltipItems:qv,getMappingValue:_h,getPath:ib,getPathPoints:fc},Nn={100:"#000",95:"#0D0D0D",85:"#262626",65:"#595959",45:"#8C8C8C",25:"#BFBFBF",15:"#D9D9D9",6:"#F0F0F0"},$t={100:"#FFFFFF",95:"#F2F2F2",85:"#D9D9D9",65:"#A6A6A6",45:"#737373",25:"#404040",15:"#262626",6:"#0F0F0F"},Gr=["#5B8FF9","#5AD8A6","#5D7092","#F6BD16","#E86452","#6DC8EC","#945FB9","#FF9845","#1E9493","#FF99C3"],bR=["#5B8FF9","#CDDDFD","#5AD8A6","#CDF3E4","#5D7092","#CED4DE","#F6BD16","#FCEBB9","#E86452","#F8D0CB","#6DC8EC","#D3EEF9","#945FB9","#DECFEA","#FF9845","#FFE0C7","#1E9493","#BBDEDE","#FF99C3","#FFE0ED"],AR=["#B8E1FF","#9AC5FF","#7DAAFF","#5B8FF9","#3D76DD","#085EC0","#0047A5","#00318A","#001D70"],TR=function(r){r===void 0&&(r={});var n=r.paletteQualitative10,t=n===void 0?Gr:n,e=r.paletteQualitative20,i=e===void 0?bR:e,a=r.brandColor,o=a===void 0?t[0]:a,s={backgroundColor:"#141414",brandColor:o,subColor:"rgba(255,255,255,0.05)",paletteQualitative10:t,paletteQualitative20:i,paletteSemanticRed:"#F4664A",paletteSemanticGreen:"#30BF78",paletteSemanticYellow:"#FAAD14",paletteSequence:AR,fontFamily:`"Segoe UI", Roboto, "Helvetica Neue", Arial,
    "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol",
    "Noto Color Emoji"`,axisLineBorderColor:$t[25],axisLineBorder:1,axisLineDash:null,axisTitleTextFillColor:$t[65],axisTitleTextFontSize:12,axisTitleTextLineHeight:12,axisTitleTextFontWeight:"normal",axisTitleSpacing:12,axisDescriptionIconFillColor:Nn[85],axisTickLineBorderColor:$t[25],axisTickLineLength:4,axisTickLineBorder:1,axisSubTickLineBorderColor:$t[15],axisSubTickLineLength:2,axisSubTickLineBorder:1,axisLabelFillColor:$t[45],axisLabelFontSize:12,axisLabelLineHeight:12,axisLabelFontWeight:"normal",axisLabelOffset:8,axisGridBorderColor:$t[15],axisGridBorder:1,axisGridLineDash:null,legendTitleTextFillColor:$t[45],legendTitleTextFontSize:12,legendTitleTextLineHeight:21,legendTitleTextFontWeight:"normal",legendMarkerColor:Gr[0],legendMarkerSpacing:8,legendMarkerSize:4,legendCircleMarkerSize:4,legendSquareMarkerSize:4,legendLineMarkerSize:5,legendItemNameFillColor:$t[65],legendItemNameFontSize:12,legendItemNameLineHeight:12,legendItemNameFontWeight:"normal",legendItemSpacing:24,legendItemMarginBottom:12,legendSpacing:16,legendPadding:[8,8,8,8],legendHorizontalPadding:[8,0,8,0],legendVerticalPadding:[0,8,0,8],legendPageNavigatorMarkerSize:12,legendPageNavigatorMarkerInactiveFillColor:$t[45],legendPageNavigatorMarkerInactiveFillOpacity:.45,legendPageNavigatorMarkerFillColor:$t[45],legendPageNavigatorMarkerFillOpacity:1,legendPageNavigatorTextFillColor:$t[65],legendPageNavigatorTextFontSize:12,sliderRailFillColor:$t[15],sliderRailBorder:0,sliderRailBorderColor:null,sliderRailWidth:100,sliderRailHeight:12,sliderLabelTextFillColor:$t[45],sliderLabelTextFontSize:12,sliderLabelTextLineHeight:12,sliderLabelTextFontWeight:"normal",sliderHandlerFillColor:Nn[6],sliderHandlerWidth:10,sliderHandlerHeight:14,sliderHandlerBorder:1,sliderHandlerBorderColor:Nn[25],annotationArcBorderColor:$t[15],annotationArcBorder:1,annotationLineBorderColor:$t[25],annotationLineBorder:1,annotationLineDash:null,annotationTextFillColor:$t[65],annotationTextFontSize:12,annotationTextLineHeight:12,annotationTextFontWeight:"normal",annotationTextBorderColor:null,annotationTextBorder:0,annotationRegionFillColor:$t[100],annotationRegionFillOpacity:.06,annotationRegionBorder:0,annotationRegionBorderColor:null,annotationDataMarkerLineLength:16,tooltipCrosshairsBorderColor:$t[25],tooltipCrosshairsBorder:1,tooltipCrosshairsLineDash:null,tooltipContainerFillColor:"#1f1f1f",tooltipContainerFillOpacity:.95,tooltipContainerShadow:"0px 2px 4px rgba(0,0,0,.5)",tooltipContainerBorderRadius:3,tooltipTextFillColor:$t[65],tooltipTextFontSize:12,tooltipTextLineHeight:12,tooltipTextFontWeight:"bold",labelFillColor:$t[65],labelFillColorDark:"#2c3542",labelFillColorLight:"#ffffff",labelFontSize:12,labelLineHeight:12,labelFontWeight:"normal",labelBorderColor:null,labelBorder:0,innerLabelFillColor:Nn[100],innerLabelFontSize:12,innerLabelLineHeight:12,innerLabelFontWeight:"normal",innerLabelBorderColor:null,innerLabelBorder:0,overflowLabelFillColor:$t[65],overflowLabelFillColorDark:"#2c3542",overflowLabelFillColorLight:"#ffffff",overflowLabelFontSize:12,overflowLabelLineHeight:12,overflowLabelFontWeight:"normal",overflowLabelBorderColor:Nn[100],overflowLabelBorder:1,labelLineBorder:1,labelLineBorderColor:$t[25],cSliderRailHieght:16,cSliderBackgroundFillColor:"#416180",cSliderBackgroundFillOpacity:.05,cSliderForegroundFillColor:"#5B8FF9",cSliderForegroundFillOpacity:.15,cSliderHandlerHeight:24,cSliderHandlerWidth:10,cSliderHandlerFillColor:"#F7F7F7",cSliderHandlerFillOpacity:1,cSliderHandlerHighlightFillColor:"#FFF",cSliderHandlerBorderColor:"#BFBFBF",cSliderHandlerBorder:1,cSliderHandlerBorderRadius:2,cSliderTextFillColor:"#fff",cSliderTextFillOpacity:.45,cSliderTextFontSize:12,cSliderTextLineHeight:12,cSliderTextFontWeight:"normal",cSliderTextBorderColor:null,cSliderTextBorder:0,scrollbarTrackFillColor:"rgba(255,255,255,0.65)",scrollbarThumbFillColor:"rgba(0,0,0,0.35)",scrollbarThumbHighlightFillColor:"rgba(0,0,0,0.45)",pointFillColor:Gr[0],pointFillOpacity:.95,pointSize:4,pointBorder:1,pointBorderColor:Nn[100],pointBorderOpacity:1,pointActiveBorderColor:$t[100],pointSelectedBorder:2,pointSelectedBorderColor:$t[100],pointInactiveFillOpacity:.3,pointInactiveBorderOpacity:.3,hollowPointSize:4,hollowPointBorder:1,hollowPointBorderColor:Gr[0],hollowPointBorderOpacity:.95,hollowPointFillColor:Nn[100],hollowPointActiveBorder:1,hollowPointActiveBorderColor:$t[100],hollowPointActiveBorderOpacity:1,hollowPointSelectedBorder:2,hollowPointSelectedBorderColor:$t[100],hollowPointSelectedBorderOpacity:1,hollowPointInactiveBorderOpacity:.3,lineBorder:2,lineBorderColor:Gr[0],lineBorderOpacity:1,lineActiveBorder:3,lineSelectedBorder:3,lineInactiveBorderOpacity:.3,areaFillColor:Gr[0],areaFillOpacity:.25,areaActiveFillColor:Gr[0],areaActiveFillOpacity:.5,areaSelectedFillColor:Gr[0],areaSelectedFillOpacity:.5,areaInactiveFillOpacity:.3,hollowAreaBorderColor:Gr[0],hollowAreaBorder:2,hollowAreaBorderOpacity:1,hollowAreaActiveBorder:3,hollowAreaActiveBorderColor:$t[100],hollowAreaSelectedBorder:3,hollowAreaSelectedBorderColor:$t[100],hollowAreaInactiveBorderOpacity:.3,intervalFillColor:Gr[0],intervalFillOpacity:.95,intervalActiveBorder:1,intervalActiveBorderColor:$t[100],intervalActiveBorderOpacity:1,intervalSelectedBorder:2,intervalSelectedBorderColor:$t[100],intervalSelectedBorderOpacity:1,intervalInactiveBorderOpacity:.3,intervalInactiveFillOpacity:.3,hollowIntervalBorder:2,hollowIntervalBorderColor:Gr[0],hollowIntervalBorderOpacity:1,hollowIntervalFillColor:Nn[100],hollowIntervalActiveBorder:2,hollowIntervalActiveBorderColor:$t[100],hollowIntervalSelectedBorder:3,hollowIntervalSelectedBorderColor:$t[100],hollowIntervalSelectedBorderOpacity:1,hollowIntervalInactiveBorderOpacity:.3};return C(C({},s),r)},MR=TR();function wR(){return window?window.devicePixelRatio:1}function ab(r,n,t,e){var i=r-t,a=n-e;return Math.sqrt(i*i+a*a)}function Hi(r,n,t,e,i,a){return i>=r&&i<=r+t&&a>=n&&a<=n+e}function ys(r,n){return!(n.minX>r.maxX||n.maxX<r.minX||n.minY>r.maxY||n.maxY<r.minY)}function LR(r,n){return!r||!n?r||n:{minX:Math.min(r.minX,n.minX),minY:Math.min(r.minY,n.minY),maxX:Math.max(r.maxX,n.maxX),maxY:Math.max(r.maxY,n.maxY)}}function Qg(r,n){return r[0]===n[0]&&r[1]===n[1]}var FR=/^l\s*\(\s*([\d.]+)\s*\)\s*(.*)/i,kR=/^r\s*\(\s*([\d.]+)\s*,\s*([\d.]+)\s*,\s*([\d.]+)\s*\)\s*(.*)/i,OR=/^p\s*\(\s*([axyn])\s*\)\s*(.*)/i,ob=/[\d.]+:(#[^\s]+|[^\)]+\))/gi;function sb(r,n){var t=r.match(ob);w(t,function(e){var i=e.split(":");n.addColorStop(i[0],i[1])})}function RR(r,n,t){var e=FR.exec(t),i=parseFloat(e[1])%360*(Math.PI/180),a=e[2],o=n.getBBox(),s,u;i>=0&&i<1/2*Math.PI?(s={x:o.minX,y:o.minY},u={x:o.maxX,y:o.maxY}):1/2*Math.PI<=i&&i<Math.PI?(s={x:o.maxX,y:o.minY},u={x:o.minX,y:o.maxY}):Math.PI<=i&&i<3/2*Math.PI?(s={x:o.maxX,y:o.maxY},u={x:o.minX,y:o.minY}):(s={x:o.minX,y:o.maxY},u={x:o.maxX,y:o.minY});var l=Math.tan(i),c=l*l,f=(u.x-s.x+l*(u.y-s.y))/(c+1)+s.x,h=l*(u.x-s.x+l*(u.y-s.y))/(c+1)+s.y,v=r.createLinearGradient(s.x,s.y,f,h);return sb(a,v),v}function IR(r,n,t){var e=kR.exec(t),i=parseFloat(e[1]),a=parseFloat(e[2]),o=parseFloat(e[3]),s=e[4];if(o===0){var u=s.match(ob);return u[u.length-1].split(":")[1]}var l=n.getBBox(),c=l.maxX-l.minX,f=l.maxY-l.minY,h=Math.sqrt(c*c+f*f)/2,v=r.createRadialGradient(l.minX+c*i,l.minY+f*a,0,l.minX+c/2,l.minY+f/2,o*h);return sb(s,v),v}function DR(r,n,t){if(n.get("patternSource")&&n.get("patternSource")===t)return n.get("pattern");var e,i,a=OR.exec(t),o=a[1],s=a[2];function u(){e=r.createPattern(i,o),n.set("pattern",e),n.set("patternSource",t)}switch(o){case"a":o="repeat";break;case"x":o="repeat-x";break;case"y":o="repeat-y";break;case"n":o="no-repeat";break;default:o="no-repeat"}return i=new Image,s.match(/^data:/i)||(i.crossOrigin="Anonymous"),i.src=s,i.complete?u():(i.onload=u,i.src=i.src),e}function PR(r,n,t){var e=n.getBBox();if(isNaN(e.x)||isNaN(e.y)||isNaN(e.width)||isNaN(e.height))return t;if(lt(t)){if(t[1]==="("||t[2]==="("){if(t[0]==="l")return RR(r,n,t);if(t[0]==="r")return IR(r,n,t);if(t[0]==="p")return DR(r,n,t)}return t}if(t instanceof CanvasPattern)return t}function BR(r){var n=0,t=0,e=0,i=0;return V(r)?r.length===1?n=t=e=i=r[0]:r.length===2?(n=e=r[0],t=i=r[1]):r.length===3?(n=r[0],t=i=r[1],e=r[2]):(n=r[0],t=r[1],e=r[2],i=r[3]):n=t=e=i=r,[n,t,e,i]}function fu(r){return Math.sqrt(r[0]*r[0]+r[1]*r[1])}function Eh(r,n){return fu(r)*fu(n)?(r[0]*n[0]+r[1]*n[1])/(fu(r)*fu(n)):1}function Jg(r,n){return(r[0]*n[1]<r[1]*n[0]?-1:1)*Math.acos(Eh(r,n))}function hl(r,n){var t=n[1],e=n[2],i=Av(Tv(n[3]),Math.PI*2),a=n[4],o=n[5],s=r[0],u=r[1],l=n[6],c=n[7],f=Math.cos(i)*(s-l)/2+Math.sin(i)*(u-c)/2,h=-1*Math.sin(i)*(s-l)/2+Math.cos(i)*(u-c)/2,v=f*f/(t*t)+h*h/(e*e);v>1&&(t*=Math.sqrt(v),e*=Math.sqrt(v));var p=t*t*(h*h)+e*e*(f*f),d=p?Math.sqrt((t*t*(e*e)-p)/p):1;a===o&&(d*=-1),isNaN(d)&&(d=0);var g=e?d*t*h/e:0,y=t?d*-e*f/t:0,m=(s+l)/2+Math.cos(i)*g-Math.sin(i)*y,x=(u+c)/2+Math.sin(i)*g+Math.cos(i)*y,_=[(f-g)/t,(h-y)/e],E=[(-1*f-g)/t,(-1*h-y)/e],b=Jg([1,0],_),M=Jg(_,E);return Eh(_,E)<=-1&&(M=Math.PI),Eh(_,E)>=1&&(M=0),o===0&&M>0&&(M=M-2*Math.PI),o===1&&M<0&&(M=M+2*Math.PI),{cx:m,cy:x,rx:Qg(r,[l,c])?0:t,ry:Qg(r,[l,c])?0:e,startAngle:b,endAngle:b+M,xRotation:i,arcFlag:a,sweepFlag:o}}var vl=Math.sin,pl=Math.cos,np=Math.atan2,hu=Math.PI;function ub(r,n,t,e,i,a,o){var s=n.stroke,u=n.lineWidth,l=t-i,c=e-a,f=np(c,l),h=new up({type:"path",canvas:r.get("canvas"),isArrowShape:!0,attrs:{path:"M"+10*pl(hu/6)+","+10*vl(hu/6)+" L0,0 L"+10*pl(hu/6)+",-"+10*vl(hu/6),stroke:s,lineWidth:u}});h.translate(i,a),h.rotateAtPoint(i,a,f),r.set(o?"startArrowShape":"endArrowShape",h)}function lb(r,n,t,e,i,a,o){var s=n.startArrow,u=n.endArrow,l=n.stroke,c=n.lineWidth,f=o?s:u,h=f.d,v=f.fill,p=f.stroke,d=f.lineWidth,g=Tt(f,["d","fill","stroke","lineWidth"]),y=t-i,m=e-a,x=np(m,y);h&&(i=i-pl(x)*h,a=a-vl(x)*h);var _=new up({type:"path",canvas:r.get("canvas"),isArrowShape:!0,attrs:C(C({},g),{stroke:p||l,lineWidth:d||c,fill:v})});_.translate(i,a),_.rotateAtPoint(i,a,x),r.set(o?"startArrowShape":"endArrowShape",_)}function Ki(r,n,t,e,i){var a=np(e-n,t-r);return{dx:pl(a)*i,dy:vl(a)*i}}function ip(r,n,t,e,i,a){typeof n.startArrow=="object"?lb(r,n,t,e,i,a,!0):n.startArrow?ub(r,n,t,e,i,a,!0):r.set("startArrowShape",null)}function ap(r,n,t,e,i,a){typeof n.endArrow=="object"?lb(r,n,t,e,i,a,!1):n.endArrow?ub(r,n,t,e,i,a,!1):r.set("startArrowShape",null)}var t0={fill:"fillStyle",stroke:"strokeStyle",opacity:"globalAlpha"};function to(r,n){var t=n.attr();for(var e in t){var i=t[e],a=t0[e]?t0[e]:e;a==="matrix"&&i?r.transform(i[0],i[1],i[3],i[4],i[6],i[7]):a==="lineDash"&&r.setLineDash?V(i)&&r.setLineDash(i):(a==="strokeStyle"||a==="fillStyle"?i=PR(r,n,i):a==="globalAlpha"&&(i=i*r.globalAlpha),r[a]=i)}}function Sh(r,n,t){for(var e=0;e<n.length;e++){var i=n[e];i.cfg.visible?i.draw(r,t):i.skipDraw()}}function NR(r,n,t){var e=r.get("refreshElements");w(e,function(i){if(i!==r)for(var a=i.cfg.parent;a&&a!==r&&!a.cfg.refresh;)a.cfg.refresh=!0,a=a.cfg.parent}),e[0]===r?op(n):bh(n,t)}function bh(r,n){for(var t=0;t<r.length;t++){var e=r[t];if(e.cfg.visible)if(e.cfg.hasChanged)e.cfg.refresh=!0,e.isGroup()&&op(e.cfg.children);else if(e.cfg.refresh)e.isGroup()&&bh(e.cfg.children,n);else{var i=zR(e,n);e.cfg.refresh=i,i&&e.isGroup()&&bh(e.cfg.children,n)}}}function cb(r){for(var n=0;n<r.length;n++){var t=r[n];t.cfg.hasChanged=!1,t.isGroup()&&!t.destroyed&&cb(t.cfg.children)}}function op(r,n){for(var t=0;t<r.length;t++){var e=r[t];e.cfg.refresh=!0,e.isGroup()&&op(e.get("children"))}}function zR(r,n){var t=r.cfg.cacheCanvasBBox,e=r.cfg.isInView&&t&&ys(t,n);return e}function fb(r,n,t,e){var i=t.path,a=t.startArrow,o=t.endArrow;if(!!i){var s=[0,0],u=[0,0],l={dx:0,dy:0};n.beginPath();for(var c=0;c<i.length;c++){var f=i[c],h=f[0];if(c===0&&a&&a.d){var v=r.getStartTangent();l=Ki(v[0][0],v[0][1],v[1][0],v[1][1],a.d)}else if(c===i.length-2&&i[c+1][0]==="Z"&&o&&o.d){var p=i[c+1];if(p[0]==="Z"){var v=r.getEndTangent();l=Ki(v[0][0],v[0][1],v[1][0],v[1][1],o.d)}}else if(c===i.length-1&&o&&o.d&&i[0]!=="Z"){var v=r.getEndTangent();l=Ki(v[0][0],v[0][1],v[1][0],v[1][1],o.d)}var d=l.dx,g=l.dy;switch(h){case"M":n.moveTo(f[1]-d,f[2]-g),u=[f[1],f[2]];break;case"L":n.lineTo(f[1]-d,f[2]-g);break;case"Q":n.quadraticCurveTo(f[1],f[2],f[3]-d,f[4]-g);break;case"C":n.bezierCurveTo(f[1],f[2],f[3],f[4],f[5]-d,f[6]-g);break;case"A":{var y=void 0;e?(y=e[c],y||(y=hl(s,f),e[c]=y)):y=hl(s,f);var m=y.cx,x=y.cy,_=y.rx,E=y.ry,b=y.startAngle,M=y.endAngle,T=y.xRotation,k=y.sweepFlag;if(n.ellipse)n.ellipse(m,x,_,E,T,b,M,1-k);else{var L=_>E?_:E,O=_>E?1:_/E,D=_>E?E/_:1;n.translate(m,x),n.rotate(T),n.scale(O,D),n.arc(0,0,L,b,M,1-k),n.scale(1/O,1/D),n.rotate(-T),n.translate(-m,-x)}break}case"Z":n.closePath();break}if(h==="Z")s=u;else{var W=f.length;s=[f[W-2],f[W-1]]}}}}function hb(r,n){var t=r.get("canvas");t&&(n==="remove"&&(r._cacheCanvasBBox=r.get("cacheCanvasBBox")),r.get("hasChanged")||(r.set("hasChanged",!0),r.cfg.parent&&r.cfg.parent.get("hasChanged")||(t.refreshElement(r,n,t),t.get("autoDraw")&&t.draw())))}function UR(r){var n;if(r.destroyed)n=r._cacheCanvasBBox;else{var t=r.get("cacheCanvasBBox"),e=t&&!!(t.width&&t.height),i=r.getCanvasBBox(),a=i&&!!(i.width&&i.height);e&&a?n=LR(t,i):e?n=t:a&&(n=i)}return n}function HR(r){if(!r.length)return null;var n=[],t=[],e=[],i=[];return w(r,function(a){var o=UR(a);o&&(n.push(o.minX),t.push(o.minY),e.push(o.maxX),i.push(o.maxY))}),{minX:er(n),minY:er(t),maxX:We(e),maxY:We(i)}}function $R(r,n){return!r||!n||!ys(r,n)?null:{minX:Math.max(r.minX,n.minX),minY:Math.max(r.minY,n.minY),maxX:Math.min(r.maxX,n.maxX),maxY:Math.min(r.maxY,n.maxY)}}var sp=function(r){R(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.onCanvasChange=function(t){hb(this,t)},n.prototype.getShapeBase=function(){return Rl},n.prototype.getGroupBase=function(){return n},n.prototype._applyClip=function(t,e){e&&(t.save(),to(t,e),e.createPath(t),t.restore(),t.clip(),e._afterDraw())},n.prototype.cacheCanvasBBox=function(){var t=this.cfg.children,e=[],i=[];w(t,function(h){var v=h.cfg.cacheCanvasBBox;v&&h.cfg.isInView&&(e.push(v.minX,v.maxX),i.push(v.minY,v.maxY))});var a=null;if(e.length){var o=er(e),s=We(e),u=er(i),l=We(i);a={minX:o,minY:u,x:o,y:u,maxX:s,maxY:l,width:s-o,height:l-u};var c=this.cfg.canvas;if(c){var f=c.getViewRange();this.set("isInView",ys(a,f))}}else this.set("isInView",!1);this.set("cacheCanvasBBox",a)},n.prototype.draw=function(t,e){var i=this.cfg.children,a=e?this.cfg.refresh:!0;i.length&&a&&(t.save(),to(t,this),this._applyClip(t,this.getClip()),Sh(t,i,e),t.restore(),this.cacheCanvasBBox()),this.cfg.refresh=null,this.set("hasChanged",!1)},n.prototype.skipDraw=function(){this.set("cacheCanvasBBox",null),this.set("hasChanged",!1)},n}(Hl),GR=function(r){R(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.getDefaultAttrs=function(){var t=r.prototype.getDefaultAttrs.call(this);return C(C({},t),{lineWidth:1,lineAppendWidth:0,strokeOpacity:1,fillOpacity:1})},n.prototype.getShapeBase=function(){return Rl},n.prototype.getGroupBase=function(){return sp},n.prototype.onCanvasChange=function(t){hb(this,t)},n.prototype.calculateBBox=function(){var t=this.get("type"),e=this.getHitLineWidth(),i=Gl(t),a=i(this),o=e/2,s=a.x-o,u=a.y-o,l=a.x+a.width+o,c=a.y+a.height+o;return{x:s,minX:s,y:u,minY:u,width:a.width+e,height:a.height+e,maxX:l,maxY:c}},n.prototype.isFill=function(){return!!this.attrs.fill||this.isClipShape()},n.prototype.isStroke=function(){return!!this.attrs.stroke},n.prototype._applyClip=function(t,e){e&&(t.save(),to(t,e),e.createPath(t),t.restore(),t.clip(),e._afterDraw())},n.prototype.draw=function(t,e){var i=this.cfg.clipShape;if(e){if(this.cfg.refresh===!1){this.set("hasChanged",!1);return}var a=this.getCanvasBBox();if(!ys(e,a)){this.set("hasChanged",!1),this.cfg.isInView&&this._afterDraw();return}}t.save(),to(t,this),this._applyClip(t,i),this.drawPath(t),t.restore(),this._afterDraw()},n.prototype.getCanvasViewBox=function(){var t=this.cfg.canvas;return t?t.getViewRange():null},n.prototype.cacheCanvasBBox=function(){var t=this.getCanvasViewBox();if(t){var e=this.getCanvasBBox(),i=ys(e,t);this.set("isInView",i),i?this.set("cacheCanvasBBox",e):this.set("cacheCanvasBBox",null)}},n.prototype._afterDraw=function(){this.cacheCanvasBBox(),this.set("hasChanged",!1),this.set("refresh",null)},n.prototype.skipDraw=function(){this.set("cacheCanvasBBox",null),this.set("isInView",null),this.set("hasChanged",!1)},n.prototype.drawPath=function(t){this.createPath(t),this.strokeAndFill(t),this.afterDrawPath(t)},n.prototype.fill=function(t){t.fill()},n.prototype.stroke=function(t){t.stroke()},n.prototype.strokeAndFill=function(t){var e=this.attrs,i=e.lineWidth,a=e.opacity,o=e.strokeOpacity,s=e.fillOpacity;this.isFill()&&(!G(s)&&s!==1?(t.globalAlpha=s,this.fill(t),t.globalAlpha=a):this.fill(t)),this.isStroke()&&i>0&&(!G(o)&&o!==1&&(t.globalAlpha=o),this.stroke(t)),this.afterDrawPath(t)},n.prototype.createPath=function(t){},n.prototype.afterDrawPath=function(t){},n.prototype.isInShape=function(t,e){var i=this.isStroke(),a=this.isFill(),o=this.getHitLineWidth();return this.isInStrokeOrPath(t,e,i,a,o)},n.prototype.isInStrokeOrPath=function(t,e,i,a,o){return!1},n.prototype.getHitLineWidth=function(){if(!this.isStroke())return 0;var t=this.attrs;return t.lineWidth+t.lineAppendWidth},n}($l);const Kr=GR;var VR=function(r){R(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.getDefaultAttrs=function(){var t=r.prototype.getDefaultAttrs.call(this);return C(C({},t),{x:0,y:0,r:0})},n.prototype.isInStrokeOrPath=function(t,e,i,a,o){var s=this.attr(),u=s.x,l=s.y,c=s.r,f=o/2,h=ab(u,l,t,e);return a&&i?h<=c+f:a?h<=c:i?h>=c-f&&h<=c+f:!1},n.prototype.createPath=function(t){var e=this.attr(),i=e.x,a=e.y,o=e.r;t.beginPath(),t.arc(i,a,o,0,Math.PI*2,!1),t.closePath()},n}(Kr);const WR=VR;function vu(r,n,t,e){return r/(t*t)+n/(e*e)}var jR=function(r){R(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.getDefaultAttrs=function(){var t=r.prototype.getDefaultAttrs.call(this);return C(C({},t),{x:0,y:0,rx:0,ry:0})},n.prototype.isInStrokeOrPath=function(t,e,i,a,o){var s=this.attr(),u=o/2,l=s.x,c=s.y,f=s.rx,h=s.ry,v=(t-l)*(t-l),p=(e-c)*(e-c);return a&&i?vu(v,p,f+u,h+u)<=1:a?vu(v,p,f,h)<=1:i?vu(v,p,f-u,h-u)>=1&&vu(v,p,f+u,h+u)<=1:!1},n.prototype.createPath=function(t){var e=this.attr(),i=e.x,a=e.y,o=e.rx,s=e.ry;if(t.beginPath(),t.ellipse)t.ellipse(i,a,o,s,0,0,Math.PI*2,!1);else{var u=o>s?o:s,l=o>s?1:o/s,c=o>s?s/o:1;t.save(),t.translate(i,a),t.scale(l,c),t.arc(0,0,u,0,Math.PI*2),t.restore(),t.closePath()}},n}(Kr);const XR=jR;function e0(r){return r instanceof HTMLElement&&lt(r.nodeName)&&r.nodeName.toUpperCase()==="CANVAS"}var YR=function(r){R(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.getDefaultAttrs=function(){var t=r.prototype.getDefaultAttrs.call(this);return C(C({},t),{x:0,y:0,width:0,height:0})},n.prototype.initAttrs=function(t){this._setImage(t.img)},n.prototype.isStroke=function(){return!1},n.prototype.isOnlyHitBox=function(){return!0},n.prototype._afterLoading=function(){if(this.get("toDraw")===!0){var t=this.get("canvas");t?t.draw():this.createPath(this.get("context"))}},n.prototype._setImage=function(t){var e=this,i=this.attrs;if(lt(t)){var a=new Image;a.onload=function(){if(e.destroyed)return!1;e.attr("img",a),e.set("loading",!1),e._afterLoading();var o=e.get("callback");o&&o.call(e)},a.crossOrigin="Anonymous",a.src=t,this.set("loading",!0)}else t instanceof Image?(i.width||(i.width=t.width),i.height||(i.height=t.height)):e0(t)&&(i.width||(i.width=Number(t.getAttribute("width"))),i.height||(i.height,Number(t.getAttribute("height"))))},n.prototype.onAttrChange=function(t,e,i){r.prototype.onAttrChange.call(this,t,e,i),t==="img"&&this._setImage(e)},n.prototype.createPath=function(t){if(this.get("loading")){this.set("toDraw",!0),this.set("context",t);return}var e=this.attr(),i=e.x,a=e.y,o=e.width,s=e.height,u=e.sx,l=e.sy,c=e.swidth,f=e.sheight,h=e.img;(h instanceof Image||e0(h))&&(!G(u)&&!G(l)&&!G(c)&&!G(f)?t.drawImage(h,u,l,c,f,i,a,o,s):t.drawImage(h,i,a,o,s))},n}(Kr);const ZR=YR;function ei(r,n,t,e,i,a,o){var s=Math.min(r,t),u=Math.max(r,t),l=Math.min(n,e),c=Math.max(n,e),f=i/2;return a>=s-f&&a<=u+f&&o>=l-f&&o<=c+f?Le.pointToLine(r,n,t,e,a,o)<=i/2:!1}var qR=function(r){R(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.getDefaultAttrs=function(){var t=r.prototype.getDefaultAttrs.call(this);return C(C({},t),{x1:0,y1:0,x2:0,y2:0,startArrow:!1,endArrow:!1})},n.prototype.initAttrs=function(t){this.setArrow()},n.prototype.onAttrChange=function(t,e,i){r.prototype.onAttrChange.call(this,t,e,i),this.setArrow()},n.prototype.setArrow=function(){var t=this.attr(),e=t.x1,i=t.y1,a=t.x2,o=t.y2,s=t.startArrow,u=t.endArrow;s&&ip(this,t,a,o,e,i),u&&ap(this,t,e,i,a,o)},n.prototype.isInStrokeOrPath=function(t,e,i,a,o){if(!i||!o)return!1;var s=this.attr(),u=s.x1,l=s.y1,c=s.x2,f=s.y2;return ei(u,l,c,f,o,t,e)},n.prototype.createPath=function(t){var e=this.attr(),i=e.x1,a=e.y1,o=e.x2,s=e.y2,u=e.startArrow,l=e.endArrow,c={dx:0,dy:0},f={dx:0,dy:0};u&&u.d&&(c=Ki(i,a,o,s,e.startArrow.d)),l&&l.d&&(f=Ki(i,a,o,s,e.endArrow.d)),t.beginPath(),t.moveTo(i+c.dx,a+c.dy),t.lineTo(o-f.dx,s-f.dy)},n.prototype.afterDrawPath=function(t){var e=this.get("startArrowShape"),i=this.get("endArrowShape");e&&e.draw(t),i&&i.draw(t)},n.prototype.getTotalLength=function(){var t=this.attr(),e=t.x1,i=t.y1,a=t.x2,o=t.y2;return Le.length(e,i,a,o)},n.prototype.getPoint=function(t){var e=this.attr(),i=e.x1,a=e.y1,o=e.x2,s=e.y2;return Le.pointAt(i,a,o,s,t)},n}(Kr);const KR=qR;var QR={circle:function(r,n,t){return[["M",r-t,n],["A",t,t,0,1,0,r+t,n],["A",t,t,0,1,0,r-t,n]]},square:function(r,n,t){return[["M",r-t,n-t],["L",r+t,n-t],["L",r+t,n+t],["L",r-t,n+t],["Z"]]},diamond:function(r,n,t){return[["M",r-t,n],["L",r,n-t],["L",r+t,n],["L",r,n+t],["Z"]]},triangle:function(r,n,t){var e=t*Math.sin(.3333333333333333*Math.PI);return[["M",r-t,n+e],["L",r,n-e],["L",r+t,n+e],["Z"]]},"triangle-down":function(r,n,t){var e=t*Math.sin(.3333333333333333*Math.PI);return[["M",r-t,n-e],["L",r+t,n-e],["L",r,n+e],["Z"]]}},JR=function(r){R(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.initAttrs=function(t){this._resetParamsCache()},n.prototype._resetParamsCache=function(){this.set("paramsCache",{})},n.prototype.onAttrChange=function(t,e,i){r.prototype.onAttrChange.call(this,t,e,i),["symbol","x","y","r","radius"].indexOf(t)!==-1&&this._resetParamsCache()},n.prototype.isOnlyHitBox=function(){return!0},n.prototype._getR=function(t){return G(t.r)?t.radius:t.r},n.prototype._getPath=function(){var t=this.attr(),e=t.x,i=t.y,a=t.symbol||"circle",o=this._getR(t),s,u;if(rt(a))s=a,u=s(e,i,o),u=PE(u);else{if(s=n.Symbols[a],!s)return console.warn(a+" marker is not supported."),null;u=s(e,i,o)}return u},n.prototype.createPath=function(t){var e=this._getPath(),i=this.get("paramsCache");fb(this,t,{path:e},i)},n.Symbols=QR,n}(Kr);const tI=JR;function vb(r,n,t){var e=Wl();return r.createPath(e),e.isPointInPath(n,t)}var eI=1e-6;function nf(r){return Math.abs(r)<eI?0:r<0?-1:1}function rI(r,n,t){return(t[0]-r[0])*(n[1]-r[1])===(n[0]-r[0])*(t[1]-r[1])&&Math.min(r[0],n[0])<=t[0]&&t[0]<=Math.max(r[0],n[0])&&Math.min(r[1],n[1])<=t[1]&&t[1]<=Math.max(r[1],n[1])}function pb(r,n,t){var e=!1,i=r.length;if(i<=2)return!1;for(var a=0;a<i;a++){var o=r[a],s=r[(a+1)%i];if(rI(o,s,[n,t]))return!0;nf(o[1]-t)>0!=nf(s[1]-t)>0&&nf(n-(t-o[1])*(o[0]-s[0])/(o[1]-s[1])-o[0])<0&&(e=!e)}return e}function Go(r,n,t,e,i,a,o,s){var u=(Math.atan2(s-n,o-r)+Math.PI*2)%(Math.PI*2);if(u<e||u>i)return!1;var l={x:r+t*Math.cos(u),y:n+t*Math.sin(u)};return ab(l.x,l.y,o,s)<=a/2}var nI=ve;function iI(r){for(var n=!1,t=r.length,e=0;e<t;e++){var i=r[e],a=i[0];if(a==="C"||a==="A"||a==="Q"){n=!0;break}}return n}function aI(r,n,t,e,i){for(var a=!1,o=n/2,s=0;s<r.length;s++){var u=r[s],l=u.currentPoint,c=u.params,f=u.prePoint,h=u.box;if(!(h&&!Hi(h.x-o,h.y-o,h.width+n,h.height+n,t,e))){switch(u.command){case"L":case"Z":a=ei(f[0],f[1],l[0],l[1],n,t,e);break;case"Q":var v=OE.pointDistance(f[0],f[1],c[1],c[2],c[3],c[4],t,e);a=v<=n/2;break;case"C":var p=Zo.pointDistance(f[0],f[1],c[1],c[2],c[3],c[4],c[5],c[6],t,e,i);a=p<=n/2;break;case"A":var d=u.arcParams,g=d.cx,y=d.cy,m=d.rx,x=d.ry,_=d.startAngle,E=d.endAngle,b=d.xRotation,M=[t,e,1],T=m>x?m:x,k=m>x?1:m/x,L=m>x?x/m:1,O=nI(null,[["t",-g,-y],["r",-b],["s",1/k,1/L]]);os(M,M,O),a=Go(0,0,T,_,E,n,M[0],M[1]);break}if(a)break}}return a}function oI(r){for(var n=r.length,t=[],e=[],i=[],a=0;a<n;a++){var o=r[a],s=o[0];s==="M"?(i.length&&(e.push(i),i=[]),i.push([o[1],o[2]])):s==="Z"?i.length&&(t.push(i),i=[]):i.push([o[1],o[2]])}return i.length>0&&e.push(i),{polygons:t,polylines:e}}const pu=C({hasArc:iI,extractPolygons:oI,isPointInStroke:aI},Lv);function r0(r,n,t){for(var e=!1,i=0;i<r.length;i++){var a=r[i];if(e=pb(a,n,t),e)break}return e}var sI=function(r){R(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.getDefaultAttrs=function(){var t=r.prototype.getDefaultAttrs.call(this);return C(C({},t),{startArrow:!1,endArrow:!1})},n.prototype.initAttrs=function(t){this._setPathArr(t.path),this.setArrow()},n.prototype.onAttrChange=function(t,e,i){r.prototype.onAttrChange.call(this,t,e,i),t==="path"&&this._setPathArr(e),this.setArrow()},n.prototype._setPathArr=function(t){this.attrs.path=PE(t);var e=pu.hasArc(t);this.set("hasArc",e),this.set("paramsCache",{}),this.set("segments",null),this.set("curve",null),this.set("tCache",null),this.set("totalLength",null)},n.prototype.getSegments=function(){var t=this.get("segements");return t||(t=BE(this.attr("path")),this.set("segments",t)),t},n.prototype.setArrow=function(){var t=this.attr(),e=t.startArrow,i=t.endArrow;if(e){var a=this.getStartTangent();ip(this,t,a[0][0],a[0][1],a[1][0],a[1][1])}if(i){var a=this.getEndTangent();ap(this,t,a[0][0],a[0][1],a[1][0],a[1][1])}},n.prototype.isInStrokeOrPath=function(t,e,i,a,o){var s=this.getSegments(),u=this.get("hasArc"),l=!1;if(i){var c=this.getTotalLength();l=pu.isPointInStroke(s,o,t,e,c)}if(!l&&a)if(u)l=vb(this,t,e);else{var f=this.attr("path"),h=pu.extractPolygons(f);l=r0(h.polygons,t,e)||r0(h.polylines,t,e)}return l},n.prototype.createPath=function(t){var e=this.attr(),i=this.get("paramsCache");fb(this,t,e,i)},n.prototype.afterDrawPath=function(t){var e=this.get("startArrowShape"),i=this.get("endArrowShape");e&&e.draw(t),i&&i.draw(t)},n.prototype.getTotalLength=function(){var t=this.get("totalLength");return G(t)?(this._calculateCurve(),this._setTcache(),this.get("totalLength")):t},n.prototype.getPoint=function(t){var e=this.get("tCache");e||(this._calculateCurve(),this._setTcache(),e=this.get("tCache"));var i,a,o=this.get("curve");if(!e||e.length===0)return o?{x:o[0][1],y:o[0][2]}:null;w(e,function(c,f){t>=c[0]&&t<=c[1]&&(i=(t-c[0])/(c[1]-c[0]),a=f)});var s=o[a];if(G(s)||G(a))return null;var u=s.length,l=o[a+1];return Zo.pointAt(s[u-2],s[u-1],l[1],l[2],l[3],l[4],l[5],l[6],i)},n.prototype._calculateCurve=function(){var t=this.attr().path;this.set("curve",pu.pathToCurve(t))},n.prototype._setTcache=function(){var t=0,e=0,i=[],a,o,s,u,l=this.get("curve");if(!!l){if(w(l,function(c,f){s=l[f+1],u=c.length,s&&(t+=Zo.length(c[u-2],c[u-1],s[1],s[2],s[3],s[4],s[5],s[6])||0)}),this.set("totalLength",t),t===0){this.set("tCache",[]);return}w(l,function(c,f){s=l[f+1],u=c.length,s&&(a=[],a[0]=e/t,o=Zo.length(c[u-2],c[u-1],s[1],s[2],s[3],s[4],s[5],s[6]),e+=o||0,a[1]=e/t,i.push(a))}),this.set("tCache",i)}},n.prototype.getStartTangent=function(){var t=this.getSegments(),e;if(t.length>1){var i=t[0].currentPoint,a=t[1].currentPoint,o=t[1].startTangent;e=[],o?(e.push([i[0]-o[0],i[1]-o[1]]),e.push([i[0],i[1]])):(e.push([a[0],a[1]]),e.push([i[0],i[1]]))}return e},n.prototype.getEndTangent=function(){var t=this.getSegments(),e=t.length,i;if(e>1){var a=t[e-2].currentPoint,o=t[e-1].currentPoint,s=t[e-1].endTangent;i=[],s?(i.push([o[0]-s[0],o[1]-s[1]]),i.push([o[0],o[1]])):(i.push([a[0],a[1]]),i.push([o[0],o[1]]))}return i},n}(Kr);const up=sI;function db(r,n,t,e,i){var a=r.length;if(a<2)return!1;for(var o=0;o<a-1;o++){var s=r[o][0],u=r[o][1],l=r[o+1][0],c=r[o+1][1];if(ei(s,u,l,c,n,t,e))return!0}if(i){var f=r[0],h=r[a-1];if(ei(f[0],f[1],h[0],h[1],n,t,e))return!0}return!1}var uI=function(r){R(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.isInStrokeOrPath=function(t,e,i,a,o){var s=this.attr().points,u=!1;return i&&(u=db(s,o,t,e,!0)),!u&&a&&(u=pb(s,t,e)),u},n.prototype.createPath=function(t){var e=this.attr(),i=e.points;if(!(i.length<2)){t.beginPath();for(var a=0;a<i.length;a++){var o=i[a];a===0?t.moveTo(o[0],o[1]):t.lineTo(o[0],o[1])}t.closePath()}},n}(Kr);const lI=uI;var cI=function(r){R(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.getDefaultAttrs=function(){var t=r.prototype.getDefaultAttrs.call(this);return C(C({},t),{startArrow:!1,endArrow:!1})},n.prototype.initAttrs=function(t){this.setArrow()},n.prototype.onAttrChange=function(t,e,i){r.prototype.onAttrChange.call(this,t,e,i),this.setArrow(),["points"].indexOf(t)!==-1&&this._resetCache()},n.prototype._resetCache=function(){this.set("totalLength",null),this.set("tCache",null)},n.prototype.setArrow=function(){var t=this.attr(),e=this.attrs,i=e.points,a=e.startArrow,o=e.endArrow,s=i.length,u=i[0][0],l=i[0][1],c=i[s-1][0],f=i[s-1][1];a&&ip(this,t,i[1][0],i[1][1],u,l),o&&ap(this,t,i[s-2][0],i[s-2][1],c,f)},n.prototype.isFill=function(){return!1},n.prototype.isInStrokeOrPath=function(t,e,i,a,o){if(!i||!o)return!1;var s=this.attr().points;return db(s,o,t,e,!1)},n.prototype.isStroke=function(){return!0},n.prototype.createPath=function(t){var e=this.attr(),i=e.points,a=e.startArrow,o=e.endArrow,s=i.length;if(!(i.length<2)){var u=i[0][0],l=i[0][1],c=i[s-1][0],f=i[s-1][1];if(a&&a.d){var h=Ki(u,l,i[1][0],i[1][1],a.d);u+=h.dx,l+=h.dy}if(o&&o.d){var h=Ki(i[s-2][0],i[s-2][1],c,f,o.d);c-=h.dx,f-=h.dy}t.beginPath(),t.moveTo(u,l);for(var v=0;v<s-1;v++){var p=i[v];t.lineTo(p[0],p[1])}t.lineTo(c,f)}},n.prototype.afterDrawPath=function(t){var e=this.get("startArrowShape"),i=this.get("endArrowShape");e&&e.draw(t),i&&i.draw(t)},n.prototype.getTotalLength=function(){var t=this.attr().points,e=this.get("totalLength");return G(e)?(this.set("totalLength",DE.length(t)),this.get("totalLength")):e},n.prototype.getPoint=function(t){var e=this.attr().points,i=this.get("tCache");i||(this._setTcache(),i=this.get("tCache"));var a,o;return w(i,function(s,u){t>=s[0]&&t<=s[1]&&(a=(t-s[0])/(s[1]-s[0]),o=u)}),Le.pointAt(e[o][0],e[o][1],e[o+1][0],e[o+1][1],a)},n.prototype._setTcache=function(){var t=this.attr().points;if(!(!t||t.length===0)){var e=this.getTotalLength();if(!(e<=0)){var i=0,a=[],o,s;w(t,function(u,l){t[l+1]&&(o=[],o[0]=i/e,s=Le.length(u[0],u[1],t[l+1][0],t[l+1][1]),i+=s,o[1]=i/e,a.push(o))}),this.set("tCache",a)}}},n.prototype.getStartTangent=function(){var t=this.attr().points,e=[];return e.push([t[1][0],t[1][1]]),e.push([t[0][0],t[0][1]]),e},n.prototype.getEndTangent=function(){var t=this.attr().points,e=t.length-1,i=[];return i.push([t[e-1][0],t[e-1][1]]),i.push([t[e][0],t[e][1]]),i},n}(Kr);const fI=cI;function hI(r,n,t,e,i,a,o){var s=i/2;return Hi(r-s,n-s,t,i,a,o)||Hi(r+t-s,n-s,i,e,a,o)||Hi(r+s,n+e-s,t,i,a,o)||Hi(r-s,n+s,i,e,a,o)}function vI(r,n,t,e,i,a,o,s){return ei(r+i,n,r+t-i,n,a,o,s)||ei(r+t,n+i,r+t,n+e-i,a,o,s)||ei(r+t-i,n+e,r+i,n+e,a,o,s)||ei(r,n+e-i,r,n+i,a,o,s)||Go(r+t-i,n+i,i,1.5*Math.PI,2*Math.PI,a,o,s)||Go(r+t-i,n+e-i,i,0,.5*Math.PI,a,o,s)||Go(r+i,n+e-i,i,.5*Math.PI,Math.PI,a,o,s)||Go(r+i,n+i,i,Math.PI,1.5*Math.PI,a,o,s)}var pI=function(r){R(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.getDefaultAttrs=function(){var t=r.prototype.getDefaultAttrs.call(this);return C(C({},t),{x:0,y:0,width:0,height:0,radius:0})},n.prototype.isInStrokeOrPath=function(t,e,i,a,o){var s=this.attr(),u=s.x,l=s.y,c=s.width,f=s.height,h=s.radius;if(h){var p=!1;return i&&(p=vI(u,l,c,f,h,o,t,e)),!p&&a&&(p=vb(this,t,e)),p}else{var v=o/2;if(a&&i)return Hi(u-v,l-v,c+v,f+v,t,e);if(a)return Hi(u,l,c,f,t,e);if(i)return hI(u,l,c,f,o,t,e)}},n.prototype.createPath=function(t){var e=this.attr(),i=e.x,a=e.y,o=e.width,s=e.height,u=e.radius;if(t.beginPath(),u===0)t.rect(i,a,o,s);else{var l=BR(u),c=l[0],f=l[1],h=l[2],v=l[3];t.moveTo(i+c,a),t.lineTo(i+o-f,a),f!==0&&t.arc(i+o-f,a+f,f,-Math.PI/2,0),t.lineTo(i+o,a+s-h),h!==0&&t.arc(i+o-h,a+s-h,h,0,Math.PI/2),t.lineTo(i+v,a+s),v!==0&&t.arc(i+v,a+s-v,v,Math.PI/2,Math.PI),t.lineTo(i,a+c),c!==0&&t.arc(i+c,a+c,c,Math.PI,Math.PI*1.5),t.closePath()}},n}(Kr);const dI=pI;var gI=function(r){R(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.getDefaultAttrs=function(){var t=r.prototype.getDefaultAttrs.call(this);return C(C({},t),{x:0,y:0,text:null,fontSize:12,fontFamily:"sans-serif",fontStyle:"normal",fontWeight:"normal",fontVariant:"normal",textAlign:"start",textBaseline:"bottom"})},n.prototype.isOnlyHitBox=function(){return!0},n.prototype.initAttrs=function(t){this._assembleFont(),t.text&&this._setText(t.text)},n.prototype._assembleFont=function(){var t=this.attrs;t.font=Xl(t)},n.prototype._setText=function(t){var e=null;lt(t)&&t.indexOf(`
`)!==-1&&(e=t.split(`
`)),this.set("textArr",e)},n.prototype.onAttrChange=function(t,e,i){r.prototype.onAttrChange.call(this,t,e,i),t.startsWith("font")&&this._assembleFont(),t==="text"&&this._setText(e)},n.prototype._getSpaceingY=function(){var t=this.attrs,e=t.lineHeight,i=t.fontSize*1;return e?e-i:i*.14},n.prototype._drawTextArr=function(t,e,i){var a=this.attrs,o=a.textBaseline,s=a.x,u=a.y,l=a.fontSize*1,c=this._getSpaceingY(),f=jl(a.text,a.fontSize,a.lineHeight),h;w(e,function(v,p){h=u+p*(c+l)-f+l,o==="middle"&&(h+=f-l-(f-l)/2),o==="top"&&(h+=f-l),G(v)||(i?t.fillText(v,s,h):t.strokeText(v,s,h))})},n.prototype._drawText=function(t,e){var i=this.attr(),a=i.x,o=i.y,s=this.get("textArr");if(s)this._drawTextArr(t,s,e);else{var u=i.text;G(u)||(e?t.fillText(u,a,o):t.strokeText(u,a,o))}},n.prototype.strokeAndFill=function(t){var e=this.attrs,i=e.lineWidth,a=e.opacity,o=e.strokeOpacity,s=e.fillOpacity;this.isStroke()&&i>0&&(!G(o)&&o!==1&&(t.globalAlpha=a),this.stroke(t)),this.isFill()&&(!G(s)&&s!==1?(t.globalAlpha=s,this.fill(t),t.globalAlpha=a):this.fill(t)),this.afterDrawPath(t)},n.prototype.fill=function(t){this._drawText(t,!0)},n.prototype.stroke=function(t){this._drawText(t,!1)},n}(Kr);const yI=gI;function mI(r,n){if(n){var t=zl(n);return Sn(t,r)}return r}function gb(r,n,t){var e=r.getTotalMatrix();if(e){var i=mI([n,t,1],e),a=i[0],o=i[1];return[a,o]}return[n,t]}function n0(r,n,t){if(r.isCanvas&&r.isCanvas())return!0;if(!ss(r)||r.cfg.isInView===!1)return!1;if(r.cfg.clipShape){var e=gb(r,n,t),i=e[0],a=e[1];if(r.isClipped(i,a))return!1}var o=r.cfg.cacheCanvasBBox||r.getCanvasBBox();return n>=o.minX&&n<=o.maxX&&t>=o.minY&&t<=o.maxY}function yb(r,n,t){if(!n0(r,n,t))return null;for(var e=null,i=r.getChildren(),a=i.length,o=a-1;o>=0;o--){var s=i[o];if(s.isGroup())e=yb(s,n,t);else if(n0(s,n,t)){var u=s,l=gb(s,n,t),c=l[0],f=l[1];u.isInShape(c,f)&&(e=s)}if(e)break}return e}var xI=function(r){R(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.getDefaultCfg=function(){var t=r.prototype.getDefaultCfg.call(this);return t.renderer="canvas",t.autoDraw=!0,t.localRefresh=!0,t.refreshElements=[],t.clipView=!0,t.quickHit=!1,t},n.prototype.onCanvasChange=function(t){(t==="attr"||t==="sort"||t==="changeSize")&&(this.set("refreshElements",[this]),this.draw())},n.prototype.getShapeBase=function(){return Rl},n.prototype.getGroupBase=function(){return sp},n.prototype.getPixelRatio=function(){var t=this.get("pixelRatio")||wR();return t>=1?Math.ceil(t):1},n.prototype.getViewRange=function(){return{minX:0,minY:0,maxX:this.cfg.width,maxY:this.cfg.height}},n.prototype.createDom=function(){var t=document.createElement("canvas"),e=t.getContext("2d");return this.set("context",e),t},n.prototype.setDOMSize=function(t,e){r.prototype.setDOMSize.call(this,t,e);var i=this.get("context"),a=this.get("el"),o=this.getPixelRatio();a.width=o*t,a.height=o*e,o>1&&i.scale(o,o)},n.prototype.clear=function(){r.prototype.clear.call(this),this._clearFrame();var t=this.get("context"),e=this.get("el");t.clearRect(0,0,e.width,e.height)},n.prototype.getShape=function(t,e){var i;return this.get("quickHit")?i=yb(this,t,e):i=r.prototype.getShape.call(this,t,e,null),i},n.prototype._getRefreshRegion=function(){var t=this.get("refreshElements"),e=this.getViewRange(),i;if(t.length&&t[0]===this)i=e;else if(i=HR(t),i){i.minX=Math.floor(i.minX),i.minY=Math.floor(i.minY),i.maxX=Math.ceil(i.maxX),i.maxY=Math.ceil(i.maxY),i.maxY+=1;var a=this.get("clipView");a&&(i=$R(i,e))}return i},n.prototype.refreshElement=function(t){var e=this.get("refreshElements");e.push(t)},n.prototype._clearFrame=function(){var t=this.get("drawFrame");t&&(Fw(t),this.set("drawFrame",null),this.set("refreshElements",[]))},n.prototype.draw=function(){var t=this.get("drawFrame");this.get("autoDraw")&&t||this._startDraw()},n.prototype._drawAll=function(){var t=this.get("context"),e=this.get("el"),i=this.getChildren();t.clearRect(0,0,e.width,e.height),to(t,this),Sh(t,i),this.set("refreshElements",[])},n.prototype._drawRegion=function(){var t=this.get("context"),e=this.get("refreshElements"),i=this.getChildren(),a=this._getRefreshRegion();a?(t.clearRect(a.minX,a.minY,a.maxX-a.minX,a.maxY-a.minY),t.save(),t.beginPath(),t.rect(a.minX,a.minY,a.maxX-a.minX,a.maxY-a.minY),t.clip(),to(t,this),NR(this,i,a),Sh(t,i,a),t.restore()):e.length&&cb(e),w(e,function(o){o.get("hasChanged")&&o.set("hasChanged",!1)}),this.set("refreshElements",[])},n.prototype._startDraw=function(){var t=this,e=this.get("drawFrame");e||(e=Lw(function(){t.get("localRefresh")?t._drawRegion():t._drawAll(),t.set("drawFrame",null)}),this.set("drawFrame",e))},n.prototype.skipDraw=function(){},n.prototype.removeDom=function(){var t=this.get("el");t.width=0,t.height=0,t.parentNode.removeChild(t)},n}(Ul),_I="0.5.12";const CI=Object.freeze(Object.defineProperty({__proto__:null,Shape:Rl,version:_I,Canvas:xI,Group:sp,getArcParams:hl,Event:Bs,Base:Nl,AbstractCanvas:Ul,AbstractGroup:Hl,AbstractShape:$l,getBBoxMethod:Gl,registerBBox:Dr,getTextHeight:jl,assembleFont:Xl,isAllowCapture:ss,multiplyVec2:Sn,invert:zl,getOffScreenContext:Wl,registerEasing:TE,PathUtil:Lv},Symbol.toStringTag,{value:"Module"}));var Ah={rect:"path",circle:"circle",line:"line",path:"path",marker:"path",text:"text",polyline:"polyline",polygon:"polygon",image:"image",ellipse:"ellipse",dom:"foreignObject"},Rt={opacity:"opacity",fillStyle:"fill",fill:"fill",fillOpacity:"fill-opacity",strokeStyle:"stroke",strokeOpacity:"stroke-opacity",stroke:"stroke",x:"x",y:"y",r:"r",rx:"rx",ry:"ry",width:"width",height:"height",x1:"x1",x2:"x2",y1:"y1",y2:"y2",lineCap:"stroke-linecap",lineJoin:"stroke-linejoin",lineWidth:"stroke-width",lineDash:"stroke-dasharray",lineDashOffset:"stroke-dashoffset",miterLimit:"stroke-miterlimit",font:"font",fontSize:"font-size",fontStyle:"font-style",fontVariant:"font-variant",fontWeight:"font-weight",fontFamily:"font-family",startArrow:"marker-start",endArrow:"marker-end",path:"d",class:"class",id:"id",style:"style",preserveAspectRatio:"preserveAspectRatio"};function Rr(r){return document.createElementNS("http://www.w3.org/2000/svg",r)}function mb(r){var n=Ah[r.type],t=r.getParent();if(!n)throw new Error("the type "+r.type+" is not supported by svg");var e=Rr(n);if(r.get("id")&&(e.id=r.get("id")),r.set("el",e),r.set("attrs",{}),t){var i=t.get("el");i||(i=t.createDom(),t.set("el",i)),i.appendChild(e)}return e}function xb(r,n){var t=r.get("el"),e=Pw(t.children).sort(n),i=document.createDocumentFragment();e.forEach(function(a){i.appendChild(a)}),t.appendChild(i)}function EI(r,n){var t=r.parentNode,e=Array.from(t.childNodes).filter(function(s){return s.nodeType===1&&s.nodeName.toLowerCase()!=="defs"}),i=e[n],a=e.indexOf(r);if(i){if(a>n)t.insertBefore(r,i);else if(a<n){var o=e[n+1];o?t.insertBefore(r,o):t.appendChild(r)}}else t.appendChild(r)}function SI(r,n){var t=r.cfg.el,e=r.attr(),i={dx:e.shadowOffsetX,dy:e.shadowOffsetY,blur:e.shadowBlur,color:e.shadowColor};if(!i.dx&&!i.dy&&!i.blur&&!i.color)t.removeAttribute("filter");else{var a=n.find("filter",i);a||(a=n.addShadow(i)),t.setAttribute("filter","url(#"+a+")")}}function Ws(r){var n=r.attr().matrix;if(n){for(var t=r.cfg.el,e=[],i=0;i<9;i+=3)e.push(n[i]+","+n[i+1]);e=e.join(","),e.indexOf("NaN")===-1?t.setAttribute("transform","matrix("+e+")"):console.warn("invalid matrix:",n)}}function ms(r,n){var t=r.getClip(),e=r.get("el");if(!t)e.removeAttribute("clip-path");else if(t&&!e.hasAttribute("clip-path")){mb(t),t.createPath(n);var i=n.addClip(t);e.setAttribute("clip-path","url(#"+i+")")}}function _b(r,n){n.forEach(function(t){t.draw(r)})}function Cb(r,n){var t=r.get("canvas");if(t&&t.get("autoDraw")){var e=t.get("context"),i=r.getParent(),a=i?i.getChildren():[t],o=r.get("el");if(n==="remove"){var s=r.get("isClipShape");if(s){var u=o&&o.parentNode,l=u&&u.parentNode;u&&l&&l.removeChild(u)}else o&&o.parentNode&&o.parentNode.removeChild(o)}else if(n==="show")o.setAttribute("visibility","visible");else if(n==="hide")o.setAttribute("visibility","hidden");else if(n==="zIndex")EI(o,a.indexOf(r));else if(n==="sort"){var c=r.get("children");c&&c.length&&xb(r,function(f,h){return c.indexOf(f)-c.indexOf(h)?1:0})}else n==="clear"?o&&(o.innerHTML=""):n==="matrix"?Ws(r):n==="clip"?ms(r,e):n==="attr"||n==="add"&&r.draw(e)}}var lp=function(r){R(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.isEntityGroup=function(){return!0},n.prototype.createDom=function(){var t=Rr("g");this.set("el",t);var e=this.getParent();if(e){var i=e.get("el");i||(i=e.createDom(),e.set("el",i)),i.appendChild(t)}return t},n.prototype.afterAttrsChange=function(t){r.prototype.afterAttrsChange.call(this,t);var e=this.get("canvas");if(e&&e.get("autoDraw")){var i=e.get("context");this.createPath(i,t)}},n.prototype.onCanvasChange=function(t){Cb(this,t)},n.prototype.getShapeBase=function(){return Il},n.prototype.getGroupBase=function(){return n},n.prototype.draw=function(t){var e=this.getChildren(),i=this.get("el");this.get("destroyed")?i&&i.parentNode.removeChild(i):(i||this.createDom(),ms(this,t),this.createPath(t),e.length&&_b(t,e))},n.prototype.createPath=function(t,e){var i=this.attr(),a=this.get("el");w(e||i,function(o,s){Rt[s]&&a.setAttribute(Rt[s],o)}),Ws(this)},n}(Hl),bI=function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.type="svg",t.canFill=!1,t.canStroke=!1,t}return n.prototype.getDefaultAttrs=function(){var t=r.prototype.getDefaultAttrs.call(this);return C(C({},t),{lineWidth:1,lineAppendWidth:0,strokeOpacity:1,fillOpacity:1})},n.prototype.afterAttrsChange=function(t){r.prototype.afterAttrsChange.call(this,t);var e=this.get("canvas");if(e&&e.get("autoDraw")){var i=e.get("context");this.draw(i,t)}},n.prototype.getShapeBase=function(){return Il},n.prototype.getGroupBase=function(){return lp},n.prototype.onCanvasChange=function(t){Cb(this,t)},n.prototype.calculateBBox=function(){var t=this.get("el"),e=null;if(t)e=t.getBBox();else{var i=Gl(this.get("type"));i&&(e=i(this))}if(e){var a=e.x,o=e.y,s=e.width,u=e.height,l=this.getHitLineWidth(),c=l/2,f=a-c,h=o-c,v=a+s+c,p=o+u+c;return{x:f,y:h,minX:f,minY:h,maxX:v,maxY:p,width:s+l,height:u+l}}return{x:0,y:0,minX:0,minY:0,maxX:0,maxY:0,width:0,height:0}},n.prototype.isFill=function(){var t=this.attr(),e=t.fill,i=t.fillStyle;return(e||i||this.isClipShape())&&this.canFill},n.prototype.isStroke=function(){var t=this.attr(),e=t.stroke,i=t.strokeStyle;return(e||i)&&this.canStroke},n.prototype.draw=function(t,e){var i=this.get("el");this.get("destroyed")?i&&i.parentNode.removeChild(i):(i||mb(this),ms(this,t),this.createPath(t,e),this.shadow(t,e),this.strokeAndFill(t,e),this.transform(e))},n.prototype.createPath=function(t,e){},n.prototype.strokeAndFill=function(t,e){var i=e||this.attr(),a=i.fill,o=i.fillStyle,s=i.stroke,u=i.strokeStyle,l=i.fillOpacity,c=i.strokeOpacity,f=i.lineWidth,h=this.get("el");this.canFill&&(e?"fill"in i?this._setColor(t,"fill",a):"fillStyle"in i&&this._setColor(t,"fill",o):this._setColor(t,"fill",a||o),l&&h.setAttribute(Rt.fillOpacity,l)),this.canStroke&&f>0&&(e?"stroke"in i?this._setColor(t,"stroke",s):"strokeStyle"in i&&this._setColor(t,"stroke",u):this._setColor(t,"stroke",s||u),c&&h.setAttribute(Rt.strokeOpacity,c),f&&h.setAttribute(Rt.lineWidth,f))},n.prototype._setColor=function(t,e,i){var a=this.get("el");if(!i){a.setAttribute(Rt[e],"none");return}if(i=i.trim(),/^[r,R,L,l]{1}[\s]*\(/.test(i)){var o=t.find("gradient",i);o||(o=t.addGradient(i)),a.setAttribute(Rt[e],"url(#"+o+")")}else if(/^[p,P]{1}[\s]*\(/.test(i)){var o=t.find("pattern",i);o||(o=t.addPattern(i)),a.setAttribute(Rt[e],"url(#"+o+")")}else a.setAttribute(Rt[e],i)},n.prototype.shadow=function(t,e){var i=this.attr(),a=e||i,o=a.shadowOffsetX,s=a.shadowOffsetY,u=a.shadowBlur,l=a.shadowColor;(o||s||u||l)&&SI(this,t)},n.prototype.transform=function(t){var e=this.attr(),i=(t||e).matrix;i&&Ws(this)},n.prototype.isInShape=function(t,e){return this.isPointInPath(t,e)},n.prototype.isPointInPath=function(t,e){var i=this.get("el"),a=this.get("canvas"),o=a.get("el").getBoundingClientRect(),s=t+o.left,u=e+o.top,l=document.elementFromPoint(s,u);return!!(l&&l.isEqualNode(i))},n.prototype.getHitLineWidth=function(){var t=this.attrs,e=t.lineWidth,i=t.lineAppendWidth;return this.isStroke()?e+i:0},n}($l);const Pr=bI;var AI=function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.type="circle",t.canFill=!0,t.canStroke=!0,t}return n.prototype.getDefaultAttrs=function(){var t=r.prototype.getDefaultAttrs.call(this);return C(C({},t),{x:0,y:0,r:0})},n.prototype.createPath=function(t,e){var i=this.attr(),a=this.get("el");w(e||i,function(o,s){s==="x"||s==="y"?a.setAttribute("c"+s,o):Rt[s]&&a.setAttribute(Rt[s],o)})},n}(Pr);const TI=AI;var MI=function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.type="dom",t.canFill=!1,t.canStroke=!1,t}return n.prototype.createPath=function(t,e){var i=this.attr(),a=this.get("el");if(w(e||i,function(l,c){Rt[c]&&a.setAttribute(Rt[c],l)}),typeof i.html=="function"){var o=i.html.call(this,i);if(o instanceof Element||o instanceof HTMLDocument){for(var s=a.childNodes,u=s.length-1;u>=0;u--)a.removeChild(s[u]);a.appendChild(o)}else a.innerHTML=o}else a.innerHTML=i.html},n}(Pr);const wI=MI;var LI=function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.type="ellipse",t.canFill=!0,t.canStroke=!0,t}return n.prototype.getDefaultAttrs=function(){var t=r.prototype.getDefaultAttrs.call(this);return C(C({},t),{x:0,y:0,rx:0,ry:0})},n.prototype.createPath=function(t,e){var i=this.attr(),a=this.get("el");w(e||i,function(o,s){s==="x"||s==="y"?a.setAttribute("c"+s,o):Rt[s]&&a.setAttribute(Rt[s],o)})},n}(Pr);const FI=LI;var kI=function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.type="image",t.canFill=!1,t.canStroke=!1,t}return n.prototype.getDefaultAttrs=function(){var t=r.prototype.getDefaultAttrs.call(this);return C(C({},t),{x:0,y:0,width:0,height:0})},n.prototype.createPath=function(t,e){var i=this,a=this.attr(),o=this.get("el");w(e||a,function(s,u){u==="img"?i._setImage(a.img):Rt[u]&&o.setAttribute(Rt[u],s)})},n.prototype.setAttr=function(t,e){this.attrs[t]=e,t==="img"&&this._setImage(e)},n.prototype._setImage=function(t){var e=this.attr(),i=this.get("el");if(lt(t))i.setAttribute("href",t);else if(t instanceof window.Image)e.width||(i.setAttribute("width",t.width),this.attr("width",t.width)),e.height||(i.setAttribute("height",t.height),this.attr("height",t.height)),i.setAttribute("href",t.src);else if(t instanceof HTMLElement&&lt(t.nodeName)&&t.nodeName.toUpperCase()==="CANVAS")i.setAttribute("href",t.toDataURL());else if(t instanceof ImageData){var a=document.createElement("canvas");a.setAttribute("width",""+t.width),a.setAttribute("height",""+t.height),a.getContext("2d").putImageData(t,0,0),e.width||(i.setAttribute("width",""+t.width),this.attr("width",t.width)),e.height||(i.setAttribute("height",""+t.height),this.attr("height",t.height)),i.setAttribute("href",a.toDataURL())}},n}(Pr);const OI=kI;var RI=function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.type="line",t.canFill=!1,t.canStroke=!0,t}return n.prototype.getDefaultAttrs=function(){var t=r.prototype.getDefaultAttrs.call(this);return C(C({},t),{x1:0,y1:0,x2:0,y2:0,startArrow:!1,endArrow:!1})},n.prototype.createPath=function(t,e){var i=this.attr(),a=this.get("el");w(e||i,function(o,s){if(s==="startArrow"||s==="endArrow")if(o){var u=wt(o)?t.addArrow(i,Rt[s]):t.getDefaultArrow(i,Rt[s]);a.setAttribute(Rt[s],"url(#"+u+")")}else a.removeAttribute(Rt[s]);else Rt[s]&&a.setAttribute(Rt[s],o)})},n.prototype.getTotalLength=function(){var t=this.attr(),e=t.x1,i=t.y1,a=t.x2,o=t.y2;return Le.length(e,i,a,o)},n.prototype.getPoint=function(t){var e=this.attr(),i=e.x1,a=e.y1,o=e.x2,s=e.y2;return Le.pointAt(i,a,o,s,t)},n}(Pr);const II=RI;var du={circle:function(r,n,t){return[["M",r,n],["m",-t,0],["a",t,t,0,1,0,t*2,0],["a",t,t,0,1,0,-t*2,0]]},square:function(r,n,t){return[["M",r-t,n-t],["L",r+t,n-t],["L",r+t,n+t],["L",r-t,n+t],["Z"]]},diamond:function(r,n,t){return[["M",r-t,n],["L",r,n-t],["L",r+t,n],["L",r,n+t],["Z"]]},triangle:function(r,n,t){var e=t*Math.sin(.3333333333333333*Math.PI);return[["M",r-t,n+e],["L",r,n-e],["L",r+t,n+e],["z"]]},triangleDown:function(r,n,t){var e=t*Math.sin(.3333333333333333*Math.PI);return[["M",r-t,n-e],["L",r+t,n-e],["L",r,n+e],["Z"]]}};const i0={get:function(r){return du[r]},register:function(r,n){du[r]=n},remove:function(r){delete du[r]},getAll:function(){return du}};var DI=function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.type="marker",t.canFill=!0,t.canStroke=!0,t}return n.prototype.createPath=function(t){var e=this.get("el");e.setAttribute("d",this._assembleMarker())},n.prototype._assembleMarker=function(){var t=this._getPath();return V(t)?t.map(function(e){return e.join(" ")}).join(""):t},n.prototype._getPath=function(){var t=this.attr(),e=t.x,i=t.y,a=t.r||t.radius,o=t.symbol||"circle",s;return rt(o)?s=o:s=i0.get(o),s?s(e,i,a):(console.warn(s+" symbol is not exist."),null)},n.symbolsFactory=i0,n}(Pr);const PI=DI;var BI=function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.type="path",t.canFill=!0,t.canStroke=!0,t}return n.prototype.getDefaultAttrs=function(){var t=r.prototype.getDefaultAttrs.call(this);return C(C({},t),{startArrow:!1,endArrow:!1})},n.prototype.createPath=function(t,e){var i=this,a=this.attr(),o=this.get("el");w(e||a,function(s,u){if(u==="path"&&V(s))o.setAttribute("d",i._formatPath(s));else if(u==="startArrow"||u==="endArrow")if(s){var l=wt(s)?t.addArrow(a,Rt[u]):t.getDefaultArrow(a,Rt[u]);o.setAttribute(Rt[u],"url(#"+l+")")}else o.removeAttribute(Rt[u]);else Rt[u]&&o.setAttribute(Rt[u],s)})},n.prototype._formatPath=function(t){var e=t.map(function(i){return i.join(" ")}).join("");return~e.indexOf("NaN")?"":e},n.prototype.getTotalLength=function(){var t=this.get("el");return t?t.getTotalLength():null},n.prototype.getPoint=function(t){var e=this.get("el"),i=this.getTotalLength();if(i===0)return null;var a=e?e.getPointAtLength(t*i):null;return a?{x:a.x,y:a.y}:null},n}(Pr);const NI=BI;var zI=function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.type="polygon",t.canFill=!0,t.canStroke=!0,t}return n.prototype.createPath=function(t,e){var i=this.attr(),a=this.get("el");w(e||i,function(o,s){s==="points"&&V(o)&&o.length>=2?a.setAttribute("points",o.map(function(u){return u[0]+","+u[1]}).join(" ")):Rt[s]&&a.setAttribute(Rt[s],o)})},n}(Pr);const UI=zI;var HI=function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.type="polyline",t.canFill=!0,t.canStroke=!0,t}return n.prototype.getDefaultAttrs=function(){var t=r.prototype.getDefaultAttrs.call(this);return C(C({},t),{startArrow:!1,endArrow:!1})},n.prototype.onAttrChange=function(t,e,i){r.prototype.onAttrChange.call(this,t,e,i),["points"].indexOf(t)!==-1&&this._resetCache()},n.prototype._resetCache=function(){this.set("totalLength",null),this.set("tCache",null)},n.prototype.createPath=function(t,e){var i=this.attr(),a=this.get("el");w(e||i,function(o,s){s==="points"&&V(o)&&o.length>=2?a.setAttribute("points",o.map(function(u){return u[0]+","+u[1]}).join(" ")):Rt[s]&&a.setAttribute(Rt[s],o)})},n.prototype.getTotalLength=function(){var t=this.attr().points,e=this.get("totalLength");return G(e)?(this.set("totalLength",DE.length(t)),this.get("totalLength")):e},n.prototype.getPoint=function(t){var e=this.attr().points,i=this.get("tCache");i||(this._setTcache(),i=this.get("tCache"));var a,o;return w(i,function(s,u){t>=s[0]&&t<=s[1]&&(a=(t-s[0])/(s[1]-s[0]),o=u)}),Le.pointAt(e[o][0],e[o][1],e[o+1][0],e[o+1][1],a)},n.prototype._setTcache=function(){var t=this.attr().points;if(!(!t||t.length===0)){var e=this.getTotalLength();if(!(e<=0)){var i=0,a=[],o,s;w(t,function(u,l){t[l+1]&&(o=[],o[0]=i/e,s=Le.length(u[0],u[1],t[l+1][0],t[l+1][1]),i+=s,o[1]=i/e,a.push(o))}),this.set("tCache",a)}}},n.prototype.getStartTangent=function(){var t=this.attr().points,e=[];return e.push([t[1][0],t[1][1]]),e.push([t[0][0],t[0][1]]),e},n.prototype.getEndTangent=function(){var t=this.attr().points,e=t.length-1,i=[];return i.push([t[e-1][0],t[e-1][1]]),i.push([t[e][0],t[e][1]]),i},n}(Pr);const $I=HI;function GI(r){var n=0,t=0,e=0,i=0;return V(r)?r.length===1?n=t=e=i=r[0]:r.length===2?(n=e=r[0],t=i=r[1]):r.length===3?(n=r[0],t=i=r[1],e=r[2]):(n=r[0],t=r[1],e=r[2],i=r[3]):n=t=e=i=r,{r1:n,r2:t,r3:e,r4:i}}var VI=function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.type="rect",t.canFill=!0,t.canStroke=!0,t}return n.prototype.getDefaultAttrs=function(){var t=r.prototype.getDefaultAttrs.call(this);return C(C({},t),{x:0,y:0,width:0,height:0,radius:0})},n.prototype.createPath=function(t,e){var i=this,a=this.attr(),o=this.get("el"),s=!1,u=["x","y","width","height","radius"];w(e||a,function(l,c){u.indexOf(c)!==-1&&!s?(o.setAttribute("d",i._assembleRect(a)),s=!0):u.indexOf(c)===-1&&Rt[c]&&o.setAttribute(Rt[c],l)})},n.prototype._assembleRect=function(t){var e=t.x,i=t.y,a=t.width,o=t.height,s=t.radius;if(!s)return"M "+e+","+i+" l "+a+",0 l 0,"+o+" l"+-a+" 0 z";var u=GI(s);V(s)?s.length===1?u.r1=u.r2=u.r3=u.r4=s[0]:s.length===2?(u.r1=u.r3=s[0],u.r2=u.r4=s[1]):s.length===3?(u.r1=s[0],u.r2=u.r4=s[1],u.r3=s[2]):(u.r1=s[0],u.r2=s[1],u.r3=s[2],u.r4=s[3]):u.r1=u.r2=u.r3=u.r4=s;var l=[["M "+(e+u.r1)+","+i],["l "+(a-u.r1-u.r2)+",0"],["a "+u.r2+","+u.r2+",0,0,1,"+u.r2+","+u.r2],["l 0,"+(o-u.r2-u.r3)],["a "+u.r3+","+u.r3+",0,0,1,"+-u.r3+","+u.r3],["l "+(u.r3+u.r4-a)+",0"],["a "+u.r4+","+u.r4+",0,0,1,"+-u.r4+","+-u.r4],["l 0,"+(u.r4+u.r1-o)],["a "+u.r1+","+u.r1+",0,0,1,"+u.r1+","+-u.r1],["z"]];return l.join(" ")},n}(Pr);const WI=VI;var a0=.3,jI={top:"before-edge",middle:"central",bottom:"after-edge",alphabetic:"baseline",hanging:"hanging"},XI={top:"text-before-edge",middle:"central",bottom:"text-after-edge",alphabetic:"alphabetic",hanging:"hanging"},YI={left:"left",start:"left",center:"middle",right:"end",end:"end"},ZI=function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.type="text",t.canFill=!0,t.canStroke=!0,t}return n.prototype.getDefaultAttrs=function(){var t=r.prototype.getDefaultAttrs.call(this);return C(C({},t),{x:0,y:0,text:null,fontSize:12,fontFamily:"sans-serif",fontStyle:"normal",fontWeight:"normal",fontVariant:"normal",textAlign:"start",textBaseline:"bottom"})},n.prototype.createPath=function(t,e){var i=this,a=this.attr(),o=this.get("el");this._setFont(),w(e||a,function(s,u){u==="text"?i._setText(""+s):u==="matrix"&&s?Ws(i):Rt[u]&&o.setAttribute(Rt[u],s)}),o.setAttribute("paint-order","stroke"),o.setAttribute("style","stroke-linecap:butt; stroke-linejoin:miter;")},n.prototype._setFont=function(){var t=this.get("el"),e=this.attr(),i=e.textBaseline,a=e.textAlign,o=WC();o&&o.name==="firefox"?t.setAttribute("dominant-baseline",XI[i]||"alphabetic"):t.setAttribute("alignment-baseline",jI[i]||"baseline"),t.setAttribute("text-anchor",YI[a]||"left")},n.prototype._setText=function(t){var e=this.get("el"),i=this.attr(),a=i.x,o=i.textBaseline,s=o===void 0?"bottom":o;if(!t)e.innerHTML="";else if(~t.indexOf(`
`)){var u=t.split(`
`),l=u.length-1,c="";w(u,function(f,h){h===0?s==="alphabetic"?c+='<tspan x="'+a+'" dy="'+-l+'em">'+f+"</tspan>":s==="top"?c+='<tspan x="'+a+'" dy="0.9em">'+f+"</tspan>":s==="middle"?c+='<tspan x="'+a+'" dy="'+-(l-1)/2+'em">'+f+"</tspan>":s==="bottom"?c+='<tspan x="'+a+'" dy="-'+(l+a0)+'em">'+f+"</tspan>":s==="hanging"&&(c+='<tspan x="'+a+'" dy="'+(-(l-1)-a0)+'em">'+f+"</tspan>"):c+='<tspan x="'+a+'" dy="1em">'+f+"</tspan>"}),e.innerHTML=c}else e.innerHTML=t},n}(Pr);const qI=ZI;var KI=/^l\s*\(\s*([\d.]+)\s*\)\s*(.*)/i,QI=/^r\s*\(\s*([\d.]+)\s*,\s*([\d.]+)\s*,\s*([\d.]+)\s*\)\s*(.*)/i,JI=/[\d.]+:(#[^\s]+|[^)]+\))/gi;function Eb(r){var n=r.match(JI);if(!n)return"";var t="";return n.sort(function(e,i){return e=e.split(":"),i=i.split(":"),Number(e[0])-Number(i[0])}),w(n,function(e){e=e.split(":"),t+='<stop offset="'+e[0]+'" stop-color="'+e[1]+'"></stop>'}),t}function tD(r,n){var t=KI.exec(r),e=Av(Tv(parseFloat(t[1])),Math.PI*2),i=t[2],a,o;e>=0&&e<.5*Math.PI?(a={x:0,y:0},o={x:1,y:1}):.5*Math.PI<=e&&e<Math.PI?(a={x:1,y:0},o={x:0,y:1}):Math.PI<=e&&e<1.5*Math.PI?(a={x:1,y:1},o={x:0,y:0}):(a={x:0,y:1},o={x:1,y:0});var s=Math.tan(e),u=s*s,l=(o.x-a.x+s*(o.y-a.y))/(u+1)+a.x,c=s*(o.x-a.x+s*(o.y-a.y))/(u+1)+a.y;n.setAttribute("x1",a.x),n.setAttribute("y1",a.y),n.setAttribute("x2",l),n.setAttribute("y2",c),n.innerHTML=Eb(i)}function eD(r,n){var t=QI.exec(r),e=parseFloat(t[1]),i=parseFloat(t[2]),a=parseFloat(t[3]),o=t[4];n.setAttribute("cx",e),n.setAttribute("cy",i),n.setAttribute("r",a),n.innerHTML=Eb(o)}var rD=function(){function r(n){this.cfg={};var t=null,e=Ir("gradient_");return n.toLowerCase()[0]==="l"?(t=Rr("linearGradient"),tD(n,t)):(t=Rr("radialGradient"),eD(n,t)),t.setAttribute("id",e),this.el=t,this.id=e,this.cfg=n,this}return r.prototype.match=function(n,t){return this.cfg===t},r}(),nD={shadowColor:"color",shadowOpacity:"opacity",shadowBlur:"blur",shadowOffsetX:"dx",shadowOffsetY:"dy"},iD={x:"-40%",y:"-40%",width:"200%",height:"200%"},aD=function(){function r(n){this.type="filter",this.cfg={},this.type="filter";var t=Rr("filter");return w(iD,function(e,i){t.setAttribute(i,e)}),this.el=t,this.id=Ir("filter_"),this.el.id=this.id,this.cfg=n,this._parseShadow(n,t),this}return r.prototype.match=function(n,t){if(this.type!==n)return!1;var e=!0,i=this.cfg;return w(Object.keys(i),function(a){if(i[a]!==t[a])return e=!1,!1}),e},r.prototype.update=function(n,t){var e=this.cfg;return e[nD[n]]=t,this._parseShadow(e,this.el),this},r.prototype._parseShadow=function(n,t){var e=`<feDropShadow
      dx="`+(n.dx||0)+`"
      dy="`+(n.dy||0)+`"
      stdDeviation="`+(n.blur?n.blur/10:0)+`"
      flood-color="`+(n.color?n.color:"#000")+`"
      flood-opacity="`+(n.opacity?n.opacity:1)+`"
      />`;t.innerHTML=e},r}(),o0=function(){function r(n,t){this.cfg={};var e=Rr("marker"),i=Ir("marker_");e.setAttribute("id",i);var a=Rr("path");a.setAttribute("stroke",n.stroke||"none"),a.setAttribute("fill",n.fill||"none"),e.appendChild(a),e.setAttribute("overflow","visible"),e.setAttribute("orient","auto-start-reverse"),this.el=e,this.child=a,this.id=i;var o=n[t==="marker-start"?"startArrow":"endArrow"];return this.stroke=n.stroke||"#000",o===!0?this._setDefaultPath(t,a):(this.cfg=o,this._setMarker(n.lineWidth,a)),this}return r.prototype.match=function(){return!1},r.prototype._setDefaultPath=function(n,t){var e=this.el;t.setAttribute("d","M0,0 L"+10*Math.cos(Math.PI/6)+",5 L0,10"),e.setAttribute("refX",""+10*Math.cos(Math.PI/6)),e.setAttribute("refY",""+5)},r.prototype._setMarker=function(n,t){var e=this.el,i=this.cfg.path,a=this.cfg.d;V(i)&&(i=i.map(function(o){return o.join(" ")}).join("")),t.setAttribute("d",i),e.appendChild(t),a&&e.setAttribute("refX",""+a/n)},r.prototype.update=function(n){var t=this.child;t.attr?t.attr("fill",n):t.setAttribute("fill",n)},r}(),oD=function(){function r(n){this.type="clip",this.cfg={};var t=Rr("clipPath");this.el=t,this.id=Ir("clip_"),t.id=this.id;var e=n.cfg.el;return t.appendChild(e),this.cfg=n,this}return r.prototype.match=function(){return!1},r.prototype.remove=function(){var n=this.el;n.parentNode.removeChild(n)},r}(),sD=/^p\s*\(\s*([axyn])\s*\)\s*(.*)/i,uD=function(){function r(n){this.cfg={};var t=Rr("pattern");t.setAttribute("patternUnits","userSpaceOnUse");var e=Rr("image");t.appendChild(e);var i=Ir("pattern_");t.id=i,this.el=t,this.id=i,this.cfg=n;var a=sD.exec(n),o=a[2];e.setAttribute("href",o);var s=new Image;o.match(/^data:/i)||(s.crossOrigin="Anonymous"),s.src=o;function u(){t.setAttribute("width",""+s.width),t.setAttribute("height",""+s.height)}return s.complete?u():(s.onload=u,s.src=s.src),this}return r.prototype.match=function(n,t){return this.cfg===t},r}(),lD=function(){function r(n){var t=Rr("defs"),e=Ir("defs_");t.id=e,n.appendChild(t),this.children=[],this.defaultArrow={},this.el=t,this.canvas=n}return r.prototype.find=function(n,t){for(var e=this.children,i=null,a=0;a<e.length;a++)if(e[a].match(n,t)){i=e[a].id;break}return i},r.prototype.findById=function(n){for(var t=this.children,e=null,i=0;i<t.length;i++)if(t[i].id===n){e=t[i];break}return e},r.prototype.add=function(n){this.children.push(n),n.canvas=this.canvas,n.parent=this},r.prototype.getDefaultArrow=function(n,t){var e=n.stroke||n.strokeStyle;if(this.defaultArrow[e])return this.defaultArrow[e].id;var i=new o0(n,t);return this.defaultArrow[e]=i,this.el.appendChild(i.el),this.add(i),i.id},r.prototype.addGradient=function(n){var t=new rD(n);return this.el.appendChild(t.el),this.add(t),t.id},r.prototype.addArrow=function(n,t){var e=new o0(n,t);return this.el.appendChild(e.el),this.add(e),e.id},r.prototype.addShadow=function(n){var t=new aD(n);return this.el.appendChild(t.el),this.add(t),t.id},r.prototype.addPattern=function(n){var t=new uD(n);return this.el.appendChild(t.el),this.add(t),t.id},r.prototype.addClip=function(n){var t=new oD(n);return this.el.appendChild(t.el),this.add(t),t.id},r}(),cD=function(r){R(n,r);function n(t){return r.call(this,C(C({},t),{autoDraw:!0,renderer:"svg"}))||this}return n.prototype.getShapeBase=function(){return Il},n.prototype.getGroupBase=function(){return lp},n.prototype.getShape=function(t,e,i){var a=i.target||i.srcElement;if(!Ah[a.tagName]){for(var o=a.parentNode;o&&!Ah[o.tagName];)o=o.parentNode;a=o}return this.find(function(s){return s.get("el")===a})},n.prototype.createDom=function(){var t=Rr("svg"),e=new lD(t);return t.setAttribute("width",""+this.get("width")),t.setAttribute("height",""+this.get("height")),this.set("context",e),t},n.prototype.onCanvasChange=function(t){var e=this.get("context"),i=this.get("el");if(t==="sort"){var a=this.get("children");a&&a.length&&xb(this,function(s,u){return a.indexOf(s)-a.indexOf(u)?1:0})}else if(t==="clear"){if(i){i.innerHTML="";var o=e.el;o.innerHTML="",i.appendChild(o)}}else t==="matrix"?Ws(this):t==="clip"?ms(this,e):t==="changeSize"&&(i.setAttribute("width",""+this.get("width")),i.setAttribute("height",""+this.get("height")))},n.prototype.draw=function(){var t=this.get("context"),e=this.getChildren();ms(this,t),e.length&&_b(t,e)},n}(Ul),fD="0.5.6";const hD=Object.freeze(Object.defineProperty({__proto__:null,Shape:Il,version:fD,Canvas:cD,Group:lp,Event:Bs,Base:Nl,AbstractCanvas:Ul,AbstractGroup:Hl,AbstractShape:$l,getBBoxMethod:Gl,registerBBox:Dr,getTextHeight:jl,assembleFont:Xl,isAllowCapture:ss,multiplyVec2:Sn,invert:zl,getOffScreenContext:Wl,registerEasing:TE,PathUtil:Lv},Symbol.toStringTag,{value:"Module"}));var cp=function(r){R(n,r);function n(t){var e=r.call(this,t)||this;e.type="path",e.shapeType="line";var i=t.connectNulls,a=i===void 0?!1:i,o=t.showSinglePoint,s=o===void 0?!0:o;return e.connectNulls=a,e.showSinglePoint=s,e}return n.prototype.updateElements=function(t,e){var i,a,o,s,u,l;e===void 0&&(e=!1);for(var c=new Map,f=new Map,h=[],v=0,p=0;p<t.length;p++){var d=t[p],g=this.getElementId(d);h.push(g),c.set(g,d),f.set(g,v),v++}this.elements=new Array(v);var y=ZS(this.lastElementsMap,h),m=y.added,x=y.updated,_=y.removed;try{for(var E=It(m),b=E.next();!b.done;b=E.next()){var g=b.value,d=c.get(g),M=this.getShapeFactory(),T=this.getShapeInfo(d),p=f.get(g),k=new WS({shapeFactory:M,container:this.container,offscreenGroup:this.getOffscreenGroup(),elementIndex:p});k.geometry=this,k.animate=this.animateOption,k.draw(T,e),this.elementsMap[g]=k,this.elements[p]=k}}catch(ot){i={error:ot}}finally{try{b&&!b.done&&(a=E.return)&&a.call(E)}finally{if(i)throw i.error}}try{for(var L=It(x),O=L.next();!O.done;O=L.next()){var g=O.value,d=c.get(g),k=this.lastElementsMap[g],p=f.get(g),T=this.getShapeInfo(d),D=k.getModel();(this.isCoordinateChanged||YS(D,T))&&(k.animate=this.animateOption,k.update(T)),this.elementsMap[g]=k,this.elements[p]=k}}catch(ot){o={error:ot}}finally{try{O&&!O.done&&(s=L.return)&&s.call(L)}finally{if(o)throw o.error}}try{for(var W=It(_),j=W.next();!j.done;j=W.next()){var g=j.value,k=this.lastElementsMap[g];k.animate=this.animateOption,k.destroy()}}catch(ot){u={error:ot}}finally{try{j&&!j.done&&(l=W.return)&&l.call(W)}finally{if(u)throw u.error}}},n.prototype.getPointsAndData=function(t){for(var e=[],i=[],a=0,o=t.length;a<o;a++){var s=t[a];e.push({x:s.x,y:s.y}),i.push(s[Vt])}return{points:e,data:i}},n.prototype.getShapeInfo=function(t){var e=this.getDrawCfg(t[0]),i=this.getPointsAndData(t),a=i.points,o=i.data;return e.mappingData=t,e.data=o,e.isStack=!!this.getAdjust("stack"),e.points=a,e.connectNulls=this.connectNulls,e.showSinglePoint=this.showSinglePoint,e},n}(_i);function vD(r,n,t,e,i){var a=[];if(r.length){for(var o=[],s=[],u=0,l=r.length;u<l;u++){var c=r[u];o.push(c[1]),s.push(c[0])}s=s.reverse(),w([o,s],function(f,h){var v=[],p=e.parsePoints(f),d=p[0];o.length===1&&s.length===1?v=h===0?[["M",d.x-.5,d.y],["L",d.x+.5,d.y]]:[["L",d.x+.5,d.y],["L",d.x-.5,d.y]]:(n&&p.push({x:d.x,y:d.y}),t?v=cl(p,!1,i):v=$s(p,!1),h>0&&(v[0][0]="L")),a=a.concat(v)}),a.push(["Z"])}return a}function hc(r,n,t,e,i){for(var a=ce(r,n,!n,"lineWidth"),o=r.connectNulls,s=r.isInCircle,u=r.points,l=r.showSinglePoint,c=fc(u,o,l),f=[],h=0,v=c.length;h<v;h++){var p=c[h];f=f.concat(vD(p,s,t,e,i))}return a.path=f,a}function Sb(r){var n=r.start,t=r.end;return[[n.x,t.y],[t.x,n.y]]}xi("area",{defaultShapeType:"area",getDefaultPoints:function(r){var n=r.x,t=r.y0,e=V(r.y)?r.y:[t,r.y];return e.map(function(i){return{x:n,y:i}})}});Pt("area","area",{draw:function(r,n){var t=hc(r,!1,!1,this),e=n.addShape({type:"path",attrs:t,name:"area"});return e},getMarker:function(r){var n=r.color;return{symbol:function(t,e,i){return i===void 0&&(i=5.5),[["M",t-i,e-4],["L",t+i,e-4],["L",t+i,e+4],["L",t-i,e+4],["Z"]]},style:{r:5,fill:n,fillOpacity:1}}}});var pD=function(r){R(n,r);function n(t){var e=r.call(this,t)||this;e.type="area",e.shapeType="area",e.generatePoints=!0,e.startOnZero=!0;var i=t.startOnZero,a=i===void 0?!0:i,o=t.sortable,s=o===void 0?!1:o,u=t.showSinglePoint,l=u===void 0?!1:u;return e.startOnZero=a,e.sortable=s,e.showSinglePoint=l,e}return n.prototype.getPointsAndData=function(t){for(var e=[],i=[],a=0,o=t.length;a<o;a++){var s=t[a];e.push(s.points),i.push(s[Vt])}return{points:e,data:i}},n.prototype.getYMinValue=function(){if(this.startOnZero)return r.prototype.getYMinValue.call(this);var t=this.getYScale();return t.min},n}(cp);xi("edge",{defaultShapeType:"line",getDefaultPoints:function(r){return rp(r)}});Pt("edge","line",{draw:function(r,n){var t=ce(r,!0,!1,"lineWidth"),e=$s(this.parsePoints(r.points),this.coordinate.isPolar);return n.addShape("path",{attrs:C(C({},t),{path:e})})},getMarker:function(r){return{symbol:"circle",style:{r:4.5,fill:r.color}}}});var dD=function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.type="edge",t.shapeType="edge",t.generatePoints=!0,t}return n}(_i),gD=function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.type="heatmap",t.paletteCache={},t}return n.prototype.updateElements=function(t,e){for(var i=0;i<t.length;i++){var a=t[i],o=this.prepareRange(a),s=this.prepareSize(),u=F(this.styleOption,["cfg","shadowBlur"]);dt(u)||(u=s/2),this.prepareGreyScaleBlurredCircle(s,u),this.drawWithRange(a,o,s,u)}},n.prototype.color=function(t,e){return this.createAttrOption("color",t,typeof e!="function"?e:""),this},n.prototype.clear=function(){r.prototype.clear.call(this),this.clearShadowCanvasCtx(),this.paletteCache={}},n.prototype.prepareRange=function(t){var e=this.getAttribute("color"),i=e.getFields()[0],a=1/0,o=-1/0;return t.forEach(function(s){var u=s[Vt][i];u>o&&(o=u),u<a&&(a=u)}),a===o&&(a=o-1),[a,o]},n.prototype.prepareSize=function(){var t=this.getDefaultValue("size");return dt(t)||(t=this.getDefaultSize()),t},n.prototype.prepareGreyScaleBlurredCircle=function(t,e){var i=this.getGrayScaleBlurredCanvas(),a=t+e,o=i.getContext("2d");i.width=i.height=a*2,o.clearRect(0,0,i.width,i.height),o.shadowOffsetX=o.shadowOffsetY=a*2,o.shadowBlur=e,o.shadowColor="black",o.beginPath(),o.arc(-a,-a,t,0,Math.PI*2,!0),o.closePath(),o.fill()},n.prototype.drawWithRange=function(t,e,i,a){var o,s,u=this.coordinate,l=u.start,c=u.end,f=this.coordinate.getWidth(),h=this.coordinate.getHeight(),v=this.getAttribute("color"),p=v.getFields()[0];this.clearShadowCanvasCtx();var d=this.getShadowCanvasCtx();e&&(t=t.filter(function(L){return L[Vt][p]<=e[1]&&L[Vt][p]>=e[0]}));var g=this.scales[p];try{for(var y=It(t),m=y.next();!m.done;m=y.next()){var x=m.value,_=this.getDrawCfg(x),E=_.x,b=_.y,M=g.scale(x[Vt][p]);this.drawGrayScaleBlurredCircle(E-l.x,b-c.y,i+a,M,d)}}catch(L){o={error:L}}finally{try{m&&!m.done&&(s=y.return)&&s.call(y)}finally{if(o)throw o.error}}var T=d.getImageData(0,0,f,h);this.clearShadowCanvasCtx(),this.colorize(T),d.putImageData(T,0,0);var k=this.getImageShape();k.attr("x",l.x),k.attr("y",c.y),k.attr("width",f),k.attr("height",h),k.attr("img",d.canvas),k.set("origin",this.getShapeInfo(t))},n.prototype.getDefaultSize=function(){var t=this.getAttribute("position"),e=this.coordinate;return Math.min(e.getWidth()/(t.scales[0].ticks.length*4),e.getHeight()/(t.scales[1].ticks.length*4))},n.prototype.clearShadowCanvasCtx=function(){var t=this.getShadowCanvasCtx();t.clearRect(0,0,t.canvas.width,t.canvas.height)},n.prototype.getShadowCanvasCtx=function(){var t=this.shadowCanvas;return t||(t=document.createElement("canvas"),this.shadowCanvas=t),t.width=this.coordinate.getWidth(),t.height=this.coordinate.getHeight(),t.getContext("2d")},n.prototype.getGrayScaleBlurredCanvas=function(){return this.grayScaleBlurredCanvas||(this.grayScaleBlurredCanvas=document.createElement("canvas")),this.grayScaleBlurredCanvas},n.prototype.drawGrayScaleBlurredCircle=function(t,e,i,a,o){var s=this.getGrayScaleBlurredCanvas();o.globalAlpha=a,o.drawImage(s,t-i,e-i)},n.prototype.colorize=function(t){for(var e=this.getAttribute("color"),i=t.data,a=this.paletteCache,o=3;o<i.length;o+=4){var s=i[o];if(dt(s)){var u=a[s]?a[s]:ii.rgb2arr(e.gradient(s/256));i[o-3]=u[0],i[o-2]=u[1],i[o-1]=u[2],i[o]=s}}},n.prototype.getImageShape=function(){var t=this.imageShape;if(t)return t;var e=this.container;return t=e.addShape({type:"image",attrs:{}}),this.imageShape=t,t},n.prototype.getShapeInfo=function(t){var e=this.getDrawCfg(t[0]),i=t.map(function(a){return a[Vt]});return C(C({},e),{mappingData:t,data:i})},n}(_i);function fp(r){var n,t,e=r.x,i=r.y,a=r.y0,o=r.size,s,u;V(i)?(n=ut(i,2),s=n[0],u=n[1]):(s=a,u=i);var l,c;V(e)?(t=ut(e,2),l=t[0],c=t[1]):(l=e-o/2,c=e+o/2);var f=[{x:l,y:s},{x:l,y:u}];return f.push({x:c,y:u},{x:c,y:s}),f}function hp(r,n){n===void 0&&(n=!0);var t=[],e=r[0];t.push(["M",e.x,e.y]);for(var i=1,a=r.length;i<a;i++)t.push(["L",r[i].x,r[i].y]);return n&&(t.push(["L",e.x,e.y]),t.push(["z"])),t}function bb(r,n){var t=0,e=0,i=0,a=0;return V(r)?r.length===1?t=e=i=a=r[0]:r.length===2?(t=i=r[0],e=a=r[1]):r.length===3?(t=r[0],e=a=r[1],i=r[2]):(t=r[0],e=r[1],i=r[2],a=r[3]):t=e=i=a=r,t+e>n&&(t=t?n/(1+e/t):0,e=n-t),i+a>n&&(i=i?n/(1+a/i):0,a=n-i),[t||0,e||0,i||0,a||0]}function Ab(r,n,t){var e=[];if(t.isRect){var i=t.isTransposed?{x:t.start.x,y:n[0].y}:{x:n[0].x,y:t.start.y},a=t.isTransposed?{x:t.end.x,y:n[2].y}:{x:n[3].x,y:t.end.y},o=F(r,["background","style","radius"]);if(o){var s=t.isTransposed?Math.abs(n[0].y-n[2].y):n[2].x-n[1].x,u=t.isTransposed?t.getWidth():t.getHeight(),l=ut(bb(o,Math.min(s,u)),4),c=l[0],f=l[1],h=l[2],v=l[3],p=t.isTransposed&&t.isReflect("y"),d=p?0:1,g=function(b){return p?-b:b};e.push(["M",i.x,a.y+g(c)]),c!==0&&e.push(["A",c,c,0,0,d,i.x+c,a.y]),e.push(["L",a.x-f,a.y]),f!==0&&e.push(["A",f,f,0,0,d,a.x,a.y+g(f)]),e.push(["L",a.x,i.y-g(h)]),h!==0&&e.push(["A",h,h,0,0,d,a.x-h,i.y]),e.push(["L",i.x+v,i.y]),v!==0&&e.push(["A",v,v,0,0,d,i.x,i.y-g(v)])}else e.push(["M",i.x,i.y]),e.push(["L",a.x,i.y]),e.push(["L",a.x,a.y]),e.push(["L",i.x,a.y]),e.push(["L",i.x,i.y]);e.push(["z"])}if(t.isPolar){var y=t.getCenter(),m=vs(r,t),x=m.startAngle,_=m.endAngle;if(t.type!=="theta"&&!t.isTransposed)e=ai(y.x,y.y,t.getRadius(),x,_);else{var E=function(T){return Math.pow(T,2)},c=Math.sqrt(E(y.x-n[0].x)+E(y.y-n[0].y)),f=Math.sqrt(E(y.x-n[2].x)+E(y.y-n[2].y));e=ai(y.x,y.y,c,t.startAngle,t.endAngle,f)}}return e}function yD(r,n,t){var e=t.getWidth(),i=t.getHeight(),a=t.type==="rect",o=[],s=(r[2].x-r[1].x)/2,u=t.isTransposed?s*i/e:s*e/i;return n==="round"?(a?(o.push(["M",r[0].x,r[0].y+u]),o.push(["L",r[1].x,r[1].y-u]),o.push(["A",s,s,0,0,1,r[2].x,r[2].y-u]),o.push(["L",r[3].x,r[3].y+u]),o.push(["A",s,s,0,0,1,r[0].x,r[0].y+u])):(o.push(["M",r[0].x,r[0].y]),o.push(["L",r[1].x,r[1].y]),o.push(["A",s,s,0,0,1,r[2].x,r[2].y]),o.push(["L",r[3].x,r[3].y]),o.push(["A",s,s,0,0,1,r[0].x,r[0].y])),o.push(["z"])):o=hp(r),o}function Tb(r,n,t){var e=[];return G(n)?t?e.push(["M",r[0].x,r[0].y],["L",r[1].x,r[1].y],["L",(r[2].x+r[3].x)/2,(r[2].y+r[3].y)/2],["Z"]):e.push(["M",r[0].x,r[0].y],["L",r[1].x,r[1].y],["L",r[2].x,r[2].y],["L",r[3].x,r[3].y],["Z"]):e.push(["M",r[0].x,r[0].y],["L",r[1].x,r[1].y],["L",n[1].x,n[1].y],["L",n[0].x,n[0].y],["Z"]),e}function To(r,n){return[n,r]}function mD(r,n,t){var e,i,a,o,s,u,l,c=ut(te([],ut(r),!1),4),f=c[0],h=c[1],v=c[2],p=c[3],d=ut(typeof t=="number"?Array(4).fill(t):t,4),g=d[0],y=d[1],m=d[2],x=d[3];n.isTransposed&&(e=ut(To(h,p),2),h=e[0],p=e[1]),n.isReflect("y")&&(i=ut(To(f,h),2),f=i[0],h=i[1],a=ut(To(v,p),2),v=a[0],p=a[1]),n.isReflect("x")&&(o=ut(To(f,p),2),f=o[0],p=o[1],s=ut(To(h,v),2),h=s[0],v=s[1]);var _=[],E=function(b){return Math.abs(b)};return u=ut(bb([g,y,m,x],Math.min(E(p.x-f.x),E(h.y-f.y))).map(function(b){return E(b)}),4),g=u[0],y=u[1],m=u[2],x=u[3],n.isTransposed&&(l=ut([x,g,y,m],4),g=l[0],y=l[1],m=l[2],x=l[3]),f.y<h.y?(_.push(["M",p.x,p.y+m]),m!==0&&_.push(["A",m,m,0,0,0,p.x-m,p.y]),_.push(["L",f.x+x,f.y]),x!==0&&_.push(["A",x,x,0,0,0,f.x,f.y+x]),_.push(["L",h.x,h.y-g]),g!==0&&_.push(["A",g,g,0,0,0,h.x+g,h.y]),_.push(["L",v.x-y,v.y]),y!==0&&_.push(["A",y,y,0,0,0,v.x,v.y-y]),_.push(["L",p.x,p.y+m]),_.push(["z"])):p.x<f.x?(_.push(["M",v.x+y,v.y]),y!==0&&_.push(["A",y,y,0,0,0,v.x,v.y+y]),_.push(["L",p.x,p.y-m]),m!==0&&_.push(["A",m,m,0,0,0,p.x+m,p.y]),_.push(["L",f.x-x,f.y]),x!==0&&_.push(["A",x,x,0,0,0,f.x,f.y-x]),_.push(["L",h.x,h.y+g]),g!==0&&_.push(["A",g,g,0,0,0,h.x-g,h.y]),_.push(["L",v.x+y,v.y]),_.push(["z"])):(_.push(["M",h.x,h.y+g]),g!==0&&_.push(["A",g,g,0,0,1,h.x+g,h.y]),_.push(["L",v.x-y,v.y]),y!==0&&_.push(["A",y,y,0,0,1,v.x,v.y+y]),_.push(["L",p.x,p.y-m]),m!==0&&_.push(["A",m,m,0,0,1,p.x-m,p.y]),_.push(["L",f.x+x,f.y]),x!==0&&_.push(["A",x,x,0,0,1,f.x,f.y-x]),_.push(["L",h.x,h.y+g]),_.push(["z"])),_}xi("interval",{defaultShapeType:"rect",getDefaultPoints:function(r){return fp(r)}});Pt("interval","rect",{draw:function(r,n){var t=ce(r,!1,!0),e=n,i=r==null?void 0:r.background;if(i){e=n.addGroup({name:"interval-group"});var a=rb(r),o=Ab(r,this.parsePoints(r.points),this.coordinate);e.addShape("path",{attrs:C(C({},a),{path:o}),zIndex:-1,name:Jv})}var s;t.radius&&this.coordinate.isRect?s=mD(this.parsePoints(r.points),this.coordinate,t.radius):s=this.parsePath(yD(r.points,t.lineCap,this.coordinate));var u=e.addShape("path",{attrs:C(C({},t),{path:s}),name:"interval"});return i?e:u},getMarker:function(r){var n=r.color,t=r.isInPolar;return t?{symbol:"circle",style:{r:4.5,fill:n}}:{symbol:"square",style:{r:4,fill:n}}}});function xD(r,n){var t=r.length,e=r;lt(e[0])&&(e=r.map(function(s){return n.translate(s)}));for(var i=e[1]-e[0],a=2;a<t;a++){var o=e[a]-e[a-1];i>o&&(i=o)}return i}function _D(r,n){if(n){var t=yr(r),e=Yr(t,n);return e.length}return r.length}function vp(r){var n=r.theme,t=r.coordinate,e=r.getXScale(),i=e.values,a=r.beforeMappingData,o=i.length,s=Hs(r.coordinate),u=r.intervalPadding,l=r.dodgePadding,c=r.maxColumnWidth||n.maxColumnWidth,f=r.minColumnWidth||n.minColumnWidth,h=r.columnWidthRatio||n.columnWidthRatio,v=r.multiplePieWidthRatio||n.multiplePieWidthRatio,p=r.roseWidthRatio||n.roseWidthRatio;if(e.isLinear&&i.length>1){i.sort();var d=xD(i,e);o=(e.max-e.min)/d,i.length>o&&(o=i.length)}var g=e.range,y=1/o,m=1;if(t.isPolar?t.isTransposed&&o>1?m=v:m=p:(e.isLinear&&(y*=g[1]-g[0]),m=h),!G(u)&&u>=0){var x=u/s;y=(1-(o-1)*x)/o}else y*=m;if(r.getAdjust("dodge")){var _=r.getAdjust("dodge"),E=_.dodgeBy,b=_D(a,E);if(!G(l)&&l>=0){var M=l/s;y=(y-M*(b-1))/b}else!G(u)&&u>=0&&(y*=m),y=y/b;y=y>=0?y:0}if(!G(c)&&c>=0){var T=c/s;y>T&&(y=T)}if(!G(f)&&f>=0){var k=f/s;y<k&&(y=k)}return y}var CD=function(r){R(n,r);function n(t){var e=r.call(this,t)||this;e.type="interval",e.shapeType="interval",e.generatePoints=!0;var i=t.background;return e.background=i,e}return n.prototype.createShapePointsCfg=function(t){var e=r.prototype.createShapePointsCfg.call(this,t),i,a=this.getAttribute("size");if(a){i=this.getAttributeValues(a,t)[0];var o=this.coordinate,s=Hs(o);i=i/s}else this.defaultSize||(this.defaultSize=vp(this)),i=this.defaultSize;return e.size=i,e},n.prototype.adjustScale=function(){r.prototype.adjustScale.call(this);var t=this.getYScale();if(this.coordinate.type==="theta")t.change({nice:!1,min:0,max:cO(t)});else{var e=this.scaleDefs,i=t.field,a=t.min,o=t.max,s=t.type;s!=="time"&&(a>0&&!F(e,[i,"min"])&&t.change({min:0}),o<=0&&!F(e,[i,"max"])&&t.change({max:0}))}},n.prototype.getDrawCfg=function(t){var e=r.prototype.getDrawCfg.call(this,t);return e.background=this.background,e},n}(_i),ED=function(r){R(n,r);function n(t){var e=r.call(this,t)||this;e.type="line";var i=t.sortable,a=i===void 0?!1:i;return e.sortable=a,e}return n}(cp),Mb=["circle","square","bowtie","diamond","hexagon","triangle","triangle-down"],SD=["cross","tick","plus","hyphen","line"];function pp(r,n,t,e,i){var a,o,s=ce(n,i,!i,"r"),u=r.parsePoints(n.points),l=u[0];if(n.isStack)l=u[1];else if(u.length>1){var c=t.addGroup();try{for(var f=It(u),h=f.next();!h.done;h=f.next()){var v=h.value;c.addShape({type:"marker",attrs:C(C(C({},s),{symbol:ra[e]||e}),v)})}}catch(p){a={error:p}}finally{try{h&&!h.done&&(o=f.return)&&o.call(f)}finally{if(a)throw a.error}}return c}return t.addShape({type:"marker",attrs:C(C(C({},s),{symbol:ra[e]||e}),l)})}xi("point",{defaultShapeType:"hollow-circle",getDefaultPoints:function(r){return rp(r)}});w(Mb,function(r){Pt("point","hollow-".concat(r),{draw:function(n,t){return pp(this,n,t,r,!0)},getMarker:function(n){var t=n.color;return{symbol:ra[r]||r,style:{r:4.5,stroke:t,fill:null}}}})});var bD=function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.type="point",t.shapeType="point",t.generatePoints=!0,t}return n.prototype.getDrawCfg=function(t){var e=r.prototype.getDrawCfg.call(this,t);return C(C({},e),{isStack:!!this.getAdjust("stack")})},n}(_i);function AD(r){for(var n=r[0],t=1,e=[["M",n.x,n.y]];t<r.length;){var i=r[t];(i.x!==r[t-1].x||i.y!==r[t-1].y)&&(e.push(["L",i.x,i.y]),i.x===n.x&&i.y===n.y&&t<r.length-1&&(n=r[t+1],e.push(["Z"]),e.push(["M",n.x,n.y]),t++)),t++}return Dt(pe(e),n)||e.push(["L",n.x,n.y]),e.push(["Z"]),e}xi("polygon",{defaultShapeType:"polygon",getDefaultPoints:function(r){var n=[];return w(r.x,function(t,e){var i=r.y[e];n.push({x:t,y:i})}),n}});Pt("polygon","polygon",{draw:function(r,n){if(!nr(r.points)){var t=ce(r,!0,!0),e=this.parsePath(AD(r.points));return n.addShape("path",{attrs:C(C({},t),{path:e}),name:"polygon"})}},getMarker:function(r){var n=r.color;return{symbol:"square",style:{r:4,fill:n}}}});var TD=function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.type="polygon",t.shapeType="polygon",t.generatePoints=!0,t}return n.prototype.createShapePointsCfg=function(t){var e=r.prototype.createShapePointsCfg.call(this,t),i=e.x,a=e.y,o;if(!(V(i)&&V(a))){var s=this.getXScale(),u=this.getYScale(),l=s.values.length,c=u.values.length,f=.5*1/l,h=.5*1/c;s.isCategory&&u.isCategory?(i=[i-f,i-f,i+f,i+f],a=[a-h,a+h,a+h,a-h]):V(i)?(o=i,i=[o[0],o[0],o[1],o[1]],a=[a-h/2,a+h/2,a+h/2,a-h/2]):V(a)&&(o=a,a=[o[0],o[1],o[1],o[0]],i=[i-f/2,i-f/2,i+f/2,i+f/2]),e.x=i,e.y=a}return e},n}(_i);xi("schema",{defaultShapeType:""});var MD=function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.type="schema",t.shapeType="schema",t.generatePoints=!0,t}return n.prototype.createShapePointsCfg=function(t){var e=r.prototype.createShapePointsCfg.call(this,t),i,a=this.getAttribute("size");if(a){i=this.getAttributeValues(a,t)[0];var o=this.coordinate,s=Hs(o);i=i/s}else this.defaultSize||(this.defaultSize=vp(this)),i=this.defaultSize;return e.size=i,e},n}(_i);function wD(r){if(!V(r))return[];var n=We(r);return ie(r,function(t){return t/n})}xi("violin",{defaultShapeType:"violin",getDefaultPoints:function(r){var n=r.size/2,t=[],e=wD(r._size);return w(r.y,function(i,a){var o=e[a]*n,s=a===0,u=a===r.y.length-1;t.push({isMin:s,isMax:u,x:r.x-o,y:i}),t.unshift({isMin:s,isMax:u,x:r.x+o,y:i})}),t}});Pt("violin","violin",{draw:function(r,n){var t=ce(r,!0,!0),e=this.parsePath(tb(r.points));return n.addShape("path",{attrs:C(C({},t),{path:e}),name:"violin"})},getMarker:function(r){var n=r.color;return{symbol:"circle",style:{r:4,fill:n}}}});var LD=function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.type="violin",t.shapeType="violin",t.generatePoints=!0,t}return n.prototype.createShapePointsCfg=function(t){var e=r.prototype.createShapePointsCfg.call(this,t),i,a=this.getAttribute("size");if(a){i=this.getAttributeValues(a,t)[0];var o=this.coordinate,s=Hs(o);i=i/s}else this.defaultSize||(this.defaultSize=vp(this)),i=this.defaultSize;return e.size=i,e._size=F(t[Vt],[this._sizeField]),e},n.prototype.initAttributes=function(){var t=this.attributeOption,e=t.size?t.size.fields[0]:this._sizeField?this._sizeField:"size";this._sizeField=e,delete t.size,r.prototype.initAttributes.call(this)},n}(_i);Pt("area","line",{draw:function(r,n){var t=hc(r,!0,!1,this),e=n.addShape({type:"path",attrs:t,name:"area"});return e},getMarker:function(r){var n=r.color;return{symbol:function(t,e,i){return i===void 0&&(i=5.5),[["M",t-i,e-4],["L",t+i,e-4],["L",t+i,e+4],["L",t-i,e+4],["Z"]]},style:{r:5,stroke:n,fill:null}}}});Pt("area","smooth",{draw:function(r,n){var t=this.coordinate,e=hc(r,!1,!0,this,Sb(t)),i=n.addShape({type:"path",attrs:e,name:"area"});return i},getMarker:function(r){var n=r.color;return{symbol:function(t,e,i){return i===void 0&&(i=5.5),[["M",t-i,e-4],["L",t+i,e-4],["L",t+i,e+4],["L",t-i,e+4],["Z"]]},style:{r:5,fill:n,fillOpacity:1}}}});Pt("area","smooth-line",{draw:function(r,n){var t=this.coordinate,e=hc(r,!0,!0,this,Sb(t)),i=n.addShape({type:"path",attrs:e,name:"area"});return i},getMarker:function(r){var n=r.color;return{symbol:function(t,e,i){return i===void 0&&(i=5.5),[["M",t-i,e-4],["L",t+i,e-4],["L",t+i,e+4],["L",t-i,e+4],["Z"]]},style:{r:5,stroke:n,fill:null}}}});function Th(r,n){return["C",r.x*1/2+n.x*1/2,r.y,r.x*1/2+n.x*1/2,n.y,n.x,n.y]}function Mh(r,n){var t=[];t.push({x:n.x,y:n.y}),t.push(r);var e=["Q"];return w(t,function(i){e.push(i.x,i.y)}),e}function FD(r,n,t){var e=Mh(n,t),i=[["M",r.x,r.y]];return i.push(e),i}function kD(r,n){var t=Mh(r[1],n),e=Mh(r[3],n),i=[["M",r[0].x,r[0].y]];return i.push(e),i.push(["L",r[3].x,r[3].y]),i.push(["L",r[2].x,r[2].y]),i.push(t),i.push(["L",r[1].x,r[1].y]),i.push(["L",r[0].x,r[0].y]),i.push(["Z"]),i}Pt("edge","arc",{draw:function(r,n){var t=ce(r,!0,!1,"lineWidth"),e=r.points,i=e.length>2?"weight":"normal",a;if(r.isInCircle){var o={x:0,y:1};return i==="normal"?a=FD(e[0],e[1],o):(t.fill=t.stroke,a=kD(e,o)),a=this.parsePath(a),n.addShape("path",{attrs:C(C({},t),{path:a})})}else{if(i==="normal")return e=this.parsePoints(e),a=_S((e[1].x+e[0].x)/2,e[0].y,Math.abs(e[1].x-e[0].x)/2,Math.PI,Math.PI*2),n.addShape("path",{attrs:C(C({},t),{path:a})});var s=Th(e[1],e[3]),u=Th(e[2],e[0]);return a=[["M",e[0].x,e[0].y],["L",e[1].x,e[1].y],s,["L",e[3].x,e[3].y],["L",e[2].x,e[2].y],u,["Z"]],a=this.parsePath(a),t.fill=t.stroke,n.addShape("path",{attrs:C(C({},t),{path:a})})}},getMarker:function(r){return{symbol:"circle",style:{r:4.5,fill:r.color}}}});function OD(r,n){var t=Th(r,n),e=[["M",r.x,r.y]];return e.push(t),e}Pt("edge","smooth",{draw:function(r,n){var t=ce(r,!0,!1,"lineWidth"),e=r.points,i=this.parsePath(OD(e[0],e[1]));return n.addShape("path",{attrs:C(C({},t),{path:i})})},getMarker:function(r){return{symbol:"circle",style:{r:4.5,fill:r.color}}}});var gu=1/3;function RD(r,n){var t=[];t.push({x:r.x,y:r.y*(1-gu)+n.y*gu}),t.push({x:n.x,y:r.y*(1-gu)+n.y*gu}),t.push(n);var e=[["M",r.x,r.y]];return w(t,function(i){e.push(["L",i.x,i.y])}),e}Pt("edge","vhv",{draw:function(r,n){var t=ce(r,!0,!1,"lineWidth"),e=r.points,i=this.parsePath(RD(e[0],e[1]));return n.addShape("path",{attrs:C(C({},t),{path:i})})},getMarker:function(r){return{symbol:"circle",style:{r:4.5,fill:r.color}}}});Pt("interval","funnel",{getPoints:function(r){return r.size=r.size*2,fp(r)},draw:function(r,n){var t=ce(r,!1,!0),e=this.parsePath(Tb(r.points,r.nextPoints,!1)),i=n.addShape("path",{attrs:C(C({},t),{path:e}),name:"interval"});return i},getMarker:function(r){var n=r.color;return{symbol:"square",style:{r:4,fill:n}}}});Pt("interval","hollow-rect",{draw:function(r,n){var t=ce(r,!0,!1),e=n,i=r==null?void 0:r.background;if(i){e=n.addGroup();var a=rb(r),o=Ab(r,this.parsePoints(r.points),this.coordinate);e.addShape("path",{attrs:C(C({},a),{path:o}),zIndex:-1,name:Jv})}var s=this.parsePath(hp(r.points)),u=e.addShape("path",{attrs:C(C({},t),{path:s}),name:"interval"});return i?e:u},getMarker:function(r){var n=r.color,t=r.isInPolar;return t?{symbol:"circle",style:{r:4.5,stroke:n,fill:null}}:{symbol:"square",style:{r:4,stroke:n,fill:null}}}});function ID(r){var n=r.x,t=r.y,e=r.y0;return V(t)?t.map(function(i,a){return{x:V(n)?n[a]:n,y:i}}):[{x:n,y:e},{x:n,y:t}]}Pt("interval","line",{getPoints:function(r){return ID(r)},draw:function(r,n){var t=ce(r,!0,!1,"lineWidth"),e=Ke(C({},t),["fill"]),i=this.parsePath(hp(r.points,!1)),a=n.addShape("path",{attrs:C(C({},e),{path:i}),name:"interval"});return a},getMarker:function(r){var n=r.color;return{symbol:function(t,e,i){return[["M",t,e-i],["L",t,e+i]]},style:{r:5,stroke:n}}}});Pt("interval","pyramid",{getPoints:function(r){return r.size=r.size*2,fp(r)},draw:function(r,n){var t=ce(r,!1,!0),e=this.parsePath(Tb(r.points,r.nextPoints,!0)),i=n.addShape("path",{attrs:C(C({},t),{path:e}),name:"interval"});return i},getMarker:function(r){var n=r.color;return{symbol:"square",style:{r:4,fill:n}}}});function DD(r){var n,t=r.x,e=r.y,i=r.y0,a=r.size,o,s;V(e)?(n=ut(e,2),o=n[0],s=n[1]):(o=i,s=e);var u=t+a/2,l=t-a/2;return[{x:t,y:o},{x:t,y:s},{x:l,y:o},{x:u,y:o},{x:l,y:s},{x:u,y:s}]}function PD(r){return[["M",r[0].x,r[0].y],["L",r[1].x,r[1].y],["M",r[2].x,r[2].y],["L",r[3].x,r[3].y],["M",r[4].x,r[4].y],["L",r[5].x,r[5].y]]}Pt("interval","tick",{getPoints:function(r){return DD(r)},draw:function(r,n){var t=ce(r,!0,!1),e=this.parsePath(PD(r.points)),i=n.addShape("path",{attrs:C(C({},t),{path:e}),name:"interval"});return i},getMarker:function(r){var n=r.color;return{symbol:function(t,e,i){return[["M",t-i/2,e-i],["L",t+i/2,e-i],["M",t,e-i],["L",t,e+i],["M",t-i/2,e+i],["L",t+i/2,e+i]]},style:{r:5,stroke:n}}}});var BD=function(r,n,t){var e=r.x,i=r.y,a=n.x,o=n.y,s;switch(t){case"hv":s=[{x:a,y:i}];break;case"vh":s=[{x:e,y:o}];break;case"hvh":var u=(a+e)/2;s=[{x:u,y:i},{x:u,y:o}];break;case"vhv":var l=(i+o)/2;s=[{x:e,y:l},{x:a,y:l}];break}return s};function ND(r,n){var t=[];return w(r,function(e,i){var a=r[i+1];if(t.push(e),a){var o=BD(e,a,n);t=t.concat(o)}}),t}function zD(r){return r.map(function(n,t){return t===0?["M",n.x,n.y]:["L",n.x,n.y]})}function UD(r,n){var t=fc(r.points,r.connectNulls,r.showSinglePoint),e=[];return w(t,function(i){var a=ND(i,n);e=e.concat(zD(a))}),C(C({},ce(r,!0,!1,"lineWidth")),{path:e})}w(["hv","vh","hvh","vhv"],function(r){Pt("line",r,{draw:function(n,t){var e=UD(n,r),i=t.addShape({type:"path",attrs:e,name:"line"});return i},getMarker:function(n){return nb(n,r)}})});w(SD,function(r){Pt("point",r,{draw:function(n,t){return pp(this,n,t,r,!0)},getMarker:function(n){var t=n.color;return{symbol:ra[r],style:{r:4.5,stroke:t,fill:null}}}})});Pt("point","image",{draw:function(r,n){var t,e,i=ce(r,!1,!1,"r").r,a=this.parsePoints(r.points),o=a[0];if(r.isStack)o=a[1];else if(a.length>1){var s=n.addGroup();try{for(var u=It(a),l=u.next();!l.done;l=u.next()){var c=l.value;s.addShape("image",{attrs:{x:c.x-i/2,y:c.y-i,width:i,height:i,img:r.shape[1]}})}}catch(f){t={error:f}}finally{try{l&&!l.done&&(e=u.return)&&e.call(u)}finally{if(t)throw t.error}}return s}return n.addShape("image",{attrs:{x:o.x-i/2,y:o.y-i,width:i,height:i,img:r.shape[1]}})},getMarker:function(r){var n=r.color;return{symbol:"circle",style:{r:4.5,fill:n}}}});w(Mb,function(r){Pt("point",r,{draw:function(n,t){return pp(this,n,t,r,!1)},getMarker:function(n){var t=n.color;return{symbol:ra[r]||r,style:{r:4.5,fill:t}}}})});function s0(r){var n=V(r)?r:[r],t=n[0],e=n[n.length-1],i=n.length>1?n[1]:t,a=n.length>3?n[3]:e,o=n.length>2?n[2]:i;return{min:t,max:e,min1:i,max1:a,median:o}}function u0(r,n,t){var e=t/2,i;if(V(n)){var a=s0(n),o=a.min,s=a.max,u=a.median,l=a.min1,c=a.max1,f=r-e,h=r+e;i=[[f,s],[h,s],[r,s],[r,c],[f,l],[f,c],[h,c],[h,l],[r,l],[r,o],[f,o],[h,o],[f,u],[h,u]]}else{n=G(n)?.5:n;var v=s0(r),o=v.min,s=v.max,u=v.median,l=v.min1,c=v.max1,p=n-e,d=n+e;i=[[o,p],[o,d],[o,n],[l,n],[l,p],[l,d],[c,d],[c,p],[c,n],[s,n],[s,p],[s,d],[u,p],[u,d]]}return i.map(function(g){return{x:g[0],y:g[1]}})}function HD(r){return[["M",r[0].x,r[0].y],["L",r[1].x,r[1].y],["M",r[2].x,r[2].y],["L",r[3].x,r[3].y],["M",r[4].x,r[4].y],["L",r[5].x,r[5].y],["L",r[6].x,r[6].y],["L",r[7].x,r[7].y],["L",r[4].x,r[4].y],["Z"],["M",r[8].x,r[8].y],["L",r[9].x,r[9].y],["M",r[10].x,r[10].y],["L",r[11].x,r[11].y],["M",r[12].x,r[12].y],["L",r[13].x,r[13].y]]}Pt("schema","box",{getPoints:function(r){var n=r.x,t=r.y,e=r.size;return u0(n,t,e)},draw:function(r,n){var t=ce(r,!0,!1),e=this.parsePath(HD(r.points)),i=n.addShape("path",{attrs:C(C({},t),{path:e,name:"schema"})});return i},getMarker:function(r){var n=r.color;return{symbol:function(t,e,i){var a=[e-6,e-3,e,e+3,e+6],o=u0(t,a,i);return[["M",o[0].x+1,o[0].y],["L",o[1].x-1,o[1].y],["M",o[2].x,o[2].y],["L",o[3].x,o[3].y],["M",o[4].x,o[4].y],["L",o[5].x,o[5].y],["L",o[6].x,o[6].y],["L",o[7].x,o[7].y],["L",o[4].x,o[4].y],["Z"],["M",o[8].x,o[8].y],["L",o[9].x,o[9].y],["M",o[10].x+1,o[10].y],["L",o[11].x-1,o[11].y],["M",o[12].x,o[12].y],["L",o[13].x,o[13].y]]},style:{r:6,lineWidth:1,stroke:n}}}});function $D(r){var n=V(r)?r:[r],t=n.sort(function(e,i){return i-e});return eO(t,4,t[t.length-1])}function l0(r,n,t){var e=$D(n);return[{x:r,y:e[0]},{x:r,y:e[1]},{x:r-t/2,y:e[2]},{x:r-t/2,y:e[1]},{x:r+t/2,y:e[1]},{x:r+t/2,y:e[2]},{x:r,y:e[2]},{x:r,y:e[3]}]}function GD(r){return[["M",r[0].x,r[0].y],["L",r[1].x,r[1].y],["M",r[2].x,r[2].y],["L",r[3].x,r[3].y],["L",r[4].x,r[4].y],["L",r[5].x,r[5].y],["Z"],["M",r[6].x,r[6].y],["L",r[7].x,r[7].y]]}Pt("schema","candle",{getPoints:function(r){var n=r.x,t=r.y,e=r.size;return l0(n,t,e)},draw:function(r,n){var t=ce(r,!0,!0),e=this.parsePath(GD(r.points)),i=n.addShape("path",{attrs:C(C({},t),{path:e,name:"schema"})});return i},getMarker:function(r){var n=r.color;return{symbol:function(t,e,i){var a=[e+7.5,e+3,e-3,e-7.5],o=l0(t,a,i);return[["M",o[0].x,o[0].y],["L",o[1].x,o[1].y],["M",o[2].x,o[2].y],["L",o[3].x,o[3].y],["L",o[4].x,o[4].y],["L",o[5].x,o[5].y],["Z"],["M",o[6].x,o[6].y],["L",o[7].x,o[7].y]]},style:{lineWidth:1,stroke:n,fill:n,r:6}}}});function VD(r,n){var t=Math.abs(r[0].x-r[2].x),e=Math.abs(r[0].y-r[2].y),i=Math.min(t,e);n&&(i=Kt(n,0,Math.min(t,e))),i=i/2;var a=(r[0].x+r[2].x)/2,o=(r[0].y+r[2].y)/2;return{x:a-i,y:o-i,width:i*2,height:i*2}}Pt("polygon","square",{draw:function(r,n){if(!nr(r.points)){var t=ce(r,!0,!0),e=this.parsePoints(r.points);return n.addShape("rect",{attrs:C(C({},t),VD(e,r.size)),name:"polygon"})}},getMarker:function(r){var n=r.color;return{symbol:"square",style:{r:4,fill:n}}}});Pt("violin","smooth",{draw:function(r,n){var t=ce(r,!0,!0),e=this.parsePath(eb(r.points));return n.addShape("path",{attrs:C(C({},t),{path:e})})},getMarker:function(r){var n=r.color;return{symbol:"circle",style:{stroke:null,r:4,fill:n}}}});Pt("violin","hollow",{draw:function(r,n){var t=ce(r,!0,!1),e=this.parsePath(tb(r.points));return n.addShape("path",{attrs:C(C({},t),{path:e})})},getMarker:function(r){var n=r.color;return{symbol:"circle",style:{r:4,fill:null,stroke:n}}}});Pt("violin","hollow-smooth",{draw:function(r,n){var t=ce(r,!0,!1),e=this.parsePath(eb(r.points));return n.addShape("path",{attrs:C(C({},t),{path:e})})},getMarker:function(r){var n=r.color;return{symbol:"circle",style:{r:4,fill:null,stroke:n}}}});var WD=function(r){R(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.getLabelValueDir=function(t){var e="y",i=t.points;return i[0][e]<=i[2][e]?1:-1},n.prototype.getLabelOffsetPoint=function(t,e,i,a){var o,s=r.prototype.getLabelOffsetPoint.call(this,t,e,i),u=this.getCoordinate(),l=u.isTransposed,c=l?"x":"y",f=this.getLabelValueDir(t.mappingData);return s=C(C({},s),(o={},o[c]=s[c]*f,o)),u.isReflect("x")&&(s=C(C({},s),{x:s.x*-1})),u.isReflect("y")&&(s=C(C({},s),{y:s.y*-1})),s},n.prototype.getThemedLabelCfg=function(t){var e=this.geometry,i=this.getDefaultLabelCfg(),a=e.theme;return J({},i,a.labels,t.position==="middle"?{offset:0}:{},t)},n.prototype.setLabelPosition=function(t,e,i,a){var o=this.getCoordinate(),s=o.isTransposed,u=e.points,l=o.convert(u[0]),c=o.convert(u[2]),f=this.getLabelValueDir(e),h,v,p,d,g=V(e.shape)?e.shape[0]:e.shape;if(g==="funnel"||g==="pyramid"){var y=F(e,"nextPoints"),m=F(e,"points");if(y){var x=o.convert(m[0]),_=o.convert(m[1]),E=o.convert(y[0]),b=o.convert(y[1]);s?(h=Math.min(E.y,x.y),p=Math.max(E.y,x.y),v=(_.x+b.x)/2,d=(x.x+E.x)/2):(h=Math.min((_.y+b.y)/2,(x.y+E.y)/2),p=Math.max((_.y+b.y)/2,(x.y+E.y)/2),v=b.x,d=x.x)}else h=Math.min(c.y,l.y),p=Math.max(c.y,l.y),v=c.x,d=l.x}else h=Math.min(c.y,l.y),p=Math.max(c.y,l.y),v=c.x,d=l.x;switch(a){case"right":t.x=v,t.y=(h+p)/2,t.textAlign=F(t,"textAlign",f>0?"left":"right");break;case"left":t.x=d,t.y=(h+p)/2,t.textAlign=F(t,"textAlign",f>0?"left":"right");break;case"bottom":s&&(t.x=(v+d)/2),t.y=p,t.textAlign=F(t,"textAlign","center"),t.textBaseline=F(t,"textBaseline",f>0?"bottom":"top");break;case"middle":s&&(t.x=(v+d)/2),t.y=(h+p)/2,t.textAlign=F(t,"textAlign","center"),t.textBaseline=F(t,"textBaseline","middle");break;case"top":s&&(t.x=(v+d)/2),t.y=h,t.textAlign=F(t,"textAlign","center"),t.textBaseline=F(t,"textBaseline",f>0?"bottom":"top");break}},n}(cc),yu=Math.PI/2,wb=function(r){R(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.getLabelOffset=function(t){var e=this.getCoordinate(),i=0;if(dt(t))i=t;else if(lt(t)&&t.indexOf("%")!==-1){var a=e.getRadius();e.innerRadius>0&&(a=a*(1-e.innerRadius)),i=parseFloat(t)*.01*a}return i},n.prototype.getLabelItems=function(t){var e=r.prototype.getLabelItems.call(this,t),i=this.geometry.getYScale();return ie(e,function(a){if(a&&i){var o=i.scale(F(a.data,i.field));return C(C({},a),{percent:o})}return a})},n.prototype.getLabelAlign=function(t){var e=this.getCoordinate(),i;if(t.labelEmit)i=t.angle<=Math.PI/2&&t.angle>=-Math.PI/2?"left":"right";else if(!e.isTransposed)i="center";else{var a=e.getCenter(),o=t.offset;Math.abs(t.x-a.x)<1?i="center":t.angle>Math.PI||t.angle<=0?i=o>0?"left":"right":i=o>0?"right":"left"}return i},n.prototype.getLabelPoint=function(t,e,i){var a=1,o,s=t.content[i];this.isToMiddle(e)?o=this.getMiddlePoint(e.points):(t.content.length===1&&i===0?i=1:i===0&&(a=-1),o=this.getArcPoint(e,i));var u=t.offset*a,l=this.getPointAngle(o),c=t.labelEmit,f=this.getCirclePoint(l,u,o,c);return f.r===0?f.content="":(f.content=s,f.angle=l,f.color=e.color),f.rotate=t.autoRotate?this.getLabelRotate(l,u,c):t.rotate,f.start={x:o.x,y:o.y},f},n.prototype.getArcPoint=function(t,e){return e===void 0&&(e=0),!V(t.x)&&!V(t.y)?{x:t.x,y:t.y}:{x:V(t.x)?t.x[e]:t.x,y:V(t.y)?t.y[e]:t.y}},n.prototype.getPointAngle=function(t){return Ka(this.getCoordinate(),t)},n.prototype.getCirclePoint=function(t,e,i,a){var o=this.getCoordinate(),s=o.getCenter(),u=sc(o,i);if(u===0)return C(C({},s),{r:u});var l=t;if(o.isTransposed&&u>e&&!a){var c=Math.asin(e/(2*u));l=t+c*2}else u=u+e;return{x:s.x+u*Math.cos(l),y:s.y+u*Math.sin(l),r:u}},n.prototype.getLabelRotate=function(t,e,i){var a=t+yu;return i&&(a-=yu),a&&(a>yu?a=a-Math.PI:a<-yu&&(a=a+Math.PI)),a},n.prototype.getMiddlePoint=function(t){var e=this.getCoordinate(),i=t.length,a={x:0,y:0};return w(t,function(o){a.x+=o.x,a.y+=o.y}),a.x/=i,a.y/=i,a=e.convert(a),a},n.prototype.isToMiddle=function(t){return t.x.length>2},n}(cc),jD=function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.defaultLayout="distribute",t}return n.prototype.getDefaultLabelCfg=function(t,e){var i=r.prototype.getDefaultLabelCfg.call(this,t,e);return J({},i,F(this.geometry.theme,"pieLabels",{}))},n.prototype.getLabelOffset=function(t){return r.prototype.getLabelOffset.call(this,t)||0},n.prototype.getLabelRotate=function(t,e,i){var a;return e<0&&(a=t,a>Math.PI/2&&(a=a-Math.PI),a<-Math.PI/2&&(a=a+Math.PI)),a},n.prototype.getLabelAlign=function(t){var e=this.getCoordinate(),i=e.getCenter(),a;return t.angle<=Math.PI/2&&t.x>=i.x?a="left":a="right",t.offset<=0&&(a==="right"?a="left":a="right"),a},n.prototype.getArcPoint=function(t){return t},n.prototype.getPointAngle=function(t){var e=this.getCoordinate(),i={x:V(t.x)?t.x[0]:t.x,y:t.y[0]},a={x:V(t.x)?t.x[1]:t.x,y:t.y[1]},o,s=Ka(e,i);if(t.points&&t.points[0].y===t.points[1].y)o=s;else{var u=Ka(e,a);s>=u&&(u=u+Math.PI*2),o=s+(u-s)/2}return o},n.prototype.getCirclePoint=function(t,e){var i=this.getCoordinate(),a=i.getCenter(),o=i.getRadius()+e;return C(C({},fe(a.x,a.y,o,t)),{angle:t,r:o})},n}(wb),c0=4;function XD(r,n,t,e,i,a){var o,s,u=!0,l=e.start,c=e.end,f=Math.min(l.y,c.y),h=Math.abs(l.y-c.y),v,p=0,d=Number.MIN_VALUE,g=n.map(function(M){return M.y>p&&(p=M.y),M.y<d&&(d=M.y),{size:t,targets:[M.y-f]}});for(d-=f,p-f>h&&(h=p-f);u;)for(g.forEach(function(M){var T=(Math.min.apply(d,M.targets)+Math.max.apply(d,M.targets))/2;M.pos=Math.min(Math.max(d,T-M.size/2),h-M.size)}),u=!1,v=g.length;v--;)if(v>0){var y=g[v-1],m=g[v];y.pos+y.size>m.pos&&(y.size+=m.size,y.targets=y.targets.concat(m.targets),y.pos+y.size>h&&(y.pos=h-y.size),g.splice(v,1),u=!0)}v=0,g.forEach(function(M){var T=f+t/2;M.targets.forEach(function(){n[v].y=M.pos+T,T+=t,v++})});var x={};try{for(var _=It(r),E=_.next();!E.done;E=_.next()){var b=E.value;x[b.get("id")]=b}}catch(M){o={error:M}}finally{try{E&&!E.done&&(s=_.return)&&s.call(_)}finally{if(o)throw o.error}}n.forEach(function(M){var T=M.r*M.r,k=Math.pow(Math.abs(M.y-i.y),2);if(T<k)M.x=i.x;else{var L=Math.sqrt(T-k);a?M.x=i.x+L:M.x=i.x-L}var O=x[M.id];O.attr("x",M.x),O.attr("y",M.y);var D=jr(O.getChildren(),function(W){return W.get("type")==="text"});D&&(D.attr("y",M.y),D.attr("x",M.x))})}function YD(r,n,t,e){if(!(!r.length||!n.length)){var i=r[0]?r[0].offset:0,a=n[0].get("coordinate"),o=a.getRadius(),s=a.getCenter();if(i>0){var u=14,l=o+i,c=l*2+u*2,f={start:a.start,end:a.end},h=[[],[]];r.forEach(function(v){!v||(v.textAlign==="right"?h[0].push(v):h[1].push(v))}),h.forEach(function(v,p){var d=c/u;v.length>d&&(v.sort(function(g,y){return y["..percent"]-g["..percent"]}),v.splice(d,v.length-d)),v.sort(function(g,y){return g.y-y.y}),XD(n,v,u,f,s,p)})}w(r,function(v){if(v&&v.labelLine){var p=v.offset,d=v.angle,g=fe(s.x,s.y,o,d),y=fe(s.x,s.y,o+p/2,d),m=v.x+F(v,"offsetX",0),x=v.y+F(v,"offsetY",0),_={x:m-Math.cos(d)*c0,y:x-Math.sin(d)*c0};wt(v.labelLine)||(v.labelLine={}),v.labelLine.path=["M ".concat(g.x),"".concat(g.y," Q").concat(y.x),"".concat(y.y," ").concat(_.x),_.y].join(",")}})}}function Lb(r,n,t){var e=r.filter(function(p){return!p.invisible});e.sort(function(p,d){return p.y-d.y});var i=!0,a=t.minY,o=t.maxY,s=Math.abs(a-o),u,l=0,c=Number.MIN_VALUE,f=e.map(function(p){return p.y>l&&(l=p.y),p.y<c&&(c=p.y),{content:p.content,size:n,targets:[p.y-a],pos:null}});for(c-=a,l-a>s&&(s=l-a);i;)for(f.forEach(function(p){var d=(Math.min.apply(c,p.targets)+Math.max.apply(c,p.targets))/2;p.pos=Math.min(Math.max(c,d-p.size/2),s-p.size),p.pos=Math.max(0,p.pos)}),i=!1,u=f.length;u--;)if(u>0){var h=f[u-1],v=f[u];h.pos+h.size>v.pos&&(h.size+=v.size,h.targets=h.targets.concat(v.targets),h.pos+h.size>s&&(h.pos=s-h.size),f.splice(u,1),i=!0)}u=0,f.forEach(function(p){var d=a+n/2;p.targets.forEach(function(){e[u].y=p.pos+d,d+=n,u++})})}var f0=4;function ZD(r,n){var t=n.getCenter(),e=n.getRadius();if(r&&r.labelLine){var i=r.angle,a=r.offset,o=fe(t.x,t.y,e,i),s=r.x+F(r,"offsetX",0)*(Math.cos(i)>0?1:-1),u=r.y+F(r,"offsetY",0)*(Math.sin(i)>0?1:-1),l={x:s-Math.cos(i)*f0,y:u-Math.sin(i)*f0},c=r.labelLine.smooth,f=[],h=l.x-t.x,v=l.y-t.y,p=Math.atan(v/h);if(h<0&&(p+=Math.PI),c===!1){wt(r.labelLine)||(r.labelLine={});var d=0;(i<0&&i>-Math.PI/2||i>Math.PI*1.5)&&l.y>o.y&&(d=1),i>=0&&i<Math.PI/2&&l.y>o.y&&(d=1),i>=Math.PI/2&&i<Math.PI&&o.y>l.y&&(d=1),(i<-Math.PI/2||i>=Math.PI&&i<Math.PI*1.5)&&o.y>l.y&&(d=1);var g=a/2>4?4:Math.max(a/2-1,0),y=fe(t.x,t.y,e+g,i),m=fe(t.x,t.y,e+a/2,p),x=0;f.push("M ".concat(o.x," ").concat(o.y)),f.push("L ".concat(y.x," ").concat(y.y)),f.push("A ".concat(t.x," ").concat(t.y," 0 ").concat(x," ").concat(d," ").concat(m.x," ").concat(m.y)),f.push("L ".concat(l.x," ").concat(l.y))}else{var y=fe(t.x,t.y,e+(a/2>4?4:Math.max(a/2-1,0)),i),_=o.x<t.x?1:-1;f.push("M ".concat(l.x," ").concat(l.y));var E=(o.y-t.y)/(o.x-t.x),b=(l.y-t.y)/(l.x-t.x);Math.abs(E-b)>Math.pow(Math.E,-16)&&f.push.apply(f,["C",l.x+_*4,l.y,2*y.x-o.x,2*y.y-o.y,o.x,o.y]),f.push("L ".concat(o.x," ").concat(o.y))}r.labelLine.path=f.join(" ")}}function qD(r,n,t,e){var i,a,o=Pe(r,function(T){return!G(T)}),s=n[0]&&n[0].get("coordinate");if(!!s){var u=s.getCenter(),l=s.getRadius(),c={};try{for(var f=It(n),h=f.next();!h.done;h=f.next()){var v=h.value;c[v.get("id")]=v}}catch(T){i={error:T}}finally{try{h&&!h.done&&(a=f.return)&&a.call(f)}finally{if(i)throw i.error}}var p=F(o[0],"labelHeight",14),d=F(o[0],"offset",0);if(!(d<=0)){var g="left",y="right",m=dr(o,function(T){return T.x<u.x?g:y}),x=s.start,_=s.end,E=Math.min((l+d+p)*2,s.getHeight()),b=E/2,M={minX:x.x,maxX:_.x,minY:u.y-b,maxY:u.y+b};w(m,function(T,k){var L=Math.floor(E/p);T.length>L&&(T.sort(function(O,D){return D.percent-O.percent}),w(T,function(O,D){D+1>L&&(c[O.id].set("visible",!1),O.invisible=!0)})),Lb(T,p,M)}),w(m,function(T,k){w(T,function(L){var O=k===y,D=c[L.id],W=D.getChildByIndex(0);if(W){var j=l+d,ot=L.y-u.y,z=Math.pow(j,2),X=Math.pow(ot,2),K=z-X>0?z-X:0,Q=Math.sqrt(K),q=Math.abs(Math.cos(L.angle)*j);O?L.x=u.x+Math.max(Q,q):L.x=u.x-Math.max(Q,q)}W&&(W.attr("y",L.y),W.attr("x",L.x)),ZD(L,s)})})}}}var wh=4,KD=4,h0=4;function QD(r,n,t){var e=n.getCenter(),i=n.getRadius(),a={x:r.x-(t?h0:-h0),y:r.y},o=fe(e.x,e.y,i+wh,r.angle),s={x:a.x,y:a.y},u={x:o.x,y:o.y},l=fe(e.x,e.y,i,r.angle),c="";if(a.y!==o.y){var f=t?4:-4;s.y=a.y,r.angle<0&&r.angle>=-Math.PI/2&&(s.x=Math.max(o.x,a.x-f),a.y<o.y?u.y=s.y:(u.y=o.y,u.x=Math.max(u.x,s.x-f))),r.angle>0&&r.angle<Math.PI/2&&(s.x=Math.max(o.x,a.x-f),a.y>o.y?u.y=s.y:(u.y=o.y,u.x=Math.max(u.x,s.x-f))),r.angle>Math.PI/2&&(s.x=Math.min(o.x,a.x-f),a.y>o.y?u.y=s.y:(u.y=o.y,u.x=Math.min(u.x,s.x-f))),r.angle<-Math.PI/2&&(s.x=Math.min(o.x,a.x-f),a.y<o.y?u.y=s.y:(u.y=o.y,u.x=Math.min(u.x,s.x-f)))}c=["M ".concat(a.x,",").concat(a.y),"L ".concat(s.x,",").concat(s.y),"L ".concat(u.x,",").concat(u.y),"L ".concat(o.x,",").concat(o.y),"L ".concat(l.x,",").concat(l.y)].join(" "),r.labelLine=J({},r.labelLine,{path:c})}function JD(r,n,t,e){var i,a,o=n[0]&&n[0].get("coordinate");if(!!o){var s=o.getCenter(),u=o.getRadius(),l={};try{for(var c=It(n),f=c.next();!f.done;f=c.next()){var h=f.value;l[h.get("id")]=h}}catch(T){i={error:T}}finally{try{f&&!f.done&&(a=c.return)&&a.call(c)}finally{if(i)throw i.error}}var v=F(r[0],"labelHeight",14),p=Math.max(F(r[0],"offset",0),wh);w(r,function(T){if(!!T){var k=F(l,[T.id]);if(!!k){var L=T.x>s.x||T.x===s.x&&T.y>s.y,O=G(T.offsetX)?KD:T.offsetX,D=fe(s.x,s.y,u+wh,T.angle),W=p+O;T.x=s.x+(L?1:-1)*(u+W),T.y=D.y}}});var d=o.start,g=o.end,y="left",m="right",x=dr(r,function(T){return T.x<s.x?y:m}),_=(u+p)*2+v;w(x,function(T){var k=T.length*v;k>_&&(_=Math.min(k,Math.abs(d.y-g.y)))});var E={minX:d.x,maxX:g.x,minY:s.y-_/2,maxY:s.y+_/2};w(x,function(T,k){var L=_/v;T.length>L&&(T.sort(function(O,D){return D.percent-O.percent}),w(T,function(O,D){D>L&&(l[O.id].set("visible",!1),O.invisible=!0)})),Lb(T,v,E)});var b=E.minY,M=E.maxY;w(x,function(T,k){var L=k===m;w(T,function(O){var D=F(l,O&&[O.id]);if(!!D){if(O.y<b||O.y>M){D.set("visible",!1);return}var W=D.getChildByIndex(0),j=W.getCanvasBBox(),ot={x:L?j.x:j.maxX,y:j.y+j.height/2};Vs(W,O.x-ot.x,O.y-ot.y),O.labelLine&&QD(O,o,L)}})})}}function tP(r,n,t,e){w(n,function(i){var a=e.minX,o=e.minY,s=e.maxX,u=e.maxY,l=i.getCanvasBBox(),c=l.minX,f=l.minY,h=l.maxX,v=l.maxY,p=l.x,d=l.y,g=l.width,y=l.height,m=p,x=d;(c<a||h<a)&&(m=a),(f<o||v<o)&&(x=o),c>s?m=s-g:h>s&&(m=m-(h-s)),f>u?x=u-y:v>u&&(x=x-(v-u)),(m!==p||x!==d)&&Vs(i,m-p,x-d)})}function eP(r,n,t,e){w(n,function(i,a){var o=i.getCanvasBBox(),s=t[a].getBBox();(o.minX<s.minX||o.minY<s.minY||o.maxX>s.maxX||o.maxY>s.maxY)&&i.remove(!0)})}var rP=100,Fb=function(){function r(n){n===void 0&&(n={}),this.bitmap={};var t=n.xGap,e=t===void 0?1:t,i=n.yGap,a=i===void 0?8:i;this.xGap=e,this.yGap=a}return r.prototype.hasGap=function(n){for(var t=!0,e=this.bitmap,i=Math.round(n.minX),a=Math.round(n.maxX),o=Math.round(n.minY),s=Math.round(n.maxY),u=i;u<=a;u+=1){if(!e[u]){e[u]={};continue}if(u===i||u===a){for(var l=o;l<=s;l++)if(e[u][l]){t=!1;break}}else if(e[u][o]||e[u][s]){t=!1;break}}return t},r.prototype.fillGap=function(n){for(var t=this.bitmap,e=Math.round(n.minX),i=Math.round(n.maxX),a=Math.round(n.minY),o=Math.round(n.maxY),s=e;s<=i;s+=1)t[s]||(t[s]={});for(var s=e;s<=i;s+=this.xGap){for(var u=a;u<=o;u+=this.yGap)t[s][u]=!0;t[s][o]=!0}if(this.yGap!==1)for(var s=a;s<=o;s+=1)t[e][s]=!0,t[i][s]=!0;if(this.xGap!==1)for(var s=e;s<=i;s+=1)t[s][a]=!0,t[s][o]=!0},r.prototype.destroy=function(){this.bitmap={}},r}();function nP(r,n,t){t===void 0&&(t=rP);var e=-1,i=r.attr(),a=i.x,o=i.y,s=r.getCanvasBBox(),u=Math.sqrt(s.width*s.width+s.height*s.height),l,c=-e,f=0,h=0,v=function(y){var m=y*.1;return[m*Math.cos(m),m*Math.sin(m)]};if(n.hasGap(s))return n.fillGap(s),!0;for(var p=!1,d=0,g={};Math.min(Math.abs(f),Math.abs(h))<u&&d<t;)if(l=v(c+=e),f=~~l[0],h=~~l[1],!(!f&&!h||g["".concat(f,"-").concat(h)])&&(r.attr({x:a+f,y:o+h}),f+h<0&&r.attr("textAlign","right"),d++,n.hasGap(r.getCanvasBBox()))){n.fillGap(r.getCanvasBBox()),p=!0,g["".concat(f,"-").concat(h)]=!0;break}return p}function iP(r,n,t,e){var i=r.getCanvasBBox(),a=i.width,o=i.height,s={x:n,y:t,textAlign:"center"};switch(e){case 0:s.y-=o+1,s.x+=1,s.textAlign="left";break;case 1:s.y-=o+1,s.x-=1,s.textAlign="right";break;case 2:s.y+=o+1,s.x-=1,s.textAlign="right";break;case 3:s.y+=o+1,s.x+=1,s.textAlign="left";break;case 5:s.y-=o*2+2;break;case 6:s.y+=o*2+2;break;case 7:s.x+=a+1,s.textAlign="left";break;case 8:s.x-=a+1,s.textAlign="right";break}return r.attr(s),r.getCanvasBBox()}function aP(r,n,t,e){var i=new Fb;w(n,function(a){var o=a.find(function(s){return s.get("type")==="text"});nP(o,i)||a.remove(!0)}),i.destroy()}function oP(r,n,t,e){var i=new Fb;w(n,function(a){for(var o=a.find(function(v){return v.get("type")==="text"}),s=o.attr(),u=s.x,l=s.y,c=!1,f=0;f<=8;f++){var h=iP(o,u,l,f);if(i.hasGap(h)){i.fillGap(h),c=!0;break}}c||a.remove(!0)}),i.destroy()}function sP(r,n){return(r[0]||0)*(n[0]||0)+(r[1]||0)*(n[1]||0)+(r[2]||0)*(n[2]||0)}function v0(r){if(r.length>4)return[];var n=function(i,a){return[a.x-i.x,a.y-i.y]},t=n(r[0],r[1]),e=n(r[1],r[2]);return[t,e]}function mu(r,n,t){n===void 0&&(n=0),t===void 0&&(t={x:0,y:0});var e=r.x,i=r.y;return{x:(e-t.x)*Math.cos(-n)+(i-t.y)*Math.sin(-n)+t.x,y:(t.x-e)*Math.sin(-n)+(i-t.y)*Math.cos(-n)+t.y}}function p0(r){var n=[{x:r.x,y:r.y},{x:r.x+r.width,y:r.y},{x:r.x+r.width,y:r.y+r.height},{x:r.x,y:r.y+r.height}],t=r.rotation;return t?[mu(n[0],t,n[0]),mu(n[1],t,n[0]),mu(n[2],t,n[0]),mu(n[3],t,n[0])]:n}function d0(r,n){if(r.length>4)return{min:0,max:0};var t=[];return r.forEach(function(e){t.push(sP([e.x,e.y],n))}),{min:Math.min.apply(Math,te([],ut(t),!1)),max:Math.max.apply(Math,te([],ut(t),!1))}}function uP(r,n){return r.max>n.min&&r.min<n.max}function lP(r){return typeof r=="number"&&!Number.isNaN(r)&&r!==1/0&&r!==-1/0}function g0(r){return["x","y","width","height"].every(function(n){return lP(r[n])})}function cP(r,n,t){return t===void 0&&(t=0),!(n.x>r.x+r.width+t||n.x+n.width<r.x-t||n.y>r.y+r.height+t||n.y+n.height<r.y-t)}function fP(r,n,t){if(t===void 0&&(t=0),!g0(r)||!g0(n))return!1;if(!r.rotation&&!n.rotation)return cP(r,n,t);for(var e=p0(r),i=p0(n),a=v0(e).concat(v0(i)),o=0;o<a.length;o++){var s=a[o],u=d0(e,s),l=d0(i,s);if(!uP(u,l))return!1}return!0}var hP=function(){function r(n){var t=this;this.queue=[],this.worker=new Worker(n),this.worker.onmessage=function(e){var i;(i=t.queue.shift())===null||i===void 0||i.resolve(e)},this.worker.onmessageerror=function(e){var i;console.warn("[AntV G2] Web worker is not available"),(i=t.queue.shift())===null||i===void 0||i.reject(e)}}return r.prototype.post=function(n,t){var e=this;return new Promise(function(i,a){e.queue.push({resolve:i,reject:a});try{e.worker.postMessage(n)}catch{console.warn("[AntV G2] Web worker is not available"),rt(t)&&t()}})},r.prototype.destroy=function(){this.worker.terminate()},r}();function vP(r){if(!(typeof window>"u")){var n;try{n=new Blob([r.toString()],{type:"application/javascript"})}catch{n=new window.BlobBuilder,n.append(r.toString()),n=n.getBlob()}return new hP(URL.createObjectURL(n))}}var pP=function(r){function n(){function l(x,_){return(x[0]||0)*(_[0]||0)+(x[1]||0)*(_[1]||0)+(x[2]||0)*(_[2]||0)}function c(x){if(x.length>4)return[];var _=function(M,T){return[T.x-M.x,T.y-M.y]},E=_(x[0],x[1]),b=_(x[1],x[2]);return[E,b]}function f(x,_,E){_===void 0&&(_=0),E===void 0&&(E={x:0,y:0});var b=x.x,M=x.y;return{x:(b-E.x)*Math.cos(-_)+(M-E.y)*Math.sin(-_)+E.x,y:(E.x-b)*Math.sin(-_)+(M-E.y)*Math.cos(-_)+E.y}}function h(x){var _=[{x:x.x,y:x.y},{x:x.x+x.width,y:x.y},{x:x.x+x.width,y:x.y+x.height},{x:x.x,y:x.y+x.height}],E=x.rotation;return E?[f(_[0],E,_[0]),f(_[1],E,_[0]),f(_[2],E,_[0]),f(_[3],E,_[0])]:_}function v(x,_){if(x.length>4)return{min:0,max:0};var E=[];return x.forEach(function(b){E.push(l([b.x,b.y],_))}),{min:Math.min.apply(null,E),max:Math.max.apply(null,E)}}function p(x,_){return x.max>_.min&&x.min<_.max}function d(x){return typeof x=="number"&&!Number.isNaN(x)&&x!==1/0&&x!==-1/0}function g(x){return["x","y","width","height"].every(function(_){return d(x[_])})}function y(x,_,E){return E===void 0&&(E=0),!(_.x>x.x+x.width+E||_.x+_.width<x.x-E||_.y>x.y+x.height+E||_.y+_.height<x.y-E)}function m(x,_,E){if(E===void 0&&(E=0),!g(x)||!g(_))return!1;if(!x.rotation&&!_.rotation)return y(x,_,E);for(var b=h(x),M=h(_),T=c(b).concat(c(M)),k=0;k<T.length;k++){var L=T[k],O=v(b,L),D=v(M,L);if(!p(O,D))return!1}return!0}return{intersect:m}}var t=n().intersect;function e(l){for(var c=l.slice(),f=0;f<c.length;f++){var h=c[f];if(h.visible)for(var v=f+1;v<c.length;v++){var p=c[v];h!==p&&p.visible&&t(h,p)&&(p.visible=!1)}}return c}var i={"hide-overlap":e};try{var a=JSON.parse(r.data);if(!a||!a.type||!i[a.type])return;var o=a.type,s=a.items,u=i[o](s);self.postMessage(u)}catch(l){throw l}},dP=`
   self.onmessage = `.concat(pP.toString(),`
`),af=function(r){for(var n=r.slice(),t=0;t<n.length;t++){var e=n[t];if(e.visible)for(var i=t+1;i<n.length;i++){var a=n[i];e!==a&&a.visible&&fP(e,a)&&(a.visible=!1)}}return n},of=new Map,y0=vP(dP);function gP(r,n,t,e){return is(this,void 0,void 0,function(){var i,a,o,s,u,l;return as(this,function(c){switch(c.label){case 0:return i=n.map(function(f,h){return C(C({},qS(f,r[h],F(r[h],"background.padding"))),{visible:!0})}),a=JSON.stringify(i),o=function(f){return of.set(a,f),w(f,function(h,v){var p=h.visible,d=n[v];p?d==null||d.show():d==null||d.hide()}),f},of.get(a)?(o(of.get(a)),[3,7]):[3,1];case 1:if(!y0)return[3,6];c.label=2;case 2:return c.trys.push([2,4,,5]),s=JSON.stringify({type:"hide-overlap",items:i}),[4,y0.post(s,function(){return o(af(i))})];case 3:return u=c.sent(),o(Array.isArray(u.data)?u.data:[]),[3,5];case 4:return l=c.sent(),console.error(l),o(af(i)),[3,5];case 5:return[3,7];case 6:o(af(i)),c.label=7;case 7:return[2]}})})}var m0={"#5B8FF9":!0},yP=function(r){var n=ii.toRGB(r).toUpperCase();if(m0[n])return m0[n];var t=ut(ii.rgb2arr(n),3),e=t[0],i=t[1],a=t[2],o=(e*299+i*587+a*114)/1e3<128;return o};function mP(r,n,t){if(t.length!==0){var e=t[0].get("element"),i=e.geometry.theme,a=i.labels||{},o=a.fillColorLight,s=a.fillColorDark;t.forEach(function(u,l){var c=n[l],f=c.find(function(y){return y.get("type")==="text"}),h=je.fromObject(u.getBBox()),v=je.fromObject(f.getCanvasBBox()),p=!h.contains(v),d=u.attr("fill"),g=yP(d);p?f.attr(i.overflowLabels.style):g?o&&f.attr("fill",o):s&&f.attr("fill",s)})}}function xP(r,n,t){var e=r.coordinate,i=fi(n),a=je.fromObject(i.getCanvasBBox()),o=je.fromObject(t.getBBox());return e.isTransposed?o.height>=a.height:o.width>=a.width}function _P(r,n,t){var e=!!r.getAdjust("stack");return e||n.every(function(i,a){var o=t[a];return xP(r,i,o)})}function CP(r,n,t){var e=r.coordinate,i=je.fromObject(t.getBBox()),a=fi(n);e.isTransposed?a.attr({x:i.minX+i.width/2,textAlign:"center"}):a.attr({y:i.minY+i.height/2,textBaseline:"middle"})}function EP(r,n,t){var e;if(t.length!==0){var i=(e=t[0])===null||e===void 0?void 0:e.get("element"),a=i==null?void 0:i.geometry;if(!(!a||a.type!=="interval")){var o=_P(a,n,t);o&&t.forEach(function(s,u){var l=n[u];CP(a,l,s)})}}}function SP(r){var n=500,t=[],e=Math.max(Math.floor(r.length/n),1);return w(r,function(i,a){a%e===0?t.push(i):i.set("visible",!1)}),t}function bP(r,n,t){var e;if(t.length!==0){var i=(e=t[0])===null||e===void 0?void 0:e.get("element"),a=i==null?void 0:i.geometry;if(!(!a||a.type!=="interval")){var o=SP(n),s=ut(a.getXYFields(),1),u=s[0],l=[],c=[],f=dr(o,function(g){return g.get("data")[u]}),h=qa(ie(o,function(g){return g.get("data")[u]})),v;o.forEach(function(g){g.set("visible",!0)});var p=function(g){g&&(g.length&&c.push(g.pop()),c.push.apply(c,te([],ut(g),!1)))};for(Ee(h)>0&&(v=h.shift(),p(f[v])),Ee(h)>0&&(v=h.pop(),p(f[v])),w(h.reverse(),function(g){p(f[g])});c.length>0;){var d=c.shift();d.get("visible")&&(dR(d,l)?d.set("visible",!1):l.push(d))}}}}function AP(r,n){var t=r.getXYFields()[1],e=[],i=n.sort(function(a,o){return a.get("data")[t]-a.get("data")[t]});return i.length>0&&e.push(i.shift()),i.length>0&&e.push(i.pop()),e.push.apply(e,te([],ut(i),!1)),e}function kb(r,n,t){return r.some(function(e){return t(e,n)})}function TP(r,n,t){t===void 0&&(t=0);var e=Math.max(0,Math.min(r.x+r.width+t,n.x+n.width+t)-Math.max(r.x-t,n.x-t)),i=Math.max(0,Math.min(r.y+r.height+t,n.y+n.height+t)-Math.max(r.y-t,n.y-t));return e*i}function x0(r,n){return kb(r,n,function(t,e){var i=fi(t),a=fi(e);return TP(i.getCanvasBBox(),a.getCanvasBBox(),2)>0})}function MP(r,n,t,e,i){var a,o;if(t.length!==0){var s=(a=t[0])===null||a===void 0?void 0:a.get("element"),u=s==null?void 0:s.geometry;if(!(!u||u.type!=="point")){var l=ut(u.getXYFields(),2),c=l[0],f=l[1],h=dr(n,function(d){return d.get("data")[c]}),v=[],p=i&&i.offset||((o=r[0])===null||o===void 0?void 0:o.offset)||12;ie(oo(h).reverse(),function(d){for(var g=AP(u,h[d]);g.length;){var y=g.shift(),m=fi(y);if(kb(v,y,function(E,b){return E.get("data")[c]===b.get("data")[c]&&E.get("data")[f]===b.get("data")[f]})){m.set("visible",!1);continue}var x=x0(v,y),_=!1;if(x&&(m.attr("y",m.attr("y")+2*p),_=x0(v,y)),_){m.set("visible",!1);continue}v.push(y)}})}}}function wP(r,n){var t=r.getXYFields()[1],e=[],i=n.sort(function(a,o){return a.get("data")[t]-a.get("data")[t]});return i.length>0&&e.push(i.shift()),i.length>0&&e.push(i.pop()),e.push.apply(e,te([],ut(i),!1)),e}function Ob(r,n,t){return r.some(function(e){return t(e,n)})}function LP(r,n,t){t===void 0&&(t=0);var e=Math.max(0,Math.min(r.x+r.width+t,n.x+n.width+t)-Math.max(r.x-t,n.x-t)),i=Math.max(0,Math.min(r.y+r.height+t,n.y+n.height+t)-Math.max(r.y-t,n.y-t));return e*i}function _0(r,n){return Ob(r,n,function(t,e){var i=fi(t),a=fi(e);return LP(i.getCanvasBBox(),a.getCanvasBBox(),2)>0})}function FP(r,n,t,e,i){var a,o;if(t.length!==0){var s=(a=t[0])===null||a===void 0?void 0:a.get("element"),u=s==null?void 0:s.geometry;if(!(!u||["path","line","area"].indexOf(u.type)<0)){var l=ut(u.getXYFields(),2),c=l[0],f=l[1],h=dr(n,function(d){return d.get("data")[c]}),v=[],p=i&&i.offset||((o=r[0])===null||o===void 0?void 0:o.offset)||12;ie(oo(h).reverse(),function(d){for(var g=wP(u,h[d]);g.length;){var y=g.shift(),m=fi(y);if(Ob(v,y,function(E,b){return E.get("data")[c]===b.get("data")[c]&&E.get("data")[f]===b.get("data")[f]})){m.set("visible",!1);continue}var x=_0(v,y),_=!1;if(x&&(m.attr("y",m.attr("y")+2*p),_=_0(v,y)),_){m.set("visible",!1);continue}v.push(y)}})}}}var sf;function kP(){return sf||(sf=document.createElement("canvas").getContext("2d")),sf}var xu=so(function(r,n){n===void 0&&(n={});var t=n.fontSize,e=n.fontFamily,i=n.fontWeight,a=n.fontStyle,o=n.fontVariant,s=kP();return s.font=[a,o,i,"".concat(t,"px"),e].join(" "),s.measureText(lt(r)?r:"").width},function(r,n){return n===void 0&&(n={}),te([r],ut(Pl(n)),!1).join("")}),OP=function(r,n,t){var e=16,i=xu("...",t),a;lt(r)?a=r:a=Ds(r);var o=n,s=[],u,l;if(xu(r,t)<=n)return r;for(;u=a.substr(0,e),l=xu(u,t),!(l+i>o&&l>o);)if(s.push(u),o-=l,a=a.substr(e),!a)return s.join("");for(;u=a.substr(0,1),l=xu(u,t),!(l+i>o);)if(s.push(u),o-=l,a=a.substr(1),!a)return s.join("");return"".concat(s.join(""),"...")};function RP(r,n,t,e,i){if(!(n.length<=0)){var a=(i==null?void 0:i.direction)||["top","right","bottom","left"],o=(i==null?void 0:i.action)||"translate",s=(i==null?void 0:i.margin)||0,u=n[0].get("coordinate");if(!!u){var l=aO(u,s),c=l.minX,f=l.minY,h=l.maxX,v=l.maxY;w(n,function(p){var d=p.getCanvasBBox(),g=d.minX,y=d.minY,m=d.maxX,x=d.maxY,_=d.x,E=d.y,b=d.width,M=d.height,T=_,k=E;if(a.indexOf("left")>=0&&(g<c||m<c)&&(T=c),a.indexOf("top")>=0&&(y<f||x<f)&&(k=f),a.indexOf("right")>=0&&(g>h?T=h-b:m>h&&(T=T-(m-h))),a.indexOf("bottom")>=0&&(y>v?k=v-M:x>v&&(k=k-(x-v))),T!==_||k!==E){var L=T-_;if(o==="translate")Vs(p,L,k-E);else if(o==="ellipsis"){var O=p.findAll(function(D){return D.get("type")==="text"});O.forEach(function(D){var W=li(D.attr(),["fontSize","fontFamily","fontWeight","fontStyle","fontVariant"]),j=D.getCanvasBBox(),ot=OP(D.attr("text"),j.width-Math.abs(L),W);D.attr("text",ot)})}else p.hide()}})}}}function IP(r,n,t){var e={fillOpacity:G(r.attr("fillOpacity"))?1:r.attr("fillOpacity"),strokeOpacity:G(r.attr("strokeOpacity"))?1:r.attr("strokeOpacity"),opacity:G(r.attr("opacity"))?1:r.attr("opacity")};r.attr({fillOpacity:0,strokeOpacity:0,opacity:0}),r.animate(e,n)}function DP(r,n,t){var e={fillOpacity:0,strokeOpacity:0,opacity:0},i=n.easing,a=n.duration,o=n.delay;r.animate(e,a,i,function(){r.remove(!0)},o)}function PP(r,n,t){var e,i=ut(n,2),a=i[0],o=i[1];return r.applyToMatrix([a,o,1]),t==="x"?(r.setMatrix(ve(r.getMatrix(),[["t",-a,-o],["s",.01,1],["t",a,o]])),e=ve(r.getMatrix(),[["t",-a,-o],["s",100,1],["t",a,o]])):t==="y"?(r.setMatrix(ve(r.getMatrix(),[["t",-a,-o],["s",1,.01],["t",a,o]])),e=ve(r.getMatrix(),[["t",-a,-o],["s",1,100],["t",a,o]])):t==="xy"&&(r.setMatrix(ve(r.getMatrix(),[["t",-a,-o],["s",.01,.01],["t",a,o]])),e=ve(r.getMatrix(),[["t",-a,-o],["s",100,100],["t",a,o]])),e}function dp(r,n,t,e,i){var a=t.start,o=t.end,s=t.getWidth(),u=t.getHeight(),l,c;i==="y"?(l=a.x+s/2,c=e.y<a.y?e.y:a.y):i==="x"?(l=e.x>a.x?e.x:a.x,c=a.y+u/2):i==="xy"&&(t.isPolar?(l=t.getCenter().x,c=t.getCenter().y):(l=(a.x+o.x)/2,c=(a.y+o.y)/2));var f=PP(r,[l,c],i);r.animate({matrix:f},n)}function BP(r,n,t){var e=t.coordinate,i=t.minYPoint;dp(r,n,e,i,"x")}function NP(r,n,t){var e=t.coordinate,i=t.minYPoint;dp(r,n,e,i,"y")}function zP(r,n,t){var e=t.coordinate,i=t.minYPoint;dp(r,n,e,i,"xy")}function UP(r,n,t){var e=r.getTotalLength();r.attr("lineDash",[e]),r.animate(function(i){return{lineDashOffset:(1-i)*e}},n)}function HP(r,n,t){var e=t.toAttrs,i=e.x,a=e.y;delete e.x,delete e.y,r.attr(e),r.animate({x:i,y:a},n)}function $P(r,n,t){var e=r.getBBox(),i=r.get("origin").mappingData,a=i.points,o=a[0].y-a[1].y>0?e.maxX:e.minX,s=(e.minY+e.maxY)/2;r.applyToMatrix([o,s,1]);var u=ve(r.getMatrix(),[["t",-o,-s],["s",.01,1],["t",o,s]]);r.setMatrix(u),r.animate({matrix:ve(r.getMatrix(),[["t",-o,-s],["s",100,1],["t",o,s]])},n)}function GP(r,n,t){var e=r.getBBox(),i=r.get("origin").mappingData,a=(e.minX+e.maxX)/2,o=i.points,s=o[0].y-o[1].y<=0?e.maxY:e.minY;r.applyToMatrix([a,s,1]);var u=ve(r.getMatrix(),[["t",-a,-s],["s",1,.01],["t",a,s]]);r.setMatrix(u),r.animate({matrix:ve(r.getMatrix(),[["t",-a,-s],["s",1,100],["t",a,s]])},n)}function C0(r,n){var t,e=hl(r,n),i=e.startAngle,a=e.endAngle;return!we(i,-Math.PI*.5)&&i<-Math.PI*.5&&(i+=Math.PI*2),!we(a,-Math.PI*.5)&&a<-Math.PI*.5&&(a+=Math.PI*2),n[5]===0&&(t=ut([a,i],2),i=t[0],a=t[1]),we(i,Math.PI*1.5)&&(i=Math.PI*-.5),we(a,Math.PI*-.5)&&!we(i,a)&&(a=Math.PI*1.5),{startAngle:i,endAngle:a}}function E0(r){var n;return r[0]==="M"||r[0]==="L"?n=[r[1],r[2]]:(r[0]==="a"||r[0]==="A"||r[0]==="C")&&(n=[r[r.length-2],r[r.length-1]]),n}function S0(r){var n,t,e,i=r.filter(function(x){return x[0]==="A"||x[0]==="a"});if(i.length===0)return{startAngle:0,endAngle:0,radius:0,innerRadius:0};var a=i[0],o=i.length>1?i[1]:i[0],s=r.indexOf(a),u=r.indexOf(o),l=E0(r[s-1]),c=E0(r[u-1]),f=C0(l,a),h=f.startAngle,v=f.endAngle,p=C0(c,o),d=p.startAngle,g=p.endAngle;we(h,d)&&we(v,g)?(t=h,e=v):(t=Math.min(h,d),e=Math.max(v,g));var y=a[1],m=i[i.length-1][1];return y<m?(n=ut([m,y],2),y=n[0],m=n[1]):y===m&&(m=0),{startAngle:t,endAngle:e,radius:y,innerRadius:m}}function VP(r,n,t){var e=t.toAttrs,i=t.coordinate,a=e.path||[],o=a.map(function(m){return m[0]});if(!(a.length<1)){var s=S0(a),u=s.startAngle,l=s.endAngle,c=s.radius,f=s.innerRadius,h=S0(r.attr("path")),v=h.startAngle,p=h.endAngle,d=i.getCenter(),g=u-v,y=l-p;if(g===0&&y===0){r.attr("path",a);return}r.animate(function(m){var x=v+m*g,_=p+m*y;return C(C({},e),{path:Dt(o,["M","A","A","Z"])?_S(d.x,d.y,c,x,_):ai(d.x,d.y,c,x,_,f)})},C(C({},n),{callback:function(){r.attr("path",a)}}))}}function WP(r,n,t){var e=Wv(t.coordinate,20),i=e.type,a=e.startState,o=e.endState,s=r.setClip({type:i,attrs:a});t.toAttrs&&r.attr(t.toAttrs),s.animate(o,C(C({},n),{callback:function(){r&&!r.get("destroyed")&&r.set("clipShape",null),s.remove(!0)}}))}function gp(r,n,t){if(r.isGroup())w(r.getChildren(),function(s){gp(s,n,t)});else{var e=r.getBBox(),i=(e.minX+e.maxX)/2,a=(e.minY+e.maxY)/2;if(r.applyToMatrix([i,a,1]),t==="zoomIn"){var o=ve(r.getMatrix(),[["t",-i,-a],["s",.01,.01],["t",i,a]]);r.setMatrix(o),r.animate({matrix:ve(r.getMatrix(),[["t",-i,-a],["s",100,100],["t",i,a]])},n)}else r.animate({matrix:ve(r.getMatrix(),[["t",-i,-a],["s",.01,.01],["t",i,a]])},C(C({},n),{callback:function(){r.remove(!0)}}))}}function jP(r,n,t){gp(r,n,"zoomIn")}function XP(r,n,t){gp(r,n,"zoomOut")}function Rn(r){return[Z.TOP,Z.BOTTOM].includes(r)?{offsetX:0,offsetY:r===Z.TOP?-8:8,style:{textAlign:"center",textBaseline:r===Z.TOP?"bottom":"top"}}:[Z.LEFT,Z.RIGHT].includes(r)?{offsetX:r===Z.LEFT?-8:8,offsetY:0,style:{textAlign:r===Z.LEFT?"right":"left",textBaseline:"middle",rotate:Math.PI/2}}:{}}function uf(r,n,t){return{x:r.x+n*Math.cos(t),y:r.y+n*Math.sin(t)}}var YP=function(r){R(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.getDefaultCfg=function(){return J({},r.prototype.getDefaultCfg.call(this),{type:"circle",showTitle:!0,title:r.prototype.getDefaultTitleCfg.call(this)})},n.prototype.render=function(){r.prototype.render.call(this),this.cfg.showTitle&&this.renderTitle()},n.prototype.getRegion=function(t,e){var i=.5,a={x:.5,y:.5},o=Math.PI*2/t,s=-1*Math.PI/2+o*e,u=i/(1+1/Math.sin(o/2)),l=uf(a,i-u,s),c=Math.PI*5/4,f=Math.PI*1/4;return{start:uf(l,u,c),end:uf(l,u,f)}},n.prototype.afterEachView=function(t,e){this.processAxis(t,e)},n.prototype.beforeEachView=function(t,e){},n.prototype.generateFacets=function(t){var e=this,i=this.cfg,a=i.fields,o=i.type,s=ut(a,1),u=s[0];if(!u)throw new Error("No `fields` specified!");var l=this.getFieldValues(t,u),c=l.length,f=[];return l.forEach(function(h,v){var p=[{field:u,value:h,values:l}],d=Pe(t,e.getFacetDataFilter(p)),g={type:o,data:d,region:e.getRegion(c,v),columnValue:h,columnField:u,columnIndex:v,columnValuesLength:c,rowValue:null,rowField:null,rowIndex:0,rowValuesLength:1};f.push(g)}),f},n.prototype.getXAxisOption=function(t,e,i,a){return i},n.prototype.getYAxisOption=function(t,e,i,a){return i},n.prototype.renderTitle=function(){var t=this;w(this.facets,function(e){var i=e.columnValue,a=e.view,o=F(t.cfg.title,"formatter"),s=J({position:["50%","0%"],content:o?o(i):i},Rn(Z.TOP),t.cfg.title);a.annotation().text(s)})},n}(lo),ZP=function(r){R(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.getDefaultCfg=function(){return J({},r.prototype.getDefaultCfg.call(this),{type:"list",cols:null,showTitle:!0,title:r.prototype.getDefaultTitleCfg.call(this)})},n.prototype.render=function(){r.prototype.render.call(this),this.cfg.showTitle&&this.renderTitle()},n.prototype.afterEachView=function(t,e){this.processAxis(t,e)},n.prototype.beforeEachView=function(t,e){},n.prototype.generateFacets=function(t){var e=this,i=this.cfg.fields,a=this.cfg.cols,o=ut(i,1),s=o[0];if(!s)throw new Error("No `fields` specified!");var u=this.getFieldValues(t,s),l=u.length;a=a||l;var c=this.getPageCount(l,a),f=[];return u.forEach(function(h,v){var p=e.getRowCol(v,a),d=p.row,g=p.col,y=[{field:s,value:h,values:u}],m=Pe(t,e.getFacetDataFilter(y)),x={type:e.cfg.type,data:m,region:e.getRegion(c,a,g,d),columnValue:h,rowValue:h,columnField:s,rowField:null,columnIndex:g,rowIndex:d,columnValuesLength:a,rowValuesLength:c,total:l};f.push(x)}),f},n.prototype.getXAxisOption=function(t,e,i,a){return a.rowIndex!==a.rowValuesLength-1&&a.columnValuesLength*a.rowIndex+a.columnIndex+1+a.columnValuesLength<=a.total?C(C({},i),{label:null,title:null}):i},n.prototype.getYAxisOption=function(t,e,i,a){return a.columnIndex!==0?C(C({},i),{title:null,label:null}):i},n.prototype.renderTitle=function(){var t=this;w(this.facets,function(e){var i=e.columnValue,a=e.view,o=F(t.cfg.title,"formatter"),s=J({position:["50%","0%"],content:o?o(i):i},Rn(Z.TOP),t.cfg.title);a.annotation().text(s)})},n.prototype.getPageCount=function(t,e){return Math.floor((t+e-1)/e)},n.prototype.getRowCol=function(t,e){var i=Math.floor(t/e),a=t%e;return{row:i,col:a}},n}(lo),qP=function(r){R(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.getDefaultCfg=function(){return J({},r.prototype.getDefaultCfg.call(this),{type:"matrix",showTitle:!1,columnTitle:C({},r.prototype.getDefaultTitleCfg.call(this)),rowTitle:C({},r.prototype.getDefaultTitleCfg.call(this))})},n.prototype.render=function(){r.prototype.render.call(this),this.cfg.showTitle&&this.renderTitle()},n.prototype.afterEachView=function(t,e){this.processAxis(t,e)},n.prototype.beforeEachView=function(t,e){},n.prototype.generateFacets=function(t){for(var e=this.cfg,i=e.fields,a=e.type,o=i.length,s=o,u=[],l=0;l<s;l++)for(var c=i[l],f=0;f<o;f++){var h=i[f],v={type:a,data:t,region:this.getRegion(o,s,l,f),columnValue:c,rowValue:h,columnField:c,rowField:h,columnIndex:l,rowIndex:f,columnValuesLength:s,rowValuesLength:o};u.push(v)}return u},n.prototype.getXAxisOption=function(t,e,i,a){return a.rowIndex!==a.rowValuesLength-1?C(C({},i),{label:null,title:null}):i},n.prototype.getYAxisOption=function(t,e,i,a){return a.columnIndex!==0?C(C({},i),{title:null,label:null}):i},n.prototype.renderTitle=function(){var t=this;w(this.facets,function(e,i){var a=e.columnIndex,o=e.rowIndex,s=e.columnValuesLength;e.rowValuesLength;var u=e.columnValue,l=e.rowValue,c=e.view;if(o===0){var f=F(t.cfg.columnTitle,"formatter"),h=J({position:["50%","0%"],content:f?f(u):u},Rn(Z.TOP),t.cfg.columnTitle);c.annotation().text(h)}if(a===s-1){var f=F(t.cfg.rowTitle,"formatter"),h=J({position:["100%","50%"],content:f?f(l):l},Rn(Z.RIGHT),t.cfg.rowTitle);c.annotation().text(h)}})},n}(lo),KP=function(r){R(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.getDefaultCfg=function(){return J({},r.prototype.getDefaultCfg.call(this),{type:"mirror",showTitle:!0,title:r.prototype.getDefaultTitleCfg.call(this),transpose:!1})},n.prototype.render=function(){r.prototype.render.call(this),this.cfg.showTitle&&this.renderTitle()},n.prototype.beforeEachView=function(t,e){this.cfg.transpose?e.columnIndex%2===0?t.coordinate().transpose().reflect("x"):t.coordinate().transpose():e.rowIndex%2!==0&&t.coordinate().reflect("y")},n.prototype.afterEachView=function(t,e){this.processAxis(t,e)},n.prototype.generateFacets=function(t){var e=this,i=ut(this.cfg.fields,1),a=i[0],o=[],s=1,u=1,l=[""],c=[""],f,h;return this.cfg.transpose?(f=a,l=this.getFieldValues(t,f).slice(0,2),s=l.length):(h=a,c=this.getFieldValues(t,h).slice(0,2),u=c.length),l.forEach(function(v,p){c.forEach(function(d,g){var y=[{field:f,value:v,values:l},{field:h,value:d,values:c}],m=Pe(t,e.getFacetDataFilter(y)),x={type:e.cfg.type,data:m,region:e.getRegion(u,s,p,g),columnValue:v,rowValue:d,columnField:f,rowField:h,columnIndex:p,rowIndex:g,columnValuesLength:s,rowValuesLength:u};o.push(x)})}),o},n.prototype.getXAxisOption=function(t,e,i,a){return a.columnIndex===1||a.rowIndex===1?C(C({},i),{label:null,title:null}):i},n.prototype.getYAxisOption=function(t,e,i,a){return i},n.prototype.renderTitle=function(){var t=this;w(this.facets,function(e,i){var a=e.columnValue,o=e.rowValue,s=e.view,u=F(t.cfg.title,"formatter");if(t.cfg.transpose){var l=J({position:["50%","0%"],content:u?u(a):a},Rn(Z.TOP),t.cfg.title);s.annotation().text(l)}else{var l=J({position:["100%","50%"],content:u?u(o):o},Rn(Z.RIGHT),t.cfg.title);s.annotation().text(l)}})},n}(lo),QP=function(r){R(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.afterEachView=function(t,e){this.processAxis(t,e)},n.prototype.beforeEachView=function(t,e){},n.prototype.getDefaultCfg=function(){return J({},r.prototype.getDefaultCfg.call(this),{type:"rect",columnTitle:C({},r.prototype.getDefaultTitleCfg.call(this)),rowTitle:C({},r.prototype.getDefaultTitleCfg.call(this))})},n.prototype.render=function(){r.prototype.render.call(this),this.cfg.showTitle&&this.renderTitle()},n.prototype.generateFacets=function(t){var e=this,i=ut(this.cfg.fields,2),a=i[0],o=i[1],s=[],u=1,l=1,c=[""],f=[""];return a&&(c=this.getFieldValues(t,a),u=c.length),o&&(f=this.getFieldValues(t,o),l=f.length),c.forEach(function(h,v){f.forEach(function(p,d){var g=[{field:a,value:h,values:c},{field:o,value:p,values:f}],y=Pe(t,e.getFacetDataFilter(g)),m={type:e.cfg.type,data:y,region:e.getRegion(l,u,v,d),columnValue:h,rowValue:p,columnField:a,rowField:o,columnIndex:v,rowIndex:d,columnValuesLength:u,rowValuesLength:l};s.push(m)})}),s},n.prototype.renderTitle=function(){var t=this;w(this.facets,function(e,i){var a=e.columnIndex,o=e.rowIndex,s=e.columnValuesLength,u=e.columnValue,l=e.rowValue,c=e.view;if(o===0){var f=F(t.cfg.columnTitle,"formatter"),h=J({position:["50%","0%"],content:f?f(u):u},Rn(Z.TOP),t.cfg.columnTitle);c.annotation().text(h)}if(a===s-1){var f=F(t.cfg.rowTitle,"formatter"),h=J({position:["100%","50%"],content:f?f(l):l},Rn(Z.RIGHT),t.cfg.rowTitle);c.annotation().text(h)}})},n.prototype.getXAxisOption=function(t,e,i,a){return a.rowIndex!==a.rowValuesLength-1?C(C({},i),{title:null,label:null}):a.columnIndex!==Math.floor((a.columnValuesLength-1)/2)?C(C({},i),{title:null}):i},n.prototype.getYAxisOption=function(t,e,i,a){return a.columnIndex!==0?C(C({},i),{title:null,label:null}):a.rowIndex!==Math.floor((a.rowValuesLength-1)/2)?C(C({},i),{title:null}):i},n}(lo),JP=function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.afterChartRender=function(){t.facets&&t.cfg.line&&(t.container.clear(),t.drawLines(t.facets))},t}return n.prototype.afterEachView=function(t,e){this.processAxis(t,e)},n.prototype.beforeEachView=function(t,e){},n.prototype.init=function(){r.prototype.init.call(this),this.view.on(_t.AFTER_RENDER,this.afterChartRender)},n.prototype.getDefaultCfg=function(){return J({},r.prototype.getDefaultCfg.call(this),{type:"tree",line:{style:{lineWidth:1,stroke:"#ddd"},smooth:!1},showTitle:!0,title:r.prototype.getDefaultTitleCfg.call(this)})},n.prototype.generateFacets=function(t){var e=this.cfg.fields;if(!e.length)throw new Error("Please specify for the fields for rootFacet!");var i=[],a={type:this.cfg.type,data:t,region:null,rowValuesLength:this.getRows(),columnValuesLength:1,rowIndex:0,columnIndex:0,rowField:"",columnField:"",rowValue:"",columnValue:""};return i.push(a),a.children=this.getChildFacets(t,1,i),this.setRegion(i),i},n.prototype.setRegion=function(t){var e=this;this.forceColIndex(t),t.forEach(function(i){i.region=e.getRegion(i.rowValuesLength,i.columnValuesLength,i.columnIndex,i.rowIndex)})},n.prototype.getRegion=function(t,e,i,a){var o=1/e,s=1/t,u={x:o*i,y:s*a},l={x:u.x+o,y:u.y+s*2/3};return{start:u,end:l}},n.prototype.forceColIndex=function(t){var e,i,a=this,o=[],s=0;t.forEach(function(p){a.isLeaf(p)&&(o.push(p),p.columnIndex=s,s++)}),o.forEach(function(p){p.columnValuesLength=o.length});for(var u=this.cfg.fields.length,l=u-1;l>=0;l--){var c=this.getFacetsByLevel(t,l);try{for(var f=(e=void 0,It(c)),h=f.next();!h.done;h=f.next()){var v=h.value;this.isLeaf(v)||(v.originColIndex=v.columnIndex,v.columnIndex=this.getRegionIndex(v.children),v.columnValuesLength=o.length)}}catch(p){e={error:p}}finally{try{h&&!h.done&&(i=f.return)&&i.call(f)}finally{if(e)throw e.error}}}},n.prototype.getFacetsByLevel=function(t,e){var i=[];return t.forEach(function(a){a.rowIndex===e&&i.push(a)}),i},n.prototype.getRegionIndex=function(t){var e=t[0],i=t[t.length-1];return(i.columnIndex-e.columnIndex)/2+e.columnIndex},n.prototype.isLeaf=function(t){return!t.children||!t.children.length},n.prototype.getRows=function(){return this.cfg.fields.length+1},n.prototype.getChildFacets=function(t,e,i){var a=this,o=this.cfg.fields,s=o.length;if(!(s<e)){var u=[],l=o[e-1],c=this.getFieldValues(t,l);return c.forEach(function(f,h){var v=[{field:l,value:f,values:c}],p=t.filter(a.getFacetDataFilter(v));if(p.length){var d={type:a.cfg.type,data:p,region:null,columnValue:f,rowValue:"",columnField:l,rowField:"",columnIndex:h,rowValuesLength:a.getRows(),columnValuesLength:1,rowIndex:e,children:a.getChildFacets(p,e+1,i)};u.push(d),i.push(d)}}),u}},n.prototype.render=function(){r.prototype.render.call(this),this.cfg.showTitle&&this.renderTitle()},n.prototype.renderTitle=function(){var t=this;w(this.facets,function(e){var i=e.columnValue,a=e.view,o=F(t.cfg.title,"formatter"),s=J({position:["50%","0%"],content:o?o(i):i},Rn(Z.TOP),t.cfg.title);a.annotation().text(s)})},n.prototype.drawLines=function(t){var e=this;t.forEach(function(i){if(!e.isLeaf(i)){var a=i.children;e.addFacetLines(i,a)}})},n.prototype.addFacetLines=function(t,e){var i=this,a=t.view,o=a.coordinateBBox,s={x:o.x+o.width/2,y:o.y+o.height};e.forEach(function(u){var l=u.view.coordinateBBox,c={x:l.bl.x+(l.tr.x-l.bl.x)/2,y:l.tr.y},f={x:s.x,y:s.y+(c.y-s.y)/2},h={x:c.x,y:f.y};i.drawLine([s,f,h,c])})},n.prototype.getPath=function(t){var e=[],i=this.cfg.line.smooth;return i?(e.push(["M",t[0].x,t[0].y]),e.push(["C",t[1].x,t[1].y,t[2].x,t[2].y,t[3].x,t[3].y])):t.forEach(function(a,o){o===0?e.push(["M",a.x,a.y]):e.push(["L",a.x,a.y])}),e},n.prototype.drawLine=function(t){var e=this.getPath(t),i=this.cfg.line.style;this.container.addShape("path",{attrs:zt({path:e},i)})},n.prototype.getXAxisOption=function(t,e,i,a){return a.rowIndex!==a.rowValuesLength-1?C(C({},i),{title:null,label:null}):i},n.prototype.getYAxisOption=function(t,e,i,a){return a.originColIndex!==0&&a.columnIndex!==0?C(C({},i),{title:null,label:null}):i},n}(lo);function b0(r){var n=te([],ut(r),!1);n.sort(function(e,i){return e-i});var t=n.length;return t===0?0:t%2===1?n[(t-1)/2]:(n[t/2]+n[t/2-1])/2}function tB(r){var n=ze(r,function(t,e){return t+=isNaN(e)||!dt(e)?0:e},0);return r.length===0?0:n/r.length}function _u(r,n){if(!n)return null;var t;switch(r){case"start":return 0;case"center":return .5;case"end":return 1;case"median":{t=n.isCategory?b0(n.values.map(function(e,i){return i})):b0(n.values);break}case"mean":{t=n.isCategory?(n.values.length-1)/2:tB(n.values);break}case"min":t=n.isCategory?0:n[r];break;case"max":t=n.isCategory?n.values.length-1:n[r];break;default:t=r;break}return n.scale(t)}var Cu=["regionFilter","shape"],eB=function(r){R(n,r);function n(t){var e=r.call(this,t)||this;return e.cache=new Map,e.foregroundContainer=e.view.getLayer(ue.FORE).addGroup(),e.backgroundContainer=e.view.getLayer(ue.BG).addGroup(),e.option=[],e}return Object.defineProperty(n.prototype,"name",{get:function(){return"annotation"},enumerable:!1,configurable:!0}),n.prototype.init=function(){},n.prototype.layout=function(){this.update()},n.prototype.render=function(){},n.prototype.update=function(){var t=this;this.onAfterRender(function(){var i=new Map;w(t.option,function(a){if(Ni(Cu,a.type)){var o=t.updateOrCreate(a);o&&i.set(t.getCacheKey(a),o)}}),t.cache=t.syncCache(i)});var e=new Map;w(this.option,function(i){if(!Ni(Cu,i.type)){var a=t.updateOrCreate(i);a&&e.set(t.getCacheKey(i),a)}}),this.cache=this.syncCache(e)},n.prototype.clear=function(t){t===void 0&&(t=!1),r.prototype.clear.call(this),this.clearComponents(),this.foregroundContainer.clear(),this.backgroundContainer.clear(),t&&(this.option=[])},n.prototype.destroy=function(){this.clear(!0),this.foregroundContainer.remove(!0),this.backgroundContainer.remove(!0)},n.prototype.getComponents=function(){var t=[];return this.cache.forEach(function(e){t.push(e)}),t},n.prototype.clearComponents=function(){this.getComponents().forEach(function(t){t.component.destroy()}),this.cache.clear()},n.prototype.onAfterRender=function(t){var e=!1;this.view.getOptions().animate&&this.view.geometries.forEach(function(i){i.animateOption&&(i.once(ni.AFTER_DRAW_ANIMATE,function(){t()}),e=!0)}),e||this.view.getRootView().once(_t.AFTER_RENDER,function(){t()})},n.prototype.createAnnotation=function(t){var e=t.type,i=Q5[ca(e)];if(i){var a=this.getAnnotationTheme(e),o=this.getAnnotationCfg(e,t,a);if(!o)return null;var s=new i(o);return{component:s,layer:this.isTop(o)?ue.FORE:ue.BG,direction:Z.NONE,type:Ce.ANNOTATION,extra:t}}},n.prototype.annotation=function(t){this.option.push(t)},n.prototype.arc=function(t){return this.annotation(C({type:"arc"},t)),this},n.prototype.image=function(t){return this.annotation(C({type:"image"},t)),this},n.prototype.line=function(t){return this.annotation(C({type:"line"},t)),this},n.prototype.region=function(t){return this.annotation(C({type:"region"},t)),this},n.prototype.text=function(t){return this.annotation(C({type:"text"},t)),this},n.prototype.dataMarker=function(t){return this.annotation(C({type:"dataMarker"},t)),this},n.prototype.dataRegion=function(t){this.annotation(C({type:"dataRegion"},t))},n.prototype.regionFilter=function(t){this.annotation(C({type:"regionFilter"},t))},n.prototype.shape=function(t){this.annotation(C({type:"shape"},t))},n.prototype.html=function(t){this.annotation(C({type:"html"},t))},n.prototype.parsePosition=function(t){var e,i,a=this.view.getXScale(),o=this.view.getScalesByDim("y"),s=rt(t)?t.call(null,a,o):t,u=0,l=0;if(V(s)){var c=ut(s,2),f=c[0],h=c[1];if(lt(f)&&f.indexOf("%")!==-1&&!isNaN(f.slice(0,-1)))return this.parsePercentPosition(s);u=_u(f,a),l=_u(h,Object.values(o)[0])}else if(!G(s))try{for(var v=It(oo(s)),p=v.next();!p.done;p=v.next()){var d=p.value,g=s[d];d===a.field&&(u=_u(g,a)),o[d]&&(l=_u(g,o[d]))}}catch(y){e={error:y}}finally{try{p&&!p.done&&(i=v.return)&&i.call(v)}finally{if(e)throw e.error}}return isNaN(u)||isNaN(l)?null:this.view.getCoordinate().convert({x:u,y:l})},n.prototype.getRegionPoints=function(t,e){var i=this,a=this.view.getXScale(),o=this.view.getScalesByDim("y"),s=Object.values(o)[0],u=a.field,l=this.view.getData(),c=V(t)?t[0]:t[u],f=V(e)?e[0]:e[u],h=[],v;return w(l,function(p,d){if(p[u]===c&&(v=d),d>=v){var g=i.parsePosition([p[u],p[s.field]]);g&&h.push(g)}if(p[u]===f)return!1}),h},n.prototype.parsePercentPosition=function(t){var e=parseFloat(t[0])/100,i=parseFloat(t[1])/100,a=this.view.getCoordinate(),o=a.start,s=a.end,u={x:Math.min(o.x,s.x),y:Math.min(o.y,s.y)},l=a.getWidth()*e+u.x,c=a.getHeight()*i+u.y;return{x:l,y:c}},n.prototype.getCoordinateBBox=function(){var t=this.view.getCoordinate(),e=t.start,i=t.end,a=t.getWidth(),o=t.getHeight(),s={x:Math.min(e.x,i.x),y:Math.min(e.y,i.y)};return{x:s.x,y:s.y,minX:s.x,minY:s.y,maxX:s.x+a,maxY:s.y+o,width:a,height:o}},n.prototype.getAnnotationCfg=function(t,e,i){var a=this,o=this.view.getCoordinate(),s=this.view.getCanvas(),u={};if(G(e))return null;var l=e.start,c=e.end,f=e.position,h=this.parsePosition(l),v=this.parsePosition(c),p=this.parsePosition(f);if(["arc","image","line","region","regionFilter"].includes(t)&&(!h||!v))return null;if(["text","dataMarker","html"].includes(t)&&!p)return null;if(t==="arc"){var d=e;d.start,d.end;var g=Tt(d,["start","end"]),y=Ka(o,h),m=Ka(o,v);y>m&&(m=Math.PI*2+m),u=C(C({},g),{center:o.getCenter(),radius:sc(o,h),startAngle:y,endAngle:m})}else if(t==="image"){var x=e;x.start,x.end;var g=Tt(x,["start","end"]);u=C(C({},g),{start:h,end:v,src:e.src})}else if(t==="line"){var _=e;_.start,_.end;var g=Tt(_,["start","end"]);u=C(C({},g),{start:h,end:v,text:F(e,"text",null)})}else if(t==="region"){var E=e;E.start,E.end;var g=Tt(E,["start","end"]);u=C(C({},g),{start:h,end:v})}else if(t==="text"){var b=this.view.getData(),M=e;M.position;var T=M.content,g=Tt(M,["position","content"]),k=T;rt(T)&&(k=T(b)),u=C(C(C({},p),g),{content:k})}else if(t==="dataMarker"){var L=e;L.position;var O=L.point,D=L.line,W=L.text,j=L.autoAdjust,ot=L.direction,g=Tt(L,["position","point","line","text","autoAdjust","direction"]);u=C(C(C({},g),p),{coordinateBBox:this.getCoordinateBBox(),point:O,line:D,text:W,autoAdjust:j,direction:ot})}else if(t==="dataRegion"){var z=e,X=z.start,K=z.end,Q=z.region,W=z.text,q=z.lineLength,g=Tt(z,["start","end","region","text","lineLength"]);u=C(C({},g),{points:this.getRegionPoints(X,K),region:Q,text:W,lineLength:q})}else if(t==="regionFilter"){var at=e;at.start,at.end;var pt=at.apply,mt=at.color,g=Tt(at,["start","end","apply","color"]),ft=this.view.geometries,vt=[],Lt=function(Jr){!Jr||(Jr.isGroup()?Jr.getChildren().forEach(function(_o){return Lt(_o)}):vt.push(Jr))};w(ft,function(Jr){pt?Ni(pt,Jr.type)&&w(Jr.elements,function(_o){Lt(_o.shape)}):w(Jr.elements,function(_o){Lt(_o.shape)})}),u=C(C({},g),{color:mt,shapes:vt,start:h,end:v})}else if(t==="shape"){var jt=e,Jt=jt.render,xe=Tt(jt,["render"]),Nr=function(ZT){if(rt(e.render))return Jt(ZT,a.view,{parsePosition:a.parsePosition.bind(a)})};u=C(C({},xe),{render:Nr})}else if(t==="html"){var zr=e,Ur=zr.html;zr.position;var xe=Tt(zr,["html","position"]),Hr=function(Jr){return rt(Ur)?Ur(Jr,a.view):Ur};u=C(C(C({},xe),p),{parent:s.get("el").parentNode,html:Hr})}var Qr=J({},i,C(C({},u),{top:e.top,style:e.style,offsetX:e.offsetX,offsetY:e.offsetY}));return t!=="html"&&(Qr.container=this.getComponentContainer(Qr)),Qr.animate=this.view.getOptions().animate&&Qr.animate&&F(e,"animate",Qr.animate),Qr.animateOption=J({},Ja,Qr.animateOption,e.animateOption),Qr},n.prototype.isTop=function(t){return F(t,"top",!0)},n.prototype.getComponentContainer=function(t){return this.isTop(t)?this.foregroundContainer:this.backgroundContainer},n.prototype.getAnnotationTheme=function(t){return F(this.view.getTheme(),["components","annotation",t],{})},n.prototype.updateOrCreate=function(t){var e=this.cache.get(this.getCacheKey(t));if(e){var i=t.type,a=this.getAnnotationTheme(i),o=this.getAnnotationCfg(i,t,a);o&&Ke(o,["container"]),e.component.update(C(C({},o||{}),{visible:!!o})),Ni(Cu,t.type)&&e.component.render()}else e=this.createAnnotation(t),e&&(e.component.init(),Ni(Cu,t.type)&&e.component.render());return e},n.prototype.syncCache=function(t){var e=this,i=new Map(this.cache);return t.forEach(function(a,o){i.set(o,a)}),i.forEach(function(a,o){jr(e.option,function(s){return o===e.getCacheKey(s)})||(a.component.destroy(),i.delete(o))}),i},n.prototype.getCacheKey=function(t){return t},n}(fo);function A0(r,n){var t=J({},F(r,["components","axis","common"]),F(r,["components","axis",n]));return F(t,["grid"],{})}function Eu(r,n,t,e){var i=[],a=n.getTicks();return r.isPolar&&a.push({value:1,text:"",tickValue:""}),a.reduce(function(o,s,u){var l=s.value;if(e)i.push({points:[r.convert(t==="y"?{x:0,y:l}:{x:l,y:0}),r.convert(t==="y"?{x:1,y:l}:{x:l,y:1})]});else if(u){var c=o.value,f=(c+l)/2;i.push({points:[r.convert(t==="y"?{x:0,y:f}:{x:f,y:0}),r.convert(t==="y"?{x:1,y:f}:{x:f,y:1})]})}return s},a[0]),i}function lf(r,n,t,e,i){var a=n.values.length,o=[],s=t.getTicks();return s.reduce(function(u,l){var c=u?u.value:l.value,f=l.value,h=(c+f)/2;return i==="x"?o.push({points:[r.convert({x:e?f:h,y:0}),r.convert({x:e?f:h,y:1})]}):o.push({points:ie(Array(a+1),function(v,p){return r.convert({x:p/a,y:e?f:h})})}),l},s[0]),o}function T0(r,n){var t=F(n,"grid");if(t===null)return!1;var e=F(r,"grid");return!(t===void 0&&e===null)}var zn=["container"],M0=C(C({},Ja),{appear:null}),rB=function(r){R(n,r);function n(t){var e=r.call(this,t)||this;return e.cache=new Map,e.gridContainer=e.view.getLayer(ue.BG).addGroup(),e.gridForeContainer=e.view.getLayer(ue.FORE).addGroup(),e.axisContainer=e.view.getLayer(ue.BG).addGroup(),e.axisForeContainer=e.view.getLayer(ue.FORE).addGroup(),e}return Object.defineProperty(n.prototype,"name",{get:function(){return"axis"},enumerable:!1,configurable:!0}),n.prototype.init=function(){},n.prototype.render=function(){this.update()},n.prototype.layout=function(){var t=this,e=this.view.getCoordinate();w(this.getComponents(),function(i){var a=i.component,o=i.direction,s=i.type,u=i.extra,l=u.dim,c=u.scale,f=u.alignTick,h;if(s===Ce.AXIS)e.isPolar?l==="x"?h=e.isTransposed?lu(e,o):tf(e):l==="y"&&(h=e.isTransposed?tf(e):lu(e,o)):h=lu(e,o);else if(s===Ce.GRID)if(e.isPolar){var v=void 0;e.isTransposed?v=l==="x"?lf(e,t.view.getYScales()[0],c,f,l):Eu(e,c,l,f):v=l==="x"?Eu(e,c,l,f):lf(e,t.view.getXScale(),c,f,l),h={items:v,center:t.view.getCoordinate().getCenter()}}else h={items:Eu(e,c,l,f)};a.update(h)})},n.prototype.update=function(){this.option=this.view.getOptions().axes;var t=new Map;this.updateXAxes(t),this.updateYAxes(t);var e=new Map;this.cache.forEach(function(i,a){t.has(a)?e.set(a,i):i.component.destroy()}),this.cache=e},n.prototype.clear=function(){r.prototype.clear.call(this),this.cache.clear(),this.gridContainer.clear(),this.gridForeContainer.clear(),this.axisContainer.clear(),this.axisForeContainer.clear()},n.prototype.destroy=function(){r.prototype.destroy.call(this),this.gridContainer.remove(!0),this.gridForeContainer.remove(!0),this.axisContainer.remove(!0),this.axisForeContainer.remove(!0)},n.prototype.getComponents=function(){var t=[];return this.cache.forEach(function(e){t.push(e)}),t},n.prototype.updateXAxes=function(t){var e=this.view.getXScale();if(!(!e||e.isIdentity)){var i=ll(this.option,e.field);if(i!==!1){var a=Bg(i,Z.BOTTOM),o=ue.BG,s="x",u=this.view.getCoordinate(),l=this.getId("axis",e.field),c=this.getId("grid",e.field);if(u.isRect){var f=this.cache.get(l);if(f){var h=this.getLineAxisCfg(e,i,a);Ke(h,zn),f.component.update(h),t.set(l,f)}else f=this.createLineAxis(e,i,o,a,s),this.cache.set(l,f),t.set(l,f);var v=this.cache.get(c);if(v){var h=this.getLineGridCfg(e,i,a,s);Ke(h,zn),v.component.update(h),t.set(c,v)}else v=this.createLineGrid(e,i,o,a,s),v&&(this.cache.set(c,v),t.set(c,v))}else if(u.isPolar){var f=this.cache.get(l);if(f){var h=u.isTransposed?this.getLineAxisCfg(e,i,Z.RADIUS):this.getCircleAxisCfg(e,i,a);Ke(h,zn),f.component.update(h),t.set(l,f)}else{if(u.isTransposed){if(Je(i))return;f=this.createLineAxis(e,i,o,Z.RADIUS,s)}else f=this.createCircleAxis(e,i,o,a,s);this.cache.set(l,f),t.set(l,f)}var v=this.cache.get(c);if(v){var h=u.isTransposed?this.getCircleGridCfg(e,i,Z.RADIUS,s):this.getLineGridCfg(e,i,Z.CIRCLE,s);Ke(h,zn),v.component.update(h),t.set(c,v)}else{if(u.isTransposed){if(Je(i))return;v=this.createCircleGrid(e,i,o,Z.RADIUS,s)}else v=this.createLineGrid(e,i,o,Z.CIRCLE,s);v&&(this.cache.set(c,v),t.set(c,v))}}}}},n.prototype.updateYAxes=function(t){var e=this,i=this.view.getYScales();w(i,function(a,o){if(!(!a||a.isIdentity)){var s=a.field,u=ll(e.option,s);if(u!==!1){var l=ue.BG,c="y",f=e.getId("axis",s),h=e.getId("grid",s),v=e.view.getCoordinate();if(v.isRect){var p=Bg(u,o===0?Z.LEFT:Z.RIGHT),d=e.cache.get(f);if(d){var g=e.getLineAxisCfg(a,u,p);Ke(g,zn),d.component.update(g),t.set(f,d)}else d=e.createLineAxis(a,u,l,p,c),e.cache.set(f,d),t.set(f,d);var y=e.cache.get(h);if(y){var g=e.getLineGridCfg(a,u,p,c);Ke(g,zn),y.component.update(g),t.set(h,y)}else y=e.createLineGrid(a,u,l,p,c),y&&(e.cache.set(h,y),t.set(h,y))}else if(v.isPolar){var d=e.cache.get(f);if(d){var g=v.isTransposed?e.getCircleAxisCfg(a,u,Z.CIRCLE):e.getLineAxisCfg(a,u,Z.RADIUS);Ke(g,zn),d.component.update(g),t.set(f,d)}else{if(v.isTransposed){if(Je(u))return;d=e.createCircleAxis(a,u,l,Z.CIRCLE,c)}else d=e.createLineAxis(a,u,l,Z.RADIUS,c);e.cache.set(f,d),t.set(f,d)}var y=e.cache.get(h);if(y){var g=v.isTransposed?e.getLineGridCfg(a,u,Z.CIRCLE,c):e.getCircleGridCfg(a,u,Z.RADIUS,c);Ke(g,zn),y.component.update(g),t.set(h,y)}else{if(v.isTransposed){if(Je(u))return;y=e.createLineGrid(a,u,l,Z.CIRCLE,c)}else y=e.createCircleGrid(a,u,l,Z.RADIUS,c);y&&(e.cache.set(h,y),t.set(h,y))}}}}})},n.prototype.createLineAxis=function(t,e,i,a,o){var s={component:new Yk(this.getLineAxisCfg(t,e,a)),layer:i,direction:a===Z.RADIUS?Z.NONE:a,type:Ce.AXIS,extra:{dim:o,scale:t}};return s.component.set("field",t.field),s.component.init(),s},n.prototype.createLineGrid=function(t,e,i,a,o){var s=this.getLineGridCfg(t,e,a,o);if(s){var u={component:new qk(s),layer:i,direction:Z.NONE,type:Ce.GRID,extra:{dim:o,scale:t,alignTick:F(s,"alignTick",!0)}};return u.component.init(),u}},n.prototype.createCircleAxis=function(t,e,i,a,o){var s={component:new Zk(this.getCircleAxisCfg(t,e,a)),layer:i,direction:a,type:Ce.AXIS,extra:{dim:o,scale:t}};return s.component.set("field",t.field),s.component.init(),s},n.prototype.createCircleGrid=function(t,e,i,a,o){var s=this.getCircleGridCfg(t,e,a,o);if(s){var u={component:new Kk(s),layer:i,direction:Z.NONE,type:Ce.GRID,extra:{dim:o,scale:t,alignTick:F(s,"alignTick",!0)}};return u.component.init(),u}},n.prototype.getLineAxisCfg=function(t,e,i){var a=F(e,["top"])?this.axisForeContainer:this.axisContainer,o=this.view.getCoordinate(),s=lu(o,i),u=Ng(t,e),l=cu(this.view.getTheme(),i),c=F(e,["title"])?J({title:{style:{text:u}}},{title:Pg(this.view.getTheme(),i,e.title)},e):e,f=J(C(C({container:a},s),{ticks:t.getTicks().map(function(x){return{id:"".concat(x.tickValue),name:x.text,value:x.value}}),verticalFactor:o.isPolar?Dg(s,o.getCenter())*-1:Dg(s,o.getCenter()),theme:l}),l,c),h=this.getAnimateCfg(f),v=h.animate,p=h.animateOption;f.animateOption=p,f.animate=v;var d=bS(s),g=F(f,"verticalLimitLength",d?1/3:1/2);if(g<=1){var y=this.view.getCanvas().get("width"),m=this.view.getCanvas().get("height");f.verticalLimitLength=g*(d?y:m)}return f},n.prototype.getLineGridCfg=function(t,e,i,a){if(!!T0(cu(this.view.getTheme(),i),e)){var o=A0(this.view.getTheme(),i),s=J({container:F(e,["top"])?this.gridForeContainer:this.gridContainer},o,F(e,"grid"),this.getAnimateCfg(e));return s.items=Eu(this.view.getCoordinate(),t,a,F(s,"alignTick",!0)),s}},n.prototype.getCircleAxisCfg=function(t,e,i){var a=F(e,["top"])?this.axisForeContainer:this.axisContainer,o=this.view.getCoordinate(),s=t.getTicks().map(function(d){return{id:"".concat(d.tickValue),name:d.text,value:d.value}});!t.isCategory&&Math.abs(o.endAngle-o.startAngle)===Math.PI*2&&s.pop();var u=Ng(t,e),l=cu(this.view.getTheme(),Z.CIRCLE),c=F(e,["title"])?J({title:{style:{text:u}}},{title:Pg(this.view.getTheme(),i,e.title)},e):e,f=J(C(C({container:a},tf(this.view.getCoordinate())),{ticks:s,verticalFactor:1,theme:l}),l,c),h=this.getAnimateCfg(f),v=h.animate,p=h.animateOption;return f.animate=v,f.animateOption=p,f},n.prototype.getCircleGridCfg=function(t,e,i,a){if(!!T0(cu(this.view.getTheme(),i),e)){var o=A0(this.view.getTheme(),Z.RADIUS),s=J({container:F(e,["top"])?this.gridForeContainer:this.gridContainer,center:this.view.getCoordinate().getCenter()},o,F(e,"grid"),this.getAnimateCfg(e)),u=F(s,"alignTick",!0),l=a==="x"?this.view.getYScales()[0]:this.view.getXScale();return s.items=lf(this.view.getCoordinate(),l,t,u,a),s}},n.prototype.getId=function(t,e){var i=this.view.getCoordinate();return"".concat(t,"-").concat(e,"-").concat(i.type)},n.prototype.getAnimateCfg=function(t){return{animate:this.view.getOptions().animate&&F(t,"animate"),animateOption:t&&t.animateOption?J({},M0,t.animateOption):M0}},n}(fo);function ri(r,n,t){return t===Z.TOP?[r.minX+r.width/2-n.width/2,r.minY]:t===Z.BOTTOM?[r.minX+r.width/2-n.width/2,r.maxY-n.height]:t===Z.LEFT?[r.minX,r.minY+r.height/2-n.height/2]:t===Z.RIGHT?[r.maxX-n.width,r.minY+r.height/2-n.height/2]:t===Z.TOP_LEFT||t===Z.LEFT_TOP?[r.tl.x,r.tl.y]:t===Z.TOP_RIGHT||t===Z.RIGHT_TOP?[r.tr.x-n.width,r.tr.y]:t===Z.BOTTOM_LEFT||t===Z.LEFT_BOTTOM?[r.bl.x,r.bl.y-n.height]:t===Z.BOTTOM_RIGHT||t===Z.RIGHT_BOTTOM?[r.br.x-n.width,r.br.y-n.height]:[0,0]}function w0(r,n){return ui(r)?r===!1?!1:{}:F(r,[n],r)}function Su(r){return F(r,"position",Z.BOTTOM)}var nB=function(r){R(n,r);function n(t){var e=r.call(this,t)||this;return e.container=e.view.getLayer(ue.FORE).addGroup(),e}return Object.defineProperty(n.prototype,"name",{get:function(){return"legend"},enumerable:!1,configurable:!0}),n.prototype.init=function(){},n.prototype.render=function(){this.update()},n.prototype.layout=function(){var t=this;this.layoutBBox=this.view.viewBBox,w(this.components,function(e){var i=e.component,a=e.direction,o=ef(a),s=i.get("maxWidthRatio"),u=i.get("maxHeightRatio"),l=t.getCategoryLegendSizeCfg(o,s,u),c=i.get("maxWidth"),f=i.get("maxHeight");i.update({maxWidth:Math.min(l.maxWidth,c||0),maxHeight:Math.min(l.maxHeight,f||0)});var h=i.get("padding"),v=i.getLayoutBBox(),p=new je(v.x,v.y,v.width,v.height).expand(h),d=ut(ri(t.view.viewBBox,p,a),2),g=d[0],y=d[1],m=ut(ri(t.layoutBBox,p,a),2),x=m[0],_=m[1],E=0,b=0;a.startsWith("top")||a.startsWith("bottom")?(E=g,b=_):(E=x,b=y),i.setLocation({x:E+h[3],y:b+h[0]}),t.layoutBBox=t.layoutBBox.cut(p,a)})},n.prototype.update=function(){var t=this;this.option=this.view.getOptions().legends;var e={},i=function(h,v,p){var d=t.getId(p.field),g=t.getComponentById(d);if(g){var y=void 0,m=w0(t.option,p.field);m!==!1&&(F(m,"custom")?y=t.getCategoryCfg(h,v,p,m,!0):p.isLinear?y=t.getContinuousCfg(h,v,p,m):p.isCategory&&(y=t.getCategoryCfg(h,v,p,m))),y&&(Ke(y,["container"]),g.direction=Su(m),g.component.update(y),e[d]=!0)}else{var x=t.createFieldLegend(h,v,p);x&&(x.component.init(),t.components.push(x),e[d]=!0)}};if(F(this.option,"custom")){var a="global-custom",o=this.getComponentById(a);if(o){var s=this.getCategoryCfg(void 0,void 0,void 0,this.option,!0);Ke(s,["container"]),o.component.update(s),e[a]=!0}else{var u=this.createCustomLegend(void 0,void 0,void 0,this.option);if(u){u.init();var l=ue.FORE,c=Su(this.option);this.components.push({id:a,component:u,layer:l,direction:c,type:Ce.LEGEND,extra:void 0}),e[a]=!0}}}else this.loopLegends(i);var f=[];w(this.getComponents(),function(h){e[h.id]?f.push(h):h.component.destroy()}),this.components=f},n.prototype.clear=function(){r.prototype.clear.call(this),this.container.clear()},n.prototype.destroy=function(){r.prototype.destroy.call(this),this.container.remove(!0)},n.prototype.getGeometries=function(t){var e=this,i=t.geometries;return w(t.views,function(a){i=i.concat(e.getGeometries(a))}),i},n.prototype.loopLegends=function(t){var e=this.view.getRootView()===this.view;if(!!e){var i=this.getGeometries(this.view),a={};w(i,function(o){var s=o.getGroupAttributes();w(s,function(u){var l=u.getScale(u.type);!l||l.type==="identity"||a[l.field]||(t(o,u,l),a[l.field]=!0)})})}},n.prototype.createFieldLegend=function(t,e,i){var a,o=w0(this.option,i.field),s=ue.FORE,u=Su(o);if(o!==!1&&(F(o,"custom")?a=this.createCustomLegend(t,e,i,o):i.isLinear?a=this.createContinuousLegend(t,e,i,o):i.isCategory&&(a=this.createCategoryLegend(t,e,i,o))),a)return a.set("field",i.field),{id:this.getId(i.field),component:a,layer:s,direction:u,type:Ce.LEGEND,extra:{scale:i}}},n.prototype.createCustomLegend=function(t,e,i,a){var o=this.getCategoryCfg(t,e,i,a,!0);return new Og(o)},n.prototype.createContinuousLegend=function(t,e,i,a){var o=this.getContinuousCfg(t,e,i,Ke(a,["value"]));return new Qk(o)},n.prototype.createCategoryLegend=function(t,e,i,a){var o=this.getCategoryCfg(t,e,i,a);return new Og(o)},n.prototype.getContinuousCfg=function(t,e,i,a){var o=i.getTicks(),s=jr(o,function(d){return d.value===0}),u=jr(o,function(d){return d.value===1}),l=o.map(function(d){var g=d.value,y=d.tickValue,m=e.mapping(i.invert(g)).join("");return{value:y,attrValue:m,color:m,scaleValue:g}});s||l.push({value:i.min,attrValue:e.mapping(i.invert(0)).join(""),color:e.mapping(i.invert(0)).join(""),scaleValue:0}),u||l.push({value:i.max,attrValue:e.mapping(i.invert(1)).join(""),color:e.mapping(i.invert(1)).join(""),scaleValue:1}),l.sort(function(d,g){return d.value-g.value});var c={min:pr(l).value,max:pe(l).value,colors:[],rail:{type:e.type},track:{}};e.type==="size"&&(c.track={style:{fill:e.type==="size"?this.view.getTheme().defaultColor:void 0}}),e.type==="color"&&(c.colors=l.map(function(d){return d.attrValue}));var f=this.container,h=Su(a),v=ef(h),p=F(a,"title");return p&&(p=J({text:ps(i)},p)),c.container=f,c.layout=v,c.title=p,c.animateOption=Ja,this.mergeLegendCfg(c,a,"continuous")},n.prototype.getCategoryCfg=function(t,e,i,a,o){var s=this.container,u=F(a,"position",Z.BOTTOM),l=qg(this.view.getTheme(),u),c=F(l,["marker"]),f=F(a,"marker"),h=ef(u),v=F(l,["pageNavigator"]),p=F(a,"pageNavigator"),d=o?_R(c,f,a.items):JS(this.view,t,e,c,f),g=F(a,"title");g&&(g=J({text:i?ps(i):""},g));var y=F(a,"maxWidthRatio"),m=F(a,"maxHeightRatio"),x=this.getCategoryLegendSizeCfg(h,y,m);x.container=s,x.layout=h,x.items=d,x.title=g,x.animateOption=Ja,x.pageNavigator=J({},v,p);var _=this.mergeLegendCfg(x,a,u);_.reversed&&_.items.reverse();var E=F(_,"maxItemWidth");return E&&E<=1&&(_.maxItemWidth=this.view.viewBBox.width*E),_},n.prototype.mergeLegendCfg=function(t,e,i){var a=i.split("-")[0],o=qg(this.view.getTheme(),a);return J({},o,t,e)},n.prototype.getId=function(t){return"".concat(this.name,"-").concat(t)},n.prototype.getComponentById=function(t){return jr(this.components,function(e){return e.id===t})},n.prototype.getCategoryLegendSizeCfg=function(t,e,i){e===void 0&&(e=Nd),i===void 0&&(i=Nd);var a=this.view.viewBBox,o=a.width,s=a.height;return t==="vertical"?{maxWidth:o*e,maxHeight:s}:{maxWidth:o,maxHeight:s*i}},n}(fo),iB=function(r){R(n,r);function n(t){var e=r.call(this,t)||this;return e.onChangeFn=ti,e.resetMeasure=function(){e.clear()},e.onValueChange=function(i){var a=ut(i,2),o=a[0],s=a[1];e.start=o,e.end=s,e.changeViewData(o,s)},e.container=e.view.getLayer(ue.FORE).addGroup(),e.onChangeFn=Mv(e.onValueChange,20,{leading:!0}),e.width=0,e.view.on(_t.BEFORE_CHANGE_DATA,e.resetMeasure),e.view.on(_t.BEFORE_CHANGE_SIZE,e.resetMeasure),e}return Object.defineProperty(n.prototype,"name",{get:function(){return"slider"},enumerable:!1,configurable:!0}),n.prototype.destroy=function(){r.prototype.destroy.call(this),this.view.off(_t.BEFORE_CHANGE_DATA,this.resetMeasure),this.view.off(_t.BEFORE_CHANGE_SIZE,this.resetMeasure)},n.prototype.init=function(){},n.prototype.render=function(){this.option=this.view.getOptions().slider;var t=this.getSliderCfg(),e=t.start,i=t.end;G(this.start)&&(this.start=e,this.end=i);var a=this.view.getOptions().data;this.option&&!nr(a)?this.slider?this.slider=this.updateSlider():(this.slider=this.createSlider(),this.slider.component.on("sliderchange",this.onChangeFn)):this.slider&&(this.slider.component.destroy(),this.slider=void 0)},n.prototype.layout=function(){var t=this;if(this.option&&!this.width&&(this.measureSlider(),setTimeout(function(){t.view.destroyed||t.changeViewData(t.start,t.end)},0)),this.slider){var e=this.view.coordinateBBox.width,i=this.slider.component.get("padding"),a=ut(i,4),o=a[0];a[1],a[2];var s=a[3],u=this.slider.component.getLayoutBBox(),l=new je(u.x,u.y,Math.min(u.width,e),u.height).expand(i),c=this.getMinMaxText(this.start,this.end),f=c.minText,h=c.maxText,v=ut(ri(this.view.viewBBox,l,Z.BOTTOM),2);v[0];var p=v[1],d=ut(ri(this.view.coordinateBBox,l,Z.BOTTOM),2),g=d[0];d[1],this.slider.component.update(C(C({},this.getSliderCfg()),{x:g+s,y:p+o,width:this.width,start:this.start,end:this.end,minText:f,maxText:h})),this.view.viewBBox=this.view.viewBBox.cut(l,Z.BOTTOM)}},n.prototype.update=function(){this.render()},n.prototype.createSlider=function(){var t=this.getSliderCfg(),e=new Wk(C({container:this.container},t));return e.init(),{component:e,layer:ue.FORE,direction:Z.BOTTOM,type:Ce.SLIDER}},n.prototype.updateSlider=function(){var t=this.getSliderCfg();if(this.width){var e=this.getMinMaxText(this.start,this.end),i=e.minText,a=e.maxText;t=C(C({},t),{width:this.width,start:this.start,end:this.end,minText:i,maxText:a})}return this.slider.component.update(t),this.slider},n.prototype.measureSlider=function(){var t=this.getSliderCfg().width;this.width=t},n.prototype.getSliderCfg=function(){var t={height:16,start:0,end:1,minText:"",maxText:"",x:0,y:0,width:this.view.coordinateBBox.width};if(wt(this.option)){var e=C({data:this.getData()},F(this.option,"trendCfg",{}));t=J({},t,this.getThemeOptions(),this.option),t=C(C({},t),{trendCfg:e})}return t.start=Kt(Math.min(G(t.start)?0:t.start,G(t.end)?1:t.end),0,1),t.end=Kt(Math.max(G(t.start)?0:t.start,G(t.end)?1:t.end),0,1),t},n.prototype.getData=function(){var t=this.view.getOptions().data,e=ut(this.view.getYScales(),1),i=e[0],a=this.view.getGroupScales();if(a.length){var o=a[0],s=o.field,u=o.ticks;return t.reduce(function(l,c){return c[s]===u[0]&&l.push(c[i.field]),l},[])}return t.map(function(l){return l[i.field]||0})},n.prototype.getThemeOptions=function(){var t=this.view.getTheme();return F(t,["components","slider","common"],{})},n.prototype.getMinMaxText=function(t,e){var i=this.view.getOptions().data,a=this.view.getXScale(),o=Yr(i,a.field);a.isLinear&&(o=o.sort());var s=o,u=Ee(i);if(!a||!u)return{};var l=Ee(s),c=Math.round(t*(l-1)),f=Math.round(e*(l-1)),h=F(s,[c]),v=F(s,[f]),p=this.getSliderCfg().formatter;return p&&(h=p(h,i[c],c),v=p(v,i[f],f)),{minText:h,maxText:v}},n.prototype.changeViewData=function(t,e){var i=this.view.getOptions().data,a=this.view.getXScale(),o=Ee(i);if(!(!a||!o)){var s=Yr(i,a.field),u=this.view.getXScale().isLinear?s.sort(function(v,p){return Number(v)-Number(p)}):s,l=u,c=Ee(l),f=Math.round(t*(c-1)),h=Math.round(e*(c-1));this.view.filter(a.field,function(v,p){var d=l.indexOf(v);return d>-1?Na(d,f,h):!0}),this.view.render(!0)}},n.prototype.getComponents=function(){return this.slider?[this.slider]:[]},n.prototype.clear=function(){this.slider&&(this.slider.component.destroy(),this.slider=void 0),this.width=0,this.start=void 0,this.end=void 0},n}(fo),bu=0,L0=8,aB=32,oB=20,sB=function(r){R(n,r);function n(t){var e=r.call(this,t)||this;return e.onChangeFn=ti,e.resetMeasure=function(){e.clear()},e.onValueChange=function(i){var a=i.ratio,o=e.getValidScrollbarCfg().animate;e.ratio=Kt(a,0,1);var s=e.view.getOptions().animate;o||e.view.animate(!1),e.changeViewData(e.getScrollRange(),!0),e.view.animate(s)},e.container=e.view.getLayer(ue.FORE).addGroup(),e.onChangeFn=Mv(e.onValueChange,20,{leading:!0}),e.trackLen=0,e.thumbLen=0,e.ratio=0,e.view.on(_t.BEFORE_CHANGE_DATA,e.resetMeasure),e.view.on(_t.BEFORE_CHANGE_SIZE,e.resetMeasure),e}return Object.defineProperty(n.prototype,"name",{get:function(){return"scrollbar"},enumerable:!1,configurable:!0}),n.prototype.destroy=function(){r.prototype.destroy.call(this),this.view.off(_t.BEFORE_CHANGE_DATA,this.resetMeasure),this.view.off(_t.BEFORE_CHANGE_SIZE,this.resetMeasure)},n.prototype.init=function(){},n.prototype.render=function(){this.option=this.view.getOptions().scrollbar,this.option?this.scrollbar?this.scrollbar=this.updateScrollbar():(this.scrollbar=this.createScrollbar(),this.scrollbar.component.on("scrollchange",this.onChangeFn)):this.scrollbar&&(this.scrollbar.component.destroy(),this.scrollbar=void 0)},n.prototype.layout=function(){var t=this;if(this.option&&!this.trackLen&&(this.measureScrollbar(),setTimeout(function(){t.view.destroyed||t.changeViewData(t.getScrollRange(),!0)})),this.scrollbar){var e=this.view.coordinateBBox.width,i=this.scrollbar.component.get("padding"),a=this.scrollbar.component.getLayoutBBox(),o=new je(a.x,a.y,Math.min(a.width,e),a.height).expand(i),s=this.getScrollbarComponentCfg(),u=void 0,l=void 0;if(s.isHorizontal){var c=ut(ri(this.view.viewBBox,o,Z.BOTTOM),2);c[0];var f=c[1],h=ut(ri(this.view.coordinateBBox,o,Z.BOTTOM),2),v=h[0];h[1],u=v,l=f}else{var p=ut(ri(this.view.viewBBox,o,Z.RIGHT),2);p[0];var f=p[1],d=ut(ri(this.view.viewBBox,o,Z.RIGHT),2),v=d[0];d[1],u=v,l=f}u+=i[3],l+=i[0],this.trackLen?this.scrollbar.component.update(C(C({},s),{x:u,y:l,trackLen:this.trackLen,thumbLen:this.thumbLen,thumbOffset:(this.trackLen-this.thumbLen)*this.ratio})):this.scrollbar.component.update(C(C({},s),{x:u,y:l})),this.view.viewBBox=this.view.viewBBox.cut(o,s.isHorizontal?Z.BOTTOM:Z.RIGHT)}},n.prototype.update=function(){this.render()},n.prototype.getComponents=function(){return this.scrollbar?[this.scrollbar]:[]},n.prototype.clear=function(){this.scrollbar&&(this.scrollbar.component.destroy(),this.scrollbar=void 0),this.trackLen=0,this.thumbLen=0,this.ratio=0,this.cnt=0,this.step=0,this.data=void 0,this.xScaleCfg=void 0,this.yScalesCfg=[]},n.prototype.setValue=function(t){this.onValueChange({ratio:t})},n.prototype.getValue=function(){return this.ratio},n.prototype.getThemeOptions=function(){var t=this.view.getTheme();return F(t,["components","scrollbar","common"],{})},n.prototype.getScrollbarTheme=function(t){var e=F(this.view.getTheme(),["components","scrollbar"]),i=t||{},a=i.thumbHighlightColor,o=Tt(i,["thumbHighlightColor"]);return{default:J({},F(e,["default","style"],{}),o),hover:J({},F(e,["hover","style"],{}),{thumbColor:a})}},n.prototype.measureScrollbar=function(){var t=this.view.getXScale(),e=this.view.getYScales().slice();this.data=this.getScrollbarData(),this.step=this.getStep(),this.cnt=this.getCnt();var i=this.getScrollbarComponentCfg(),a=i.trackLen,o=i.thumbLen;this.trackLen=a,this.thumbLen=o,this.xScaleCfg={field:t.field,values:t.values||[]},this.yScalesCfg=e},n.prototype.getScrollRange=function(){var t=Math.floor((this.cnt-this.step)*Kt(this.ratio,0,1)),e=Math.min(t+this.step-1,this.cnt-1);return[t,e]},n.prototype.changeViewData=function(t,e){var i=this,a=ut(t,2),o=a[0],s=a[1],u=this.getValidScrollbarCfg().type,l=u!=="vertical",c=Yr(this.data,this.xScaleCfg.field),f=this.view.getXScale().isLinear?c.sort(function(v,p){return Number(v)-Number(p)}):c,h=l?f:f.reverse();this.yScalesCfg.forEach(function(v){i.view.scale(v.field,{formatter:v.formatter,type:v.type,min:v.min,max:v.max,tickMethod:v.tickMethod})}),this.view.filter(this.xScaleCfg.field,function(v){var p=h.indexOf(v);return p>-1?Na(p,o,s):!0}),this.view.render(!0)},n.prototype.createScrollbar=function(){var t=this.getValidScrollbarCfg().type,e=t!=="vertical",i=new Xk(C(C({container:this.container},this.getScrollbarComponentCfg()),{x:0,y:0}));return i.init(),{component:i,layer:ue.FORE,direction:e?Z.BOTTOM:Z.RIGHT,type:Ce.SCROLLBAR}},n.prototype.updateScrollbar=function(){var t=this.getScrollbarComponentCfg(),e=this.trackLen?C(C({},t),{trackLen:this.trackLen,thumbLen:this.thumbLen,thumbOffset:(this.trackLen-this.thumbLen)*this.ratio}):C({},t);return this.scrollbar.component.update(e),this.scrollbar},n.prototype.getStep=function(){if(this.step)return this.step;var t=this.view.coordinateBBox,e=this.getValidScrollbarCfg(),i=e.type,a=e.categorySize,o=i!=="vertical";return Math.floor((o?t.width:t.height)/a)},n.prototype.getCnt=function(){if(this.cnt)return this.cnt;var t=this.view.getXScale(),e=this.getScrollbarData(),i=Yr(e,t.field);return Ee(i)},n.prototype.getScrollbarComponentCfg=function(){var t=this.view,e=t.coordinateBBox,i=t.viewBBox,a=this.getValidScrollbarCfg(),o=a.type,s=a.padding,u=a.width,l=a.height,c=a.style,f=o!=="vertical",h=ut(s,4),v=h[0],p=h[1],d=h[2],g=h[3],y=f?{x:e.minX+g,y:i.maxY-l-d}:{x:i.maxX-u-p,y:e.minY+v},m=this.getStep(),x=this.getCnt(),_=f?e.width-g-p:e.height-v-d,E=Math.max(_*Kt(m/x,0,1),oB);return C(C({},this.getThemeOptions()),{x:y.x,y:y.y,size:f?l:u,isHorizontal:f,trackLen:_,thumbLen:E,thumbOffset:0,theme:this.getScrollbarTheme(c)})},n.prototype.getValidScrollbarCfg=function(){var t={type:"horizontal",categorySize:aB,width:L0,height:L0,padding:[0,0,0,0],animate:!0,style:{}};return wt(this.option)&&(t=C(C({},t),this.option)),(!wt(this.option)||!this.option.padding)&&(t.padding=t.type==="horizontal"?[bu,0,bu,0]:[0,bu,0,bu]),t},n.prototype.getScrollbarData=function(){var t=this.view.getCoordinate(),e=this.getValidScrollbarCfg(),i=this.view.getOptions().data||[];return t.isReflect("y")&&e.type==="vertical"&&(i=te([],ut(i),!1).reverse()),i},n}(fo),uB={fill:"#CCD6EC",opacity:.3};function lB(r,n,t){var e,i,a,o,s,u,l=XO(r,n,t);if(l.length){l=yr(l);try{for(var c=It(l),f=c.next();!f.done;f=c.next()){var h=f.value;try{for(var v=(a=void 0,It(h)),p=v.next();!p.done;p=v.next()){var d=p.value,g=d.mappingData,y=g.x,m=g.y;d.x=V(y)?y[y.length-1]:y,d.y=V(m)?m[m.length-1]:m}}catch(L){a={error:L}}finally{try{p&&!p.done&&(o=v.return)&&o.call(v)}finally{if(a)throw a.error}}}}catch(L){e={error:L}}finally{try{f&&!f.done&&(i=c.return)&&i.call(c)}finally{if(e)throw e.error}}var x=t.shared;if(x===!1&&l.length>1){var _=l[0],E=Math.abs(n.y-_[0].y);try{for(var b=It(l),M=b.next();!M.done;M=b.next()){var T=M.value,k=Math.abs(n.y-T[0].y);k<=E&&(_=T,E=k)}}catch(L){s={error:L}}finally{try{M&&!M.done&&(u=b.return)&&u.call(b)}finally{if(s)throw s.error}}l=[_]}return qa(yr(l))}return[]}var cB=function(r){R(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.show=function(t){var e=this.context.view,i=this.context.event,a=e.getController("tooltip").getTooltipCfg(),o=lB(e,{x:i.x,y:i.y},a);if(!Dt(o,this.items)&&(this.items=o,o.length)){var s=e.getXScale().field,u=o[0].data[s],l=[],c=e.geometries;if(w(c,function(K){if(K.type==="interval"||K.type==="schema"){var Q=K.getElementsBy(function(q){var at=q.getData();return at[s]===u});l=l.concat(Q)}}),l.length){var f=e.getCoordinate(),h=l[0].shape.getCanvasBBox(),v=l[0].shape.getCanvasBBox(),p=h;w(l,function(K){var Q=K.shape.getCanvasBBox();f.isTransposed?(Q.minY<h.minY&&(h=Q),Q.maxY>v.maxY&&(v=Q)):(Q.minX<h.minX&&(h=Q),Q.maxX>v.maxX&&(v=Q)),p.x=Math.min(Q.minX,p.minX),p.y=Math.min(Q.minY,p.minY),p.width=Math.max(Q.maxX,p.maxX)-p.x,p.height=Math.max(Q.maxY,p.maxY)-p.y});var d=e.backgroundGroup,g=e.coordinateBBox,y=void 0;if(f.isRect){var m=e.getXScale(),x=t||{},_=x.appendRatio,E=x.appendWidth;G(E)&&(_=G(_)?m.isLinear?0:.25:_,E=f.isTransposed?_*v.height:_*h.width);var b=void 0,M=void 0,T=void 0,k=void 0;f.isTransposed?(b=g.minX,M=Math.min(v.minY,h.minY)-E,T=g.width,k=p.height+E*2):(b=Math.min(h.minX,v.minX)-E,M=g.minY,T=p.width+E*2,k=g.height),y=[["M",b,M],["L",b+T,M],["L",b+T,M+k],["L",b,M+k],["Z"]]}else{var L=pr(l),O=pe(l),D=vs(L.getModel(),f).startAngle,W=vs(O.getModel(),f).endAngle,j=f.getCenter(),ot=f.getRadius(),z=f.innerRadius*ot;y=ai(j.x,j.y,ot,D,W,z)}if(this.regionPath)this.regionPath.attr("path",y),this.regionPath.show();else{var X=F(t,"style",uB);this.regionPath=d.addShape({type:"path",name:"active-region",capture:!1,attrs:C(C({},X),{path:y})})}}}},n.prototype.hide=function(){this.regionPath&&this.regionPath.hide(),this.items=null},n.prototype.destroy=function(){this.hide(),this.regionPath&&this.regionPath.remove(!0),r.prototype.destroy.call(this)},n}(ee),Rb=function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.timeStamp=0,t}return n.prototype.show=function(){var t=this.context,e=t.event,i=t.view,a=i.isTooltipLocked();if(!a){var o=this.timeStamp,s=+new Date,u=F(t.view.getOptions(),"tooltip.showDelay",16);if(s-o>u){var l=this.location,c={x:e.x,y:e.y};(!l||!Dt(l,c))&&this.showTooltip(i,c),this.timeStamp=s,this.location=c}}},n.prototype.hide=function(){var t=this.context.view,e=t.getController("tooltip"),i=this.context.event,a=i.clientX,o=i.clientY;e.isCursorEntered({x:a,y:o})||t.isTooltipLocked()||(this.hideTooltip(t),this.location=null)},n.prototype.showTooltip=function(t,e){t.showTooltip(e)},n.prototype.hideTooltip=function(t){t.hideTooltip()},n}(ee),fB=function(r){R(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.showTooltip=function(t,e){var i=hn(t);w(i,function(a){var o=yh(t,a,e);a.showTooltip(o)})},n.prototype.hideTooltip=function(t){var e=hn(t);w(e,function(i){i.hideTooltip()})},n}(Rb),hB=function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.timeStamp=0,t}return n.prototype.destroy=function(){r.prototype.destroy.call(this),this.tooltip&&this.tooltip.destroy()},n.prototype.show=function(){var t=this.context,e=t.event,i=this.timeStamp,a=+new Date;if(a-i>16){var o=this.location,s={x:e.x,y:e.y};(!o||!Dt(o,s))&&this.showTooltip(s),this.timeStamp=a,this.location=s}},n.prototype.hide=function(){this.hideTooltip(),this.location=null},n.prototype.showTooltip=function(t){var e=this.context,i=e.event,a=i.target;if(a&&a.get("tip")){this.tooltip||this.renderTooltip();var o=a.get("tip");this.tooltip.update(C({title:o},t)),this.tooltip.show()}},n.prototype.hideTooltip=function(){this.tooltip&&this.tooltip.hide()},n.prototype.renderTooltip=function(){var t,e=this.context.view,i=e.canvas,a={start:{x:0,y:0},end:{x:i.get("width"),y:i.get("height")}},o=e.getTheme(),s=F(o,["components","tooltip","domStyles"],{}),u=new oc({parent:i.get("el").parentNode,region:a,visible:!1,crosshairs:null,domStyles:C({},J({},s,(t={},t[Mr]={"max-width":"50%"},t[On]={"word-break":"break-all"},t)))});u.init(),u.setCapture(!1),this.tooltip=u},n}(ee),yp=function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.stateName="",t}return n.prototype.hasState=function(t){return t.hasState(this.stateName)},n.prototype.setElementState=function(t,e){t.setState(this.stateName,e)},n.prototype.setState=function(){this.setStateEnable(!0)},n.prototype.clear=function(){var t=this.context.view;this.clearViewState(t)},n.prototype.clearViewState=function(t){var e=this,i=OS(t,this.stateName);w(i,function(a){e.setElementState(a,!1)})},n}(ee);function F0(r){return F(r.get("delegateObject"),"item")}var mp=function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.ignoreListItemStates=["unchecked"],t}return n.prototype.isItemIgnore=function(t,e){var i=this.ignoreListItemStates,a=i.filter(function(o){return e.hasState(t,o)});return!!a.length},n.prototype.setStateByComponent=function(t,e,i){var a=this.context.view,o=t.get("field"),s=Fe(a);this.setElementsStateByItem(s,o,e,i)},n.prototype.setStateByElement=function(t,e){this.setElementState(t,e)},n.prototype.isMathItem=function(t,e,i){var a=this.context.view,o=Qa(a,e),s=Zr(t,e);return!G(s)&&i.name===o.getText(s)},n.prototype.setElementsStateByItem=function(t,e,i,a){var o=this;w(t,function(s){o.isMathItem(s,e,i)&&s.setState(o.stateName,a)})},n.prototype.setStateEnable=function(t){var e=ci(this.context);if(e)LS(this.context)&&this.setStateByElement(e,t);else{var i=ea(this.context);if(ds(i)){var a=i.item,o=i.component;if(a&&o&&!this.isItemIgnore(a,o)){var s=this.context.event.gEvent;if(s&&s.fromShape&&s.toShape&&F0(s.fromShape)===F0(s.toShape))return;this.setStateByComponent(o,a,t)}}}},n.prototype.toggle=function(){var t=ci(this.context);if(t){var e=t.hasState(this.stateName);this.setElementState(t,!e)}},n.prototype.reset=function(){this.setStateEnable(!1)},n}(yp),vB=function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.stateName="active",t}return n.prototype.active=function(){this.setState()},n}(mp),pB=function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.cache={},t}return n.prototype.getColorScale=function(t,e){var i=e.geometry.getAttribute("color");if(!i)return null;var a=t.getScaleByField(i.getFields()[0]);return a},n.prototype.getLinkPath=function(t,e){var i=this.context.view,a=i.getCoordinate().isTransposed,o=t.shape.getCanvasBBox(),s=e.shape.getCanvasBBox(),u=a?[["M",o.minX,o.minY],["L",s.minX,s.maxY],["L",s.maxX,s.maxY],["L",o.maxX,o.minY],["Z"]]:[["M",o.maxX,o.minY],["L",s.minX,s.minY],["L",s.minX,s.maxY],["L",o.maxX,o.maxY],["Z"]];return u},n.prototype.addLinkShape=function(t,e,i,a){var o={opacity:.4,fill:e.shape.attr("fill")};t.addShape({type:"path",attrs:C(C({},J({},o,rt(a)?a(o,e):a)),{path:this.getLinkPath(e,i)})})},n.prototype.linkByElement=function(t,e){var i=this,a=this.context.view,o=this.getColorScale(a,t);if(!!o){var s=Zr(t,o.field);if(!this.cache[s]){var u=bO(a,o.field,s),l=this.linkGroup,c=l.addGroup();this.cache[s]=c;var f=u.length;w(u,function(h,v){if(v<f-1){var p=u[v+1];i.addLinkShape(c,h,p,e)}})}}},n.prototype.removeLink=function(t){var e=this.getColorScale(this.context.view,t);if(!!e){var i=Zr(t,e.field);this.cache[i]&&(this.cache[i].remove(),this.cache[i]=null)}},n.prototype.link=function(t){var e=this.context;this.linkGroup||(this.linkGroup=e.view.foregroundGroup.addGroup({id:"link-by-color-group",capture:!1}));var i=ci(e);i&&this.linkByElement(i,t==null?void 0:t.style)},n.prototype.unlink=function(){var t=ci(this.context);t&&this.removeLink(t)},n.prototype.clear=function(){this.linkGroup&&this.linkGroup.clear(),this.cache={}},n.prototype.destroy=function(){r.prototype.destroy.call(this),this.linkGroup&&this.linkGroup.remove()},n}(ee),xp=function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.startPoint=null,t.endPoint=null,t.isStarted=!1,t.effectSiblings=!1,t.effectByRecord=!1,t}return n.prototype.getCurrentPoint=function(){var t=this.context.event;return{x:t.x,y:t.y}},n.prototype.start=function(){this.clear(),this.startPoint=this.getCurrentPoint(),this.isStarted=!0},n.prototype.getIntersectElements=function(){var t=null;if(gs(this.context))t=Xv(this.context,10);else{var e=this.startPoint,i=this.isStarted?this.getCurrentPoint():this.endPoint;if(!e||!i)return;var a={minX:Math.min(e.x,i.x),minY:Math.min(e.y,i.y),maxX:Math.max(e.x,i.x),maxY:Math.max(e.y,i.y)},o=this.context.view;t=Yv(o,a)}return t},n.prototype.setStateEnable=function(t){if(this.effectSiblings&&!this.effectByRecord)this.setSiblingsState(t);else{var e=Fe(this.context.view),i=this.getIntersectElements();i&&i.length?this.effectByRecord?this.setSiblingsStateByRecord(i,t):this.setElementsState(i,t,e):this.clear()}},n.prototype.setSiblingsStateByRecord=function(t,e){var i=this,a=this.context.view,o=hn(a),s=t.map(function(c){return c.getModel().data}),u=a.getXScale().field,l=a.getYScales()[0].field;w(o,function(c){var f=Fe(c),h=f.filter(function(v){var p=v.getModel().data;return IS(s,p,u,l)});i.setElementsState(h,e,f)})},n.prototype.setSiblingsState=function(t){var e=this,i=this.context.view,a=hn(i);gs(this.context)&&w(a,function(o){var s=Fe(o),u=kS(e.context,o,10);u&&u.length?e.setElementsState(u,t,s):e.clearViewState(o)})},n.prototype.setElementsState=function(t,e,i){var a=this;w(i,function(o){t.includes(o)?a.setElementState(o,e):a.setElementState(o,!1)})},n.prototype.end=function(){this.isStarted=!1,this.endPoint=this.getCurrentPoint()},n.prototype.clear=function(){var t=this,e=this.context.view;if(this.effectSiblings){var i=hn(e);w(i,function(a){t.clearViewState(a)})}else this.clearViewState(e)},n}(yp),dB=function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.stateName="active",t}return n.prototype.active=function(){this.setState()},n}(xp),_p=function(r){R(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.setStateEnable=function(t){var e=ci(this.context);if(e){if(!LS(this.context))return;t?(this.clear(),this.setElementState(e,!0)):this.hasState(e)&&this.setElementState(e,!1)}},n.prototype.toggle=function(){var t=ci(this.context);if(t){var e=this.hasState(t);e||this.clear(),this.setElementState(t,!e)}},n.prototype.reset=function(){this.setStateEnable(!1)},n}(yp),gB=function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.stateName="active",t}return n.prototype.active=function(){this.setState()},n}(_p),es="inactive",rs="active";function Cp(r){var n=Fe(r);w(n,function(t){t.hasState(rs)&&t.setState(rs,!1),t.hasState(es)&&t.setState(es,!1)})}function Ib(r,n,t){w(r,function(e){n(e)?(e.hasState(es)&&e.setState(es,!1),e.setState(rs,t)):(e.hasState(rs)&&e.setState(rs,!1),e.setState(es,t))})}var $i=il.INACTIVE,En=il.ACTIVE,Ep=function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.stateName=En,t}return n.prototype.setElementsStateByItem=function(t,e,i,a){var o=this,s=function(u){return o.isMathItem(u,e,i)};this.setHighlightBy(t,s,a)},n.prototype.setElementHighlight=function(t,e){e(t)?(t.hasState($i)&&t.setState($i,!1),t.setState(En,!0)):t.hasState(En)||t.setState($i,!0)},n.prototype.setHighlightBy=function(t,e,i){var a=this;if(i)w(t,function(u){a.setElementHighlight(u,e)});else{var o=OS(this.context.view,En),s=!0;w(o,function(u){if(!e(u))return s=!1,!1}),s?this.clear():w(t,function(u){e(u)&&(u.hasState(En)&&u.setState(En,!1),u.setState($i,!0))})}},n.prototype.setElementState=function(t,e){var i=this.context.view,a=Fe(i);this.setHighlightBy(a,function(o){return t===o},e)},n.prototype.highlight=function(){this.setState()},n.prototype.clear=function(){var t=this.context.view;Cp(t)},n}(mp),yB=function(r){R(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.setStateByElement=function(t,e){var i=this.context.view,a=t.geometry.getAttribute("color");if(!!a){var o=i.getScaleByField(a.getFields()[0]),s=Zr(t,o.field),u=Fe(i),l=u.filter(function(c){return Zr(c,o.field)===s});this.setHighlightBy(u,function(c){return l.includes(c)},e)}},n}(Ep),mB=function(r){R(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.setElementHighlight=function(t,e){e(t)?(t.hasState($i)&&t.setState($i,!1),t.setState(En,!0)):(t.setState($i,!0),t.hasState(En)&&t.setState(En,!1))},n.prototype.setStateByElement=function(t,e){var i=this.context.view,a=i.getXScale(),o=Zr(t,a.field),s=Fe(i),u=s.filter(function(l){return Zr(l,a.field)===o});this.setHighlightBy(s,function(l){return u.includes(l)},e)},n.prototype.toggle=function(){var t=ci(this.context);if(t){var e=t.hasState(this.stateName);this.setStateByElement(t,!e)}},n}(Ep),an;(function(r){r.BEFORE_HIGHLIGHT="element-range-highlight:beforehighlight",r.AFTER_HIGHLIGHT="element-range-highlight:afterhighlight",r.BEFORE_CLEAR="element-range-highlight:beforeclear",r.AFTER_CLEAR="element-range-highlight:afterclear"})(an||(an={}));var Db=function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.stateName="active",t}return n.prototype.clearViewState=function(t){Cp(t)},n.prototype.highlight=function(){var t=this.context,e=t.view,i=t.event,a=this.getIntersectElements(),o={view:e,event:i,highlightElements:a};e.emit(an.BEFORE_HIGHLIGHT,re.fromData(e,an.BEFORE_HIGHLIGHT,o)),this.setState(),e.emit(an.AFTER_HIGHLIGHT,re.fromData(e,an.AFTER_HIGHLIGHT,o))},n.prototype.clear=function(){var t=this.context.view;t.emit(an.BEFORE_CLEAR,re.fromData(t,an.BEFORE_CLEAR,{})),r.prototype.clear.call(this),t.emit(an.AFTER_CLEAR,re.fromData(t,an.AFTER_CLEAR,{}))},n.prototype.setElementsState=function(t,e,i){Ib(i,function(a){return t.indexOf(a)>=0},e)},n}(xp),xB=function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.stateName="active",t}return n.prototype.highlight=function(){this.setState()},n.prototype.setElementState=function(t,e){var i=this.context.view,a=Fe(i);Ib(a,function(o){return t===o},e)},n.prototype.clear=function(){var t=this.context.view;Cp(t)},n}(_p),_B=function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.stateName="selected",t}return n.prototype.selected=function(){this.setState()},n}(xp),CB=function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.stateName="selected",t}return n.prototype.selected=function(){this.setState()},n}(mp),EB=function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.stateName="selected",t}return n.prototype.selected=function(){this.setState()},n}(_p),va=function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.stateName="",t.ignoreItemStates=[],t}return n.prototype.getTriggerListInfo=function(){var t=ea(this.context),e=null;return ds(t)&&(e={item:t.item,list:t.component}),e},n.prototype.getAllowComponents=function(){var t=this,e=this.context.view,i=RS(e),a=[];return w(i,function(o){o.isList()&&t.allowSetStateByElement(o)&&a.push(o)}),a},n.prototype.hasState=function(t,e){return t.hasState(e,this.stateName)},n.prototype.clearAllComponentsState=function(){var t=this,e=this.getAllowComponents();w(e,function(i){i.clearItemsState(t.stateName)})},n.prototype.allowSetStateByElement=function(t){var e=t.get("field");if(!e)return!1;if(this.cfg&&this.cfg.componentNames){var i=t.get("name");if(this.cfg.componentNames.indexOf(i)===-1)return!1}var a=this.context.view,o=Qa(a,e);return o&&o.isCategory},n.prototype.allowSetStateByItem=function(t,e){var i=this.ignoreItemStates;if(i.length){var a=i.filter(function(o){return e.hasState(t,o)});return a.length===0}return!0},n.prototype.setStateByElement=function(t,e,i){var a=t.get("field"),o=this.context.view,s=Qa(o,a),u=Zr(e,a),l=s.getText(u);this.setItemsState(t,l,i)},n.prototype.setStateEnable=function(t){var e=this,i=ci(this.context);if(i){var a=this.getAllowComponents();w(a,function(l){e.setStateByElement(l,i,t)})}else{var o=ea(this.context);if(ds(o)){var s=o.item,u=o.component;this.allowSetStateByElement(u)&&this.allowSetStateByItem(s,u)&&this.setItemState(u,s,t)}}},n.prototype.setItemsState=function(t,e,i){var a=this,o=t.getItems();w(o,function(s){s.name===e&&a.setItemState(t,s,i)})},n.prototype.setItemState=function(t,e,i){t.setItemState(e,this.stateName,i)},n.prototype.setState=function(){this.setStateEnable(!0)},n.prototype.reset=function(){this.setStateEnable(!1)},n.prototype.toggle=function(){var t=this.getTriggerListInfo();if(t&&t.item){var e=t.list,i=t.item,a=this.hasState(e,i);this.setItemState(e,i,!a)}},n.prototype.clear=function(){var t=this.getTriggerListInfo();t?t.list.clearItemsState(this.stateName):this.clearAllComponentsState()},n}(ee),SB=function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.stateName="active",t}return n.prototype.active=function(){this.setState()},n}(va),k0="inactive",O0="active";function bB(r){var n=r.getItems();w(n,function(t){r.hasState(t,O0)&&r.setItemState(t,O0,!1),r.hasState(t,k0)&&r.setItemState(t,k0,!1)})}var Mo="inactive",bi="active",Sp=function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.stateName=bi,t.ignoreItemStates=["unchecked"],t}return n.prototype.setItemsState=function(t,e,i){this.setHighlightBy(t,function(a){return a.name===e},i)},n.prototype.setItemState=function(t,e,i){t.getItems(),this.setHighlightBy(t,function(a){return a===e},i)},n.prototype.setHighlightBy=function(t,e,i){var a=t.getItems();if(i)w(a,function(u){e(u)?(t.hasState(u,Mo)&&t.setItemState(u,Mo,!1),t.setItemState(u,bi,!0)):t.hasState(u,bi)||t.setItemState(u,Mo,!0)});else{var o=t.getItemsByState(bi),s=!0;w(o,function(u){if(!e(u))return s=!1,!1}),s?this.clear():w(a,function(u){e(u)&&(t.hasState(u,bi)&&t.setItemState(u,bi,!1),t.setItemState(u,Mo,!0))})}},n.prototype.highlight=function(){this.setState()},n.prototype.clear=function(){var t=this.getTriggerListInfo();if(t)bB(t.list);else{var e=this.getAllowComponents();w(e,function(i){i.clearItemsState(bi),i.clearItemsState(Mo)})}},n}(va),AB=function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.stateName="selected",t}return n.prototype.selected=function(){this.setState()},n}(va),TB=function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.stateName="unchecked",t}return n.prototype.unchecked=function(){this.setState()},n}(va),_a="unchecked",Au="checked",MB=function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.stateName=Au,t}return n.prototype.setItemState=function(t,e,i){this.setCheckedBy(t,function(a){return a===e},i)},n.prototype.setCheckedBy=function(t,e,i){var a=t.getItems();i&&w(a,function(o){e(o)?(t.hasState(o,_a)&&t.setItemState(o,_a,!1),t.setItemState(o,Au,!0)):t.hasState(o,Au)||t.setItemState(o,_a,!0)})},n.prototype.toggle=function(){var t=this.getTriggerListInfo();if(t&&t.item){var e=t.list,i=t.item,a=!Dl(e.getItems(),function(o){return e.hasState(o,_a)});a||e.hasState(i,_a)?this.setItemState(e,i,!0):this.reset()}},n.prototype.checked=function(){this.setState()},n.prototype.reset=function(){var t=this.getAllowComponents();w(t,function(e){e.clearItemsState(Au),e.clearItemsState(_a)})},n}(va),Ca="unchecked",wB=function(r){R(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.toggle=function(){var t,e,i,a,o,s,u,l,c=this.getTriggerListInfo();if(c!=null&&c.item){var f=c.list,h=c.item,v=f.getItems(),p=v.filter(function(L){return!f.hasState(L,Ca)}),d=v.filter(function(L){return f.hasState(L,Ca)}),g=p[0];if(v.length===p.length)try{for(var y=It(v),m=y.next();!m.done;m=y.next()){var x=m.value;f.setItemState(x,Ca,x.id!==h.id)}}catch(L){t={error:L}}finally{try{m&&!m.done&&(e=y.return)&&e.call(y)}finally{if(t)throw t.error}}else if(v.length-d.length===1)if(g.id===h.id)try{for(var _=It(v),E=_.next();!E.done;E=_.next()){var x=E.value;f.setItemState(x,Ca,!1)}}catch(L){i={error:L}}finally{try{E&&!E.done&&(a=_.return)&&a.call(_)}finally{if(i)throw i.error}}else try{for(var b=It(v),M=b.next();!M.done;M=b.next()){var x=M.value;f.setItemState(x,Ca,x.id!==h.id)}}catch(L){o={error:L}}finally{try{M&&!M.done&&(s=b.return)&&s.call(b)}finally{if(o)throw o.error}}else try{for(var T=It(v),k=T.next();!k.done;k=T.next()){var x=k.value;f.setItemState(x,Ca,x.id!==h.id)}}catch(L){u={error:L}}finally{try{k&&!k.done&&(l=T.return)&&l.call(T)}finally{if(u)throw u.error}}}},n}(va),R0="showRadio",cf="legend-radio-tip",LB=function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.timeStamp=0,t}return n.prototype.show=function(){var t=this.getTriggerListInfo();if(t!=null&&t.item){var e=t.list,i=t.item;e.setItemState(i,R0,!0)}},n.prototype.hide=function(){var t=this.getTriggerListInfo();if(t!=null&&t.item){var e=t.list,i=t.item;e.setItemState(i,R0,!1)}},n.prototype.destroy=function(){r.prototype.destroy.call(this),this.tooltip&&this.tooltip.destroy()},n.prototype.showTip=function(){var t=this.context,e=t.event,i=this.timeStamp,a=+new Date,o=this.context.event.target;if(a-i>16&&o.get("name")==="legend-item-radio"){var s=this.location,u={x:e.x,y:e.y};this.timeStamp=a,this.location=u,(!s||!Dt(s,u))&&this.showTooltip(u)}},n.prototype.hideTip=function(){this.hideTooltip(),this.location=null},n.prototype.showTooltip=function(t){var e=this.context,i=e.event,a=i.target;if(a&&a.get("tip")){this.tooltip||this.renderTooltip();var o=e.view.getCanvas().get("el").getBoundingClientRect(),s=o.x,u=o.y;this.tooltip.update(C(C({title:a.get("tip")},t),{x:t.x+s,y:t.y+u})),this.tooltip.show()}},n.prototype.hideTooltip=function(){this.tooltip&&this.tooltip.hide()},n.prototype.renderTooltip=function(){var t,e=(t={},t[Mr]={padding:"6px 8px",transform:"translate(-50%, -80%)",background:"rgba(0,0,0,0.75)",color:"#fff","border-radius":"2px","z-index":100},t[On]={"font-size":"12px","line-height":"14px","margin-bottom":0,"word-break":"break-all"},t);document.getElementById(cf)&&document.body.removeChild(document.getElementById(cf));var i=new oc({parent:document.body,region:null,visible:!1,crosshairs:null,domStyles:e,containerId:cf});i.init(),i.setCapture(!1),this.tooltip=i},n}(va),bp=function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.maskShape=null,t.points=[],t.starting=!1,t.moving=!1,t.preMovePoint=null,t.shapeType="path",t}return n.prototype.getCurrentPoint=function(){var t=this.context.event;return{x:t.x,y:t.y}},n.prototype.emitEvent=function(t){var e="mask:".concat(t),i=this.context.view,a=this.context.event;i.emit(e,{target:this.maskShape,shape:this.maskShape,points:this.points,x:a.x,y:a.y})},n.prototype.createMask=function(){var t=this.context.view,e=this.getMaskAttrs(),i=t.foregroundGroup.addShape({type:this.shapeType,name:"mask",draggable:!0,attrs:C({fill:"#C5D4EB",opacity:.3},e)});return i},n.prototype.getMaskPath=function(){return[]},n.prototype.show=function(){this.maskShape&&(this.maskShape.show(),this.emitEvent("show"))},n.prototype.start=function(t){this.starting=!0,this.moving=!1,this.points=[this.getCurrentPoint()],this.maskShape||(this.maskShape=this.createMask(),this.maskShape.set("capture",!1)),this.updateMask(t==null?void 0:t.maskStyle),this.emitEvent("start")},n.prototype.moveStart=function(){this.moving=!0,this.preMovePoint=this.getCurrentPoint()},n.prototype.move=function(){if(!(!this.moving||!this.maskShape)){var t=this.getCurrentPoint(),e=this.preMovePoint,i=t.x-e.x,a=t.y-e.y,o=this.points;w(o,function(s){s.x+=i,s.y+=a}),this.updateMask(),this.emitEvent("change"),this.preMovePoint=t}},n.prototype.updateMask=function(t){var e=J({},this.getMaskAttrs(),t);this.maskShape.attr(e)},n.prototype.moveEnd=function(){this.moving=!1,this.preMovePoint=null},n.prototype.end=function(){this.starting=!1,this.emitEvent("end"),this.maskShape&&this.maskShape.set("capture",!0)},n.prototype.hide=function(){this.maskShape&&(this.maskShape.hide(),this.emitEvent("hide"))},n.prototype.resize=function(){this.starting&&this.maskShape&&(this.points.push(this.getCurrentPoint()),this.updateMask(),this.emitEvent("change"))},n.prototype.destroy=function(){this.points=[],this.maskShape&&this.maskShape.remove(),this.maskShape=null,this.preMovePoint=null,r.prototype.destroy.call(this)},n}(ee),FB=function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.shapeType="circle",t}return n.prototype.getMaskAttrs=function(){var t=this.points,e=pe(this.points),i=0,a=0,o=0;if(t.length){var s=t[0];i=Zv(s,e)/2,a=(e.x+s.x)/2,o=(e.y+s.y)/2}return{x:a,y:o,r:i}},n}(bp),Pb=function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.shapeType="rect",t}return n.prototype.getRegion=function(){var t=this.points;return{start:pr(t),end:pe(t)}},n.prototype.getMaskAttrs=function(){var t=this.getRegion(),e=t.start,i=t.end,a=Math.min(e.x,i.x),o=Math.min(e.y,i.y),s=Math.abs(i.x-e.x),u=Math.abs(i.y-e.y);return{x:a,y:o,width:s,height:u}},n}(bp);function I0(r){r.x=Kt(r.x,0,1),r.y=Kt(r.y,0,1)}var Bb=function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.dim="x",t.inPlot=!0,t}return n.prototype.getRegion=function(){var t=null,e=null,i=this.points,a=this.dim,o=this.context.view.getCoordinate(),s=o.invert(pr(i)),u=o.invert(pe(i));return this.inPlot&&(I0(s),I0(u)),a==="x"?(t=o.convert({x:s.x,y:0}),e=o.convert({x:u.x,y:1})):(t=o.convert({x:0,y:s.y}),e=o.convert({x:1,y:u.y})),{start:t,end:e}},n}(Pb),Nb=function(r){R(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.getMaskPath=function(){var t=this.points,e=[];return t.length&&(w(t,function(i,a){a===0?e.push(["M",i.x,i.y]):e.push(["L",i.x,i.y])}),e.push(["L",t[0].x,t[0].y])),e},n.prototype.getMaskAttrs=function(){return{path:this.getMaskPath()}},n.prototype.addPoint=function(){this.resize()},n}(bp),kB=function(r){R(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.getMaskPath=function(){var t=this.points;return MO(t,!0)},n}(Nb),OB=function(r){R(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.setCursor=function(t){var e=this.context.view;e.getCanvas().setCursor(t)},n.prototype.default=function(){this.setCursor("default")},n.prototype.pointer=function(){this.setCursor("pointer")},n.prototype.move=function(){this.setCursor("move")},n.prototype.crosshair=function(){this.setCursor("crosshair")},n.prototype.wait=function(){this.setCursor("wait")},n.prototype.help=function(){this.setCursor("help")},n.prototype.text=function(){this.setCursor("text")},n.prototype.eResize=function(){this.setCursor("e-resize")},n.prototype.wResize=function(){this.setCursor("w-resize")},n.prototype.nResize=function(){this.setCursor("n-resize")},n.prototype.sResize=function(){this.setCursor("s-resize")},n.prototype.neResize=function(){this.setCursor("ne-resize")},n.prototype.nwResize=function(){this.setCursor("nw-resize")},n.prototype.seResize=function(){this.setCursor("se-resize")},n.prototype.swResize=function(){this.setCursor("sw-resize")},n.prototype.nsResize=function(){this.setCursor("ns-resize")},n.prototype.ewResize=function(){this.setCursor("ew-resize")},n.prototype.zoomIn=function(){this.setCursor("zoom-in")},n.prototype.zoomOut=function(){this.setCursor("zoom-out")},n}(ee),RB=function(r){R(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.filterView=function(t,e,i){var a=this;t.getScaleByField(e)&&t.filter(e,i),t.views&&t.views.length&&w(t.views,function(o){a.filterView(o,e,i)})},n.prototype.filter=function(){var t=ea(this.context);if(t){var e=this.context.view,i=t.component,a=i.get("field");if(ds(t)){if(a){var o=i.getItemsByState("unchecked"),s=Qa(e,a),u=o.map(function(v){return v.name});u.length?this.filterView(e,a,function(v){var p=s.getText(v);return!u.includes(p)}):this.filterView(e,a,null),e.render(!0)}}else if(FS(t)){var l=i.getValue(),c=ut(l,2),f=c[0],h=c[1];this.filterView(e,a,function(v){return v>=f&&v<=h}),e.render(!0)}}},n}(ee);function D0(r,n,t,e){var i=Math.min(t[n],e[n]),a=Math.max(t[n],e[n]),o=ut(r.range,2),s=o[0],u=o[1];if(i<s&&(i=s),a>u&&(a=u),i===u&&a===u)return null;var l=r.invert(i),c=r.invert(a);if(r.isCategory){var f=r.values.indexOf(l),h=r.values.indexOf(c),v=r.values.slice(f,h+1);return function(p){return v.includes(p)}}else return function(p){return p>=l&&p<=c}}var Ze;(function(r){r.FILTER="brush-filter-processing",r.RESET="brush-filter-reset",r.BEFORE_FILTER="brush-filter:beforefilter",r.AFTER_FILTER="brush-filter:afterfilter",r.BEFORE_RESET="brush-filter:beforereset",r.AFTER_RESET="brush-filter:afterreset"})(Ze||(Ze={}));var vc=function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.dims=["x","y"],t.startPoint=null,t.isStarted=!1,t}return n.prototype.hasDim=function(t){return this.dims.includes(t)},n.prototype.start=function(){var t=this.context;this.isStarted=!0,this.startPoint=t.getCurrentPoint()},n.prototype.filter=function(){var t,e;if(gs(this.context)){var i=this.context.event.target,a=i.getCanvasBBox();t={x:a.x,y:a.y},e={x:a.maxX,y:a.maxY}}else{if(!this.isStarted)return;t=this.startPoint,e=this.context.getCurrentPoint()}if(!(Math.abs(t.x-e.x)<5||Math.abs(t.x-e.y)<5)){var o=this.context,s=o.view,u=o.event,l={view:s,event:u,dims:this.dims};s.emit(Ze.BEFORE_FILTER,re.fromData(s,Ze.BEFORE_FILTER,l));var c=s.getCoordinate(),f=c.invert(e),h=c.invert(t);if(this.hasDim("x")){var v=s.getXScale(),p=D0(v,"x",f,h);this.filterView(s,v.field,p)}if(this.hasDim("y")){var d=s.getYScales()[0],p=D0(d,"y",f,h);this.filterView(s,d.field,p)}this.reRender(s,{source:Ze.FILTER}),s.emit(Ze.AFTER_FILTER,re.fromData(s,Ze.AFTER_FILTER,l))}},n.prototype.end=function(){this.isStarted=!1},n.prototype.reset=function(){var t=this.context.view;if(t.emit(Ze.BEFORE_RESET,re.fromData(t,Ze.BEFORE_RESET,{})),this.isStarted=!1,this.hasDim("x")){var e=t.getXScale();this.filterView(t,e.field,null)}if(this.hasDim("y")){var i=t.getYScales()[0];this.filterView(t,i.field,null)}this.reRender(t,{source:Ze.RESET}),t.emit(Ze.AFTER_RESET,re.fromData(t,Ze.AFTER_RESET,{}))},n.prototype.filterView=function(t,e,i){t.filter(e,i)},n.prototype.reRender=function(t,e){t.render(!0,e)},n}(ee),Ap=function(r){R(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.filterView=function(t,e,i){var a=hn(t);w(a,function(o){o.filter(e,i)})},n.prototype.reRender=function(t){var e=hn(t);w(e,function(i){i.render(!0)})},n}(vc),IB=function(r){R(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.filter=function(){var t=ea(this.context),e=this.context.view,i=Fe(e);if(gs(this.context)){var a=Xv(this.context,10);a&&w(i,function(d){a.includes(d)?d.show():d.hide()})}else if(t){var o=t.component,s=o.get("field");if(ds(t)){if(s){var u=o.getItemsByState("unchecked"),l=Qa(e,s),c=u.map(function(d){return d.name});w(i,function(d){var g=Zr(d,s),y=l.getText(g);c.indexOf(y)>=0?d.hide():d.show()})}}else if(FS(t)){var f=o.getValue(),h=ut(f,2),v=h[0],p=h[1];w(i,function(d){var g=Zr(d,s);g>=v&&g<=p?d.show():d.hide()})}}},n.prototype.clear=function(){var t=Fe(this.context.view);w(t,function(e){e.show()})},n.prototype.reset=function(){this.clear()},n}(ee),zb=function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.byRecord=!1,t}return n.prototype.filter=function(){gs(this.context)&&(this.byRecord?this.filterByRecord():this.filterByBBox())},n.prototype.filterByRecord=function(){var t=this.context.view,e=Xv(this.context,10);if(!!e){var i=t.getXScale().field,a=t.getYScales()[0].field,o=e.map(function(u){return u.getModel().data}),s=hn(t);w(s,function(u){var l=Fe(u);w(l,function(c){var f=c.getModel().data;IS(o,f,i,a)?c.show():c.hide()})})}},n.prototype.filterByBBox=function(){var t=this,e=this.context.view,i=hn(e);w(i,function(a){var o=kS(t.context,a,10),s=Fe(a);o&&w(s,function(u){o.includes(u)?u.show():u.hide()})})},n.prototype.reset=function(){var t=hn(this.context.view);w(t,function(e){var i=Fe(e);w(i,function(a){a.show()})})},n}(ee),DB=10,PB=5,BB=function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.buttonGroup=null,t.buttonCfg={name:"button",text:"button",textStyle:{x:0,y:0,fontSize:12,fill:"#333333",cursor:"pointer"},padding:[8,10],style:{fill:"#f7f7f7",stroke:"#cccccc",cursor:"pointer"},activeStyle:{fill:"#e6e6e6"}},t}return n.prototype.getButtonCfg=function(){return J(this.buttonCfg,this.cfg)},n.prototype.drawButton=function(){var t=this.getButtonCfg(),e=this.context.view.foregroundGroup.addGroup({name:t.name}),i=e.addShape({type:"text",name:"button-text",attrs:C({text:t.text},t.textStyle)}),a=i.getBBox(),o=Kv(t.padding),s=e.addShape({type:"rect",name:"button-rect",attrs:C({x:a.x-o[3],y:a.y-o[0],width:a.width+o[1]+o[3],height:a.height+o[0]+o[2]},t.style)});s.toBack(),e.on("mouseenter",function(){s.attr(t.activeStyle)}),e.on("mouseleave",function(){s.attr(t.style)}),this.buttonGroup=e},n.prototype.resetPosition=function(){var t=this.context.view,e=t.getCoordinate(),i=e.convert({x:1,y:1}),a=this.buttonGroup,o=a.getBBox(),s=ve(null,[["t",i.x-o.width-DB,i.y+o.height+PB]]);a.setMatrix(s)},n.prototype.show=function(){this.buttonGroup||this.drawButton(),this.resetPosition(),this.buttonGroup.show()},n.prototype.hide=function(){this.buttonGroup&&this.buttonGroup.hide()},n.prototype.destroy=function(){var t=this.buttonGroup;t&&t.remove(),r.prototype.destroy.call(this)},n}(ee),NB=4,zB=function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.starting=!1,t.dragStart=!1,t}return n.prototype.start=function(){this.starting=!0,this.startPoint=this.context.getCurrentPoint()},n.prototype.drag=function(){if(!!this.startPoint){var t=this.context.getCurrentPoint(),e=this.context.view,i=this.context.event;this.dragStart?e.emit("drag",{target:i.target,x:i.x,y:i.y}):Zv(t,this.startPoint)>NB&&(e.emit("dragstart",{target:i.target,x:i.x,y:i.y}),this.dragStart=!0)}},n.prototype.end=function(){if(this.dragStart){var t=this.context.view,e=this.context.event;t.emit("dragend",{target:e.target,x:e.x,y:e.y})}this.starting=!1,this.dragStart=!1},n}(ee),UB=5,HB=function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.starting=!1,t.isMoving=!1,t.startPoint=null,t.startMatrix=null,t}return n.prototype.start=function(){this.starting=!0,this.startPoint=this.context.getCurrentPoint(),this.startMatrix=this.context.view.middleGroup.getMatrix()},n.prototype.move=function(){if(!!this.starting){var t=this.startPoint,e=this.context.getCurrentPoint(),i=Zv(t,e);if(i>UB&&!this.isMoving&&(this.isMoving=!0),this.isMoving){var a=this.context.view,o=ve(this.startMatrix,[["t",e.x-t.x,e.y-t.y]]);a.backgroundGroup.setMatrix(o),a.foregroundGroup.setMatrix(o),a.middleGroup.setMatrix(o)}}},n.prototype.end=function(){this.isMoving&&(this.isMoving=!1),this.startMatrix=null,this.starting=!1,this.startPoint=null},n.prototype.reset=function(){this.starting=!1,this.startPoint=null,this.isMoving=!1;var t=this.context.view;t.backgroundGroup.resetMatrix(),t.foregroundGroup.resetMatrix(),t.middleGroup.resetMatrix(),this.isMoving=!1},n}(ee),P0="x",B0="y",Ub=function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.dims=[P0,B0],t.cfgFields=["dims"],t.cacheScaleDefs={},t}return n.prototype.hasDim=function(t){return this.dims.includes(t)},n.prototype.getScale=function(t){var e=this.context.view;return t==="x"?e.getXScale():e.getYScales()[0]},n.prototype.resetDim=function(t){var e=this.context.view;if(this.hasDim(t)&&this.cacheScaleDefs[t]){var i=this.getScale(t);e.scale(i.field,this.cacheScaleDefs[t]),this.cacheScaleDefs[t]=null}},n.prototype.reset=function(){this.resetDim(P0),this.resetDim(B0);var t=this.context.view;t.render(!0)},n}(ee),$B=function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.startPoint=null,t.starting=!1,t.startCache={},t}return n.prototype.start=function(){var t=this;this.startPoint=this.context.getCurrentPoint(),this.starting=!0;var e=this.dims;w(e,function(i){var a=t.getScale(i),o=a.min,s=a.max,u=a.values;t.startCache[i]={min:o,max:s,values:u}})},n.prototype.end=function(){this.startPoint=null,this.starting=!1,this.startCache={}},n.prototype.translate=function(){var t=this;if(!!this.starting){var e=this.startPoint,i=this.context.view.getCoordinate(),a=this.context.getCurrentPoint(),o=i.invert(e),s=i.invert(a),u=s.x-o.x,l=s.y-o.y,c=this.context.view,f=this.dims;w(f,function(h){t.translateDim(h,{x:u*-1,y:l*-1})}),c.render(!0)}},n.prototype.translateDim=function(t,e){if(this.hasDim(t)){var i=this.getScale(t);i.isLinear&&this.translateLinear(t,i,e)}},n.prototype.translateLinear=function(t,e,i){var a=this.context.view,o=this.startCache[t],s=o.min,u=o.max,l=u-s,c=i[t]*l;this.cacheScaleDefs[t]||(this.cacheScaleDefs[t]={nice:e.nice,min:s,max:u}),a.scale(e.field,{nice:!1,min:s+c,max:u+c})},n.prototype.reset=function(){r.prototype.reset.call(this),this.startPoint=null,this.starting=!1},n}(Ub),GB=function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.zoomRatio=.05,t}return n.prototype.zoomIn=function(){this.zoom(this.zoomRatio)},n.prototype.zoom=function(t){var e=this,i=this.dims;w(i,function(a){e.zoomDim(a,t)}),this.context.view.render(!0)},n.prototype.zoomOut=function(){this.zoom(-1*this.zoomRatio)},n.prototype.zoomDim=function(t,e){if(this.hasDim(t)){var i=this.getScale(t);i.isLinear&&this.zoomLinear(t,i,e)}},n.prototype.zoomLinear=function(t,e,i){var a=this.context.view;this.cacheScaleDefs[t]||(this.cacheScaleDefs[t]={nice:e.nice,min:e.min,max:e.max});var o=this.cacheScaleDefs[t],s=o.max-o.min,u=e.min,l=e.max,c=i*s,f=u-c,h=l+c,v=h-f,p=v/s;h>f&&p<100&&p>.01&&a.scale(e.field,{nice:!1,min:u-c,max:l+c})},n}(Ub);function VB(r){var n=r.gEvent.originalEvent;return n.deltaY>0}var WB=1,jB=function(r){R(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.scroll=function(t){var e=this.context,i=e.view,a=e.event;if(!!i.getOptions().scrollbar){var o=(t==null?void 0:t.wheelDelta)||WB,s=i.getController("scrollbar"),u=i.getXScale(),l=i.getOptions().data,c=Ee(Yr(l,u.field)),f=Ee(u.values),h=s.getValue(),v=Math.floor((c-f)*h),p=v+(VB(a)?o:-o),d=o/(c-f)/1e4,g=Kt(p/(c-f)+d,0,1);s.setValue(g)}},n}(ee),XB="aixs-description-tooltip",YB=function(r){R(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.show=function(){var t=this.context,e=ea(t).axis,i=e.cfg.title,a=i.description,o=i.text,s=i.descriptionTooltipStyle,u=t.event,l=u.x,c=u.y;this.tooltip||this.renderTooltip(),this.tooltip.update({title:o||"",customContent:function(){return`
          <div class="`.concat(Mr,'" style={').concat(s,`}>
            <div class="`).concat(On,`">
              \u5B57\u6BB5\u8BF4\u660E\uFF1A`).concat(a,`
            </div>
          </div>
        `)},x:l,y:c}),this.tooltip.show()},n.prototype.destroy=function(){r.prototype.destroy.call(this),this.tooltip&&this.tooltip.destroy()},n.prototype.hide=function(){this.tooltip&&this.tooltip.hide()},n.prototype.renderTooltip=function(){var t,e=this.context.view,i=e.canvas,a={start:{x:0,y:0},end:{x:i.get("width"),y:i.get("height")}},o=new oc({parent:i.get("el").parentNode,region:a,visible:!1,containerId:XB,domStyles:C({},J({},(t={},t[Mr]={"max-width":"50%",padding:"10px","line-height":"15px","font-size":"12px",color:"rgba(0, 0, 0, .65)"},t[On]={"word-break":"break-all","margin-bottom":"3px"},t)))});o.init(),o.setCapture(!1),this.tooltip=o},n}(ee);UO("dark",PS(MR));fE("canvas",CI);fE("svg",hD);mn("Polygon",TD);mn("Interval",CD);mn("Schema",MD);mn("Path",cp);mn("Point",bD);mn("Line",ED);mn("Area",pD);mn("Edge",dD);mn("Heatmap",gD);mn("Violin",LD);Gs("base",cc);Gs("interval",WD);Gs("pie",jD);Gs("polar",wb);ar("overlap",oP);ar("distribute",YD);ar("fixed-overlap",aP);ar("hide-overlap",gP);ar("limit-in-shape",eP);ar("limit-in-canvas",tP);ar("limit-in-plot",RP);ar("pie-outer",qD);ar("adjust-color",mP);ar("interval-adjust-position",EP);ar("interval-hide-overlap",bP);ar("point-adjust-position",MP);ar("pie-spider",JD);ar("path-adjust-position",FP);mr("fade-in",IP);mr("fade-out",DP);mr("grow-in-x",BP);mr("grow-in-xy",zP);mr("grow-in-y",NP);mr("scale-in-x",$P);mr("scale-in-y",GP);mr("wave-in",WP);mr("zoom-in",jP);mr("zoom-out",XP);mr("position-update",HP);mr("sector-path-update",VP);mr("path-in",UP);co("rect",QP);co("mirror",KP);co("list",ZP);co("matrix",qP);co("circle",YP);co("tree",JP);ha("axis",rB);ha("legend",nB);ha("tooltip",HS);ha("annotation",eB);ha("slider",iB);ha("scrollbar",sB);ct("tooltip",Rb);ct("sibling-tooltip",fB);ct("ellipsis-text",hB);ct("element-active",vB);ct("element-single-active",gB);ct("element-range-active",dB);ct("element-highlight",Ep);ct("element-highlight-by-x",mB);ct("element-highlight-by-color",yB);ct("element-single-highlight",xB);ct("element-range-highlight",Db);ct("element-sibling-highlight",Db,{effectSiblings:!0,effectByRecord:!0});ct("element-selected",CB);ct("element-single-selected",EB);ct("element-range-selected",_B);ct("element-link-by-color",pB);ct("active-region",cB);ct("list-active",SB);ct("list-selected",AB);ct("list-highlight",Sp);ct("list-unchecked",TB);ct("list-checked",MB);ct("list-focus",wB);ct("list-radio",LB);ct("legend-item-highlight",Sp,{componentNames:["legend"]});ct("axis-label-highlight",Sp,{componentNames:["axis"]});ct("axis-description",YB);ct("rect-mask",Pb);ct("x-rect-mask",Bb,{dim:"x"});ct("y-rect-mask",Bb,{dim:"y"});ct("circle-mask",FB);ct("path-mask",Nb);ct("smooth-path-mask",kB);ct("cursor",OB);ct("data-filter",RB);ct("brush",vc);ct("brush-x",vc,{dims:["x"]});ct("brush-y",vc,{dims:["y"]});ct("sibling-filter",Ap);ct("sibling-x-filter",Ap);ct("sibling-y-filter",Ap);ct("element-filter",IB);ct("element-sibling-filter",zb);ct("element-sibling-filter-record",zb,{byRecord:!0});ct("view-drag",zB);ct("view-move",HB);ct("scale-translate",$B);ct("scale-zoom",GB);ct("reset-button",BB,{name:"reset-button",text:"reset"});ct("mousewheel-scroll",jB);function oi(r){return r.isInPlot()}gt("tooltip",{start:[{trigger:"plot:mousemove",action:"tooltip:show",throttle:{wait:50,leading:!0,trailing:!1}},{trigger:"plot:touchmove",action:"tooltip:show",throttle:{wait:50,leading:!0,trailing:!1}}],end:[{trigger:"plot:mouseleave",action:"tooltip:hide"},{trigger:"plot:leave",action:"tooltip:hide"},{trigger:"plot:touchend",action:"tooltip:hide"}]});gt("ellipsis-text",{start:[{trigger:"legend-item-name:mousemove",action:"ellipsis-text:show",throttle:{wait:50,leading:!0,trailing:!1}},{trigger:"legend-item-name:touchstart",action:"ellipsis-text:show",throttle:{wait:50,leading:!0,trailing:!1}},{trigger:"axis-label:mousemove",action:"ellipsis-text:show",throttle:{wait:50,leading:!0,trailing:!1}},{trigger:"axis-label:touchstart",action:"ellipsis-text:show",throttle:{wait:50,leading:!0,trailing:!1}}],end:[{trigger:"legend-item-name:mouseleave",action:"ellipsis-text:hide"},{trigger:"legend-item-name:touchend",action:"ellipsis-text:hide"},{trigger:"axis-label:mouseleave",action:"ellipsis-text:hide"},{trigger:"axis-label:mouseout",action:"ellipsis-text:hide"},{trigger:"axis-label:touchend",action:"ellipsis-text:hide"}]});gt("element-active",{start:[{trigger:"element:mouseenter",action:"element-active:active"}],end:[{trigger:"element:mouseleave",action:"element-active:reset"}]});gt("element-selected",{start:[{trigger:"element:click",action:"element-selected:toggle"}]});gt("element-highlight",{start:[{trigger:"element:mouseenter",action:"element-highlight:highlight"}],end:[{trigger:"element:mouseleave",action:"element-highlight:reset"}]});gt("element-highlight-by-x",{start:[{trigger:"element:mouseenter",action:"element-highlight-by-x:highlight"}],end:[{trigger:"element:mouseleave",action:"element-highlight-by-x:reset"}]});gt("element-highlight-by-color",{start:[{trigger:"element:mouseenter",action:"element-highlight-by-color:highlight"}],end:[{trigger:"element:mouseleave",action:"element-highlight-by-color:reset"}]});gt("legend-active",{start:[{trigger:"legend-item:mouseenter",action:["list-active:active","element-active:active"]}],end:[{trigger:"legend-item:mouseleave",action:["list-active:reset","element-active:reset"]}]});gt("legend-highlight",{start:[{trigger:"legend-item:mouseenter",action:["legend-item-highlight:highlight","element-highlight:highlight"]}],end:[{trigger:"legend-item:mouseleave",action:["legend-item-highlight:reset","element-highlight:reset"]}]});gt("axis-label-highlight",{start:[{trigger:"axis-label:mouseenter",action:["axis-label-highlight:highlight","element-highlight:highlight"]}],end:[{trigger:"axis-label:mouseleave",action:["axis-label-highlight:reset","element-highlight:reset"]}]});gt("element-list-highlight",{start:[{trigger:"element:mouseenter",action:["list-highlight:highlight","element-highlight:highlight"]}],end:[{trigger:"element:mouseleave",action:["list-highlight:reset","element-highlight:reset"]}]});gt("element-range-highlight",{showEnable:[{trigger:"plot:mouseenter",action:"cursor:crosshair"},{trigger:"mask:mouseenter",action:"cursor:move"},{trigger:"plot:mouseleave",action:"cursor:default"},{trigger:"mask:mouseleave",action:"cursor:crosshair"}],start:[{trigger:"plot:mousedown",isEnable:function(r){return!r.isInShape("mask")},action:["rect-mask:start","rect-mask:show"]},{trigger:"mask:dragstart",action:["rect-mask:moveStart"]}],processing:[{trigger:"plot:mousemove",action:["rect-mask:resize"]},{trigger:"mask:drag",action:["rect-mask:move"]},{trigger:"mask:change",action:["element-range-highlight:highlight"]}],end:[{trigger:"plot:mouseup",action:["rect-mask:end"]},{trigger:"mask:dragend",action:["rect-mask:moveEnd"]},{trigger:"document:mouseup",isEnable:function(r){return!r.isInPlot()},action:["element-range-highlight:clear","rect-mask:end","rect-mask:hide"]}],rollback:[{trigger:"dblclick",action:["element-range-highlight:clear","rect-mask:hide"]}]});gt("brush",{showEnable:[{trigger:"plot:mouseenter",action:"cursor:crosshair"},{trigger:"plot:mouseleave",action:"cursor:default"}],start:[{trigger:"mousedown",isEnable:oi,action:["brush:start","rect-mask:start","rect-mask:show"]}],processing:[{trigger:"mousemove",isEnable:oi,action:["rect-mask:resize"]}],end:[{trigger:"mouseup",isEnable:oi,action:["brush:filter","brush:end","rect-mask:end","rect-mask:hide","reset-button:show"]}],rollback:[{trigger:"reset-button:click",action:["brush:reset","reset-button:hide","cursor:crosshair"]}]});gt("brush-visible",{showEnable:[{trigger:"plot:mouseenter",action:"cursor:crosshair"},{trigger:"plot:mouseleave",action:"cursor:default"}],start:[{trigger:"plot:mousedown",action:["rect-mask:start","rect-mask:show"]}],processing:[{trigger:"plot:mousemove",action:["rect-mask:resize"]},{trigger:"mask:change",action:["element-range-highlight:highlight"]}],end:[{trigger:"plot:mouseup",action:["rect-mask:end","rect-mask:hide","element-filter:filter","element-range-highlight:clear"]}],rollback:[{trigger:"dblclick",action:["element-filter:clear"]}]});gt("brush-x",{showEnable:[{trigger:"plot:mouseenter",action:"cursor:crosshair"},{trigger:"plot:mouseleave",action:"cursor:default"}],start:[{trigger:"mousedown",isEnable:oi,action:["brush-x:start","x-rect-mask:start","x-rect-mask:show"]}],processing:[{trigger:"mousemove",isEnable:oi,action:["x-rect-mask:resize"]}],end:[{trigger:"mouseup",isEnable:oi,action:["brush-x:filter","brush-x:end","x-rect-mask:end","x-rect-mask:hide"]}],rollback:[{trigger:"dblclick",action:["brush-x:reset"]}]});gt("element-path-highlight",{showEnable:[{trigger:"plot:mouseenter",action:"cursor:crosshair"},{trigger:"plot:mouseleave",action:"cursor:default"}],start:[{trigger:"mousedown",isEnable:oi,action:"path-mask:start"},{trigger:"mousedown",isEnable:oi,action:"path-mask:show"}],processing:[{trigger:"mousemove",action:"path-mask:addPoint"}],end:[{trigger:"mouseup",action:"path-mask:end"}],rollback:[{trigger:"dblclick",action:"path-mask:hide"}]});gt("element-single-selected",{start:[{trigger:"element:click",action:"element-single-selected:toggle"}]});gt("legend-filter",{showEnable:[{trigger:"legend-item:mouseenter",action:["cursor:pointer","list-radio:show"]},{trigger:"legend-item:mouseleave",action:["cursor:default","list-radio:hide"]}],start:[{trigger:"legend-item:click",isEnable:function(r){return!r.isInShape("legend-item-radio")},action:["legend-item-highlight:reset","element-highlight:reset","list-unchecked:toggle","data-filter:filter","list-radio:show"]},{trigger:"legend-item-radio:mouseenter",action:["list-radio:showTip"]},{trigger:"legend-item-radio:mouseleave",action:["list-radio:hideTip"]},{trigger:"legend-item-radio:click",action:["list-focus:toggle","data-filter:filter","list-radio:show"]}]});gt("continuous-filter",{start:[{trigger:"legend:valuechanged",action:"data-filter:filter"}]});gt("continuous-visible-filter",{start:[{trigger:"legend:valuechanged",action:"element-filter:filter"}]});gt("legend-visible-filter",{showEnable:[{trigger:"legend-item:mouseenter",action:"cursor:pointer"},{trigger:"legend-item:mouseleave",action:"cursor:default"}],start:[{trigger:"legend-item:click",action:["legend-item-highlight:reset","element-highlight:reset","list-unchecked:toggle","element-filter:filter"]}]});gt("active-region",{start:[{trigger:"plot:mousemove",action:"active-region:show"}],end:[{trigger:"plot:mouseleave",action:"active-region:hide"}]});gt("axis-description",{start:[{trigger:"axis-description:mousemove",action:"axis-description:show"}],end:[{trigger:"axis-description:mouseleave",action:"axis-description:hide"}]});function N0(r){return r.gEvent.preventDefault(),r.gEvent.originalEvent.deltaY>0}gt("view-zoom",{start:[{trigger:"plot:mousewheel",isEnable:function(r){return N0(r.event)},action:"scale-zoom:zoomOut",throttle:{wait:100,leading:!0,trailing:!1}},{trigger:"plot:mousewheel",isEnable:function(r){return!N0(r.event)},action:"scale-zoom:zoomIn",throttle:{wait:100,leading:!0,trailing:!1}}]});gt("sibling-tooltip",{start:[{trigger:"plot:mousemove",action:"sibling-tooltip:show"}],end:[{trigger:"plot:mouseleave",action:"sibling-tooltip:hide"}]});gt("plot-mousewheel-scroll",{start:[{trigger:"plot:mousewheel",action:"mousewheel-scroll:scroll"}]});function ht(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];return function(t){return r.reduce(function(e,i){return i(e)},t)}}function Nt(r,n){var t={};return r!==null&&typeof r=="object"&&n.forEach(function(e){var i=r[e];i!==void 0&&(t[e]=i)}),t}function Hb(r,n){return n?ze(n,function(t,e,i){return t.replace(new RegExp("{\\s*"+i+"\\s*}","g"),e)},r):r}var qr;(function(r){r.ERROR="error",r.WARN="warn",r.INFO="log"})(qr||(qr={}));var ZB="AntV/G2Plot";function qB(r){for(var n=[],t=1;t<arguments.length;t++)n[t-1]=arguments[t];var e=0;return ZB+": "+r.replace(/%s/g,function(){return""+n[e++]})}function In(r,n,t){for(var e=[],i=3;i<arguments.length;i++)e[i-3]=arguments[i];n||console[r](qB.apply(void 0,Yt([t],e)))}function Lh(r){if(!r)return{width:0,height:0};var n=getComputedStyle(r);return{width:(r.clientWidth||parseInt(n.width,10))-parseInt(n.paddingLeft,10)-parseInt(n.paddingRight,10),height:(r.clientHeight||parseInt(n.height,10))-parseInt(n.paddingTop,10)-parseInt(n.paddingBottom,10)}}function Ie(r,n){return r.geometries.find(function(t){return t.type===n})}function dl(r){return ze(r.geometries,function(n,t){return n.concat(t.elements)},[])}function xs(r){return F(r,["views","length"],0)<=0?dl(r):ze(r.views,function(n,t){return n.concat(xs(t))},dl(r))}function KB(r){return F(r,["views","length"],0)<=0?r.geometries:ze(r.views,function(n,t){return n.concat(t.geometries)},r.geometries)}function Et(r,n){return r.views.find(function(t){return t.id===n})}function Vo(r){var n=r.parent;return n?n.views:[]}function z0(r){return Vo(r).filter(function(n){return n!==r})}function Se(r){if(!mi(r,"Object"))return r;var n=C({},r);return n.formatter&&!n.content&&(n.content=n.formatter),n}function QB(r,n){var t=[];if(r.length){t.push(["M",r[0].x,r[0].y]);for(var e=1,i=r.length;e<i;e+=1){var a=r[e];t.push(["L",a.x,a.y])}n&&t.push(["Z"])}return t}var JB=function(r,n,t,e){var i=[],a,o,s=!!e,u,l;if(s){u=[1/0,1/0],l=[-1/0,-1/0];for(var c=0,f=r.length;c<f;c++){var h=r[c];u=Ae([0,0],u,h),l=Te([0,0],l,h)}u=Ae([0,0],u,e[0]),l=Te([0,0],l,e[1])}for(var c=0,v=r.length;c<v;c++){var h=r[c];if(t)a=r[c?c-1:v-1],o=r[(c+1)%v];else if(c===0||c===v-1){i.push(h);continue}else a=r[c-1],o=r[c+1];var p=[0,0];p=vr(p,o,a),p=Ge(p,p,n);var d=Xa(h,a),g=Xa(h,o),y=d+g;y!==0&&(d/=y,g/=y);var m=Ge([0,0],p,-d),x=Ge([0,0],p,g),_=Zt([0,0],h,m),E=Zt([0,0],h,x);s&&(_=Te([0,0],_,u),_=Ae([0,0],_,l),E=Te([0,0],E,u),E=Ae([0,0],E,l)),i.push(_),i.push(E)}return t&&i.push(i.shift()),i};function t4(r,n,t){for(var e=!!n,i=[],a=0,o=r.length;a<o;a+=2)i.push([r[a],r[a+1]]);for(var s=JB(i,.4,e,t),u=i.length,l=[],c,f,h,a=0;a<u-1;a++)c=s[a*2],f=s[a*2+1],h=i[a+1],l.push(["C",c[0],c[1],f[0],f[1],h[0],h[1]]);return e&&(c=s[u],f=s[u+1],h=i[0],l.push(["C",c[0],c[1],f[0],f[1],h[0],h[1]])),l}function e4(r,n,t){var e=[],i=r[0],a=null;if(r.length<=2)return QB(r,n);for(var o=0,s=r.length;o<s;o++){var u=r[o];(!a||!(a.x===u.x&&a.y===u.y))&&(e.push(u.x),e.push(u.y),a=u)}var l=t||[[0,0],[1,1]],c=t4(e,n,l);return c.unshift(["M",i.x,i.y]),c}var r4=5,n4={}.toString,$b=function(r,n){return n4.call(r)==="[object "+n+"]"},i4=function(r){return $b(r,"Array")},a4=function(r){return typeof r=="object"&&r!==null},U0=function(r){if(!a4(r)||!$b(r,"Object"))return!1;for(var n=r;Object.getPrototypeOf(n)!==null;)n=Object.getPrototypeOf(n);return Object.getPrototypeOf(r)===n},Gb=function(r,n,t,e){t=t||0,e=e||r4;for(var i in n)if(Object.prototype.hasOwnProperty.call(n,i)){var a=n[i];a?U0(a)?(U0(r[i])||(r[i]={}),t<e?Gb(r[i],a,t+1,e):r[i]=n[i]):i4(a)?(r[i]=[],r[i]=r[i].concat(a)):r[i]=a:r[i]=a}},N=function(r){for(var n=[],t=1;t<arguments.length;t++)n[t-1]=arguments[t];for(var e=0;e<n.length;e+=1)Gb(r,n[e]);return r};function H0(r){if(!r)return r;var n=r.match(/(([A-Z]{0,1}[a-z]*[^A-Z])|([A-Z]{1}))/g);return n.map(function(t){return t.toLowerCase()}).join("-")}function Vb(r){var n={overflow:"hidden","white-space":"nowrap","text-overflow":"ellipsis",display:"flex",justifyContent:"center",alignItems:"center"},t=["stroke","lineWidth","shadowColor","strokeOpacity","shadowBlur","shadowOffsetX","shadowOffsetY","fill"];F(r,"fill")&&(n.color=r.fill);var e=Nt(r,t),i=e.shadowColor,a=e.shadowBlur,o=a===void 0?0:a,s=e.shadowOffsetX,u=s===void 0?0:s,l=e.shadowOffsetY,c=l===void 0?0:l;n["text-shadow"]=""+[i,u+"px",c+"px",o+"px"].join(" ");var f=Nt(r,t),h=f.stroke,v=f.lineWidth,p=v===void 0?0:v;return n["-webkit-text-stroke"]=""+[p+"px",h].join(" "),w(r,function(d,g){["fontSize"].includes(g)&&dt(d)?n[H0(g)]=d+"px":g&&!t.includes(g)&&(n[H0(g)]=""+d)}),n}function Wb(r,n){r.style["pointer-events"]="none",w(n,function(t,e){e&&t&&(r.style[e]=t)})}var pc=function(r,n,t){var e=n.statistic,i=n.plotType,a=e.title,o=e.content;[a,o].forEach(function(s,u){if(!!s){var l="";u===0?l=o?"translate(-50%, -100%)":"translate(-50%, -50%)":l=a?"translate(-50%, 0)":"translate(-50%, -50%)";var c=rt(s.style)?s.style(t):s.style;r.annotation().html(C({position:["50%","50%"],html:function(f,h){var v=h.getCoordinate(),p=0;if(i==="pie"||i==="ring-progress")p=v.getRadius()*v.innerRadius*2;else if(i==="liquid"){var d=F(h.geometries,[0,"elements",0,"shape"]);if(d){var g=d.find(function(_){return _.get("name")==="wrap"}),y=g.getCanvasBBox().width;p=y}}else p||(p=v.getWidth());Wb(f,C({width:p+"px",transform:l},Vb(c)));var m=h.getData();if(s.customHtml)return s.customHtml(f,h,t,m);var x=s.content;return s.formatter&&(x=s.formatter(t,m)),x?lt(x)?x:""+x:"<div></div>"},key:(u===0?"top":"bottom")+"-statistic"},Nt(s,["offsetX","offsetY","rotate","style","formatter"])))}})},o4=function(r,n,t){var e=n.statistic,i=e.title,a=e.content;[i,a].forEach(function(o){if(!!o){var s=rt(o.style)?o.style(t):o.style;r.annotation().html(C({position:["50%","100%"],html:function(u,l){var c=l.getCoordinate(),f=l.views[0].getCoordinate(),h=f.getCenter(),v=f.getRadius(),p=Math.max(Math.sin(f.startAngle),Math.sin(f.endAngle))*v,d=h.y+p-c.y.start-parseFloat(F(s,"fontSize",0)),g=c.getRadius()*c.innerRadius*2;Wb(u,C({width:g+"px",transform:"translate(-50%, "+d+"px)"},Vb(s)));var y=l.getData();if(o.customHtml)return o.customHtml(u,l,t,y);var m=o.content;return o.formatter&&(m=o.formatter(t,y)),m?lt(m)?m:""+m:"<div></div>"}},Nt(o,["offsetX","offsetY","rotate","style","formatter"])))}})},ff;function s4(){return ff||(ff=document.createElement("canvas").getContext("2d")),ff}so(function(r,n){n===void 0&&(n={});var t=n.fontSize,e=n.fontFamily,i=e===void 0?"sans-serif":e,a=n.fontWeight,o=n.fontStyle,s=n.fontVariant,u=s4();u.font=[o,a,s,t+"px",i].join(" ");var l=u.measureText(lt(r)?r:"");return l.width},function(r,n){return n===void 0&&(n={}),Yt([r],Pl(n)).join("")});function na(r){return typeof r=="number"&&!isNaN(r)}function u4(r,n,t){var e=Math.min(n,t),i=Math.max(n,t);return r>=e&&r<=i}function Tp(r,n){if(!r)return{};var t=r.filter(function(a){var o=F(a,[n]);return dt(o)&&!isNaN(o)}),e=t.every(function(a){return F(a,[n])>=0}),i=t.every(function(a){return F(a,[n])<=0});return e?{min:0}:i?{max:0}:{}}function jb(r,n,t,e,i){if(i===void 0&&(i=[]),!Array.isArray(r))return{nodes:[],links:[]};var a=[],o={},s=-1;return r.forEach(function(u){var l=u[n],c=u[t],f=u[e],h=Nt(u,i);o[l]||(o[l]=C({id:++s,name:l},h)),o[c]||(o[c]=C({id:++s,name:c},h)),a.push(C({source:o[l].id,target:o[c].id,value:f},h))}),{nodes:Object.values(o).sort(function(u,l){return u.id-l.id}),links:a}}function eo(r,n){var t=Pe(r,function(e){var i=e[n];return i===null||typeof i=="number"&&!isNaN(i)});return In(qr.WARN,t.length===r.length,"illegal data existed in chart data."),t}function hi(r){if(dt(r))return[r,r,r,r];if(V(r)){var n=r.length;if(n===1)return[r[0],r[0],r[0],r[0]];if(n===2)return[r[0],r[1],r[0],r[1]];if(n===3)return[r[0],r[1],r[2],r[1]];if(n===4)return r}return[0,0,0,0]}function dc(r,n,t){n===void 0&&(n="bottom"),t===void 0&&(t=25);var e=hi(r),i=[n.startsWith("top")?t:0,n.startsWith("right")?t:0,n.startsWith("bottom")?t:0,n.startsWith("left")?t:0];return[e[0]+i[0],e[1]+i[1],e[2]+i[2],e[3]+i[3]]}function Mp(r){var n=r.map(function(e){return hi(e)}),t=[0,0,0,0];return n.length>0&&(t=t.map(function(e,i){return n.forEach(function(a,o){e+=n[o][i]}),e})),t}var l4={locale:"en-US"},Xu={};function Xb(r,n){Xu[r]=n}function gc(r){return{get:function(n,t){return Hb(F(Xu[r],n)||F(Xu[l4.locale],n)||F(Xu["en-US"],n)||n,t)}}}var c4={locale:"en-US",general:{increase:"Increase",decrease:"Decrease",root:"Root"},statistic:{total:"Total"},conversionTag:{label:"Rate"},legend:{},tooltip:{},slider:{},scrollbar:{},waterfall:{total:"Total"}},f4={locale:"zh-CN",general:{increase:"\u589E\u52A0",decrease:"\u51CF\u5C11",root:"\u521D\u59CB"},statistic:{total:"\u603B\u8BA1"},conversionTag:{label:"\u8F6C\u5316\u7387"},legend:{},tooltip:{},slider:{},scrollbar:{},waterfall:{total:"\u603B\u8BA1"}},$0="data-chart-source-type",Yb=["padding","appendPadding","renderer","pixelRatio","syncViewPadding","supportCSSTransform","limitInPlot"],yt=function(r){R(n,r);function n(t,e){var i=r.call(this)||this;return i.container=typeof t=="string"?document.getElementById(t):t,i.options=N({},i.getDefaultOptions(),e),i.createG2(),i.bindEvents(),i}return n.getDefaultOptions=function(){return{renderer:"canvas",xAxis:{nice:!0,label:{autoRotate:!1,autoHide:{type:"equidistance",cfg:{minGap:6}}}},yAxis:{nice:!0,label:{autoHide:!0,autoRotate:!1}},animation:!0}},n.prototype.createG2=function(){var t=this.options,e=t.width,i=t.height,a=t.defaultInteractions;this.chart=new rR(C(C(C(C({container:this.container,autoFit:!1},this.getChartSize(e,i)),{localRefresh:!1}),Nt(this.options,Yb)),{defaultInteractions:a})),this.container.setAttribute($0,"G2Plot")},n.prototype.getChartSize=function(t,e){var i=Lh(this.container);return{width:t||i.width||400,height:e||i.height||400}},n.prototype.bindEvents=function(){var t=this;this.chart&&this.chart.on("*",function(e){e!=null&&e.type&&t.emit(e.type,e)})},n.prototype.getDefaultOptions=function(){return n.getDefaultOptions()},n.prototype.render=function(){this.chart.clear(),this.chart.options={data:[],animate:!0},this.chart.views=[],this.execAdaptor(),this.chart.render(),this.bindSizeSensor()},n.prototype.update=function(t){this.updateOption(t),this.render()},n.prototype.updateOption=function(t){this.options=N({},this.options,t)},n.prototype.setState=function(t,e,i){i===void 0&&(i=!0);var a=xs(this.chart);w(a,function(o){e(o.getData())&&o.setState(t,i)})},n.prototype.getStates=function(){var t=xs(this.chart),e=[];return w(t,function(i){var a=i.getData(),o=i.getStates();w(o,function(s){e.push({data:a,state:s,geometry:i.geometry,element:i})})}),e},n.prototype.changeData=function(t){this.update({data:t})},n.prototype.changeSize=function(t,e){this.chart.changeSize(t,e)},n.prototype.addAnnotations=function(t,e){e=e||this.chart;var i=Yt(t),a=e.getController("annotation"),o=a.getComponents().map(function(l){return l.extra});a.clear(!0);for(var s=function(l){var c=o[l],f=i.findIndex(function(h){return h.id&&h.id===c.id});f!==-1&&(c=N({},c,i[f]),i.splice(f,1)),a.annotation(c)},u=0;u<o.length;u++)s(u);i.forEach(function(l){return a.annotation(l)}),e.render(!0)},n.prototype.removeAnnotations=function(t){var e=this.chart.getController("annotation"),i=e.getComponents().map(function(s){return s.extra});e.clear(!0);for(var a=function(s){var u=i[s];t.find(function(l){return l.id&&l.id===u.id})||e.annotation(u)},o=0;o<i.length;o++)a(o);this.chart.render(!0)},n.prototype.destroy=function(){this.unbindSizeSensor(),this.chart.destroy(),this.off(),this.container.removeAttribute($0)},n.prototype.execAdaptor=function(){var t=this.getSchemaAdaptor(),e=this.options,i=e.padding,a=e.appendPadding;this.chart.padding=i,this.chart.appendPadding=a,t({chart:this.chart,options:this.options})},n.prototype.triggerResize=function(){this.chart.forceFit()},n.prototype.bindSizeSensor=function(){var t=this;if(!this.unbind){var e=this.options.autoFit,i=e===void 0?!0:e;i&&(this.unbind=mM(this.container,function(){var a=Lh(t.container),o=a.width,s=a.height;(o!==t.chart.width||s!==t.chart.height)&&t.triggerResize()}))}},n.prototype.unbindSizeSensor=function(){this.unbind&&(this.unbind(),this.unbind=void 0)},n}(fa),tr=["type","alias","tickCount","tickInterval","min","max","nice","minLimit","maxLimit","range","tickMethod","base","exponent","mask","sync"];function yc(){return typeof window=="object"?window==null?void 0:window.devicePixelRatio:2}function wp(r,n){n===void 0&&(n=r);var t=document.createElement("canvas"),e=yc();t.width=r*e,t.height=n*e,t.style.width=r+"px",t.style.height=n+"px";var i=t.getContext("2d");return i.scale(e,e),t}function Lp(r,n,t,e){e===void 0&&(e=t);var i=n.backgroundColor,a=n.opacity;r.globalAlpha=a,r.fillStyle=i,r.beginPath(),r.fillRect(0,0,t,e),r.closePath()}function Zb(r,n,t){var e=r+n;return t?e*2:e}function qb(r,n){var t=n?[[r*.25,r*.25],[r*.75,r*.75]]:[[r*.5,r*.5]];return t}function Fp(r,n){var t=n*Math.PI/180,e={a:Math.cos(t)*(1/r),b:Math.sin(t)*(1/r),c:-Math.sin(t)*(1/r),d:Math.cos(t)*(1/r),e:0,f:0};return e}var h4={size:6,padding:2,backgroundColor:"transparent",opacity:1,rotation:0,fill:"#fff",fillOpacity:.5,stroke:"transparent",lineWidth:0,isStagger:!0};function v4(r,n,t,e){var i=n.size,a=n.fill,o=n.lineWidth,s=n.stroke,u=n.fillOpacity;r.beginPath(),r.globalAlpha=u,r.fillStyle=a,r.strokeStyle=s,r.lineWidth=o,r.arc(t,e,i/2,0,2*Math.PI,!1),r.fill(),o&&r.stroke(),r.closePath()}function p4(r){var n=N({},h4,r),t=n.size,e=n.padding,i=n.isStagger,a=n.rotation,o=Zb(t,e,i),s=qb(o,i),u=wp(o,o),l=u.getContext("2d");Lp(l,n,o);for(var c=0,f=s;c<f.length;c++){var h=f[c],v=h[0],p=h[1];v4(l,n,v,p)}var d=l.createPattern(u,"repeat");if(d){var g=yc(),y=Fp(g,a);d.setTransform(y)}return d}var d4={rotation:45,spacing:5,opacity:1,backgroundColor:"transparent",strokeOpacity:.5,stroke:"#fff",lineWidth:2};function g4(r,n,t){var e=n.stroke,i=n.lineWidth,a=n.strokeOpacity,o=new Path2D(t);r.globalAlpha=a,r.lineCap="square",r.strokeStyle=i?e:"transparent",r.lineWidth=i,r.stroke(o)}function y4(r){var n=N({},d4,r),t=n.spacing,e=n.rotation,i=n.lineWidth,a=t+i||1,o=t+i||1,s=`
            M 0 0 L `+a+` 0
            M 0 `+o+" L "+a+" "+o+`
            `,u=wp(a,o),l=u.getContext("2d");Lp(l,n,a,o),g4(l,n,s);var c=l.createPattern(u,"repeat");if(c){var f=yc(),h=Fp(f,e);c.setTransform(h)}return c}var m4={size:6,padding:1,isStagger:!0,backgroundColor:"transparent",opacity:1,rotation:0,fill:"#fff",fillOpacity:.5,stroke:"transparent",lineWidth:0};function x4(r,n,t,e){var i=n.stroke,a=n.size,o=n.fill,s=n.lineWidth,u=n.fillOpacity;r.globalAlpha=u,r.strokeStyle=i,r.lineWidth=s,r.fillStyle=o,r.strokeRect(t-a/2,e-a/2,a,a),r.fillRect(t-a/2,e-a/2,a,a)}function _4(r){var n=N({},m4,r),t=n.size,e=n.padding,i=n.isStagger,a=n.rotation,o=Zb(t,e,i),s=qb(o,i),u=wp(o,o),l=u.getContext("2d");Lp(l,n,o);for(var c=0,f=s;c<f.length;c++){var h=f[c],v=h[0],p=h[1];x4(l,n,v,p)}var d=l.createPattern(u,"repeat");if(d){var g=yc(),y=Fp(g,a);d.setTransform(y)}return d}function C4(r){var n=r.type,t=r.cfg,e;switch(n){case"dot":e=p4(t);break;case"line":e=y4(t);break;case"square":e=_4(t);break}return e}function xr(r){var n=this;return function(t){var e,i=t.options,a=t.chart,o=i.pattern;if(!o)return t;var s=function(u){for(var l,c,f,h=[],v=1;v<arguments.length;v++)h[v-1]=arguments[v];var p=a.getTheme().defaultColor,d=p,g=(c=(l=a.geometries)===null||l===void 0?void 0:l[0])===null||c===void 0?void 0:c.getAttribute("color");if(g){var y=g.getFields()[0],m=F(u,y);d=ir.getMappingValue(g,m,((f=g.values)===null||f===void 0?void 0:f[0])||p)}var x=o;typeof o=="function"&&(x=o.call(n,u,d)),x instanceof CanvasPattern||(x=C4(N({},{cfg:{backgroundColor:d}},x)));var _=i[r];return C(C({},typeof _=="function"?_.call.apply(_,Yt([n,u],h)):_||{}),{fill:x||d})};return N({},t,{options:(e={},e[r]=s,e)})}}function ho(r){var n=r.chart,t=r.options,e=t.legend,i=t.colorField,a=t.seriesField;return e===!1?n.legend(!1):(i||a)&&n.legend(i||a,e),r}function me(r){var n=r.chart,t=r.options,e=t.tooltip;return e!==void 0&&n.tooltip(e),r}function Qt(r){var n=r.chart,t=r.options,e=t.interactions;return w(e,function(i){i.enable===!1?n.removeInteraction(i.type):n.interaction(i.type,i.cfg||{})}),r}function Ht(r){var n=r.chart,t=r.options,e=t.animation;return typeof e=="boolean"?n.animate(e):n.animate(!0),w(n.geometries,function(i){i.animate(e)}),r}function Ot(r){var n=r.chart,t=r.options,e=t.theme;return e&&n.theme(e),r}function Ci(r){var n=r.chart,t=r.options,e=t.state;return e&&w(n.geometries,function(i){i.state(e)}),r}function js(r){var n=r.chart,t=r.options,e=t.slider;return n.option("slider",e),r}function kp(r){var n=r.chart,t=r.options,e=t.scrollbar;return n.option("scrollbar",e),r}function oe(r,n){return function(t){var e=t.chart,i=t.options,a={};return w(r,function(o,s){a[s]=Nt(o,tr)}),a=N({},n,i.meta,a),e.scale(a),t}}function ne(r){return function(n){var t=n.chart,e=n.options,i=t.getController("annotation");return w(Yt(e.annotations||[],r||[]),function(a){i.annotation(a)}),n}}function ia(r){var n=r.chart,t=r.options,e=t.yAxis,i=t.limitInPlot,a=i;return wt(e)&&G(i)&&(Object.values(Nt(e,["min","max","minLimit","maxLimit"])).some(function(o){return!G(o)})?a=!0:a=!1),n.limitInPlot=a,r}function Kb(r){return r===void 0&&(r="rect"),function(n){var t=n.chart,e=n.options,i=e.coordinate,a=Array.from(i||[]).map(function(o){return o.type==="reflectX"?["reflect","x"]:o.type==="reflectY"?["reflect","y"]:o.type==="transpose"?["transpose"]:null}).filter(function(o){return!!o});return a.length!==0&&t.coordinate({type:r,actions:a}),n}}function Br(r,n){if(r===!1)return{fields:!1};var t=F(r,"fields"),e=F(r,"formatter");return e&&!t&&(t=n),{fields:t,formatter:e}}function Tu(r,n){var t=r.type,e=r.xField,i=r.yField,a=r.colorField,o=r.shapeField,s=r.sizeField,u=r.styleField,l=r.rawFields,c=l===void 0?[]:l,f=[];if(n==="color")f=Yt([a||e],c);else if(n==="shape")f=Yt([o||e],c);else if(n==="size")f=Yt([s||e],c);else{f=Yt([e,i,a,o,s,u],c);var h=["x","y","color","shape","size","style"].indexOf(n),v=f[h];f.splice(h,1),f.unshift(v)}var p=qa(f.filter(function(g){return!!g})),d=t==="line"&&[e,i].includes(p.join("*"))?"":p.join("*");return{mappingFields:p,tileMappingField:d}}function Ra(r,n){if(!!n)return function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i={};return r.forEach(function(a,o){i[a]=t[o]}),delete i.undefined,n(i)}}function or(r){var n=r.chart,t=r.options,e=t.type,i=t.args,a=t.mapping,o=t.xField,s=t.yField,u=t.colorField,l=t.shapeField,c=t.sizeField,f=t.tooltipFields,h=t.label,v=t.state,p=t.customInfo;if(!a)return r;var d=a.color,g=a.shape,y=a.size,m=a.style,x=a.tooltip,_=n[e](i).position(o+"*"+s);if(lt(d))u?_.color(u,d):_.color(d);else if(rt(d)){var E=Tu(t,"color"),b=E.mappingFields,M=E.tileMappingField;_.color(M,Ra(b,d))}else u&&_.color(u,d);if(lt(g))l?_.shape(l,[g]):_.shape(g);else if(rt(g)){var T=Tu(t,"shape"),b=T.mappingFields,M=T.tileMappingField;_.shape(M,Ra(b,g))}else l&&_.shape(l,g);if(dt(y))c?_.size(c,y):_.size(y);else if(rt(y)){var k=Tu(t,"size"),b=k.mappingFields,M=k.tileMappingField;_.size(M,Ra(b,y))}else c&&_.size(c,y);if(rt(m)){var L=Tu(t,"style"),b=L.mappingFields,M=L.tileMappingField;_.style(M,Ra(b,m))}else wt(m)&&_.style(m);if(f===!1?_.tooltip(!1):nr(f)||_.tooltip(f.join("*"),Ra(f,x)),h===!1)_.label(!1);else if(h){var O=h.callback,D=h.fields,W=Tt(h,["callback","fields"]);_.label({fields:D||[s],callback:O,cfg:Se(W)})}return v&&_.state(v),p&&_.customInfo(p),[o,s].filter(function(j){return j!==u}).forEach(function(j){n.legend(j,!1)}),C(C({},r),{ext:{geometry:_}})}function mc(r){var n=r.options,t=n.area,e=n.xField,i=n.yField,a=n.seriesField,o=n.smooth,s=n.tooltip,u=n.useDeferredLabel,l=Br(s,[e,i,a]),c=l.fields,f=l.formatter;return t?or(N({},r,{options:{type:"area",colorField:a,tooltipFields:c,mapping:C({shape:o?"smooth":"area",tooltip:f},t),args:{useDeferredLabel:u}}})):r}function vo(r){var n=r.options,t=n.line,e=n.stepType,i=n.xField,a=n.yField,o=n.seriesField,s=n.smooth,u=n.connectNulls,l=n.tooltip,c=n.useDeferredLabel,f=Br(l,[i,a,o]),h=f.fields,v=f.formatter;return t?or(N({},r,{options:{type:"line",colorField:o,tooltipFields:h,mapping:J({shape:e||(s?"smooth":"line"),tooltip:v},t),args:{connectNulls:u,useDeferredLabel:c}}})):r}function _r(r){var n=r.options,t=n.point,e=n.xField,i=n.yField,a=n.seriesField,o=n.sizeField,s=n.shapeField,u=n.tooltip,l=n.useDeferredLabel,c=Br(u,[e,i,a,o,s]),f=c.fields,h=c.formatter;return t?or(N({},r,{options:{type:"point",colorField:a,shapeField:s,tooltipFields:f,mapping:C({tooltip:h},t),args:{useDeferredLabel:l}}})):r}function E4(r){var n=r.chart,t=r.options,e=r.ext,i=t.seriesField,a=t.isGroup,o=t.isStack,s=t.marginRatio,u=t.widthRatio,l=t.groupField,c=t.theme,f=[];if(i&&(a&&f.push({type:"dodge",dodgeBy:l||i,marginRatio:s}),o&&f.push({type:"stack",marginRatio:s})),f.length&&(e==null?void 0:e.geometry)){var h=e==null?void 0:e.geometry;h.adjust(f)}return G(u)||n.theme(N({},wt(c)?c:ts(c),{columnWidthRatio:u})),r}function De(r){var n=r.options,t=n.xField,e=n.yField,i=n.interval,a=n.seriesField,o=n.tooltip,s=n.minColumnWidth,u=n.maxColumnWidth,l=n.columnBackground,c=n.dodgePadding,f=n.intervalPadding,h=n.useDeferredLabel,v=Br(o,[t,e,a]),p=v.fields,d=v.formatter,g=(i?or(N({},r,{options:{type:"interval",colorField:a,tooltipFields:p,mapping:C({tooltip:d},i),args:{dodgePadding:c,intervalPadding:f,minColumnWidth:s,maxColumnWidth:u,background:l,useDeferredLabel:h}}})):r).ext;return E4(C(C({},r),{ext:g}))}function xc(r){var n=r.options,t=n.polygon,e=n.xField,i=n.yField,a=n.seriesField,o=n.tooltip,s=n.useDeferredLabel,u=Br(o,[e,i,a]),l=u.fields,c=u.formatter;return t?or(N({},r,{options:{type:"polygon",colorField:a,tooltipFields:l,mapping:C({tooltip:c},t),args:{useDeferredLabel:s}}})):r}function Qb(r){var n=r.options,t=n.edge,e=n.xField,i=n.yField,a=n.seriesField,o=n.tooltip,s=n.useDeferredLabel,u=Br(o,[e,i,a]),l=u.fields,c=u.formatter;return t?or(N({},r,{options:{type:"edge",colorField:a,tooltipFields:l,mapping:C({tooltip:c},t),args:{useDeferredLabel:s}}})):r}function Op(r){var n=r.options,t=n.schema,e=n.xField,i=n.yField,a=n.seriesField,o=n.tooltip,s=n.useDeferredLabel,u=Br(o,[e,i,a]),l=u.fields,c=u.formatter;return t?or(N({},r,{options:{type:"schema",colorField:a,tooltipFields:l,mapping:C({tooltip:c},t),args:{useDeferredLabel:s}}})):r}function S4(r){var n=r.options,t=n.violin,e=n.xField,i=n.yField,a=n.seriesField,o=n.sizeField,s=n.tooltip,u=Br(s,[e,i,a,o]),l=u.fields,c=u.formatter;return t?or(N({},r,{options:{type:"violin",colorField:a,tooltipFields:l,mapping:C({tooltip:c},t)}})):r}function b4(r){var n=r.chart,t=r.options,e=t.data,i=t.color,a=t.lineStyle,o=t.lineShape,s=t.point,u=t.area,l=t.seriesField,c=s==null?void 0:s.state,f=u==null?void 0:u.state;n.data(e);var h=N({},r,{options:{shapeField:l,line:{color:i,style:a,shape:o},point:s&&C({color:i,shape:"circle"},s),area:u&&C({color:i},u),label:void 0}}),v=N({},h,{options:{tooltip:!1,state:c}}),p=N({},h,{options:{tooltip:!1,state:f}});return vo(h),_r(v),mc(p),r}function _c(r){var n,t,e=r.options,i=e.xAxis,a=e.yAxis,o=e.xField,s=e.yField,u=e.data;return ht(oe((n={},n[o]=i,n[s]=a,n),(t={},t[o]={type:"cat"},t[s]=Tp(u,s),t)))(r)}function A4(r){var n=r.chart,t=r.options,e=t.reflect;if(e){var i=e;V(i)||(i=[i]);var a=i.map(function(o){return["reflect",o]});n.coordinate({type:"rect",actions:a})}return r}function Jb(r){var n=r.chart,t=r.options,e=t.xAxis,i=t.yAxis,a=t.xField,o=t.yField;return e===!1?n.axis(a,!1):n.axis(a,e),i===!1?n.axis(o,!1):n.axis(o,i),r}function tA(r){var n=r.chart,t=r.options,e=t.legend,i=t.seriesField;return e&&i?n.legend(i,e):e===!1&&n.legend(!1),r}function T4(r){var n=r.chart,t=r.options,e=t.label,i=t.yField,a=Ie(n,"line");if(!e)a.label(!1);else{var o=e.callback,s=Tt(e,["callback"]);a.label({fields:[i],callback:o,cfg:C({layout:[{type:"limit-in-plot"},{type:"path-adjust-position"},{type:"point-adjust-position"},{type:"limit-in-plot",cfg:{action:"hide"}}]},Se(s))})}return r}function M4(r){var n=r.chart,t=r.options,e=t.isStack;return e&&w(n.geometries,function(i){i.adjust("stack")}),r}function eA(r){return ht(b4,_c,M4,Ot,A4,Jb,tA,me,T4,js,kp,Qt,Ht,ne(),ia)(r)}var w4=N({},yt.getDefaultOptions(),{tooltip:{shared:!0,showMarkers:!0,showCrosshairs:!0,crosshairs:{type:"x"}},legend:{position:"top-left",radio:{}},isStack:!1}),L4=function(r){R(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.active=function(){var t=this.getView(),e=this.context.event;if(e.data){var i=e.data.items,a=t.geometries.filter(function(o){return o.type==="point"});w(a,function(o){w(o.elements,function(s){var u=eE(i,function(l){return l.data===s.data})!==-1;s.setState("active",u)})})}},n.prototype.reset=function(){var t=this.getView(),e=t.geometries.filter(function(i){return i.type==="point"});w(e,function(i){w(i.elements,function(a){a.setState("active",!1)})})},n.prototype.getView=function(){return this.context.view},n}(ee);ct("marker-active",L4);gt("marker-active",{start:[{trigger:"tooltip:show",action:"marker-active:active"}],end:[{trigger:"tooltip:hide",action:"marker-active:reset"}]});var F4=function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.type="line",t}return n.getDefaultOptions=function(){return w4},n.prototype.changeData=function(t){this.updateOption({data:t});var e=this,i=e.chart,a=e.options;_c({chart:i,options:a}),this.chart.changeData(t)},n.prototype.getDefaultOptions=function(){return n.getDefaultOptions()},n.prototype.getSchemaAdaptor=function(){return eA},n}(yt);function rA(r,n,t,e){var i=ze(r,function(a,o){var s=o[t],u=a.has(s)?a.get(s):0,l=o[n];return u=na(l)?u+l:u,a.set(s,u),a},new Map);return ie(r,function(a){var o,s=a[n],u=a[t],l=na(s)&&i.get(u)!==0?s/i.get(u):0;return C(C({},a),(o={},o[e]=l,o))})}function k4(r,n,t,e){var i=ze(r,function(a,o){var s=ze(t,function(c,f){return""+c+o[f]},""),u=a.has(s)?a.get(s):0,l=o[n];return u=na(l)?u+l:u,a.set(s,u),a},new Map);return ie(r,function(a){var o,s=a[n],u=ze(t,function(c,f){return""+c+a[f]},""),l=na(s)&&i.get(u)!==0?s/i.get(u):0;return C(C({},a),(o={},o[e]=l,o))})}function Xs(r,n,t,e,i){return i?rA(r,n,t,e):r}function O4(r){var n=r.chart,t=r.options,e=t.data,i=t.areaStyle,a=t.color,o=t.point,s=t.line,u=t.isPercent,l=t.xField,c=t.yField,f=t.tooltip,h=t.seriesField,v=t.startOnZero,p=o==null?void 0:o.state,d=Xs(e,c,l,c,u);n.data(d);var g=u?C({formatter:function(_){return{name:_[h]||_[l],value:(Number(_[c])*100).toFixed(2)+"%"}}},f):f,y=N({},r,{options:{area:{color:a,style:i},point:o&&C({color:a},o),tooltip:g,label:void 0,args:{startOnZero:v}}}),m={chart:n,options:N({line:{size:2}},Bl(t,["state"]),{line:s&&C({color:a},s),sizeField:h,state:s==null?void 0:s.state,tooltip:!1,label:void 0,args:{startOnZero:v}})},x=N({},y,{options:{tooltip:!1,state:p}});return mc(y),vo(m),_r(x),r}function R4(r){var n=r.chart,t=r.options,e=t.label,i=t.yField,a=Ie(n,"area");if(!e)a.label(!1);else{var o=e.callback,s=Tt(e,["callback"]);a.label({fields:[i],callback:o,cfg:C({layout:[{type:"limit-in-plot"},{type:"path-adjust-position"},{type:"point-adjust-position"},{type:"limit-in-plot",cfg:{action:"hide"}}]},Se(s))})}return r}function I4(r){var n=r.chart,t=r.options,e=t.isStack,i=t.isPercent,a=t.seriesField;return(i||e)&&a&&w(n.geometries,function(o){o.adjust("stack")}),r}function nA(r){return ht(Ot,xr("areaStyle"),Kb("rect"),O4,_c,I4,Jb,tA,me,R4,js,ne(),Qt,Ht,ia)(r)}var D4=N({},yt.getDefaultOptions(),{tooltip:{shared:!0,showMarkers:!0,showCrosshairs:!0,crosshairs:{type:"x"}},isStack:!0,line:{},legend:{position:"top-left",radio:{}}}),P4=function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.type="area",t}return n.getDefaultOptions=function(){return D4},n.prototype.getDefaultOptions=function(){return n.getDefaultOptions()},n.prototype.changeData=function(t){this.updateOption({data:t});var e=this.options,i=e.isPercent,a=e.xField,o=e.yField,s=this,u=s.chart,l=s.options;_c({chart:u,options:l}),this.chart.changeData(Xs(t,o,a,o,i))},n.prototype.getSchemaAdaptor=function(){return nA},n}(yt);function iA(r,n){return!dt(r)||!dt(n)?"-":r===n?"100%":r===0?"\u221E":n===0?"-\u221E":(100*n/r).toFixed(2)+"%"}function B4(r,n){return N({size:n?32:80,spacing:n?8:12,offset:n?32:0,arrow:r.arrow!==!1&&{headSize:12,style:{fill:"rgba(0, 0, 0, 0.05)"}},text:r.text!==!1&&{style:{fontSize:12,fill:"rgba(0, 0, 0, 0.85)",textAlign:"center",textBaseline:"middle"},formatter:iA}},r)}function gl(r,n){return ie(n.getModel().points,function(t){return r.convertPoint(t)})}function N4(r,n,t){var e=r.view,i=r.geometry,a=r.group,o=r.options,s=r.horizontal,u=o.offset,l=o.size,c=o.arrow,f=e.getCoordinate(),h=gl(f,n)[3],v=gl(f,t)[0],p=v.y-h.y,d=v.x-h.x;if(typeof c!="boolean"){var g=c.headSize,y=o.spacing,m;s?(d-g)/2<y?(y=Math.max(1,(d-g)/2),m=[[h.x+y,h.y-u],[h.x+y,h.y-u-l],[v.x-y,v.y-u-l/2]]):m=[[h.x+y,h.y-u],[h.x+y,h.y-u-l],[v.x-y-g,v.y-u-l],[v.x-y,v.y-u-l/2],[v.x-y-g,v.y-u]]:(p-g)/2<y?(y=Math.max(1,(p-g)/2),m=[[h.x+u,h.y+y],[h.x+u+l,h.y+y],[v.x+u+l/2,v.y-y]]):m=[[h.x+u,h.y+y],[h.x+u+l,h.y+y],[v.x+u+l,v.y-y-g],[v.x+u+l/2,v.y-y],[v.x+u,v.y-y-g]],a.addShape("polygon",{id:e.id+"-conversion-tag-arrow-"+i.getElementId(n.getModel().mappingData),name:"conversion-tag-arrow",origin:{element:n,nextElement:t},attrs:C(C({},c.style||{}),{points:m})})}}function z4(r,n,t){var e,i,a,o=r.view,s=r.geometry,u=r.group,l=r.options,c=r.field,f=r.horizontal,h=l.offset,v=l.size;if(typeof l.text!="boolean"){var p=o.getCoordinate(),d=((e=l.text)===null||e===void 0?void 0:e.formatter)&&((i=l.text)===null||i===void 0?void 0:i.formatter(n.getData()[c],t.getData()[c])),g=gl(p,n)[f?3:0],y=gl(p,t)[f?0:3],m=u.addShape("text",{id:o.id+"-conversion-tag-text-"+s.getElementId(n.getModel().mappingData),name:"conversion-tag-text",origin:{element:n,nextElement:t},attrs:C(C({},((a=l.text)===null||a===void 0?void 0:a.style)||{}),{text:d,x:f?(g.x+y.x)/2:g.x+h+v/2,y:f?g.y-h-v/2:(g.y+y.y)/2})});if(f){var x=y.x-g.x,_=m.getBBox().width;if(_>x){var E=_/d.length,b=Math.max(1,Math.ceil(x/E)-1),M=d.slice(0,b)+"...";m.attr("text",M)}}}}function U4(r,n,t){N4(r,n,t),z4(r,n,t)}function H4(r,n,t){return n===void 0&&(n=!0),t===void 0&&(t=!1),function(e){var i=e.options,a=e.chart,o=i.conversionTag,s=i.theme;return o&&!t&&(a.theme(N({},wt(s)?s:ts(s),{columnWidthRatio:1/3})),a.annotation().shape({render:function(u,l){var c=u.addGroup({id:a.id+"-conversion-tag-group",name:"conversion-tag-group"}),f=jr(a.geometries,function(p){return p.type==="interval"}),h={view:l,geometry:f,group:c,field:r,horizontal:n,options:B4(o,n)},v=f.elements;w(v,function(p,d){d>0&&U4(h,v[d-1],p)})}})),e}}var Qi={hover:"__interval-connected-area-hover__",click:"__interval-connected-area-click__"},Rp=function(r,n){return r==="hover"?[{trigger:"interval:mouseenter",action:["element-highlight-by-color:highlight","element-link-by-color:link"],arg:[null,{style:n}]}]:[{trigger:"interval:click",action:["element-highlight-by-color:clear","element-highlight-by-color:highlight","element-link-by-color:clear","element-link-by-color:unlink","element-link-by-color:link"],arg:[null,null,null,null,{style:n}]}]};gt(Qi.hover,{start:Rp(Qi.hover),end:[{trigger:"interval:mouseleave",action:["element-highlight-by-color:reset","element-link-by-color:unlink"]}]});gt(Qi.click,{start:Rp(Qi.click),end:[{trigger:"document:mousedown",action:["element-highlight-by-color:clear","element-link-by-color:clear"]}]});function $4(r){return r===void 0&&(r=!1),function(n){var t=n.chart,e=n.options,i=e.connectedArea,a=function(){t.removeInteraction(Qi.hover),t.removeInteraction(Qi.click)};if(!r&&i){var o=i.trigger||"hover";a(),t.interaction(Qi[o],{start:Rp(o,i.style)})}else a();return n}}var G4=10,V4=5,W4={padding:[8,10],text:"reset",textStyle:{default:{x:0,y:0,fontSize:12,fill:"#333333",cursor:"pointer"}},buttonStyle:{default:{fill:"#f7f7f7",stroke:"#cccccc",cursor:"pointer"},active:{fill:"#e6e6e6"}}},j4=function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.buttonGroup=null,t.buttonCfg=C({name:"button"},W4),t}return n.prototype.getButtonCfg=function(){var t=this.context.view,e=F(t,["interactions","filter-action","cfg","buttonConfig"]);return N(this.buttonCfg,e,this.cfg)},n.prototype.drawButton=function(){var t=this.getButtonCfg(),e=this.context.view.foregroundGroup.addGroup({name:t.name}),i=this.drawText(e);this.drawBackground(e,i.getBBox()),this.buttonGroup=e},n.prototype.drawText=function(t){var e,i=this.getButtonCfg();return t.addShape({type:"text",name:"button-text",attrs:C({text:i.text},(e=i.textStyle)===null||e===void 0?void 0:e.default)})},n.prototype.drawBackground=function(t,e){var i,a=this.getButtonCfg(),o=hi(a.padding),s=t.addShape({type:"rect",name:"button-rect",attrs:C({x:e.x-o[3],y:e.y-o[0],width:e.width+o[1]+o[3],height:e.height+o[0]+o[2]},(i=a.buttonStyle)===null||i===void 0?void 0:i.default)});return s.toBack(),t.on("mouseenter",function(){var u;s.attr((u=a.buttonStyle)===null||u===void 0?void 0:u.active)}),t.on("mouseleave",function(){var u;s.attr((u=a.buttonStyle)===null||u===void 0?void 0:u.default)}),s},n.prototype.resetPosition=function(){var t=this.context.view,e=t.getCoordinate(),i=e.convert({x:1,y:1}),a=this.buttonGroup,o=a.getBBox(),s=ir.transform(null,[["t",i.x-o.width-G4,i.y+o.height+V4]]);a.setMatrix(s)},n.prototype.show=function(){this.buttonGroup||this.drawButton(),this.resetPosition(),this.buttonGroup.show()},n.prototype.hide=function(){this.buttonGroup&&this.buttonGroup.hide()},n.prototype.destroy=function(){var t=this.buttonGroup;t&&t.remove(),r.prototype.destroy.call(this)},n}(ee);ct("brush-reset-button",j4,{name:"brush-reset-button"});gt("filter-action",{});function xn(r){return r.isInPlot()}function pa(r,n,t){var e=t||{},i=e.mask,a=e.isStartEnable,o=n||"rect";switch(r){case"brush":return{showEnable:[{trigger:"plot:mouseenter",action:"cursor:crosshair",isEnable:a||function(){return!0}},{trigger:"plot:mouseleave",action:"cursor:default"}],start:[{trigger:"mousedown",isEnable:a||xn,action:["brush:start",o+"-mask:start",o+"-mask:show"],arg:[null,{maskStyle:i==null?void 0:i.style}]}],processing:[{trigger:"mousemove",isEnable:xn,action:[o+"-mask:resize"]}],end:[{trigger:"mouseup",isEnable:xn,action:["brush:filter","brush:end",o+"-mask:end",o+"-mask:hide","brush-reset-button:show"]}],rollback:[{trigger:"brush-reset-button:click",action:["brush:reset","brush-reset-button:hide","cursor:crosshair"]}]};case"brush-highlight":return{showEnable:[{trigger:"plot:mouseenter",action:"cursor:crosshair",isEnable:a||function(){return!0}},{trigger:"plot:mousemove",action:"cursor:crosshair",isEnable:a||function(){return!0}},{trigger:"plot:mousemove",action:"cursor:default",isEnable:function(s){return a?!a(s):!1}},{trigger:"mask:mouseenter",action:"cursor:move",isEnable:a||function(){return!0}},{trigger:"plot:mouseleave",action:"cursor:default"},{trigger:"mask:mouseleave",action:"cursor:crosshair"}],start:[{trigger:"plot:mousedown",isEnable:a||function(s){return!s.isInShape("mask")},action:[o+"-mask:start",o+"-mask:show"],arg:[{maskStyle:i==null?void 0:i.style}]},{trigger:"mask:dragstart",action:[o+"-mask:moveStart"]}],processing:[{trigger:"plot:mousemove",action:[o+"-mask:resize"]},{trigger:"mask:drag",action:[o+"-mask:move"]},{trigger:"mask:change",action:["element-range-highlight:highlight"]}],end:[{trigger:"plot:mouseup",action:[o+"-mask:end"]},{trigger:"mask:dragend",action:[o+"-mask:moveEnd"]},{trigger:"document:mouseup",isEnable:function(s){return!s.isInPlot()},action:["element-range-highlight:clear",o+"-mask:end",o+"-mask:hide"]}],rollback:[{trigger:"dblclick",action:["element-range-highlight:clear",o+"-mask:hide"]}]};case"brush-x":return{showEnable:[{trigger:"plot:mouseenter",action:"cursor:crosshair",isEnable:a||function(){return!0}},{trigger:"plot:mouseleave",action:"cursor:default"}],start:[{trigger:"mousedown",isEnable:a||xn,action:["brush-x:start",o+"-mask:start",o+"-mask:show"],arg:[null,{maskStyle:i==null?void 0:i.style}]}],processing:[{trigger:"mousemove",isEnable:xn,action:[o+"-mask:resize"]}],end:[{trigger:"mouseup",isEnable:xn,action:["brush-x:filter","brush-x:end",o+"-mask:end",o+"-mask:hide"]}],rollback:[{trigger:"dblclick",action:["brush-x:reset"]}]};case"brush-x-highlight":return{showEnable:[{trigger:"plot:mouseenter",action:"cursor:crosshair",isEnable:a||function(){return!0}},{trigger:"mask:mouseenter",action:"cursor:move",isEnable:a||function(){return!0}},{trigger:"plot:mouseleave",action:"cursor:default"},{trigger:"mask:mouseleave",action:"cursor:crosshair"}],start:[{trigger:"plot:mousedown",isEnable:a||function(s){return!s.isInShape("mask")},action:[o+"-mask:start",o+"-mask:show"],arg:[{maskStyle:i==null?void 0:i.style}]},{trigger:"mask:dragstart",action:[o+"-mask:moveStart"]}],processing:[{trigger:"plot:mousemove",action:[o+"-mask:resize"]},{trigger:"mask:drag",action:[o+"-mask:move"]},{trigger:"mask:change",action:["element-range-highlight:highlight"]}],end:[{trigger:"plot:mouseup",action:[o+"-mask:end"]},{trigger:"mask:dragend",action:[o+"-mask:moveEnd"]},{trigger:"document:mouseup",isEnable:function(s){return!s.isInPlot()},action:["element-range-highlight:clear",o+"-mask:end",o+"-mask:hide"]}],rollback:[{trigger:"dblclick",action:["element-range-highlight:clear",o+"-mask:hide"]}]};case"brush-y":return{showEnable:[{trigger:"plot:mouseenter",action:"cursor:crosshair",isEnable:a||function(){return!0}},{trigger:"plot:mouseleave",action:"cursor:default"}],start:[{trigger:"mousedown",isEnable:a||xn,action:["brush-y:start",o+"-mask:start",o+"-mask:show"],arg:[null,{maskStyle:i==null?void 0:i.style}]}],processing:[{trigger:"mousemove",isEnable:xn,action:[o+"-mask:resize"]}],end:[{trigger:"mouseup",isEnable:xn,action:["brush-y:filter","brush-y:end",o+"-mask:end",o+"-mask:hide"]}],rollback:[{trigger:"dblclick",action:["brush-y:reset"]}]};case"brush-y-highlight":return{showEnable:[{trigger:"plot:mouseenter",action:"cursor:crosshair",isEnable:a||function(){return!0}},{trigger:"mask:mouseenter",action:"cursor:move",isEnable:a||function(){return!0}},{trigger:"plot:mouseleave",action:"cursor:default"},{trigger:"mask:mouseleave",action:"cursor:crosshair"}],start:[{trigger:"plot:mousedown",isEnable:a||function(s){return!s.isInShape("mask")},action:[o+"-mask:start",o+"-mask:show"],arg:[{maskStyle:i==null?void 0:i.style}]},{trigger:"mask:dragstart",action:[o+"-mask:moveStart"]}],processing:[{trigger:"plot:mousemove",action:[o+"-mask:resize"]},{trigger:"mask:drag",action:[o+"-mask:move"]},{trigger:"mask:change",action:["element-range-highlight:highlight"]}],end:[{trigger:"plot:mouseup",action:[o+"-mask:end"]},{trigger:"mask:dragend",action:[o+"-mask:moveEnd"]},{trigger:"document:mouseup",isEnable:function(s){return!s.isInPlot()},action:["element-range-highlight:clear",o+"-mask:end",o+"-mask:hide"]}],rollback:[{trigger:"dblclick",action:["element-range-highlight:clear",o+"-mask:hide"]}]};default:return{}}}gt("brush",pa("brush"));gt("brush-highlight",pa("brush-highlight"));gt("brush-x",pa("brush-x","x-rect"));gt("brush-y",pa("brush-y","y-rect"));gt("brush-x-highlight",pa("brush-x-highlight","x-rect"));gt("brush-y-highlight",pa("brush-y-highlight","y-rect"));var G0=["brush","brush-x","brush-y","brush-highlight","brush-x-highlight","brush-y-highlight"];function aA(r){var n=r.options,t=n.brush,e=Pe(n.interactions||[],function(i){return G0.indexOf(i.type)===-1});return t!=null&&t.enabled&&(G0.forEach(function(i){var a=!1;switch(t.type){case"x-rect":a=i===(t.action==="highlight"?"brush-x-highlight":"brush-x");break;case"y-rect":a=i===(t.action==="highlight"?"brush-y-highlight":"brush-y");break;default:a=i===(t.action==="highlight"?"brush-highlight":"brush");break}var o={type:i,enable:a};t&&(o.cfg=pa(i,t.type,t)),e.push(o)}),(t==null?void 0:t.action)!=="highlight"&&e.push({type:"filter-action",cfg:{buttonConfig:t.button}})),N({},r,{options:{interactions:e}})}function X4(r){var n=r.options,t=n.legend,e=n.seriesField,i=n.isStack;return e?t!==!1&&(t=C({position:i?"right-top":"top-left"},t)):t=!1,r.options.legend=t,r}function Y4(r){var n=r.chart,t=r.options,e=t.data,i=t.columnStyle,a=t.color,o=t.columnWidthRatio,s=t.isPercent,u=t.isGroup,l=t.isStack,c=t.xField,f=t.yField,h=t.seriesField,v=t.groupField,p=t.tooltip,d=t.shape,g=s&&u&&l?k4(e,f,[c,v],f):Xs(e,f,c,f,s),y=[];l&&h&&!u?g.forEach(function(_){var E=y.find(function(b){return b[c]===_[c]&&b[h]===_[h]});E?E[f]+=_[f]||0:y.push(C({},_))}):y=g,n.data(y);var m=s?C({formatter:function(_){return{name:u&&l?_[h]+" - "+_[v]:_[h]||_[c],value:(Number(_[f])*100).toFixed(2)+"%"}}},p):p,x=N({},r,{options:{data:y,widthRatio:o,tooltip:m,interval:{shape:d,style:i,color:a}}});return De(x),x}function Ip(r){var n,t,e=r.options,i=e.xAxis,a=e.yAxis,o=e.xField,s=e.yField,u=e.data,l=e.isPercent,c=l?{max:1,min:0,minLimit:0,maxLimit:1}:{};return ht(oe((n={},n[o]=i,n[s]=a,n),(t={},t[o]={type:"cat"},t[s]=C(C({},Tp(u,s)),c),t)))(r)}function Z4(r){var n=r.chart,t=r.options,e=t.xAxis,i=t.yAxis,a=t.xField,o=t.yField;return e===!1?n.axis(a,!1):n.axis(a,e),i===!1?n.axis(o,!1):n.axis(o,i),r}function q4(r){var n=r.chart,t=r.options,e=t.legend,i=t.seriesField;return e&&i?n.legend(i,e):e===!1&&n.legend(!1),r}function K4(r){var n=r.chart,t=r.options,e=t.label,i=t.yField,a=t.isRange,o=Ie(n,"interval");if(!e)o.label(!1);else{var s=e.callback,u=Tt(e,["callback"]);o.label({fields:[i],callback:s,cfg:C({layout:u!=null&&u.position?void 0:[{type:"interval-adjust-position"},{type:"interval-hide-overlap"},{type:"adjust-color"},{type:"limit-in-plot",cfg:{action:"hide"}}]},Se(a?C({content:function(l){var c;return(c=l[i])===null||c===void 0?void 0:c.join("-")}},u):u))})}return r}function Q4(r){var n=r.chart,t=r.options,e=t.tooltip,i=t.isGroup,a=t.isStack,o=t.groupField,s=t.data,u=t.xField,l=t.yField,c=t.seriesField;if(e===!1)n.tooltip(!1);else{var f=e;if(i&&a){var h=(f==null?void 0:f.formatter)||function(v){return{name:v[c]+" - "+v[o],value:v[l]}};f=C(C({},f),{customItems:function(v){var p=[];return w(v,function(d){var g=Pe(s,function(y){return tE(y,Nt(d.data,[u,c]))});g.forEach(function(y){p.push(C(C(C({},d),{value:y[l],data:y,mappingData:{_origin:y}}),h(y)))})}),p}})}n.tooltip(f)}return r}function Cc(r,n){n===void 0&&(n=!1);var t=r.options,e=t.seriesField;return ht(X4,Ot,xr("columnStyle"),Ci,Kb("rect"),Y4,Ip,Z4,q4,Q4,js,kp,K4,aA,Qt,Ht,ne(),H4(t.yField,!n,!!e),$4(!t.isStack),ia)(r)}var J4=N({},yt.getDefaultOptions(),{columnWidthRatio:.6,marginRatio:1/32,tooltip:{shared:!0,showMarkers:!1,offset:20},legend:{radio:{}},interactions:[{type:"active-region"}]}),t3=function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.type="column",t}return n.getDefaultOptions=function(){return J4},n.prototype.changeData=function(t){this.updateOption({data:t});var e=this.options,i=e.yField,a=e.xField,o=e.isPercent,s=this,u=s.chart,l=s.options;Ip({chart:u,options:l}),this.chart.changeData(Xs(t,i,a,i,o))},n.prototype.getDefaultOptions=function(){return n.getDefaultOptions()},n.prototype.getSchemaAdaptor=function(){return Cc},n}(yt);function e3(r){var n=r.options,t=n.xField,e=n.yField,i=n.xAxis,a=n.yAxis,o={left:"bottom",right:"top",top:"left",bottom:"right"},s=a!==!1?C({position:o[(a==null?void 0:a.position)||"left"]},a):!1,u=i!==!1?C({position:o[(i==null?void 0:i.position)||"bottom"]},i):!1;return C(C({},r),{options:C(C({},n),{xField:e,yField:t,xAxis:s,yAxis:u})})}function r3(r){var n=r.options,t=n.label;return t&&!t.position&&(t.position="left",t.layout||(t.layout=[{type:"interval-adjust-position"},{type:"interval-hide-overlap"},{type:"adjust-color"},{type:"limit-in-plot",cfg:{action:"hide"}}])),N({},r,{options:{label:t}})}function n3(r){var n=r.options,t=n.seriesField,e=n.isStack,i=n.legend;return t?i!==!1&&(i=C({position:e?"top-left":"right-top"},i||{})):i=!1,N({},r,{options:{legend:i}})}function i3(r){var n=r.options,t=[{type:"transpose"},{type:"reflectY"}].concat(n.coordinate||[]);return N({},r,{options:{coordinate:t}})}function a3(r){var n=r.chart,t=r.options,e=t.barStyle,i=t.barWidthRatio,a=t.minBarWidth,o=t.maxBarWidth,s=t.barBackground;return Cc({chart:n,options:C(C({},t),{columnStyle:e,columnWidthRatio:i,minColumnWidth:a,maxColumnWidth:o,columnBackground:s})},!0)}function oA(r){return ht(e3,r3,n3,me,i3,a3)(r)}var o3=N({},yt.getDefaultOptions(),{barWidthRatio:.6,marginRatio:1/32,tooltip:{shared:!0,showMarkers:!1,offset:20},legend:{radio:{}},interactions:[{type:"active-region"}]}),s3=function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.type="bar",t}return n.getDefaultOptions=function(){return o3},n.prototype.changeData=function(t){var e,i;this.updateOption({data:t});var a=this,o=a.chart,s=a.options,u=s.isPercent,l=s.xField,c=s.yField,f=s.xAxis,h=s.yAxis;e=[c,l],l=e[0],c=e[1],i=[h,f],f=i[0],h=i[1];var v=C(C({},s),{xField:l,yField:c,yAxis:h,xAxis:f});Ip({chart:o,options:v}),o.changeData(Xs(t,l,c,l,u))},n.prototype.getDefaultOptions=function(){return n.getDefaultOptions()},n.prototype.getSchemaAdaptor=function(){return oA},n}(yt),sA=N({},yt.getDefaultOptions(),{legend:{position:"right",radio:{}},tooltip:{shared:!1,showTitle:!1,showMarkers:!1},label:{layout:{type:"limit-in-plot",cfg:{action:"ellipsis"}}},pieStyle:{stroke:"white",lineWidth:1},statistic:{title:{style:{fontWeight:300,color:"#4B535E",textAlign:"center",fontSize:"20px",lineHeight:1}},content:{style:{fontWeight:"bold",color:"rgba(44,53,66,0.85)",textAlign:"center",fontSize:"32px",lineHeight:1}}},theme:{components:{annotation:{text:{animate:!1}}}}});function u3(r,n){var t=null;return w(r,function(e){typeof e[n]=="number"&&(t+=e[n])}),t}function l3(r,n){var t;switch(r){case"inner":return t="-30%",lt(n)&&n.endsWith("%")?parseFloat(n)*.01>0?t:n:n<0?n:t;case"outer":return t=12,lt(n)&&n.endsWith("%")?parseFloat(n)*.01<0?t:n:n>0?n:t;default:return n}}function yl(r,n){return bv(eo(r,n),function(t){return t[n]===0})}var c3=[1,0,0,0,1,0,0,0,1];function Fh(r,n){var t=n?Yt(n):Yt(c3);return ir.transform(t,r)}var f3=function(r){R(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.getActiveElements=function(){var t=ir.getDelegationObject(this.context);if(t){var e=this.context.view,i=t.component,a=t.item,o=i.get("field");if(o){var s=e.geometries[0].elements;return s.filter(function(u){return u.getModel().data[o]===a.value})}}return[]},n.prototype.getActiveElementLabels=function(){var t=this.context.view,e=this.getActiveElements(),i=t.geometries[0].labelsContainer.getChildren();return i.filter(function(a){return e.find(function(o){return Dt(o.getData(),a.get("data"))})})},n.prototype.transfrom=function(t){t===void 0&&(t=7.5);var e=this.getActiveElements(),i=this.getActiveElementLabels();e.forEach(function(a,o){var s=i[o],u=a.geometry.coordinate;if(u.isPolar&&u.isTransposed){var l=ir.getAngle(a.getModel(),u),c=l.startAngle,f=l.endAngle,h=(c+f)/2,v=t,p=v*Math.cos(h),d=v*Math.sin(h);a.shape.setMatrix(Fh([["t",p,d]])),s.setMatrix(Fh([["t",p,d]]))}})},n.prototype.active=function(){this.transfrom()},n.prototype.reset=function(){this.transfrom(0)},n}(ee);function h3(r){var n=r.event,t,e=n.target;return e&&(t=e.get("element")),t}var v3=function(r){R(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.getAnnotations=function(t){var e=t||this.context.view;return e.getController("annotation").option},n.prototype.getInitialAnnotation=function(){return this.initialAnnotation},n.prototype.init=function(){var t=this,e=this.context.view;e.removeInteraction("tooltip"),e.on("afterchangesize",function(){var i=t.getAnnotations(e);t.initialAnnotation=i})},n.prototype.change=function(t){var e=this.context,i=e.view,a=e.event;this.initialAnnotation||(this.initialAnnotation=this.getAnnotations());var o=F(a,["data","data"]);if(a.type.match("legend-item")){var s=ir.getDelegationObject(this.context),u=i.getGroupedFields()[0];if(s&&u){var l=s.item;o=i.getData().find(function(v){return v[u]===l.value})}}if(o){var c=F(t,"annotations",[]),f=F(t,"statistic",{});i.getController("annotation").clear(!0),w(c,function(v){typeof v=="object"&&i.annotation()[v.type](v)}),pc(i,{statistic:f,plotType:"pie"},o),i.render(!0)}var h=h3(this.context);h&&h.shape.toFront()},n.prototype.reset=function(){var t=this.context.view,e=t.getController("annotation");e.clear(!0);var i=this.getInitialAnnotation();w(i,function(a){t.annotation()[a.type](a)}),t.render(!0)},n}(ee),uA="pie-statistic";ct(uA,v3);gt("pie-statistic-active",{start:[{trigger:"element:mouseenter",action:"pie-statistic:change"}],end:[{trigger:"element:mouseleave",action:"pie-statistic:reset"}]});ct("pie-legend",f3);gt("pie-legend-active",{start:[{trigger:"legend-item:mouseenter",action:"pie-legend:active"}],end:[{trigger:"legend-item:mouseleave",action:"pie-legend:reset"}]});function p3(r){var n=r.chart,t=r.options,e=t.data,i=t.angleField,a=t.colorField,o=t.color,s=t.pieStyle,u=eo(e,i);if(yl(u,i)){var l="$$percentage$$";u=u.map(function(f){var h;return C(C({},f),(h={},h[l]=1/u.length,h))}),n.data(u);var c=N({},r,{options:{xField:"1",yField:l,seriesField:a,isStack:!0,interval:{color:o,style:s},args:{zIndexReversed:!0,sortZIndex:!0}}});De(c)}else{n.data(u);var c=N({},r,{options:{xField:"1",yField:i,seriesField:a,isStack:!0,interval:{color:o,style:s},args:{zIndexReversed:!0,sortZIndex:!0}}});De(c)}return r}function d3(r){var n,t=r.chart,e=r.options,i=e.meta,a=e.colorField,o=N({},i);return t.scale(o,(n={},n[a]={type:"cat"},n)),r}function g3(r){var n=r.chart,t=r.options,e=t.radius,i=t.innerRadius,a=t.startAngle,o=t.endAngle;return n.coordinate({type:"theta",cfg:{radius:e,innerRadius:i,startAngle:a,endAngle:o}}),r}function y3(r){var n=r.chart,t=r.options,e=t.label,i=t.colorField,a=t.angleField,o=n.geometries[0];if(!e)o.label(!1);else{var s=e.callback,u=Tt(e,["callback"]),l=Se(u);if(l.content){var c=l.content;l.content=function(p,d,g){var y=p[i],m=p[a],x=n.getScaleByField(a),_=x==null?void 0:x.scale(m);return rt(c)?c(C(C({},p),{percent:_}),d,g):lt(c)?Hb(c,{value:m,name:y,percentage:dt(_)&&!G(m)?(_*100).toFixed(2)+"%":null}):c}}var f={inner:"",outer:"pie-outer",spider:"pie-spider"},h=l.type?f[l.type]:"pie-outer",v=l.layout?V(l.layout)?l.layout:[l.layout]:[];l.layout=(h?[{type:h}]:[]).concat(v),o.label({fields:i?[a,i]:[a],callback:s,cfg:C(C({},l),{offset:l3(l.type,l.offset),type:"pie"})})}return r}function lA(r){var n=r.innerRadius,t=r.statistic,e=r.angleField,i=r.colorField,a=r.meta,o=r.locale,s=gc(o);if(n&&t){var u=N({},sA.statistic,t),l=u.title,c=u.content;return l!==!1&&(l=N({},{formatter:function(f){var h=f?f[i]:G(l.content)?s.get(["statistic","total"]):l.content,v=F(a,[i,"formatter"])||function(p){return p};return v(h)}},l)),c!==!1&&(c=N({},{formatter:function(f,h){var v=f?f[e]:u3(h,e),p=F(a,[e,"formatter"])||function(d){return d};return f||G(c.content)?p(v):c.content}},c)),N({},{statistic:{title:l,content:c}},r)}return r}function cA(r){var n=r.chart,t=r.options,e=lA(t),i=e.innerRadius,a=e.statistic;return n.getController("annotation").clear(!0),ht(ne())(r),i&&a&&pc(n,{statistic:a,plotType:"pie"}),r}function m3(r){var n=r.chart,t=r.options,e=t.tooltip,i=t.colorField,a=t.angleField,o=t.data;if(e===!1)n.tooltip(e);else if(n.tooltip(N({},e,{shared:!1})),yl(o,a)){var s=F(e,"fields"),u=F(e,"formatter");nr(F(e,"fields"))&&(s=[i,a],u=u||function(l){return{name:l[i],value:Ds(l[a])}}),n.geometries[0].tooltip(s.join("*"),Ra(s,u))}return r}function x3(r){var n=r.chart,t=r.options,e=lA(t),i=e.interactions,a=e.statistic,o=e.annotations;return w(i,function(s){var u,l;if(s.enable===!1)n.removeInteraction(s.type);else if(s.type==="pie-statistic-active"){var c=[];!((u=s.cfg)===null||u===void 0)&&u.start||(c=[{trigger:"element:mouseenter",action:uA+":change",arg:{statistic:a,annotations:o}}]),w((l=s.cfg)===null||l===void 0?void 0:l.start,function(f){c.push(C(C({},f),{arg:{statistic:a,annotations:o}}))}),n.interaction(s.type,N({},s.cfg,{start:c}))}else n.interaction(s.type,s.cfg||{})}),r}function fA(r){return ht(xr("pieStyle"),p3,d3,Ot,g3,ho,m3,y3,Ci,cA,x3,Ht)(r)}var _3=function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.type="pie",t}return n.getDefaultOptions=function(){return sA},n.prototype.changeData=function(t){this.chart.emit(_t.BEFORE_CHANGE_DATA,re.fromData(this.chart,_t.BEFORE_CHANGE_DATA,null));var e=this.options,i=this.options.angleField,a=eo(e.data,i),o=eo(t,i);yl(a,i)||yl(o,i)?this.update({data:t}):(this.updateOption({data:t}),this.chart.data(o),cA({chart:this.chart,options:this.options}),this.chart.render(!0)),this.chart.emit(_t.AFTER_CHANGE_DATA,re.fromData(this.chart,_t.AFTER_CHANGE_DATA,null))},n.prototype.getDefaultOptions=function(){return n.getDefaultOptions()},n.prototype.getSchemaAdaptor=function(){return fA},n}(yt);function C3(r){var n=r.chart,t=r.options,e=t.data,i=t.sectorStyle,a=t.color;return n.data(e),ht(De)(N({},r,{options:{marginRatio:1,interval:{style:i,color:a}}})),r}function E3(r){var n=r.chart,t=r.options,e=t.label,i=t.xField,a=Ie(n,"interval");if(e===!1)a.label(!1);else if(wt(e)){var o=e.callback,s=e.fields,u=Tt(e,["callback","fields"]),l=u.offset,c=u.layout;(l===void 0||l>=0)&&(c=c?V(c)?c:[c]:[],u.layout=Pe(c,function(f){return f.type!=="limit-in-shape"}),u.layout.length||delete u.layout),a.label({fields:s||[i],callback:o,cfg:Se(u)})}else In(qr.WARN,e===null,"the label option must be an Object."),a.label({fields:[i]});return r}function S3(r){var n=r.chart,t=r.options,e=t.legend,i=t.seriesField;return e===!1?n.legend(!1):i&&n.legend(i,e),r}function b3(r){var n=r.chart,t=r.options,e=t.radius,i=t.innerRadius,a=t.startAngle,o=t.endAngle;return n.coordinate({type:"polar",cfg:{radius:e,innerRadius:i,startAngle:a,endAngle:o}}),r}function A3(r){var n,t=r.options,e=t.xAxis,i=t.yAxis,a=t.xField,o=t.yField;return ht(oe((n={},n[a]=e,n[o]=i,n)))(r)}function T3(r){var n=r.chart,t=r.options,e=t.xAxis,i=t.yAxis,a=t.xField,o=t.yField;return e?n.axis(a,e):n.axis(a,!1),i?n.axis(o,i):n.axis(o,!1),r}function M3(r){ht(xr("sectorStyle"),C3,A3,E3,b3,T3,S3,me,Qt,Ht,Ot,ne(),Ci)(r)}var w3=N({},yt.getDefaultOptions(),{xAxis:!1,yAxis:!1,legend:{position:"right",radio:{}},sectorStyle:{stroke:"#fff",lineWidth:1},label:{layout:{type:"limit-in-shape"}},tooltip:{shared:!0,showMarkers:!1},interactions:[{type:"active-region"}]});(function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.type="rose",t}return n.getDefaultOptions=function(){return w3},n.prototype.changeData=function(t){this.updateOption({data:t}),this.chart.changeData(t)},n.prototype.getDefaultOptions=function(){return n.getDefaultOptions()},n.prototype.getSchemaAdaptor=function(){return M3},n})(yt);var L3={font:function(){return"serif"},padding:1,size:[500,500],spiral:"archimedean",timeInterval:3e3};function F3(r,n){return n=zt({},L3,n),k3(r,n)}function k3(r,n){var t=V3();["font","fontSize","fontWeight","padding","rotate","size","spiral","timeInterval","random"].forEach(function(u){G(n[u])||t[u](n[u])}),t.words(r),n.imageMask&&t.createMask(n.imageMask);var e=t.start(),i=e._tags;i.forEach(function(u){u.x+=n.size[0]/2,u.y+=n.size[1]/2});var a=n.size,o=a[0],s=a[1];return i.push({text:"",value:0,x:0,y:0,opacity:0}),i.push({text:"",value:0,x:o,y:s,opacity:0}),i}var hf=Math.PI/180,Wo=1<<11>>5,Yu=1<<11;function O3(r){return r.text}function R3(){return"serif"}function V0(){return"normal"}function I3(r){return r.value}function D3(){return~~(Math.random()*2)*90}function P3(){return 1}function B3(r,n,t,e){if(!n.sprite){var i=r.context,a=r.ratio;i.clearRect(0,0,(Wo<<5)/a,Yu/a);var o=0,s=0,u=0,l=t.length;for(--e;++e<l;){n=t[e],i.save(),i.font=n.style+" "+n.weight+" "+~~((n.size+1)/a)+"px "+n.font;var c=i.measureText(n.text+"m").width*a,f=n.size<<1;if(n.rotate){var h=Math.sin(n.rotate*hf),v=Math.cos(n.rotate*hf),p=c*v,d=c*h,g=f*v,y=f*h;c=Math.max(Math.abs(p+y),Math.abs(p-y))+31>>5<<5,f=~~Math.max(Math.abs(d+g),Math.abs(d-g))}else c=c+31>>5<<5;if(f>u&&(u=f),o+c>=Wo<<5&&(o=0,s+=u,u=0),s+f>=Yu)break;i.translate((o+(c>>1))/a,(s+(f>>1))/a),n.rotate&&i.rotate(n.rotate*hf),i.fillText(n.text,0,0),n.padding&&(i.lineWidth=2*n.padding,i.strokeText(n.text,0,0)),i.restore(),n.width=c,n.height=f,n.xoff=o,n.yoff=s,n.x1=c>>1,n.y1=f>>1,n.x0=-n.x1,n.y0=-n.y1,n.hasText=!0,o+=c}for(var m=i.getImageData(0,0,(Wo<<5)/a,Yu/a).data,x=[];--e>=0;)if(n=t[e],!!n.hasText){for(var c=n.width,_=c>>5,f=n.y1-n.y0,E=0;E<f*_;E++)x[E]=0;if(o=n.xoff,o==null)return;s=n.yoff;for(var b=0,M=-1,T=0;T<f;T++){for(var E=0;E<c;E++){var k=_*T+(E>>5),L=m[(s+T)*(Wo<<5)+(o+E)<<2]?1<<31-E%32:0;x[k]|=L,b|=L}b?M=T:(n.y0++,f--,T--,s++)}n.y1=n.y0+M,n.sprite=x.slice(0,(n.y1-n.y0)*_)}}}function N3(r,n,t){t>>=5;for(var e=r.sprite,i=r.width>>5,a=r.x-(i<<4),o=a&127,s=32-o,u=r.y1-r.y0,l=(r.y+r.y0)*t+(a>>5),c,f=0;f<u;f++){c=0;for(var h=0;h<=i;h++)if((c<<s|(h<i?(c=e[f*i+h])>>>o:0))&n[l+h])return!0;l+=t}return!1}function z3(r,n){var t=r[0],e=r[1];n.x+n.x0<t.x&&(t.x=n.x+n.x0),n.y+n.y0<t.y&&(t.y=n.y+n.y0),n.x+n.x1>e.x&&(e.x=n.x+n.x1),n.y+n.y1>e.y&&(e.y=n.y+n.y1)}function U3(r,n){return r.x+r.x1>n[0].x&&r.x+r.x0<n[1].x&&r.y+r.y1>n[0].y&&r.y+r.y0<n[1].y}function hA(r){var n=r[0]/r[1];return function(t){return[n*(t*=.1)*Math.cos(t),t*Math.sin(t)]}}function H3(r){var n=4,t=n*r[0]/r[1],e=0,i=0;return function(a){var o=a<0?-1:1;switch(Math.sqrt(1+4*o*a)-o&3){case 0:e+=t;break;case 1:i+=n;break;case 2:e-=t;break;default:i-=n;break}return[e,i]}}function W0(r){for(var n=[],t=-1;++t<r;)n[t]=0;return n}function $3(){return document.createElement("canvas")}function on(r){return rt(r)?r:function(){return r}}var G3={archimedean:hA,rectangular:H3};function V3(){var r=[256,256],n=R3,t=I3,e=V0,i=D3,a=P3,o=hA,s=Math.random,u=[],l=1/0,c=O3,f=V0,h=$3,v={};v.start=function(){var g=r[0],y=r[1],m=p(h()),x=v.board?v.board:W0((r[0]>>5)*r[1]),_=u.length,E=[],b=u.map(function(L,O,D){return L.text=c.call(this,L,O,D),L.font=n.call(this,L,O,D),L.style=f.call(this,L,O,D),L.weight=e.call(this,L,O,D),L.rotate=i.call(this,L,O,D),L.size=~~t.call(this,L,O,D),L.padding=a.call(this,L,O,D),L}).sort(function(L,O){return O.size-L.size}),M=-1,T=v.board?[{x:0,y:0},{x:g,y}]:null;k();function k(){for(var L=Date.now();Date.now()-L<l&&++M<_;){var O=b[M];O.x=g*(s()+.5)>>1,O.y=y*(s()+.5)>>1,B3(m,O,b,M),O.hasText&&d(x,O,T)&&(E.push(O),T?v.hasImage||z3(T,O):T=[{x:O.x+O.x0,y:O.y+O.y0},{x:O.x+O.x1,y:O.y+O.y1}],O.x-=r[0]>>1,O.y-=r[1]>>1)}v._tags=E,v._bounds=T}return v};function p(g){g.width=g.height=1;var y=Math.sqrt(g.getContext("2d").getImageData(0,0,1,1).data.length>>2);g.width=(Wo<<5)/y,g.height=Yu/y;var m=g.getContext("2d");return m.fillStyle=m.strokeStyle="red",m.textAlign="center",{context:m,ratio:y}}function d(g,y,m){for(var x=y.x,_=y.y,E=Math.sqrt(r[0]*r[0]+r[1]*r[1]),b=o(r),M=s()<.5?1:-1,T,k=-M,L,O;(T=b(k+=M))&&(L=~~T[0],O=~~T[1],!(Math.min(Math.abs(L),Math.abs(O))>=E));)if(y.x=x+L,y.y=_+O,!(y.x+y.x0<0||y.y+y.y0<0||y.x+y.x1>r[0]||y.y+y.y1>r[1])&&(!m||!N3(y,g,r[0]))&&(!m||U3(y,m))){for(var D=y.sprite,W=y.width>>5,j=r[0]>>5,ot=y.x-(W<<4),z=ot&127,X=32-z,K=y.y1-y.y0,Q=void 0,q=(y.y+y.y0)*j+(ot>>5),at=0;at<K;at++){Q=0;for(var pt=0;pt<=W;pt++)g[q+pt]|=Q<<X|(pt<W?(Q=D[at*W+pt])>>>z:0);q+=j}return delete y.sprite,!0}return!1}return v.createMask=function(g){var y=document.createElement("canvas"),m=r[0],x=r[1];if(!(!m||!x)){var _=m>>5,E=W0((m>>5)*x);y.width=m,y.height=x;var b=y.getContext("2d");b.drawImage(g,0,0,g.width,g.height,0,0,m,x);for(var M=b.getImageData(0,0,m,x).data,T=0;T<x;T++)for(var k=0;k<m;k++){var L=_*T+(k>>5),O=T*m+k<<2,D=M[O]>=250&&M[O+1]>=250&&M[O+2]>=250,W=D?1<<31-k%32:0;E[L]|=W}v.board=E,v.hasImage=!0}},v.timeInterval=function(g){l=g==null?1/0:g},v.words=function(g){u=g},v.size=function(g){r=[+g[0],+g[1]]},v.font=function(g){n=on(g)},v.fontWeight=function(g){e=on(g)},v.rotate=function(g){i=on(g)},v.spiral=function(g){o=G3[g]||g},v.fontSize=function(g){t=on(g)},v.padding=function(g){a=on(g)},v.random=function(g){s=on(g)},v}function vA(r){var n=r.options,t=r.chart,e=t,i=e.width,a=e.height,o=e.padding,s=e.appendPadding,u=e.ele,l=n.data,c=n.imageMask,f=n.wordField,h=n.weightField,v=n.colorField,p=n.wordStyle,d=n.timeInterval,g=n.random,y=n.spiral,m=n.autoFit,x=m===void 0?!0:m,_=n.placementStrategy;if(!l||!l.length)return[];var E=p.fontFamily,b=p.fontWeight,M=p.padding,T=p.fontSize,k=Z3(l,h),L=[Q3(k),J3(k)],O=l.map(function(j){return{text:j[f],value:j[h],color:j[v],datum:j}}),D={imageMask:c,font:E,fontSize:Y3(T,L),fontWeight:b,size:W3({width:i,height:a,padding:o,appendPadding:s,autoFit:x,container:u}),padding:M,timeInterval:d,random:g,spiral:y,rotate:q3(n)};if(rt(_)){var W=O.map(function(j,ot,z){return C(C(C({},j),{hasText:!!j.text,font:on(D.font)(j,ot,z),weight:on(D.fontWeight)(j,ot,z),rotate:on(D.rotate)(j,ot,z),size:on(D.fontSize)(j,ot,z),style:"normal"}),_.call(t,j,ot,z))});return W.push({text:"",value:0,x:0,y:0,opacity:0}),W.push({text:"",value:0,x:D.size[0],y:D.size[1],opacity:0}),W}return F3(O,D)}function W3(r){var n=r.width,t=r.height,e=r.container,i=r.autoFit,a=r.padding,o=r.appendPadding;if(i){var s=Lh(e);n=s.width,t=s.height}n=n||400,t=t||400;var u=j3({padding:a,appendPadding:o}),l=u[0],c=u[1],f=u[2],h=u[3],v=[n-(h+c),t-(l+f)];return v}function j3(r){var n=hi(r.padding),t=hi(r.appendPadding),e=n[0]+t[0],i=n[1]+t[1],a=n[2]+t[2],o=n[3]+t[3];return[e,i,a,o]}function X3(r){return new Promise(function(n,t){if(r instanceof HTMLImageElement){n(r);return}if(lt(r)){var e=new Image;e.crossOrigin="anonymous",e.src=r,e.onload=function(){n(e)},e.onerror=function(){In(qr.ERROR,!1,"image %s load failed !!!",r),t()};return}In(qr.WARN,r===void 0,"The type of imageMask option must be String or HTMLImageElement."),t()})}function Y3(r,n){if(rt(r))return r;if(V(r)){var t=r[0],e=r[1];if(!n)return function(){return(e+t)/2};var i=n[0],a=n[1];return a===i?function(){return(e+t)/2}:function(s){var u=s.value;return(e-t)/(a-i)*(u-i)+t}}return function(){return r}}function Z3(r,n){return r.map(function(t){return t[n]}).filter(function(t){return typeof t=="number"&&!isNaN(t)})}function q3(r){var n=K3(r),t=n.rotation,e=n.rotationSteps;if(!V(t))return t;var i=t[0],a=t[1],o=e===1?0:(a-i)/(e-1);return function(){return a===i?a:Math.floor(Math.random()*e)*o}}function K3(r){var n=r.wordStyle.rotationSteps;return n<1&&(In(qr.WARN,!1,"The rotationSteps option must be greater than or equal to 1."),n=1),{rotation:r.wordStyle.rotation,rotationSteps:n}}function Q3(r){return Math.min.apply(Math,r)}function J3(r){return Math.max.apply(Math,r)}var Dp="color",t7=N({},yt.getDefaultOptions(),{timeInterval:2e3,legend:!1,tooltip:{showTitle:!1,showMarkers:!1,showCrosshairs:!1,fields:["text","value",Dp],formatter:function(r){return{name:r.text,value:r.value}}},wordStyle:{fontFamily:"Verdana",fontWeight:"normal",padding:1,fontSize:[12,60],rotation:[0,90],rotationSteps:2,rotateRatio:.5}});function e7(r){var n=r.chart,t=r.options,e=t.colorField,i=t.color,a=vA(r);n.data(a);var o=N({},r,{options:{xField:"x",yField:"y",seriesField:e&&Dp,rawFields:rt(i)&&Yt(F(t,"rawFields",[]),["datum"]),point:{color:i,shape:"word-cloud"}}}),s=_r(o).ext;return s.geometry.label(!1),n.coordinate().reflect("y"),n.axis(!1),r}function r7(r){return ht(oe({x:{nice:!1},y:{nice:!1}}))(r)}function n7(r){var n=r.chart,t=r.options,e=t.legend,i=t.colorField;return e===!1?n.legend(!1):i&&n.legend(Dp,e),r}function i7(r){ht(e7,r7,me,n7,Qt,Ht,Ot,Ci)(r)}Pt("point","word-cloud",{draw:function(r,n){var t=r.x,e=r.y,i=n.addShape("text",{attrs:C(C({},a7(r)),{x:t,y:e})}),a=r.data.rotate;return typeof a=="number"&&ir.rotate(i,a*Math.PI/180),i}});function a7(r){return{fontSize:r.data.size,text:r.data.text,textAlign:"center",fontFamily:r.data.font,fontWeight:r.data.weight,fill:r.color||r.defaultStyle.stroke,textBaseline:"alphabetic"}}(function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.type="word-cloud",t}return n.getDefaultOptions=function(){return t7},n.prototype.changeData=function(t){this.updateOption({data:t}),this.options.imageMask?this.render():this.chart.changeData(vA({chart:this.chart,options:this.options}))},n.prototype.getDefaultOptions=function(){return n.getDefaultOptions()},n.prototype.render=function(){var t=this;return new Promise(function(e){var i=t.options.imageMask;if(!i){r.prototype.render.call(t),e();return}var a=function(o){t.options=C(C({},t.options),{imageMask:o||null}),r.prototype.render.call(t),e()};X3(i).then(a).catch(a)})},n.prototype.getSchemaAdaptor=function(){return i7},n.prototype.triggerResize=function(){var t=this;this.chart.destroyed||(this.execAdaptor(),window.setTimeout(function(){r.prototype.triggerResize.call(t)}))},n})(yt);var o7={exp:xM,linear:_M,loess:CM,log:EM,poly:SM,pow:bM,quad:AM};function s7(r,n){var t=10,e={regionStyle:[{position:{start:[r,"max"],end:["max",n]},style:{fill:"#d8d0c0",opacity:.4}},{position:{start:["min","max"],end:[r,n]},style:{fill:"#a3dda1",opacity:.4}},{position:{start:["min",n],end:[r,"min"]},style:{fill:"#d8d0c0",opacity:.4}},{position:{start:[r,n],end:["max","min"]},style:{fill:"#a3dda1",opacity:.4}}],lineStyle:{stroke:"#9ba29a",lineWidth:1},labelStyle:[{position:["max",n],offsetX:-t,offsetY:-t,style:{textAlign:"right",textBaseline:"bottom",fontSize:14,fill:"#ccc"}},{position:["min",n],offsetX:t,offsetY:-t,style:{textAlign:"left",textBaseline:"bottom",fontSize:14,fill:"#ccc"}},{position:["min",n],offsetX:t,offsetY:t,style:{textAlign:"left",textBaseline:"top",fontSize:14,fill:"#ccc"}},{position:["max",n],offsetX:-t,offsetY:t,style:{textAlign:"right",textBaseline:"top",fontSize:14,fill:"#ccc"}}]};return e}var u7=function(r,n){var t=n.view,e=n.options,i=e.xField,a=e.yField,o=t.getScaleByField(i),s=t.getScaleByField(a),u=r.map(function(l){return t.getCoordinate().convert({x:o.scale(l[0]),y:s.scale(l[1])})});return e4(u,!1)},l7=function(r){var n=r.options,t=n.xField,e=n.yField,i=n.data,a=n.regressionLine,o=a.type,s=o===void 0?"linear":o,u=a.algorithm,l;if(u)l=V(u)?u:u(i);else{var c=o7[s]().x(function(f){return f[t]}).y(function(f){return f[e]});l=c(i)}return u7(l,r)},c7=function(r){var n,t=r.meta,e=t===void 0?{}:t,i=r.xField,a=r.yField,o=r.data,s=o[0][i],u=o[0][a],l=s>0,c=u>0;function f(h,v){var p=F(e,[h]);function d(y){return F(p,y)}var g={};return v==="x"?(dt(s)&&(dt(d("min"))||(g.min=l?0:s*2),dt(d("max"))||(g.max=l?s*2:0)),g):(dt(u)&&(dt(d("min"))||(g.min=c?0:u*2),dt(d("max"))||(g.max=c?u*2:0)),g)}return C(C({},e),(n={},n[i]=C(C({},e[i]),f(i,"x")),n[a]=C(C({},e[a]),f(a,"y")),n))};function pA(r){var n=r.data,t=n===void 0?[]:n,e=r.xField,i=r.yField;if(t.length){for(var a=!0,o=!0,s=t[0],u=void 0,l=1;l<t.length&&(u=t[l],s[e]!==u[e]&&(a=!1),s[i]!==u[i]&&(o=!1),!(!a&&!o));l++)s=u;var c=[];a&&c.push(e),o&&c.push(i);var f=Nt(c7(r),c);return N({},r,{meta:f})}return r}function f7(r){var n=r.chart,t=r.options,e=t.data,i=t.type,a=t.color,o=t.shape,s=t.pointStyle,u=t.shapeField,l=t.colorField,c=t.xField,f=t.yField,h=t.sizeField,v=t.size,p=t.tooltip;h&&(v||(v=[2,8]),dt(v)&&(v=[v,v])),p&&!p.fields&&(p=C(C({},p),{fields:[c,f,l,h,u]})),n.data(e),_r(N({},r,{options:{seriesField:l,point:{color:a,shape:o,size:v,style:s},tooltip:p}}));var d=Ie(n,"point");return i&&d.adjust(i),r}function Zu(r){var n,t=r.options,e=t.xAxis,i=t.yAxis,a=t.xField,o=t.yField,s=pA(t);return ht(oe((n={},n[a]=e,n[o]=i,n)))(N({},r,{options:s}))}function h7(r){var n=r.chart,t=r.options,e=t.xAxis,i=t.yAxis,a=t.xField,o=t.yField;return n.axis(a,e),n.axis(o,i),r}function v7(r){var n=r.chart,t=r.options,e=t.legend,i=t.colorField,a=t.shapeField,o=t.sizeField,s=t.shapeLegend,u=t.sizeLegend,l=e!==!1;return i&&n.legend(i,l?e:!1),a&&(s?n.legend(a,s):n.legend(a,s===!1?!1:e)),o&&n.legend(o,u||!1),!l&&!s&&!u&&n.legend(!1),r}function p7(r){var n=r.chart,t=r.options,e=t.label,i=t.yField,a=Ie(n,"point");if(!e)a.label(!1);else{var o=e.callback,s=Tt(e,["callback"]);a.label({fields:[i],callback:o,cfg:Se(s)})}return r}function d7(r){var n=r.options,t=n.quadrant,e=[];if(t){var i=t.xBaseline,a=i===void 0?0:i,o=t.yBaseline,s=o===void 0?0:o,u=t.labels,l=t.regionStyle,c=t.lineStyle,f=s7(a,s),h=new Array(4).join(",").split(",");h.forEach(function(v,p){e.push(C(C({type:"region",top:!1},f.regionStyle[p].position),{style:N({},f.regionStyle[p].style,l==null?void 0:l[p])}),C({type:"text",top:!0},N({},f.labelStyle[p],u==null?void 0:u[p])))}),e.push({type:"line",top:!1,start:["min",s],end:["max",s],style:N({},f.lineStyle,c)},{type:"line",top:!1,start:[a,"min"],end:[a,"max"],style:N({},f.lineStyle,c)})}return ht(ne(e))(r)}function g7(r){var n=r.options,t=r.chart,e=n.regressionLine;if(e){var i=e.style,a=e.top,o=a===void 0?!1:a,s={stroke:"#9ba29a",lineWidth:2,opacity:.5};t.annotation().shape({top:o,render:function(u,l){var c=u.addGroup({id:t.id+"-regression-line",name:"regression-line-group"}),f=l7({view:l,options:n});c.addShape("path",{name:"regression-line",attrs:C(C({path:f},s),i)})}})}return r}function y7(r){var n=r.chart,t=r.options,e=t.tooltip;return e?n.tooltip(e):e===!1&&n.tooltip(!1),r}function dA(r){return ht(f7,Zu,h7,v7,y7,p7,aA,js,kp,Qt,d7,Ht,Ot,g7)(r)}var m7=N({},yt.getDefaultOptions(),{size:4,tooltip:{showTitle:!1,showMarkers:!1,showCrosshairs:!0,crosshairs:{type:"xy"}}});gt("drag-move",{start:[{trigger:"plot:mousedown",action:"scale-translate:start"}],processing:[{trigger:"plot:mousemove",action:"scale-translate:translate",throttle:{wait:100,leading:!0,trailing:!1}}],end:[{trigger:"plot:mouseup",action:"scale-translate:end"}]});var x7=function(r){R(n,r);function n(t,e){var i=r.call(this,t,e)||this;return i.type="scatter",i.on(_t.BEFORE_RENDER,function(a){var o,s,u=i,l=u.options,c=u.chart;if(((o=a.data)===null||o===void 0?void 0:o.source)===Ze.FILTER){var f=i.chart.filterData(i.chart.getData());Zu({chart:c,options:C(C({},l),{data:f})})}((s=a.data)===null||s===void 0?void 0:s.source)===Ze.RESET&&Zu({chart:c,options:l})}),i}return n.getDefaultOptions=function(){return m7},n.prototype.changeData=function(t){this.updateOption(pA(N({},this.options,{data:t})));var e=this,i=e.options,a=e.chart;Zu({chart:a,options:i}),this.chart.changeData(t)},n.prototype.getSchemaAdaptor=function(){return dA},n.prototype.getDefaultOptions=function(){return n.getDefaultOptions()},n}(yt);function _7(r){var n=r.chart,t=r.options,e=t.data,i=t.lineStyle,a=t.color,o=t.point,s=t.area;n.data(e);var u=N({},r,{options:{line:{style:i,color:a},point:o&&C({color:a},o),area:s&&C({color:a},s),label:void 0}}),l=N({},u,{options:{tooltip:!1}}),c=(o==null?void 0:o.state)||t.state,f=N({},u,{options:{tooltip:!1,state:c}});return vo(u),_r(f),mc(l),r}function C7(r){var n,t=r.options,e=t.xAxis,i=t.yAxis,a=t.xField,o=t.yField;return ht(oe((n={},n[a]=e,n[o]=i,n)))(r)}function E7(r){var n=r.chart,t=r.options,e=t.radius,i=t.startAngle,a=t.endAngle;return n.coordinate("polar",{radius:e,startAngle:i,endAngle:a}),r}function S7(r){var n=r.chart,t=r.options,e=t.xField,i=t.xAxis,a=t.yField,o=t.yAxis;return n.axis(e,i),n.axis(a,o),r}function b7(r){var n=r.chart,t=r.options,e=t.label,i=t.yField,a=Ie(n,"line");if(!e)a.label(!1);else{var o=e.callback,s=Tt(e,["callback"]);a.label({fields:[i],callback:o,cfg:Se(s)})}return r}function A7(r){return ht(_7,C7,Ot,E7,S7,ho,me,b7,Qt,Ht,ne())(r)}var T7=function(r){R(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return Object.defineProperty(n.prototype,"name",{get:function(){return"radar-tooltip"},enumerable:!1,configurable:!0}),n.prototype.getTooltipItems=function(t){var e=this.getTooltipCfg(),i=e.shared,a=e.title,o=r.prototype.getTooltipItems.call(this,t);if(o.length>0){var s=this.view.geometries[0],u=s.dataArray,l=o[0].name,c=[];return u.forEach(function(f){f.forEach(function(h){var v=ir.getTooltipItems(h,s),p=v[0];if(!i&&p&&p.name===l){var d=G(a)?l:a;c.push(C(C({},p),{name:p.title,title:d}))}else if(i&&p){var d=G(a)?p.name||l:a;c.push(C(C({},p),{name:p.title,title:d}))}})}),c}return[]},n}(HS);ha("radar-tooltip",T7);var M7=function(r){R(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.init=function(){var t=this.context.view;t.removeInteraction("tooltip")},n.prototype.show=function(){var t=this.context.event,e=this.getTooltipController();e.showTooltip({x:t.x,y:t.y})},n.prototype.hide=function(){var t=this.getTooltipController();t.hideTooltip()},n.prototype.getTooltipController=function(){var t=this.context.view;return t.getController("radar-tooltip")},n}(ee);ct("radar-tooltip",M7);gt("radar-tooltip",{start:[{trigger:"plot:mousemove",action:"radar-tooltip:show"}],end:[{trigger:"plot:mouseleave",action:"radar-tooltip:hide"}]});var ttt=function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.type="radar",t}return n.prototype.changeData=function(t){this.updateOption({data:t}),this.chart.changeData(t)},n.prototype.getDefaultOptions=function(){return N({},r.prototype.getDefaultOptions.call(this),{xAxis:{label:{offset:15},grid:{line:{type:"line"}}},yAxis:{grid:{line:{type:"circle"}}},legend:{position:"top"},tooltip:{shared:!0,showCrosshairs:!0,showMarkers:!0,crosshairs:{type:"xy",line:{style:{stroke:"#565656",lineDash:[4]}},follow:!0}}})},n.prototype.getSchemaAdaptor=function(){return A7},n}(yt),ro;(function(r){r.Left="Left",r.Right="Right"})(ro||(ro={}));var aa;(function(r){r.Line="line",r.Column="column"})(aa||(aa={}));var Cr="left-axes-view",Er="right-axes-view",gA={nice:!0,label:{autoHide:!0,autoRotate:!1}},w7=C(C({},gA),{position:"left"}),L7=C(C({},gA),{position:"right",grid:null});function kh(r){return F(r,"geometry")===aa.Line}function Pp(r){return F(r,"geometry")===aa.Column}function j0(r,n,t){return Pp(t)?N({},{geometry:aa.Column,label:t.label&&t.isRange?{content:function(e){var i;return(i=e[n])===null||i===void 0?void 0:i.join("-")}}:void 0},t):C({geometry:aa.Line},t)}function X0(r,n){var t=r[0],e=r[1];if(V(n)){var i=n[0],a=n[1];return[i,a]}var o=F(n,t),s=F(n,e);return[o,s]}function Y0(r,n){return n===ro.Left?r===!1?!1:N({},w7,r):n===ro.Right?r===!1?!1:N({},L7,r):r}function Z0(r){var n=r.view,t=r.geometryOption,e=r.yField,i=r.legend,a=F(i,"marker"),o=Ie(n,kh(t)?"line":"interval");if(!t.seriesField){var s=F(n,"options.scales."+e+".alias")||e,u=o.getAttribute("color"),l=n.getTheme().defaultColor;u&&(l=ir.getMappingValue(u,s,F(u,["values",0],l)));var c=(rt(a)?a:!nr(a)&&N({},{style:{stroke:l,fill:l}},a))||(kh(t)?{symbol:function(h,v,p){return[["M",h-p,v],["L",h+p,v]]},style:{lineWidth:2,r:6,stroke:l}}:{symbol:"square",style:{fill:l}});return[{value:e,name:s,marker:c,isGeometry:!0,viewId:n.id}]}var f=o.getGroupAttributes();return ze(f,function(h,v){var p=ir.getLegendItems(n,o,v,n.getTheme(),a);return h.concat(p)},[])}function F7(r){var n=r.options,t=r.chart,e=n.geometryOption,i=e.isStack,a=e.color,o=e.seriesField,s=e.groupField,u=e.isGroup,l=["xField","yField"];if(kh(e)){vo(N({},r,{options:C(C(C({},Nt(n,l)),e),{line:{color:e.color,style:e.lineStyle}})})),_r(N({},r,{options:C(C(C({},Nt(n,l)),e),{point:e.point&&C({color:a,shape:"circle"},e.point)})}));var c=[];u&&c.push({type:"dodge",dodgeBy:s||o,customOffset:0}),i&&c.push({type:"stack"}),c.length&&w(t.geometries,function(f){f.adjust(c)})}return Pp(e)&&Cc(N({},r,{options:C(C(C({},Nt(n,l)),e),{widthRatio:e.columnWidthRatio,interval:C(C({},Nt(e,["color"])),{style:e.columnStyle})})})),r}var q0=function(r,n){var t=n[0],e=n[1],i=r.getOptions().data,a=r.getXScale(),o=Ee(i);if(!(!a||!o)){var s=Yr(i,a.field),u=s,l=Ee(u),c=Math.floor(t*(l-1)),f=Math.floor(e*(l-1));r.filter(a.field,function(h){var v=u.indexOf(h);return v>-1?u4(v,c,f):!0}),r.getRootView().render(!0)}};function k7(r){var n,t=r.options,e=t.geometryOptions,i=e===void 0?[]:e,a=t.xField,o=t.yField,s=bv(i,function(u){var l=u.geometry;return l===aa.Line||l===void 0});return N({},{options:{geometryOptions:[],meta:(n={},n[a]={type:"cat",sync:!0,range:s?[0,1]:void 0},n),tooltip:{showMarkers:s,showCrosshairs:s,shared:!0,crosshairs:{type:"x"}},interactions:s?[{type:"legend-visible-filter"}]:[{type:"legend-visible-filter"},{type:"active-region"}],legend:{position:"top-left"}}},r,{options:{yAxis:X0(o,t.yAxis),geometryOptions:[j0(a,o[0],i[0]),j0(a,o[1],i[1])],annotations:X0(o,t.annotations)}})}function O7(r){var n,t,e=r.chart,i=r.options,a=i.geometryOptions,o={line:0,column:1},s=[{type:(n=a[0])===null||n===void 0?void 0:n.geometry,id:Cr},{type:(t=a[1])===null||t===void 0?void 0:t.geometry,id:Er}];return s.sort(function(u,l){return-o[u.type]+o[l.type]}).forEach(function(u){return e.createView({id:u.id})}),r}function R7(r){var n=r.chart,t=r.options,e=t.xField,i=t.yField,a=t.geometryOptions,o=t.data,s=t.tooltip,u=[C(C({},a[0]),{id:Cr,data:o[0],yField:i[0]}),C(C({},a[1]),{id:Er,data:o[1],yField:i[1]})];return u.forEach(function(l){var c=l.id,f=l.data,h=l.yField,v=Pp(l)&&l.isPercent,p=v?rA(f,h,e,h):f,d=Et(n,c).data(p),g=v?C({formatter:function(y){return{name:y[l.seriesField]||h,value:(Number(y[h])*100).toFixed(2)+"%"}}},s):s;F7({chart:d,options:{xField:e,yField:h,tooltip:g,geometryOption:l}})}),r}function I7(r){var n,t=r.chart,e=r.options,i=e.geometryOptions,a=((n=t.getTheme())===null||n===void 0?void 0:n.colors10)||[],o=0;return t.once("beforepaint",function(){w(i,function(s,u){var l=Et(t,u===0?Cr:Er);if(!s.color){var c=l.getGroupScales(),f=F(c,[0,"values","length"],1),h=a.slice(o,o+f).concat(u===0?[]:a);l.geometries.forEach(function(v){s.seriesField?v.color(s.seriesField,h):v.color(h[0])}),o+=f}}),t.render(!0)}),r}function D7(r){var n,t,e=r.chart,i=r.options,a=i.xAxis,o=i.yAxis,s=i.xField,u=i.yField;return oe((n={},n[s]=a,n[u[0]]=o[0],n))(N({},r,{chart:Et(e,Cr)})),oe((t={},t[s]=a,t[u[1]]=o[1],t))(N({},r,{chart:Et(e,Er)})),r}function P7(r){var n=r.chart,t=r.options,e=Et(n,Cr),i=Et(n,Er),a=t.xField,o=t.yField,s=t.xAxis,u=t.yAxis;return n.axis(a,!1),n.axis(o[0],!1),n.axis(o[1],!1),e.axis(a,s),e.axis(o[0],Y0(u[0],ro.Left)),i.axis(a,!1),i.axis(o[1],Y0(u[1],ro.Right)),r}function B7(r){var n=r.chart,t=r.options,e=t.tooltip,i=Et(n,Cr),a=Et(n,Er);return n.tooltip(e),i.tooltip({shared:!0}),a.tooltip({shared:!0}),r}function N7(r){var n=r.chart;return Qt(N({},r,{chart:Et(n,Cr)})),Qt(N({},r,{chart:Et(n,Er)})),r}function z7(r){var n=r.chart,t=r.options,e=t.annotations,i=F(e,[0]),a=F(e,[1]);return ne(i)(N({},r,{chart:Et(n,Cr),options:{annotations:i}})),ne(a)(N({},r,{chart:Et(n,Er),options:{annotations:a}})),r}function U7(r){var n=r.chart;return Ot(N({},r,{chart:Et(n,Cr)})),Ot(N({},r,{chart:Et(n,Er)})),Ot(r),r}function H7(r){var n=r.chart;return Ht(N({},r,{chart:Et(n,Cr)})),Ht(N({},r,{chart:Et(n,Er)})),r}function $7(r){var n=r.chart,t=r.options,e=t.yAxis;return ia(N({},r,{chart:Et(n,Cr),options:{yAxis:e[0]}})),ia(N({},r,{chart:Et(n,Er),options:{yAxis:e[1]}})),r}function G7(r){var n=r.chart,t=r.options,e=t.legend,i=t.geometryOptions,a=t.yField,o=t.data,s=Et(n,Cr),u=Et(n,Er);if(e===!1)n.legend(!1);else if(wt(e)&&e.custom===!0)n.legend(e);else{var l=F(i,[0,"legend"],e),c=F(i,[1,"legend"],e);n.once("beforepaint",function(){var f=o[0].length?Z0({view:s,geometryOption:i[0],yField:a[0],legend:l}):[],h=o[1].length?Z0({view:u,geometryOption:i[1],yField:a[1],legend:c}):[];n.legend(N({},e,{custom:!0,items:f.concat(h)}))}),i[0].seriesField&&s.legend(i[0].seriesField,l),i[1].seriesField&&u.legend(i[1].seriesField,c),n.on("legend-item:click",function(f){var h=F(f,"gEvent.delegateObject",{});if(h&&h.item){var v=h.item,p=v.value,d=v.isGeometry,g=v.viewId;if(d){var y=eE(a,function(_){return _===p});if(y>-1){var m=F(Et(n,g),"geometries");w(m,function(_){_.changeVisible(!h.item.unchecked)})}}else{var x=F(n.getController("legend"),"option.items",[]);w(n.views,function(_){var E=_.getGroupScales();w(E,function(b){b.values&&b.values.indexOf(p)>-1&&_.filter(b.field,function(M){var T=jr(x,function(k){return k.value===M});return!T.unchecked})}),n.render(!0)})}}})}return r}function V7(r){var n=r.chart,t=r.options,e=t.slider,i=Et(n,Cr),a=Et(n,Er);return e&&(i.option("slider",e),i.on("slider:valuechanged",function(o){var s=o.event,u=s.value,l=s.originValue;Dt(u,l)||q0(a,u)}),n.once("afterpaint",function(){if(!ui(e)){var o=e.start,s=e.end;(o||s)&&q0(a,[o,s])}})),r}function W7(r){return ht(k7,O7,U7,R7,D7,P7,$7,B7,N7,z7,H7,I7,G7,V7)(r)}var ett=function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.type="dual-axes",t}return n.prototype.getDefaultOptions=function(){return N({},r.prototype.getDefaultOptions.call(this),{yAxis:[],syncViewPadding:!0})},n.prototype.getSchemaAdaptor=function(){return W7},n}(yt),_s="x",$a="y",yA={showTitle:!1,shared:!0,showMarkers:!1,customContent:function(r,n){return""+F(n,[0,"data","y"],0)},containerTpl:'<div class="g2-tooltip"><div class="g2-tooltip-list"></div></div>',itemTpl:"<span>{value}</span>",domStyles:{"g2-tooltip":{padding:"2px 4px",fontSize:"10px"}},showCrosshairs:!0,crosshairs:{type:"x"}},j7={appendPadding:2,tooltip:C({},yA),animation:{}};function da(r){return ie(r||[],function(n,t){return{x:""+t,y:n}})}function X7(r){var n=r.chart,t=r.options,e=t.data,i=t.color,a=t.areaStyle,o=t.point,s=t.line,u=o==null?void 0:o.state,l=da(e);n.data(l);var c=N({},r,{options:{xField:_s,yField:$a,area:{color:i,style:a},line:s,point:o}}),f=N({},c,{options:{tooltip:!1}}),h=N({},c,{options:{tooltip:!1,state:u}});return mc(c),vo(f),_r(h),n.axis(!1),n.legend(!1),r}function po(r){var n,t,e=r.options,i=e.xAxis,a=e.yAxis,o=e.data,s=da(o);return ht(oe((n={},n[_s]=i,n[$a]=a,n),(t={},t[_s]={type:"cat"},t[$a]=Tp(s,$a),t)))(r)}function mA(r){return ht(xr("areaStyle"),X7,po,me,Ot,Ht,ne())(r)}function Y7(r){var n=r.chart,t=r.options,e=t.data,i=t.color,a=t.lineStyle,o=t.point,s=o==null?void 0:o.state,u=da(e);n.data(u);var l=N({},r,{options:{xField:_s,yField:$a,line:{color:i,style:a},point:o}}),c=N({},l,{options:{tooltip:!1,state:s}});return vo(l),_r(c),n.axis(!1),n.legend(!1),r}function xA(r){return ht(Y7,po,Ot,me,Ht,ne())(r)}var Z7=function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.type="tiny-line",t}return n.getDefaultOptions=function(){return j7},n.prototype.changeData=function(t){this.updateOption({data:t});var e=this,i=e.chart,a=e.options;po({chart:i,options:a}),i.changeData(da(t))},n.prototype.getDefaultOptions=function(){return n.getDefaultOptions()},n.prototype.getSchemaAdaptor=function(){return xA},n}(yt);function q7(r){var n=r.chart,t=r.options,e=t.data,i=t.color,a=t.columnStyle,o=t.columnWidthRatio,s=da(e);n.data(s);var u=N({},r,{options:{xField:_s,yField:$a,widthRatio:o,interval:{style:a,color:i}}});return De(u),n.axis(!1),n.legend(!1),n.interaction("element-active"),r}function _A(r){return ht(Ot,xr("columnStyle"),q7,po,me,Ht,ne())(r)}var K7={showTitle:!1,shared:!0,showMarkers:!1,customContent:function(r,n){return""+F(n,[0,"data","y"],0)},containerTpl:'<div class="g2-tooltip"><div class="g2-tooltip-list"></div></div>',itemTpl:"<span>{value}</span>",domStyles:{"g2-tooltip":{padding:"2px 4px",fontSize:"10px"}}},Q7={appendPadding:2,tooltip:C({},K7),animation:{}},J7=function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.type="tiny-column",t}return n.getDefaultOptions=function(){return Q7},n.prototype.changeData=function(t){this.updateOption({data:t});var e=this,i=e.chart,a=e.options;po({chart:i,options:a}),i.changeData(da(t))},n.prototype.getDefaultOptions=function(){return n.getDefaultOptions()},n.prototype.getSchemaAdaptor=function(){return _A},n}(yt),t8={appendPadding:2,tooltip:C({},yA),color:"l(90) 0:#E5EDFE 1:#ffffff",areaStyle:{fillOpacity:.6},line:{size:1,color:"#5B8FF9"},animation:{}},e8=function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.type="tiny-area",t}return n.getDefaultOptions=function(){return t8},n.prototype.changeData=function(t){this.updateOption({data:t});var e=this,i=e.chart,a=e.options;po({chart:i,options:a}),i.changeData(da(t))},n.prototype.getDefaultOptions=function(){return n.getDefaultOptions()},n.prototype.getSchemaAdaptor=function(){return mA},n}(yt);function K0(r,n,t){if(t===1)return[0,n];var e=Math.floor(r/n);return[n*e,n*(e+1)]}function r8(r){return Math.ceil(Math.log(r.length)/Math.LN2)+1}function CA(r,n,t,e,i){var a=Ve(r);mw(a,n);var o=Yr(a,n),s=rE(o),u=s.max-s.min,l=t;if(!t&&e&&(l=e>1?u/(e-1):s.max),!t&&!e){var c=r8(o);l=u/c}var f={},h=dr(a,i);nr(h)?w(a,function(p){var d=p[n],g=K0(d,l,e),y=g[0]+"-"+g[1];si(f,y)||(f[y]={range:g,count:0}),f[y].count+=1}):Object.keys(h).forEach(function(p){w(h[p],function(d){var g=d[n],y=K0(g,l,e),m=y[0]+"-"+y[1],x=m+"-"+p;si(f,x)||(f[x]={range:y,count:0},f[x][i]=p),f[x].count+=1})});var v=[];return w(f,function(p){v.push(p)}),v}var ml="range",Cs="count",n8=N({},yt.getDefaultOptions(),{columnStyle:{stroke:"#FFFFFF"},tooltip:{shared:!0,showMarkers:!1},interactions:[{type:"active-region"}]});function i8(r){var n=r.chart,t=r.options,e=t.data,i=t.binField,a=t.binNumber,o=t.binWidth,s=t.color,u=t.stackField,l=t.legend,c=t.columnStyle,f=CA(e,i,o,a,u);n.data(f);var h=N({},r,{options:{xField:ml,yField:Cs,seriesField:u,isStack:!0,interval:{color:s,style:c}}});return De(h),l&&u&&n.legend(u,l),r}function a8(r){var n,t=r.options,e=t.xAxis,i=t.yAxis;return ht(oe((n={},n[ml]=e,n[Cs]=i,n)))(r)}function o8(r){var n=r.chart,t=r.options,e=t.xAxis,i=t.yAxis;return e===!1?n.axis(ml,!1):n.axis(ml,e),i===!1?n.axis(Cs,!1):n.axis(Cs,i),r}function s8(r){var n=r.chart,t=r.options,e=t.label,i=Ie(n,"interval");if(!e)i.label(!1);else{var a=e.callback,o=Tt(e,["callback"]);i.label({fields:[Cs],callback:a,cfg:Se(o)})}return r}function EA(r){return ht(Ot,xr("columnStyle"),i8,a8,o8,Ci,s8,me,Qt,Ht)(r)}var u8=function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.type="histogram",t}return n.getDefaultOptions=function(){return n8},n.prototype.changeData=function(t){this.updateOption({data:t});var e=this.options,i=e.binField,a=e.binNumber,o=e.binWidth,s=e.stackField;this.chart.changeData(CA(t,i,o,a,s))},n.prototype.getDefaultOptions=function(){return n.getDefaultOptions()},n.prototype.getSchemaAdaptor=function(){return EA},n}(yt),SA=["#FAAD14","#E8EDF3"],l8={percent:.2,color:SA,animation:{}};function Bp(r){var n=Kt(na(r)?r:0,0,1);return[{type:"current",percent:n},{type:"target",percent:1-n}]}function bA(r){var n=r.chart,t=r.options,e=t.percent,i=t.progressStyle,a=t.color,o=t.barWidthRatio;n.data(Bp(e));var s=N({},r,{options:{xField:"1",yField:"percent",seriesField:"type",isStack:!0,widthRatio:o,interval:{style:i,color:lt(a)?[a,SA[1]]:a},args:{zIndexReversed:!0,sortZIndex:!0}}});return De(s),n.tooltip(!1),n.axis(!1),n.legend(!1),r}function c8(r){var n=r.chart;return n.coordinate("rect").transpose(),r}function AA(r){return ht(bA,oe({}),c8,Ht,Ot,ne())(r)}var f8=function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.type="process",t}return n.getDefaultOptions=function(){return l8},n.prototype.changeData=function(t){this.updateOption({percent:t}),this.chart.changeData(Bp(t))},n.prototype.getDefaultOptions=function(){return n.getDefaultOptions()},n.prototype.getSchemaAdaptor=function(){return AA},n}(yt);function h8(r){var n=r.chart,t=r.options,e=t.innerRadius,i=t.radius;return n.coordinate("theta",{innerRadius:e,radius:i}),r}function TA(r,n){var t=r.chart,e=r.options,i=e.innerRadius,a=e.statistic,o=e.percent,s=e.meta;if(t.getController("annotation").clear(!0),i&&a){var u=F(s,["percent","formatter"])||function(c){return(c*100).toFixed(2)+"%"},l=a.content;l&&(l=N({},l,{content:G(l.content)?u(o):l.content})),pc(t,{statistic:C(C({},a),{content:l}),plotType:"ring-progress"},{percent:o})}return n&&t.render(!0),r}function MA(r){return ht(bA,oe({}),h8,TA,Ht,Ot,ne())(r)}var v8={percent:.2,innerRadius:.8,radius:.98,color:["#FAAD14","#E8EDF3"],statistic:{title:!1,content:{style:{fontSize:"14px",fontWeight:300,fill:"#4D4D4D",textAlign:"center",textBaseline:"middle"}}},animation:{}},p8=function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.type="ring-process",t}return n.getDefaultOptions=function(){return v8},n.prototype.changeData=function(t){this.chart.emit(_t.BEFORE_CHANGE_DATA,re.fromData(this.chart,_t.BEFORE_CHANGE_DATA,null)),this.updateOption({percent:t}),this.chart.data(Bp(t)),TA({chart:this.chart,options:this.options},!0),this.chart.emit(_t.AFTER_CHANGE_DATA,re.fromData(this.chart,_t.AFTER_CHANGE_DATA,null))},n.prototype.getDefaultOptions=function(){return n.getDefaultOptions()},n.prototype.getSchemaAdaptor=function(){return MA},n}(yt);function d8(r){var n=r.chart,t=r.options,e=t.data,i=t.type,a=t.xField,o=t.yField,s=t.colorField,u=t.sizeField,l=t.sizeRatio,c=t.shape,f=t.color,h=t.tooltip,v=t.heatmapStyle;n.data(e);var p="polygon";i==="density"&&(p="heatmap");var d=Br(h,[a,o,s]),g=d.fields,y=d.formatter,m=1;return(l||l===0)&&(!c&&!u?console.warn("sizeRatio is not in effect: Must define shape or sizeField first"):l<0||l>1?console.warn("sizeRatio is not in effect: It must be a number in [0,1]"):m=l),or(N({},r,{options:{type:p,colorField:s,tooltipFields:g,shapeField:u||"",label:void 0,mapping:{tooltip:y,shape:c&&(u?function(x){var _=e.map(function(M){return M[u]}),E=Math.min.apply(Math,_),b=Math.max.apply(Math,_);return[c,(F(x,u)-E)/(b-E),m]}:function(){return[c,1,m]}),color:f||s&&n.getTheme().sequenceColors.join("-"),style:v}}})),r}function g8(r){var n,t=r.options,e=t.xAxis,i=t.yAxis,a=t.xField,o=t.yField;return ht(oe((n={},n[a]=e,n[o]=i,n)))(r)}function y8(r){var n=r.chart,t=r.options,e=t.xAxis,i=t.yAxis,a=t.xField,o=t.yField;return e===!1?n.axis(a,!1):n.axis(a,e),i===!1?n.axis(o,!1):n.axis(o,i),r}function m8(r){var n=r.chart,t=r.options,e=t.legend,i=t.colorField,a=t.sizeField,o=t.sizeLegend,s=e!==!1;return i&&n.legend(i,s?e:!1),a&&n.legend(a,o===void 0?e:o),!s&&!o&&n.legend(!1),r}function x8(r){var n=r.chart,t=r.options,e=t.label,i=t.colorField,a=t.type,o=Ie(n,a==="density"?"heatmap":"polygon");if(!e)o.label(!1);else if(i){var s=e.callback,u=Tt(e,["callback"]);o.label({fields:[i],callback:s,cfg:Se(u)})}return r}function _8(r){var n=r.chart,t=r.options,e=t.coordinate,i=t.reflect;return e&&n.coordinate({type:e.type||"rect",cfg:e.cfg}),i&&n.coordinate().reflect(i),r}function C8(r){return ht(Ot,xr("heatmapStyle"),g8,_8,d8,y8,m8,me,x8,ne(),Qt,Ht,Ci)(r)}var E8=N({},yt.getDefaultOptions(),{type:"polygon",legend:!1,coordinate:{type:"rect"},xAxis:{tickLine:null,line:null,grid:{alignTick:!1,line:{style:{lineWidth:1,lineDash:null,stroke:"#f0f0f0"}}}},yAxis:{grid:{alignTick:!1,line:{style:{lineWidth:1,lineDash:null,stroke:"#f0f0f0"}}}}});Pt("polygon","circle",{draw:function(r,n){var t,e,i=r.x,a=r.y,o=this.parsePoints(r.points),s=Math.abs(o[2].x-o[1].x),u=Math.abs(o[1].y-o[0].y),l=Math.min(s,u)/2,c=Number(r.shape[1]),f=Number(r.shape[2]),h=Math.sqrt(f),v=l*h*Math.sqrt(c),p=((t=r.style)===null||t===void 0?void 0:t.fill)||r.color||((e=r.defaultStyle)===null||e===void 0?void 0:e.fill),d=n.addShape("circle",{attrs:C(C(C({x:i,y:a,r:v},r.defaultStyle),r.style),{fill:p})});return d}});Pt("polygon","square",{draw:function(r,n){var t,e,i=r.x,a=r.y,o=this.parsePoints(r.points),s=Math.abs(o[2].x-o[1].x),u=Math.abs(o[1].y-o[0].y),l=Math.min(s,u),c=Number(r.shape[1]),f=Number(r.shape[2]),h=Math.sqrt(f),v=l*h*Math.sqrt(c),p=((t=r.style)===null||t===void 0?void 0:t.fill)||r.color||((e=r.defaultStyle)===null||e===void 0?void 0:e.fill),d=n.addShape("rect",{attrs:C(C(C({x:i-v/2,y:a-v/2,width:v,height:v},r.defaultStyle),r.style),{fill:p})});return d}});(function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.type="heatmap",t}return n.getDefaultOptions=function(){return E8},n.prototype.getSchemaAdaptor=function(){return C8},n.prototype.getDefaultOptions=function(){return n.getDefaultOptions()},n})(yt);var vf,no="$$range$$",S8="low-q1-median-q3-high",b8="$$y_outliers$$",wA="outliers_view",A8=N({},yt.getDefaultOptions(),{meta:(vf={},vf[no]={min:0,alias:S8},vf),interactions:[{type:"active-region"}],tooltip:{showMarkers:!1,shared:!0},boxStyle:{lineWidth:1}}),LA=function(r,n){var t=r;if(Array.isArray(n)){var e=n[0],i=n[1],a=n[2],o=n[3],s=n[4];t=ie(r,function(u){return u[no]=[u[e],u[i],u[a],u[o],u[s]],u})}return t};function T8(r){var n=r.chart,t=r.options,e=t.xField,i=t.yField,a=t.groupField,o=t.color,s=t.tooltip,u=t.boxStyle;n.data(LA(t.data,i));var l=V(i)?no:i,c=i?V(i)?i:[i]:[],f=s;f!==!1&&(f=N({},{fields:V(i)?i:[]},f));var h=Op(N({},r,{options:{xField:e,yField:l,seriesField:a,tooltip:f,rawFields:c,label:!1,schema:{shape:"box",color:o,style:u}}})).ext;return a&&h.geometry.adjust("dodge"),r}function M8(r){var n=r.chart,t=r.options,e=t.xField,i=t.data,a=t.outliersField,o=t.outliersStyle,s=t.padding,u=t.label;if(!a)return r;var l=n.createView({padding:s,id:wA}),c=i.reduce(function(f,h){var v=h[a];return v.forEach(function(p){var d;return f.push(C(C({},h),(d={},d[a]=p,d)))}),f},[]);return l.data(c),_r({chart:l,options:{xField:e,yField:a,point:{shape:"circle",style:o},label:u}}),l.axis(!1),r}function w8(r){var n,t,e=r.chart,i=r.options,a=i.meta,o=i.xAxis,s=i.yAxis,u=i.xField,l=i.yField,c=i.outliersField,f=Array.isArray(l)?no:l,h={};if(c){var v=b8;h=(n={},n[c]={sync:v,nice:!0},n[f]={sync:v,nice:!0},n)}var p=N(h,a,(t={},t[u]=Nt(o,tr),t[f]=Nt(s,tr),t));return e.scale(p),r}function L8(r){var n=r.chart,t=r.options,e=t.xAxis,i=t.yAxis,a=t.xField,o=t.yField,s=Array.isArray(o)?no:o;return e===!1?n.axis(a,!1):n.axis(a,e),i===!1?n.axis(no,!1):n.axis(s,i),r}function F8(r){var n=r.chart,t=r.options,e=t.legend,i=t.groupField;return i?e?n.legend(i,e):n.legend(i,{position:"bottom"}):n.legend(!1),r}function k8(r){return ht(T8,M8,w8,L8,F8,me,Qt,Ht,Ot)(r)}(function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.type="box",t}return n.getDefaultOptions=function(){return A8},n.prototype.changeData=function(t){this.updateOption({data:t});var e=this.options.yField,i=this.chart.views.find(function(a){return a.id===wA});i&&i.data(t),this.chart.changeData(LA(t,e))},n.prototype.getDefaultOptions=function(){return n.getDefaultOptions()},n.prototype.getSchemaAdaptor=function(){return k8},n})(yt);function Q0(r,n){var t=r.length*n;if(r.length===0)throw new Error("quantile requires at least one data point.");if(n<0||n>1)throw new Error("quantiles must be between 0 and 1");return n===1?r[r.length-1]:n===0?r[0]:t%1!==0?r[Math.ceil(t)-1]:r.length%2===0?(r[t-1]+r[t])/2:r[t]}function wo(r,n,t){var e=r[n];r[n]=r[t],r[t]=e}function qu(r,n,t,e){for(t=t||0,e=e||r.length-1;e>t;){if(e-t>600){var i=e-t+1,a=n-t+1,o=Math.log(i),s=.5*Math.exp(2*o/3),u=.5*Math.sqrt(o*s*(i-s)/i);a-i/2<0&&(u*=-1);var l=Math.max(t,Math.floor(n-a*s/i+u)),c=Math.min(e,Math.floor(n+(i-a)*s/i+u));qu(r,n,l,c)}var f=r[n],h=t,v=e;for(wo(r,t,n),r[e]>f&&wo(r,t,e);h<v;){for(wo(r,h,v),h++,v--;r[h]<f;)h++;for(;r[v]>f;)v--}r[t]===f?wo(r,t,v):(v++,wo(r,v,e)),v<=n&&(t=v+1),n<=v&&(e=v-1)}}function Lo(r,n){var t=r.slice();if(Array.isArray(n)){O8(t,n);for(var e=[],i=0;i<n.length;i++)e[i]=Q0(t,n[i]);return e}else{var a=kA(t.length,n);return FA(t,a,0,t.length-1),Q0(t,n)}}function FA(r,n,t,e){n%1===0?qu(r,n,t,e):(n=Math.floor(n),qu(r,n,t,e),qu(r,n+1,n+1,e))}function O8(r,n){for(var t=[0],e=0;e<n.length;e++)t.push(kA(r.length,n[e]));t.push(r.length-1),t.sort(R8);for(var i=[0,t.length-1];i.length;){var a=Math.ceil(i.pop()),o=Math.floor(i.pop());if(!(a-o<=1)){var s=Math.floor((o+a)/2);FA(r,t[s],Math.floor(t[o]),Math.ceil(t[a])),i.push(o,s,s,a)}}}function R8(r,n){return r-n}function kA(r,n){var t=r*n;return n===1?r-1:n===0?0:t%1!==0?Math.ceil(t)-1:r%2===0?t-.5:t}var J0=function(r){return{low:er(r),high:We(r),q1:Lo(r,.25),q3:Lo(r,.75),median:Lo(r,[.5]),minMax:[er(r),We(r)],quantile:[Lo(r,.25),Lo(r,.75)]}},ty=function(r,n){var t=TM.create(r,n);return{violinSize:t.map(function(e){return e.y}),violinY:t.map(function(e){return e.x})}},OA=function(r){var n=r.xField,t=r.yField,e=r.seriesField,i=r.data,a=r.kde,o={min:a.min,max:a.max,size:a.sampleSize,width:a.width};if(!e){var s=dr(i,n);return Object.keys(s).map(function(c){var f=s[c],h=f.map(function(v){return v[t]});return C(C({x:c},ty(h,o)),J0(h))})}var u=[],l=dr(i,e);return Object.keys(l).forEach(function(c){var f=dr(l[c],n);return Object.keys(f).forEach(function(h){var v,p=f[h],d=p.map(function(g){return g[t]});u.push(C(C((v={x:h},v[e]=c,v),ty(d,o)),J0(d)))})}),u},Tr="x",Gi="violinY",I8="violinSize",RA="minMax",IA="quantile",DA="median",Np="violin_view",D8="min_max_view",P8="quantile_view",B8="median_view",N8=N({},yt.getDefaultOptions(),{syncViewPadding:!0,kde:{type:"triangular",sampleSize:32,width:3},violinStyle:{lineWidth:1,fillOpacity:.3,strokeOpacity:.75},xAxis:{grid:{line:null},tickLine:{alignTick:!1}},yAxis:{grid:{line:{style:{lineWidth:.5,lineDash:[4,4]}}}},legend:{position:"top-left"},tooltip:{showMarkers:!1}}),Ku=["low","high","q1","q3","median"],Qu=[{type:"dodge",marginRatio:1/32}];function z8(r){var n=r.chart,t=r.options;return n.data(OA(t)),r}function U8(r){var n=r.chart,t=r.options,e=t.seriesField,i=t.color,a=t.shape,o=a===void 0?"violin":a,s=t.violinStyle,u=t.tooltip,l=t.state,c=n.createView({id:Np});return S4({chart:c,options:{xField:Tr,yField:Gi,seriesField:e||Tr,sizeField:I8,tooltip:C({fields:Ku},u),violin:{style:s,color:i,shape:o},state:l}}),c.geometries[0].adjust(Qu),r}function H8(r){var n=r.chart,t=r.options,e=t.seriesField,i=t.color,a=t.tooltip,o=t.box;if(o===!1)return r;var s=n.createView({id:D8});De({chart:s,options:{xField:Tr,yField:RA,seriesField:e||Tr,tooltip:C({fields:Ku},a),state:typeof o=="object"?o.state:{},interval:{color:i,size:1,style:{lineWidth:0}}}}),s.geometries[0].adjust(Qu);var u=n.createView({id:P8});De({chart:u,options:{xField:Tr,yField:IA,seriesField:e||Tr,tooltip:C({fields:Ku},a),state:typeof o=="object"?o.state:{},interval:{color:i,size:8,style:{fillOpacity:1}}}}),u.geometries[0].adjust(Qu);var l=n.createView({id:B8});return _r({chart:l,options:{xField:Tr,yField:DA,seriesField:e||Tr,tooltip:C({fields:Ku},a),state:typeof o=="object"?o.state:{},point:{color:i,size:1,style:{fill:"white",lineWidth:0}}}}),l.geometries[0].adjust(Qu),u.axis(!1),s.axis(!1),l.axis(!1),l.legend(!1),s.legend(!1),u.legend(!1),r}function $8(r){var n,t=r.chart,e=r.options,i=e.meta,a=e.xAxis,o=e.yAxis,s={},u=N(s,i,(n={},n[Tr]=C(C({sync:!0},Nt(a,tr)),{type:"cat"}),n[Gi]=C({sync:!0},Nt(o,tr)),n[RA]=C({sync:Gi},Nt(o,tr)),n[IA]=C({sync:Gi},Nt(o,tr)),n[DA]=C({sync:Gi},Nt(o,tr)),n));return t.scale(u),r}function G8(r){var n=r.chart,t=r.options,e=t.xAxis,i=t.yAxis,a=Et(n,Np);return e===!1?a.axis(Tr,!1):a.axis(Tr,e),i===!1?a.axis(Gi,!1):a.axis(Gi,i),n.axis(!1),r}function V8(r){var n=r.chart,t=r.options,e=t.legend,i=t.seriesField,a=t.shape;if(e===!1)n.legend(!1);else{var o=i||Tr,s=Bl(e,["selected"]);(!a||!a.startsWith("hollow"))&&(F(s,["marker","style","lineWidth"])||he(s,["marker","style","lineWidth"],0)),n.legend(o,s),F(e,"selected")&&w(n.views,function(u){return u.legend(o,e)})}return r}function W8(r){var n=r.chart,t=Et(n,Np);return ne()(C(C({},r),{chart:t})),r}function j8(r){var n=r.chart,t=r.options,e=t.animation;return w(n.views,function(i){typeof e=="boolean"?i.animate(e):i.animate(!0),w(i.geometries,function(a){a.animate(e)})}),r}function X8(r){return ht(Ot,z8,U8,H8,$8,me,G8,V8,Qt,W8,j8)(r)}(function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.type="violin",t}return n.getDefaultOptions=function(){return N8},n.prototype.changeData=function(t){this.updateOption({data:t}),this.chart.changeData(OA(this.options))},n.prototype.getDefaultOptions=function(){return n.getDefaultOptions()},n.prototype.getSchemaAdaptor=function(){return X8},n})(yt);var Y8=function(r){return function(n,t){var e=[];return e[0]=r(n[0],t[0]),e[1]=r(n[1],t[1]),e[2]=r(n[2],t[2]),e}},ey={normal:function(r){return r},multiply:function(r,n){return r*n/255},screen:function(r,n){return 255*(1-(1-r/255)*(1-n/255))},overlay:function(r,n){return n<128?2*r*n/255:255*(1-2*(1-r/255)*(1-n/255))},darken:function(r,n){return r>n?n:r},lighten:function(r,n){return r>n?r:n},dodge:function(r,n){return r===255?255:(r=255*(n/255)/(1-r/255),r>255?255:r)},burn:function(r,n){return n===255?255:r===0?0:255*(1-Math.min(1,(1-n/255)/(r/255)))}},Z8=function(r){if(!ey[r])throw new Error("unknown blend mode "+r);return ey[r]};function q8(r,n,t){t===void 0&&(t="normal");var e=Y8(Z8(t))(Mu(r),Mu(n)),i=Mu(r),a=i[0],o=i[1],s=i[2],u=i[3],l=Mu(n),c=l[0],f=l[1],h=l[2],v=l[3],p=Number((u+v*(1-u)).toFixed(2)),d=Math.round((u*(1-v)*(a/255)+u*v*(e[0]/255)+(1-u)*v*(c/255))/p*255),g=Math.round((u*(1-v)*(o/255)+u*v*(e[1]/255)+(1-u)*v*(f/255))/p*255),y=Math.round((u*(1-v)*(s/255)+u*v*(e[2]/255)+(1-u)*v*(h/255))/p*255);return"rgba("+d+", "+g+", "+y+", "+p+")"}function Mu(r){var n=r.replace("/s+/g",""),t;return typeof n=="string"&&!n.startsWith("rgba")&&!n.startsWith("#")?t=ii.rgb2arr(ii.toRGB(n)).concat([1]):(n.startsWith("rgba")&&(t=n.replace("rgba(","").replace(")","").split(",")),n.startsWith("#")&&(t=ii.rgb2arr(n).concat([1])),t.map(function(e,i){return i===3?Number(e):e|0}))}var PA=1e-10;function zp(r,n){var t=Q8(r),e=t.filter(function(M){return K8(M,r)}),i=0,a=0,o,s=[];if(e.length>1){var u=zA(e);for(o=0;o<e.length;++o){var l=e[o];l.angle=Math.atan2(l.x-u.x,l.y-u.y)}e.sort(function(M,T){return T.angle-M.angle});var c=e[e.length-1];for(o=0;o<e.length;++o){var f=e[o];a+=(c.x+f.x)*(f.y-c.y);for(var h={x:(f.x+c.x)/2,y:(f.y+c.y)/2},v=null,p=0;p<f.parentIndex.length;++p)if(c.parentIndex.indexOf(f.parentIndex[p])>-1){var d=r[f.parentIndex[p]],g=Math.atan2(f.x-d.x,f.y-d.y),y=Math.atan2(c.x-d.x,c.y-d.y),m=y-g;m<0&&(m+=2*Math.PI);var x=y-m/2,_=Xr(h,{x:d.x+d.radius*Math.sin(x),y:d.y+d.radius*Math.cos(x)});_>d.radius*2&&(_=d.radius*2),(v===null||v.width>_)&&(v={circle:d,width:_,p1:f,p2:c})}v!==null&&(s.push(v),i+=Oh(v.circle.radius,v.width),c=f)}}else{var E=r[0];for(o=1;o<r.length;++o)r[o].radius<E.radius&&(E=r[o]);var b=!1;for(o=0;o<r.length;++o)if(Xr(r[o],E)>Math.abs(E.radius-r[o].radius)){b=!0;break}b?i=a=0:(i=E.radius*E.radius*Math.PI,s.push({circle:E,p1:{x:E.x,y:E.y+E.radius},p2:{x:E.x-PA,y:E.y+E.radius},width:E.radius*2}))}return a/=2,n&&(n.area=i+a,n.arcArea=i,n.polygonArea=a,n.arcs=s,n.innerPoints=e,n.intersectionPoints=t),i+a}function K8(r,n){for(var t=0;t<n.length;++t)if(Xr(r,n[t])>n[t].radius+PA)return!1;return!0}function Q8(r){for(var n=[],t=0;t<r.length;++t)for(var e=t+1;e<r.length;++e)for(var i=NA(r[t],r[e]),a=0;a<i.length;++a){var o=i[a];o.parentIndex=[t,e],n.push(o)}return n}function Oh(r,n){return r*r*Math.acos(1-n/r)-(r-n)*Math.sqrt(n*(2*r-n))}function Xr(r,n){return Math.sqrt((r.x-n.x)*(r.x-n.x)+(r.y-n.y)*(r.y-n.y))}function BA(r,n,t){if(t>=r+n)return 0;if(t<=Math.abs(r-n))return Math.PI*Math.min(r,n)*Math.min(r,n);var e=r-(t*t-n*n+r*r)/(2*t),i=n-(t*t-r*r+n*n)/(2*t);return Oh(r,e)+Oh(n,i)}function NA(r,n){var t=Xr(r,n),e=r.radius,i=n.radius;if(t>=e+i||t<=Math.abs(e-i))return[];var a=(e*e-i*i+t*t)/(2*t),o=Math.sqrt(e*e-a*a),s=r.x+a*(n.x-r.x)/t,u=r.y+a*(n.y-r.y)/t,l=-(n.y-r.y)*(o/t),c=-(n.x-r.x)*(o/t);return[{x:s+l,y:u-c},{x:s-l,y:u+c}]}function zA(r){for(var n={x:0,y:0},t=0;t<r.length;++t)n.x+=r[t].x,n.y+=r[t].y;return n.x/=r.length,n.y/=r.length,n}function J8(r,n){n=n||{},n.maxIterations=n.maxIterations||500;var t=n.initialLayout||n6,e=n.lossFunction||Up;r=t6(r);var i=t(r,n),a=[],o=[],s;for(s in i)i.hasOwnProperty(s)&&(a.push(i[s].x),a.push(i[s].y),o.push(s));for(var u=YC(function(f){for(var h={},v=0;v<o.length;++v){var p=o[v];h[p]={x:f[2*v],y:f[2*v+1],radius:i[p].radius}}return e(h,r)},a,n),l=u.x,c=0;c<o.length;++c)s=o[c],i[s].x=l[2*c],i[s].y=l[2*c+1];return i}var UA=1e-10;function Rh(r,n,t){return Math.min(r,n)*Math.min(r,n)*Math.PI<=t+UA?Math.abs(r-n):FM(function(e){return BA(r,n,e)-t},0,r+n)}function t6(r){r=r.slice();var n=[],t={},e,i,a,o;for(e=0;e<r.length;++e){var s=r[e];s.sets.length==1?n.push(s.sets[0]):s.sets.length==2&&(a=s.sets[0],o=s.sets[1],t[[a,o]]=!0,t[[o,a]]=!0)}for(n.sort(function(u,l){return u>l?1:-1}),e=0;e<n.length;++e)for(a=n[e],i=e+1;i<n.length;++i)o=n[i],[a,o]in t||r.push({sets:[a,o],size:0});return r}function e6(r,n,t){var e=kd(n.length,n.length),i=kd(n.length,n.length);return r.filter(function(a){return a.sets.length==2}).map(function(a){var o=t[a.sets[0]],s=t[a.sets[1]],u=Math.sqrt(n[o].size/Math.PI),l=Math.sqrt(n[s].size/Math.PI),c=Rh(u,l,a.size);e[o][s]=e[s][o]=c;var f=0;a.size+1e-10>=Math.min(n[o].size,n[s].size)?f=1:a.size<=1e-10&&(f=-1),i[o][s]=i[s][o]=f}),{distances:e,constraints:i}}function r6(r,n,t,e){var i=0,a;for(a=0;a<n.length;++a)n[a]=0;for(a=0;a<t.length;++a)for(var o=r[2*a],s=r[2*a+1],u=a+1;u<t.length;++u){var l=r[2*u],c=r[2*u+1],f=t[a][u],h=e[a][u],v=(l-o)*(l-o)+(c-s)*(c-s),p=Math.sqrt(v),d=v-f*f;h>0&&p<=f||h<0&&p>=f||(i+=2*d*d,n[2*a]+=4*d*(o-l),n[2*a+1]+=4*d*(s-c),n[2*u]+=4*d*(l-o),n[2*u+1]+=4*d*(c-s))}return i}function n6(r,n){var t=a6(r,n),e=n.lossFunction||Up;if(r.length>=8){var i=i6(r,n),a=e(i,r),o=e(t,r);a+1e-8<o&&(t=i)}return t}function i6(r,n){n=n||{};var t=n.restarts||10,e=[],i={},a;for(a=0;a<r.length;++a){var o=r[a];o.sets.length==1&&(i[o.sets[0]]=e.length,e.push(o))}var s=e6(r,e,i),u=s.distances,l=s.constraints,c=Fd(u.map(Fd))/u.length;u=u.map(function(m){return m.map(function(x){return x/c})});var f=function(m,x){return r6(m,x,u,l)},h,v;for(a=0;a<t;++a){var p=MM(u.length*2).map(Math.random);v=wM(f,p,n),(!h||v.fx<h.fx)&&(h=v)}var d=h.x,g={};for(a=0;a<e.length;++a){var y=e[a];g[y.sets[0]]={x:d[2*a]*c,y:d[2*a+1]*c,radius:Math.sqrt(y.size/Math.PI)}}if(n.history)for(a=0;a<n.history.length;++a)LM(n.history[a].x,c);return g}function a6(r,n){for(var t=n&&n.lossFunction?n.lossFunction:Up,e={},i={},a,o=0;o<r.length;++o){var s=r[o];s.sets.length==1&&(a=s.sets[0],e[a]={x:1e10,y:1e10,rowid:Object.keys(e).length,size:s.size,radius:Math.sqrt(s.size/Math.PI)},i[a]=[])}r=r.filter(function(z){return z.sets.length==2});for(var o=0;o<r.length;++o){var u=r[o],l=u.hasOwnProperty("weight")?u.weight:1,c=u.sets[0],f=u.sets[1];u.size+UA>=Math.min(e[c].size,e[f].size)&&(l=0),i[c].push({set:f,size:u.size,weight:l}),i[f].push({set:c,size:u.size,weight:l})}var h=[];for(a in i)if(i.hasOwnProperty(a)){for(var v=0,o=0;o<i[a].length;++o)v+=i[a][o].size*i[a][o].weight;h.push({set:a,size:v})}function p(z,X){return X.size-z.size}h.sort(p);var d={};function g(z){return z.set in d}function y(z,X){e[X].x=z.x,e[X].y=z.y,d[X]=!0}y({x:0,y:0},h[0].set);for(var o=1;o<h.length;++o){var m=h[o].set,x=i[m].filter(g);if(a=e[m],x.sort(p),x.length===0)throw"ERROR: missing pairwise overlap information";for(var _=[],E=0;E<x.length;++E){var b=e[x[E].set],M=Rh(a.radius,b.radius,x[E].size);_.push({x:b.x+M,y:b.y}),_.push({x:b.x-M,y:b.y}),_.push({y:b.y+M,x:b.x}),_.push({y:b.y-M,x:b.x});for(var T=E+1;T<x.length;++T)for(var k=e[x[T].set],L=Rh(a.radius,k.radius,x[T].size),O=NA({x:b.x,y:b.y,radius:M},{x:k.x,y:k.y,radius:L}),D=0;D<O.length;++D)_.push(O[D])}for(var W=1e50,j=_[0],E=0;E<_.length;++E){e[m].x=_[E].x,e[m].y=_[E].y;var ot=t(e,r);ot<W&&(W=ot,j=_[E])}y(j,m)}return e}function Up(r,n){var t=0;function e(c){return c.map(function(f){return r[f]})}for(var i=0;i<n.length;++i){var a=n[i],o=void 0;if(a.sets.length!=1){if(a.sets.length==2){var s=r[a.sets[0]],u=r[a.sets[1]];o=BA(s.radius,u.radius,Xr(s,u))}else o=zp(e(a.sets));var l=a.hasOwnProperty("weight")?a.weight:1;t+=l*(o-a.size)*(o-a.size)}}return t}function o6(r){var n=function(t){var e=Math.max.apply(null,r.map(function(a){return a[t]+a.radius})),i=Math.min.apply(null,r.map(function(a){return a[t]-a.radius}));return{max:e,min:i}};return{xRange:n("x"),yRange:n("y")}}function s6(r,n,t,e){var i=[],a=[];for(var o in r)r.hasOwnProperty(o)&&(a.push(o),i.push(r[o]));n-=2*e,t-=2*e;var s=o6(i),u=s.xRange,l=s.yRange;if(u.max==u.min||l.max==l.min)return console.log("not scaling solution: zero size detected"),r;for(var c=n/(u.max-u.min),f=t/(l.max-l.min),h=Math.min(f,c),v=(n-(u.max-u.min)*h)/2,p=(t-(l.max-l.min)*h)/2,d={},g=0;g<i.length;++g){var y=i[g];d[a[g]]={radius:h*y.radius,x:e+v+(y.x-u.min)*h,y:e+p+(y.y-l.min)*h}}return d}function pf(r,n,t){var e=n[0].radius-Xr(n[0],r),i,a;for(i=1;i<n.length;++i)a=n[i].radius-Xr(n[i],r),a<=e&&(e=a);for(i=0;i<t.length;++i)a=Xr(t[i],r)-t[i].radius,a<=e&&(e=a);return e}function HA(r,n){var t=[],e;for(e=0;e<r.length;++e){var i=r[e];t.push({x:i.x,y:i.y}),t.push({x:i.x+i.radius/2,y:i.y}),t.push({x:i.x-i.radius/2,y:i.y}),t.push({x:i.x,y:i.y+i.radius/2}),t.push({x:i.x,y:i.y-i.radius/2})}var a=t[0],o=pf(t[0],r,n);for(e=1;e<t.length;++e){var s=pf(t[e],r,n);s>=o&&(a=t[e],o=s)}var u=YC(function(h){return-1*pf({x:h[0],y:h[1]},r,n)},[a.x,a.y],{maxIterations:500,minErrorDelta:1e-10}).x,l={x:u[0],y:u[1]},c=!0;for(e=0;e<r.length;++e)if(Xr(l,r[e])>r[e].radius){c=!1;break}for(e=0;e<n.length;++e)if(Xr(l,n[e])<n[e].radius){c=!1;break}if(!c)if(r.length==1)l={x:r[0].x,y:r[0].y};else{var f={};zp(r,f),f.arcs.length===0?l={x:0,y:-1e3,disjoint:!0}:f.arcs.length==1?l={x:f.arcs[0].circle.x,y:f.arcs[0].circle.y}:n.length?l=HA(r,[]):l=zA(f.arcs.map(function(h){return h.p1}))}return l}function u6(r){var n={},t=[];for(var e in r)t.push(e),n[e]=[];for(var i=0;i<t.length;i++)for(var a=r[t[i]],o=i+1;o<t.length;++o){var s=r[t[o]],u=Xr(a,s);u+s.radius<=a.radius+1e-10?n[t[o]].push(t[i]):u+a.radius<=s.radius+1e-10&&n[t[i]].push(t[o])}return n}function l6(r,n){for(var t={},e=u6(r),i=0;i<n.length;++i){for(var a=n[i].sets,o={},s={},u=0;u<a.length;++u){o[a[u]]=!0;for(var l=e[a[u]],c=0;c<l.length;++c)s[l[c]]=!0}var f=[],h=[];for(var v in r)v in o?f.push(r[v]):v in s||h.push(r[v]);var p=HA(f,h);t[a]=p,p.disjoint&&n[i].size>0&&console.log("WARNING: area "+a+" not represented on screen")}return t}function c6(r,n,t){var e=[],i=r-t,a=n;return e.push("M",i,a),e.push("A",t,t,0,1,0,i+2*t,a),e.push("A",t,t,0,1,0,i,a),e.join(" ")}function f6(r){var n={};zp(r,n);var t=n.arcs;if(t.length===0)return"M 0 0";if(t.length==1){var e=t[0].circle;return c6(e.x,e.y,e.radius)}else{for(var i=[`
M`,t[0].p2.x,t[0].p2.y],a=0;a<t.length;++a){var o=t[a],s=o.circle.radius,u=o.width>s;i.push(`
A`,s,s,0,u?1:0,1,o.p1.x,o.p1.y)}return i.join(" ")}}var Ln="id",Ih="path",h6={appendPadding:[10,0,20,0],blendMode:"multiply",tooltip:{showTitle:!1,showMarkers:!1,fields:["id","size"],formatter:function(r){return{name:r.id,value:r.size}}},legend:{position:"top-left"},label:{style:{textAlign:"center",fill:"#fff"}},interactions:[{type:"legend-filter",enable:!1}],state:{active:{style:{stroke:"#000"}},selected:{style:{stroke:"#000",lineWidth:2}},inactive:{style:{fillOpacity:.3,strokeOpacity:.3}}},defaultInteractions:["tooltip","venn-legend-active"]},v6=so(function(r,n,t,e){var i=new Map,a=r.length;return n.forEach(function(o,s){if(o[e].length===1)i.set(o[Ln],r[(s+a)%a]);else{var u=o[e].map(function(l){return i.get(l)});i.set(o[Ln],u.slice(1).reduce(function(l,c){return q8(l,c,t)},u[0]))}}),i},function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];return JSON.stringify(r)});function p6(r,n,t,e){e===void 0&&(e=0);var i=r.data,a=r.setsField,o=r.sizeField;if(i.length===0)return In(qr.WARN,!1,"warn: %s","\u6570\u636E\u4E0D\u80FD\u4E3A\u7A7A"),[];var s=i.map(function(f){var h;return C(C({},f),(h={sets:f[a]||[],size:f[o]},h[Ih]="",h[Ln]="",h))});s.sort(function(f,h){return f.sets.length-h.sets.length});var u=J8(s),l=s6(u,n,t,e),c=l6(l,s);return s.forEach(function(f){var h=f.sets,v=h.join(",");f[Ln]=v;var p=h.map(function(y){return l[y]}),d=f6(p);/[zZ]$/.test(d)||(d+=" Z"),f[Ih]=d;var g=c[v]||{x:0,y:0};zt(f,g)}),s}function d6(r,n){for(var t=0;t<n.length;t++)if(!r.includes(n[t]))return!1;return!0}function g6(r){return N({},r.defaultStyle,{fill:r.color},r.style)}Pt("schema","venn",{draw:function(r,n){var t=r.data,e=Rv(t[Ih]),i=g6(r),a=n.addGroup({name:"venn-shape"});a.addShape("path",{attrs:C(C({},i),{path:e}),name:"venn-path"});var o=r.customInfo,s=o.offsetX,u=o.offsetY,l=ir.transform(null,[["t",s,u]]);return a.setMatrix(l),a},getMarker:function(r){var n=r.color;return{symbol:"circle",style:{lineWidth:0,stroke:n,fill:n,r:4}}}});var y6=function(r){R(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.getLabelPoint=function(t,e,i){var a=t.data,o=a.x,s=a.y,u=t.customLabelInfo,l=u.offsetX,c=u.offsetY;return{content:t.content[i],x:o+l,y:s+c}},n}(cc);Gs("venn",y6);function Ec(r){if(!!r){var n=r.geometries[0].elements;n.forEach(function(t){t.shape.toFront()})}}var m6=uc("element-active"),x6=function(r){R(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.syncElementsPos=function(){Ec(this.context.view)},n.prototype.active=function(){r.prototype.active.call(this),this.syncElementsPos()},n.prototype.toggle=function(){r.prototype.toggle.call(this),this.syncElementsPos()},n.prototype.reset=function(){r.prototype.reset.call(this),this.syncElementsPos()},n}(m6),_6=uc("element-highlight"),C6=function(r){R(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.syncElementsPos=function(){Ec(this.context.view)},n.prototype.highlight=function(){r.prototype.highlight.call(this),this.syncElementsPos()},n.prototype.toggle=function(){r.prototype.toggle.call(this),this.syncElementsPos()},n.prototype.clear=function(){r.prototype.clear.call(this),this.syncElementsPos()},n.prototype.reset=function(){r.prototype.reset.call(this),this.syncElementsPos()},n}(_6),E6=uc("element-selected"),S6=uc("element-single-selected"),b6=function(r){R(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.syncElementsPos=function(){Ec(this.context.view)},n.prototype.selected=function(){r.prototype.selected.call(this),this.syncElementsPos()},n.prototype.toggle=function(){r.prototype.toggle.call(this),this.syncElementsPos()},n.prototype.reset=function(){r.prototype.reset.call(this),this.syncElementsPos()},n}(E6),A6=function(r){R(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.syncElementsPos=function(){Ec(this.context.view)},n.prototype.selected=function(){r.prototype.selected.call(this),this.syncElementsPos()},n.prototype.toggle=function(){r.prototype.toggle.call(this),this.syncElementsPos()},n.prototype.reset=function(){r.prototype.reset.call(this),this.syncElementsPos()},n}(S6);ct("venn-element-active",x6);ct("venn-element-highlight",C6);ct("venn-element-selected",b6);ct("venn-element-single-selected",A6);gt("venn-element-active",{start:[{trigger:"element:mouseenter",action:"venn-element-active:active"}],end:[{trigger:"element:mouseleave",action:"venn-element-active:reset"}]});gt("venn-element-highlight",{start:[{trigger:"element:mouseenter",action:"venn-element-highlight:highlight"}],end:[{trigger:"element:mouseleave",action:"venn-element-highlight:reset"}]});gt("venn-element-selected",{start:[{trigger:"element:click",action:"venn-element-selected:toggle"}],rollback:[{trigger:"dblclick",action:["venn-element-selected:reset"]}]});gt("venn-element-single-selected",{start:[{trigger:"element:click",action:"venn-element-single-selected:toggle"}],rollback:[{trigger:"dblclick",action:["venn-element-single-selected:reset"]}]});gt("venn-legend-active",{start:[{trigger:"legend-item:mouseenter",action:["list-active:active","venn-element-active:active"]}],end:[{trigger:"legend-item:mouseleave",action:["list-active:reset","venn-element-active:reset"]}]});gt("venn-legend-highlight",{start:[{trigger:"legend-item:mouseenter",action:["legend-item-highlight:highlight","venn-element-highlight:highlight"]}],end:[{trigger:"legend-item:mouseleave",action:["legend-item-highlight:reset","venn-element-highlight:reset"]}]});var T6=40;function $A(r,n,t){var e=r.chart,i=r.options,a=i.blendMode,o=i.setsField,s=e.getTheme(),u=s.colors10,l=s.colors20,c=t;V(c)||(c=n.filter(function(h){return h[o].length===1}).length<=10?u:l);var f=v6(c,n,a,o);return function(h){return f.get(h)||c[0]}}function M6(r,n){var t=r.options,e=t.color;if(typeof e!="function"){var i=typeof e=="string"?[e]:e,a=$A(r,n,i);return function(o){return a(o[Ln])}}return e}function w6(r){var n=r.chart,t=r.options,e=t.legend,i=t.appendPadding,a=t.padding,o=hi(i);return e!==!1&&(o=dc(i,F(e,"position"),T6)),n.appendPadding=Mp([o,a]),r}function L6(r){var n=r.options,t=n.data;t||(In(qr.WARN,!1,"warn: %s","\u6570\u636E\u4E0D\u80FD\u4E3A\u7A7A"),t=[]);var e=t.filter(function(a){return a.sets.length===1}).map(function(a){return a.sets[0]}),i=t.filter(function(a){var o=a.sets;return d6(e,o)});return Dt(i,t)||In(qr.WARN,!1,"warn: %s","\u4EA4\u96C6\u4E2D\u4E0D\u80FD\u51FA\u73B0\u4E0D\u5B58\u5728\u7684\u96C6\u5408, \u8BF7\u8F93\u5165\u5408\u6CD5\u6570\u636E"),J({},r,{options:{data:i}})}function F6(r){var n=r.chart,t=r.options,e=t.pointStyle,i=t.setsField,a=t.sizeField,o=hi(n.appendPadding),s=o[0],u=o[1],l=o[2],c=o[3],f={offsetX:c,offsetY:s},h=n.viewBBox,v=h.width,p=h.height,d=p6(t,Math.max(v-(u+c),0),Math.max(p-(s+l),0),0);n.data(d);var g=Op(N({},r,{options:{xField:"x",yField:"y",sizeField:a,seriesField:Ln,rawFields:[i,a],schema:{shape:"venn",style:e}}})).ext,y=g.geometry;y.customInfo(f);var m=M6(r,d);return typeof m=="function"&&y.color(Ln,function(x){var _=d.find(function(b){return b[Ln]===x}),E=$A(r,d)(x);return m(_,E)}),r}function k6(r){var n=r.chart,t=r.options,e=t.label,i=hi(n.appendPadding),a=i[0],o=i[3],s={offsetX:o,offsetY:a},u=Ie(n,"schema");if(!e)u.label(!1);else{var l=e.callback,c=Tt(e,["callback"]);u.label({fields:["id"],callback:l,cfg:J({},Se(c),{type:"venn",customLabelInfo:s})})}return r}function O6(r){var n=r.chart,t=r.options,e=t.legend,i=t.sizeField;return n.legend(Ln,e),n.legend(i,!1),r}function R6(r){var n=r.chart;return n.axis(!1),r}function I6(r){var n=r.options,t=r.chart,e=n.interactions;if(e){var i={"legend-active":"venn-legend-active","legend-highlight":"venn-legend-highlight"};Qt(N({},r,{options:{interactions:e.map(function(a){return C(C({},a),{type:i[a.type]||a.type})})}}))}return t.removeInteraction("legend-active"),t.removeInteraction("legend-highlight"),r}function D6(r){return ht(w6,Ot,L6,F6,k6,oe({}),O6,R6,me,I6,Ht)(r)}(function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.type="venn",t}return n.getDefaultOptions=function(){return h6},n.prototype.getDefaultOptions=function(){return n.getDefaultOptions()},n.prototype.getSchemaAdaptor=function(){return D6},n.prototype.triggerResize=function(){this.chart.destroyed||(this.chart.forceFit(),this.chart.clear(),this.execAdaptor(),this.chart.render(!0))},n})(yt);var Es="$$stock-range$$",Sc="trend",GA="up",VA="down",P6={showMarkers:!1,showCrosshairs:!0,shared:!0,crosshairs:{type:"xy",follow:!0,text:function(r,n,t){var e;if(r==="x"){var i=t[0];e=i?i.title:n}else e=n;return{position:r==="y"?"start":"end",content:e,style:{fill:"#dfdfdf"}}},textBackground:{padding:[2,4],style:{fill:"#666"}}}},B6=N({},yt.getDefaultOptions(),{tooltip:P6,interactions:[{type:"tooltip"}],legend:{position:"top-left"},risingFill:"#ef5350",fallingFill:"#26a69a"});function WA(r,n){return ie(r,function(t){if(V(n)){var e=n[0],i=n[1],a=n[2],o=n[3];t[Sc]=t[e]<=t[i]?GA:VA,t[Es]=[t[e],t[i],t[a],t[o]]}return t})}function N6(r){var n=r.chart,t=r.options,e=t.yField,i=t.data,a=t.risingFill,o=t.fallingFill,s=t.tooltip,u=t.stockStyle;n.data(WA(i,e));var l=s;return l!==!1&&(l=N({},{fields:e},l)),Op(N({},r,{options:{schema:{shape:"candle",color:[a,o],style:u},yField:Es,seriesField:Sc,rawFields:e,tooltip:l}})),r}function z6(r){var n,t,e=r.chart,i=r.options,a=i.meta,o=i.xAxis,s=i.yAxis,u=i.xField,l=(n={},n[u]={type:"timeCat",tickCount:6},n[Sc]={values:[GA,VA]},n),c=N(l,a,(t={},t[u]=Nt(o,tr),t[Es]=Nt(s,tr),t));return e.scale(c),r}function U6(r){var n=r.chart,t=r.options,e=t.xAxis,i=t.yAxis,a=t.xField;return e===!1?n.axis(a,!1):n.axis(a,e),i===!1?n.axis(Es,!1):n.axis(Es,i),r}function H6(r){var n=r.chart,t=r.options,e=t.tooltip;return e!==!1?n.tooltip(e):n.tooltip(!1),r}function $6(r){var n=r.chart,t=r.options,e=t.legend;return e?n.legend(Sc,e):e===!1&&n.legend(!1),r}function jA(r){ht(Ot,N6,z6,U6,H6,$6,Qt,Ht,ne(),js)(r)}var G6=function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.type="stock",t}return n.getDefaultOptions=function(){return B6},n.prototype.getDefaultOptions=function(){return n.getDefaultOptions()},n.prototype.getSchemaAdaptor=function(){return jA},n.prototype.changeData=function(t){this.updateOption({data:t});var e=this.options.yField;this.chart.changeData(WA(t,e))},n}(yt),df,vi="$$percentage$$",pi="$$mappingValue$$",Fn="$$conversion$$",Dh="$$totalPercentage$$",Ss="$$x$$",bs="$$y$$",V6={appendPadding:[0,80],minSize:0,maxSize:1,meta:(df={},df[pi]={min:0,max:1,nice:!1},df),label:{style:{fill:"#fff",fontSize:12}},tooltip:{showTitle:!1,showMarkers:!1,shared:!1},conversionTag:{offsetX:10,offsetY:0,style:{fontSize:12,fill:"rgba(0,0,0,0.45)"}}};function XA(r,n,t){var e=[],i=t.yField,a=t.maxSize,o=t.minSize,s=F(iE(n,i),[i]),u=dt(a)?a:1,l=dt(o)?o:0;return e=ie(r,function(c,f){var h=(c[i]||0)/s;return c[vi]=h,c[pi]=(u-l)*h+l,c[Fn]=[F(r,[f-1,i]),c[i]],c}),e}function Hp(r){return function(n){var t=n.chart,e=n.options,i=e.conversionTag,a=t.getOptions().data;if(i){var o=i.formatter;a.forEach(function(s,u){if(!(u<=0||Number.isNaN(s[pi]))){var l=r(s,u,a,{top:!0,text:{content:rt(o)?o(s,a):o,offsetX:i.offsetX,offsetY:i.offsetY,position:"end",autoRotate:!1,style:C({textAlign:"start",textBaseline:"middle"},i.style)}});t.annotation().line(l)}})}return n}}function W6(r){var n=r.chart,t=r.options,e=t.data,i=e===void 0?[]:e,a=t.yField,o=t.maxSize,s=t.minSize,u=XA(i,i,{yField:a,maxSize:o,minSize:s});return n.data(u),r}function j6(r){var n=r.chart,t=r.options,e=t.xField,i=t.yField,a=t.color,o=t.tooltip,s=t.label,u=t.shape,l=u===void 0?"funnel":u,c=t.funnelStyle,f=t.state,h=Br(o,[e,i]),v=h.fields,p=h.formatter;or({chart:n,options:{type:"interval",xField:e,yField:pi,colorField:e,tooltipFields:V(v)&&v.concat([vi,Fn]),mapping:{shape:l,tooltip:p,color:a,style:c},label:s,state:f}});var d=Ie(r.chart,"interval");return d.adjust("symmetric"),r}function X6(r){var n=r.chart,t=r.options,e=t.isTransposed;return n.coordinate({type:"rect",actions:e?[]:[["transpose"],["scale",1,-1]]}),r}function Y6(r){var n=r.options,t=n.maxSize,e=function(i,a,o,s){var u=t-(t-i[pi])/2;return C(C({},s),{start:[a-.5,u],end:[a-.5,u+.05]})};return Hp(e)(r),r}function YA(r){return ht(W6,j6,X6,Y6)(r)}function Z6(r){var n,t=r.chart,e=r.options,i=e.data,a=i===void 0?[]:i,o=e.yField;return t.data(a),t.scale((n={},n[o]={sync:!0},n)),r}function q6(r){var n=r.chart,t=r.options,e=t.data,i=t.xField,a=t.yField,o=t.color,s=t.compareField,u=t.isTransposed,l=t.tooltip,c=t.maxSize,f=t.minSize,h=t.label,v=t.funnelStyle,p=t.state,d=t.showFacetTitle;return n.facet("mirror",{fields:[s],transpose:!u,padding:u?0:[32,0,0,0],showTitle:d,eachView:function(g,y){var m=u?y.rowIndex:y.columnIndex;u||g.coordinate({type:"rect",actions:[["transpose"],["scale",m===0?-1:1,-1]]});var x=XA(y.data,e,{yField:a,maxSize:c,minSize:f});g.data(x);var _=Br(l,[i,a,s]),E=_.fields,b=_.formatter,M=u?{offset:m===0?10:-23,position:m===0?"bottom":"top"}:{offset:10,position:"left",style:{textAlign:m===0?"end":"start"}};or({chart:g,options:{type:"interval",xField:i,yField:pi,colorField:i,tooltipFields:V(E)&&E.concat([vi,Fn]),mapping:{shape:"funnel",tooltip:b,color:o,style:v},label:h===!1?!1:N({},M,h),state:p}})}}),r}function K6(r){var n=r.chart,t=r.options,e=t.conversionTag,i=t.isTransposed;return n.once("beforepaint",function(){n.views.forEach(function(a,o){var s=function(u,l,c,f){var h=o===0?-1:1;return N({},f,{start:[l-.5,u[pi]],end:[l-.5,u[pi]+.05],text:i?{style:{textAlign:"start"}}:{offsetX:e!==!1?h*e.offsetX:0,style:{textAlign:o===0?"end":"start"}}})};Hp(s)(N({},{chart:a,options:t}))})}),r}function Q6(r){return ht(Z6,q6,K6)(r)}function J6(r){var n,t=r.chart,e=r.options,i=e.data,a=i===void 0?[]:i,o=e.yField;return t.data(a),t.scale((n={},n[o]={sync:!0},n)),r}function tN(r){var n=r.chart,t=r.options,e=t.seriesField,i=t.isTransposed,a=t.showFacetTitle;return n.facet("rect",{fields:[e],padding:[i?0:32,10,0,10],showTitle:a,eachView:function(o,s){YA(N({},r,{chart:o,options:{data:s.data}}))}}),r}function eN(r){return ht(J6,tN)(r)}function rN(r){var n=r.chart,t=r.options,e=t.data,i=e===void 0?[]:e,a=t.yField,o=ze(i,function(l,c){return l+(c[a]||0)},0),s=iE(i,a)[a],u=ie(i,function(l,c){var f=[],h=[];if(l[Dh]=(l[a]||0)/o,c){var v=i[c-1][Ss],p=i[c-1][bs];f[0]=v[3],h[0]=p[3],f[1]=v[2],h[1]=p[2]}else f[0]=-.5,h[0]=1,f[1]=.5,h[1]=1;return h[2]=h[1]-l[Dh],f[2]=(h[2]+1)/4,h[3]=h[2],f[3]=-f[2],l[Ss]=f,l[bs]=h,l[vi]=(l[a]||0)/s,l[Fn]=[F(i,[c-1,a]),l[a]],l});return n.data(u),r}function nN(r){var n=r.chart,t=r.options,e=t.xField,i=t.yField,a=t.color,o=t.tooltip,s=t.label,u=t.funnelStyle,l=t.state,c=Br(o,[e,i]),f=c.fields,h=c.formatter;return or({chart:n,options:{type:"polygon",xField:Ss,yField:bs,colorField:e,tooltipFields:V(f)&&f.concat([vi,Fn]),label:s,state:l,mapping:{tooltip:h,color:a,style:u}}}),r}function iN(r){var n=r.chart,t=r.options,e=t.isTransposed;return n.coordinate({type:"rect",actions:e?[["transpose"],["reflect","x"]]:[]}),r}function aN(r){var n=function(t,e,i,a){return C(C({},a),{start:[t[Ss][1],t[bs][1]],end:[t[Ss][1]+.05,t[bs][1]]})};return Hp(n)(r),r}function oN(r){return ht(rN,nN,iN,aN)(r)}function sN(r){var n=r.options,t=n.compareField,e=n.xField,i=n.yField,a=n.locale,o=n.funnelStyle,s=n.data,u=gc(a),l={label:t?{fields:[e,i,t,vi,Fn],formatter:function(f){return""+f[i]}}:{fields:[e,i,vi,Fn],offset:0,position:"middle",formatter:function(f){return f[e]+" "+f[i]}},tooltip:{title:e,formatter:function(f){return{name:f[e],value:f[i]}}},conversionTag:{formatter:function(f){return u.get(["conversionTag","label"])+": "+iA.apply(void 0,f[Fn])}}},c;return(t||o)&&(c=function(f){return N({},t&&{lineWidth:1,stroke:"#fff"},rt(o)?o(f):o)}),N({options:l},r,{options:{funnelStyle:c,data:Ve(s)}})}function uN(r){var n=r.options,t=n.compareField,e=n.dynamicHeight,i=n.seriesField;return i?eN(r):t?Q6(r):e?oN(r):YA(r)}function lN(r){var n,t=r.options,e=t.xAxis,i=t.yAxis,a=t.xField,o=t.yField;return ht(oe((n={},n[a]=e,n[o]=i,n)))(r)}function cN(r){var n=r.chart;return n.axis(!1),r}function fN(r){var n=r.chart,t=r.options,e=t.legend;return e===!1?n.legend(!1):n.legend(e),r}function ZA(r){return ht(sN,uN,lN,cN,me,Qt,fN,Ht,Ot,ne())(r)}var hN=function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.type="funnel",t}return n.getDefaultOptions=function(){return V6},n.prototype.getDefaultOptions=function(){return n.getDefaultOptions()},n.prototype.getSchemaAdaptor=function(){return ZA},n.prototype.setState=function(t,e,i){i===void 0&&(i=!0);var a=xs(this.chart);w(a,function(o){e(o.getData())&&o.setState(t,i)})},n.prototype.getStates=function(){var t=xs(this.chart),e=[];return w(t,function(i){var a=i.getData(),o=i.getStates();w(o,function(s){e.push({data:a,state:s,geometry:i.geometry,element:i})})}),e},n.CONVERSATION_FIELD=Fn,n.PERCENT_FIELD=vi,n.TOTAL_PERCENT_FIELD=Dh,n}(yt),vN="liquid";function qA(r){return[{percent:r,type:vN}]}function pN(r){var n=r.chart,t=r.options,e=t.percent,i=t.liquidStyle,a=t.radius,o=t.outline,s=t.wave,u=t.shape,l=t.animation;n.scale({percent:{min:0,max:1}}),n.data(qA(e));var c=t.color||n.getTheme().defaultColor,f=N({},r,{options:{xField:"type",yField:"percent",widthRatio:a,interval:{color:c,style:i,shape:"liquid-fill-gauge"}}}),h=De(f).ext,v=h.geometry,p=n.getTheme().background,d={radius:a,outline:o,wave:s,shape:u,background:p,animation:l};return v.customInfo(d),n.legend(!1),n.axis(!1),n.tooltip(!1),r}function KA(r,n){var t=r.chart,e=r.options,i=e.statistic,a=e.percent,o=e.meta;t.getController("annotation").clear(!0);var s=F(o,["percent","formatter"])||function(l){return(l*100).toFixed(2)+"%"},u=i.content;return u&&(u=N({},u,{content:G(u.content)?s(a):u.content})),pc(t,{statistic:C(C({},i),{content:u}),plotType:"liquid"},{percent:a}),n&&t.render(!0),r}function dN(r){return ht(Ot,xr("liquidStyle"),pN,KA,oe({}),Ht,Qt)(r)}var gN={radius:.9,statistic:{title:!1,content:{style:{opacity:.75,fontSize:"30px",lineHeight:"30px",textAlign:"center"}}},outline:{border:2,distance:0},wave:{count:3,length:192},shape:"circle"},ry=5e3;function ny(r,n,t){return r+(n-r)*t}function yN(r){var n=C({opacity:1},r.style);return r.color&&!n.fill&&(n.fill=r.color),n}function mN(r){var n={fill:"#fff",fillOpacity:0,lineWidth:4},t=zt({},n,r.style);return r.color&&!t.stroke&&(t.stroke=r.color),dt(r.opacity)&&(t.opacity=t.strokeOpacity=r.opacity),t}function xN(r,n,t,e){return n===0?[[r+1/2*t/Math.PI/2,e/2],[r+1/2*t/Math.PI,e],[r+t/4,e]]:n===1?[[r+1/2*t/Math.PI/2*(Math.PI-2),e],[r+1/2*t/Math.PI/2*(Math.PI-1),e/2],[r+t/4,0]]:n===2?[[r+1/2*t/Math.PI/2,-e/2],[r+1/2*t/Math.PI,-e],[r+t/4,-e]]:[[r+1/2*t/Math.PI/2*(Math.PI-2),-e],[r+1/2*t/Math.PI/2*(Math.PI-1),-e/2],[r+t/4,0]]}function _N(r,n,t,e,i,a,o){for(var s=Math.ceil(2*r/t*4)*4,u=[],l=e;l<-Math.PI*2;)l+=Math.PI*2;for(;l>0;)l-=Math.PI*2;l=l/Math.PI/2*t;var c=a-r+l-r*2;u.push(["M",c,n]);for(var f=0,h=0;h<s;++h){var v=h%4,p=xN(h*t/4,v,t,i);u.push(["C",p[0][0]+c,-p[0][1]+n,p[1][0]+c,-p[1][1]+n,p[2][0]+c,-p[2][1]+n]),h===s-1&&(f=p[2][0])}return u.push(["L",f+c,o+r]),u.push(["L",c,o+r]),u.push(["Z"]),u}function CN(r,n,t,e,i,a,o,s,u,l){for(var c=i.fill,f=i.opacity,h=o.getBBox(),v=h.maxX-h.minX,p=h.maxY-h.minY,d=0;d<e;d++){var g=e<=1?0:d/(e-1),y=a.addShape("path",{name:"waterwave-path",attrs:{path:_N(s,h.minY+p*t,u,0,v/32,r,n),fill:c,opacity:ny(.2,.9,g)*f}});try{if(l===!1)return;var m=Fh([["t",u,0]]);y.stopAnimate(),y.animate({matrix:m},{duration:ny(.5*ry,ry,g),repeat:!0})}catch{console.warn("off-screen group animate error!")}}}function EN(r,n,t,e){var i=t*2/3,a=Math.max(i,e),o=i/2,s=r,u=o+n-a/2,l=Math.asin(o/((a-o)*.85)),c=Math.sin(l)*o,f=Math.cos(l)*o,h=s-f,v=u+c,p=r,d=u+o/Math.sin(l);return`
      M `+h+" "+v+`
      A `+o+" "+o+" 0 1 1 "+(h+f*2)+" "+v+`
      Q `+p+" "+d+" "+r+" "+(n+a/2)+`
      Q `+p+" "+d+" "+h+" "+v+`
      Z 
    `}function SN(r,n,t,e){var i=t/2,a=e/2;return`
      M `+r+" "+(n-a)+` 
      a `+i+" "+a+" 0 1 0 0 "+a*2+`
      a `+i+" "+a+" 0 1 0 0 "+-a*2+`
      Z
    `}function bN(r,n,t,e){var i=e/2,a=t/2;return`
      M `+r+" "+(n-i)+`
      L `+(r+a)+" "+n+`
      L `+r+" "+(n+i)+`
      L `+(r-a)+" "+n+`
      Z
    `}function AN(r,n,t,e){var i=e/2,a=t/2;return`
      M `+r+" "+(n-i)+`
      L `+(r+a)+" "+(n+i)+`
      L `+(r-a)+" "+(n+i)+`
      Z
    `}function TN(r,n,t,e){var i=.618,a=e/2,o=t/2*i;return`
      M `+(r-o)+" "+(n-a)+`
      L `+(r+o)+" "+(n-a)+`
      L `+(r+o)+" "+(n+a)+`
      L `+(r-o)+" "+(n+a)+`
      Z
    `}var iy={pin:EN,circle:SN,diamond:bN,triangle:AN,rect:TN};Pt("interval","liquid-fill-gauge",{draw:function(r,n){var t=.5,e=.5,i=r.customInfo,a=i,o=a.radius,s=a.shape,u=a.background,l=a.animation,c=i.outline,f=i.wave,h=c.border,v=c.distance,p=f.count,d=f.length,g=ze(r.points,function(D,W){return Math.min(D,W.x)},1/0),y=this.parsePoint({x:t,y:e}),m=this.parsePoint({x:g,y:e}),x=y.x-m.x,_=Math.min(x,m.y*o),E=yN(r),b=mN(zt({},r,c)),M=_-h/2,T=typeof s=="function"?s:iy[s]||iy.circle,k=T(y.x,y.y,M*2,M*2),L=n.addGroup({name:"waves"}),O=L.setClip({type:"path",attrs:{path:k}});return CN(y.x,y.y,1-r.points[1].y,p,E,L,O,_*2,d,l),n.addShape("path",{name:"distance",attrs:{path:k,fill:"transparent",lineWidth:h+v*2,stroke:u==="transparent"?"#fff":u}}),n.addShape("path",{name:"wrap",attrs:zt(b,{path:k,fill:"transparent",lineWidth:h})}),n}});(function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.type="liquid",t}return n.getDefaultOptions=function(){return gN},n.prototype.getDefaultOptions=function(){return n.getDefaultOptions()},n.prototype.changeData=function(t){this.chart.emit(_t.BEFORE_CHANGE_DATA,re.fromData(this.chart,_t.BEFORE_CHANGE_DATA,null)),this.updateOption({percent:t}),this.chart.data(qA(t)),KA({chart:this.chart,options:this.options},!0),this.chart.emit(_t.AFTER_CHANGE_DATA,re.fromData(this.chart,_t.AFTER_CHANGE_DATA,null))},n.prototype.getSchemaAdaptor=function(){return dN},n})(yt);function ay(r,n,t){return r.length>1?n+"_"+t:""+n}function QA(r){var n=r.data,t=r.xField,e=r.measureField,i=r.rangeField,a=r.targetField,o=r.layout,s=[],u=[];n.forEach(function(f,h){var v=[f[i]].flat();v.sort(function(g,y){return g-y}),v.forEach(function(g,y){var m,x=y===0?g:v[y]-v[y-1];s.push((m={rKey:i+"_"+y},m[t]=t?f[t]:String(h),m[i]=x,m))});var p=[f[e]].flat();p.forEach(function(g,y){var m;s.push((m={mKey:ay(p,e,y)},m[t]=t?f[t]:String(h),m[e]=g,m))});var d=[f[a]].flat();d.forEach(function(g,y){var m;s.push((m={tKey:ay(d,a,y)},m[t]=t?f[t]:String(h),m[a]=g,m))}),u.push(f[i],f[e],f[a])});var l=Math.min.apply(Math,u.flat(1/0)),c=Math.max.apply(Math,u.flat(1/0));return l=l>0?0:l,o==="vertical"&&s.reverse(),{min:l,max:c,ds:s}}function MN(r){var n=r.chart,t=r.options,e=t.bulletStyle,i=t.targetField,a=t.rangeField,o=t.measureField,s=t.xField,u=t.color,l=t.layout,c=t.size,f=t.label,h=QA(t),v=h.min,p=h.max,d=h.ds;n.data(d);var g=N({},r,{options:{xField:s,yField:a,seriesField:"rKey",isStack:!0,label:F(f,"range"),interval:{color:F(u,"range"),style:F(e,"range"),size:F(c,"range")}}});De(g),n.geometries[0].tooltip(!1);var y=N({},r,{options:{xField:s,yField:o,seriesField:"mKey",isStack:!0,label:F(f,"measure"),interval:{color:F(u,"measure"),style:F(e,"measure"),size:F(c,"measure")}}});De(y);var m=N({},r,{options:{xField:s,yField:i,seriesField:"tKey",label:F(f,"target"),point:{color:F(u,"target"),style:F(e,"target"),size:rt(F(c,"target"))?function(x){return F(c,"target")(x)/2}:F(c,"target")/2,shape:l==="horizontal"?"line":"hyphen"}}});return _r(m),l==="horizontal"&&n.coordinate().transpose(),C(C({},r),{ext:{data:{min:v,max:p}}})}function JA(r){var n,t,e=r.options,i=r.ext,a=e.xAxis,o=e.yAxis,s=e.targetField,u=e.rangeField,l=e.measureField,c=e.xField,f=i.data;return ht(oe((n={},n[c]=a,n[l]=o,n),(t={},t[l]={min:f==null?void 0:f.min,max:f==null?void 0:f.max,sync:!0},t[s]={sync:""+l},t[u]={sync:""+l},t)))(r)}function wN(r){var n=r.chart,t=r.options,e=t.xAxis,i=t.yAxis,a=t.xField,o=t.measureField,s=t.rangeField,u=t.targetField;return n.axis(""+s,!1),n.axis(""+u,!1),e===!1?n.axis(""+a,!1):n.axis(""+a,e),i===!1?n.axis(""+o,!1):n.axis(""+o,i),r}function LN(r){var n=r.chart,t=r.options,e=t.legend;return n.removeInteraction("legend-filter"),n.legend(e),n.legend("rKey",!1),n.legend("mKey",!1),n.legend("tKey",!1),r}function FN(r){var n=r.chart,t=r.options,e=t.label,i=t.measureField,a=t.targetField,o=t.rangeField,s=n.geometries,u=s[0],l=s[1],c=s[2];return F(e,"range")?u.label(""+o,C({layout:[{type:"limit-in-plot"}]},Se(e.range))):u.label(!1),F(e,"measure")?l.label(""+i,C({layout:[{type:"limit-in-plot"}]},Se(e.measure))):l.label(!1),F(e,"target")?c.label(""+a,C({layout:[{type:"limit-in-plot"}]},Se(e.target))):c.label(!1),r}function kN(r){ht(MN,JA,wN,LN,Ot,FN,me,Qt,Ht)(r)}var ON=N({},yt.getDefaultOptions(),{layout:"horizontal",size:{range:30,measure:20,target:20},xAxis:{tickLine:!1,line:null},bulletStyle:{range:{fillOpacity:.5}},label:{measure:{position:"right"}},tooltip:{showMarkers:!1}});(function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.type="bullet",t}return n.getDefaultOptions=function(){return ON},n.prototype.changeData=function(t){this.updateOption({data:t});var e=QA(this.options),i=e.min,a=e.max,o=e.ds;JA({options:this.options,ext:{data:{min:i,max:a}},chart:this.chart}),this.chart.changeData(o)},n.prototype.getSchemaAdaptor=function(){return kN},n.prototype.getDefaultOptions=function(){return n.getDefaultOptions()},n})(yt);var t2="nodeIndex",e2="childNodeCount",$p="nodeAncestor",gf="Invalid field: it must be a string!";function Gp(r,n){var t=r.field,e=r.fields;if(lt(t))return t;if(V(t))return console.warn(gf),t[0];if(console.warn(gf+" will try to get fields instead."),lt(e))return e;if(V(e)&&e.length)return e[0];if(n)return n;throw new TypeError(gf)}function Vp(r){var n=[];if(r&&r.each){var t,e;r.each(function(i){var a,o;i.parent!==t?(t=i.parent,e=0):e+=1;var s=Pe((((a=i.ancestors)===null||a===void 0?void 0:a.call(i))||[]).map(function(u){return n.find(function(l){return l.name===u.name})||u}),function(u){var l=u.depth;return l>0&&l<i.depth});i[$p]=s,i[e2]=((o=i.children)===null||o===void 0?void 0:o.length)||0,i[t2]=e,n.push(i)})}else r&&r.eachNode&&r.eachNode(function(i){n.push(i)});return n}var Wp="ancestor-node",r2="value",As="path",RN=[As,t2,$p,e2,"name","depth","height"],IN=N({},yt.getDefaultOptions(),{innerRadius:0,radius:.85,hierarchyConfig:{field:"value"},tooltip:{shared:!0,showMarkers:!1,offset:20,showTitle:!1},legend:!1,sunburstStyle:{lineWidth:.5,stroke:"#FFF"},drilldown:{enabled:!0}}),oy=4,DN=0,sy=5,uy="drilldown-bread-crumb",PN={position:"top-left",dividerText:"/",textStyle:{fontSize:12,fill:"rgba(0, 0, 0, 0.65)",cursor:"pointer"},activeTextStyle:{fill:"#87B5FF"}},Ts="hierarchy-data-transform-params",BN=function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.name="drill-down",t.historyCache=[],t.breadCrumbGroup=null,t.breadCrumbCfg=PN,t}return n.prototype.click=function(){var t=F(this.context,["event","data","data"]);if(!t)return!1;this.drill(t),this.drawBreadCrumb()},n.prototype.resetPosition=function(){if(!!this.breadCrumbGroup){var t=this.context.view.getCoordinate(),e=this.breadCrumbGroup,i=e.getBBox(),a=this.getButtonCfg().position,o={x:t.start.x,y:t.end.y-(i.height+sy*2)};t.isPolar&&(o={x:0,y:0}),a==="bottom-left"&&(o={x:t.start.x,y:t.start.y});var s=ir.transform(null,[["t",o.x+DN,o.y+i.height+sy]]);e.setMatrix(s)}},n.prototype.back=function(){Ee(this.historyCache)&&this.backTo(this.historyCache.slice(0,-1))},n.prototype.reset=function(){this.historyCache[0]&&this.backTo(this.historyCache.slice(0,1)),this.historyCache=[],this.hideCrumbGroup()},n.prototype.drill=function(t){var e=this.context.view,i=F(e,["interactions","drill-down","cfg","transformData"],function(l){return l}),a=i(C({data:t.data},t[Ts]));e.changeData(a);for(var o=[],s=t;s;){var u=s.data;o.unshift({id:u.name+"_"+s.height+"_"+s.depth,name:u.name,children:i(C({data:u},t[Ts]))}),s=s.parent}this.historyCache=(this.historyCache||[]).slice(0,-1).concat(o)},n.prototype.backTo=function(t){if(!(!t||t.length<=0)){var e=this.context.view,i=pe(t).children;e.changeData(i),t.length>1?(this.historyCache=t,this.drawBreadCrumb()):(this.historyCache=[],this.hideCrumbGroup())}},n.prototype.getButtonCfg=function(){var t=this.context.view,e=F(t,["interactions","drill-down","cfg","drillDownConfig"]);return N(this.breadCrumbCfg,e==null?void 0:e.breadCrumb,this.cfg)},n.prototype.drawBreadCrumb=function(){this.drawBreadCrumbGroup(),this.resetPosition(),this.breadCrumbGroup.show()},n.prototype.drawBreadCrumbGroup=function(){var t=this,e=this.getButtonCfg(),i=this.historyCache;this.breadCrumbGroup?this.breadCrumbGroup.clear():this.breadCrumbGroup=this.context.view.foregroundGroup.addGroup({name:uy});var a=0;i.forEach(function(o,s){var u=t.breadCrumbGroup.addShape({type:"text",id:o.id,name:uy+"_"+o.name+"_text",attrs:C(C({text:s===0&&!G(e.rootText)?e.rootText:o.name},e.textStyle),{x:a,y:0})}),l=u.getBBox();if(a+=l.width+oy,u.on("click",function(h){var v,p=h.target.get("id");if(p!==((v=pe(i))===null||v===void 0?void 0:v.id)){var d=i.slice(0,i.findIndex(function(g){return g.id===p})+1);t.backTo(d)}}),u.on("mouseenter",function(h){var v,p=h.target.get("id");p!==((v=pe(i))===null||v===void 0?void 0:v.id)?u.attr(e.activeTextStyle):u.attr({cursor:"default"})}),u.on("mouseleave",function(){u.attr(e.textStyle)}),s<i.length-1){var c=t.breadCrumbGroup.addShape({type:"text",name:e.name+"_"+o.name+"_divider",attrs:C(C({text:e.dividerText},e.textStyle),{x:a,y:0})}),f=c.getBBox();a+=f.width+oy}})},n.prototype.hideCrumbGroup=function(){this.breadCrumbGroup&&this.breadCrumbGroup.hide()},n.prototype.destroy=function(){this.breadCrumbGroup&&this.breadCrumbGroup.remove(),r.prototype.destroy.call(this)},n}(ee),NN={field:"value",size:[1,1],round:!1,padding:0,sort:function(r,n){return n.value-r.value},as:["x","y"],ignoreParentValue:!0};function zN(r,n){n=zt({},NN,n);var t=n.as;if(!V(t)||t.length!==2)throw new TypeError('Invalid as: it must be an array with 2 strings (e.g. [ "x", "y" ])!');var e;try{e=Gp(n)}catch(u){console.warn(u)}var i=function(u){return kM().size(n.size).round(n.round).padding(n.padding)(_v(u).sum(function(l){return Ee(l.children)?n.ignoreParentValue?0:l[e]-ze(l.children,function(c,f){return c+f[e]},0):l[e]}).sort(n.sort))},a=i(r),o=t[0],s=t[1];return a.each(function(u){var l,c;u[o]=[u.x0,u.x1,u.x1,u.x0],u[s]=[u.y1,u.y1,u.y0,u.y0],u.name=u.name||((l=u.data)===null||l===void 0?void 0:l.name)||((c=u.data)===null||c===void 0?void 0:c.label),u.data.name=u.name,["x0","x1","y0","y1"].forEach(function(f){t.indexOf(f)===-1&&delete u[f]})}),Vp(a)}var UN={field:"value",tile:"treemapSquarify",size:[1,1],round:!1,ignoreParentValue:!0,padding:0,paddingInner:0,paddingOuter:0,paddingTop:0,paddingRight:0,paddingBottom:0,paddingLeft:0,as:["x","y"],sort:function(r,n){return n.value-r.value},ratio:.5*(1+Math.sqrt(5))};function HN(r,n){return r==="treemapSquarify"?Od[r].ratio(n):Od[r]}function n2(r,n){n=zt({},UN,n);var t=n.as;if(!V(t)||t.length!==2)throw new TypeError('Invalid as: it must be an array with 2 strings (e.g. [ "x", "y" ])!');var e;try{e=Gp(n)}catch(l){console.warn(l)}var i=HN(n.tile,n.ratio),a=function(l){return OM().tile(i).size(n.size).round(n.round).padding(n.padding).paddingInner(n.paddingInner).paddingOuter(n.paddingOuter).paddingTop(n.paddingTop).paddingRight(n.paddingRight).paddingBottom(n.paddingBottom).paddingLeft(n.paddingLeft)(_v(l).sum(function(c){return n.ignoreParentValue&&c.children?0:c[e]}).sort(n.sort))},o=a(r),s=t[0],u=t[1];return o.each(function(l){l[s]=[l.x0,l.x1,l.x1,l.x0],l[u]=[l.y1,l.y1,l.y0,l.y0],["x0","x1","y0","y1"].forEach(function(c){t.indexOf(c)===-1&&delete l[c]})}),Vp(o)}function i2(r){var n=r.data,t=r.colorField,e=r.rawFields,i=r.hierarchyConfig,a=i===void 0?{}:i,o=a.activeDepth,s={partition:zN,treemap:n2},u=r.seriesField,l=r.type||"partition",c=s[l](n,C(C({field:u||"value"},Bl(a,["activeDepth"])),{type:"hierarchy."+l,as:["x","y"]})),f=[];return c.forEach(function(h){var v,p,d,g,y,m;if(h.depth===0||o>0&&h.depth>o)return null;for(var x=h.data.name,_=C({},h);_.depth>1;)x=((p=_.parent.data)===null||p===void 0?void 0:p.name)+" / "+x,_=_.parent;var E=C(C(C({},Nt(h.data,Yt(e||[],[a.field]))),(v={},v[As]=x,v[Wp]=_.data.name,v)),h);u&&(E[u]=h.data[u]||((g=(d=h.parent)===null||d===void 0?void 0:d.data)===null||g===void 0?void 0:g[u])),t&&(E[t]=h.data[t]||((m=(y=h.parent)===null||y===void 0?void 0:y.data)===null||m===void 0?void 0:m[t])),E.ext=a,E[Ts]={hierarchyConfig:a,colorField:t,rawFields:e},f.push(E)}),f}function $N(r){var n=r.chart,t=r.options,e=t.color,i=t.colorField,a=i===void 0?Wp:i,o=t.sunburstStyle,s=t.rawFields,u=s===void 0?[]:s,l=i2(t);n.data(l);var c;return o&&(c=function(f){return N({},{fillOpacity:Math.pow(.85,f.depth)},rt(o)?o(f):o)}),xc(N({},r,{options:{xField:"x",yField:"y",seriesField:a,rawFields:qa(Yt(RN,u)),polygon:{color:e,style:c}}})),r}function GN(r){var n=r.chart;return n.axis(!1),r}function VN(r){var n=r.chart,t=r.options,e=t.label,i=Ie(n,"polygon");if(!e)i.label(!1);else{var a=e.fields,o=a===void 0?["name"]:a,s=e.callback,u=Tt(e,["fields","callback"]);i.label({fields:o,callback:s,cfg:Se(u)})}return r}function WN(r){var n=r.chart,t=r.options,e=t.innerRadius,i=t.radius,a=t.reflect,o=n.coordinate({type:"polar",cfg:{innerRadius:e,radius:i}});return a&&o.reflect(a),r}function jN(r){var n,t=r.options,e=t.hierarchyConfig,i=t.meta;return ht(oe({},(n={},n[r2]=F(i,F(e,["field"],"value")),n)))(r)}function XN(r){var n=r.chart,t=r.options,e=t.tooltip;if(e===!1)n.tooltip(!1);else{var i=e;F(e,"fields")||(i=N({},{customItems:function(a){return a.map(function(o){var s=F(n.getOptions(),"scales"),u=F(s,[As,"formatter"],function(c){return c}),l=F(s,[r2,"formatter"],function(c){return c});return C(C({},o),{name:u(o.data[As]),value:l(o.data.value)})})}},i)),n.tooltip(i)}return r}function YN(r){var n=r.drilldown,t=r.interactions,e=t===void 0?[]:t;return n!=null&&n.enabled?N({},r,{interactions:Yt(e,[{type:"drill-down",cfg:{drillDownConfig:n,transformData:i2}}])}):r}function ZN(r){var n=r.chart,t=r.options,e=t.drilldown;return Qt({chart:n,options:YN(t)}),e!=null&&e.enabled&&(n.appendPadding=dc(n.appendPadding,F(e,["breadCrumb","position"]))),r}function qN(r){return ht(Ot,xr("sunburstStyle"),$N,GN,jN,ho,WN,XN,VN,ZN,Ht,ne())(r)}function ly(r){var n=F(r,["event","data","data"],{});return V(n.children)&&n.children.length>0}function cy(r){var n=r.view.getCoordinate(),t=n.innerRadius;if(t){var e=r.event,i=e.x,a=e.y,o=n.center,s=o.x,u=o.y,l=n.getRadius()*t,c=Math.sqrt(Math.pow(s-i,2)+Math.pow(u-a,2));return c<l}return!1}ct("drill-down-action",BN);gt("drill-down",{showEnable:[{trigger:"element:mouseenter",action:"cursor:pointer",isEnable:ly},{trigger:"element:mouseleave",action:"cursor:default"},{trigger:"element:mouseleave",action:"cursor:pointer",isEnable:cy}],start:[{trigger:"element:click",isEnable:ly,action:["drill-down-action:click"]},{trigger:"afterchangesize",action:["drill-down-action:resetPosition"]},{trigger:"click",isEnable:cy,action:["drill-down-action:back"]}]});(function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.type="sunburst",t}return n.getDefaultOptions=function(){return IN},n.prototype.getDefaultOptions=function(){return n.getDefaultOptions()},n.prototype.getSchemaAdaptor=function(){return qN},n.SUNBURST_ANCESTOR_FIELD=Wp,n.SUNBURST_PATH_FIELD=As,n.NODE_ANCESTORS_FIELD=$p,n})(yt);var wu,xl="range",a2="type",An="percent",KN="#f0f0f0",o2="indicator-view",s2="range-view",QN={percent:0,range:{ticks:[]},innerRadius:.9,radius:.95,startAngle:-7/6*Math.PI,endAngle:1/6*Math.PI,syncViewPadding:!0,axis:{line:null,label:{offset:-24,style:{textAlign:"center",textBaseline:"middle"}},subTickLine:{length:-8},tickLine:{length:-12},grid:null},indicator:{pointer:{style:{lineWidth:5,lineCap:"round"}},pin:{style:{r:9.75,lineWidth:4.5,fill:"#fff"}}},statistic:{title:!1},meta:(wu={},wu[xl]={sync:"v"},wu[An]={sync:"v",tickCount:5,tickInterval:.2},wu),animation:!1};function JN(r,n){return r.map(function(t,e){var i;return i={},i[xl]=t-(r[e-1]||0),i[a2]=""+e,i[An]=n,i}).filter(function(t){return!!t[xl]})}function u2(r){var n;return[(n={},n[An]=Kt(r,0,1),n)]}function l2(r,n){var t=F(n,["ticks"],[]),e=Ee(t)?t:[0,Kt(r,0,1),1];return JN(e,r)}function t9(r){var n=r.chart,t=r.options,e=t.percent,i=t.range,a=t.radius,o=t.innerRadius,s=t.startAngle,u=t.endAngle,l=t.axis,c=t.indicator,f=t.gaugeStyle,h=t.type,v=t.meter,p=i.color,d=i.width;if(c){var g=u2(e),y=n.createView({id:o2});y.data(g),y.point().position(An+"*1").shape(c.shape||"gauge-indicator").customInfo({defaultColor:n.getTheme().defaultColor,indicator:c}),y.coordinate("polar",{startAngle:s,endAngle:u,radius:o*a}),y.axis(An,l),y.scale(An,Nt(l,tr))}var m=l2(e,t.range),x=n.createView({id:s2});x.data(m);var _=lt(p)?[p,KN]:p,E=De({chart:x,options:{xField:"1",yField:xl,seriesField:a2,rawFields:[An],isStack:!0,interval:{color:_,style:f,shape:h==="meter"?"meter-gauge":null},args:{zIndexReversed:!0,sortZIndex:!0},minColumnWidth:d,maxColumnWidth:d}}).ext,b=E.geometry;return b.customInfo({meter:v}),x.coordinate("polar",{innerRadius:o,radius:a,startAngle:s,endAngle:u}).transpose(),r}function e9(r){var n;return ht(oe((n={range:{min:0,max:1,maxLimit:1,minLimit:0}},n[An]={},n)))(r)}function c2(r,n){var t=r.chart,e=r.options,i=e.statistic,a=e.percent;if(t.getController("annotation").clear(!0),i){var o=i.content,s=void 0;o&&(s=N({},{content:(a*100).toFixed(2)+"%",style:{opacity:.75,fontSize:"30px",lineHeight:1,textAlign:"center",color:"rgba(44,53,66,0.85)"}},o)),o4(t,{statistic:C(C({},i),{content:s})},{percent:a})}return n&&t.render(!0),r}function r9(r){var n=r.chart,t=r.options,e=t.tooltip;return e?n.tooltip(N({showTitle:!1,showMarkers:!1,containerTpl:'<div class="g2-tooltip"><div class="g2-tooltip-list"></div></div>',domStyles:{"g2-tooltip":{padding:"4px 8px",fontSize:"10px"}},customContent:function(i,a){var o=F(a,[0,"data",An],0);return(o*100).toFixed(2)+"%"}},e)):n.tooltip(!1),r}function n9(r){var n=r.chart;return n.legend(!1),r}function f2(r){return ht(Ot,Ht,t9,e9,r9,c2,Qt,ne(),n9)(r)}Pt("point","gauge-indicator",{draw:function(r,n){var t=r.customInfo,e=t.indicator,i=t.defaultColor,a=e,o=a.pointer,s=a.pin,u=n.addGroup(),l=this.parsePoint({x:0,y:0});return o&&u.addShape("line",{name:"pointer",attrs:C({x1:l.x,y1:l.y,x2:r.x,y2:r.y,stroke:i},o.style)}),s&&u.addShape("circle",{name:"pin",attrs:C({x:l.x,y:l.y,stroke:i},s.style)}),u}});Pt("interval","meter-gauge",{draw:function(r,n){var t=r.customInfo.meter,e=t===void 0?{}:t,i=e.steps,a=i===void 0?50:i,o=e.stepRatio,s=o===void 0?.5:o;a=a<1?1:a,s=Kt(s,0,1);var u=this.coordinate,l=u.startAngle,c=u.endAngle,f=0;if(s>0&&s<1){var h=c-l;f=h/a/(s/(1-s)+1-1/a)}for(var v=f/(1-s)*s,p=n.addGroup(),d=this.coordinate.getCenter(),g=this.coordinate.getRadius(),y=ir.getAngle(r,this.coordinate),m=y.startAngle,x=y.endAngle,_=m;_<x;){var E=void 0,b=(_-l)%(v+f);b<v?E=_+(v-b):(_+=v+f-b,E=_+v);var M=ir.getSectorPath(d.x,d.y,g,_,Math.min(E,x),g*this.coordinate.innerRadius);p.addShape("path",{name:"meter-gauge",attrs:{path:M,fill:r.color,stroke:r.color,lineWidth:.5}}),_=E+f}return p}});var i9=function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.type="gauge",t}return n.getDefaultOptions=function(){return QN},n.prototype.changeData=function(t){this.chart.emit(_t.BEFORE_CHANGE_DATA,re.fromData(this.chart,_t.BEFORE_CHANGE_DATA,null)),this.updateOption({percent:t});var e=this.chart.views.find(function(a){return a.id===o2});e&&e.data(u2(t));var i=this.chart.views.find(function(a){return a.id===s2});i&&i.data(l2(t,this.options.range)),c2({chart:this.chart,options:this.options},!0),this.chart.emit(_t.AFTER_CHANGE_DATA,re.fromData(this.chart,_t.AFTER_CHANGE_DATA,null))},n.prototype.getDefaultOptions=function(){return n.getDefaultOptions()},n.prototype.getSchemaAdaptor=function(){return f2},n}(yt),wr="$$yField$$",bc="$$diffField$$",jp="$$absoluteField$$",Ph="$$isTotal$$",a9={label:{},leaderLine:{style:{lineWidth:1,stroke:"#8c8c8c",lineDash:[4,2]}},total:{style:{fill:"rgba(0, 0, 0, 0.25)"}},interactions:[{type:"element-active"}],risingFill:"#f4664a",fallingFill:"#30bf78",waterfallStyle:{fill:"rgba(0, 0, 0, 0.25)"},yAxis:{grid:{line:{style:{lineDash:[4,2]}}}}};function o9(r,n,t,e,i){var a,o=[];if(ze(r,function(u,l){var c;In(qr.WARN,dt(l[t]),l[t]+" is not a valid number");var f=Je(l[t])?null:l[t];return o.push(C(C({},l),(c={},c[e]=[u,u+f],c))),u+f},0),o.length&&i){var s=F(o,[[r.length-1],e,[1]]);o.push((a={},a[n]=i.label,a[t]=s,a[e]=[0,s],a))}return o}function h2(r,n,t,e){var i=o9(r,n,t,wr,e);return i.map(function(a,o){var s;return wt(a)?C(C({},a),(s={},s[jp]=a[wr][1],s[bc]=a[wr][1]-a[wr][0],s[Ph]=o===r.length,s)):a})}function s9(r){for(var n=[],t=0;t<r.length;t++){var e=r[t];if(e){var i=t===0?"M":"L";n.push([i,e.x,e.y])}}var a=r[0];return n.push(["L",a.x,a.y]),n.push(["z"]),n}function u9(r){return N({},r.defaultStyle,r.style,{fill:r.color})}Pt("interval","waterfall",{draw:function(r,n){var t=r.customInfo,e=r.points,i=r.nextPoints,a=n.addGroup(),o=this.parsePath(s9(e)),s=u9(r);a.addShape("path",{attrs:C(C({},s),{path:o})});var u=F(t,"leaderLine");if(u&&i){var l=[["M",e[2].x,e[2].y],["L",i[0].x,i[0].y]];e[2].y===i[1].y&&(l[1]=["L",i[1].x,i[1].y]),l=this.parsePath(l),a.addShape("path",{attrs:C({path:l},u.style||{})})}return a}});function l9(r){var n=r.options,t=n.locale,e=n.total,i=gc(t).get(["waterfall","total"]);return e&&typeof e.label!="string"&&i&&(r.options.total.label=i),r}function c9(r){var n=r.chart,t=r.options,e=t.data,i=t.xField,a=t.yField,o=t.total,s=t.leaderLine,u=t.columnWidthRatio,l=t.waterfallStyle,c=t.risingFill,f=t.fallingFill,h=t.color;n.data(h2(e,i,a,o));var v=h||function(y){return F(y,[Ph])?F(o,["style","fill"],""):F(y,[wr,1])-F(y,[wr,0])>0?c:f},p=N({},r,{options:{xField:i,yField:wr,seriesField:i,rawFields:[a,bc,Ph,wr],widthRatio:u,interval:{style:l,shape:"waterfall",color:v}}}),d=De(p).ext,g=d.geometry;return g.customInfo({leaderLine:s}),r}function f9(r){var n,t,e=r.options,i=e.xAxis,a=e.yAxis,o=e.xField,s=e.yField,u=e.meta,l=N({},{alias:s},F(u,s));return ht(oe((n={},n[o]=i,n[s]=a,n[wr]=a,n),N({},u,(t={},t[wr]=l,t[bc]=l,t[jp]=l,t))))(r)}function h9(r){var n=r.chart,t=r.options,e=t.xAxis,i=t.yAxis,a=t.xField,o=t.yField;return e===!1?n.axis(a,!1):n.axis(a,e),i===!1?(n.axis(o,!1),n.axis(wr,!1)):(n.axis(o,i),n.axis(wr,i)),r}function v9(r){var n=r.chart,t=r.options,e=t.legend,i=t.total,a=t.risingFill,o=t.fallingFill,s=t.locale,u=gc(s);if(e===!1)n.legend(!1);else{var l=[{name:u.get(["general","increase"]),value:"increase",marker:{symbol:"square",style:{r:5,fill:a}}},{name:u.get(["general","decrease"]),value:"decrease",marker:{symbol:"square",style:{r:5,fill:o}}}];i&&l.push({name:i.label||"",value:"total",marker:{symbol:"square",style:N({},{r:5},F(i,"style"))}}),n.legend(N({},{custom:!0,position:"top",items:l},e)),n.removeInteraction("legend-filter")}return r}function p9(r){var n=r.chart,t=r.options,e=t.label,i=t.labelMode,a=t.xField,o=Ie(n,"interval");if(!e)o.label(!1);else{var s=e.callback,u=Tt(e,["callback"]);o.label({fields:i==="absolute"?[jp,a]:[bc,a],callback:s,cfg:Se(u)})}return r}function d9(r){var n=r.chart,t=r.options,e=t.tooltip,i=t.xField,a=t.yField;if(e!==!1){n.tooltip(C({showCrosshairs:!1,showMarkers:!1,shared:!0,fields:[a]},e));var o=n.geometries[0];e!=null&&e.formatter?o.tooltip(i+"*"+a,e.formatter):o.tooltip(a)}else n.tooltip(!1);return r}function g9(r){return ht(l9,Ot,c9,f9,h9,v9,d9,p9,Ci,Qt,Ht,ne())(r)}(function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.type="waterfall",t}return n.getDefaultOptions=function(){return a9},n.prototype.changeData=function(t){var e=this.options,i=e.xField,a=e.yField,o=e.total;this.updateOption({data:t}),this.chart.changeData(h2(t,i,a,o))},n.prototype.getSchemaAdaptor=function(){return g9},n.prototype.getDefaultOptions=function(){return n.getDefaultOptions()},n})(yt);function y9(r,n,t){var e=t.map(function(o){return o[n]}).filter(function(o){return o!==void 0}),i=e.length>0?Math.max.apply(Math,e):0,a=Math.abs(r)%360;return a?i*360/a:i}function m9(r,n,t){var e=[];return r.forEach(function(i){var a=e.find(function(o){return o[n]===i[n]});a?a[t]+=i[t]||null:e.push(C({},i))}),e}function x9(r){var n=r.chart,t=r.options,e=t.barStyle,i=t.color,a=t.tooltip,o=t.colorField,s=t.type,u=t.xField,l=t.yField,c=t.data,f=eo(c,l);n.data(f);var h=N({},r,{options:{tooltip:a,seriesField:o,interval:{style:e,color:i,shape:s==="line"?"line":"intervel"},minColumnWidth:t.minBarWidth,maxColumnWidth:t.maxBarWidth,columnBackground:t.barBackground}});return De(h),s==="line"&&_r({chart:n,options:{xField:u,yField:l,seriesField:o,point:{shape:"circle",color:i}}}),r}function v2(r){var n,t=r.options,e=t.yField,i=t.xField,a=t.data,o=t.isStack,s=t.isGroup,u=t.colorField,l=t.maxAngle,c=o&&!s&&u?m9(a,i,e):a,f=eo(c,e);return ht(oe((n={},n[e]={min:0,max:y9(l,e,f)},n)))(r)}function _9(r){var n=r.chart,t=r.options,e=t.radius,i=t.innerRadius,a=t.startAngle,o=t.endAngle;return n.coordinate({type:"polar",cfg:{radius:e,innerRadius:i,startAngle:a,endAngle:o}}).transpose(),r}function C9(r){var n=r.chart,t=r.options,e=t.xField,i=t.xAxis;return n.axis(e,i),r}function E9(r){var n=r.chart,t=r.options,e=t.label,i=t.yField,a=Ie(n,"interval");if(!e)a.label(!1);else{var o=e.callback,s=Tt(e,["callback"]);a.label({fields:[i],callback:o,cfg:C(C({},Se(s)),{type:"polar"})})}return r}function S9(r){return ht(xr("barStyle"),x9,v2,C9,_9,Qt,Ht,Ot,me,ho,ne(),E9)(r)}var b9=N({},yt.getDefaultOptions(),{interactions:[{type:"element-active"}],legend:!1,tooltip:{showMarkers:!1},xAxis:{grid:null,tickLine:null,line:null},maxAngle:240});(function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.type="radial-bar",t}return n.getDefaultOptions=function(){return b9},n.prototype.changeData=function(t){this.updateOption({data:t}),v2({chart:this.chart,options:this.options}),this.chart.changeData(t)},n.prototype.getDefaultOptions=function(){return n.getDefaultOptions()},n.prototype.getSchemaAdaptor=function(){return S9},n})(yt);var vn="first-axes-view",pn="second-axes-view",Vi="series-field-key";function p2(r,n,t,e,i){var a=[];n.forEach(function(f){e.forEach(function(h){var v,p=(v={},v[r]=h[r],v[t]=f,v[f]=h[f],v);a.push(p)})});var o=Object.values(dr(a,t)),s=o[0],u=s===void 0?[]:s,l=o[1],c=l===void 0?[]:l;return i?[u.reverse(),c.reverse()]:[u,c]}function Tn(r){return r!=="vertical"}function A9(r,n,t){var e=n[0],i=n[1],a=e.autoPadding,o=i.autoPadding,s=r.__axisPosition,u=s.layout,l=s.position;if(Tn(u)&&l==="top"&&(e.autoPadding=t.instance(a.top,0,a.bottom,a.left),i.autoPadding=t.instance(o.top,a.left,o.bottom,0)),Tn(u)&&l==="bottom"&&(e.autoPadding=t.instance(a.top,a.right/2+5,a.bottom,a.left),i.autoPadding=t.instance(o.top,o.right,o.bottom,a.right/2+5)),!Tn(u)&&l==="bottom"){var c=a.left>=o.left?a.left:o.left;e.autoPadding=t.instance(a.top,a.right,a.bottom/2+5,c),i.autoPadding=t.instance(a.bottom/2+5,o.right,o.bottom,c)}if(!Tn(u)&&l==="top"){var c=a.left>=o.left?a.left:o.left;e.autoPadding=t.instance(a.top,a.right,0,c),i.autoPadding=t.instance(0,o.right,a.top,c)}}function T9(r){var n=r.chart,t=r.options,e=t.data,i=t.xField,a=t.yField,o=t.color,s=t.barStyle,u=t.widthRatio,l=t.legend,c=t.layout,f=p2(i,a,Vi,e,Tn(c));l?n.legend(Vi,l):l===!1&&n.legend(!1);var h,v,p=f[0],d=f[1];Tn(c)?(h=n.createView({region:{start:{x:0,y:0},end:{x:.5,y:1}},id:vn}),h.coordinate().transpose().reflect("x"),v=n.createView({region:{start:{x:.5,y:0},end:{x:1,y:1}},id:pn}),v.coordinate().transpose(),h.data(p),v.data(d)):(h=n.createView({region:{start:{x:0,y:0},end:{x:1,y:.5}},id:vn}),v=n.createView({region:{start:{x:0,y:.5},end:{x:1,y:1}},id:pn}),v.coordinate().reflect("y"),h.data(p),v.data(d));var g=N({},r,{chart:h,options:{widthRatio:u,xField:i,yField:a[0],seriesField:Vi,interval:{color:o,style:s}}});De(g);var y=N({},r,{chart:v,options:{xField:i,yField:a[1],seriesField:Vi,widthRatio:u,interval:{color:o,style:s}}});return De(y),r}function M9(r){var n,t,e,i=r.options,a=r.chart,o=i.xAxis,s=i.yAxis,u=i.xField,l=i.yField,c=Et(a,vn),f=Et(a,pn),h={};return oo((i==null?void 0:i.meta)||{}).map(function(v){F(i==null?void 0:i.meta,[v,"alias"])&&(h[v]=i.meta[v].alias)}),a.scale((n={},n[Vi]={sync:!0,formatter:function(v){return F(h,v,v)}},n)),oe((t={},t[u]=o,t[l[0]]=s[l[0]],t))(N({},r,{chart:c})),oe((e={},e[u]=o,e[l[1]]=s[l[1]],e))(N({},r,{chart:f})),r}function w9(r){var n=r.chart,t=r.options,e=t.xAxis,i=t.yAxis,a=t.xField,o=t.yField,s=t.layout,u=Et(n,vn),l=Et(n,pn);return(e==null?void 0:e.position)==="bottom"?l.axis(a,C(C({},e),{label:{formatter:function(){return""}}})):l.axis(a,!1),e===!1?u.axis(a,!1):u.axis(a,C({position:Tn(s)?"top":"bottom"},e)),i===!1?(u.axis(o[0],!1),l.axis(o[1],!1)):(u.axis(o[0],i[o[0]]),l.axis(o[1],i[o[1]])),n.__axisPosition={position:u.getOptions().axes[a].position,layout:s},r}function L9(r){var n=r.chart;return Qt(N({},r,{chart:Et(n,vn)})),Qt(N({},r,{chart:Et(n,pn)})),r}function F9(r){var n=r.chart,t=r.options,e=t.yField,i=t.yAxis;return ia(N({},r,{chart:Et(n,vn),options:{yAxis:i[e[0]]}})),ia(N({},r,{chart:Et(n,pn),options:{yAxis:i[e[1]]}})),r}function k9(r){var n=r.chart;return Ot(N({},r,{chart:Et(n,vn)})),Ot(N({},r,{chart:Et(n,pn)})),Ot(r),r}function O9(r){var n=r.chart;return Ht(N({},r,{chart:Et(n,vn)})),Ht(N({},r,{chart:Et(n,pn)})),r}function R9(r){var n=this,t,e,i=r.chart,a=r.options,o=a.label,s=a.yField,u=a.layout,l=Et(i,vn),c=Et(i,pn),f=Ie(l,"interval"),h=Ie(c,"interval");if(!o)f.label(!1),h.label(!1);else{var v=o.callback,p=Tt(o,["callback"]);p.position||(p.position="middle"),p.offset===void 0&&(p.offset=2);var d=C({},p);if(Tn(u)){var g=((t=d.style)===null||t===void 0?void 0:t.textAlign)||(p.position==="middle"?"center":"left");p.style=N({},p.style,{textAlign:g});var y={left:"right",right:"left",center:"center"};d.style=N({},d.style,{textAlign:y[g]})}else{var m={top:"bottom",bottom:"top",middle:"middle"};typeof p.position=="string"?p.position=m[p.position]:typeof p.position=="function"&&(p.position=function(){for(var E=[],b=0;b<arguments.length;b++)E[b]=arguments[b];return m[p.position.apply(n,E)]});var x=((e=d.style)===null||e===void 0?void 0:e.textBaseline)||"bottom";d.style=N({},d.style,{textBaseline:x});var _={top:"bottom",bottom:"top",middle:"middle"};p.style=N({},p.style,{textBaseline:_[x]})}f.label({fields:[s[0]],callback:v,cfg:Se(d)}),h.label({fields:[s[1]],callback:v,cfg:Se(p)})}return r}function I9(r){return ht(T9,M9,w9,F9,k9,R9,me,L9,O9)(r)}(function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.type="bidirectional-bar",t}return n.getDefaultOptions=function(){return N({},r.getDefaultOptions.call(this),{syncViewPadding:A9})},n.prototype.changeData=function(t){t===void 0&&(t=[]),this.chart.emit(_t.BEFORE_CHANGE_DATA,re.fromData(this.chart,_t.BEFORE_CHANGE_DATA,null)),this.updateOption({data:t});var e=this.options,i=e.xField,a=e.yField,o=e.layout,s=p2(i,a,Vi,t,Tn(o)),u=s[0],l=s[1],c=Et(this.chart,vn),f=Et(this.chart,pn);c.data(u),f.data(l),this.chart.render(!0),this.chart.emit(_t.AFTER_CHANGE_DATA,re.fromData(this.chart,_t.AFTER_CHANGE_DATA,null))},n.prototype.getDefaultOptions=function(){return n.getDefaultOptions()},n.prototype.getSchemaAdaptor=function(){return I9},n.SERIES_FIELD_KEY=Vi,n})(yt);function d2(r,n){if(!!V(r))return r.find(function(t){return t.type===n})}function g2(r,n){var t=d2(r,n);return t&&t.enable!==!1}function Xp(r){var n=r.interactions,t=r.drilldown;return F(t,"enabled")||g2(n,"treemap-drill-down")}function D9(r){var n=r.interactions["drill-down"];if(!!n){var t=n.context.actions.find(function(e){return e.name==="drill-down-action"});t.reset()}}function Yp(r){var n=r.data,t=r.colorField,e=r.enableDrillDown,i=r.hierarchyConfig,a=n2(n,C(C({},i),{type:"hierarchy.treemap",field:"value",as:["x","y"]})),o=[];return a.forEach(function(s){if(s.depth===0||e&&s.depth!==1||!e&&s.children)return null;var u=s.ancestors().map(function(h){return{data:h.data,height:h.height,value:h.value}}),l=e&&V(n.path)?u.concat(n.path.slice(1)):u,c=Object.assign({},s.data,C({x:s.x,y:s.y,depth:s.depth,value:s.value,path:l},s));if(!s.data[t]&&s.parent){var f=s.ancestors().find(function(h){return h.data[t]});c[t]=f==null?void 0:f.data[t]}else c[t]=s.data[t];c[Ts]={hierarchyConfig:i,colorField:t,enableDrillDown:e},o.push(c)}),o}function P9(r){var n=r.options,t=n.colorField;return N({options:{rawFields:["value"],tooltip:{fields:["name","value",t,"path"],formatter:function(e){return{name:e.name,value:e.value}}}}},r)}function B9(r){var n=r.chart,t=r.options,e=t.color,i=t.colorField,a=t.rectStyle,o=t.hierarchyConfig,s=t.rawFields,u=Yp({data:t.data,colorField:t.colorField,enableDrillDown:Xp(t),hierarchyConfig:o});return n.data(u),xc(N({},r,{options:{xField:"x",yField:"y",seriesField:i,rawFields:s,polygon:{color:e,style:a}}})),n.coordinate().reflect("y"),r}function N9(r){var n=r.chart;return n.axis(!1),r}function z9(r){var n=r.drilldown,t=r.interactions,e=t===void 0?[]:t,i=Xp(r);return i?N({},r,{interactions:Yt(e,[{type:"drill-down",cfg:{drillDownConfig:n,transformData:Yp}}])}):r}function U9(r){var n=r.chart,t=r.options,e=t.interactions,i=t.drilldown;Qt({chart:n,options:z9(t)});var a=d2(e,"view-zoom");a&&(a.enable!==!1?n.getCanvas().on("mousewheel",function(s){s.preventDefault()}):n.getCanvas().off("mousewheel"));var o=Xp(t);return o&&(n.appendPadding=dc(n.appendPadding,F(i,["breadCrumb","position"]))),r}function H9(r){return ht(P9,Ot,xr("rectStyle"),B9,N9,ho,me,U9,Ht,ne())(r)}var $9={colorField:"name",rectStyle:{lineWidth:1,stroke:"#fff"},hierarchyConfig:{tile:"treemapSquarify"},label:{fields:["name"],layout:{type:"limit-in-shape"}},tooltip:{showMarkers:!1,showTitle:!1},drilldown:{enabled:!1,breadCrumb:{position:"bottom-left",rootText:"\u521D\u59CB",dividerText:"/",textStyle:{fontSize:12,fill:"rgba(0, 0, 0, 0.65)",cursor:"pointer"},activeTextStyle:{fill:"#87B5FF"}}}};(function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.type="treemap",t}return n.getDefaultOptions=function(){return $9},n.prototype.changeData=function(t){var e=this.options,i=e.colorField,a=e.interactions,o=e.hierarchyConfig;this.updateOption({data:t});var s=Yp({data:t,colorField:i,enableDrillDown:g2(a,"treemap-drill-down"),hierarchyConfig:o});this.chart.changeData(s),D9(this.chart)},n.prototype.getDefaultOptions=function(){return n.getDefaultOptions()},n.prototype.getSchemaAdaptor=function(){return H9},n})(yt);function G9(r){return r.target.depth}function V9(r){return r.depth}function W9(r,n){return n-1-r.height}function Zp(r,n){return r.sourceLinks.length?r.depth:n-1}function j9(r){return r.targetLinks.length?r.depth:r.sourceLinks.length?Ew(r.sourceLinks,G9)-1:0}function Lu(r){return function(){return r}}function yf(r,n){for(var t=0,e=0;e<r.length;e++)t+=n(r[e]);return t}function mf(r,n){for(var t=-1/0,e=0;e<r.length;e++)t=Math.max(n(r[e]),t);return t}function X9(r,n){for(var t=1/0,e=0;e<r.length;e++)t=Math.min(n(r[e]),t);return t}function fy(r,n){return _l(r.source,n.source)||r.index-n.index}function hy(r,n){return _l(r.target,n.target)||r.index-n.index}function _l(r,n){return r.y0-n.y0}function xf(r){return r.value}function Y9(r){return r.index}function Z9(r){return r.nodes}function q9(r){return r.links}function vy(r,n){var t=r.get(n);if(!t)throw new Error("missing: "+n);return t}function py(r){for(var n=r.nodes,t=0,e=n;t<e.length;t++){for(var i=e[t],a=i.y0,o=a,s=0,u=i.sourceLinks;s<u.length;s++){var l=u[s];l.y0=a+l.width/2,a+=l.width}for(var c=0,f=i.targetLinks;c<f.length;c++){var l=f[c];l.y1=o+l.width/2,o+=l.width}}}function K9(){var r=0,n=0,t=1,e=1,i=24,a=8,o,s=Y9,u=Zp,l,c,f,h=Z9,v=q9,p=6;function d(z){var X={nodes:h(z),links:v(z)};return g(X),y(X),m(X),x(X),b(X),py(X),X}d.update=function(z){return py(z),z},d.nodeId=function(z){return arguments.length?(s=typeof z=="function"?z:Lu(z),d):s},d.nodeAlign=function(z){return arguments.length?(u=typeof z=="function"?z:Lu(z),d):u},d.nodeDepth=function(z){return arguments.length?(l=z,d):l},d.nodeSort=function(z){return arguments.length?(c=z,d):c},d.nodeWidth=function(z){return arguments.length?(i=+z,d):i},d.nodePadding=function(z){return arguments.length?(a=o=+z,d):a},d.nodes=function(z){return arguments.length?(h=typeof z=="function"?z:Lu(z),d):h},d.links=function(z){return arguments.length?(v=typeof z=="function"?z:Lu(z),d):v},d.linkSort=function(z){return arguments.length?(f=z,d):f},d.size=function(z){return arguments.length?(r=n=0,t=+z[0],e=+z[1],d):[t-r,e-n]},d.extent=function(z){return arguments.length?(r=+z[0][0],t=+z[1][0],n=+z[0][1],e=+z[1][1],d):[[r,n],[t,e]]},d.iterations=function(z){return arguments.length?(p=+z,d):p};function g(z){var X=z.nodes,K=z.links;X.forEach(function(vt,Lt){vt.index=Lt,vt.sourceLinks=[],vt.targetLinks=[]});var Q=new Map(X.map(function(vt){return[s(vt),vt]}));if(K.forEach(function(vt,Lt){vt.index=Lt;var jt=vt.source,Jt=vt.target;typeof jt!="object"&&(jt=vt.source=vy(Q,jt)),typeof Jt!="object"&&(Jt=vt.target=vy(Q,Jt)),jt.sourceLinks.push(vt),Jt.targetLinks.push(vt)}),f!=null)for(var q=0,at=X;q<at.length;q++){var pt=at[q],mt=pt.sourceLinks,ft=pt.targetLinks;mt.sort(f),ft.sort(f)}}function y(z){for(var X=z.nodes,K=0,Q=X;K<Q.length;K++){var q=Q[K];q.value=q.fixedValue===void 0?Math.max(yf(q.sourceLinks,xf),yf(q.targetLinks,xf)):q.fixedValue}}function m(z){for(var X=z.nodes,K=X.length,Q=new Set(X),q=new Set,at=0;Q.size;){if(Q.forEach(function(vt){vt.depth=at;for(var Lt=0,jt=vt.sourceLinks;Lt<jt.length;Lt++){var Jt=jt[Lt].target;q.add(Jt)}}),++at>K)throw new Error("circular link");Q=q,q=new Set}if(l)for(var pt=Math.max(mf(X,function(vt){return vt.depth})+1,0),mt=void 0,ft=0;ft<X.length;ft++)mt=X[ft],mt.depth=l.call(null,mt,pt)}function x(z){for(var X=z.nodes,K=X.length,Q=new Set(X),q=new Set,at=0;Q.size;){if(Q.forEach(function(pt){pt.height=at;for(var mt=0,ft=pt.targetLinks;mt<ft.length;mt++){var vt=ft[mt].source;q.add(vt)}}),++at>K)throw new Error("circular link");Q=q,q=new Set}}function _(z){for(var X=z.nodes,K=Math.max(mf(X,function(Jt){return Jt.depth})+1,0),Q=(t-r-i)/(K-1),q=new Array(K).fill(0).map(function(){return[]}),at=0,pt=X;at<pt.length;at++){var mt=pt[at],ft=Math.max(0,Math.min(K-1,Math.floor(u.call(null,mt,K))));mt.layer=ft,mt.x0=r+ft*Q,mt.x1=mt.x0+i,q[ft]?q[ft].push(mt):q[ft]=[mt]}if(c)for(var vt=0,Lt=q;vt<Lt.length;vt++){var jt=Lt[vt];jt.sort(c)}return q}function E(z){for(var X=X9(z,function(xe){return(e-n-(xe.length-1)*o)/yf(xe,xf)}),K=0,Q=z;K<Q.length;K++){for(var q=Q[K],at=n,pt=0,mt=q;pt<mt.length;pt++){var ft=mt[pt];ft.y0=at,ft.y1=at+ft.value*X,at=ft.y1+o;for(var vt=0,Lt=ft.sourceLinks;vt<Lt.length;vt++){var jt=Lt[vt];jt.width=jt.value*X}}at=(e-at+o)/(q.length+1);for(var Jt=0;Jt<q.length;++Jt){var ft=q[Jt];ft.y0+=at*(Jt+1),ft.y1+=at*(Jt+1)}W(q)}}function b(z){var X=_(z);o=Math.min(a,(e-n)/(mf(X,function(at){return at.length})-1)),E(X);for(var K=0;K<p;++K){var Q=Math.pow(.99,K),q=Math.max(1-Q,(K+1)/p);T(X,Q,q),M(X,Q,q)}}function M(z,X,K){for(var Q=1,q=z.length;Q<q;++Q){for(var at=z[Q],pt=0,mt=at;pt<mt.length;pt++){for(var ft=mt[pt],vt=0,Lt=0,jt=0,Jt=ft.targetLinks;jt<Jt.length;jt++){var xe=Jt[jt],Nr=xe.source,zr=xe.value,Ur=zr*(ft.layer-Nr.layer);vt+=j(Nr,ft)*Ur,Lt+=Ur}if(Lt>0){var Hr=(vt/Lt-ft.y0)*X;ft.y0+=Hr,ft.y1+=Hr,D(ft)}}c===void 0&&at.sort(_l),at.length&&k(at,K)}}function T(z,X,K){for(var Q=z.length,q=Q-2;q>=0;--q){for(var at=z[q],pt=0,mt=at;pt<mt.length;pt++){for(var ft=mt[pt],vt=0,Lt=0,jt=0,Jt=ft.sourceLinks;jt<Jt.length;jt++){var xe=Jt[jt],Nr=xe.target,zr=xe.value,Ur=zr*(Nr.layer-ft.layer);vt+=ot(ft,Nr)*Ur,Lt+=Ur}if(Lt>0){var Hr=(vt/Lt-ft.y0)*X;ft.y0+=Hr,ft.y1+=Hr,D(ft)}}c===void 0&&at.sort(_l),at.length&&k(at,K)}}function k(z,X){var K=z.length>>1,Q=z[K];O(z,Q.y0-o,K-1,X),L(z,Q.y1+o,K+1,X),O(z,e,z.length-1,X),L(z,n,0,X)}function L(z,X,K,Q){for(;K<z.length;++K){var q=z[K],at=(X-q.y0)*Q;at>1e-6&&(q.y0+=at,q.y1+=at),X=q.y1+o}}function O(z,X,K,Q){for(;K>=0;--K){var q=z[K],at=(q.y1-X)*Q;at>1e-6&&(q.y0-=at,q.y1-=at),X=q.y0-o}}function D(z){var X=z.sourceLinks,K=z.targetLinks;if(f===void 0){for(var Q=0,q=K;Q<q.length;Q++){var at=q[Q].source.sourceLinks;at.sort(hy)}for(var pt=0,mt=X;pt<mt.length;pt++){var ft=mt[pt].target.targetLinks;ft.sort(fy)}}}function W(z){if(f===void 0)for(var X=0,K=z;X<K.length;X++){var Q=K[X],q=Q.sourceLinks,at=Q.targetLinks;q.sort(hy),at.sort(fy)}}function j(z,X){for(var K=z.y0-(z.sourceLinks.length-1)*o/2,Q=0,q=z.sourceLinks;Q<q.length;Q++){var at=q[Q],pt=at.target,mt=at.width;if(pt===X)break;K+=mt+o}for(var ft=0,vt=X.targetLinks;ft<vt.length;ft++){var Lt=vt[ft],pt=Lt.source,mt=Lt.width;if(pt===z)break;K-=mt}return K}function ot(z,X){for(var K=X.y0-(X.targetLinks.length-1)*o/2,Q=0,q=X.targetLinks;Q<q.length;Q++){var at=q[Q],pt=at.source,mt=at.width;if(pt===z)break;K+=mt+o}for(var ft=0,vt=z.sourceLinks;ft<vt.length;ft++){var Lt=vt[ft],pt=Lt.target,mt=Lt.width;if(pt===X)break;K-=mt}return K}return d}var Q9={left:V9,right:W9,center:j9,justify:Zp},J9={nodeId:function(r){return r.index},nodeAlign:"justify",nodeWidth:.008,nodePadding:.03,nodeSort:void 0};function tz(r){var n=lt(r)?Q9[r]:rt(r)?r:null;return n||Zp}function ez(r){return zt({},J9,r)}function rz(r,n){var t=ez(r),e=t.nodeId,i=t.nodeSort,a=t.nodeAlign,o=t.nodeWidth,s=t.nodePadding,u=t.nodeDepth,l=K9().nodeSort(i).nodeWidth(o).nodePadding(s).nodeDepth(u).nodeAlign(tz(a)).extent([[0,0],[1,1]]).nodeId(e),c=l(n),f=c.nodes.map(function(v){var p=v.x0,d=v.x1,g=v.y0,y=v.y1;return v.x=[p,d,d,p],v.y=[g,g,y,y],v}).filter(function(v){return v.name!==null}),h=c.links.map(function(v){var p=v.source,d=v.target,g=p.x1,y=d.x0;v.x=[g,g,y,y];var m=v.width/2;return v.y=[v.y0+m,v.y0-m,v.y1+m,v.y1-m],v}).filter(function(v){var p=v.source,d=v.target;return p.name!==null&&d.name!==null});return{nodes:f,links:h}}function nz(r,n,t){var e=[];return r.forEach(function(i){var a=i[n],o=i[t];e.includes(a)||e.push(a),e.includes(o)||e.push(o)}),e}function iz(r,n,t,e){var i={};return n.forEach(function(a){i[a]={},n.forEach(function(o){i[a][o]=0})}),r.forEach(function(a){i[a[t]][a[e]]=1}),i}function az(r,n,t){if(!V(r))return[];var e=[],i=nz(r,n,t),a=iz(r,i,n,t),o={};i.forEach(function(u){o[u]=0});function s(u){o[u]=1,i.forEach(function(l){if(a[u][l]!=0)if(o[l]==1)e.push(u+"_"+l);else{if(o[l]==-1)return;s(l)}}),o[u]=-1}return i.forEach(function(u){o[u]!=-1&&s(u)}),e.length!==0&&console.warn("sankey data contains circle, "+e.length+" records removed.",e),r.filter(function(u){return e.findIndex(function(l){return l===u[n]+"_"+u[t]})<0})}function oz(r){return r==="node-link"}function sz(r,n,t){return na(r)?r/t:n}function uz(r,n,t){return na(r)?r/t:n}function y2(r,n,t){var e=r.dataType,i=r.data,a=r.sourceField,o=r.targetField,s=r.weightField,u=r.nodeAlign,l=r.nodeSort,c=r.nodePadding,f=r.nodePaddingRatio,h=r.nodeWidth,v=r.nodeWidthRatio,p=r.nodeDepth,d=r.rawFields,g=d===void 0?[]:d,y;oz(e)?y=i:y=jb(az(i,a,o),a,o,s,g);var m=rz({nodeAlign:u,nodePadding:uz(c,f,t),nodeWidth:sz(h,v,n),nodeSort:l,nodeDepth:p},y),x=m.nodes,_=m.links;return{nodes:x.map(function(E){return C(C({},Nt(E,Yt(["x","y","name"],g))),{isNode:!0})}),edges:_.map(function(E){return C(C({source:E.source.name,target:E.target.name,name:E.source.name||E.target.name},Nt(E,Yt(["x","y","value"],g))),{isNode:!1})})}}var dy="x",gy="y",yy="name",Ac="nodes",Tc="edges";function lz(r){var n=r.options,t=n.rawFields,e=t===void 0?[]:t;return N({},{options:{tooltip:{fields:qa(Yt(["name","source","target","value","isNode"],e))},label:{fields:qa(Yt(["x","name"],e))}}},r)}function cz(r){var n=r.chart,t=r.options,e=t.color,i=t.nodeStyle,a=t.edgeStyle,o=t.label,s=t.tooltip,u=t.nodeState,l=t.edgeState;n.legend(!1),n.tooltip(s),n.axis(!1),n.coordinate().reflect("y");var c=y2(t,n.width,n.height),f=c.nodes,h=c.edges,v=n.createView({id:Tc});v.data(h),Qb({chart:v,options:{xField:dy,yField:gy,seriesField:yy,edge:{color:e,style:a,shape:"arc"},tooltip:s,state:l}});var p=n.createView({id:Ac});return p.data(f),xc({chart:p,options:{xField:dy,yField:gy,seriesField:yy,polygon:{color:e,style:i},label:o,tooltip:s,state:u}}),n.interaction("element-active"),n.scale({x:{sync:!0,nice:!0,min:0,max:1,minLimit:0,maxLimit:1},y:{sync:!0,nice:!0,min:0,max:1,minLimit:0,maxLimit:1},name:{sync:"color",type:"cat"}}),r}function fz(r){var n=r.chart,t=r.options,e=t.animation;typeof e=="boolean"?n.animate(e):n.animate(!0);var i=Yt(n.views[0].geometries,n.views[1].geometries);return i.forEach(function(a){a.animate(e)}),r}function hz(r){var n=r.chart,t=r.options,e=t.nodeDraggable,i="sankey-node-draggable";return e?n.interaction(i):n.removeInteraction(i),r}function vz(r){var n=r.chart,t=r.options,e=t.interactions,i=e===void 0?[]:e,a=[].concat(i,t.nodeInteractions||[]),o=[].concat(i,t.edgeInteractions||[]),s=Et(n,Ac),u=Et(n,Tc);return a.forEach(function(l){(l==null?void 0:l.enable)===!1?s.removeInteraction(l.type):s.interaction(l.type,l.cfg||{})}),o.forEach(function(l){(l==null?void 0:l.enable)===!1?u.removeInteraction(l.type):u.interaction(l.type,l.cfg||{})}),r}function pz(r){return ht(lz,cz,vz,hz,fz,Ot)(r)}var dz=function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.isDragging=!1,t}return n.prototype.isNodeElement=function(){var t=F(this.context,"event.target");if(t){var e=t.get("element");return e&&e.getModel().data.isNode}return!1},n.prototype.getNodeView=function(){return Et(this.context.view,Ac)},n.prototype.getEdgeView=function(){return Et(this.context.view,Tc)},n.prototype.getCurrentDatumIdx=function(t){return this.getNodeView().geometries[0].elements.indexOf(t)},n.prototype.start=function(){if(this.isNodeElement()){this.prevPoint={x:F(this.context,"event.x"),y:F(this.context,"event.y")};var t=this.context.event.target.get("element"),e=this.getCurrentDatumIdx(t);if(e===-1)return;this.currentElementIdx=e,this.context.isDragging=!0,this.isDragging=!0,this.prevNodeAnimateCfg=this.getNodeView().getOptions().animate,this.prevEdgeAnimateCfg=this.getEdgeView().getOptions().animate,this.getNodeView().animate(!1),this.getEdgeView().animate(!1)}},n.prototype.translate=function(){if(this.isDragging){var t=this.context.view,e={x:F(this.context,"event.x"),y:F(this.context,"event.y")},i=e.x-this.prevPoint.x,a=e.y-this.prevPoint.y,o=this.getNodeView(),s=o.geometries[0].elements[this.currentElementIdx];if(s&&s.getModel()){var u=s.getModel().data,l=o.getOptions().data,c=o.getCoordinate(),f={x:i/c.getWidth(),y:a/c.getHeight()},h=C(C({},u),{x:u.x.map(function(y){return y+=f.x}),y:u.y.map(function(y){return y+=f.y})}),v=Yt(l);v[this.currentElementIdx]=h,o.data(v);var p=u.name,d=this.getEdgeView(),g=d.getOptions().data;g.forEach(function(y){y.source===p&&(y.x[0]+=f.x,y.x[1]+=f.x,y.y[0]+=f.y,y.y[1]+=f.y),y.target===p&&(y.x[2]+=f.x,y.x[3]+=f.x,y.y[2]+=f.y,y.y[3]+=f.y)}),d.data(g),this.prevPoint=e,t.render(!0)}}},n.prototype.end=function(){this.isDragging=!1,this.context.isDragging=!1,this.prevPoint=null,this.currentElementIdx=null,this.getNodeView().animate(this.prevNodeAnimateCfg),this.getEdgeView().animate(this.prevEdgeAnimateCfg)},n}(ee);ct("sankey-node-drag",dz);gt("sankey-node-draggable",{showEnable:[{trigger:"polygon:mouseenter",action:"cursor:pointer"},{trigger:"polygon:mouseleave",action:"cursor:default"}],start:[{trigger:"polygon:mousedown",action:"sankey-node-drag:start"}],processing:[{trigger:"plot:mousemove",action:"sankey-node-drag:translate"},{isEnable:function(r){return r.isDragging},trigger:"plot:mousemove",action:"cursor:move"}],end:[{trigger:"plot:mouseup",action:"sankey-node-drag:end"}]});(function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.type="sankey",t}return n.getDefaultOptions=function(){return{appendPadding:8,syncViewPadding:!0,nodeStyle:{opacity:1,fillOpacity:1,lineWidth:1},edgeStyle:{opacity:.3,lineWidth:0},edgeState:{active:{style:{opacity:.8,lineWidth:0}}},label:{formatter:function(t){var e=t.name;return e},callback:function(t){var e=t[1]===1;return{style:{fill:"#545454",textAlign:e?"end":"start"},offsetX:e?-8:8}},layout:[{type:"hide-overlap"}]},tooltip:{showTitle:!1,showMarkers:!1,shared:!1,showContent:function(t){return!F(t,[0,"data","isNode"])},formatter:function(t){var e=t.source,i=t.target,a=t.value;return{name:e+" -> "+i,value:a}}},nodeWidthRatio:.008,nodePaddingRatio:.01,animation:{appear:{animation:"wave-in"},enter:{animation:"wave-in"}}}},n.prototype.changeData=function(t){this.updateOption({data:t});var e=y2(this.options,this.chart.width,this.chart.height),i=e.nodes,a=e.edges,o=Et(this.chart,Ac),s=Et(this.chart,Tc);o.changeData(i),s.changeData(a)},n.prototype.getSchemaAdaptor=function(){return pz},n.prototype.getDefaultOptions=function(){return n.getDefaultOptions()},n})(yt);var gz={y:0,nodeWidthRatio:.05,weight:!1,nodePaddingRatio:.1,id:function(r){return r.id},source:function(r){return r.source},target:function(r){return r.target},sourceWeight:function(r){return r.value||1},targetWeight:function(r){return r.value||1},sortBy:null};function yz(r,n,t){w(r,function(e,i){e.inEdges=n.filter(function(a){return""+t.target(a)==""+i}),e.outEdges=n.filter(function(a){return""+t.source(a)==""+i}),e.edges=e.outEdges.concat(e.inEdges),e.frequency=e.edges.length,e.value=0,e.inEdges.forEach(function(a){e.value+=t.targetWeight(a)}),e.outEdges.forEach(function(a){e.value+=t.sourceWeight(a)})})}function mz(r,n){var t={weight:function(i,a){return a.value-i.value},frequency:function(i,a){return a.frequency-i.frequency},id:function(i,a){return(""+n.id(i)).localeCompare(""+n.id(a))}},e=t[n.sortBy];!e&&rt(n.sortBy)&&(e=n.sortBy),e&&r.sort(e)}function xz(r,n){var t=r.length;if(!t)throw new TypeError("Invalid nodes: it's empty!");if(n.weight){var e=n.nodePaddingRatio;if(e<0||e>=1)throw new TypeError("Invalid nodePaddingRatio: it must be in range [0, 1)!");var i=e/(2*t),a=n.nodeWidthRatio;if(a<=0||a>=1)throw new TypeError("Invalid nodeWidthRatio: it must be in range (0, 1)!");var o=0;r.forEach(function(u){o+=u.value}),r.forEach(function(u){u.weight=u.value/o,u.width=u.weight*(1-e),u.height=a}),r.forEach(function(u,l){for(var c=0,f=l-1;f>=0;f--)c+=r[f].width+2*i;var h=u.minX=i+c,v=u.maxX=u.minX+u.width,p=u.minY=n.y-a/2,d=u.maxY=p+a;u.x=[h,v,v,h],u.y=[p,p,d,d]})}else{var s=1/t;r.forEach(function(u,l){u.x=(l+.5)*s,u.y=n.y})}return r}function _z(r,n,t){if(t.weight){var e={};w(r,function(i,a){e[a]=i.value}),n.forEach(function(i){var a=t.source(i),o=t.target(i),s=r[a],u=r[o];if(s&&u){var l=e[a],c=t.sourceWeight(i),f=s.minX+(s.value-l)/s.value*s.width,h=f+c/s.value*s.width;e[a]-=c;var v=e[o],p=t.targetWeight(i),d=u.minX+(u.value-v)/u.value*u.width,g=d+p/u.value*u.width;e[o]-=p;var y=t.y;i.x=[f,h,d,g],i.y=[y,y,y,y],i.source=s,i.target=u}})}else n.forEach(function(i){var a=r[t.source(i)],o=r[t.target(i)];a&&o&&(i.x=[a.x,o.x],i.y=[a.y,o.y],i.source=a,i.target=o)});return n}function Cz(r){return zt({},gz,r)}function Ez(r,n){var t=Cz(r),e={},i=n.nodes,a=n.links;i.forEach(function(u){var l=t.id(u);e[l]=u}),yz(e,a,t),mz(i,t);var o=xz(i,t),s=_z(e,a,t);return{nodes:o,links:s}}var m2="x",x2="y",_2="name",C2="source",Sz={nodeStyle:{opacity:1,fillOpacity:1,lineWidth:1},edgeStyle:{opacity:.5,lineWidth:2},label:{fields:["x","name"],callback:function(r,n){var t=(r[0]+r[1])/2,e=t>.5?-4:4;return{labelEmit:!0,style:{fill:"#8c8c8c"},offsetX:e,content:n}}},tooltip:{showTitle:!1,showMarkers:!1,fields:["source","target","value","isNode"],showContent:function(r){return!F(r,[0,"data","isNode"])},formatter:function(r){var n=r.source,t=r.target,e=r.value;return{name:n+" -> "+t,value:e}}},interactions:[{type:"element-active"}],weight:!0,nodePaddingRatio:.1,nodeWidthRatio:.05};function bz(r){var n=r.options,t=n.data,e=n.sourceField,i=n.targetField,a=n.weightField,o=n.nodePaddingRatio,s=n.nodeWidthRatio,u=n.rawFields,l=u===void 0?[]:u,c=jb(t,e,i,a),f=Ez({weight:!0,nodePaddingRatio:o,nodeWidthRatio:s},c),h=f.nodes,v=f.links,p=h.map(function(g){return C(C({},Nt(g,Yt(["id","x","y","name"],l))),{isNode:!0})}),d=v.map(function(g){return C(C({source:g.source.name,target:g.target.name,name:g.source.name||g.target.name},Nt(g,Yt(["x","y","value"],l))),{isNode:!1})});return C(C({},r),{ext:C(C({},r.ext),{chordData:{nodesData:p,edgesData:d}})})}function Az(r){var n,t=r.chart;return t.scale((n={x:{sync:!0,nice:!0},y:{sync:!0,nice:!0,max:1}},n[_2]={sync:"color"},n[C2]={sync:"color"},n)),r}function Tz(r){var n=r.chart;return n.axis(!1),r}function Mz(r){var n=r.chart;return n.legend(!1),r}function wz(r){var n=r.chart,t=r.options,e=t.tooltip;return n.tooltip(e),r}function Lz(r){var n=r.chart;return n.coordinate("polar").reflect("y"),r}function Fz(r){var n=r.chart,t=r.options,e=r.ext.chordData.nodesData,i=t.nodeStyle,a=t.label,o=t.tooltip,s=n.createView();return s.data(e),xc({chart:s,options:{xField:m2,yField:x2,seriesField:_2,polygon:{style:i},label:a,tooltip:o}}),r}function kz(r){var n=r.chart,t=r.options,e=r.ext.chordData.edgesData,i=t.edgeStyle,a=t.tooltip,o=n.createView();o.data(e);var s={xField:m2,yField:x2,seriesField:C2,edge:{style:i,shape:"arc"},tooltip:a};return Qb({chart:o,options:s}),r}function Oz(r){var n=r.chart,t=r.options,e=t.animation;return typeof e=="boolean"?n.animate(e):n.animate(!0),w(KB(n),function(i){i.animate(e)}),r}function Rz(r){return ht(Ot,bz,Lz,Az,Tz,Mz,wz,kz,Fz,Qt,Ci,Oz)(r)}(function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.type="chord",t}return n.getDefaultOptions=function(){return Sz},n.prototype.getDefaultOptions=function(){return n.getDefaultOptions()},n.prototype.getSchemaAdaptor=function(){return Rz},n})(yt);var Iz={field:"value",as:["x","y","r"],sort:function(r,n){return n.value-r.value}};function Dz(r,n){n=zt({},Iz,n);var t=n.as;if(!V(t)||t.length!==3)throw new TypeError('Invalid as: it must be an array with 3 strings (e.g. [ "x", "y", "r" ])!');var e;try{e=Gp(n)}catch(l){console.warn(l)}var i=function(l){return RM().size(n.size).padding(n.padding)(_v(l).sum(function(c){return c[e]}).sort(n.sort))},a=i(r),o=t[0],s=t[1],u=t[2];return a.each(function(l){l[o]=l.x,l[s]=l.y,l[u]=l.r}),Vp(a)}function E2(r){var n=r.data,t=r.hierarchyConfig,e=r.rawFields,i=e===void 0?[]:e,a=r.enableDrillDown,o=Dz(n,C(C({},t),{field:"value",as:["x","y","r"]})),s=[];return o.forEach(function(u){for(var l,c=u.data.name,f=C({},u);f.depth>1;)c=((l=f.parent.data)===null||l===void 0?void 0:l.name)+" / "+c,f=f.parent;if(a&&u.depth>2)return null;var h=N({},u.data,C(C(C({},Nt(u.data,i)),{path:c}),u));h.ext=t,h[Ts]={hierarchyConfig:t,rawFields:i,enableDrillDown:a},s.push(h)}),s}function S2(r,n,t){var e=Mp([r,n]),i=e[0],a=e[1],o=e[2],s=e[3],u=t.width,l=t.height,c=u-(s+a),f=l-(i+o),h=Math.min(c,f),v=(c-h)/2,p=(f-h)/2,d=i+p,g=a+v,y=o+p,m=s+v,x=[d,g,y,m],_=h<0?0:h;return{finalPadding:x,finalSize:_}}var Pz=["x","y","r","name","value","path","depth"],Bz={colorField:"name",autoFit:!0,pointStyle:{lineWidth:0,stroke:"#fff"},legend:!1,hierarchyConfig:{size:[1,1],padding:0},label:{fields:["name"],layout:{type:"limit-in-shape"}},tooltip:{showMarkers:!1,showTitle:!1},drilldown:{enabled:!1}};function Nz(r){var n=r.chart,t=Math.min(n.viewBBox.width,n.viewBBox.height);return N({options:{size:function(e){var i=e.r;return i*t}}},r)}function zz(r){var n=r.options,t=r.chart,e=t.viewBBox,i=n.padding,a=n.appendPadding,o=n.drilldown,s=a;if(o!=null&&o.enabled){var u=dc(t.appendPadding,F(o,["breadCrumb","position"]));s=Mp([u,a])}var l=S2(i,s,e).finalPadding;return t.padding=l,t.appendPadding=0,r}function Uz(r){var n=r.chart,t=r.options,e=n.padding,i=n.appendPadding,a=t.color,o=t.colorField,s=t.pointStyle,u=t.hierarchyConfig,l=t.sizeField,c=t.rawFields,f=c===void 0?[]:c,h=t.drilldown,v=E2({data:t.data,hierarchyConfig:u,enableDrillDown:h==null?void 0:h.enabled,rawFields:f});n.data(v);var p=n.viewBBox,d=S2(e,i,p).finalSize,g=function(y){var m=y.r;return m*d};return l&&(g=function(y){return y[l]*d}),_r(N({},r,{options:{xField:"x",yField:"y",seriesField:o,sizeField:l,rawFields:Yt(Pz,f),point:{color:a,style:s,shape:"circle",size:g}}})),r}function Hz(r){return ht(oe({},{x:{min:0,max:1,minLimit:0,maxLimit:1,nice:!0},y:{min:0,max:1,minLimit:0,maxLimit:1,nice:!0}}))(r)}function $z(r){var n=r.chart,t=r.options,e=t.tooltip;if(e===!1)n.tooltip(!1);else{var i=e;F(e,"fields")||(i=N({},{customItems:function(a){return a.map(function(o){var s=F(n.getOptions(),"scales"),u=F(s,["name","formatter"],function(c){return c}),l=F(s,["value","formatter"],function(c){return c});return C(C({},o),{name:u(o.data.name),value:l(o.data.value)})})}},i)),n.tooltip(i)}return r}function Gz(r){var n=r.chart;return n.axis(!1),r}function Vz(r){var n=r.drilldown,t=r.interactions,e=t===void 0?[]:t;return n!=null&&n.enabled?N({},r,{interactions:Yt(e,[{type:"drill-down",cfg:{drillDownConfig:n,transformData:E2,enableDrillDown:!0}}])}):r}function Wz(r){var n=r.chart,t=r.options;return Qt({chart:n,options:Vz(t)}),r}function jz(r){return ht(xr("pointStyle"),Nz,zz,Ot,Hz,Uz,Gz,ho,$z,Wz,Ht,ne())(r)}(function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.type="circle-packing",t}return n.getDefaultOptions=function(){return Bz},n.prototype.getDefaultOptions=function(){return n.getDefaultOptions()},n.prototype.getSchemaAdaptor=function(){return jz},n.prototype.triggerResize=function(){this.chart.destroyed||(this.chart.forceFit(),this.chart.clear(),this.execAdaptor(),this.chart.render(!0))},n})(yt);(function(r){R(n,r);function n(t,e,i,a){var o=r.call(this,t,N({},a,e))||this;return o.type="g2-plot",o.defaultOptions=a,o.adaptor=i,o}return n.prototype.getDefaultOptions=function(){return this.defaultOptions},n.prototype.getSchemaAdaptor=function(){return this.adaptor},n})(yt);var Xz={line:eA,pie:fA,column:Cc,bar:oA,area:nA,gauge:f2,"tiny-line":xA,"tiny-column":_A,"tiny-area":mA,"ring-progress":MA,progress:AA,scatter:dA,histogram:EA,funnel:ZA,stock:jA},Yz={line:F4,pie:_3,column:t3,bar:s3,area:P4,gauge:i9,"tiny-line":Z7,"tiny-column":J7,"tiny-area":e8,"ring-progress":p8,progress:f8,scatter:x7,histogram:u8,funnel:hN,stock:G6},Zz={pie:{label:!1},column:{tooltip:{showMarkers:!1}},bar:{tooltip:{showMarkers:!1}}};function Bh(r,n,t){var e=Yz[r];if(!e){console.error("could not find "+r+" plot");return}var i=Xz[r];i({chart:n,options:N({},e.getDefaultOptions(),F(Zz,r,{}),t)})}function qz(r){var n=r.chart,t=r.options,e=t.views,i=t.legend;return w(e,function(a){var o=a.region,s=a.data,u=a.meta,l=a.axes,c=a.coordinate,f=a.interactions,h=a.annotations,v=a.tooltip,p=a.geometries,d=n.createView({region:o});d.data(s);var g={};l&&w(l,function(y,m){g[m]=Nt(y,tr)}),g=N({},u,g),d.scale(g),l?w(l,function(y,m){d.axis(m,y)}):d.axis(!1),d.coordinate(c),w(p,function(y){var m=or({chart:d,options:y}).ext,x=y.adjust;x&&m.geometry.adjust(x)}),w(f,function(y){y.enable===!1?d.removeInteraction(y.type):d.interaction(y.type,y.cfg)}),w(h,function(y){d.annotation()[y.type](C({},y))}),typeof a.animation=="boolean"?d.animate(!1):(d.animate(!0),w(d.geometries,function(y){y.animate(a.animation)})),v&&(d.interaction("tooltip"),d.tooltip(v))}),i?w(i,function(a,o){n.legend(o,a)}):n.legend(!1),n.tooltip(t.tooltip),r}function Kz(r){var n=r.chart,t=r.options,e=t.plots,i=t.data,a=i===void 0?[]:i;return w(e,function(o){var s=o.type,u=o.region,l=o.options,c=l===void 0?{}:l,f=o.top,h=c.tooltip;if(f){Bh(s,n,C(C({},c),{data:a}));return}var v=n.createView(C({region:u},Nt(c,Yb)));h&&v.interaction("tooltip"),Bh(s,v,C({data:a},c))}),r}function Qz(r){var n=r.chart,t=r.options;return n.option("slider",t.slider),r}function Jz(r){return ht(Ht,qz,Kz,Qt,Ht,Ot,me,Qz,ne())(r)}function tU(r,n){var t=r.getModel(),e=t.data,i;return V(e)?i=e[0][n]:i=e[n],i}function eU(r){var n=dl(r);w(n,function(t){t.hasState("active")&&t.setState("active",!1),t.hasState("selected")&&t.setState("selected",!1),t.hasState("inactive")&&t.setState("inactive",!1)})}var rU=function(r){R(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.getAssociationItems=function(t,e){var i,a=this.context.event,o=e||{},s=o.linkField,u=o.dim,l=[];if(!((i=a.data)===null||i===void 0)&&i.data){var c=a.data.data;w(t,function(f){var h,v,p=s;if(u==="x"?p=f.getXScale().field:u==="y"?p=(h=f.getYScales().find(function(g){return g.field===p}))===null||h===void 0?void 0:h.field:p||(p=(v=f.getGroupScales()[0])===null||v===void 0?void 0:v.field),!!p){var d=ie(dl(f),function(g){var y=!1,m=!1,x=V(c)?F(c[0],p):F(c,p);return tU(g,p)===x?y=!0:m=!0,{element:g,view:f,active:y,inactive:m}});l.push.apply(l,d)}})}return l},n.prototype.showTooltip=function(t){var e=z0(this.context.view),i=this.getAssociationItems(e,t);w(i,function(a){if(a.active){var o=a.element.shape.getCanvasBBox();a.view.showTooltip({x:o.minX+o.width/2,y:o.minY+o.height/2})}})},n.prototype.hideTooltip=function(){var t=z0(this.context.view);w(t,function(e){e.hideTooltip()})},n.prototype.active=function(t){var e=Vo(this.context.view),i=this.getAssociationItems(e,t);w(i,function(a){var o=a.active,s=a.element;o&&s.setState("active",!0)})},n.prototype.selected=function(t){var e=Vo(this.context.view),i=this.getAssociationItems(e,t);w(i,function(a){var o=a.active,s=a.element;o&&s.setState("selected",!0)})},n.prototype.highlight=function(t){var e=Vo(this.context.view),i=this.getAssociationItems(e,t);w(i,function(a){var o=a.inactive,s=a.element;o&&s.setState("inactive",!0)})},n.prototype.reset=function(){var t=Vo(this.context.view);w(t,function(e){eU(e)})},n}(ee);ct("association",rU);gt("association-active",{start:[{trigger:"element:mouseenter",action:"association:active"}],end:[{trigger:"element:mouseleave",action:"association:reset"}]});gt("association-selected",{start:[{trigger:"element:mouseenter",action:"association:selected"}],end:[{trigger:"element:mouseleave",action:"association:reset"}]});gt("association-highlight",{start:[{trigger:"element:mouseenter",action:"association:highlight"}],end:[{trigger:"element:mouseleave",action:"association:reset"}]});gt("association-tooltip",{start:[{trigger:"element:mousemove",action:"association:showTooltip"}],end:[{trigger:"element:mouseleave",action:"association:hideTooltip"}]});(function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.type="mix",t}return n.prototype.getSchemaAdaptor=function(){return Jz},n})(yt);function nU(r,n){var t=n.data,e=n.coordinate,i=n.interactions,a=n.annotations,o=n.animation,s=n.tooltip,u=n.axes,l=n.meta,c=n.geometries;t&&r.data(t);var f={};u&&w(u,function(h,v){f[v]=Nt(h,tr)}),f=N({},l,f),r.scale(f),e&&r.coordinate(e),u===!1?r.axis(!1):w(u,function(h,v){r.axis(v,h)}),w(c,function(h){var v=or({chart:r,options:h}).ext,p=h.adjust;p&&v.geometry.adjust(p)}),w(i,function(h){h.enable===!1?r.removeInteraction(h.type):r.interaction(h.type,h.cfg)}),w(a,function(h){r.annotation()[h.type](C({},h))}),typeof o=="boolean"?r.animate(!1):(r.animate(!0),w(r.geometries,function(h){h.animate(o)})),s?(r.interaction("tooltip"),r.tooltip(s)):s===!1&&r.removeInteraction("tooltip")}function iU(r){var n=r.chart,t=r.options,e=t.type,i=t.data,a=t.fields,o=t.eachView,s=Bl(t,["type","data","fields","eachView","axes","meta","tooltip","coordinate","theme","legend","interactions","annotations"]);return n.data(i),n.facet(e,C(C({},s),{fields:a,eachView:function(u,l){var c=o(u,l);if(c.geometries)nU(u,c);else{var f=c,h=f.options;h.tooltip&&u.interaction("tooltip"),Bh(f.type,u,h)}}})),r}function aU(r){var n=r.chart,t=r.options,e=t.axes,i=t.meta,a=t.tooltip,o=t.coordinate,s=t.theme,u=t.legend,l=t.interactions,c=t.annotations,f={};return e&&w(e,function(h,v){f[v]=Nt(h,tr)}),f=N({},i,f),n.scale(f),n.coordinate(o),e?w(e,function(h,v){n.axis(v,h)}):n.axis(!1),a?(n.interaction("tooltip"),n.tooltip(a)):a===!1&&n.removeInteraction("tooltip"),n.legend(u),s&&n.theme(s),w(l,function(h){h.enable===!1?n.removeInteraction(h.type):n.interaction(h.type,h.cfg)}),w(c,function(h){n.annotation()[h.type](C({},h))}),r}function oU(r){return ht(Ot,iU,aU)(r)}var sU={title:{style:{fontSize:12,fill:"rgba(0,0,0,0.65)"}},rowTitle:{style:{fontSize:12,fill:"rgba(0,0,0,0.65)"}},columnTitle:{style:{fontSize:12,fill:"rgba(0,0,0,0.65)"}}};(function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.type="area",t}return n.getDefaultOptions=function(){return sU},n.prototype.getDefaultOptions=function(){return n.getDefaultOptions()},n.prototype.getSchemaAdaptor=function(){return oU},n})(yt);var xy;(function(r){r.DEV="DEV",r.BETA="BETA",r.STABLE="STABLE"})(xy||(xy={}));Xb("en-US",c4);Xb("zh-CN",f4);var _y=new Map,Cy=new Map,Ey=new Map,Pi={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.ITEM_TPL=r.CONTAINER_TPL=r.VALUE_CLASS=r.NAME_CLASS=r.LIST_ITEM_CLASS=r.LIST_CLASS=r.TITLE_CLASS=r.CONTAINER_CLASS=void 0,r.CONTAINER_CLASS="l7plot-tooltip",r.TITLE_CLASS="l7plot-tooltip__title",r.LIST_CLASS="l7plot-tooltip__list",r.LIST_ITEM_CLASS="l7plot-tooltip__list-item",r.NAME_CLASS="l7plot-tooltip__name",r.VALUE_CLASS="l7plot-tooltip__value",r.CONTAINER_TPL='<div class="'.concat(r.CONTAINER_CLASS,`">
  <div class="`).concat(r.TITLE_CLASS,`"></div>
  <ul class="`).concat(r.LIST_CLASS,`"></ul>
</div>`),r.ITEM_TPL='<li class="'.concat(r.LIST_ITEM_CLASS,`" data-index={index}>
  <span class="`).concat(r.NAME_CLASS,`">{name}</span>
  <span class="`).concat(r.VALUE_CLASS,`">{value}</span>
</li>`)})(Pi);var Bi={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.ITEM_TPL=r.CONTAINER_TPL=r.VALUE_CLASS=r.MARKER_CLASS=r.LIST_ITEM_CLASS=r.LIST_CLASS=r.TITLE_CLASS=r.CONTAINER_CLASS=void 0,r.CONTAINER_CLASS="l7plot-legend l7plot-legend__category",r.TITLE_CLASS="l7plot-legend__title",r.LIST_CLASS="l7plot-legend__category-list",r.LIST_ITEM_CLASS="l7plot-legend__list-item",r.MARKER_CLASS="l7plot-legend__category-marker",r.VALUE_CLASS="l7plot-legend__category-value",r.CONTAINER_TPL='<div class="'.concat(r.CONTAINER_CLASS,`">
  <div class="`).concat(r.TITLE_CLASS,`"></div>
  <ul class="`).concat(r.LIST_CLASS,`"></ul>
</div>`),r.ITEM_TPL='<li class="'.concat(r.LIST_ITEM_CLASS,`" data-index={index}>
  <span class="`).concat(r.MARKER_CLASS,`" style="background:{color}"></span>
  <span class="`).concat(r.VALUE_CLASS,`">{value}</span>
</li>`)})(Bi);var Ia={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.RIBBON_TPL=r.CONTAINER_TPL=r.VALUE_RANGE_CLASS=r.GRADIENT_BAR_CLASS=r.RIBBON_CLASS=r.RIBBON_CONTAINER_CLASS=r.TITLE_CLASS=r.CONTAINER_CLASS=void 0,r.CONTAINER_CLASS="l7plot-legend l7plot-legend__continue",r.TITLE_CLASS="l7plot-legend__title",r.RIBBON_CONTAINER_CLASS="l7plot-legend__ribbon-container",r.RIBBON_CLASS="l7plot-legend__ribbon",r.GRADIENT_BAR_CLASS="l7plot-legend__gradient-bar",r.VALUE_RANGE_CLASS="l7plot-legend__value-range",r.CONTAINER_TPL='<div class="'.concat(r.CONTAINER_CLASS,`">
  <div class="`).concat(r.TITLE_CLASS,`"></div>
  <div class="`).concat(r.RIBBON_CONTAINER_CLASS,`"></div>
</div>`),r.RIBBON_TPL='<div class="'.concat(r.RIBBON_CLASS,`">
  <span class="`).concat(r.VALUE_RANGE_CLASS,`">{min}</span>
  <div class="`).concat(r.GRADIENT_BAR_CLASS,`" style="background-image: {backgroundImage}"></div>
  <span class="`).concat(r.VALUE_RANGE_CLASS,`">{max}</span>
</div>`)})(Ia);function b2(r){var n,t,e,i={point:{default:{fill:r.pointFillColor,size:r.pointSize,stroke:r.pointBorderColor,lineWidth:r.pointBorder,fillOpacity:r.pointFillOpacity},active:{fill:r.pointActiveFillColor},selected:{fill:r.pointSelectedFillColor}}};return{mapStyle:r.mapStyle,defaultColor:r.brandColor,subColor:r.subColor,semanticRed:r.paletteSemanticRed,semanticGreen:r.paletteSemanticGreen,fontFamily:r.fontFamily,colors10:r.paletteQualitative10,colors20:r.paletteQualitative20,sequenceColors:r.paletteSequence,shapes:{point:["circle","square"],line:["line"]},sizes:[1,10],geometries:{point:{circle:{default:{style:i.point.default},active:{style:i.point.active},selected:{style:i.point.selected}}},line:{},polygon:{}},components:{legend:{category:{domStyles:(n={},n[Bi.CONTAINER_CLASS]={visibility:"visible",zIndex:1,backgroundColor:r.legendContainerFillColor,boxShadow:r.legendContainerShadow,borderRadius:"".concat(r.legendContainerBorderRadius,"px"),color:r.legendTextFillColor,fontFamily:r.fontFamily,padding:"10px",lineHeight:"1",fontSize:"".concat(r.legendTextFontSize,"px")},n[Bi.TITLE_CLASS]={fontSize:"13px",lineHeight:"19px",marginBottom:"8px"},n[Bi.LIST_CLASS]={margin:"0px",padding:"0px"},n[Bi.LIST_ITEM_CLASS]={marginBottom:"2px"},n[Bi.MARKER_CLASS]={width:"10px",height:"10px"},n[Bi.VALUE_CLASS]={paddingLeft:"8px"},n)},continue:{domStyles:(t={},t[Ia.CONTAINER_CLASS]={visibility:"visible",zIndex:1,backgroundColor:r.legendContainerFillColor,boxShadow:r.legendContainerShadow,borderRadius:"".concat(r.legendContainerBorderRadius,"px"),color:r.legendTextFillColor,fontFamily:r.fontFamily,padding:"10px",lineHeight:1,fontSize:"".concat(r.legendTextFontSize,"px")},t[Ia.TITLE_CLASS]={fontSize:"13px",lineHeight:"19px",marginBottom:"8px"},t[Ia.RIBBON_CLASS]={display:"flex",alignItems:"center"},t[Ia.GRADIENT_BAR_CLASS]={width:"140px",height:"14px",margin:"0px 5px"},t[Ia.VALUE_RANGE_CLASS]={padding:"0px"},t)}},tooltip:{domStyles:(e={},e[Pi.CONTAINER_CLASS]={visibility:"visible",zIndex:999,transition:"visibility 0.2s cubic-bezier(0.23, 1, 0.32, 1), left 0.4s cubic-bezier(0.23, 1, 0.32, 1), top 0.4s cubic-bezier(0.23, 1, 0.32, 1)",backgroundColor:r.tooltipContainerFillColor,boxShadow:r.tooltipContainerShadow,borderRadius:"".concat(r.tooltipContainerBorderRadius,"px"),color:r.tooltipTextFillColor,fontSize:"".concat(r.tooltipTextFontSize,"px"),fontFamily:r.fontFamily,lineHeight:r.tooltipTextLineHeight},e[Pi.TITLE_CLASS]={marginBottom:"4px"},e[Pi.LIST_CLASS]={margin:"0px",padding:"0px"},e[Pi.LIST_ITEM_CLASS]={marginBottom:"4px"},e[Pi.NAME_CLASS]={color:r.tooltipItemNameFillColor},e[Pi.VALUE_CLASS]={color:r.tooltipItemValueFillColor,marginLeft:"30px"},e)},label:{style:{textAnchor:"center",textOffset:[0,0],fill:r.labelFillColor,fontSize:r.labelFontSize,fontFamily:r.fontFamily,fillColorDark:r.labelFillColorDark,fillColorLight:r.labelFillColorLight}}}}}var Ai={100:"#000",95:"#0D0D0D",85:"#262626",65:"#595959",45:"#8C8C8C",25:"#BFBFBF",15:"#D9D9D9",6:"#F0F0F0"},uU={100:"#FFFFFF",95:"#F2F2F2",85:"#D9D9D9",65:"#A6A6A6",45:"#737373",25:"#404040",15:"#262626",6:"#0F0F0F"},lU=["#5B8FF9","#5AD8A6","#5D7092","#F6BD16","#6F5EF9","#6DC8EC","#945FB9","#FF9845","#1E9493","#FF99C3"],cU=["#5B8FF9","#CDDDFD","#5AD8A6","#CDF3E4","#5D7092","#CED4DE","#F6BD16","#FCEBB9","#6F5EF9","#D3CEFD","#6DC8EC","#D3EEF9","#945FB9","#DECFEA","#FF9845","#FFE0C7","#1E9493","#BBDEDE","#FF99C3","#FFE0ED"],fU=["#B8E1FF","#9AC5FF","#7DAAFF","#5B8FF9","#3D76DD","#085EC0","#0047A5","#00318A","#001D70"],A2=function(r){r===void 0&&(r={});var n=r.mapStyle,t=n===void 0?"light":n,e=r.subColor,i=e===void 0?"rgba(0,0,0,0.05)":e,a=r.paletteQualitative10,o=a===void 0?lU:a,s=r.paletteQualitative20,u=s===void 0?cU:s,l=r.paletteSemanticRed,c=l===void 0?"#F4664A":l,f=r.paletteSemanticGreen,h=f===void 0?"#30BF78":f,v=r.paletteSemanticYellow,p=v===void 0?"#FAAD14":v,d=r.paletteSequence,g=d===void 0?fU:d,y=r.fontFamily,m=y===void 0?`"-apple-system", "Segoe UI", Roboto, "Helvetica Neue", Arial,
    "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol",
    "Noto Color Emoji"`:y,x=r.brandColor,_=x===void 0?o[0]:x;return{mapStyle:t,brandColor:_,subColor:i,paletteQualitative10:o,paletteQualitative20:u,paletteSemanticRed:c,paletteSemanticGreen:h,paletteSemanticYellow:p,paletteSequence:g,fontFamily:m,legendContainerFillColor:"rgba(255, 255, 255, 0.85)",legendContainerShadow:"0 2px 8px 0 rgba(166, 166, 166, 0.20)",legendContainerBorderRadius:2,legendTextFillColor:Ai[65],legendTextFontSize:12,tooltipContainerFillColor:"rgba(255, 255, 255, 0.9)",tooltipContainerShadow:"rgb(0 0 0 / 16%) 0px 6px 12px 0px",tooltipContainerBorderRadius:2,tooltipTextFillColor:Ai[65],tooltipItemNameFillColor:Ai[65],tooltipItemValueFillColor:Ai[65],tooltipTextFontSize:12,tooltipTextLineHeight:"20px",labelFillColor:Ai[65],labelFillColorDark:"#2c3542",labelFillColorLight:"#ffffff",labelFontSize:12,pointFillColor:_,pointFillOpacity:.95,pointSize:4,pointBorder:1,pointBorderColor:uU[100],pointActiveBorderColor:Ai[100],pointSelectedBorderColor:Ai[100]}};A2();var hU={100:"#000",95:"#0D0D0D",85:"#262626",65:"#595959",45:"#8C8C8C",25:"#BFBFBF",15:"#D9D9D9",6:"#F0F0F0"},Ti={100:"#FFFFFF",95:"#F2F2F2",85:"#D9D9D9",65:"#A6A6A6",45:"#737373",25:"#404040",15:"#262626",6:"#0F0F0F"},Sy=["#5B8FF9","#5AD8A6","#5D7092","#F6BD16","#E86452","#6DC8EC","#945FB9","#FF9845","#1E9493","#FF99C3"],vU=["#5B8FF9","#CDDDFD","#5AD8A6","#CDF3E4","#5D7092","#CED4DE","#F6BD16","#FCEBB9","#E86452","#F8D0CB","#6DC8EC","#D3EEF9","#945FB9","#DECFEA","#FF9845","#FFE0C7","#1E9493","#BBDEDE","#FF99C3","#FFE0ED"],pU=["#B8E1FF","#9AC5FF","#7DAAFF","#5B8FF9","#3D76DD","#085EC0","#0047A5","#00318A","#001D70"],T2=function(r){r===void 0&&(r={});var n=r.mapStyle,t=n===void 0?"dark":n,e=r.subColor,i=e===void 0?"rgba(255,255,255,0.05)":e,a=r.paletteQualitative10,o=a===void 0?Sy:a,s=r.paletteQualitative20,u=s===void 0?vU:s,l=r.paletteSemanticRed,c=l===void 0?"#F4664A":l,f=r.paletteSemanticGreen,h=f===void 0?"#30BF78":f,v=r.paletteSemanticYellow,p=v===void 0?"#FAAD14":v,d=r.paletteSequence,g=d===void 0?pU:d,y=r.fontFamily,m=y===void 0?`"-apple-system", "Segoe UI", Roboto, "Helvetica Neue", Arial,
    "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol",
    "Noto Color Emoji"`:y,x=r.brandColor,_=x===void 0?o[0]:x;return{mapStyle:t,brandColor:_,subColor:i,paletteQualitative10:o,paletteQualitative20:u,paletteSemanticRed:c,paletteSemanticGreen:h,paletteSemanticYellow:p,paletteSequence:g,fontFamily:m,legendContainerFillColor:"rgba(31, 31, 31, 0.85)",legendContainerShadow:"0 2px 8px 0 rgba(166, 166, 166, 0.20)",legendContainerBorderRadius:2,legendTextFillColor:Ti[65],legendTextFontSize:12,tooltipContainerFillColor:"rgba(31, 31, 31, 0.9)",tooltipContainerShadow:"0px 2px 4px rgba(0, 0, 0, 0.5)",tooltipContainerBorderRadius:2,tooltipTextFillColor:Ti[65],tooltipItemNameFillColor:Ti[65],tooltipItemValueFillColor:Ti[65],tooltipTextFontSize:12,tooltipTextLineHeight:"20px",labelFillColor:Ti[65],labelFillColorDark:"#2c3542",labelFillColorLight:"#ffffff",labelFontSize:12,pointFillColor:Sy[0],pointFillOpacity:.95,pointSize:4,pointBorder:1,pointBorderColor:hU[100],pointActiveBorderColor:Ti[100],pointSelectedBorderColor:Ti[100]}};T2();function M2(r){var n=r.styleSheet,t=n===void 0?{}:n,e=Tt(r,["styleSheet"]),i=A2(t);return J({},b2(i),e)}function dU(r){var n=r.styleSheet,t=n===void 0?{}:n,e=Tt(r,["styleSheet"]),i=T2(t);return J({},b2(i),e)}var by=M2({}),gU=dU({}),Ay={default:by,light:by,dark:gU};function Nh(r){return r===void 0&&(r="default"),F(Ay,la(r),Ay.default)}var P={IEventEmitter:Symbol.for("IEventEmitter"),ISceneService:Symbol.for("ISceneService"),IGlobalConfigService:Symbol.for("IGlobalConfigService"),ICameraService:Symbol.for("ICameraService"),ICoordinateSystemService:Symbol.for("ICoordinateSystemService"),ILayerService:Symbol.for("ILayerService"),ILayerMappingService:Symbol.for("ILayerMappingService"),ILayerStyleService:Symbol.for("ILayerStyleService"),IMapService:Symbol.for("IMapService"),IMarkerService:Symbol.for("IMarkerService"),IPopupService:Symbol.for("PopupService"),IFactoryMapService:Symbol.for("Factory<IMapService>"),IRendererService:Symbol.for("IRendererService"),IShaderModuleService:Symbol.for("IShaderModuleService"),IIconService:Symbol.for("IIconService"),IFontService:Symbol.for("IFontService"),IInteractionService:Symbol.for("IInteractionService"),IPickingService:Symbol.for("IPickingService"),IControlService:Symbol.for("IControlService"),IStyleAttributeService:Symbol.for("IStyleAttributeService"),ILayer:Symbol.for("ILayer"),ILayerPlugin:Symbol.for("ILayerPlugin"),INormalPass:Symbol.for("INormalPass"),IPostProcessor:Symbol.for("IPostProcessor"),IPostProcessingPass:Symbol.for("IPostProcessingPass"),IFactoryPostProcessingPass:Symbol.for("Factory<IPostProcessingPass>"),IFactoryNormalPass:Symbol.for("Factory<IFactoryNormalPass>"),IMultiPassRenderer:Symbol.for("IMultiPassRenderer"),SceneID:Symbol.for("SceneID"),MapConfig:Symbol.for("MapConfig")},jo="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function qp(r){this.message=r}qp.prototype=new Error;qp.prototype.name="InvalidCharacterError";function yU(r){var n=String(r).replace(/=+$/,"");if(n.length%4===1)throw new qp("'atob' failed: The string to be decoded is not correctly encoded.");for(var t="",e=0,i,a,o=0;a=n.charAt(o++);~a&&(i=e%4?i*64+a:a,e++%4)?t+=String.fromCharCode(255&i>>(-2*e&6)):0)a=jo.indexOf(a);return t}function w2(r){r=String(r);for(var n,t,e,i,a="",o=0,s=r.length%3;o<r.length;){if((t=r.charCodeAt(o++))>255||(e=r.charCodeAt(o++))>255||(i=r.charCodeAt(o++))>255)throw new TypeError("Failed to execute 'btoa' on 'Window': The string to be encoded contains characters outside of the Latin1 range.");n=t<<16|e<<8|i,a+=jo.charAt(n>>18&63)+jo.charAt(n>>12&63)+jo.charAt(n>>6&63)+jo.charAt(n&63)}return s?a.slice(0,s-3)+"===".substring(s):a}var mU=function(){function r(n,t){$(this,r),this.buffers=n,this.type=t}return H(r,[{key:"arraybuffer",value:function(){return Promise.resolve(this.buffers[0])}},{key:"stream",value:function(){throw new Error("not implemented")}},{key:"text",value:function(){throw new Error("not implemented")}},{key:"slice",value:function(t,e,i){throw new Error("not implemented")}}]),r}(),Lr;typeof window>"u"?Lr={devicePixelRatio:1,navigator:{userAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.69 Safari/537.36",browserLanguage:"zh-CN",language:"zh-CN",platform:""},location:"",document:{documentElement:{style:{}},createEvent:function(){return!0},getElementById:function(n){return!0},createElement:function(){return{className:"",classList:{add:function(){return""}}}},createElementNS:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},querySelector:function(){return!1}},performance:{mark:function(n){return null},clearMeasures:function(n){return null},clearMarks:function(n){return null},measure:function(n,t,e){return{duration:0}},now:function(){return new Date().getTime()}},Blob:"",dispatchEvent:function(n){return!0},Event:function(n,t){return!0},createElement:function(){return!0},createElementNS:function(){return!0},XMLHttpRequest:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},requestAnimationFrame:function(){return!0},cancelAnimationFrame:function(){return!0},clearTimeout:function(){return!0}}:Lr=window;var xU=typeof my<"u"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;const _U=xU?my.getSystemInfoSync().pixelRatio:Lr.devicePixelRatio;var L2=H(function r(n,t){$(this,r),this.cancelBubble=!1,this.cancelable=!1,this.target=null,this.currentTarget=null,this.preventDefault=function(){},this.stopPropagation=function(){},this.type=n,this.timeStamp=Date.now()});function CU(r,n){var t=typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(!t){if(Array.isArray(r)||(t=EU(r))||n&&r&&typeof r.length=="number"){t&&(r=t);var e=0,i=function(){};return{s:i,n:function(){return e>=r.length?{done:!0}:{done:!1,value:r[e++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){t=t.call(r)},n:function(){var l=t.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(o)throw s}}}}function EU(r,n){if(!!r){if(typeof r=="string")return Ty(r,n);var t=Object.prototype.toString.call(r).slice(8,-1);if(t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set")return Array.from(r);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Ty(r,n)}}function Ty(r,n){(n==null||n>r.length)&&(n=r.length);for(var t=0,e=new Array(n);t<n;t++)e[t]=r[t];return e}var Fo=new WeakMap,Kp=function(){function r(){$(this,r),Fo.set(this,{})}return H(r,[{key:"addEventListener",value:function(t,e){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},a=Fo.get(this);a||(a={}),a[t]||(a[t]=[]),a[t].push(e),Fo.set(this,a),i.capture,i.once,i.passive}},{key:"removeEventListener",value:function(t,e){var i=Fo.get(this);if(i){var a=i[t];if(a&&a.length>0){for(var o=a.length;o--;o>0)if(a[o]===e){a.splice(o,1);break}}}}},{key:"dispatchEvent",value:function(t){var e=Fo.get(this)[t.type];if(e){var i=CU(e),a;try{for(i.s();!(a=i.n()).done;){var o=a.value;o(t)}}catch(s){i.e(s)}finally{i.f()}}}}]),r}();function SU(r){var n=bU();return function(){var e=B(r),i;if(n){var a=B(this).constructor;i=Reflect.construct(e,arguments,a)}else i=e.apply(this,arguments);return et(this,i)}}function bU(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var F2=function(r){tt(t,r);var n=SU(t);function t(){var e;return $(this,t),e=n.call(this),e.childNodes=[],e}return H(t,[{key:"appendChild",value:function(i){this.childNodes.push(i)}},{key:"cloneNode",value:function(){var i=Object.create(this);return Object.assign(i,this),i}},{key:"removeChild",value:function(i){var a=this.childNodes.findIndex(function(o){return o===i});return a>-1?this.childNodes.splice(a,1):null}}]),t}(Kp);function AU(r){var n=TU();return function(){var e=B(r),i;if(n){var a=B(this).constructor;i=Reflect.construct(e,arguments,a)}else i=e.apply(this,arguments);return et(this,i)}}function TU(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var k2=function(r){tt(t,r);var n=AU(t);function t(){var e;return $(this,t),e=n.call(this),e.className="",e.children=[],e}return H(t,[{key:"setAttribute",value:function(i,a){this[i]=a}},{key:"getAttribute",value:function(i){return this[i]}},{key:"setAttributeNS",value:function(i,a){this[i]=a}},{key:"getAttributeNS",value:function(i){return this[i]}}]),t}(F2),MU=typeof my<"u"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,zh,Uh,Hh,$h;if(MU){var Fu=my.getSystemInfoSync();zh=Fu.screenWidth,Uh=Fu.screenHeight,Hh=Fu.windowWidth,$h=Fu.windowHeight}else{var My=Lr.innerWidth,wy=Lr.innerHeight;zh=My,Uh=wy,Hh=My,$h=wy}var ns={width:zh,height:Uh,availWidth:Hh,availHeight:$h,availLeft:0,availTop:0},Mc=ns.availWidth,wc=ns.availHeight,Ly={style:[]};function O2(r,n){if(!("parentNode"in r)){var t;n===0?t=function(){return null}:n===1?t=function(){return Ly}:t=function(){return null},Object.defineProperty(r,"parentNode",{enumerable:!0,get:t})}if(!("parentElement"in r)){var e;n===0?e=function(){return null}:n===1?e=function(){return Ly}:e=function(){return null},Object.defineProperty(r,"parentElement",{enumerable:!0,get:e})}}function wU(r){r.style=r.style||{},Object.assign(r.style,{top:"0px",left:"0px",width:Mc+"px",height:wc+"px",margin:"0px",padding:"0px"})}function LU(r){"clientLeft"in r||(r.clientLeft=0,r.clientTop=0),"clientWidth"in r||(r.clientWidth=Mc,r.clientHeight=wc),"getBoundingClientRect"in r||(r.getBoundingClientRect=function(){var n={x:0,y:0,top:0,left:0,width:this.clientWidth,height:this.clientHeight,right:this.clientWidth,bottom:this.clientHeight};return n})}function FU(r){"offsetLeft"in r||(r.offsetLeft=0,r.offsetTop=0),"offsetWidth"in r||(r.offsetWidth=Mc,r.offsetHeight=wc)}function kU(r){"scrollLeft"in r||(r.scrollLeft=0,r.scrollTop=0),"scrollWidth"in r||(r.scrollWidth=Mc,r.scrollHeight=wc)}function R2(r){var n=function(){return!0};r.classList=[],r.classList.add=n,r.classList.remove=n,r.classList.contains=n,r.classList.toggle=n}function OU(r){var n=RU();return function(){var e=B(r),i;if(n){var a=B(this).constructor;i=Reflect.construct(e,arguments,a)}else i=e.apply(this,arguments);return et(this,i)}}function RU(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Ea(){}var go=function(r){tt(t,r);var n=OU(t);function t(){var e,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",a=arguments.length>1?arguments[1]:void 0;return $(this,t),e=n.call(this),e.className="",e.children=[],e.focus=Ea,e.blur=Ea,e.insertBefore=Ea,e.appendChild=Ea,e.removeChild=Ea,e.remove=Ea,e.innerHTML="",e.tagName=i.toUpperCase(),O2(I(e),a),wU(I(e)),R2(I(e)),LU(I(e)),FU(I(e)),kU(I(e)),e}return H(t)}(k2);function IU(r){var n=DU();return function(){var e=B(r),i;if(n){var a=B(this).constructor;i=Reflect.construct(e,arguments,a)}else i=e.apply(this,arguments);return et(this,i)}}function DU(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var I2=function(r){tt(t,r);var n=IU(t);function t(e){return $(this,t),n.call(this,e)}return H(t,[{key:"addTextTrack",value:function(){}},{key:"captureStream",value:function(){}},{key:"fastSeek",value:function(){}},{key:"load",value:function(){}},{key:"pause",value:function(){}},{key:"play",value:function(){}}]),t}(go);function PU(r){var n=BU();return function(){var e=B(r),i;if(n){var a=B(this).constructor;i=Reflect.construct(e,arguments,a)}else i=e.apply(this,arguments);return et(this,i)}}function BU(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var D2=function(r){tt(t,r);var n=PU(t);function t(){return $(this,t),n.call(this,"video")}return H(t)}(I2),NU={};function Qp(){return NU}var P2=H(function r(){$(this,r);var n=Qp(),t=n.createImage&&n.createImage()||{};return"tagName"in t||(t.tagName="IMG",t.__proto__=r.prototype),O2(t),R2(t),Object.assign(t,{addEventListener:function(i,a){t["on".concat(i)]=a.bind(t)},removeEventListener:function(i){t["on".concat(i)]=null}}),t}),B2={href:"",protocol:"",host:""};function N2(r){var n=zU();return function(){var e=B(r),i;if(n){var a=B(this).constructor;i=Reflect.construct(e,arguments,a)}else i=e.apply(this,arguments);return et(this,i)}}function zU(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var UU=function(r){tt(t,r);var n=N2(t);function t(){return $(this,t),n.call(this,"body",0)}return H(t,[{key:"addEventListener",value:function(i,a){}},{key:"removeEventListener",value:function(i,a,o){}},{key:"dispatchEvent",value:function(i){}}]),t}(go),HU=function(r){tt(t,r);var n=N2(t);function t(){return $(this,t),n.call(this,"html",0)}return H(t,[{key:"addEventListener",value:function(i,a){}},{key:"removeEventListener",value:function(i,a){}},{key:"dispatchEvent",value:function(i){}}]),t}(go),ko={},Wi={readyState:"complete",visibilityState:"visible",hidden:!1,fullscreen:!0,scripts:[],style:{},location:B2,ontouchstart:null,ontouchmove:null,ontouchend:null,onvisibilitychange:null,parentNode:null,parentElement:null,head:null,body:null,documentElement:{style:[]},createElement:function(n){return n=n.toLowerCase(),n==="canvas"?my.createOffscreenCanvas(1024,128,"2d"):n==="img"?new P2:n==="video"?new D2:new go(n)},createElementNS:function(n,t){return this.createElement(t)},createTextNode:function(n){return n},getElementById:function(n){return null},getElementsByTagName:function(n){return n=n.toLowerCase(),[]},getElementsByTagNameNS:function(n,t){return this.getElementsByTagName(t)},getElementsByName:function(n){return[]},querySelector:function(n){return null},querySelectorAll:function(n){return[]},addEventListener:function(n,t,e){ko[n]||(ko[n]=[]),ko[n].push(t)},removeEventListener:function(n,t){var e=ko[n];if(e&&e.length>0){for(var i=e.length;i--;i>0)if(e[i]===t){e.splice(i,1);break}}},dispatchEvent:function(n){var t=n.type,e=ko[t];if(e)for(var i=0;i<e.length;i++)e[i](n);n.target&&typeof n.target["on"+t]=="function"&&n.target["on"+t](n)},createEvent:function(n){return new L2(n)}};Wi.documentElement=new HU;Wi.head=new go("head");Wi.body=new UU;var $U=Object,GU=function(){function r(){$(this,r);var n=arguments.length;if(n===2){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){this._w=arguments[0],this._h=arguments[1],this._data=new Uint8ClampedArray(this._w*this._h*4);return}}else n===3&&ZC(arguments[0])==="object"&&typeof arguments[1]=="number"&&typeof arguments[2]=="number"&&(this._data=arguments[0],this._w=arguments[1],this._h=arguments[2]);throw new Error("ImageData: params error")}return H(r,[{key:"width",get:function(){return this._w}},{key:"height",get:function(){return this._h}},{key:"data",get:function(){return this._data}}]),r}(),VU=typeof my<"u"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,Gh,Xe,Cl;if(VU){var _f=my.getSystemInfoSync();Gh=_f.system,Xe=_f.platform,Cl=_f.language}else{var ur={versions:function(){var r=Lr.navigator.userAgent;return{trident:r.indexOf("Trident")>-1,presto:r.indexOf("Presto")>-1,webKit:r.indexOf("AppleWebKit")>-1,gecko:r.indexOf("Gecko")>-1&&r.indexOf("KHTML")===-1,mobile:!!r.match(/AppleWebKit.*Mobile.*/),ios:!!r.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:r.indexOf("Android")>-1||r.indexOf("Linux")>-1,iPhone:r.indexOf("iPhone")>-1,iPad:r.indexOf("iPad")>-1,webApp:r.indexOf("Safari")===-1,weixin:r.indexOf("MicroMessenger")>-1,qq:r.match(/\sQQ/i)===" qq"}}(),language:(Lr.navigator.browserLanguage||Lr.navigator.language).toLowerCase()};ur.versions.android?Xe="android":ur.versions.trident?Xe="IE":ur.versions.presto?Xe="Opera":ur.versions.webKit?Xe="webKit":ur.versions.gecko?Xe="Firefox":ur.versions.mobile?Xe="mobile":ur.versions.ios?Xe="ios":ur.versions.iPhone?Xe="iPhone":ur.versions.iPad?Xe="ipad":ur.versions.webApp?Xe="webApp":ur.versions.weixin?Xe="weixin":ur.versions.qq&&(Xe="qq"),Gh=Lr.navigator.userAgent,Cl=ur.language}var WU=Gh.toLowerCase().indexOf("android")!==-1,z2=WU?"Android; CPU Android 6.0":"iPhone; CPU iPhone OS 10_3_1 like Mac OS X",jU="Mozilla/5.0 (".concat(z2,") AppleWebKit/603.1.30 (KHTML, like Gecko) Mobile/14E8301 MicroMessenger/6.6.0 MiniGame NetType/WIFI Language/").concat(Cl),XU={platform:Xe,language:Cl,appVersion:"5.0 (".concat(z2,") AppleWebKit/601.1.46 (KHTML, like Gecko) Version/9.0 Mobile/13B143 Safari/601.1"),userAgent:jU},YU={mark:function(n){return null},clearMeasures:function(n){return null},clearMarks:function(n){return null},measure:function(n,t,e){return{duration:0}},now:function(){}},Fy=0,ky=0;function ZU(r){var n=Date.now(),t=Math.max(Fy+23,n);return ky=setTimeout(function(){r(Fy=t)},t-n),ky}function qU(r){var n=Qp();return n.requestAnimationFrame?n.requestAnimationFrame(r):ZU(r)}function KU(r){var n=Qp();return n.cancelAnimationFrame?n.cancelAnimationFrame(r):clearTimeout(r)}var QU=function(){function r(n){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if($(this,r),n.indexOf("http://")==0||n.indexOf("https://")==0){this.href=n;return}this.href=t+n}return H(r,null,[{key:"createObjectURL",value:function(t){var e=t.buffers[0],i=t.type,a=JU(e),o="data:".concat(i,";base64, ");return o+a}}]),r}();function JU(r){for(var n="",t=new Uint8Array(r),e=t.byteLength,i=0;i<e;i++)n+=String.fromCharCode(t[i]);return w2(n)}var tH={GCCSO_SHADER_BINARY_FJ:37472,_3DC_XY_AMD:34810,_3DC_X_AMD:34809,ACTIVE_ATTRIBUTES:35721,ACTIVE_ATTRIBUTE_MAX_LENGTH:35722,ACTIVE_PROGRAM_EXT:33369,ACTIVE_TEXTURE:34016,ACTIVE_UNIFORMS:35718,ACTIVE_UNIFORM_MAX_LENGTH:35719,ALIASED_LINE_WIDTH_RANGE:33902,ALIASED_POINT_SIZE_RANGE:33901,ALL_COMPLETED_NV:34034,ALL_SHADER_BITS_EXT:4294967295,ALPHA:6406,ALPHA16F_EXT:34844,ALPHA32F_EXT:34838,ALPHA8_EXT:32828,ALPHA8_OES:32828,ALPHA_BITS:3413,ALPHA_TEST_FUNC_QCOM:3009,ALPHA_TEST_QCOM:3008,ALPHA_TEST_REF_QCOM:3010,ALREADY_SIGNALED_APPLE:37146,ALWAYS:519,AMD_compressed_3DC_texture:1,AMD_compressed_ATC_texture:1,AMD_performance_monitor:1,AMD_program_binary_Z400:1,ANGLE_depth_texture:1,ANGLE_framebuffer_blit:1,ANGLE_framebuffer_multisample:1,ANGLE_instanced_arrays:1,ANGLE_pack_reverse_row_order:1,ANGLE_program_binary:1,ANGLE_texture_compression_dxt3:1,ANGLE_texture_compression_dxt5:1,ANGLE_texture_usage:1,ANGLE_translated_shader_source:1,ANY_SAMPLES_PASSED_CONSERVATIVE_EXT:36202,ANY_SAMPLES_PASSED_EXT:35887,APPLE_copy_texture_levels:1,APPLE_framebuffer_multisample:1,APPLE_rgb_422:1,APPLE_sync:1,APPLE_texture_format_BGRA8888:1,APPLE_texture_max_level:1,ARM_mali_program_binary:1,ARM_mali_shader_binary:1,ARM_rgba8:1,ARRAY_BUFFER:34962,ARRAY_BUFFER_BINDING:34964,ATC_RGBA_EXPLICIT_ALPHA_AMD:35987,ATC_RGBA_INTERPOLATED_ALPHA_AMD:34798,ATC_RGB_AMD:35986,ATTACHED_SHADERS:35717,BACK:1029,BGRA8_EXT:37793,BGRA_EXT:32993,BGRA_IMG:32993,BINNING_CONTROL_HINT_QCOM:36784,BLEND:3042,BLEND_COLOR:32773,BLEND_DST_ALPHA:32970,BLEND_DST_RGB:32968,BLEND_EQUATION:32777,BLEND_EQUATION_ALPHA:34877,BLEND_EQUATION_RGB:32777,BLEND_SRC_ALPHA:32971,BLEND_SRC_RGB:32969,BLUE_BITS:3412,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,BUFFER:33504,BUFFER_ACCESS_OES:35003,BUFFER_MAPPED_OES:35004,BUFFER_MAP_POINTER_OES:35005,BUFFER_OBJECT_EXT:37201,BUFFER_SIZE:34660,BUFFER_USAGE:34661,BYTE:5120,CCW:2305,CLAMP_TO_BORDER_NV:33069,CLAMP_TO_EDGE:33071,COLOR_ATTACHMENT0:36064,COLOR_ATTACHMENT0_NV:36064,COLOR_ATTACHMENT10_NV:36074,COLOR_ATTACHMENT11_NV:36075,COLOR_ATTACHMENT12_NV:36076,COLOR_ATTACHMENT13_NV:36077,COLOR_ATTACHMENT14_NV:36078,COLOR_ATTACHMENT15_NV:36079,COLOR_ATTACHMENT1_NV:36065,COLOR_ATTACHMENT2_NV:36066,COLOR_ATTACHMENT3_NV:36067,COLOR_ATTACHMENT4_NV:36068,COLOR_ATTACHMENT5_NV:36069,COLOR_ATTACHMENT6_NV:36070,COLOR_ATTACHMENT7_NV:36071,COLOR_ATTACHMENT8_NV:36072,COLOR_ATTACHMENT9_NV:36073,COLOR_ATTACHMENT_EXT:37104,COLOR_BUFFER_BIT:16384,COLOR_BUFFER_BIT0_QCOM:1,COLOR_BUFFER_BIT1_QCOM:2,COLOR_BUFFER_BIT2_QCOM:4,COLOR_BUFFER_BIT3_QCOM:8,COLOR_BUFFER_BIT4_QCOM:16,COLOR_BUFFER_BIT5_QCOM:32,COLOR_BUFFER_BIT6_QCOM:64,COLOR_BUFFER_BIT7_QCOM:128,COLOR_CLEAR_VALUE:3106,COLOR_EXT:6144,COLOR_WRITEMASK:3107,COMPARE_REF_TO_TEXTURE_EXT:34894,COMPILE_STATUS:35713,COMPRESSED_RGBA_ASTC_10x10_KHR:37819,COMPRESSED_RGBA_ASTC_10x5_KHR:37816,COMPRESSED_RGBA_ASTC_10x6_KHR:37817,COMPRESSED_RGBA_ASTC_10x8_KHR:37818,COMPRESSED_RGBA_ASTC_12x10_KHR:37820,COMPRESSED_RGBA_ASTC_12x12_KHR:37821,COMPRESSED_RGBA_ASTC_4x4_KHR:37808,COMPRESSED_RGBA_ASTC_5x4_KHR:37809,COMPRESSED_RGBA_ASTC_5x5_KHR:37810,COMPRESSED_RGBA_ASTC_6x5_KHR:37811,COMPRESSED_RGBA_ASTC_6x6_KHR:37812,COMPRESSED_RGBA_ASTC_8x5_KHR:37813,COMPRESSED_RGBA_ASTC_8x6_KHR:37814,COMPRESSED_RGBA_ASTC_8x8_KHR:37815,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGBA_PVRTC_2BPPV2_IMG:37175,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGBA_PVRTC_4BPPV2_IMG:37176,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_ANGLE:33778,COMPRESSED_RGBA_S3TC_DXT5_ANGLE:33779,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:37853,COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:37847,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_NV:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_NV:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_NV:35919,COMPRESSED_SRGB_S3TC_DXT1_NV:35916,COMPRESSED_TEXTURE_FORMATS:34467,CONDITION_SATISFIED_APPLE:37148,CONSTANT_ALPHA:32771,CONSTANT_COLOR:32769,CONTEXT_FLAG_DEBUG_BIT:2,CONTEXT_ROBUST_ACCESS_EXT:37107,COUNTER_RANGE_AMD:35777,COUNTER_TYPE_AMD:35776,COVERAGE_ALL_FRAGMENTS_NV:36565,COVERAGE_ATTACHMENT_NV:36562,COVERAGE_AUTOMATIC_NV:36567,COVERAGE_BUFFERS_NV:36563,COVERAGE_BUFFER_BIT_NV:32768,COVERAGE_COMPONENT4_NV:36561,COVERAGE_COMPONENT_NV:36560,COVERAGE_EDGE_FRAGMENTS_NV:36566,COVERAGE_SAMPLES_NV:36564,CPU_OPTIMIZED_QCOM:36785,CULL_FACE:2884,CULL_FACE_MODE:2885,CURRENT_PROGRAM:35725,CURRENT_QUERY_EXT:34917,CURRENT_VERTEX_ATTRIB:34342,CW:2304,DEBUG_CALLBACK_FUNCTION:33348,DEBUG_CALLBACK_USER_PARAM:33349,DEBUG_GROUP_STACK_DEPTH:33389,DEBUG_LOGGED_MESSAGES:37189,DEBUG_NEXT_LOGGED_MESSAGE_LENGTH:33347,DEBUG_OUTPUT:37600,DEBUG_OUTPUT_SYNCHRONOUS:33346,DEBUG_SEVERITY_HIGH:37190,DEBUG_SEVERITY_LOW:37192,DEBUG_SEVERITY_MEDIUM:37191,DEBUG_SEVERITY_NOTIFICATION:33387,DEBUG_SOURCE_API:33350,DEBUG_SOURCE_APPLICATION:33354,DEBUG_SOURCE_OTHER:33355,DEBUG_SOURCE_SHADER_COMPILER:33352,DEBUG_SOURCE_THIRD_PARTY:33353,DEBUG_SOURCE_WINDOW_SYSTEM:33351,DEBUG_TYPE_DEPRECATED_BEHAVIOR:33357,DEBUG_TYPE_ERROR:33356,DEBUG_TYPE_MARKER:33384,DEBUG_TYPE_OTHER:33361,DEBUG_TYPE_PERFORMANCE:33360,DEBUG_TYPE_POP_GROUP:33386,DEBUG_TYPE_PORTABILITY:33359,DEBUG_TYPE_PUSH_GROUP:33385,DEBUG_TYPE_UNDEFINED_BEHAVIOR:33358,DECR:7683,DECR_WRAP:34056,DELETE_STATUS:35712,DEPTH24_STENCIL8_OES:35056,DEPTH_ATTACHMENT:36096,DEPTH_STENCIL_ATTACHMENT:33306,DEPTH_BITS:3414,DEPTH_BUFFER_BIT:256,DEPTH_BUFFER_BIT0_QCOM:256,DEPTH_BUFFER_BIT1_QCOM:512,DEPTH_BUFFER_BIT2_QCOM:1024,DEPTH_BUFFER_BIT3_QCOM:2048,DEPTH_BUFFER_BIT4_QCOM:4096,DEPTH_BUFFER_BIT5_QCOM:8192,DEPTH_BUFFER_BIT6_QCOM:16384,DEPTH_BUFFER_BIT7_QCOM:32768,DEPTH_CLEAR_VALUE:2931,DEPTH_COMPONENT:6402,DEPTH_COMPONENT16:33189,DEPTH_COMPONENT16_NONLINEAR_NV:36396,DEPTH_COMPONENT16_OES:33189,DEPTH_COMPONENT24_OES:33190,DEPTH_COMPONENT32_OES:33191,DEPTH_EXT:6145,DEPTH_FUNC:2932,DEPTH_RANGE:2928,DEPTH_STENCIL:34041,DEPTH_STENCIL_OES:34041,DEPTH_TEST:2929,DEPTH_WRITEMASK:2930,DITHER:3024,DMP_shader_binary:1,DONT_CARE:4352,DRAW_BUFFER0_NV:34853,DRAW_BUFFER10_NV:34863,DRAW_BUFFER11_NV:34864,DRAW_BUFFER12_NV:34865,DRAW_BUFFER13_NV:34866,DRAW_BUFFER14_NV:34867,DRAW_BUFFER15_NV:34868,DRAW_BUFFER1_NV:34854,DRAW_BUFFER2_NV:34855,DRAW_BUFFER3_NV:34856,DRAW_BUFFER4_NV:34857,DRAW_BUFFER5_NV:34858,DRAW_BUFFER6_NV:34859,DRAW_BUFFER7_NV:34860,DRAW_BUFFER8_NV:34861,DRAW_BUFFER9_NV:34862,DRAW_BUFFER_EXT:3073,DRAW_FRAMEBUFFER_ANGLE:36009,DRAW_FRAMEBUFFER_APPLE:36009,DRAW_FRAMEBUFFER_BINDING_ANGLE:36006,DRAW_FRAMEBUFFER_BINDING_APPLE:36006,DRAW_FRAMEBUFFER_BINDING_NV:36006,DRAW_FRAMEBUFFER_NV:36009,DST_ALPHA:772,DST_COLOR:774,DYNAMIC_DRAW:35048,ELEMENT_ARRAY_BUFFER:34963,ELEMENT_ARRAY_BUFFER_BINDING:34965,EQUAL:514,ES_VERSION_2_0:1,ETC1_RGB8_OES:36196,ETC1_SRGB8_NV:35054,EXTENSIONS:7939,EXT_blend_minmax:1,EXT_color_buffer_half_float:1,EXT_debug_label:1,EXT_debug_marker:1,EXT_discard_framebuffer:1,EXT_map_buffer_range:1,EXT_multi_draw_arrays:1,EXT_multisampled_render_to_texture:1,EXT_multiview_draw_buffers:1,EXT_occlusion_query_boolean:1,EXT_read_format_bgra:1,EXT_robustness:1,EXT_sRGB:1,EXT_separate_shader_objects:1,EXT_shader_framebuffer_fetch:1,EXT_shader_texture_lod:1,EXT_shadow_samplers:1,EXT_texture_compression_dxt1:1,EXT_texture_filter_anisotropic:1,EXT_texture_format_BGRA8888:1,EXT_texture_rg:1,EXT_texture_storage:1,EXT_texture_type_2_10_10_10_REV:1,EXT_unpack_subimage:1,FALSE:0,FASTEST:4353,FENCE_CONDITION_NV:34036,FENCE_STATUS_NV:34035,FIXED:5132,FJ_shader_binary_GCCSO:1,FLOAT:5126,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,FRAGMENT_SHADER:35632,FRAGMENT_SHADER_BIT_EXT:2,FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723,FRAGMENT_SHADER_DISCARDS_SAMPLES_EXT:35410,FRAMEBUFFER:36160,FRAMEBUFFER_ATTACHMENT_ANGLE:37795,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT:33296,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT:33297,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_TEXTURE_3D_ZOFFSET_OES:36052,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_SAMPLES_EXT:36204,FRAMEBUFFER_BINDING:36006,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_ANGLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_APPLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_EXT:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_IMG:37172,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_NV:36182,FRAMEBUFFER_UNDEFINED_OES:33305,FRAMEBUFFER_UNSUPPORTED:36061,FRONT:1028,FRONT_AND_BACK:1032,FRONT_FACE:2886,FUNC_ADD:32774,FUNC_REVERSE_SUBTRACT:32779,FUNC_SUBTRACT:32778,GENERATE_MIPMAP_HINT:33170,GEQUAL:518,GPU_OPTIMIZED_QCOM:36786,GREATER:516,GREEN_BITS:3411,GUILTY_CONTEXT_RESET_EXT:33363,HALF_FLOAT_OES:36193,HIGH_FLOAT:36338,HIGH_INT:36341,IMG_multisampled_render_to_texture:1,IMG_program_binary:1,IMG_read_format:1,IMG_shader_binary:1,IMG_texture_compression_pvrtc:1,IMG_texture_compression_pvrtc2:1,IMPLEMENTATION_COLOR_READ_FORMAT:35739,IMPLEMENTATION_COLOR_READ_TYPE:35738,INCR:7682,INCR_WRAP:34055,INFO_LOG_LENGTH:35716,INNOCENT_CONTEXT_RESET_EXT:33364,INT:5124,INT_10_10_10_2_OES:36343,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,INVALID_ENUM:1280,INVALID_FRAMEBUFFER_OPERATION:1286,INVALID_OPERATION:1282,INVALID_VALUE:1281,INVERT:5386,KEEP:7680,KHR_debug:1,KHR_texture_compression_astc_ldr:1,LEFT:1030,LEQUAL:515,LESS:513,LINEAR:9729,LINEAR_MIPMAP_LINEAR:9987,LINEAR_MIPMAP_NEAREST:9985,LINES:1,LINE_LOOP:2,LINE_STRIP:3,LINE_WIDTH:2849,LINK_STATUS:35714,LOSE_CONTEXT_ON_RESET_EXT:33362,LOW_FLOAT:36336,LOW_INT:36339,LUMINANCE:6409,LUMINANCE16F_EXT:34846,LUMINANCE32F_EXT:34840,LUMINANCE4_ALPHA4_OES:32835,LUMINANCE8_ALPHA8_EXT:32837,LUMINANCE8_ALPHA8_OES:32837,LUMINANCE8_EXT:32832,LUMINANCE8_OES:32832,LUMINANCE_ALPHA:6410,LUMINANCE_ALPHA16F_EXT:34847,LUMINANCE_ALPHA32F_EXT:34841,MALI_PROGRAM_BINARY_ARM:36705,MALI_SHADER_BINARY_ARM:36704,MAP_FLUSH_EXPLICIT_BIT_EXT:16,MAP_INVALIDATE_BUFFER_BIT_EXT:8,MAP_INVALIDATE_RANGE_BIT_EXT:4,MAP_READ_BIT_EXT:1,MAP_UNSYNCHRONIZED_BIT_EXT:32,MAP_WRITE_BIT_EXT:2,MAX_3D_TEXTURE_SIZE_OES:32883,MAX_COLOR_ATTACHMENTS_NV:36063,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_CUBE_MAP_TEXTURE_SIZE:34076,MAX_DEBUG_GROUP_STACK_DEPTH:33388,MAX_DEBUG_LOGGED_MESSAGES:37188,MAX_DEBUG_MESSAGE_LENGTH:37187,MAX_DRAW_BUFFERS_NV:34852,MAX_EXT:32776,MAX_FRAGMENT_UNIFORM_VECTORS:36349,MAX_LABEL_LENGTH:33512,MAX_MULTIVIEW_BUFFERS_EXT:37106,MAX_RENDERBUFFER_SIZE:34024,MAX_SAMPLES_ANGLE:36183,MAX_SAMPLES_APPLE:36183,MAX_SAMPLES_EXT:36183,MAX_SAMPLES_IMG:37173,MAX_SAMPLES_NV:36183,MAX_SERVER_WAIT_TIMEOUT_APPLE:37137,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_TEXTURE_MAX_ANISOTROPY_EXT:34047,MAX_TEXTURE_SIZE:3379,MAX_VARYING_VECTORS:36348,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VIEWPORT_DIMS:3386,MEDIUM_FLOAT:36337,MEDIUM_INT:36340,MIN_EXT:32775,MIRRORED_REPEAT:33648,MULTISAMPLE_BUFFER_BIT0_QCOM:16777216,MULTISAMPLE_BUFFER_BIT1_QCOM:33554432,MULTISAMPLE_BUFFER_BIT2_QCOM:67108864,MULTISAMPLE_BUFFER_BIT3_QCOM:134217728,MULTISAMPLE_BUFFER_BIT4_QCOM:268435456,MULTISAMPLE_BUFFER_BIT5_QCOM:536870912,MULTISAMPLE_BUFFER_BIT6_QCOM:1073741824,MULTISAMPLE_BUFFER_BIT7_QCOM:2147483648,MULTIVIEW_EXT:37105,NEAREST:9728,NEAREST_MIPMAP_LINEAR:9986,NEAREST_MIPMAP_NEAREST:9984,NEVER:512,NICEST:4354,NONE:0,NOTEQUAL:517,NO_ERROR:0,NO_RESET_NOTIFICATION_EXT:33377,NUM_COMPRESSED_TEXTURE_FORMATS:34466,NUM_PROGRAM_BINARY_FORMATS_OES:34814,NUM_SHADER_BINARY_FORMATS:36345,NV_coverage_sample:1,NV_depth_nonlinear:1,NV_draw_buffers:1,NV_draw_instanced:1,NV_fbo_color_attachments:1,NV_fence:1,NV_framebuffer_blit:1,NV_framebuffer_multisample:1,NV_generate_mipmap_sRGB:1,NV_instanced_arrays:1,NV_read_buffer:1,NV_read_buffer_front:1,NV_read_depth:1,NV_read_depth_stencil:1,NV_read_stencil:1,NV_sRGB_formats:1,NV_shadow_samplers_array:1,NV_shadow_samplers_cube:1,NV_texture_border_clamp:1,NV_texture_compression_s3tc_update:1,NV_texture_npot_2D_mipmap:1,OBJECT_TYPE_APPLE:37138,OES_EGL_image:1,OES_EGL_image_external:1,OES_compressed_ETC1_RGB8_texture:1,OES_compressed_paletted_texture:1,OES_depth24:1,OES_depth32:1,OES_depth_texture:1,OES_element_index_uint:1,OES_fbo_render_mipmap:1,OES_fragment_precision_high:1,OES_get_program_binary:1,OES_mapbuffer:1,OES_packed_depth_stencil:1,OES_required_internalformat:1,OES_rgb8_rgba8:1,OES_standard_derivatives:1,OES_stencil1:1,OES_stencil4:1,OES_surfaceless_context:1,OES_texture_3D:1,OES_texture_float:1,OES_texture_float_linear:1,OES_texture_half_float:1,OES_texture_half_float_linear:1,OES_texture_npot:1,OES_vertex_array_object:1,OES_vertex_half_float:1,OES_vertex_type_10_10_10_2:1,ONE:1,ONE_MINUS_CONSTANT_ALPHA:32772,ONE_MINUS_CONSTANT_COLOR:32770,ONE_MINUS_DST_ALPHA:773,ONE_MINUS_DST_COLOR:775,ONE_MINUS_SRC_ALPHA:771,ONE_MINUS_SRC_COLOR:769,OUT_OF_MEMORY:1285,PACK_ALIGNMENT:3333,PACK_REVERSE_ROW_ORDER_ANGLE:37796,PALETTE4_R5_G6_B5_OES:35730,PALETTE4_RGB5_A1_OES:35732,PALETTE4_RGB8_OES:35728,PALETTE4_RGBA4_OES:35731,PALETTE4_RGBA8_OES:35729,PALETTE8_R5_G6_B5_OES:35735,PALETTE8_RGB5_A1_OES:35737,PALETTE8_RGB8_OES:35733,PALETTE8_RGBA4_OES:35736,PALETTE8_RGBA8_OES:35734,PERCENTAGE_AMD:35779,PERFMON_GLOBAL_MODE_QCOM:36768,PERFMON_RESULT_AMD:35782,PERFMON_RESULT_AVAILABLE_AMD:35780,PERFMON_RESULT_SIZE_AMD:35781,POINTS:0,POLYGON_OFFSET_FACTOR:32824,POLYGON_OFFSET_FILL:32823,POLYGON_OFFSET_UNITS:10752,PROGRAM:33506,PROGRAM_BINARY_ANGLE:37798,PROGRAM_BINARY_FORMATS_OES:34815,PROGRAM_BINARY_LENGTH_OES:34625,PROGRAM_OBJECT_EXT:35648,PROGRAM_PIPELINE_BINDING_EXT:33370,PROGRAM_PIPELINE_OBJECT_EXT:35407,PROGRAM_SEPARABLE_EXT:33368,QCOM_alpha_test:1,QCOM_binning_control:1,QCOM_driver_control:1,QCOM_extended_get:1,QCOM_extended_get2:1,QCOM_perfmon_global_mode:1,QCOM_tiled_rendering:1,QCOM_writeonly_rendering:1,QUERY:33507,QUERY_OBJECT_EXT:37203,QUERY_RESULT_AVAILABLE_EXT:34919,QUERY_RESULT_EXT:34918,R16F_EXT:33325,R32F_EXT:33326,R8_EXT:33321,READ_BUFFER_EXT:3074,READ_BUFFER_NV:3074,READ_FRAMEBUFFER_ANGLE:36008,READ_FRAMEBUFFER_APPLE:36008,READ_FRAMEBUFFER_BINDING_ANGLE:36010,READ_FRAMEBUFFER_BINDING_APPLE:36010,READ_FRAMEBUFFER_BINDING_NV:36010,READ_FRAMEBUFFER_NV:36008,RED_BITS:3410,RED_EXT:6403,RENDERBUFFER:36161,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_BINDING:36007,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_SAMPLES_ANGLE:36011,RENDERBUFFER_SAMPLES_APPLE:36011,RENDERBUFFER_SAMPLES_EXT:36011,RENDERBUFFER_SAMPLES_IMG:37171,RENDERBUFFER_SAMPLES_NV:36011,RENDERBUFFER_STENCIL_SIZE:36181,RENDERBUFFER_WIDTH:36162,RENDERER:7937,RENDER_DIRECT_TO_FRAMEBUFFER_QCOM:36787,REPEAT:10497,REPLACE:7681,REQUIRED_TEXTURE_IMAGE_UNITS_OES:36200,RESET_NOTIFICATION_STRATEGY_EXT:33366,RG16F_EXT:33327,RG32F_EXT:33328,RG8_EXT:33323,RGB:6407,RGB10_A2_EXT:32857,RGB10_EXT:32850,RGB16F_EXT:34843,RGB32F_EXT:34837,RGB565:36194,RGB565_OES:36194,RGB5_A1:32855,RGB5_A1_OES:32855,RGB8_OES:32849,RGBA:6408,RGBA16F_EXT:34842,RGBA32F_EXT:34836,RGBA4:32854,RGBA4_OES:32854,RGBA8_OES:32856,RGB_422_APPLE:35359,RG_EXT:33319,RIGHT:1031,SAMPLER:33510,SAMPLER_2D:35678,SAMPLER_2D_ARRAY_SHADOW_NV:36292,SAMPLER_2D_SHADOW_EXT:35682,SAMPLER_3D_OES:35679,SAMPLER_CUBE:35680,SAMPLER_CUBE_SHADOW_NV:36293,SAMPLER_EXTERNAL_OES:36198,SAMPLES:32937,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_BUFFERS:32936,SAMPLE_COVERAGE:32928,SAMPLE_COVERAGE_INVERT:32939,SAMPLE_COVERAGE_VALUE:32938,SCISSOR_BOX:3088,SCISSOR_TEST:3089,SGX_BINARY_IMG:35850,SGX_PROGRAM_BINARY_IMG:37168,SHADER:33505,SHADER_BINARY_DMP:37456,SHADER_BINARY_FORMATS:36344,SHADER_BINARY_VIV:36804,SHADER_COMPILER:36346,SHADER_OBJECT_EXT:35656,SHADER_SOURCE_LENGTH:35720,SHADER_TYPE:35663,SHADING_LANGUAGE_VERSION:35724,SHORT:5122,SIGNALED_APPLE:37145,SLUMINANCE8_ALPHA8_NV:35909,SLUMINANCE8_NV:35911,SLUMINANCE_ALPHA_NV:35908,SLUMINANCE_NV:35910,SRC_ALPHA:770,SRC_ALPHA_SATURATE:776,SRC_COLOR:768,SRGB8_ALPHA8_EXT:35907,SRGB8_NV:35905,SRGB_ALPHA_EXT:35906,SRGB_EXT:35904,STACK_OVERFLOW:1283,STACK_UNDERFLOW:1284,STATE_RESTORE:35804,STATIC_DRAW:35044,STENCIL_ATTACHMENT:36128,STENCIL_BACK_FAIL:34817,STENCIL_BACK_FUNC:34816,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,STENCIL_BITS:3415,STENCIL_BUFFER_BIT:1024,STENCIL_BUFFER_BIT0_QCOM:65536,STENCIL_BUFFER_BIT1_QCOM:131072,STENCIL_BUFFER_BIT2_QCOM:262144,STENCIL_BUFFER_BIT3_QCOM:524288,STENCIL_BUFFER_BIT4_QCOM:1048576,STENCIL_BUFFER_BIT5_QCOM:2097152,STENCIL_BUFFER_BIT6_QCOM:4194304,STENCIL_BUFFER_BIT7_QCOM:8388608,STENCIL_CLEAR_VALUE:2961,STENCIL_EXT:6146,STENCIL_FAIL:2964,STENCIL_FUNC:2962,STENCIL_INDEX1_OES:36166,STENCIL_INDEX4_OES:36167,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_TEST:2960,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STREAM_DRAW:35040,SUBPIXEL_BITS:3408,SYNC_CONDITION_APPLE:37139,SYNC_FENCE_APPLE:37142,SYNC_FLAGS_APPLE:37141,SYNC_FLUSH_COMMANDS_BIT_APPLE:1,SYNC_GPU_COMMANDS_COMPLETE_APPLE:37143,SYNC_OBJECT_APPLE:35411,SYNC_STATUS_APPLE:37140,TEXTURE:5890,TEXTURE0:33984,TEXTURE1:33985,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34e3,TEXTURE17:34001,TEXTURE18:34002,TEXTURE19:34003,TEXTURE2:33986,TEXTURE20:34004,TEXTURE21:34005,TEXTURE22:34006,TEXTURE23:34007,TEXTURE24:34008,TEXTURE25:34009,TEXTURE26:34010,TEXTURE27:34011,TEXTURE28:34012,TEXTURE29:34013,TEXTURE3:33987,TEXTURE30:34014,TEXTURE31:34015,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE_2D:3553,TEXTURE_3D_OES:32879,TEXTURE_BINDING_2D:32873,TEXTURE_BINDING_3D_OES:32874,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_BINDING_EXTERNAL_OES:36199,TEXTURE_BORDER_COLOR_NV:4100,TEXTURE_COMPARE_FUNC_EXT:34893,TEXTURE_COMPARE_MODE_EXT:34892,TEXTURE_CUBE_MAP:34067,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_DEPTH_QCOM:35796,TEXTURE_EXTERNAL_OES:36197,TEXTURE_FORMAT_QCOM:35798,TEXTURE_HEIGHT_QCOM:35795,TEXTURE_IMAGE_VALID_QCOM:35800,TEXTURE_IMMUTABLE_FORMAT_EXT:37167,TEXTURE_INTERNAL_FORMAT_QCOM:35797,TEXTURE_MAG_FILTER:10240,TEXTURE_MAX_ANISOTROPY_EXT:34046,TEXTURE_MAX_LEVEL_APPLE:33085,TEXTURE_MIN_FILTER:10241,TEXTURE_NUM_LEVELS_QCOM:35801,TEXTURE_OBJECT_VALID_QCOM:35803,TEXTURE_SAMPLES_IMG:37174,TEXTURE_TARGET_QCOM:35802,TEXTURE_TYPE_QCOM:35799,TEXTURE_USAGE_ANGLE:37794,TEXTURE_WIDTH_QCOM:35794,TEXTURE_WRAP_R_OES:32882,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TIMEOUT_EXPIRED_APPLE:37147,TIMEOUT_IGNORED_APPLE:18446744073709552e3,TRANSLATED_SHADER_SOURCE_LENGTH_ANGLE:37792,TRIANGLES:4,TRIANGLE_FAN:6,TRIANGLE_STRIP:5,TRUE:1,UNKNOWN_CONTEXT_RESET_EXT:33365,UNPACK_ALIGNMENT:3317,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_PIXELS:3316,UNPACK_SKIP_ROWS:3315,UNSIGNALED_APPLE:37144,UNSIGNED_BYTE:5121,UNSIGNED_INT:5125,UNSIGNED_INT64_AMD:35778,UNSIGNED_INT_10_10_10_2_OES:36342,UNSIGNED_INT_24_8_OES:34042,UNSIGNED_INT_2_10_10_10_REV_EXT:33640,UNSIGNED_NORMALIZED_EXT:35863,UNSIGNED_SHORT:5123,UNSIGNED_SHORT_1_5_5_5_REV_EXT:33638,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_4_4_4_4_REV_EXT:33637,UNSIGNED_SHORT_4_4_4_4_REV_IMG:33637,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,UNSIGNED_SHORT_8_8_APPLE:34234,UNSIGNED_SHORT_8_8_REV_APPLE:34235,VALIDATE_STATUS:35715,VENDOR:7936,VERSION:7938,VERTEX_ARRAY_BINDING_OES:34229,VERTEX_ARRAY_OBJECT_EXT:37204,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,VERTEX_ATTRIB_ARRAY_DIVISOR_NV:35070,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_SHADER:35633,VERTEX_SHADER_BIT_EXT:1,VIEWPORT:2978,VIV_shader_binary:1,WAIT_FAILED_APPLE:37149,WRITEONLY_RENDERING_QCOM:34851,WRITE_ONLY_OES:35001,Z400_BINARY_AMD:34624,ZERO:0,RASTERIZER_DISCARD:35977,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,CONTEXT_LOST_WEBGL:37442,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,BROWSER_DEFAULT_WEBGL:37444},eH={};function rH(r){var n=nH();return function(){var e=B(r),i;if(n){var a=B(this).constructor;i=Reflect.construct(e,arguments,a)}else i=e.apply(this,arguments);return et(this,i)}}function nH(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Cf=new Map,Oy=new Map,iH=new Map,ga=function(r){tt(t,r);var n=rH(t);function t(){var e;return $(this,t),e=n.call(this),e.onabort=null,e.onerror=null,e.onload=null,e.onloadstart=null,e.onprogress=null,e.ontimeout=null,e.onloadend=null,e.onreadystatechange=null,e.readyState=0,e.response=null,e.responseText=null,e._responseType="text",e.responseXML=null,e.status=0,e.statusText="",e.upload={},e.withCredentials=!1,Cf.set("requestHeader",{"content-type":"application/x-www-form-urlencoded"}),e}return H(t,[{key:"responseType",set:function(i){this._responseType=i}},{key:"abort",value:function(){var i=iH.get("requestTask");i&&i.abort()}},{key:"getAllResponseHeaders",value:function(){var i=Oy.get("responseHeader");return Object.keys(i).map(function(a){return"".concat(a,": ").concat(i[a])}).join(`
`)}},{key:"getResponseHeader",value:function(i){return Oy.get("responseHeader")[i]}},{key:"open",value:function(i,a,o){this._method=i,this._url=a}},{key:"overrideMimeType",value:function(){}},{key:"send",value:function(){}},{key:"setRequestHeader",value:function(i,a){var o=Cf.get("requestHeader");o[i]=a,Cf.set("requestHeader",o)}},{key:"addEventListener",value:function(i,a){var o=this;typeof a=="function"&&(this["on"+i]=function(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};s.target=s.target||o,a.call(o,s)})}},{key:"removeEventListener",value:function(i,a){this["on"+i]===a&&(this["on"+i]=null)}}]),t}(Kp);ga.UNSEND=0;ga.OPENED=1;ga.HEADERS_RECEIVED=2;ga.LOADING=3;ga.DONE=4;var aH=typeof my<"u"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,oH=typeof wx<"u"&&wx!==null&&(typeof wx.request<"u"||typeof wx.miniProgram<"u"),hr=aH||oH,sH={atob:yU,btoa:w2,devicePixelRatio:_U,Blob:mU,document:Wi,Element:k2,Event:L2,EventTarget:Kp,HTMLCanvasElement:$U,HTMLElement:go,HTMLMediaElement:I2,HTMLVideoElement:D2,Image:P2,ImageData:GU,navigator:XU,Node:F2,requestAnimationFrame:qU,cancelAnimationFrame:KU,screen:ns,XMLHttpRequest:ga,performance:YU,URL:QU,WebGLRenderingContext:tH,WebGL2RenderingContext:eH,addEventListener:function(n,t){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Wi.addEventListener(n,t,e)},removeEventListener:function(n,t,e){Wi.removeEventListener(n,t)},dispatchEvent:function(n){Wi.dispatchEvent(n)},innerWidth:ns.availWidth,innerHeight:ns.availHeight,setTimeout,clearTimeout,setInterval,clearInterval},Wt=hr?sH:Lr,uH=hr?ga:Lr.XMLHttpRequest;hr||Lr.location;function lH(r){var n=r;return typeof r=="string"&&(n=Wt.document.getElementById(r)),n}function U2(r){return r.trim?r.trim():r.replace(/^\s+|\s+$/g,"")}function cH(r){return U2(r).split(/\s+/)}function fH(r){var n,t,e=Wt==null||(n=Wt.document)===null||n===void 0||(t=n.documentElement)===null||t===void 0?void 0:t.style;if(!e)return r[0];for(var i in r)if(r[i]&&r[i]in e)return r[i];return r[0]}function ye(r,n,t){var e=Wt.document.createElement(r);return e.className=n||"",t&&t.appendChild(e),e}function Ms(r){var n=r.parentNode;n&&n.removeChild(r)}function oa(r,n){if(r.classList!==void 0)for(var t=cH(n),e=0,i=t.length;e<i;e++)r.classList.add(t[e]);else if(!hH(r,n)){var a=Jp(r);H2(r,(a?a+" ":"")+n)}}function ws(r,n){r.classList!==void 0?r.classList.remove(n):H2(r,U2((" "+Jp(r)+" ").replace(" "+n+" "," ")))}function hH(r,n){if(r.classList!==void 0)return r.classList.contains(n);var t=Jp(r);return t.length>0&&new RegExp("(^|\\s)"+n+"(\\s|$)").test(t)}function H2(r,n){r instanceof HTMLElement?r.className=n:r.className.baseVal=n}function Jp(r){return r instanceof SVGElement&&(r=r.correspondingElement),r.className.baseVal===void 0?r.className:r.className.baseVal}function Ry(r){for(;r&&r.firstChild;)r.removeChild(r.firstChild)}var vH=fH(["transform","WebkitTransform"]);function pH(r,n){r.style[vH]=n}function dH(){if(typeof Event=="function")Wt.dispatchEvent(new Event("resize"));else{var r=Wt.document.createEvent("UIEvents");r.initUIEvent("resize",!0,!1,Wt,0),Wt.dispatchEvent(r)}}function gH(){var r,n=Wt.document.querySelector('meta[name="viewport"]');if(!n)return 1;var t=(r=n.content)===null||r===void 0?void 0:r.split(","),e=t.find(function(i){var a=i.split("="),o=kt(a,2),s=o[0];return o[1],s==="initial-scale"});return e?e.split("=")[1]*1:1}var se=gH()<1?1:Wt.devicePixelRatio;function yH(r){if(r.length===0)throw new Error("max requires at least one data point");for(var n=r[0],t=1;t<r.length;t++)r[t]>n&&(n=r[t]);return n*1}function mH(r){if(r.length===0)throw new Error("min requires at least one data point");for(var n=r[0],t=1;t<r.length;t++)r[t]<n&&(n=r[t]);return n*1}function $2(r){if(r.length===0)return 0;for(var n=r[0]*1,t=1;t<r.length;t++)n+=r[t]*1;return n}function xH(r){if(r.length===0)throw new Error("mean requires at least one data point");return $2(r)/r.length}function _H(r){if(r.length===0)throw new Error("mean requires at least one data point");if(r.length<3)return r[0];r.sort();for(var n=r[0],t=NaN,e=0,i=1,a=1;a<r.length+1;a++)r[a]!==n?(i>e&&(e=i,t=n),i=1,n=r[a]):i++;return t*1}var G2={min:mH,max:yH,mean:xH,sum:$2,mode:_H};function V2(r,n){return r.map(function(t){return t[n]})}function CH(r){return typeof ImageBitmap<"u"&&r instanceof ImageBitmap}function EH(r){var n=SH();return function(){var e=B(r),i;if(n){var a=B(this).constructor;i=Reflect.construct(e,arguments,a)}else i=e.apply(this,arguments);return et(this,i)}}function SH(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var bH=function(r){tt(t,r);var n=EH(t);function t(e,i,a,o){var s;return $(this,t),s=n.call(this,"AJAXError: ".concat(i," (").concat(e,"): ").concat(a)),s.status=e,s.statusText=i,s.url=a,s.body=o,s}return H(t)}(IM(Error));function W2(r,n){var t=new uH,e=Array.isArray(r.url)?r.url[0]:r.url;t.open(r.method||"GET",e,!0),r.type==="arrayBuffer"&&(t.responseType="arraybuffer");for(var i in r.headers)r.headers.hasOwnProperty(i)&&t.setRequestHeader(i,r.headers[i]);return r.type==="json"&&(t.responseType="text",t.setRequestHeader("Accept","application/json")),t.withCredentials=r.credentials==="include",t.onerror=function(){n(new Error(t.statusText))},t.onload=function(){if((t.status>=200&&t.status<300||t.status===0)&&t.response!==null){var a=t.response;if(r.type==="json")try{a=JSON.parse(t.response)}catch(s){return n(s)}n(null,a,t.getResponseHeader("Cache-Control"),t.getResponseHeader("Expires"),t)}else{var o=new Blob([t.response],{type:t.getResponseHeader("Content-Type")});n(new bH(t.status,t.statusText,e,o))}},t.send(r.body),t}function AH(r){return new Promise(function(n,t){W2(r,function(e,i,a,o,s){e?t({err:e,data:null,xhr:s}):n({err:null,data:i,cacheControl:a,expires:o,xhr:s})})})}function TH(r,n){return W2(r,n)}var td=function(n,t){return TH(U(U({},n),{},{type:"arrayBuffer"}),t)},Iy="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function MH(r,n){var t=new Wt.Image,e=Wt.URL||Wt.webkitURL;t.crossOrigin="anonymous",t.onload=function(){n(null,t),e.revokeObjectURL(t.src),t.onload=null,window.requestAnimationFrame(function(){t.src=Iy})},t.onerror=function(){return n(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var i=new Blob([new Uint8Array(r)],{type:"image/png"});t.src=r.byteLength?e.createObjectURL(i):Iy}function wH(r,n){var t=new Blob([new Uint8Array(r)],{type:"image/png"});createImageBitmap(t).then(function(e){n(null,e)}).catch(function(e){n(new Error("Could not load image because of ".concat(e.message,". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")))})}var Vh=function(n,t){return td(n,function(e,i){if(e)t(e);else if(i){var a=typeof createImageBitmap=="function";a?wH(i,t):MH(i,t)}})},LH=function(){var r=Mt(st.mark(function n(t,e,i){var a,o,s,u,l,c;return st.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.prev=0,h.next=3,i(t);case 3:a=h.sent,o=a.rasterData,s=a.width,u=a.height,l=0,c=8e3,e(null,{data:o,width:s,height:u,min:l,max:c}),h.next=15;break;case 12:h.prev=12,h.t0=h.catch(0),e(null,new Error(""+h.t0));case 15:case"end":return h.stop()}},n,null,[[0,12]])}));return function(t,e,i){return r.apply(this,arguments)}}();function Ef(r){return typeof r=="number"}var Dy=2*Math.PI*6378137/2;function FH(r){var n=[1/0,1/0,-1/0,-1/0];return r.forEach(function(t){var e=t.coordinates;j2(n,e)}),n}function j2(r,n){return Array.isArray(n[0])?n.forEach(function(t){j2(r,t)}):(r[0]>n[0]&&(r[0]=n[0]),r[1]>n[1]&&(r[1]=n[1]),r[2]<n[0]&&(r[2]=n[0]),r[3]<n[1]&&(r[3]=n[1])),r}function Sf(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{enable:!0,decimal:1};r=RH(r,n);var e=r[0],i=r[1],a=e*Dy/180,o=Math.log(Math.tan((90+i)*Math.PI/360))/(Math.PI/180);return o=o*Dy/180,t.enable&&(a=Number(a.toFixed(t.decimal)),o=Number(o.toFixed(t.decimal))),r.length===3?[a,o,r[2]]:[a,o]}function kH(r){if(r==null)throw new Error("lng is required");return(r>180||r<-180)&&(r=r%360,r>180&&(r=-360+r),r<-180&&(r=360+r),r===0&&(r=0)),r}function OH(r){if(r==null)throw new Error("lat is required");return(r>90||r<-90)&&(r=r%180,r>90&&(r=-180+r),r<-90&&(r=180+r),r===0&&(r=0)),r}function RH(r,n){if(n===!1)return r;var t=kH(r[0]),e=OH(r[1]);return e>85&&(e=85),e<-85&&(e=-85),r.length===3?[t,e,r[2]]:[t,e]}function be(r){var n=85.0511287798,t=Math.max(Math.min(n,r[1]),-n),e=256<<20,i=Math.PI/180,a=r[0]*i,o=t*i;o=Math.log(Math.tan(Math.PI/4+o/2));var s=.5/Math.PI,u=.5,l=-.5/Math.PI;return i=.5,a=e*(s*a+u),o=e*(l*o+i),[Math.floor(a),Math.floor(o)]}function IH(r,n,t){var e=Qs(n[1]-r[1]),i=Qs(n[0]-r[0]),a=Qs(r[1]),o=Qs(n[1]),s=Math.pow(Math.sin(e/2),2)+Math.pow(Math.sin(i/2),2)*Math.cos(a)*Math.cos(o);return zM(2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s)),"meters")}function Lc(r,n){var t=Math.abs(r[1][1]-r[0][1])*n,e=Math.abs(r[1][0]-r[0][0])*n;return[[r[0][0]-e,r[0][1]-t],[r[1][0]+e,r[1][1]+t]]}function X2(r,n){return r[0][0]<=n[0][0]&&r[0][1]<=n[0][1]&&r[1][0]>=n[1][0]&&r[1][1]>=n[1][1]}function El(r){return[[r[0],r[1]],[r[2],r[3]]]}function Y2(r){var n=DH(r,[0,0]);return[r[0]/n,r[1]/n]}function DH(r,n){return Math.sqrt(Math.pow(r[0]-n[0],2)+Math.pow(r[1]-n[1],2))}function Or(r){if(Ef(r[0]))return r;if(Ef(r[0][0]))throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8");if(Ef(r[0][0][0])){var n=r,t=0,e=0,i=0;return n.forEach(function(a){a.forEach(function(o){t+=o[0],e+=o[1],i++})}),[t/i,e/i,0]}else throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8")}var PH=function(){function r(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50,t=arguments.length>1?arguments[1]:void 0;$(this,r),this.limit=n,this.destroy=t||this.defaultDestroy,this.order=[],this.clear()}return H(r,[{key:"clear",value:function(){var t=this;this.order.forEach(function(e){t.delete(e)}),this.cache={},this.order=[]}},{key:"get",value:function(t){var e=this.cache[t];return e&&(this.deleteOrder(t),this.appendOrder(t)),e}},{key:"set",value:function(t,e){this.cache[t]?(this.delete(t),this.cache[t]=e,this.appendOrder(t)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[t]=e,this.appendOrder(t))}},{key:"delete",value:function(t){var e=this.cache[t];e&&(this.deleteCache(t),this.deleteOrder(t),this.destroy(e,t))}},{key:"deleteCache",value:function(t){delete this.cache[t]}},{key:"deleteOrder",value:function(t){var e=this.order.findIndex(function(i){return i===t});e>=0&&this.order.splice(e,1)}},{key:"appendOrder",value:function(t){this.order.push(t)}},{key:"defaultDestroy",value:function(t,e){return null}}]),r}();function Fc(r,n){r.forEach(function(t){!n[t]||(n[t]=n[t].bind(n))})}function Z2(r){return typeof r=="string"?!!Sv(r):!1}function Ut(r){var n=Sv(r),t=[0,0,0,0];return n!=null&&(t[0]=n.r/255,t[1]=n.g/255,t[2]=n.b/255,t[3]=n.opacity),t}function cn(r){var n=r&&r[0],t=r&&r[1],e=r&&r[2],i=n+t*256+e*65536-1;return i}function di(r){return[r+1&255,r+1>>8&255,r+1>>8>>8&255]}function Ls(r){var n=Wt.document.createElement("canvas"),t=n.getContext("2d");n.width=256,n.height=1;var e=null;if(r.weights){var i=0;r.weights.map(function(h,v){var p=r.colors[v]||"rgba(0, 0, 0, 0)",d=i+h;t.fillStyle=p,t.fillRect(i*256,0,d*256,1),i=d})}else{for(var a=t.createLinearGradient(0,0,256,1),o=r.positions[0],s=r.positions[r.positions.length-1],u=0;u<r.colors.length;++u){var l=(r.positions[u]-o)/(s-o);a.addColorStop(l,r.colors[u])}t.fillStyle=a,t.fillRect(0,0,256,1)}if(hr)return e=new Uint8ClampedArray(t.getImageData(0,0,256,1).data),n=null,t=null,{data:e,width:256,height:1};e=t.getImageData(0,0,256,1).data;for(var c=t.createImageData(256,1),f=0;f<c.data.length;f+=4)c.data[f+0]=e[f+0],c.data[f+1]=e[f+1],c.data[f+2]=e[f+2],c.data[f+3]=e[f+3];return n=null,t=null,c}var Sl;(function(r){r.CENTER="center",r.TOP="top",r["TOP-LEFT"]="top-left",r["TOP-RIGHT"]="top-right",r.BOTTOM="bottom",r["BOTTOM-LEFT"]="bottom-left",r.LEFT="left",r.RIGHT="right"})(Sl||(Sl={}));var Wh={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function BH(r,n,t){var e=r.classList;for(var i in Wh)Wh.hasOwnProperty(i)&&e.remove("l7-".concat(t,"-anchor-").concat(i));e.add("l7-".concat(t,"-anchor-").concat(n))}function le(r,n){return{enable:r,mask:255,func:{cmp:514,ref:n?1:0,mask:255}}}function ed(r,n){var t=r.color;return!t||!t.length?[1,1,1,1]:t}function rd(r,n,t){return t.length===2?[t[0],t[1],0]:[t[0],t[1],t[2]]}function nd(r,n){var t=r.filter;return t?[1]:[0]}function id(r,n,t,e){return[n]}var ku=Ft();Ft();var de=Ft(),Un=Ft(),Sa=Ft();function bf(r,n,t,e,i){Zt(r,t,e),kr(r,r),n=Ya(-r[1],r[0]);var a=Ya(-t[1],t[0]);return[i/Mn(n,a),n]}function Hn(r,n){return jC(r,-n[1],n[0])}function ba(r,n,t){return vr(r,n,t),kr(r,r),r}function Af(r,n){return r[0]===n[0]&&r[1]===n[1]}var NH=function(){function r(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};$(this,r),S(this,"lastFlip",-1),S(this,"miter",Ya(0,0)),S(this,"started",!1),S(this,"dash",!1),S(this,"totalDistance",0),S(this,"currentIndex",0),this.join=n.join||"miter",this.cap=n.cap||"butt",this.miterLimit=n.miterLimit||10,this.thickness=n.thickness||1,this.dash=n.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return H(r,[{key:"extrude_gaode2",value:function(t,e){var i=this.complex;if(t.length<=1)return i;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var a=t.length,o=i.startIndex,s=1;s<a;s++){var u,l,c,f=t[s-1];f.push((u=e[s-1][2])!==null&&u!==void 0?u:0);var h=e[s-1],v=t[s];v.push((l=e[s][2])!==null&&l!==void 0?l:0);var p=e[s],d=s<t.length-1?[].concat(it(t[s+1]),[(c=e[s+1][2])!==null&&c!==void 0?c:0]):null,g=s<e.length-1?e[s+1]:null,y=this.segment_gaode2(i,o,f,v,d,h,p,g);o+=y}if(this.dash)for(var m=0;m<i.positions.length/6;m++)i.positions[m*6+5]=this.totalDistance;return i.startIndex=i.positions.length/6,i}},{key:"simpleExtrude_gaode2",value:function(t,e){var i=this.complex;if(t.length<=1)return i;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var a=t.length,o=i.startIndex,s=1;s<a;s++){var u,l,c,f=t[s-1];f.push((u=e[s-1][2])!==null&&u!==void 0?u:0);var h=e[s-1],v=t[s];v.push((l=e[s][2])!==null&&l!==void 0?l:0);var p=e[s],d=s<t.length-1?[].concat(it(t[s+1]),[(c=e[s+1][2])!==null&&c!==void 0?c:0]):null,g=s<e.length-1?e[s+1]:null,y=this.simpleSegment(i,o,f,v,d,h,p,g);o+=y}if(this.dash)for(var m=0;m<i.positions.length/6;m++)i.positions[m*6+5]=this.totalDistance;return i.startIndex=i.positions.length/6,i}},{key:"extrude",value:function(t){var e=this.complex;if(t.length<=1)return e;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var i=t.length,a=e.startIndex,o=1;o<i;o++){var s=t[o-1],u=t[o],l=o<t.length-1?t[o+1]:null,c=this.segment(e,a,s,u,l);a+=c}if(this.dash)for(var f=0;f<e.positions.length/6;f++)e.positions[f*6+5]=this.totalDistance;return e.startIndex=e.positions.length/6,e}},{key:"simpleExtrude",value:function(t){var e=this.complex;if(t.length<=1)return e;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var i=t.length,a=e.startIndex,o=1;o<i;o++){var s=t[o-1],u=t[o],l=o<t.length-1?t[o+1]:null,c=this.simpleSegment(e,a,s,u,l);a+=c}if(this.dash)for(var f=0;f<e.positions.length/6;f++)e.positions[f*6+5]=this.totalDistance;return e.startIndex=e.positions.length/6,e}},{key:"segment_gaode2",value:function(t,e,i,a,o,s,u,l){var c=0,f=t.indices,h=t.positions,v=t.normals,p=this.cap==="square",d=this.join==="bevel",g=be([u[0],u[1]]),y=be([s[0],s[1]]);ba(de,a,i);var m=0;if(this.dash&&(m=this.lineSegmentDistance(g,y),this.totalDistance+=m),this.normal||(this.normal=Ft(),Hn(this.normal,de)),!this.started)if(this.started=!0,p){var x=Ft(),_=Ft();Zt(x,this.normal,de),Zt(_,this.normal,de),v.push(_[0],_[1],0),v.push(x[0],x[1],0),h.push(i[0],i[1],i[2]|0,this.totalDistance-m,-this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),h.push(i[0],i[1],i[2]|0,this.totalDistance-m,this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(h,v,i,this.normal,this.thickness,this.totalDistance-m);if(f.push(e+0,e+1,e+2),o){Af(a,o)&&Zt(o,a,kr(o,ji(o,a,i))),ba(Un,o,a);var M=bf(Sa,Ft(),de,Un,this.thickness),T=kt(M,2),k=T[0],L=T[1],O=Mn(Sa,this.normal)<0?-1:1,D=d;if(!D&&this.join==="miter"){var W=k;W>this.miterLimit&&(D=!0)}D?(v.push(this.normal[0],this.normal[1],0),v.push(L[0],L[1],0),h.push(a[0],a[1],a[2]|0,this.totalDistance,-this.thickness*O,a[2]|0),this.complex.indexes.push(this.currentIndex),h.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness*O,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,f.push.apply(f,it(this.lastFlip!==-O?[e,e+2,e+3]:[e+2,e+1,e+3])),f.push(e+2,e+3,e+4),Hn(ku,Un),sn(this.normal,ku),v.push(this.normal[0],this.normal[1],0),h.push(a[0],a[1],a[2]|0,this.totalDistance,-this.thickness*O,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,c+=3):(this.extrusions(h,v,a,L,k,this.totalDistance),f.push.apply(f,it(this.lastFlip===1?[e,e+2,e+3]:[e+2,e+1,e+3])),O=-1,sn(this.normal,L),c+=2),this.lastFlip=O}else{if(Hn(this.normal,de),p){var E=Ft(),b=Ft();vr(b,de,this.normal),Zt(E,de,this.normal),v.push(b[0],b[1],0),v.push(E[0],E[1],0),h.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),h.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(h,v,a,this.normal,this.thickness,this.totalDistance);f.push.apply(f,it(this.lastFlip===1?[e,e+2,e+3]:[e+2,e+1,e+3])),c+=2}return c}},{key:"simpleSegment",value:function(t,e,i,a,o){var s=0,u=t.indices,l=t.positions,c=t.normals,f=be([a[0],a[1]]),h=be([i[0],i[1]]);ba(de,f,h);var v=0;if(this.dash&&(v=this.lineSegmentDistance(f,h),this.totalDistance+=v),this.normal||(this.normal=Ft(),Hn(this.normal,de)),this.started||(this.started=!0,this.extrusions(l,c,i,this.normal,this.thickness,this.totalDistance-v)),u.push(e+0,e+1,e+2),!o)Hn(this.normal,de),this.extrusions(l,c,a,this.normal,this.thickness,this.totalDistance),u.push.apply(u,it(this.lastFlip===1?[e,e+2,e+3]:[e+2,e+1,e+3])),s+=2;else{var p=be([o[0],o[1]]);Af(f,p)&&Zt(p,f,kr(p,ji(p,f,h))),ba(Un,p,f);var d=bf(Sa,Ft(),de,Un,this.thickness),g=kt(d,2),y=g[0],m=g[1],x=Mn(Sa,this.normal)<0?-1:1;this.extrusions(l,c,a,m,y,this.totalDistance),u.push.apply(u,it(this.lastFlip===1?[e,e+2,e+3]:[e+2,e+1,e+3])),x=-1,sn(this.normal,m),s+=2,this.lastFlip=x}return s}},{key:"segment",value:function(t,e,i,a,o){var s=0,u=t.indices,l=t.positions,c=t.normals,f=this.cap==="square",h=this.join==="bevel",v=be([a[0],a[1]]),p=be([i[0],i[1]]);ba(de,v,p);var d=0;if(this.dash&&(d=this.lineSegmentDistance(v,p),this.totalDistance+=d),this.normal||(this.normal=Ft(),Hn(this.normal,de)),!this.started)if(this.started=!0,f){var g=Ft(),y=Ft();Zt(g,this.normal,de),Zt(y,this.normal,de),c.push(y[0],y[1],0),c.push(g[0],g[1],0),l.push(i[0],i[1],i[2]|0,this.totalDistance-d,-this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),l.push(i[0],i[1],i[2]|0,this.totalDistance-d,this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(l,c,i,this.normal,this.thickness,this.totalDistance-d);if(u.push(e+0,e+1,e+2),o){var _=be([o[0],o[1]]);Af(v,_)&&Zt(_,v,kr(_,ji(_,v,p))),ba(Un,_,v);var E=bf(Sa,Ft(),de,Un,this.thickness),b=kt(E,2),M=b[0],T=b[1],k=Mn(Sa,this.normal)<0?-1:1,L=h;if(!L&&this.join==="miter"){var O=M;O>this.miterLimit&&(L=!0)}L?(c.push(this.normal[0],this.normal[1],0),c.push(T[0],T[1],0),l.push(a[0],a[1],a[2]|0,this.totalDistance,-this.thickness*k,a[2]|0),this.complex.indexes.push(this.currentIndex),l.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness*k,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,u.push.apply(u,it(this.lastFlip!==-k?[e,e+2,e+3]:[e+2,e+1,e+3])),u.push(e+2,e+3,e+4),Hn(ku,Un),sn(this.normal,ku),c.push(this.normal[0],this.normal[1],0),l.push(a[0],a[1],a[2]|0,this.totalDistance,-this.thickness*k,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,s+=3):(this.extrusions(l,c,a,T,M,this.totalDistance),u.push.apply(u,it(this.lastFlip===1?[e,e+2,e+3]:[e+2,e+1,e+3])),k=-1,sn(this.normal,T),s+=2),this.lastFlip=k}else{if(Hn(this.normal,de),f){var m=Ft(),x=Ft();vr(x,de,this.normal),Zt(m,de,this.normal),c.push(x[0],x[1],0),c.push(m[0],m[1],0),l.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),l.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(l,c,a,this.normal,this.thickness,this.totalDistance);u.push.apply(u,it(this.lastFlip===1?[e,e+2,e+3]:[e+2,e+1,e+3])),s+=2}return s}},{key:"extrusions",value:function(t,e,i,a,o,s){e.push(a[0],a[1],0),e.push(a[0],a[1],0),t.push(i[0],i[1],i[2]|0,s,-o,i[2]|0),this.complex.indexes.push(this.currentIndex),t.push(i[0],i[1],i[2]|0,s,o,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(t,e){var i=e[0]-t[0],a=e[1]-t[1];return Math.sqrt(i*i+a*a)}}]),r}();function jh(r){var n=r.coordinates,t=r.originCoordinates,e=r.version,i=new NH({dash:!0,join:"bevel"});if(e==="GAODE2.x"){var a=n;Array.isArray(a[0][0])||(a=[n]);var o=t;Array.isArray(o[0][0])||(o=[t]);for(var s=0;s<a.length;s++){var u=a[s],l=o[s];i.extrude_gaode2(u,l)}}else{var c=n;c[0]&&!Array.isArray(c[0][0])&&(c=[n]),c.forEach(function(h){i.extrude(h)})}var f=i.complex;return{vertices:f.positions,indices:f.indices,normals:f.normals,indexes:f.indexes,size:6}}function Ju(r){var n=Or(r.coordinates);return{vertices:[].concat(it(n),it(n),it(n),it(n)),indices:[0,1,2,2,3,0],size:n.length}}function zH(r){var n=r.coordinates,t=Za.exports.flatten(n),e=t.vertices,i=t.dimensions,a=t.holes;return{indices:Za.exports(e,a,i),vertices:e,size:i}}var UH=function(){var r=Mt(st.mark(function n(t){var e,i,a,o,s,u,l,c,f;return st.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return e=t.descriptors,i=t.features,a=t.enablePicking,o=t.iconMap,s={a_Color:ed,a_Position:rd,filter:nd,a_vertexId:id,a_PickingColor:function(d){var g=d.id;return a?di(g):[0,0,0]},a_DistanceAndIndex:function(d,g,y,m,x,_){return _===void 0?[y[3],10]:[y[3],_]},a_Total_Distance:function(d,g,y,m){return[y[5]]},a_Size:function(d){var g=d.size,y=g===void 0?1:g;return Array.isArray(y)?[y[0],y[1]]:[y,0]},a_Normal:function(d,g,y,m,x){return x},a_Miter:function(d,g,y){return[y[4]]},a_iconMapUV:function(d){var g=d.texture,y=o[g]||{x:0,y:0},m=y.x,x=y.y;return[m,x]}},u={sizePerElement:0,elements:[]},l=0,c=[],f=3,i.forEach(function(p,d){var g=jh(p),y=g.indices,m=g.vertices,x=g.normals,_=g.size,E=g.indexes;y.forEach(function(k){c.push(k+l)}),f=_;var b=m.length/_;u.sizePerElement=f,u.elements.push({featureIdx:d,vertices:m,normals:x,offset:l}),l+=b;for(var M=function(L){var O=(x==null?void 0:x.slice(L*3,L*3+3))||[],D=m.slice(L*_,L*_+_),W=0;E&&E[L]!==void 0&&(W=E[L]),e.forEach(function(j){if(j&&s[j.name]){var ot;(ot=j.buffer.data).push.apply(ot,it(s[j.name](p,d,D,L,O,W)))}})},T=0;T<b;T++)M(T)}),v.abrupt("return",{descriptors:e,featureLayout:u,indices:c});case 8:case"end":return v.stop()}},n)}));return function(t){return r.apply(this,arguments)}}(),HH=function(){var r=Mt(st.mark(function n(t){var e,i,a,o,s,u,l,c,f;return st.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return e=t.descriptors,i=t.features,a=t.enablePicking,o=t.shape2d,s={a_Color:ed,a_Position:rd,filter:nd,a_vertexId:id,a_PickingColor:function(d){var g=d.id;return a?di(g):[0,0,0]},a_Shape:function(d){var g=d.shape,y=g===void 0?2:g,m=o.indexOf(y);return[m]},a_Extrude:function(d,g,y,m){var x=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],_=m%4*3;return[x[_],x[_+1],x[_+2]]},a_Size:function(d){var g=d.size,y=g===void 0?5:g;return Array.isArray(y)?[y[0]]:[y]}},u={sizePerElement:0,elements:[]},l=0,c=[],f=3,i.forEach(function(p,d){var g=Ju(p),y=g.indices,m=g.vertices,x=g.normals,_=g.size,E=g.indexes;y.forEach(function(k){c.push(k+l)}),f=_;var b=m.length/_;u.sizePerElement=f,u.elements.push({featureIdx:d,vertices:m,normals:x,offset:l}),l+=b;for(var M=function(L){var O=(x==null?void 0:x.slice(L*3,L*3+3))||[],D=m.slice(L*_,L*_+_),W=0;E&&E[L]!==void 0&&(W=E[L]),e.forEach(function(j){if(j&&s[j.name]){var ot;(ot=j.buffer.data).push.apply(ot,it(s[j.name](p,d,D,L,O,W)))}})},T=0;T<b;T++)M(T)}),v.abrupt("return",{descriptors:e,featureLayout:u,indices:c});case 8:case"end":return v.stop()}},n)}));return function(t){return r.apply(this,arguments)}}(),$H=function(){var r=Mt(st.mark(function n(t){var e,i,a,o,s,u,l,c;return st.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return e=t.descriptors,i=t.features,a=t.enablePicking,o={a_Color:ed,a_Position:rd,filter:nd,a_vertexId:id,a_PickingColor:function(p){var d=p.id;return a?di(d):[0,0,0]}},s={sizePerElement:0,elements:[]},u=0,l=[],c=3,i.forEach(function(v,p){var d=zH(v),g=d.indices,y=d.vertices,m=d.normals,x=d.size,_=d.indexes;g.forEach(function(T){l.push(T+u)}),c=x;var E=y.length/x;s.sizePerElement=c,s.elements.push({featureIdx:p,vertices:y,normals:m,offset:u}),u+=E;for(var b=function(k){var L=(m==null?void 0:m.slice(k*3,k*3+3))||[],O=y.slice(k*x,k*x+x),D=0;_&&_[k]!==void 0&&(D=_[k]),e.forEach(function(W){if(W&&o[W.name]){var j;(j=W.buffer.data).push.apply(j,it(o[W.name](v,p,O,k,L,D)))}})},M=0;M<E;M++)b(M)}),h.abrupt("return",{descriptors:e,featureLayout:s,indices:l});case 8:case"end":return h.stop()}},n)}));return function(t){return r.apply(this,arguments)}}(),q2={pointFill:HH,line:UH,polygonFill:$H},Py=U({},q2);function GH(r){return Xh.apply(this,arguments)}function Xh(){return Xh=Mt(st.mark(function r(n){var t,e;return st.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(t=n.workerType,e=n.data,!Py[t]){a.next=3;break}return a.abrupt("return",Py[t](e));case 3:return a.abrupt("return",Promise.reject(new Error('Worker with type "'.concat(t,'" non-existent.'))));case 4:case"end":return a.stop()}},r)})),Xh.apply(this,arguments)}jM(GH);var K2=new Map;function VH(r,n){K2.set(r,n)}function WH(r){var n=K2.get(r);return n}var jH=`var L7=function(t){"use strict";function e(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function r(){
/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */
r=function(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function c(t,e,r,n){var o=e&&e.prototype instanceof h?e:h,i=Object.create(o.prototype),a=new O(n||[]);return i._invoke=function(t,e,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return T()}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var u=w(a,r);if(u){if(u===l)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var s=f(t,e,r);if("normal"===s.type){if(n=r.done?"completed":"suspendedYield",s.arg===l)continue;return{value:s.arg,done:r.done}}"throw"===s.type&&(n="completed",r.method="throw",r.arg=s.arg)}}}(t,r,a),i}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=c;var l={};function h(){}function p(){}function v(){}var d={};s(d,i,(function(){return this}));var y=Object.getPrototypeOf,g=y&&y(y(S([])));g&&g!==e&&n.call(g,i)&&(d=g);var m=v.prototype=h.prototype=Object.create(d);function x(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function b(t,e){var r;this._invoke=function(o,i){function a(){return new e((function(r,a){!function r(o,i,a,u){var s=f(t[o],t,i);if("throw"!==s.type){var c=s.arg,l=c.value;return l&&"object"==typeof l&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,u)}),(function(t){r("throw",t,a,u)})):e.resolve(l).then((function(t){c.value=t,a(c)}),(function(t){return r("throw",t,a,u)}))}u(s.arg)}(o,i,r,a)}))}return r=r?r.then(a,a):a()}}function w(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,w(t,e),"throw"===e.method))return l;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=f(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,l;var o=n.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,l):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l)}function E(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function O(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(E,this),this.reset(!0)}function S(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,o=function e(){for(;++r<t.length;)if(n.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:T}}function T(){return{value:void 0,done:!0}}return p.prototype=v,s(m,"constructor",v),s(v,"constructor",p),p.displayName=s(v,u,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===p||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,v):(t.__proto__=v,s(t,u,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},x(b.prototype),s(b.prototype,a,(function(){return this})),t.AsyncIterator=b,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new b(c(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},x(m),s(m,u,"Generator"),s(m,i,(function(){return this})),s(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=S,O.prototype={constructor:O,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(A),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var u=n.call(i,"catchLoc"),s=n.call(i,"finallyLoc");if(u&&s){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,l):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),l}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:S(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},t}function n(t,e,r,n,o,i,a){try{var u=t[i](a),s=u.value}catch(t){return void r(t)}u.done?e(s):Promise.resolve(s).then(n,o)}function o(t){return function(){var e=this,r=arguments;return new Promise((function(o,i){var a=t.apply(e,r);function u(t){n(a,o,i,u,s,"next",t)}function s(t){n(a,o,i,u,s,"throw",t)}u(void 0)}))}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function u(t,e,r){return e&&a(t.prototype,e),r&&a(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function s(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function c(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&l(t,e)}function f(t){return(f=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function l(t,e){return(l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function h(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function p(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return h(t)}function v(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=f(t);if(e){var o=f(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return p(this,r)}}function d(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==r)return;var n,o,i=[],a=!0,u=!1;try{for(r=r.call(t);!(a=(n=r.next()).done)&&(i.push(n.value),!e||i.length!==e);a=!0);}catch(t){u=!0,o=t}finally{try{a||null==r.return||r.return()}finally{if(u)throw o}}return i}(t,e)||g(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y(t){return function(t){if(Array.isArray(t))return m(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||g(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function g(t,e){if(t){if("string"==typeof t)return m(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?m(t,e):void 0}}function m(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var x="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function b(t,e){return t(e={exports:{}},e.exports),e.exports}var w,E,A=function(t){return t&&t.Math==Math&&t},O=A("object"==typeof globalThis&&globalThis)||A("object"==typeof window&&window)||A("object"==typeof self&&self)||A("object"==typeof x&&x)||function(){return this}()||Function("return this")(),S=Object.defineProperty,T=function(t,e){try{S(O,t,{value:e,configurable:!0,writable:!0})}catch(r){O[t]=e}return e},k=O["__core-js_shared__"]||T("__core-js_shared__",{}),I=b((function(t){(t.exports=function(t,e){return k[t]||(k[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.24.1",mode:"global",copyright:"\xA9 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.24.1/LICENSE",source:"https://github.com/zloirock/core-js"})})),j=function(t){try{return!!t()}catch(t){return!0}},P=!j((function(){var t=function(){}.bind();return"function"!=typeof t||t.hasOwnProperty("prototype")})),_=Function.prototype,M=_.bind,L=_.call,R=P&&M.bind(L,L),C=P?function(t){return t&&R(t)}:function(t){return t&&function(){return L.apply(t,arguments)}},N=TypeError,D=function(t){if(null==t)throw N("Can't call method on "+t);return t},F=Object,W=function(t){return F(D(t))},z=C({}.hasOwnProperty),B=Object.hasOwn||function(t,e){return z(W(t),e)},U=0,G=Math.random(),V=C(1..toString),q=function(t){return"Symbol("+(void 0===t?"":t)+")_"+V(++U+G,36)},H=function(t){return"function"==typeof t},Z=function(t){return H(t)?t:void 0},Y=function(t,e){return arguments.length<2?Z(O[t]):O[t]&&O[t][e]},$=Y("navigator","userAgent")||"",K=O.process,Q=O.Deno,X=K&&K.versions||Q&&Q.version,J=X&&X.v8;J&&(E=(w=J.split("."))[0]>0&&w[0]<4?1:+(w[0]+w[1])),!E&&$&&(!(w=$.match(/Edge\\/(\\d+)/))||w[1]>=74)&&(w=$.match(/Chrome\\/(\\d+)/))&&(E=+w[1]);var tt=E,et=!!Object.getOwnPropertySymbols&&!j((function(){var t=Symbol();return!String(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&tt&&tt<41})),rt=et&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,nt=I("wks"),ot=O.Symbol,it=ot&&ot.for,at=rt?ot:ot&&ot.withoutSetter||q,ut=function(t){if(!B(nt,t)||!et&&"string"!=typeof nt[t]){var e="Symbol."+t;et&&B(ot,t)?nt[t]=ot[t]:nt[t]=rt&&it?it(e):at(e)}return nt[t]},st={};st[ut("toStringTag")]="z";var ct="[object z]"===String(st),ft=!j((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),lt=function(t){return"object"==typeof t?null!==t:H(t)},ht=O.document,pt=lt(ht)&&lt(ht.createElement),vt=function(t){return pt?ht.createElement(t):{}},dt=!ft&&!j((function(){return 7!=Object.defineProperty(vt("div"),"a",{get:function(){return 7}}).a})),yt=ft&&j((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype})),gt=String,mt=TypeError,xt=function(t){if(lt(t))return t;throw mt(gt(t)+" is not an object")},bt=Function.prototype.call,wt=P?bt.bind(bt):function(){return bt.apply(bt,arguments)},Et=C({}.isPrototypeOf),At=Object,Ot=rt?function(t){return"symbol"==typeof t}:function(t){var e=Y("Symbol");return H(e)&&Et(e.prototype,At(t))},St=String,Tt=function(t){try{return St(t)}catch(t){return"Object"}},kt=TypeError,It=function(t){if(H(t))return t;throw kt(Tt(t)+" is not a function")},jt=function(t,e){var r=t[e];return null==r?void 0:It(r)},Pt=TypeError,_t=TypeError,Mt=ut("toPrimitive"),Lt=function(t,e){if(!lt(t)||Ot(t))return t;var r,n=jt(t,Mt);if(n){if(void 0===e&&(e="default"),r=wt(n,t,e),!lt(r)||Ot(r))return r;throw _t("Can't convert object to primitive value")}return void 0===e&&(e="number"),function(t,e){var r,n;if("string"===e&&H(r=t.toString)&&!lt(n=wt(r,t)))return n;if(H(r=t.valueOf)&&!lt(n=wt(r,t)))return n;if("string"!==e&&H(r=t.toString)&&!lt(n=wt(r,t)))return n;throw Pt("Can't convert object to primitive value")}(t,e)},Rt=function(t){var e=Lt(t,"string");return Ot(e)?e:e+""},Ct=TypeError,Nt=Object.defineProperty,Dt=Object.getOwnPropertyDescriptor,Ft={f:ft?yt?function(t,e,r){if(xt(t),e=Rt(e),xt(r),"function"==typeof t&&"prototype"===e&&"value"in r&&"writable"in r&&!r.writable){var n=Dt(t,e);n&&n.writable&&(t[e]=r.value,r={configurable:"configurable"in r?r.configurable:n.configurable,enumerable:"enumerable"in r?r.enumerable:n.enumerable,writable:!1})}return Nt(t,e,r)}:Nt:function(t,e,r){if(xt(t),e=Rt(e),xt(r),dt)try{return Nt(t,e,r)}catch(t){}if("get"in r||"set"in r)throw Ct("Accessors not supported");return"value"in r&&(t[e]=r.value),t}},Wt=Function.prototype,zt=ft&&Object.getOwnPropertyDescriptor,Bt=B(Wt,"name"),Ut={EXISTS:Bt,PROPER:Bt&&"something"===function(){}.name,CONFIGURABLE:Bt&&(!ft||ft&&zt(Wt,"name").configurable)},Gt=C(Function.toString);H(k.inspectSource)||(k.inspectSource=function(t){return Gt(t)});var Vt,qt,Ht,Zt=k.inspectSource,Yt=O.WeakMap,$t=H(Yt)&&/native code/.test(Zt(Yt)),Kt=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},Qt=ft?function(t,e,r){return Ft.f(t,e,Kt(1,r))}:function(t,e,r){return t[e]=r,t},Xt=I("keys"),Jt=function(t){return Xt[t]||(Xt[t]=q(t))},te={},ee=O.TypeError,re=O.WeakMap;if($t||k.state){var ne=k.state||(k.state=new re),oe=C(ne.get),ie=C(ne.has),ae=C(ne.set);Vt=function(t,e){if(ie(ne,t))throw new ee("Object already initialized");return e.facade=t,ae(ne,t,e),e},qt=function(t){return oe(ne,t)||{}},Ht=function(t){return ie(ne,t)}}else{var ue=Jt("state");te[ue]=!0,Vt=function(t,e){if(B(t,ue))throw new ee("Object already initialized");return e.facade=t,Qt(t,ue,e),e},qt=function(t){return B(t,ue)?t[ue]:{}},Ht=function(t){return B(t,ue)}}var se={set:Vt,get:qt,has:Ht,enforce:function(t){return Ht(t)?qt(t):Vt(t,{})},getterFor:function(t){return function(e){var r;if(!lt(e)||(r=qt(e)).type!==t)throw ee("Incompatible receiver, "+t+" required");return r}}},ce=b((function(t){var e=Ut.CONFIGURABLE,r=se.enforce,n=se.get,o=Object.defineProperty,i=ft&&!j((function(){return 8!==o((function(){}),"length",{value:8}).length})),a=String(String).split("String"),u=t.exports=function(t,n,u){"Symbol("===String(n).slice(0,7)&&(n="["+String(n).replace(/^Symbol\\(([^)]*)\\)/,"$1")+"]"),u&&u.getter&&(n="get "+n),u&&u.setter&&(n="set "+n),(!B(t,"name")||e&&t.name!==n)&&(ft?o(t,"name",{value:n,configurable:!0}):t.name=n),i&&u&&B(u,"arity")&&t.length!==u.arity&&o(t,"length",{value:u.arity});try{u&&B(u,"constructor")&&u.constructor?ft&&o(t,"prototype",{writable:!1}):t.prototype&&(t.prototype=void 0)}catch(t){}var s=r(t);return B(s,"source")||(s.source=a.join("string"==typeof n?n:"")),t};Function.prototype.toString=u((function(){return H(this)&&n(this).source||Zt(this)}),"toString")})),fe=function(t,e,r,n){n||(n={});var o=n.enumerable,i=void 0!==n.name?n.name:e;if(H(r)&&ce(r,i,n),n.global)o?t[e]=r:T(e,r);else{try{n.unsafe?t[e]&&(o=!0):delete t[e]}catch(t){}o?t[e]=r:Ft.f(t,e,{value:r,enumerable:!1,configurable:!n.nonConfigurable,writable:!n.nonWritable})}return t},le=C({}.toString),he=C("".slice),pe=function(t){return he(le(t),8,-1)},ve=ut("toStringTag"),de=Object,ye="Arguments"==pe(function(){return arguments}()),ge=ct?pe:function(t){var e,r,n;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(r=function(t,e){try{return t[e]}catch(t){}}(e=de(t),ve))?r:ye?pe(e):"Object"==(n=pe(e))&&H(e.callee)?"Arguments":n},me=ct?{}.toString:function(){return"[object "+ge(this)+"]"};ct||fe(Object.prototype,"toString",me,{unsafe:!0});var xe={}.propertyIsEnumerable,be=Object.getOwnPropertyDescriptor,we={f:be&&!xe.call({1:2},1)?function(t){var e=be(this,t);return!!e&&e.enumerable}:xe},Ee=Object,Ae=C("".split),Oe=j((function(){return!Ee("z").propertyIsEnumerable(0)}))?function(t){return"String"==pe(t)?Ae(t,""):Ee(t)}:Ee,Se=function(t){return Oe(D(t))},Te=Object.getOwnPropertyDescriptor,ke={f:ft?Te:function(t,e){if(t=Se(t),e=Rt(e),dt)try{return Te(t,e)}catch(t){}if(B(t,e))return Kt(!wt(we.f,t,e),t[e])}},Ie=Math.ceil,je=Math.floor,Pe=Math.trunc||function(t){var e=+t;return(e>0?je:Ie)(e)},_e=function(t){var e=+t;return e!=e||0===e?0:Pe(e)},Me=Math.max,Le=Math.min,Re=function(t,e){var r=_e(t);return r<0?Me(r+e,0):Le(r,e)},Ce=Math.min,Ne=function(t){return t>0?Ce(_e(t),9007199254740991):0},De=function(t){return Ne(t.length)},Fe=function(t){return function(e,r,n){var o,i=Se(e),a=De(i),u=Re(n,a);if(t&&r!=r){for(;a>u;)if((o=i[u++])!=o)return!0}else for(;a>u;u++)if((t||u in i)&&i[u]===r)return t||u||0;return!t&&-1}},We={includes:Fe(!0),indexOf:Fe(!1)},ze=We.indexOf,Be=C([].push),Ue=function(t,e){var r,n=Se(t),o=0,i=[];for(r in n)!B(te,r)&&B(n,r)&&Be(i,r);for(;e.length>o;)B(n,r=e[o++])&&(~ze(i,r)||Be(i,r));return i},Ge=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Ve=Ge.concat("length","prototype"),qe={f:Object.getOwnPropertyNames||function(t){return Ue(t,Ve)}},He={f:Object.getOwnPropertySymbols},Ze=C([].concat),Ye=Y("Reflect","ownKeys")||function(t){var e=qe.f(xt(t)),r=He.f;return r?Ze(e,r(t)):e},$e=function(t,e,r){for(var n=Ye(e),o=Ft.f,i=ke.f,a=0;a<n.length;a++){var u=n[a];B(t,u)||r&&B(r,u)||o(t,u,i(e,u))}},Ke=/#|\\.prototype\\./,Qe=function(t,e){var r=Je[Xe(t)];return r==er||r!=tr&&(H(e)?j(e):!!e)},Xe=Qe.normalize=function(t){return String(t).replace(Ke,".").toLowerCase()},Je=Qe.data={},tr=Qe.NATIVE="N",er=Qe.POLYFILL="P",rr=Qe,nr=ke.f,or=function(t,e){var r,n,o,i,a,u=t.target,s=t.global,c=t.stat;if(r=s?O:c?O[u]||T(u,{}):(O[u]||{}).prototype)for(n in e){if(i=e[n],o=t.dontCallGetSet?(a=nr(r,n))&&a.value:r[n],!rr(s?n:u+(c?".":"#")+n,t.forced)&&void 0!==o){if(typeof i==typeof o)continue;$e(i,o)}(t.sham||o&&o.sham)&&Qt(i,"sham",!0),fe(r,n,i,t)}},ir="process"==pe(O.process),ar=String,ur=TypeError,sr=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,r={};try{(t=C(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(r,[]),e=r instanceof Array}catch(t){}return function(r,n){return xt(r),function(t){if("object"==typeof t||H(t))return t;throw ur("Can't set "+ar(t)+" as a prototype")}(n),e?t(r,n):r.__proto__=n,r}}():void 0),cr=Ft.f,fr=ut("toStringTag"),lr=function(t,e,r){t&&!r&&(t=t.prototype),t&&!B(t,fr)&&cr(t,fr,{configurable:!0,value:e})},hr=ut("species"),pr=function(t){var e=Y(t),r=Ft.f;ft&&e&&!e[hr]&&r(e,hr,{configurable:!0,get:function(){return this}})},vr=TypeError,dr=function(t,e){if(Et(e,t))return t;throw vr("Incorrect invocation")},yr=function(){},gr=[],mr=Y("Reflect","construct"),xr=/^\\s*(?:class|function)\\b/,br=C(xr.exec),wr=!xr.exec(yr),Er=function(t){if(!H(t))return!1;try{return mr(yr,gr,t),!0}catch(t){return!1}},Ar=function(t){if(!H(t))return!1;switch(ge(t)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return wr||!!br(xr,Zt(t))}catch(t){return!0}};Ar.sham=!0;var Or,Sr,Tr,kr,Ir=!mr||j((function(){var t;return Er(Er.call)||!Er(Object)||!Er((function(){t=!0}))||t}))?Ar:Er,jr=TypeError,Pr=function(t){if(Ir(t))return t;throw jr(Tt(t)+" is not a constructor")},_r=ut("species"),Mr=function(t,e){var r,n=xt(t).constructor;return void 0===n||null==(r=xt(n)[_r])?e:Pr(r)},Lr=Function.prototype,Rr=Lr.apply,Cr=Lr.call,Nr="object"==typeof Reflect&&Reflect.apply||(P?Cr.bind(Rr):function(){return Cr.apply(Rr,arguments)}),Dr=C(C.bind),Fr=function(t,e){return It(t),void 0===e?t:P?Dr(t,e):function(){return t.apply(e,arguments)}},Wr=Y("document","documentElement"),zr=C([].slice),Br=TypeError,Ur=function(t,e){if(t<e)throw Br("Not enough arguments");return t},Gr=/(?:ipad|iphone|ipod).*applewebkit/i.test($),Vr=O.setImmediate,qr=O.clearImmediate,Hr=O.process,Zr=O.Dispatch,Yr=O.Function,$r=O.MessageChannel,Kr=O.String,Qr=0,Xr={};try{Or=O.location}catch(t){}var Jr=function(t){if(B(Xr,t)){var e=Xr[t];delete Xr[t],e()}},tn=function(t){return function(){Jr(t)}},en=function(t){Jr(t.data)},rn=function(t){O.postMessage(Kr(t),Or.protocol+"//"+Or.host)};Vr&&qr||(Vr=function(t){Ur(arguments.length,1);var e=H(t)?t:Yr(t),r=zr(arguments,1);return Xr[++Qr]=function(){Nr(e,void 0,r)},Sr(Qr),Qr},qr=function(t){delete Xr[t]},ir?Sr=function(t){Hr.nextTick(tn(t))}:Zr&&Zr.now?Sr=function(t){Zr.now(tn(t))}:$r&&!Gr?(kr=(Tr=new $r).port2,Tr.port1.onmessage=en,Sr=Fr(kr.postMessage,kr)):O.addEventListener&&H(O.postMessage)&&!O.importScripts&&Or&&"file:"!==Or.protocol&&!j(rn)?(Sr=rn,O.addEventListener("message",en,!1)):Sr="onreadystatechange"in vt("script")?function(t){Wr.appendChild(vt("script")).onreadystatechange=function(){Wr.removeChild(this),Jr(t)}}:function(t){setTimeout(tn(t),0)});var nn,on,an,un,sn,cn,fn,ln,hn={set:Vr,clear:qr},pn=/ipad|iphone|ipod/i.test($)&&void 0!==O.Pebble,vn=/web0s(?!.*chrome)/i.test($),dn=ke.f,yn=hn.set,gn=O.MutationObserver||O.WebKitMutationObserver,mn=O.document,xn=O.process,bn=O.Promise,wn=dn(O,"queueMicrotask"),En=wn&&wn.value;En||(nn=function(){var t,e;for(ir&&(t=xn.domain)&&t.exit();on;){e=on.fn,on=on.next;try{e()}catch(t){throw on?un():an=void 0,t}}an=void 0,t&&t.enter()},Gr||ir||vn||!gn||!mn?!pn&&bn&&bn.resolve?((fn=bn.resolve(void 0)).constructor=bn,ln=Fr(fn.then,fn),un=function(){ln(nn)}):ir?un=function(){xn.nextTick(nn)}:(yn=Fr(yn,O),un=function(){yn(nn)}):(sn=!0,cn=mn.createTextNode(""),new gn(nn).observe(cn,{characterData:!0}),un=function(){cn.data=sn=!sn}));var An=En||function(t){var e={fn:t,next:void 0};an&&(an.next=e),on||(on=e,un()),an=e},On=function(t){try{return{error:!1,value:t()}}catch(t){return{error:!0,value:t}}},Sn=function(){this.head=null,this.tail=null};Sn.prototype={add:function(t){var e={item:t,next:null};this.head?this.tail.next=e:this.head=e,this.tail=e},get:function(){var t=this.head;if(t)return this.head=t.next,this.tail===t&&(this.tail=null),t.item}};var Tn,kn,In,jn=Sn,Pn=O.Promise,_n="object"==typeof Deno&&Deno&&"object"==typeof Deno.version,Mn=!_n&&!ir&&"object"==typeof window&&"object"==typeof document,Ln=(Pn&&Pn.prototype,ut("species")),Rn=!1,Cn=H(O.PromiseRejectionEvent),Nn={CONSTRUCTOR:rr("Promise",(function(){var t=Zt(Pn),e=t!==String(Pn);if(!e&&66===tt)return!0;if(!tt||tt<51||!/native code/.test(t)){var r=new Pn((function(t){t(1)})),n=function(t){t((function(){}),(function(){}))};if((r.constructor={})[Ln]=n,!(Rn=r.then((function(){}))instanceof n))return!0}return!e&&(Mn||_n)&&!Cn})),REJECTION_EVENT:Cn,SUBCLASSING:Rn},Dn=function(t){var e,r;this.promise=new t((function(t,n){if(void 0!==e||void 0!==r)throw TypeError("Bad Promise constructor");e=t,r=n})),this.resolve=It(e),this.reject=It(r)},Fn={f:function(t){return new Dn(t)}},Wn=hn.set,zn=Nn.CONSTRUCTOR,Bn=Nn.REJECTION_EVENT,Un=Nn.SUBCLASSING,Gn=se.getterFor("Promise"),Vn=se.set,qn=Pn&&Pn.prototype,Hn=Pn,Zn=qn,Yn=O.TypeError,$n=O.document,Kn=O.process,Qn=Fn.f,Xn=Qn,Jn=!!($n&&$n.createEvent&&O.dispatchEvent),to=function(t){var e;return!(!lt(t)||!H(e=t.then))&&e},eo=function(t,e){var r,n,o,i=e.value,a=1==e.state,u=a?t.ok:t.fail,s=t.resolve,c=t.reject,f=t.domain;try{u?(a||(2===e.rejection&&ao(e),e.rejection=1),!0===u?r=i:(f&&f.enter(),r=u(i),f&&(f.exit(),o=!0)),r===t.promise?c(Yn("Promise-chain cycle")):(n=to(r))?wt(n,r,s,c):s(r)):c(i)}catch(t){f&&!o&&f.exit(),c(t)}},ro=function(t,e){t.notified||(t.notified=!0,An((function(){for(var r,n=t.reactions;r=n.get();)eo(r,t);t.notified=!1,e&&!t.rejection&&oo(t)})))},no=function(t,e,r){var n,o;Jn?((n=$n.createEvent("Event")).promise=e,n.reason=r,n.initEvent(t,!1,!0),O.dispatchEvent(n)):n={promise:e,reason:r},!Bn&&(o=O["on"+t])?o(n):"unhandledrejection"===t&&function(t,e){var r=O.console;r&&r.error&&(1==arguments.length?r.error(t):r.error(t,e))}("Unhandled promise rejection",r)},oo=function(t){wt(Wn,O,(function(){var e,r=t.facade,n=t.value;if(io(t)&&(e=On((function(){ir?Kn.emit("unhandledRejection",n,r):no("unhandledrejection",r,n)})),t.rejection=ir||io(t)?2:1,e.error))throw e.value}))},io=function(t){return 1!==t.rejection&&!t.parent},ao=function(t){wt(Wn,O,(function(){var e=t.facade;ir?Kn.emit("rejectionHandled",e):no("rejectionhandled",e,t.value)}))},uo=function(t,e,r){return function(n){t(e,n,r)}},so=function(t,e,r){t.done||(t.done=!0,r&&(t=r),t.value=e,t.state=2,ro(t,!0))},co=function(t,e,r){if(!t.done){t.done=!0,r&&(t=r);try{if(t.facade===e)throw Yn("Promise can't be resolved itself");var n=to(e);n?An((function(){var r={done:!1};try{wt(n,e,uo(co,r,t),uo(so,r,t))}catch(e){so(r,e,t)}})):(t.value=e,t.state=1,ro(t,!1))}catch(e){so({done:!1},e,t)}}};if(zn&&(Zn=(Hn=function(t){dr(this,Zn),It(t),wt(Tn,this);var e=Gn(this);try{t(uo(co,e),uo(so,e))}catch(t){so(e,t)}}).prototype,(Tn=function(t){Vn(this,{type:"Promise",done:!1,notified:!1,parent:!1,reactions:new jn,rejection:!1,state:0,value:void 0})}).prototype=fe(Zn,"then",(function(t,e){var r=Gn(this),n=Qn(Mr(this,Hn));return r.parent=!0,n.ok=!H(t)||t,n.fail=H(e)&&e,n.domain=ir?Kn.domain:void 0,0==r.state?r.reactions.add(n):An((function(){eo(n,r)})),n.promise})),kn=function(){var t=new Tn,e=Gn(t);this.promise=t,this.resolve=uo(co,e),this.reject=uo(so,e)},Fn.f=Qn=function(t){return t===Hn||void 0===t?new kn(t):Xn(t)},H(Pn)&&qn!==Object.prototype)){In=qn.then,Un||fe(qn,"then",(function(t,e){var r=this;return new Hn((function(t,e){wt(In,r,t,e)})).then(t,e)}),{unsafe:!0});try{delete qn.constructor}catch(t){}sr&&sr(qn,Zn)}or({global:!0,constructor:!0,wrap:!0,forced:zn},{Promise:Hn}),lr(Hn,"Promise",!1),pr("Promise");var fo={},lo=ut("iterator"),ho=Array.prototype,po=function(t){return void 0!==t&&(fo.Array===t||ho[lo]===t)},vo=ut("iterator"),yo=function(t){if(null!=t)return jt(t,vo)||jt(t,"@@iterator")||fo[ge(t)]},go=TypeError,mo=function(t,e){var r=arguments.length<2?yo(t):e;if(It(r))return xt(wt(r,t));throw go(Tt(t)+" is not iterable")},xo=function(t,e,r){var n,o;xt(t);try{if(!(n=jt(t,"return"))){if("throw"===e)throw r;return r}n=wt(n,t)}catch(t){o=!0,n=t}if("throw"===e)throw r;if(o)throw n;return xt(n),r},bo=TypeError,wo=function(t,e){this.stopped=t,this.result=e},Eo=wo.prototype,Ao=function(t,e,r){var n,o,i,a,u,s,c,f=r&&r.that,l=!(!r||!r.AS_ENTRIES),h=!(!r||!r.IS_RECORD),p=!(!r||!r.IS_ITERATOR),v=!(!r||!r.INTERRUPTED),d=Fr(e,f),y=function(t){return n&&xo(n,"normal",t),new wo(!0,t)},g=function(t){return l?(xt(t),v?d(t[0],t[1],y):d(t[0],t[1])):v?d(t,y):d(t)};if(h)n=t.iterator;else if(p)n=t;else{if(!(o=yo(t)))throw bo(Tt(t)+" is not iterable");if(po(o)){for(i=0,a=De(t);a>i;i++)if((u=g(t[i]))&&Et(Eo,u))return u;return new wo(!1)}n=mo(t,o)}for(s=h?t.next:n.next;!(c=wt(s,n)).done;){try{u=g(c.value)}catch(t){xo(n,"throw",t)}if("object"==typeof u&&u&&Et(Eo,u))return u}return new wo(!1)},Oo=ut("iterator"),So=!1;try{var To=0,ko={next:function(){return{done:!!To++}},return:function(){So=!0}};ko[Oo]=function(){return this},Array.from(ko,(function(){throw 2}))}catch(t){}var Io=function(t,e){if(!e&&!So)return!1;var r=!1;try{var n={};n[Oo]=function(){return{next:function(){return{done:r=!0}}}},t(n)}catch(t){}return r},jo=Nn.CONSTRUCTOR||!Io((function(t){Pn.all(t).then(void 0,(function(){}))}));or({target:"Promise",stat:!0,forced:jo},{all:function(t){var e=this,r=Fn.f(e),n=r.resolve,o=r.reject,i=On((function(){var r=It(e.resolve),i=[],a=0,u=1;Ao(t,(function(t){var s=a++,c=!1;u++,wt(r,e,t).then((function(t){c||(c=!0,i[s]=t,--u||n(i))}),o)})),--u||n(i)}));return i.error&&o(i.value),r.promise}});var Po=Nn.CONSTRUCTOR,_o=Pn&&Pn.prototype;if(or({target:"Promise",proto:!0,forced:Po,real:!0},{catch:function(t){return this.then(void 0,t)}}),H(Pn)){var Mo=Y("Promise").prototype.catch;_o.catch!==Mo&&fe(_o,"catch",Mo,{unsafe:!0})}or({target:"Promise",stat:!0,forced:jo},{race:function(t){var e=this,r=Fn.f(e),n=r.reject,o=On((function(){var o=It(e.resolve);Ao(t,(function(t){wt(o,e,t).then(r.resolve,n)}))}));return o.error&&n(o.value),r.promise}}),or({target:"Promise",stat:!0,forced:Nn.CONSTRUCTOR},{reject:function(t){var e=Fn.f(this);return wt(e.reject,void 0,t),e.promise}});var Lo=Nn.CONSTRUCTOR;Y("Promise");function Ro(t,e){if(!t)throw new Error(e||"web worker helper assertion failed.")}or({target:"Promise",stat:!0,forced:Lo},{resolve:function(t){return function(t,e){if(xt(t),lt(e)&&e.constructor===t)return e;var r=Fn.f(t);return(0,r.resolve)(e),r.promise}(this,t)}});var Co="undefined"!=typeof window&&void 0!==window.orientation,No=function(){function t(t,e){var r=this;this.name=t,this.workerThread=e,this.isRunning=!0,this.resolve=function(){},this.reject=function(){},this.result=new Promise((function(t,e){r.resolve=t,r.reject=e}))}return t.prototype.postMessage=function(t,e){this.workerThread.postMessage({source:"Main thread",type:t,payload:e})},t.prototype.done=function(t){Ro(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.resolve(t)},t.prototype.error=function(t){Ro(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.reject(t)},t}(),Do=new Map;function Fo(t){Ro(t.source&&!t.url||!t.source&&t.url);var e=Do.get(t.source||t.url);return e||(t.url&&(e=function(t){if(!t.startsWith("http"))return t;return Wo((e=t,"try {\\n  importScripts('"+e+"');\\n} catch (error) {\\n  console.error(error);\\n  throw error;\\n}"));var e}(t.url),Do.set(t.url,e)),t.source&&(e=Wo(t.source),Do.set(t.source,e))),Ro(e),e}function Wo(t){var e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function zo(t,e,r){void 0===e&&(e=!0);var n=r||new Set;if(t){if(Bo(t))n.add(t);else if(Bo(t.buffer))n.add(t.buffer);else if(ArrayBuffer.isView(t));else if(e&&"object"==typeof t)for(var o in t)zo(t[o],e,n)}else;return void 0===r?Array.from(n):[]}function Bo(t){return!!t&&(t instanceof ArrayBuffer||("undefined"!=typeof MessagePort&&t instanceof MessagePort||("undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap||"undefined"!=typeof OffscreenCanvas&&t instanceof OffscreenCanvas)))}var Uo=function(){},Go=function(){function t(t){this.terminated=!1,this.loadableURL="";var e=t.name,r=t.source,n=t.url;Ro(r||n),this.name=e,this.source=r,this.url=n,this.onMessage=Uo,this.onError=function(t){return console.log(t)},this.worker=this.createBrowserWorker()}return t.isSupported=function(){return"undefined"!=typeof Worker},t.prototype.destroy=function(){this.onMessage=Uo,this.onError=Uo,this.worker.terminate(),this.terminated=!0},Object.defineProperty(t.prototype,"isRunning",{get:function(){return Boolean(this.onMessage)},enumerable:!1,configurable:!0}),t.prototype.postMessage=function(t,e){e=e||zo(t),this.worker.postMessage(t,e)},t.prototype.getErrorFromErrorEvent=function(t){var e="Failed to load ";return e+="worker "+this.name+" from "+this.url+". ",t.message&&(e+=t.message+" in "),t.lineno&&(e+=":"+t.lineno+":"+t.colno),new Error(e)},t.prototype.createBrowserWorker=function(){var t=this;this.loadableURL=Fo({source:this.source,url:this.url});var e=new Worker(this.loadableURL,{name:this.name});return e.onmessage=function(e){e.data?t.onMessage(e.data):t.onError(new Error("No data received"))},e.onerror=function(e){t.onError(t.getErrorFromErrorEvent(e)),t.terminated=!0},e.onmessageerror=function(e){return console.error("worker "+t.name+", message error: "+e)},e},t}(),Vo=self&&self.__assign||function(){return(Vo=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},qo=self&&self.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{s(n.next(t))}catch(t){i(t)}}function u(t){try{s(n.throw(t))}catch(t){i(t)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,u)}s((n=n.apply(t,e||[])).next())}))},Ho=self&&self.__generator||function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},Zo=function(){function t(t){this.name="unnamed",this.maxConcurrency=1,this.maxMobileConcurrency=1,this.onDebug=function(){},this.reuseWorkers=!0,this.props={},this.jobQueue=[],this.idleQueue=[],this.count=0,this.isDestroyed=!1,this.source=t.source,this.url=t.url,this.setProps(t)}return t.prototype.destroy=function(){this.idleQueue.forEach((function(t){return t.destroy()})),this.isDestroyed=!0},t.prototype.setProps=function(t){this.props=Vo(Vo({},this.props),t),void 0!==t.name&&(this.name=t.name),void 0!==t.maxConcurrency&&(this.maxConcurrency=t.maxConcurrency),void 0!==t.maxMobileConcurrency&&(this.maxMobileConcurrency=t.maxMobileConcurrency),void 0!==t.reuseWorkers&&(this.reuseWorkers=t.reuseWorkers),void 0!==t.onDebug&&(this.onDebug=t.onDebug)},t.prototype.startJob=function(t,e,r){return void 0===e&&(e=function(t,e,r){return t.done(r)}),void 0===r&&(r=function(t,e){return t.error(e)}),qo(this,void 0,void 0,(function(){var n,o=this;return Ho(this,(function(i){switch(i.label){case 0:return n=new Promise((function(n){return o.jobQueue.push({name:t,onMessage:e,onError:r,onStart:n}),o})),this.startQueuedJob(),[4,n];case 1:return[2,i.sent()]}}))}))},t.prototype.startQueuedJob=function(){return qo(this,void 0,void 0,(function(){var t,e,r;return Ho(this,(function(n){switch(n.label){case 0:if(!this.jobQueue.length)return[2];if(!(t=this.getAvailableWorker()))return[2];if(!(e=this.jobQueue.shift()))return[3,4];this.onDebug({message:"Starting job",name:e.name,backlog:this.jobQueue.length,workerThread:t}),r=new No(e.name,t),t.onMessage=function(t){return e.onMessage(r,t.type,t.payload)},t.onError=function(t){return e.onError(r,t)},e.onStart(r),n.label=1;case 1:return n.trys.push([1,,3,4]),[4,r.result];case 2:return n.sent(),[3,4];case 3:return this.returnWorkerToQueue(t),[7];case 4:return[2]}}))}))},t.prototype.returnWorkerToQueue=function(t){this.isDestroyed||!this.reuseWorkers||this.count>this.getMaxConcurrency()?(t.destroy(),this.count--):this.idleQueue.push(t),this.isDestroyed||this.startQueuedJob()},t.prototype.getAvailableWorker=function(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this.getMaxConcurrency()){this.count++;var t=this.name.toLowerCase()+" (#"+this.count+" of "+this.maxConcurrency+")";return new Go({name:t,source:this.source,url:this.url})}return null},t.prototype.getMaxConcurrency=function(){return Co?this.maxMobileConcurrency:this.maxConcurrency},t}(),Yo=self&&self.__assign||function(){return(Yo=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},$o=self&&self.__values||function(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Ko={maxConcurrency:3,maxMobileConcurrency:1,onDebug:function(){},reuseWorkers:!0},Qo=(function(){function t(t){this.workerPools=new Map,this.props=Yo({},Ko),this.setProps(t),this.workerPools=new Map}t.isSupported=function(){return Go.isSupported()},t.getWorkerFarm=function(e){return void 0===e&&(e={}),t.workerFarm=t.workerFarm||new t({}),t.workerFarm.setProps(e),t.workerFarm},t.prototype.destroy=function(){var t,e;try{for(var r=$o(this.workerPools.values()),n=r.next();!n.done;n=r.next()){n.value.destroy()}}catch(e){t={error:e}}finally{try{n&&!n.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}},t.prototype.setProps=function(t){var e,r;this.props=Yo(Yo({},this.props),t);try{for(var n=$o(this.workerPools.values()),o=n.next();!o.done;o=n.next()){o.value.setProps(this.getWorkerPoolProps())}}catch(t){e={error:t}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(e)throw e.error}}},t.prototype.getWorkerPool=function(t){var e=t.name,r=t.source,n=t.url,o=this.workerPools.get(e);return o||((o=new Zo({name:e,source:r,url:n})).setProps(this.getWorkerPoolProps()),this.workerPools.set(e,o)),o},t.prototype.getWorkerPoolProps=function(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}(),new Map),Xo=function(){function t(){}return Object.defineProperty(t,"onmessage",{set:function(t){self.onmessage=function(e){if(Jo(e)){var r=e.data,n=r.type,o=r.payload;t(n,o)}}},enumerable:!1,configurable:!0}),t.addEventListener=function(t){var e=Qo.get(t);e||(e=function(e){if(Jo(e)){var r=e.data,n=r.type,o=r.payload;t(n,o)}}),self.addEventListener("message",e)},t.removeEventListener=function(t){var e=Qo.get(t);Qo.delete(t),self.removeEventListener("message",e)},t.postMessage=function(t,e){if(self){var r={source:"Worker thread",type:t,payload:e},n=zo(e);self.postMessage(r,n)}},t}();function Jo(t){var e=t.type,r=t.data;return"message"===e&&r&&"string"==typeof r.source&&"Main thread"===r.source}self&&self.__awaiter,self&&self.__generator;var ti,ei,ri=function(){function t(){this._values=[],this._settlers=[],this._closed=!1}return t.prototype[Symbol.asyncIterator]=function(){return this},t.prototype.push=function(t){return this.enqueue(t)},t.prototype.enqueue=function(t){if(this._closed)throw new Error("Closed");if(this._settlers.length>0){if(this._values.length>0)throw new Error("Illegal internal state");var e=this._settlers.shift();t instanceof Error?e.reject(t):e.resolve({value:t})}else this._values.push(t)},t.prototype.close=function(){for(;this._settlers.length>0;){this._settlers.shift().resolve({done:!0})}this._closed=!0},t.prototype.next=function(){var t=this;if(this._values.length>0){var e=this._values.shift();return e instanceof Error?Promise.reject(e):Promise.resolve({done:!1,value:e})}if(this._closed){if(this._settlers.length>0)throw new Error("Illegal internal state");return Promise.resolve({done:!0,value:void 0})}return new Promise((function(e,r){t._settlers.push({resolve:e,reject:r})}))},t}(),ni=self&&self.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{s(n.next(t))}catch(t){i(t)}}function u(t){try{s(n.throw(t))}catch(t){i(t)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,u)}s((n=n.apply(t,e||[])).next())}))},oi=self&&self.__generator||function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},ii=self&&self.__asyncValues||function(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,r=t[Symbol.asyncIterator];return r?r.call(t):(t="function"==typeof __values?__values(t):t[Symbol.iterator](),e={},n("next"),n("throw"),n("return"),e[Symbol.asyncIterator]=function(){return this},e);function n(r){e[r]=t[r]&&function(e){return new Promise((function(n,o){(function(t,e,r,n){Promise.resolve(n).then((function(e){t({value:e,done:r})}),e)})(n,o,(e=t[r](e)).done,e.value)}))}}},ai=0;function ui(t,e){var r=this;if("undefined"!=typeof self){var n={process:si};Xo.onmessage=function(o,i){return ni(r,void 0,void 0,(function(){var r,a,u,s,c,f,l,h,p,v;return oi(this,(function(d){switch(d.label){case 0:switch(d.trys.push([0,19,,20]),o){case"process":return[3,1];case"process-in-batches":return[3,3];case"input-batch":return[3,16];case"input-done":return[3,17]}return[3,18];case 1:if(!t)throw new Error("Worker does not support atomic processing");return[4,t(i.input,i.options||{},n)];case 2:return r=d.sent(),Xo.postMessage("done",{result:r}),[3,18];case 3:if(!e)throw new Error("Worker does not support batched processing");ti=new ri,ei=i.options||{},a=e(ti,ei,n),d.label=4;case 4:d.trys.push([4,9,10,15]),u=ii(a),d.label=5;case 5:return[4,u.next()];case 6:if((s=d.sent()).done)return[3,8];c=s.value,Xo.postMessage("output-batch",{result:c}),d.label=7;case 7:return[3,5];case 8:return[3,15];case 9:return f=d.sent(),p={error:f},[3,15];case 10:return d.trys.push([10,,13,14]),s&&!s.done&&(v=u.return)?[4,v.call(u)]:[3,12];case 11:d.sent(),d.label=12;case 12:return[3,14];case 13:if(p)throw p.error;return[7];case 14:return[7];case 15:return Xo.postMessage("done",{}),[3,18];case 16:return ti.push(i.input),[3,18];case 17:return ti.close(),[3,18];case 18:return[3,20];case 19:return l=d.sent(),h=l instanceof Error?l.message:"",Xo.postMessage("error",{error:h}),[3,20];case 20:return[2]}}))}))}}}function si(t,e){return void 0===e&&(e={}),new Promise((function(r,n){var o=ai++,i=function(t,e){if(e.id===o)switch(t){case"done":Xo.removeEventListener(i),r(e.result);break;case"error":Xo.removeEventListener(i),n(e.error)}};Xo.addEventListener(i);var a={id:o,input:t,options:e};Xo.postMessage("process",a)}))}self&&self.__awaiter,self&&self.__generator;var ci={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},fi=vt("span").classList,li=fi&&fi.constructor&&fi.constructor.prototype,hi=li===Object.prototype?void 0:li,pi=Array.isArray||function(t){return"Array"==pe(t)},vi=ut("species"),di=Array,yi=function(t,e){return new(function(t){var e;return pi(t)&&(e=t.constructor,(Ir(e)&&(e===di||pi(e.prototype))||lt(e)&&null===(e=e[vi]))&&(e=void 0)),void 0===e?di:e}(t))(0===e?0:e)},gi=C([].push),mi=function(t){var e=1==t,r=2==t,n=3==t,o=4==t,i=6==t,a=7==t,u=5==t||i;return function(s,c,f,l){for(var h,p,v=W(s),d=Oe(v),y=Fr(c,f),g=De(d),m=0,x=l||yi,b=e?x(s,g):r||a?x(s,0):void 0;g>m;m++)if((u||m in d)&&(p=y(h=d[m],m,v),t))if(e)b[m]=p;else if(p)switch(t){case 3:return!0;case 5:return h;case 6:return m;case 2:gi(b,h)}else switch(t){case 4:return!1;case 7:gi(b,h)}return i?-1:n||o?o:b}},xi={forEach:mi(0),map:mi(1),filter:mi(2),some:mi(3),every:mi(4),find:mi(5),findIndex:mi(6),filterReject:mi(7)},bi=function(t,e){var r=[][t];return!!r&&j((function(){r.call(null,e||function(){return 1},1)}))},wi=xi.forEach,Ei=bi("forEach")?[].forEach:function(t){return wi(this,t,arguments.length>1?arguments[1]:void 0)},Ai=function(t){if(t&&t.forEach!==Ei)try{Qt(t,"forEach",Ei)}catch(e){t.forEach=Ei}};for(var Oi in ci)ci[Oi]&&Ai(O[Oi]&&O[Oi].prototype);Ai(hi);var Si=function(t,e,r){var n=Rt(e);n in t?Ft.f(t,n,Kt(0,r)):t[n]=r},Ti=ut("species"),ki=function(t){return tt>=51||!j((function(){var e=[];return(e.constructor={})[Ti]=function(){return{foo:1}},1!==e[t](Boolean).foo}))},Ii=ki("slice"),ji=ut("species"),Pi=Array,_i=Math.max;or({target:"Array",proto:!0,forced:!Ii},{slice:function(t,e){var r,n,o,i=Se(this),a=De(i),u=Re(t,a),s=Re(void 0===e?a:e,a);if(pi(i)&&(r=i.constructor,(Ir(r)&&(r===Pi||pi(r.prototype))||lt(r)&&null===(r=r[ji]))&&(r=void 0),r===Pi||void 0===r))return zr(i,u,s);for(n=new(void 0===r?Pi:r)(_i(s-u,0)),o=0;u<s;u++,o++)u in i&&Si(n,o,i[u]);return n.length=o,n}});var Mi=Ut.EXISTS,Li=Ft.f,Ri=Function.prototype,Ci=C(Ri.toString),Ni=/function\\b(?:\\s|\\/\\*[\\S\\s]*?\\*\\/|\\/\\/[^\\n\\r]*[\\n\\r]+)*([^\\s(/]*)/,Di=C(Ni.exec);ft&&!Mi&&Li(Ri,"name",{configurable:!0,get:function(){try{return Di(Ni,Ci(this))[1]}catch(t){return""}}});var Fi=xi.map,Wi=ki("map");or({target:"Array",proto:!0,forced:!Wi},{map:function(t){return Fi(this,t,arguments.length>1?arguments[1]:void 0)}});var zi,Bi=Object.keys||function(t){return Ue(t,Ge)},Ui={f:ft&&!yt?Object.defineProperties:function(t,e){xt(t);for(var r,n=Se(e),o=Bi(e),i=o.length,a=0;i>a;)Ft.f(t,r=o[a++],n[r]);return t}},Gi=Jt("IE_PROTO"),Vi=function(){},qi=function(t){return"<script>"+t+"<\\/script>"},Hi=function(t){t.write(qi("")),t.close();var e=t.parentWindow.Object;return t=null,e},Zi=function(){try{zi=new ActiveXObject("htmlfile")}catch(t){}var t,e;Zi="undefined"!=typeof document?document.domain&&zi?Hi(zi):((e=vt("iframe")).style.display="none",Wr.appendChild(e),e.src=String("javascript:"),(t=e.contentWindow.document).open(),t.write(qi("document.F=Object")),t.close(),t.F):Hi(zi);for(var r=Ge.length;r--;)delete Zi.prototype[Ge[r]];return Zi()};te[Gi]=!0;var Yi=Object.create||function(t,e){var r;return null!==t?(Vi.prototype=xt(t),r=new Vi,Vi.prototype=null,r[Gi]=t):r=Zi(),void 0===e?r:Ui.f(r,e)},$i=Ft.f,Ki=ut("unscopables"),Qi=Array.prototype;null==Qi[Ki]&&$i(Qi,Ki,{configurable:!0,value:Yi(null)});var Xi,Ji,ta,ea=function(t){Qi[Ki][t]=!0},ra=!j((function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype})),na=Jt("IE_PROTO"),oa=Object,ia=oa.prototype,aa=ra?oa.getPrototypeOf:function(t){var e=W(t);if(B(e,na))return e[na];var r=e.constructor;return H(r)&&e instanceof r?r.prototype:e instanceof oa?ia:null},ua=ut("iterator"),sa=!1;[].keys&&("next"in(ta=[].keys())?(Ji=aa(aa(ta)))!==Object.prototype&&(Xi=Ji):sa=!0),(null==Xi||j((function(){var t={};return Xi[ua].call(t)!==t})))&&(Xi={}),H(Xi[ua])||fe(Xi,ua,(function(){return this}));var ca={IteratorPrototype:Xi,BUGGY_SAFARI_ITERATORS:sa},fa=ca.IteratorPrototype,la=function(){return this},ha=Ut.PROPER,pa=Ut.CONFIGURABLE,va=ca.IteratorPrototype,da=ca.BUGGY_SAFARI_ITERATORS,ya=ut("iterator"),ga=function(){return this},ma=function(t,e,r,n,o,i,a){!function(t,e,r,n){var o=e+" Iterator";t.prototype=Yi(fa,{next:Kt(+!n,r)}),lr(t,o,!1),fo[o]=la}(r,e,n);var u,s,c,f=function(t){if(t===o&&d)return d;if(!da&&t in p)return p[t];switch(t){case"keys":case"values":case"entries":return function(){return new r(this,t)}}return function(){return new r(this)}},l=e+" Iterator",h=!1,p=t.prototype,v=p[ya]||p["@@iterator"]||o&&p[o],d=!da&&v||f(o),y="Array"==e&&p.entries||v;if(y&&(u=aa(y.call(new t)))!==Object.prototype&&u.next&&(aa(u)!==va&&(sr?sr(u,va):H(u[ya])||fe(u,ya,ga)),lr(u,l,!0)),ha&&"values"==o&&v&&"values"!==v.name&&(pa?Qt(p,"name","values"):(h=!0,d=function(){return wt(v,this)})),o)if(s={values:f("values"),keys:i?d:f("keys"),entries:f("entries")},a)for(c in s)(da||h||!(c in p))&&fe(p,c,s[c]);else or({target:e,proto:!0,forced:da||h},s);return p[ya]!==d&&fe(p,ya,d,{name:o}),fo[e]=d,s},xa=Ft.f,ba=se.set,wa=se.getterFor("Array Iterator"),Ea=ma(Array,"Array",(function(t,e){ba(this,{type:"Array Iterator",target:Se(t),index:0,kind:e})}),(function(){var t=wa(this),e=t.target,r=t.kind,n=t.index++;return!e||n>=e.length?(t.target=void 0,{value:void 0,done:!0}):"keys"==r?{value:n,done:!1}:"values"==r?{value:e[n],done:!1}:{value:[n,e[n]],done:!1}}),"values"),Aa=fo.Arguments=fo.Array;if(ea("keys"),ea("values"),ea("entries"),ft&&"values"!==Aa.name)try{xa(Aa,"name",{value:"values"})}catch(t){}var Oa,Sa,Ta,ka="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView,Ia=Ft.f,ja=se.enforce,Pa=se.get,_a=O.Int8Array,Ma=_a&&_a.prototype,La=O.Uint8ClampedArray,Ra=La&&La.prototype,Ca=_a&&aa(_a),Na=Ma&&aa(Ma),Da=Object.prototype,Fa=O.TypeError,Wa=ut("toStringTag"),za=q("TYPED_ARRAY_TAG"),Ba=ka&&!!sr&&"Opera"!==ge(O.opera),Ua=!1,Ga={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},Va={BigInt64Array:8,BigUint64Array:8},qa=function(t){var e=aa(t);if(lt(e)){var r=Pa(e);return r&&B(r,"TypedArrayConstructor")?r.TypedArrayConstructor:qa(e)}},Ha=function(t){if(!lt(t))return!1;var e=ge(t);return B(Ga,e)||B(Va,e)};for(Oa in Ga)(Ta=(Sa=O[Oa])&&Sa.prototype)?ja(Ta).TypedArrayConstructor=Sa:Ba=!1;for(Oa in Va)(Ta=(Sa=O[Oa])&&Sa.prototype)&&(ja(Ta).TypedArrayConstructor=Sa);if((!Ba||!H(Ca)||Ca===Function.prototype)&&(Ca=function(){throw Fa("Incorrect invocation")},Ba))for(Oa in Ga)O[Oa]&&sr(O[Oa],Ca);if((!Ba||!Na||Na===Da)&&(Na=Ca.prototype,Ba))for(Oa in Ga)O[Oa]&&sr(O[Oa].prototype,Na);if(Ba&&aa(Ra)!==Na&&sr(Ra,Na),ft&&!B(Na,Wa))for(Oa in Ua=!0,Ia(Na,Wa,{get:function(){return lt(this)?this[za]:void 0}}),Ga)O[Oa]&&Qt(O[Oa],za,Oa);var Za={NATIVE_ARRAY_BUFFER_VIEWS:Ba,TYPED_ARRAY_TAG:Ua&&za,aTypedArray:function(t){if(Ha(t))return t;throw Fa("Target is not a typed array")},aTypedArrayConstructor:function(t){if(H(t)&&(!sr||Et(Ca,t)))return t;throw Fa(Tt(t)+" is not a typed array constructor")},exportTypedArrayMethod:function(t,e,r,n){if(ft){if(r)for(var o in Ga){var i=O[o];if(i&&B(i.prototype,t))try{delete i.prototype[t]}catch(r){try{i.prototype[t]=e}catch(t){}}}Na[t]&&!r||fe(Na,t,r?e:Ba&&Ma[t]||e,n)}},exportTypedArrayStaticMethod:function(t,e,r){var n,o;if(ft){if(sr){if(r)for(n in Ga)if((o=O[n])&&B(o,t))try{delete o[t]}catch(t){}if(Ca[t]&&!r)return;try{return fe(Ca,t,r?e:Ba&&Ca[t]||e)}catch(t){}}for(n in Ga)!(o=O[n])||o[t]&&!r||fe(o,t,e)}},getTypedArrayConstructor:qa,isView:function(t){if(!lt(t))return!1;var e=ge(t);return"DataView"===e||B(Ga,e)||B(Va,e)},isTypedArray:Ha,TypedArray:Ca,TypedArrayPrototype:Na},Ya=Za.NATIVE_ARRAY_BUFFER_VIEWS,$a=O.ArrayBuffer,Ka=O.Int8Array,Qa=!Ya||!j((function(){Ka(1)}))||!j((function(){new Ka(-1)}))||!Io((function(t){new Ka,new Ka(null),new Ka(1.5),new Ka(t)}),!0)||j((function(){return 1!==new Ka(new $a(2),1,void 0).length})),Xa=function(t,e,r){for(var n in e)fe(t,n,e[n],r);return t},Ja=RangeError,tu=function(t){if(void 0===t)return 0;var e=_e(t),r=Ne(e);if(e!==r)throw Ja("Wrong length or index");return r},eu=Array,ru=Math.abs,nu=Math.pow,ou=Math.floor,iu=Math.log,au=Math.LN2,uu=function(t,e,r){var n,o,i,a=eu(r),u=8*r-e-1,s=(1<<u)-1,c=s>>1,f=23===e?nu(2,-24)-nu(2,-77):0,l=t<0||0===t&&1/t<0?1:0,h=0;for((t=ru(t))!=t||t===1/0?(o=t!=t?1:0,n=s):(n=ou(iu(t)/au),t*(i=nu(2,-n))<1&&(n--,i*=2),(t+=n+c>=1?f/i:f*nu(2,1-c))*i>=2&&(n++,i/=2),n+c>=s?(o=0,n=s):n+c>=1?(o=(t*i-1)*nu(2,e),n+=c):(o=t*nu(2,c-1)*nu(2,e),n=0));e>=8;)a[h++]=255&o,o/=256,e-=8;for(n=n<<e|o,u+=e;u>0;)a[h++]=255&n,n/=256,u-=8;return a[--h]|=128*l,a},su=function(t,e){var r,n=t.length,o=8*n-e-1,i=(1<<o)-1,a=i>>1,u=o-7,s=n-1,c=t[s--],f=127&c;for(c>>=7;u>0;)f=256*f+t[s--],u-=8;for(r=f&(1<<-u)-1,f>>=-u,u+=e;u>0;)r=256*r+t[s--],u-=8;if(0===f)f=1-a;else{if(f===i)return r?NaN:c?-1/0:1/0;r+=nu(2,e),f-=a}return(c?-1:1)*r*nu(2,f-e)},cu=function(t){for(var e=W(this),r=De(e),n=arguments.length,o=Re(n>1?arguments[1]:void 0,r),i=n>2?arguments[2]:void 0,a=void 0===i?r:Re(i,r);a>o;)e[o++]=t;return e},fu=Array,lu=Math.max,hu=function(t,e,r){for(var n=De(t),o=Re(e,n),i=Re(void 0===r?n:r,n),a=fu(lu(i-o,0)),u=0;o<i;o++,u++)Si(a,u,t[o]);return a.length=u,a},pu=qe.f,vu=Ft.f,du=Ut.PROPER,yu=Ut.CONFIGURABLE,gu=se.get,mu=se.set,xu=O.ArrayBuffer,bu=xu,wu=bu&&bu.prototype,Eu=O.DataView,Au=Eu&&Eu.prototype,Ou=Object.prototype,Su=O.Array,Tu=O.RangeError,ku=C(cu),Iu=C([].reverse),ju=uu,Pu=su,_u=function(t){return[255&t]},Mu=function(t){return[255&t,t>>8&255]},Lu=function(t){return[255&t,t>>8&255,t>>16&255,t>>24&255]},Ru=function(t){return t[3]<<24|t[2]<<16|t[1]<<8|t[0]},Cu=function(t){return ju(t,23,4)},Nu=function(t){return ju(t,52,8)},Du=function(t,e){vu(t.prototype,e,{get:function(){return gu(this)[e]}})},Fu=function(t,e,r,n){var o=tu(r),i=gu(t);if(o+e>i.byteLength)throw Tu("Wrong index");var a=gu(i.buffer).bytes,u=o+i.byteOffset,s=hu(a,u,u+e);return n?s:Iu(s)},Wu=function(t,e,r,n,o,i){var a=tu(r),u=gu(t);if(a+e>u.byteLength)throw Tu("Wrong index");for(var s=gu(u.buffer).bytes,c=a+u.byteOffset,f=n(+o),l=0;l<e;l++)s[c+l]=f[i?l:e-l-1]};if(ka){var zu=du&&"ArrayBuffer"!==xu.name;if(j((function(){xu(1)}))&&j((function(){new xu(-1)}))&&!j((function(){return new xu,new xu(1.5),new xu(NaN),zu&&!yu})))zu&&yu&&Qt(xu,"name","ArrayBuffer");else{(bu=function(t){return dr(this,wu),new xu(tu(t))}).prototype=wu;for(var Bu,Uu=pu(xu),Gu=0;Uu.length>Gu;)(Bu=Uu[Gu++])in bu||Qt(bu,Bu,xu[Bu]);wu.constructor=bu}sr&&aa(Au)!==Ou&&sr(Au,Ou);var Vu=new Eu(new bu(2)),qu=C(Au.setInt8);Vu.setInt8(0,2147483648),Vu.setInt8(1,2147483649),!Vu.getInt8(0)&&Vu.getInt8(1)||Xa(Au,{setInt8:function(t,e){qu(this,t,e<<24>>24)},setUint8:function(t,e){qu(this,t,e<<24>>24)}},{unsafe:!0})}else wu=(bu=function(t){dr(this,wu);var e=tu(t);mu(this,{bytes:ku(Su(e),0),byteLength:e}),ft||(this.byteLength=e)}).prototype,Au=(Eu=function(t,e,r){dr(this,Au),dr(t,wu);var n=gu(t).byteLength,o=_e(e);if(o<0||o>n)throw Tu("Wrong offset");if(o+(r=void 0===r?n-o:Ne(r))>n)throw Tu("Wrong length");mu(this,{buffer:t,byteLength:r,byteOffset:o}),ft||(this.buffer=t,this.byteLength=r,this.byteOffset=o)}).prototype,ft&&(Du(bu,"byteLength"),Du(Eu,"buffer"),Du(Eu,"byteLength"),Du(Eu,"byteOffset")),Xa(Au,{getInt8:function(t){return Fu(this,1,t)[0]<<24>>24},getUint8:function(t){return Fu(this,1,t)[0]},getInt16:function(t){var e=Fu(this,2,t,arguments.length>1?arguments[1]:void 0);return(e[1]<<8|e[0])<<16>>16},getUint16:function(t){var e=Fu(this,2,t,arguments.length>1?arguments[1]:void 0);return e[1]<<8|e[0]},getInt32:function(t){return Ru(Fu(this,4,t,arguments.length>1?arguments[1]:void 0))},getUint32:function(t){return Ru(Fu(this,4,t,arguments.length>1?arguments[1]:void 0))>>>0},getFloat32:function(t){return Pu(Fu(this,4,t,arguments.length>1?arguments[1]:void 0),23)},getFloat64:function(t){return Pu(Fu(this,8,t,arguments.length>1?arguments[1]:void 0),52)},setInt8:function(t,e){Wu(this,1,t,_u,e)},setUint8:function(t,e){Wu(this,1,t,_u,e)},setInt16:function(t,e){Wu(this,2,t,Mu,e,arguments.length>2?arguments[2]:void 0)},setUint16:function(t,e){Wu(this,2,t,Mu,e,arguments.length>2?arguments[2]:void 0)},setInt32:function(t,e){Wu(this,4,t,Lu,e,arguments.length>2?arguments[2]:void 0)},setUint32:function(t,e){Wu(this,4,t,Lu,e,arguments.length>2?arguments[2]:void 0)},setFloat32:function(t,e){Wu(this,4,t,Cu,e,arguments.length>2?arguments[2]:void 0)},setFloat64:function(t,e){Wu(this,8,t,Nu,e,arguments.length>2?arguments[2]:void 0)}});lr(bu,"ArrayBuffer"),lr(Eu,"DataView");var Hu={ArrayBuffer:bu,DataView:Eu},Zu=Math.floor,Yu=Number.isInteger||function(t){return!lt(t)&&isFinite(t)&&Zu(t)===t},$u=RangeError,Ku=RangeError,Qu=function(t,e){var r=function(t){var e=_e(t);if(e<0)throw $u("The argument can't be less than 0");return e}(t);if(r%e)throw Ku("Wrong offset");return r},Xu=Za.aTypedArrayConstructor,Ju=function(t){var e,r,n,o,i,a,u=Pr(this),s=W(t),c=arguments.length,f=c>1?arguments[1]:void 0,l=void 0!==f,h=yo(s);if(h&&!po(h))for(a=(i=mo(s,h)).next,s=[];!(o=wt(a,i)).done;)s.push(o.value);for(l&&c>2&&(f=Fr(f,arguments[2])),r=De(s),n=new(Xu(u))(r),e=0;r>e;e++)n[e]=l?f(s[e],e):s[e];return n},ts=function(t,e,r){var n,o;return sr&&H(n=e.constructor)&&n!==r&&lt(o=n.prototype)&&o!==r.prototype&&sr(t,o),t},es=b((function(t){var e=qe.f,r=xi.forEach,n=se.get,o=se.set,i=se.enforce,a=Ft.f,u=ke.f,s=Math.round,c=O.RangeError,f=Hu.ArrayBuffer,l=f.prototype,h=Hu.DataView,p=Za.NATIVE_ARRAY_BUFFER_VIEWS,v=Za.TYPED_ARRAY_TAG,d=Za.TypedArray,y=Za.TypedArrayPrototype,g=Za.aTypedArrayConstructor,m=Za.isTypedArray,x=function(t,e){g(t);for(var r=0,n=e.length,o=new t(n);n>r;)o[r]=e[r++];return o},b=function(t,e){a(t,e,{get:function(){return n(this)[e]}})},w=function(t){var e;return Et(l,t)||"ArrayBuffer"==(e=ge(t))||"SharedArrayBuffer"==e},E=function(t,e){return m(t)&&!Ot(e)&&e in t&&Yu(+e)&&e>=0},A=function(t,e){return e=Rt(e),E(t,e)?Kt(2,t[e]):u(t,e)},S=function(t,e,r){return e=Rt(e),!(E(t,e)&&lt(r)&&B(r,"value"))||B(r,"get")||B(r,"set")||r.configurable||B(r,"writable")&&!r.writable||B(r,"enumerable")&&!r.enumerable?a(t,e,r):(t[e]=r.value,t)};ft?(p||(ke.f=A,Ft.f=S,b(y,"buffer"),b(y,"byteOffset"),b(y,"byteLength"),b(y,"length")),or({target:"Object",stat:!0,forced:!p},{getOwnPropertyDescriptor:A,defineProperty:S}),t.exports=function(t,u,l){var g=t.match(/\\d+$/)[0]/8,b=t+(l?"Clamped":"")+"Array",E="get"+t,A="set"+t,S=O[b],T=S,k=T&&T.prototype,I={},j=function(t,e){a(t,e,{get:function(){return function(t,e){var r=n(t);return r.view[E](e*g+r.byteOffset,!0)}(this,e)},set:function(t){return function(t,e,r){var o=n(t);l&&(r=(r=s(r))<0?0:r>255?255:255&r),o.view[A](e*g+o.byteOffset,r,!0)}(this,e,t)},enumerable:!0})};p?Qa&&(T=u((function(t,e,r,n){return dr(t,k),ts(lt(e)?w(e)?void 0!==n?new S(e,Qu(r,g),n):void 0!==r?new S(e,Qu(r,g)):new S(e):m(e)?x(T,e):wt(Ju,T,e):new S(tu(e)),t,T)})),sr&&sr(T,d),r(e(S),(function(t){t in T||Qt(T,t,S[t])})),T.prototype=k):(T=u((function(t,e,r,n){dr(t,k);var i,a,u,s=0,l=0;if(lt(e)){if(!w(e))return m(e)?x(T,e):wt(Ju,T,e);i=e,l=Qu(r,g);var p=e.byteLength;if(void 0===n){if(p%g)throw c("Wrong length");if((a=p-l)<0)throw c("Wrong length")}else if((a=Ne(n)*g)+l>p)throw c("Wrong length");u=a/g}else u=tu(e),i=new f(a=u*g);for(o(t,{buffer:i,byteOffset:l,byteLength:a,length:u,view:new h(i)});s<u;)j(t,s++)})),sr&&sr(T,d),k=T.prototype=Yi(y)),k.constructor!==T&&Qt(k,"constructor",T),i(k).TypedArrayConstructor=T,v&&Qt(k,v,b);var P=T!=S;I[b]=T,or({global:!0,constructor:!0,forced:P,sham:!p},I),"BYTES_PER_ELEMENT"in T||Qt(T,"BYTES_PER_ELEMENT",g),"BYTES_PER_ELEMENT"in k||Qt(k,"BYTES_PER_ELEMENT",g),pr(b)}):t.exports=function(){}}));es("Uint8",(function(t){return function(e,r,n){return t(this,e,r,n)}}),!0);var rs=TypeError,ns=function(t,e){if(!delete t[e])throw rs("Cannot delete property "+Tt(e)+" of "+Tt(t))},os=Math.min,is=C([].copyWithin||function(t,e){var r=W(this),n=De(r),o=Re(t,n),i=Re(e,n),a=arguments.length>2?arguments[2]:void 0,u=os((void 0===a?n:Re(a,n))-i,n-o),s=1;for(i<o&&o<i+u&&(s=-1,i+=u-1,o+=u-1);u-- >0;)i in r?r[o]=r[i]:ns(r,o),o+=s,i+=s;return r}),as=Za.aTypedArray;(0,Za.exportTypedArrayMethod)("copyWithin",(function(t,e){return is(as(this),t,e,arguments.length>2?arguments[2]:void 0)}));var us=xi.every,ss=Za.aTypedArray;(0,Za.exportTypedArrayMethod)("every",(function(t){return us(ss(this),t,arguments.length>1?arguments[1]:void 0)}));var cs=TypeError,fs=function(t){var e=Lt(t,"number");if("number"==typeof e)throw cs("Can't convert number to bigint");return BigInt(e)},ls=Za.aTypedArray,hs=Za.exportTypedArrayMethod,ps=C("".slice);hs("fill",(function(t){var e=arguments.length;ls(this);var r="Big"===ps(ge(this),0,3)?fs(t):+t;return wt(cu,this,r,e>1?arguments[1]:void 0,e>2?arguments[2]:void 0)}),j((function(){var t=0;return new Int8Array(2).fill({valueOf:function(){return t++}}),1!==t})));var vs=Za.aTypedArrayConstructor,ds=Za.getTypedArrayConstructor,ys=function(t){return vs(Mr(t,ds(t)))},gs=function(t,e){return function(t,e){for(var r=0,n=De(e),o=new t(n);n>r;)o[r]=e[r++];return o}(ys(t),e)},ms=xi.filter,xs=Za.aTypedArray;(0,Za.exportTypedArrayMethod)("filter",(function(t){var e=ms(xs(this),t,arguments.length>1?arguments[1]:void 0);return gs(this,e)}));var bs=xi.find,ws=Za.aTypedArray;(0,Za.exportTypedArrayMethod)("find",(function(t){return bs(ws(this),t,arguments.length>1?arguments[1]:void 0)}));var Es=xi.findIndex,As=Za.aTypedArray;(0,Za.exportTypedArrayMethod)("findIndex",(function(t){return Es(As(this),t,arguments.length>1?arguments[1]:void 0)}));var Os=xi.forEach,Ss=Za.aTypedArray;(0,Za.exportTypedArrayMethod)("forEach",(function(t){Os(Ss(this),t,arguments.length>1?arguments[1]:void 0)}));var Ts=We.includes,ks=Za.aTypedArray;(0,Za.exportTypedArrayMethod)("includes",(function(t){return Ts(ks(this),t,arguments.length>1?arguments[1]:void 0)}));var Is=We.indexOf,js=Za.aTypedArray;(0,Za.exportTypedArrayMethod)("indexOf",(function(t){return Is(js(this),t,arguments.length>1?arguments[1]:void 0)}));var Ps=ut("iterator"),_s=O.Uint8Array,Ms=C(Ea.values),Ls=C(Ea.keys),Rs=C(Ea.entries),Cs=Za.aTypedArray,Ns=Za.exportTypedArrayMethod,Ds=_s&&_s.prototype,Fs=!j((function(){Ds[Ps].call([1])})),Ws=!!Ds&&Ds.values&&Ds[Ps]===Ds.values&&"values"===Ds.values.name,zs=function(){return Ms(Cs(this))};Ns("entries",(function(){return Rs(Cs(this))}),Fs),Ns("keys",(function(){return Ls(Cs(this))}),Fs),Ns("values",zs,Fs||!Ws,{name:"values"}),Ns(Ps,zs,Fs||!Ws,{name:"values"});var Bs=Za.aTypedArray,Us=Za.exportTypedArrayMethod,Gs=C([].join);Us("join",(function(t){return Gs(Bs(this),t)}));var Vs=Math.min,qs=[].lastIndexOf,Hs=!!qs&&1/[1].lastIndexOf(1,-0)<0,Zs=bi("lastIndexOf"),Ys=Hs||!Zs?function(t){if(Hs)return Nr(qs,this,arguments)||0;var e=Se(this),r=De(e),n=r-1;for(arguments.length>1&&(n=Vs(n,_e(arguments[1]))),n<0&&(n=r+n);n>=0;n--)if(n in e&&e[n]===t)return n||0;return-1}:qs,$s=Za.aTypedArray;(0,Za.exportTypedArrayMethod)("lastIndexOf",(function(t){var e=arguments.length;return Nr(Ys,$s(this),e>1?[t,arguments[1]]:[t])}));var Ks=xi.map,Qs=Za.aTypedArray;(0,Za.exportTypedArrayMethod)("map",(function(t){return Ks(Qs(this),t,arguments.length>1?arguments[1]:void 0,(function(t,e){return new(ys(t))(e)}))}));var Xs=TypeError,Js=function(t){return function(e,r,n,o){It(r);var i=W(e),a=Oe(i),u=De(i),s=t?u-1:0,c=t?-1:1;if(n<2)for(;;){if(s in a){o=a[s],s+=c;break}if(s+=c,t?s<0:u<=s)throw Xs("Reduce of empty array with no initial value")}for(;t?s>=0:u>s;s+=c)s in a&&(o=r(o,a[s],s,i));return o}},tc={left:Js(!1),right:Js(!0)},ec=tc.left,rc=Za.aTypedArray;(0,Za.exportTypedArrayMethod)("reduce",(function(t){var e=arguments.length;return ec(rc(this),t,e,e>1?arguments[1]:void 0)}));var nc=tc.right,oc=Za.aTypedArray;(0,Za.exportTypedArrayMethod)("reduceRight",(function(t){var e=arguments.length;return nc(oc(this),t,e,e>1?arguments[1]:void 0)}));var ic=Za.aTypedArray,ac=Za.exportTypedArrayMethod,uc=Math.floor;ac("reverse",(function(){for(var t,e=ic(this).length,r=uc(e/2),n=0;n<r;)t=this[n],this[n++]=this[--e],this[e]=t;return this}));var sc=O.RangeError,cc=O.Int8Array,fc=cc&&cc.prototype,lc=fc&&fc.set,hc=Za.aTypedArray,pc=Za.exportTypedArrayMethod,vc=!j((function(){var t=new Uint8ClampedArray(2);return wt(lc,t,{length:1,0:3},1),3!==t[1]})),dc=vc&&Za.NATIVE_ARRAY_BUFFER_VIEWS&&j((function(){var t=new cc(2);return t.set(1),t.set("2",1),0!==t[0]||2!==t[1]}));pc("set",(function(t){hc(this);var e=Qu(arguments.length>1?arguments[1]:void 0,1),r=W(t);if(vc)return wt(lc,this,r,e);var n=this.length,o=De(r),i=0;if(o+e>n)throw sc("Wrong length");for(;i<o;)this[e+i]=r[i++]}),!vc||dc);var yc=Za.aTypedArray;(0,Za.exportTypedArrayMethod)("slice",(function(t,e){for(var r=zr(yc(this),t,e),n=ys(this),o=0,i=r.length,a=new n(i);i>o;)a[o]=r[o++];return a}),j((function(){new Int8Array(1).slice()})));var gc=xi.some,mc=Za.aTypedArray;(0,Za.exportTypedArrayMethod)("some",(function(t){return gc(mc(this),t,arguments.length>1?arguments[1]:void 0)}));var xc=Math.floor,bc=function(t,e){var r=t.length,n=xc(r/2);return r<8?wc(t,e):Ec(t,bc(hu(t,0,n),e),bc(hu(t,n),e),e)},wc=function(t,e){for(var r,n,o=t.length,i=1;i<o;){for(n=i,r=t[i];n&&e(t[n-1],r)>0;)t[n]=t[--n];n!==i++&&(t[n]=r)}return t},Ec=function(t,e,r,n){for(var o=e.length,i=r.length,a=0,u=0;a<o||u<i;)t[a+u]=a<o&&u<i?n(e[a],r[u])<=0?e[a++]:r[u++]:a<o?e[a++]:r[u++];return t},Ac=bc,Oc=$.match(/firefox\\/(\\d+)/i),Sc=!!Oc&&+Oc[1],Tc=/MSIE|Trident/.test($),kc=$.match(/AppleWebKit\\/(\\d+)\\./),Ic=!!kc&&+kc[1],jc=Za.aTypedArray,Pc=Za.exportTypedArrayMethod,_c=O.Uint16Array,Mc=_c&&C(_c.prototype.sort),Lc=!(!Mc||j((function(){Mc(new _c(2),null)}))&&j((function(){Mc(new _c(2),{})}))),Rc=!!Mc&&!j((function(){if(tt)return tt<74;if(Sc)return Sc<67;if(Tc)return!0;if(Ic)return Ic<602;var t,e,r=new _c(516),n=Array(516);for(t=0;t<516;t++)e=t%4,r[t]=515-t,n[t]=t-2*e+3;for(Mc(r,(function(t,e){return(t/4|0)-(e/4|0)})),t=0;t<516;t++)if(r[t]!==n[t])return!0}));Pc("sort",(function(t){return void 0!==t&&It(t),Rc?Mc(this,t):Ac(jc(this),function(t){return function(e,r){return void 0!==t?+t(e,r)||0:r!=r?-1:e!=e?1:0===e&&0===r?1/e>0&&1/r<0?1:-1:e>r}}(t))}),!Rc||Lc);var Cc=Za.aTypedArray;(0,Za.exportTypedArrayMethod)("subarray",(function(t,e){var r=Cc(this),n=r.length,o=Re(t,n);return new(ys(r))(r.buffer,r.byteOffset+o*r.BYTES_PER_ELEMENT,Ne((void 0===e?n:Re(e,n))-o))}));var Nc=O.Int8Array,Dc=Za.aTypedArray,Fc=Za.exportTypedArrayMethod,Wc=[].toLocaleString,zc=!!Nc&&j((function(){Wc.call(new Nc(1))}));Fc("toLocaleString",(function(){return Nr(Wc,zc?zr(Dc(this)):Dc(this),zr(arguments))}),j((function(){return[1,2].toLocaleString()!=new Nc([1,2]).toLocaleString()}))||!j((function(){Nc.prototype.toLocaleString.call([1,2])})));var Bc=Za.exportTypedArrayMethod,Uc=O.Uint8Array,Gc=Uc&&Uc.prototype||{},Vc=[].toString,qc=C([].join);j((function(){Vc.call({})}))&&(Vc=function(){return qc(this)});var Hc=Gc.toString!=Vc;Bc("toString",Vc,Hc);var Zc,Yc,$c=String,Kc=function(t){if("Symbol"===ge(t))throw TypeError("Cannot convert a Symbol value to a string");return $c(t)},Qc=function(){var t=xt(this),e="";return t.hasIndices&&(e+="d"),t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),t.dotAll&&(e+="s"),t.unicode&&(e+="u"),t.unicodeSets&&(e+="v"),t.sticky&&(e+="y"),e},Xc=O.RegExp,Jc=j((function(){var t=Xc("a","y");return t.lastIndex=2,null!=t.exec("abcd")})),tf=Jc||j((function(){return!Xc("a","y").sticky})),ef={BROKEN_CARET:Jc||j((function(){var t=Xc("^r","gy");return t.lastIndex=2,null!=t.exec("str")})),MISSED_STICKY:tf,UNSUPPORTED_Y:Jc},rf=O.RegExp,nf=j((function(){var t=rf(".","s");return!(t.dotAll&&t.exec("\\n")&&"s"===t.flags)})),of=O.RegExp,af=j((function(){var t=of("(?<a>b)","g");return"b"!==t.exec("b").groups.a||"bc"!=="b".replace(t,"$<a>c")})),uf=se.get,sf=I("native-string-replace",String.prototype.replace),cf=RegExp.prototype.exec,ff=cf,lf=C("".charAt),hf=C("".indexOf),pf=C("".replace),vf=C("".slice),df=(Yc=/b*/g,wt(cf,Zc=/a/,"a"),wt(cf,Yc,"a"),0!==Zc.lastIndex||0!==Yc.lastIndex),yf=ef.BROKEN_CARET,gf=void 0!==/()??/.exec("")[1];(df||gf||yf||nf||af)&&(ff=function(t){var e,r,n,o,i,a,u,s=this,c=uf(s),f=Kc(t),l=c.raw;if(l)return l.lastIndex=s.lastIndex,e=wt(ff,l,f),s.lastIndex=l.lastIndex,e;var h=c.groups,p=yf&&s.sticky,v=wt(Qc,s),d=s.source,y=0,g=f;if(p&&(v=pf(v,"y",""),-1===hf(v,"g")&&(v+="g"),g=vf(f,s.lastIndex),s.lastIndex>0&&(!s.multiline||s.multiline&&"\\n"!==lf(f,s.lastIndex-1))&&(d="(?: "+d+")",g=" "+g,y++),r=new RegExp("^(?:"+d+")",v)),gf&&(r=new RegExp("^"+d+"$(?!\\\\s)",v)),df&&(n=s.lastIndex),o=wt(cf,p?r:s,g),p?o?(o.input=vf(o.input,y),o[0]=vf(o[0],y),o.index=s.lastIndex,s.lastIndex+=o[0].length):s.lastIndex=0:df&&o&&(s.lastIndex=s.global?o.index+o[0].length:n),gf&&o&&o.length>1&&wt(sf,o[0],r,(function(){for(i=1;i<arguments.length-2;i++)void 0===arguments[i]&&(o[i]=void 0)})),o&&h)for(o.groups=a=Yi(null),i=0;i<h.length;i++)a[(u=h[i])[0]]=o[u[1]];return o});var mf=ff;or({target:"RegExp",proto:!0,forced:/./.exec!==mf},{exec:mf});var xf,bf=ut("species"),wf=RegExp.prototype,Ef=function(t,e,r,n){var o=ut(t),i=!j((function(){var e={};return e[o]=function(){return 7},7!=""[t](e)})),a=i&&!j((function(){var e=!1,r=/a/;return"split"===t&&((r={}).constructor={},r.constructor[bf]=function(){return r},r.flags="",r[o]=/./[o]),r.exec=function(){return e=!0,null},r[o](""),!e}));if(!i||!a||r){var u=C(/./[o]),s=e(o,""[t],(function(t,e,r,n,o){var a=C(t),s=e.exec;return s===mf||s===wf.exec?i&&!o?{done:!0,value:u(e,r,n)}:{done:!0,value:a(r,e,n)}:{done:!1}}));fe(String.prototype,t,s[0]),fe(wf,o,s[1])}n&&Qt(wf[o],"sham",!0)},Af=C("".charAt),Of=C("".charCodeAt),Sf=C("".slice),Tf=function(t){return function(e,r){var n,o,i=Kc(D(e)),a=_e(r),u=i.length;return a<0||a>=u?t?"":void 0:(n=Of(i,a))<55296||n>56319||a+1===u||(o=Of(i,a+1))<56320||o>57343?t?Af(i,a):n:t?Sf(i,a,a+2):o-56320+(n-55296<<10)+65536}},kf={codeAt:Tf(!1),charAt:Tf(!0)},If=kf.charAt,jf=function(t,e,r){return e+(r?If(t,e).length:1)},Pf=Math.floor,_f=C("".charAt),Mf=C("".replace),Lf=C("".slice),Rf=/\\$([$&'\`]|\\d{1,2}|<[^>]*>)/g,Cf=/\\$([$&'\`]|\\d{1,2})/g,Nf=function(t,e,r,n,o,i){var a=r+t.length,u=n.length,s=Cf;return void 0!==o&&(o=W(o),s=Rf),Mf(i,s,(function(i,s){var c;switch(_f(s,0)){case"$":return"$";case"&":return t;case"\`":return Lf(e,0,r);case"'":return Lf(e,a);case"<":c=o[Lf(s,1,-1)];break;default:var f=+s;if(0===f)return i;if(f>u){var l=Pf(f/10);return 0===l?i:l<=u?void 0===n[l-1]?_f(s,1):n[l-1]+_f(s,1):i}c=n[f-1]}return void 0===c?"":c}))},Df=TypeError,Ff=function(t,e){var r=t.exec;if(H(r)){var n=wt(r,t,e);return null!==n&&xt(n),n}if("RegExp"===pe(t))return wt(mf,t,e);throw Df("RegExp#exec called on incompatible receiver")},Wf=ut("replace"),zf=Math.max,Bf=Math.min,Uf=C([].concat),Gf=C([].push),Vf=C("".indexOf),qf=C("".slice),Hf="$0"==="a".replace(/./,"$0"),Zf=!!/./[Wf]&&""===/./[Wf]("a","$0");function Yf(t){this.message=t}Ef("replace",(function(t,e,r){var n=Zf?"$":"$0";return[function(t,r){var n=D(this),o=null==t?void 0:jt(t,Wf);return o?wt(o,t,n,r):wt(e,Kc(n),t,r)},function(t,o){var i=xt(this),a=Kc(t);if("string"==typeof o&&-1===Vf(o,n)&&-1===Vf(o,"$<")){var u=r(e,i,a,o);if(u.done)return u.value}var s=H(o);s||(o=Kc(o));var c=i.global;if(c){var f=i.unicode;i.lastIndex=0}for(var l=[];;){var h=Ff(i,a);if(null===h)break;if(Gf(l,h),!c)break;""===Kc(h[0])&&(i.lastIndex=jf(a,Ne(i.lastIndex),f))}for(var p,v="",d=0,y=0;y<l.length;y++){for(var g=Kc((h=l[y])[0]),m=zf(Bf(_e(h.index),a.length),0),x=[],b=1;b<h.length;b++)Gf(x,void 0===(p=h[b])?p:String(p));var w=h.groups;if(s){var E=Uf([g],x,m,a);void 0!==w&&Gf(E,w);var A=Kc(Nr(o,void 0,E))}else A=Nf(g,a,m,x,w,o);m>=d&&(v+=qf(a,d,m)+A,d=m+g.length)}return v+qf(a,d)}]}),!!j((function(){var t=/./;return t.exec=function(){var t=[];return t.groups={a:"7"},t},"7"!=="".replace(t,"$<a>")}))||!Hf||Zf),Yf.prototype=new Error,Yf.prototype.name="InvalidCharacterError",or({global:!0},{globalThis:O}),xf="undefined"==typeof window?{devicePixelRatio:1,navigator:{userAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.69 Safari/537.36",browserLanguage:"zh-CN",language:"zh-CN",platform:""},location:"",document:{documentElement:{style:{}},createEvent:function(){return!0},getElementById:function(t){return!0},createElement:function(){return{className:"",classList:{add:function(){return""}}}},createElementNS:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},querySelector:function(){return!1}},performance:{mark:function(t){return null},clearMeasures:function(t){return null},clearMarks:function(t){return null},measure:function(t,e,r){return{duration:0}},now:function(){return(new Date).getTime()}},Blob:"",dispatchEvent:function(t){return!0},Event:function(t,e){return!0},createElement:function(){return!0},createElementNS:function(){return!0},XMLHttpRequest:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},requestAnimationFrame:function(){return!0},cancelAnimationFrame:function(){return!0},clearTimeout:function(){return!0}}:window,"undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM?my.getSystemInfoSync().pixelRatio:xf.devicePixelRatio;var $f=TypeError,Kf=function(t){if(t>9007199254740991)throw $f("Maximum allowed index exceeded");return t},Qf=ki("splice"),Xf=Math.max,Jf=Math.min;or({target:"Array",proto:!0,forced:!Qf},{splice:function(t,e){var r,n,o,i,a,u,s=W(this),c=De(s),f=Re(t,c),l=arguments.length;for(0===l?r=n=0:1===l?(r=0,n=c-f):(r=l-2,n=Jf(Xf(_e(e),0),c-f)),Kf(c+r-n),o=yi(s,n),i=0;i<n;i++)(a=f+i)in s&&Si(o,i,s[a]);if(o.length=n,r<n){for(i=f;i<c-n;i++)u=i+r,(a=i+n)in s?s[u]=s[a]:ns(s,u);for(i=c;i>c-n+r;i--)ns(s,i-1)}else if(r>n)for(i=c-n;i>f;i--)u=i+r-1,(a=i+n-1)in s?s[u]=s[a]:ns(s,u);for(i=0;i<r;i++)s[i+f]=arguments[i+2];return s.length=c-n+r,o}});var tl=u((function t(e,r){i(this,t),s(this,"cancelBubble",void 0),s(this,"cancelable",void 0),s(this,"target",void 0),s(this,"currentTarget",void 0),s(this,"preventDefault",void 0),s(this,"stopPropagation",void 0),s(this,"type",void 0),s(this,"timeStamp",void 0),this.cancelBubble=!1,this.cancelable=!1,this.target=null,this.currentTarget=null,this.preventDefault=function(){},this.stopPropagation=function(){},this.type=e,this.timeStamp=Date.now()})),el=Object.assign,rl=Object.defineProperty,nl=C([].concat),ol=!el||j((function(){if(ft&&1!==el({b:1},el(rl({},"a",{enumerable:!0,get:function(){rl(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var t={},e={},r=Symbol();return t[r]=7,"abcdefghijklmnopqrst".split("").forEach((function(t){e[t]=t})),7!=el({},t)[r]||"abcdefghijklmnopqrst"!=Bi(el({},e)).join("")}))?function(t,e){for(var r=W(t),n=arguments.length,o=1,i=He.f,a=we.f;n>o;)for(var u,s=Oe(arguments[o++]),c=i?nl(Bi(s),i(s)):Bi(s),f=c.length,l=0;f>l;)u=c[l++],ft&&!wt(a,s,u)||(r[u]=s[u]);return r}:el;or({target:"Object",stat:!0,arity:2,forced:Object.assign!==ol},{assign:ol});var il=xi.findIndex,al=!0;"findIndex"in[]&&Array(1).findIndex((function(){al=!1})),or({target:"Array",proto:!0,forced:al},{findIndex:function(t){return il(this,t,arguments.length>1?arguments[1]:void 0)}}),ea("findIndex");var ul=kf.charAt,sl=se.set,cl=se.getterFor("String Iterator");ma(String,"String",(function(t){sl(this,{type:"String Iterator",string:Kc(t),index:0})}),(function(){var t,e=cl(this),r=e.string,n=e.index;return n>=r.length?{value:void 0,done:!0}:(t=ul(r,n),e.index+=t.length,{value:t,done:!1})}));var fl=qe.f,ll="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],hl={f:function(t){return ll&&"Window"==pe(t)?function(t){try{return fl(t)}catch(t){return hu(ll)}}(t):fl(Se(t))}},pl=j((function(){if("function"==typeof ArrayBuffer){var t=new ArrayBuffer(8);Object.isExtensible(t)&&Object.defineProperty(t,"a",{value:8})}})),vl=Object.isExtensible,dl=j((function(){vl(1)}))||pl?function(t){return!!lt(t)&&((!pl||"ArrayBuffer"!=pe(t))&&(!vl||vl(t)))}:vl,yl=!j((function(){return Object.isExtensible(Object.preventExtensions({}))})),gl=b((function(t){var e=Ft.f,r=!1,n=q("meta"),o=0,i=function(t){e(t,n,{value:{objectID:"O"+o++,weakData:{}}})},a=t.exports={enable:function(){a.enable=function(){},r=!0;var t=qe.f,e=C([].splice),o={};o[n]=1,t(o).length&&(qe.f=function(r){for(var o=t(r),i=0,a=o.length;i<a;i++)if(o[i]===n){e(o,i,1);break}return o},or({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:hl.f}))},fastKey:function(t,e){if(!lt(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!B(t,n)){if(!dl(t))return"F";if(!e)return"E";i(t)}return t[n].objectID},getWeakData:function(t,e){if(!B(t,n)){if(!dl(t))return!0;if(!e)return!1;i(t)}return t[n].weakData},onFreeze:function(t){return yl&&r&&dl(t)&&!B(t,n)&&i(t),t}};te[n]=!0})),ml=(gl.enable,gl.fastKey,gl.getWeakData,gl.onFreeze,function(t,e,r){var n=-1!==t.indexOf("Map"),o=-1!==t.indexOf("Weak"),i=n?"set":"add",a=O[t],u=a&&a.prototype,s=a,c={},f=function(t){var e=C(u[t]);fe(u,t,"add"==t?function(t){return e(this,0===t?0:t),this}:"delete"==t?function(t){return!(o&&!lt(t))&&e(this,0===t?0:t)}:"get"==t?function(t){return o&&!lt(t)?void 0:e(this,0===t?0:t)}:"has"==t?function(t){return!(o&&!lt(t))&&e(this,0===t?0:t)}:function(t,r){return e(this,0===t?0:t,r),this})};if(rr(t,!H(a)||!(o||u.forEach&&!j((function(){(new a).entries().next()})))))s=r.getConstructor(e,t,n,i),gl.enable();else if(rr(t,!0)){var l=new s,h=l[i](o?{}:-0,1)!=l,p=j((function(){l.has(1)})),v=Io((function(t){new a(t)})),d=!o&&j((function(){for(var t=new a,e=5;e--;)t[i](e,e);return!t.has(-0)}));v||((s=e((function(t,e){dr(t,u);var r=ts(new a,t,s);return null!=e&&Ao(e,r[i],{that:r,AS_ENTRIES:n}),r}))).prototype=u,u.constructor=s),(p||d)&&(f("delete"),f("has"),n&&f("get")),(d||h)&&f(i),o&&u.clear&&delete u.clear}return c[t]=s,or({global:!0,constructor:!0,forced:s!=a},c),lr(s,t),o||r.setStrong(s,t,n),s}),xl=gl.getWeakData,bl=se.set,wl=se.getterFor,El=xi.find,Al=xi.findIndex,Ol=C([].splice),Sl=0,Tl=function(t){return t.frozen||(t.frozen=new kl)},kl=function(){this.entries=[]},Il=function(t,e){return El(t.entries,(function(t){return t[0]===e}))};kl.prototype={get:function(t){var e=Il(this,t);if(e)return e[1]},has:function(t){return!!Il(this,t)},set:function(t,e){var r=Il(this,t);r?r[1]=e:this.entries.push([t,e])},delete:function(t){var e=Al(this.entries,(function(e){return e[0]===t}));return~e&&Ol(this.entries,e,1),!!~e}};var jl,Pl={getConstructor:function(t,e,r,n){var o=t((function(t,o){dr(t,i),bl(t,{type:e,id:Sl++,frozen:void 0}),null!=o&&Ao(o,t[n],{that:t,AS_ENTRIES:r})})),i=o.prototype,a=wl(e),u=function(t,e,r){var n=a(t),o=xl(xt(e),!0);return!0===o?Tl(n).set(e,r):o[n.id]=r,t};return Xa(i,{delete:function(t){var e=a(this);if(!lt(t))return!1;var r=xl(t);return!0===r?Tl(e).delete(t):r&&B(r,e.id)&&delete r[e.id]},has:function(t){var e=a(this);if(!lt(t))return!1;var r=xl(t);return!0===r?Tl(e).has(t):r&&B(r,e.id)}}),Xa(i,r?{get:function(t){var e=a(this);if(lt(t)){var r=xl(t);return!0===r?Tl(e).get(t):r?r[e.id]:void 0}},set:function(t,e){return u(this,t,e)}}:{add:function(t){return u(this,t,!0)}}),o}},_l=se.enforce,Ml=!O.ActiveXObject&&"ActiveXObject"in O,Ll=function(t){return function(){return t(this,arguments.length?arguments[0]:void 0)}},Rl=ml("WeakMap",Ll,Pl);if($t&&Ml){jl=Pl.getConstructor(Ll,"WeakMap",!0),gl.enable();var Cl=Rl.prototype,Nl=C(Cl.delete),Dl=C(Cl.has),Fl=C(Cl.get),Wl=C(Cl.set);Xa(Cl,{delete:function(t){if(lt(t)&&!dl(t)){var e=_l(this);return e.frozen||(e.frozen=new jl),Nl(this,t)||e.frozen.delete(t)}return Nl(this,t)},has:function(t){if(lt(t)&&!dl(t)){var e=_l(this);return e.frozen||(e.frozen=new jl),Dl(this,t)||e.frozen.has(t)}return Dl(this,t)},get:function(t){if(lt(t)&&!dl(t)){var e=_l(this);return e.frozen||(e.frozen=new jl),Dl(this,t)?Fl(this,t):e.frozen.get(t)}return Fl(this,t)},set:function(t,e){if(lt(t)&&!dl(t)){var r=_l(this);r.frozen||(r.frozen=new jl),Dl(this,t)?Wl(this,t,e):r.frozen.set(t,e)}else Wl(this,t,e);return this}})}var zl=ut("iterator"),Bl=ut("toStringTag"),Ul=Ea.values,Gl=function(t,e){if(t){if(t[zl]!==Ul)try{Qt(t,zl,Ul)}catch(e){t[zl]=Ul}if(t[Bl]||Qt(t,Bl,e),ci[e])for(var r in Ea)if(t[r]!==Ea[r])try{Qt(t,r,Ea[r])}catch(e){t[r]=Ea[r]}}};for(var Vl in ci)Gl(O[Vl]&&O[Vl].prototype,Vl);Gl(hi,"DOMTokenList");var ql,Hl,Zl,Yl,$l=new WeakMap,Kl=function(){function t(){i(this,t),$l.set(this,{})}return u(t,[{key:"addEventListener",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=$l.get(this);n||(n={}),n[t]||(n[t]=[]),n[t].push(e),$l.set(this,n),r.capture,r.once,r.passive}},{key:"removeEventListener",value:function(t,e){var r=$l.get(this);if(r){var n=r[t];if(n&&n.length>0)for(var o=n.length;o--;o>0)if(n[o]===e){n.splice(o,1);break}}}},{key:"dispatchEvent",value:function(t){var e=$l.get(this)[t.type];if(e){var r,n=function(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=g(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,u=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return a=t.done,t},e:function(t){u=!0,i=t},f:function(){try{a||null==r.return||r.return()}finally{if(u)throw i}}}}(e);try{for(n.s();!(r=n.n()).done;){(0,r.value)(t)}}catch(t){n.e(t)}finally{n.f()}}}}]),t}(),Ql=function(t){c(r,t);var e=v(r);function r(){var t;return i(this,r),s(h(t=e.call(this)),"className",void 0),s(h(t),"children",void 0),t.className="",t.children=[],t}return u(r,[{key:"setAttribute",value:function(t,e){this[t]=e}},{key:"getAttribute",value:function(t){return this[t]}},{key:"setAttributeNS",value:function(t,e){this[t]=e}},{key:"getAttributeNS",value:function(t){return this[t]}}]),r}(function(t){c(r,t);var e=v(r);function r(){var t;return i(this,r),s(h(t=e.call(this)),"childNodes",void 0),t.childNodes=[],t}return u(r,[{key:"appendChild",value:function(t){this.childNodes.push(t)}},{key:"cloneNode",value:function(){var t=Object.create(this);return Object.assign(t,this),t}},{key:"removeChild",value:function(t){var e=this.childNodes.findIndex((function(e){return e===t}));return e>-1?this.childNodes.splice(e,1):null}}]),r}(Kl));if("undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM){var Xl=my.getSystemInfoSync();ql=Xl.screenWidth,Hl=Xl.screenHeight,Zl=Xl.windowWidth,Yl=Xl.windowHeight}else{var Jl=xf.innerWidth,th=xf.innerHeight;ql=Jl,Hl=th,Zl=Jl,Yl=th}var eh={width:ql,height:Hl,availWidth:Zl,availHeight:Yl,availLeft:0,availTop:0},rh=eh.availWidth,nh=eh.availHeight,oh={style:[]};function ih(t,e){var r,n;"parentNode"in t||(r=0===e?function(){return null}:1===e?function(){return oh}:function(){return null},Object.defineProperty(t,"parentNode",{enumerable:!0,get:r}));"parentElement"in t||(n=0===e?function(){return null}:1===e?function(){return oh}:function(){return null},Object.defineProperty(t,"parentElement",{enumerable:!0,get:n}))}function ah(t){t.style=t.style||{},Object.assign(t.style,{top:"0px",left:"0px",width:rh+"px",height:nh+"px",margin:"0px",padding:"0px"})}function uh(t){"clientLeft"in t||(t.clientLeft=0,t.clientTop=0),"clientWidth"in t||(t.clientWidth=rh,t.clientHeight=nh),"getBoundingClientRect"in t||(t.getBoundingClientRect=function(){return{x:0,y:0,top:0,left:0,width:this.clientWidth,height:this.clientHeight,right:this.clientWidth,bottom:this.clientHeight}})}function sh(t){"offsetLeft"in t||(t.offsetLeft=0,t.offsetTop=0),"offsetWidth"in t||(t.offsetWidth=rh,t.offsetHeight=nh)}function ch(t){"scrollLeft"in t||(t.scrollLeft=0,t.scrollTop=0),"scrollWidth"in t||(t.scrollWidth=rh,t.scrollHeight=nh)}function fh(t){var e=function(){return!0};t.classList=[],t.classList.add=e,t.classList.remove=e,t.classList.contains=e,t.classList.toggle=e}function lh(){}var hh=function(t){c(r,t);var e=v(r);function r(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",o=arguments.length>1?arguments[1]:void 0;return i(this,r),s(h(t=e.call(this)),"className",void 0),s(h(t),"children",void 0),s(h(t),"focus",void 0),s(h(t),"blur",void 0),s(h(t),"insertBefore",void 0),s(h(t),"appendChild",void 0),s(h(t),"removeChild",void 0),s(h(t),"remove",void 0),s(h(t),"innerHTML",void 0),s(h(t),"tagName",void 0),t.className="",t.children=[],t.focus=lh,t.blur=lh,t.insertBefore=lh,t.appendChild=lh,t.removeChild=lh,t.remove=lh,t.innerHTML="",t.tagName=n.toUpperCase(),ih(h(t),o),ah(h(t)),fh(h(t)),uh(h(t)),sh(h(t)),ch(h(t)),t}return u(r)}(Ql),ph=function(t){c(r,t);var e=v(r);function r(){return i(this,r),e.call(this,"video")}return u(r)}(function(t){c(r,t);var e=v(r);function r(t){return i(this,r),e.call(this,t)}return u(r,[{key:"addTextTrack",value:function(){}},{key:"captureStream",value:function(){}},{key:"fastSeek",value:function(){}},{key:"load",value:function(){}},{key:"pause",value:function(){}},{key:"play",value:function(){}}]),r}(hh)),vh={};function dh(){return vh}var yh=u((function t(){i(this,t);var e=dh(),r=e.createImage&&e.createImage()||{};return"tagName"in r||(r.tagName="IMG",r.__proto__=t.prototype),ih(r),fh(r),Object.assign(r,{addEventListener:function(t,e){r["on".concat(t)]=e.bind(r)},removeEventListener:function(t){r["on".concat(t)]=null}}),r})),gh={href:"",protocol:"",host:""},mh=function(t){c(r,t);var e=v(r);function r(){return i(this,r),e.call(this,"body",0)}return u(r,[{key:"addEventListener",value:function(t,e){}},{key:"removeEventListener",value:function(t,e,r){}},{key:"dispatchEvent",value:function(t){}}]),r}(hh),xh=function(t){c(r,t);var e=v(r);function r(){return i(this,r),e.call(this,"html",0)}return u(r,[{key:"addEventListener",value:function(t,e){}},{key:"removeEventListener",value:function(t,e){}},{key:"dispatchEvent",value:function(t){}}]),r}(hh),bh={},wh={readyState:"complete",visibilityState:"visible",hidden:!1,fullscreen:!0,scripts:[],style:{},location:gh,ontouchstart:null,ontouchmove:null,ontouchend:null,onvisibilitychange:null,parentNode:null,parentElement:null,head:null,body:null,documentElement:{style:[]},createElement:function(t){return"canvas"===(t=t.toLowerCase())?my.createOffscreenCanvas(1024,128,"2d"):"img"===t?new yh:"video"===t?new ph:new hh(t)},createElementNS:function(t,e){return this.createElement(e)},createTextNode:function(t){return t},getElementById:function(t){return null},getElementsByTagName:function(t){return t=t.toLowerCase(),[]},getElementsByTagNameNS:function(t,e){return this.getElementsByTagName(e)},getElementsByName:function(t){return[]},querySelector:function(t){return null},querySelectorAll:function(t){return[]},addEventListener:function(t,e,r){bh[t]||(bh[t]=[]),bh[t].push(e)},removeEventListener:function(t,e){var r=bh[t];if(r&&r.length>0)for(var n=r.length;n--;n>0)if(r[n]===e){r.splice(n,1);break}},dispatchEvent:function(t){var e=t.type,r=bh[e];if(r)for(var n=0;n<r.length;n++)r[n](t);t.target&&"function"==typeof t.target["on"+e]&&t.target["on"+e](t)},createEvent:function(t){return new tl(t)}};wh.documentElement=new xh,wh.head=new hh("head"),wh.body=new mh,Ef("match",(function(t,e,r){return[function(e){var r=D(this),n=null==e?void 0:jt(e,t);return n?wt(n,e,r):new RegExp(e)[t](Kc(r))},function(t){var n=xt(this),o=Kc(t),i=r(e,n,o);if(i.done)return i.value;if(!n.global)return Ff(n,o);var a=n.unicode;n.lastIndex=0;for(var u,s=[],c=0;null!==(u=Ff(n,o));){var f=Kc(u[0]);s[c]=f,""===f&&(n.lastIndex=jf(o,Ne(n.lastIndex),a)),c++}return 0===c?null:s}]}));var Eh,Ah,Oh=ut("isConcatSpreadable"),Sh=tt>=51||!j((function(){var t=[];return t[Oh]=!1,t.concat()[0]!==t})),Th=ki("concat"),kh=function(t){if(!lt(t))return!1;var e=t[Oh];return void 0!==e?!!e:pi(t)};if(or({target:"Array",proto:!0,arity:1,forced:!Sh||!Th},{concat:function(t){var e,r,n,o,i,a=W(this),u=yi(a,0),s=0;for(e=-1,n=arguments.length;e<n;e++)if(kh(i=-1===e?a:arguments[e]))for(o=De(i),Kf(s+o),r=0;r<o;r++,s++)r in i&&Si(u,s,i[r]);else Kf(s+1),Si(u,s++,i);return u.length=s,u}}),"undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM){var Ih=my.getSystemInfoSync();Eh=Ih.system,Ih.platform,Ih.language}else{var jh={versions:(Ah=xf.navigator.userAgent,{trident:Ah.indexOf("Trident")>-1,presto:Ah.indexOf("Presto")>-1,webKit:Ah.indexOf("AppleWebKit")>-1,gecko:Ah.indexOf("Gecko")>-1&&-1===Ah.indexOf("KHTML"),mobile:!!Ah.match(/AppleWebKit.*Mobile.*/),ios:!!Ah.match(/\\(i[^;]+;( U;)? CPU.+Mac OS X/),android:Ah.indexOf("Android")>-1||Ah.indexOf("Linux")>-1,iPhone:Ah.indexOf("iPhone")>-1,iPad:Ah.indexOf("iPad")>-1,webApp:-1===Ah.indexOf("Safari"),weixin:Ah.indexOf("MicroMessenger")>-1,qq:" qq"===Ah.match(/\\sQQ/i)}),language:(xf.navigator.browserLanguage||xf.navigator.language).toLowerCase()};jh.versions.android?"android":jh.versions.trident?"IE":jh.versions.presto?"Opera":jh.versions.webKit?"webKit":jh.versions.gecko?"Firefox":jh.versions.mobile?"mobile":jh.versions.ios?"ios":jh.versions.iPhone?"iPhone":jh.versions.iPad?"ipad":jh.versions.webApp?"webApp":jh.versions.weixin?"weixin":jh.versions.qq&&"qq",Eh=xf.navigator.userAgent,jh.language}Eh.toLowerCase().indexOf("android");es("Uint8",(function(t){return function(e,r,n){return t(this,e,r,n)}}));var Ph=Ft.f,_h=gl.fastKey,Mh=se.set,Lh=se.getterFor;ml("Map",(function(t){return function(){return t(this,arguments.length?arguments[0]:void 0)}}),{getConstructor:function(t,e,r,n){var o=t((function(t,o){dr(t,i),Mh(t,{type:e,index:Yi(null),first:void 0,last:void 0,size:0}),ft||(t.size=0),null!=o&&Ao(o,t[n],{that:t,AS_ENTRIES:r})})),i=o.prototype,a=Lh(e),u=function(t,e,r){var n,o,i=a(t),u=s(t,e);return u?u.value=r:(i.last=u={index:o=_h(e,!0),key:e,value:r,previous:n=i.last,next:void 0,removed:!1},i.first||(i.first=u),n&&(n.next=u),ft?i.size++:t.size++,"F"!==o&&(i.index[o]=u)),t},s=function(t,e){var r,n=a(t),o=_h(e);if("F"!==o)return n.index[o];for(r=n.first;r;r=r.next)if(r.key==e)return r};return Xa(i,{clear:function(){for(var t=a(this),e=t.index,r=t.first;r;)r.removed=!0,r.previous&&(r.previous=r.previous.next=void 0),delete e[r.index],r=r.next;t.first=t.last=void 0,ft?t.size=0:this.size=0},delete:function(t){var e=a(this),r=s(this,t);if(r){var n=r.next,o=r.previous;delete e.index[r.index],r.removed=!0,o&&(o.next=n),n&&(n.previous=o),e.first==r&&(e.first=n),e.last==r&&(e.last=o),ft?e.size--:this.size--}return!!r},forEach:function(t){for(var e,r=a(this),n=Fr(t,arguments.length>1?arguments[1]:void 0);e=e?e.next:r.first;)for(n(e.value,e.key,this);e&&e.removed;)e=e.previous},has:function(t){return!!s(this,t)}}),Xa(i,r?{get:function(t){var e=s(this,t);return e&&e.value},set:function(t,e){return u(this,0===t?0:t,e)}}:{add:function(t){return u(this,t=0===t?0:t,t)}}),ft&&Ph(i,"size",{get:function(){return a(this).size}}),o},setStrong:function(t,e,r){var n=e+" Iterator",o=Lh(e),i=Lh(n);ma(t,e,(function(t,e){Mh(this,{type:n,target:t,state:o(t),kind:e,last:void 0})}),(function(){for(var t=i(this),e=t.kind,r=t.last;r&&r.removed;)r=r.previous;return t.target&&(t.last=r=r?r.next:t.state.first)?"keys"==e?{value:r.key,done:!1}:"values"==e?{value:r.value,done:!1}:{value:[r.key,r.value],done:!1}:(t.target=void 0,{value:void 0,done:!0})}),r?"entries":"values",!r,!0),pr(e)}});var Rh=C([].join),Ch=Oe!=Object,Nh=bi("join",",");or({target:"Array",proto:!0,forced:Ch||!Nh},{join:function(t){return Rh(Se(this),void 0===t?",":t)}});var Dh=j((function(){Bi(1)}));or({target:"Object",stat:!0,forced:Dh},{keys:function(t){return Bi(W(t))}});var Fh=new Map,Wh=new Map,zh=new Map,Bh=function(t){c(r,t);var e=v(r);function r(){var t;return i(this,r),s(h(t=e.call(this)),"onabort",void 0),s(h(t),"onerror",void 0),s(h(t),"onload",void 0),s(h(t),"onloadstart",void 0),s(h(t),"onprogress",void 0),s(h(t),"ontimeout",void 0),s(h(t),"onloadend",void 0),s(h(t),"onreadystatechange",void 0),s(h(t),"readyState",void 0),s(h(t),"response",void 0),s(h(t),"responseText",void 0),s(h(t),"_responseType",void 0),s(h(t),"responseXML",void 0),s(h(t),"status",void 0),s(h(t),"statusText",void 0),s(h(t),"upload",void 0),s(h(t),"withCredentials",void 0),s(h(t),"timeout",void 0),s(h(t),"_url",void 0),s(h(t),"_method",void 0),t.onabort=null,t.onerror=null,t.onload=null,t.onloadstart=null,t.onprogress=null,t.ontimeout=null,t.onloadend=null,t.onreadystatechange=null,t.readyState=0,t.response=null,t.responseText=null,t._responseType="text",t.responseXML=null,t.status=0,t.statusText="",t.upload={},t.withCredentials=!1,Fh.set("requestHeader",{"content-type":"application/x-www-form-urlencoded"}),t}return u(r,[{key:"responseType",set:function(t){this._responseType=t}},{key:"abort",value:function(){var t=zh.get("requestTask");t&&t.abort()}},{key:"getAllResponseHeaders",value:function(){var t=Wh.get("responseHeader");return Object.keys(t).map((function(e){return"".concat(e,": ").concat(t[e])})).join("\\n")}},{key:"getResponseHeader",value:function(t){return Wh.get("responseHeader")[t]}},{key:"open",value:function(t,e,r){this._method=t,this._url=e}},{key:"overrideMimeType",value:function(){}},{key:"send",value:function(){}},{key:"setRequestHeader",value:function(t,e){var r=Fh.get("requestHeader");r[t]=e,Fh.set("requestHeader",r)}},{key:"addEventListener",value:function(t,e){var r=this;"function"==typeof e&&(this["on"+t]=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.target=t.target||r,e.call(r,t)})}},{key:"removeEventListener",value:function(t,e){this["on"+t]===e&&(this["on"+t]=null)}}]),r}(Kl);s(Bh,"UNSEND",void 0),s(Bh,"OPENED",void 0),s(Bh,"HEADERS_RECEIVED",void 0),s(Bh,"LOADING",void 0),s(Bh,"DONE",void 0),Bh.UNSEND=0,Bh.OPENED=1,Bh.HEADERS_RECEIVED=2,Bh.LOADING=3,Bh.DONE=4;var Uh="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,Gh="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram),Vh=Uh||Gh;Vh||xf.XMLHttpRequest,Vh||xf.location;function qh(t){return[t+1&255,t+1>>8&255,t+1>>8>>8&255]}var Hh=xi.filter,Zh=ki("filter");function Yh(t,e){var r=t.color;return r&&r.length?r:[1,1,1,1]}function $h(t,e,r){return 2===r.length?[r[0],r[1],0]:[r[0],r[1],r[2]]}function Kh(t,e){return t.filter?[1]:[0]}function Qh(t,e,r,n){return[e]}or({target:"Array",proto:!0,forced:!Zh},{filter:function(t){return Hh(this,t,arguments.length>1?arguments[1]:void 0)}});var Xh=tp,Jh=tp;function tp(t,e,r){r=r||2;var n,o,i,a,u,s,c,f=e&&e.length,l=f?e[0]*r:t.length,h=ep(t,0,l,r,!0),p=[];if(!h||h.next===h.prev)return p;if(f&&(h=function(t,e,r,n){var o,i,a,u,s,c=[];for(o=0,i=e.length;o<i;o++)a=e[o]*n,u=o<i-1?e[o+1]*n:t.length,(s=ep(t,a,u,n,!1))===s.next&&(s.steiner=!0),c.push(hp(s));for(c.sort(sp),o=0;o<c.length;o++)r=cp(c[o],r);return r}(t,e,h,r)),t.length>80*r){n=i=t[0],o=a=t[1];for(var v=r;v<l;v+=r)(u=t[v])<n&&(n=u),(s=t[v+1])<o&&(o=s),u>i&&(i=u),s>a&&(a=s);c=0!==(c=Math.max(i-n,a-o))?32767/c:0}return np(h,p,r,n,o,c,0),p}function ep(t,e,r,n,o){var i,a;if(o===Sp(t,e,r,n)>0)for(i=e;i<r;i+=n)a=Ep(i,t[i],t[i+1],a);else for(i=r-n;i>=e;i-=n)a=Ep(i,t[i],t[i+1],a);return a&&yp(a,a.next)&&(Ap(a),a=a.next),a}function rp(t,e){if(!t)return t;e||(e=t);var r,n=t;do{if(r=!1,n.steiner||!yp(n,n.next)&&0!==dp(n.prev,n,n.next))n=n.next;else{if(Ap(n),(n=e=n.prev)===n.next)break;r=!0}}while(r||n!==e);return e}function np(t,e,r,n,o,i,a){if(t){!a&&i&&function(t,e,r,n){var o=t;do{0===o.z&&(o.z=lp(o.x,o.y,e,r,n)),o.prevZ=o.prev,o.nextZ=o.next,o=o.next}while(o!==t);o.prevZ.nextZ=null,o.prevZ=null,function(t){var e,r,n,o,i,a,u,s,c=1;do{for(r=t,t=null,i=null,a=0;r;){for(a++,n=r,u=0,e=0;e<c&&(u++,n=n.nextZ);e++);for(s=c;u>0||s>0&&n;)0!==u&&(0===s||!n||r.z<=n.z)?(o=r,r=r.nextZ,u--):(o=n,n=n.nextZ,s--),i?i.nextZ=o:t=o,o.prevZ=i,i=o;r=n}i.nextZ=null,c*=2}while(a>1)}(o)}(t,n,o,i);for(var u,s,c=t;t.prev!==t.next;)if(u=t.prev,s=t.next,i?ip(t,n,o,i):op(t))e.push(u.i/r|0),e.push(t.i/r|0),e.push(s.i/r|0),Ap(t),t=s.next,c=s.next;else if((t=s)===c){a?1===a?np(t=ap(rp(t),e,r),e,r,n,o,i,2):2===a&&up(t,e,r,n,o,i):np(rp(t),e,r,n,o,i,1);break}}}function op(t){var e=t.prev,r=t,n=t.next;if(dp(e,r,n)>=0)return!1;for(var o=e.x,i=r.x,a=n.x,u=e.y,s=r.y,c=n.y,f=o<i?o<a?o:a:i<a?i:a,l=u<s?u<c?u:c:s<c?s:c,h=o>i?o>a?o:a:i>a?i:a,p=u>s?u>c?u:c:s>c?s:c,v=n.next;v!==e;){if(v.x>=f&&v.x<=h&&v.y>=l&&v.y<=p&&pp(o,u,i,s,a,c,v.x,v.y)&&dp(v.prev,v,v.next)>=0)return!1;v=v.next}return!0}function ip(t,e,r,n){var o=t.prev,i=t,a=t.next;if(dp(o,i,a)>=0)return!1;for(var u=o.x,s=i.x,c=a.x,f=o.y,l=i.y,h=a.y,p=u<s?u<c?u:c:s<c?s:c,v=f<l?f<h?f:h:l<h?l:h,d=u>s?u>c?u:c:s>c?s:c,y=f>l?f>h?f:h:l>h?l:h,g=lp(p,v,e,r,n),m=lp(d,y,e,r,n),x=t.prevZ,b=t.nextZ;x&&x.z>=g&&b&&b.z<=m;){if(x.x>=p&&x.x<=d&&x.y>=v&&x.y<=y&&x!==o&&x!==a&&pp(u,f,s,l,c,h,x.x,x.y)&&dp(x.prev,x,x.next)>=0)return!1;if(x=x.prevZ,b.x>=p&&b.x<=d&&b.y>=v&&b.y<=y&&b!==o&&b!==a&&pp(u,f,s,l,c,h,b.x,b.y)&&dp(b.prev,b,b.next)>=0)return!1;b=b.nextZ}for(;x&&x.z>=g;){if(x.x>=p&&x.x<=d&&x.y>=v&&x.y<=y&&x!==o&&x!==a&&pp(u,f,s,l,c,h,x.x,x.y)&&dp(x.prev,x,x.next)>=0)return!1;x=x.prevZ}for(;b&&b.z<=m;){if(b.x>=p&&b.x<=d&&b.y>=v&&b.y<=y&&b!==o&&b!==a&&pp(u,f,s,l,c,h,b.x,b.y)&&dp(b.prev,b,b.next)>=0)return!1;b=b.nextZ}return!0}function ap(t,e,r){var n=t;do{var o=n.prev,i=n.next.next;!yp(o,i)&&gp(o,n,n.next,i)&&bp(o,i)&&bp(i,o)&&(e.push(o.i/r|0),e.push(n.i/r|0),e.push(i.i/r|0),Ap(n),Ap(n.next),n=t=i),n=n.next}while(n!==t);return rp(n)}function up(t,e,r,n,o,i){var a=t;do{for(var u=a.next.next;u!==a.prev;){if(a.i!==u.i&&vp(a,u)){var s=wp(a,u);return a=rp(a,a.next),s=rp(s,s.next),np(a,e,r,n,o,i,0),void np(s,e,r,n,o,i,0)}u=u.next}a=a.next}while(a!==t)}function sp(t,e){return t.x-e.x}function cp(t,e){var r=function(t,e){var r,n=e,o=t.x,i=t.y,a=-1/0;do{if(i<=n.y&&i>=n.next.y&&n.next.y!==n.y){var u=n.x+(i-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(u<=o&&u>a&&(a=u,r=n.x<n.next.x?n:n.next,u===o))return r}n=n.next}while(n!==e);if(!r)return null;var s,c=r,f=r.x,l=r.y,h=1/0;n=r;do{o>=n.x&&n.x>=f&&o!==n.x&&pp(i<l?o:a,i,f,l,i<l?a:o,i,n.x,n.y)&&(s=Math.abs(i-n.y)/(o-n.x),bp(n,t)&&(s<h||s===h&&(n.x>r.x||n.x===r.x&&fp(r,n)))&&(r=n,h=s)),n=n.next}while(n!==c);return r}(t,e);if(!r)return e;var n=wp(r,t);return rp(n,n.next),rp(r,r.next)}function fp(t,e){return dp(t.prev,t,e.prev)<0&&dp(e.next,t,t.next)<0}function lp(t,e,r,n,o){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*o|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*o|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function hp(t){var e=t,r=t;do{(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next}while(e!==t);return r}function pp(t,e,r,n,o,i,a,u){return(o-a)*(e-u)>=(t-a)*(i-u)&&(t-a)*(n-u)>=(r-a)*(e-u)&&(r-a)*(i-u)>=(o-a)*(n-u)}function vp(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var r=t;do{if(r.i!==t.i&&r.next.i!==t.i&&r.i!==e.i&&r.next.i!==e.i&&gp(r,r.next,t,e))return!0;r=r.next}while(r!==t);return!1}(t,e)&&(bp(t,e)&&bp(e,t)&&function(t,e){var r=t,n=!1,o=(t.x+e.x)/2,i=(t.y+e.y)/2;do{r.y>i!=r.next.y>i&&r.next.y!==r.y&&o<(r.next.x-r.x)*(i-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next}while(r!==t);return n}(t,e)&&(dp(t.prev,t,e.prev)||dp(t,e.prev,e))||yp(t,e)&&dp(t.prev,t,t.next)>0&&dp(e.prev,e,e.next)>0)}function dp(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function yp(t,e){return t.x===e.x&&t.y===e.y}function gp(t,e,r,n){var o=xp(dp(t,e,r)),i=xp(dp(t,e,n)),a=xp(dp(r,n,t)),u=xp(dp(r,n,e));return o!==i&&a!==u||(!(0!==o||!mp(t,r,e))||(!(0!==i||!mp(t,n,e))||(!(0!==a||!mp(r,t,n))||!(0!==u||!mp(r,e,n)))))}function mp(t,e,r){return e.x<=Math.max(t.x,r.x)&&e.x>=Math.min(t.x,r.x)&&e.y<=Math.max(t.y,r.y)&&e.y>=Math.min(t.y,r.y)}function xp(t){return t>0?1:t<0?-1:0}function bp(t,e){return dp(t.prev,t,t.next)<0?dp(t,e,t.next)>=0&&dp(t,t.prev,e)>=0:dp(t,e,t.prev)<0||dp(t,t.next,e)<0}function wp(t,e){var r=new Op(t.i,t.x,t.y),n=new Op(e.i,e.x,e.y),o=t.next,i=e.prev;return t.next=e,e.prev=t,r.next=o,o.prev=r,n.next=r,r.prev=n,i.next=n,n.prev=i,n}function Ep(t,e,r,n){var o=new Op(t,e,r);return n?(o.next=n.next,o.prev=n,n.next.prev=o,n.next=o):(o.prev=o,o.next=o),o}function Ap(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Op(t,e,r){this.i=t,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Sp(t,e,r,n){for(var o=0,i=e,a=r-n;i<r;i+=n)o+=(t[a]-t[i])*(t[i+1]+t[a+1]),a=i;return o}tp.deviation=function(t,e,r,n){var o=e&&e.length,i=o?e[0]*r:t.length,a=Math.abs(Sp(t,0,i,r));if(o)for(var u=0,s=e.length;u<s;u++){var c=e[u]*r,f=u<s-1?e[u+1]*r:t.length;a-=Math.abs(Sp(t,c,f,r))}var l=0;for(u=0;u<n.length;u+=3){var h=n[u]*r,p=n[u+1]*r,v=n[u+2]*r;l+=Math.abs((t[h]-t[v])*(t[p+1]-t[h+1])-(t[h]-t[p])*(t[v+1]-t[h+1]))}return 0===a&&0===l?0:Math.abs((l-a)/a)},tp.flatten=function(t){for(var e=t[0][0].length,r={vertices:[],holes:[],dimensions:e},n=0,o=0;o<t.length;o++){for(var i=0;i<t[o].length;i++)for(var a=0;a<e;a++)r.vertices.push(t[o][i][a]);o>0&&(n+=t[o-1].length,r.holes.push(n))}return r},Xh.default=Jh;var Tp=C(1..valueOf),kp=C("".replace),Ip="[\\t\\n\\v\\f\\r \xA0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\\u2028\\u2029\\ufeff]",jp=RegExp("^"+Ip+Ip+"*"),Pp=RegExp(Ip+Ip+"*$"),_p=function(t){return function(e){var r=Kc(D(e));return 1&t&&(r=kp(r,jp,"")),2&t&&(r=kp(r,Pp,"")),r}},Mp={start:_p(1),end:_p(2),trim:_p(3)},Lp=qe.f,Rp=ke.f,Cp=Ft.f,Np=Mp.trim,Dp=O.Number,Fp=Dp.prototype,Wp=O.TypeError,zp=C("".slice),Bp=C("".charCodeAt),Up=function(t){var e=Lt(t,"number");return"bigint"==typeof e?e:Gp(e)},Gp=function(t){var e,r,n,o,i,a,u,s,c=Lt(t,"number");if(Ot(c))throw Wp("Cannot convert a Symbol value to a number");if("string"==typeof c&&c.length>2)if(c=Np(c),43===(e=Bp(c,0))||45===e){if(88===(r=Bp(c,2))||120===r)return NaN}else if(48===e){switch(Bp(c,1)){case 66:case 98:n=2,o=49;break;case 79:case 111:n=8,o=55;break;default:return+c}for(a=(i=zp(c,2)).length,u=0;u<a;u++)if((s=Bp(i,u))<48||s>o)return NaN;return parseInt(i,n)}return+c};if(rr("Number",!Dp(" 0o1")||!Dp("0b1")||Dp("+0x1"))){for(var Vp,qp=function(t){var e=arguments.length<1?0:Dp(Up(t)),r=this;return Et(Fp,r)&&j((function(){Tp(r)}))?ts(Object(e),r,qp):e},Hp=ft?Lp(Dp):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,isFinite,isInteger,isNaN,isSafeInteger,parseFloat,parseInt,fromString,range".split(","),Zp=0;Hp.length>Zp;Zp++)B(Dp,Vp=Hp[Zp])&&!B(qp,Vp)&&Cp(qp,Vp,Rp(Dp,Vp));qp.prototype=Fp,Fp.constructor=qp,fe(O,"Number",qp,{constructor:!0})}var Yp=RangeError,$p=RangeError,Kp=String,Qp=Math.floor,Xp=C((function(t){var e=Kc(D(this)),r="",n=_e(t);if(n<0||n==1/0)throw Yp("Wrong number of repetitions");for(;n>0;(n>>>=1)&&(e+=e))1&n&&(r+=e);return r})),Jp=C("".slice),tv=C(1..toFixed),ev=function(t,e,r){return 0===e?r:e%2==1?ev(t,e-1,r*t):ev(t*t,e/2,r)},rv=function(t,e,r){for(var n=-1,o=r;++n<6;)o+=e*t[n],t[n]=o%1e7,o=Qp(o/1e7)},nv=function(t,e){for(var r=6,n=0;--r>=0;)n+=t[r],t[r]=Qp(n/e),n=n%e*1e7},ov=function(t){for(var e=6,r="";--e>=0;)if(""!==r||0===e||0!==t[e]){var n=Kp(t[e]);r=""===r?n:r+Xp("0",7-n.length)+n}return r},iv=j((function(){return"0.000"!==tv(8e-5,3)||"1"!==tv(.9,0)||"1.25"!==tv(1.255,2)||"1000000000000000128"!==tv(0xde0b6b3a7640080,0)}))||!j((function(){tv({})}));function av(t){return"number"==typeof t}function uv(t){var e=Math.max(Math.min(85.0511287798,t[1]),-85.0511287798),r=Math.PI/180,n=t[0]*r,o=e*r;o=Math.log(Math.tan(Math.PI/4+o/2));return n=(256<<20)*(.5/Math.PI*n+.5),o=(256<<20)*(-.5/Math.PI*o+(r=.5)),[Math.floor(n),Math.floor(o)]}or({target:"Number",proto:!0,forced:iv},{toFixed:function(t){var e,r,n,o,i=Tp(this),a=_e(t),u=[0,0,0,0,0,0],s="",c="0";if(a<0||a>20)throw $p("Incorrect fraction digits");if(i!=i)return"NaN";if(i<=-1e21||i>=1e21)return Kp(i);if(i<0&&(s="-",i=-i),i>1e-21)if(r=(e=function(t){for(var e=0,r=t;r>=4096;)e+=12,r/=4096;for(;r>=2;)e+=1,r/=2;return e}(i*ev(2,69,1))-69)<0?i*ev(2,-e,1):i/ev(2,e,1),r*=4503599627370496,(e=52-e)>0){for(rv(u,0,r),n=a;n>=7;)rv(u,1e7,0),n-=7;for(rv(u,ev(10,n,1),0),n=e-1;n>=23;)nv(u,1<<23),n-=23;nv(u,1<<n),rv(u,1,1),nv(u,2),c=ov(u)}else rv(u,0,r),rv(u,1<<-e,0),c=ov(u)+Xp("0",a);return c=a>0?s+((o=c.length)<=a?"0."+Xp("0",a-o)+c:Jp(c,0,o-a)+"."+Jp(c,o-a)):s+c}});var sv,cv=/"/g,fv=C("".replace);or({target:"String",proto:!0,forced:(sv="sub",j((function(){var t=""[sv]('"');return t!==t.toLowerCase()||t.split('"').length>3})))},{sub:function(){return t="sub",e="",r="",n=Kc(D(this)),o="<"+t,""!==e&&(o+=" "+e+'="'+fv(Kc(r),cv,"&quot;")+'"'),o+">"+n+"</"+t+">";var t,e,r,n,o}});var lv=RegExp.prototype,hv=Ut.PROPER,pv=RegExp.prototype.toString,vv=j((function(){return"/a/b"!=pv.call({source:"a",flags:"b"})})),dv=hv&&"toString"!=pv.name;(vv||dv)&&fe(RegExp.prototype,"toString",(function(){var t=xt(this);return"/"+Kc(t.source)+"/"+Kc(function(t){var e=t.flags;return void 0!==e||"flags"in lv||B(t,"flags")||!Et(lv,t)?e:wt(Qc,t)}(t))}),{unsafe:!0});var yv="undefined"!=typeof Float32Array?Float32Array:Array;function gv(){var t=new yv(2);return yv!=Float32Array&&(t[0]=0,t[1]=0),t}function mv(t,e){var r=new yv(2);return r[0]=t,r[1]=e,r}function xv(t,e){return t[0]=e[0],t[1]=e[1],t}function bv(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t}function wv(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t}function Ev(t,e){var r=e[0],n=e[1],o=r*r+n*n;return o>0&&(o=1/Math.sqrt(o)),t[0]=e[0]*o,t[1]=e[1]*o,t}function Av(t,e){return t[0]*e[0]+t[1]*e[1]}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var Ov,Sv=wv,Tv=(Ov=gv(),gv()),kv=(gv(),gv()),Iv=gv(),jv=gv();function Pv(t,e,r,n,o){return bv(t,r,n),Ev(t,t),[o/Av(e=mv(-t[1],t[0]),mv(-r[1],r[0])),e]}function _v(t,e){return function(t,e,r){return t[0]=e,t[1]=r,t}(t,-e[1],e[0])}function Mv(t,e,r){return Sv(t,e,r),Ev(t,t),t}function Lv(t,e){return t[0]===e[0]&&t[1]===e[1]}var Rv=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i(this,t),s(this,"complex",void 0),s(this,"join",void 0),s(this,"cap",void 0),s(this,"miterLimit",void 0),s(this,"thickness",void 0),s(this,"normal",void 0),s(this,"lastFlip",-1),s(this,"miter",mv(0,0)),s(this,"started",!1),s(this,"dash",!1),s(this,"totalDistance",0),s(this,"currentIndex",0),this.join=e.join||"miter",this.cap=e.cap||"butt",this.miterLimit=e.miterLimit||10,this.thickness=e.thickness||1,this.dash=e.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return u(t,[{key:"extrude_gaode2",value:function(t,e){var r=this.complex;if(t.length<=1)return r;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var n=t.length,o=r.startIndex,i=1;i<n;i++){var a,u,s,c=t[i-1];c.push(null!==(a=e[i-1][2])&&void 0!==a?a:0);var f=e[i-1],l=t[i];l.push(null!==(u=e[i][2])&&void 0!==u?u:0);var h=e[i],p=i<t.length-1?[].concat(y(t[i+1]),[null!==(s=e[i+1][2])&&void 0!==s?s:0]):null,v=i<e.length-1?e[i+1]:null;o+=this.segment_gaode2(r,o,c,l,p,f,h,v)}if(this.dash)for(var d=0;d<r.positions.length/6;d++)r.positions[6*d+5]=this.totalDistance;return r.startIndex=r.positions.length/6,r}},{key:"simpleExtrude_gaode2",value:function(t,e){var r=this.complex;if(t.length<=1)return r;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var n=t.length,o=r.startIndex,i=1;i<n;i++){var a,u,s,c=t[i-1];c.push(null!==(a=e[i-1][2])&&void 0!==a?a:0);var f=e[i-1],l=t[i];l.push(null!==(u=e[i][2])&&void 0!==u?u:0);var h=e[i],p=i<t.length-1?[].concat(y(t[i+1]),[null!==(s=e[i+1][2])&&void 0!==s?s:0]):null,v=i<e.length-1?e[i+1]:null;o+=this.simpleSegment(r,o,c,l,p,f,h,v)}if(this.dash)for(var d=0;d<r.positions.length/6;d++)r.positions[6*d+5]=this.totalDistance;return r.startIndex=r.positions.length/6,r}},{key:"extrude",value:function(t){var e=this.complex;if(t.length<=1)return e;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=t.length,n=e.startIndex,o=1;o<r;o++){var i=t[o-1],a=t[o],u=o<t.length-1?t[o+1]:null;n+=this.segment(e,n,i,a,u)}if(this.dash)for(var s=0;s<e.positions.length/6;s++)e.positions[6*s+5]=this.totalDistance;return e.startIndex=e.positions.length/6,e}},{key:"simpleExtrude",value:function(t){var e=this.complex;if(t.length<=1)return e;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=t.length,n=e.startIndex,o=1;o<r;o++){var i=t[o-1],a=t[o],u=o<t.length-1?t[o+1]:null;n+=this.simpleSegment(e,n,i,a,u)}if(this.dash)for(var s=0;s<e.positions.length/6;s++)e.positions[6*s+5]=this.totalDistance;return e.startIndex=e.positions.length/6,e}},{key:"segment_gaode2",value:function(t,e,r,n,o,i,a,u){var s=0,c=t.indices,f=t.positions,l=t.normals,h="square"===this.cap,p="bevel"===this.join,v=uv([a[0],a[1]]),g=uv([i[0],i[1]]);Mv(kv,n,r);var m=0;if(this.dash&&(m=this.lineSegmentDistance(v,g),this.totalDistance+=m),this.normal||(this.normal=gv(),_v(this.normal,kv)),!this.started)if(this.started=!0,h){var x=gv(),b=gv();bv(x,this.normal,kv),bv(b,this.normal,kv),l.push(b[0],b[1],0),l.push(x[0],x[1],0),f.push(r[0],r[1],0|r[2],this.totalDistance-m,-this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),f.push(r[0],r[1],0|r[2],this.totalDistance-m,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(f,l,r,this.normal,this.thickness,this.totalDistance-m);if(c.push(e+0,e+1,e+2),o){Lv(n,o)&&bv(o,n,Ev(o,wv(o,n,r))),Mv(Iv,o,n);var w=d(Pv(jv,gv(),kv,Iv,this.thickness),2),E=w[0],A=w[1],O=Av(jv,this.normal)<0?-1:1,S=p;if(!S&&"miter"===this.join)E>this.miterLimit&&(S=!0);S?(l.push(this.normal[0],this.normal[1],0),l.push(A[0],A[1],0),f.push(n[0],n[1],0|n[2],this.totalDistance,-this.thickness*O,0|n[2]),this.complex.indexes.push(this.currentIndex),f.push(n[0],n[1],0|n[2],this.totalDistance,this.thickness*O,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,c.push.apply(c,y(this.lastFlip!==-O?[e,e+2,e+3]:[e+2,e+1,e+3])),c.push(e+2,e+3,e+4),_v(Tv,Iv),xv(this.normal,Tv),l.push(this.normal[0],this.normal[1],0),f.push(n[0],n[1],0|n[2],this.totalDistance,-this.thickness*O,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,s+=3):(this.extrusions(f,l,n,A,E,this.totalDistance),c.push.apply(c,y(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),O=-1,xv(this.normal,A),s+=2),this.lastFlip=O}else{if(_v(this.normal,kv),h){var T=gv(),k=gv();Sv(k,kv,this.normal),bv(T,kv,this.normal),l.push(k[0],k[1],0),l.push(T[0],T[1],0),f.push(n[0],n[1],0|n[2],this.totalDistance,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),f.push(n[0],n[1],0|n[2],this.totalDistance,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(f,l,n,this.normal,this.thickness,this.totalDistance);c.push.apply(c,y(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),s+=2}return s}},{key:"simpleSegment",value:function(t,e,r,n,o){var i=0,a=t.indices,u=t.positions,s=t.normals,c=uv([n[0],n[1]]),f=uv([r[0],r[1]]);Mv(kv,c,f);var l=0;if(this.dash&&(l=this.lineSegmentDistance(c,f),this.totalDistance+=l),this.normal||(this.normal=gv(),_v(this.normal,kv)),this.started||(this.started=!0,this.extrusions(u,s,r,this.normal,this.thickness,this.totalDistance-l)),a.push(e+0,e+1,e+2),o){var h=uv([o[0],o[1]]);Lv(c,h)&&bv(h,c,Ev(h,wv(h,c,f))),Mv(Iv,h,c);var p=d(Pv(jv,gv(),kv,Iv,this.thickness),2),v=p[0],g=p[1];Av(jv,this.normal);this.extrusions(u,s,n,g,v,this.totalDistance),a.push.apply(a,y(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),-1,xv(this.normal,g),i+=2,this.lastFlip=-1}else _v(this.normal,kv),this.extrusions(u,s,n,this.normal,this.thickness,this.totalDistance),a.push.apply(a,y(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),i+=2;return i}},{key:"segment",value:function(t,e,r,n,o){var i=0,a=t.indices,u=t.positions,s=t.normals,c="square"===this.cap,f="bevel"===this.join,l=uv([n[0],n[1]]),h=uv([r[0],r[1]]);Mv(kv,l,h);var p=0;if(this.dash&&(p=this.lineSegmentDistance(l,h),this.totalDistance+=p),this.normal||(this.normal=gv(),_v(this.normal,kv)),!this.started)if(this.started=!0,c){var v=gv(),g=gv();bv(v,this.normal,kv),bv(g,this.normal,kv),s.push(g[0],g[1],0),s.push(v[0],v[1],0),u.push(r[0],r[1],0|r[2],this.totalDistance-p,-this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),u.push(r[0],r[1],0|r[2],this.totalDistance-p,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(u,s,r,this.normal,this.thickness,this.totalDistance-p);if(a.push(e+0,e+1,e+2),o){var m=uv([o[0],o[1]]);Lv(l,m)&&bv(m,l,Ev(m,wv(m,l,h))),Mv(Iv,m,l);var x=d(Pv(jv,gv(),kv,Iv,this.thickness),2),b=x[0],w=x[1],E=Av(jv,this.normal)<0?-1:1,A=f;if(!A&&"miter"===this.join)b>this.miterLimit&&(A=!0);A?(s.push(this.normal[0],this.normal[1],0),s.push(w[0],w[1],0),u.push(n[0],n[1],0|n[2],this.totalDistance,-this.thickness*E,0|n[2]),this.complex.indexes.push(this.currentIndex),u.push(n[0],n[1],0|n[2],this.totalDistance,this.thickness*E,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,a.push.apply(a,y(this.lastFlip!==-E?[e,e+2,e+3]:[e+2,e+1,e+3])),a.push(e+2,e+3,e+4),_v(Tv,Iv),xv(this.normal,Tv),s.push(this.normal[0],this.normal[1],0),u.push(n[0],n[1],0|n[2],this.totalDistance,-this.thickness*E,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,i+=3):(this.extrusions(u,s,n,w,b,this.totalDistance),a.push.apply(a,y(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),E=-1,xv(this.normal,w),i+=2),this.lastFlip=E}else{if(_v(this.normal,kv),c){var O=gv(),S=gv();Sv(S,kv,this.normal),bv(O,kv,this.normal),s.push(S[0],S[1],0),s.push(O[0],O[1],0),u.push(n[0],n[1],0|n[2],this.totalDistance,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),u.push(n[0],n[1],0|n[2],this.totalDistance,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(u,s,n,this.normal,this.thickness,this.totalDistance);a.push.apply(a,y(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),i+=2}return i}},{key:"extrusions",value:function(t,e,r,n,o,i){e.push(n[0],n[1],0),e.push(n[0],n[1],0),t.push(r[0],r[1],0|r[2],i,-o,0|r[2]),this.complex.indexes.push(this.currentIndex),t.push(r[0],r[1],0|r[2],i,o,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(t,e){var r=e[0]-t[0],n=e[1]-t[1];return Math.sqrt(r*r+n*n)}}]),t}();function Cv(t){var e=t.coordinates,r=t.originCoordinates,n=t.version,o=new Rv({dash:!0,join:"bevel"});if("GAODE2.x"===n){var i=e;Array.isArray(i[0][0])||(i=[e]);var a=r;Array.isArray(a[0][0])||(a=[r]);for(var u=0;u<i.length;u++){var s=i[u],c=a[u];o.extrude_gaode2(s,c)}}else{var f=e;f[0]&&!Array.isArray(f[0][0])&&(f=[e]),f.forEach((function(t){o.extrude(t)}))}var l=o.complex;return{vertices:l.positions,indices:l.indices,normals:l.normals,indexes:l.indexes,size:6}}function Nv(t){var e=function(t){if(av(t[0]))return t;if(av(t[0][0]))throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8");if(av(t[0][0][0])){var e=0,r=0,n=0;return t.forEach((function(t){t.forEach((function(t){e+=t[0],r+=t[1],n++}))})),[e/n,r/n,0]}throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8")}(t.coordinates);return{vertices:[].concat(y(e),y(e),y(e),y(e)),indices:[0,1,2,2,3,0],size:e.length}}function Dv(t){var e=t.coordinates,r=Xh.flatten(e),n=r.vertices,o=r.dimensions,i=r.holes;return{indices:Xh(n,i,o),vertices:n,size:o}}var Fv=function(){var t=o(r().mark((function t(e){var n,o,i,a,u,s,c,f,l;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.descriptors,o=e.features,i=e.enablePicking,a=e.iconMap,u={a_Color:Yh,a_Position:$h,filter:Kh,a_vertexId:Qh,a_PickingColor:function(t){var e=t.id;return i?qh(e):[0,0,0]},a_DistanceAndIndex:function(t,e,r,n,o,i){return void 0===i?[r[3],10]:[r[3],i]},a_Total_Distance:function(t,e,r,n){return[r[5]]},a_Size:function(t){var e=t.size,r=void 0===e?1:e;return Array.isArray(r)?[r[0],r[1]]:[r,0]},a_Normal:function(t,e,r,n,o){return o},a_Miter:function(t,e,r){return[r[4]]},a_iconMapUV:function(t){var e=t.texture,r=a[e]||{x:0,y:0};return[r.x,r.y]}},s={sizePerElement:0,elements:[]},c=0,f=[],l=3,o.forEach((function(t,e){var r=Cv(t),o=r.indices,i=r.vertices,a=r.normals,h=r.size,p=r.indexes;o.forEach((function(t){f.push(t+c)})),l=h;var v=i.length/h;s.sizePerElement=l,s.elements.push({featureIdx:e,vertices:i,normals:a,offset:c}),c+=v;for(var d=function(r){var o=(null==a?void 0:a.slice(3*r,3*r+3))||[],s=i.slice(r*h,r*h+h),c=0;p&&void 0!==p[r]&&(c=p[r]),n.forEach((function(n){var i;n&&u[n.name]&&(i=n.buffer.data).push.apply(i,y(u[n.name](t,e,s,r,o,c)))}))},g=0;g<v;g++)d(g)})),t.abrupt("return",{descriptors:n,featureLayout:s,indices:f});case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),Wv={pointFill:function(){var t=o(r().mark((function t(e){var n,o,i,a,u,s,c,f,l;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.descriptors,o=e.features,i=e.enablePicking,a=e.shape2d,u={a_Color:Yh,a_Position:$h,filter:Kh,a_vertexId:Qh,a_PickingColor:function(t){var e=t.id;return i?qh(e):[0,0,0]},a_Shape:function(t){var e=t.shape,r=void 0===e?2:e;return[a.indexOf(r)]},a_Extrude:function(t,e,r,n){var o=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],i=n%4*3;return[o[i],o[i+1],o[i+2]]},a_Size:function(t){var e=t.size,r=void 0===e?5:e;return Array.isArray(r)?[r[0]]:[r]}},s={sizePerElement:0,elements:[]},c=0,f=[],l=3,o.forEach((function(t,e){var r=Nv(t),o=r.indices,i=r.vertices,a=r.normals,h=r.size;o.forEach((function(t){f.push(t+c)})),l=h;var p=i.length/h;s.sizePerElement=l,s.elements.push({featureIdx:e,vertices:i,normals:a,offset:c}),c+=p;for(var v=function(r){var o=[],a=i.slice(r*h,r*h+h);n.forEach((function(n){var i;n&&u[n.name]&&(i=n.buffer.data).push.apply(i,y(u[n.name](t,e,a,r,o,0)))}))},d=0;d<p;d++)v(d)})),t.abrupt("return",{descriptors:n,featureLayout:s,indices:f});case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),line:Fv,polygonFill:function(){var t=o(r().mark((function t(e){var n,o,i,a,u,s,c,f;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.descriptors,o=e.features,i=e.enablePicking,a={a_Color:Yh,a_Position:$h,filter:Kh,a_vertexId:Qh,a_PickingColor:function(t){var e=t.id;return i?qh(e):[0,0,0]}},u={sizePerElement:0,elements:[]},s=0,c=[],f=3,o.forEach((function(t,e){var r=Dv(t),o=r.indices,i=r.vertices,l=r.normals,h=r.size;o.forEach((function(t){c.push(t+s)})),f=h;var p=i.length/h;u.sizePerElement=f,u.elements.push({featureIdx:e,vertices:i,normals:l,offset:s}),s+=p;for(var v=function(r){var o=[],u=i.slice(r*h,r*h+h);n.forEach((function(n){var i;n&&a[n.name]&&(i=n.buffer.data).push.apply(i,y(a[n.name](t,e,u,r,o,0)))}))},d=0;d<p;d++)v(d)})),t.abrupt("return",{descriptors:n,featureLayout:u,indices:c});case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},zv=function(t){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?e(Object(n),!0).forEach((function(e){s(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):e(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({},Wv);function Bv(t){return Uv.apply(this,arguments)}function Uv(){return(Uv=o(r().mark((function t(e){var n,o;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.workerType,o=e.data,!zv[n]){t.next=3;break}return t.abrupt("return",zv[n](o));case 3:return t.abrupt("return",Promise.reject(new Error('Worker with type "'.concat(n,'" non-existent.'))));case 4:case"end":return t.stop()}}),t)})))).apply(this,arguments)}return ui(Bv),t.WorkerSourceMap=Wv,t.createWorker=ui,t.worker=Bv,t}({});
`,Fs="l7-worker",XH=3,YH=!0;function ZH(r){VH(Fs,r)}function qH(){var r=WH(Fs);if(!r)throw new Error("get worker failed by workerName: ".concat(Fs,"."));return r}function KH(r,n){return Yh.apply(this,arguments)}function Yh(){return Yh=Mt(st.mark(function r(n,t){var e,i,a,o,s;return st.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return e=qH(),i=XM.getWorkerFarm({maxConcurrency:XH,reuseWorkers:YH}),a=i.getWorkerPool({name:Fs,source:e}),l.next=5,a.startJob(Fs,function(c,f,h){return c.done(h)});case 5:return o=l.sent,o.postMessage("process",{input:{workerType:n,data:t}}),l.next=9,o.result;case 9:return s=l.sent,l.abrupt("return",s.result);case 11:case"end":return l.stop()}},r)})),Yh.apply(this,arguments)}ZH(jH);var Mi={BACK:1029,FRONT:1028};function kc(r){switch(r){case"GAODE1.x":return Mi.BACK;case"GAODE2.x":return Mi.BACK;case"MAPBOX":return Mi.FRONT;case"SIMPLE":return Mi.FRONT;case"GLOBEL":return Mi.BACK;case"L7MAP":return Mi.FRONT;default:return Mi.FRONT}}function QH(r){var n=[],t=/\{([a-z])-([a-z])\}/.exec(r);if(t){var e=t[1].charCodeAt(0),i=t[2].charCodeAt(0),a;for(a=e;a<=i;++a)n.push(r.replace(t[0],String.fromCharCode(a)));return n}if(t=/\{(\d+)-(\d+)\}/.exec(r),t){for(var o=parseInt(t[2],10),s=parseInt(t[1],10);s<=o;s++)n.push(r.replace(t[0],s.toString()));return n}return n.push(r),n}function bl(r,n){if(!r||!r.length)throw new Error("url is not allowed to be empty");var t=n.x,e=n.y,i=n.z,a=QH(r),o=Math.abs(t+e)%a.length,s=a[o];return s.replace(/\{x\}/g,t.toString()).replace(/\{y\}/g,e.toString()).replace(/\{z\}/g,i.toString()).replace(/\{-y\}/g,(Math.pow(2,i)-e-1).toString())}var Ga;(function(r){r.Realtime="realtime",r.Overlap="overlap",r.Replace="replace"})(Ga||(Ga={}));var cr;(function(r){r.Loading="Loading",r.Loaded="Loaded",r.Failure="Failure",r.Cancelled="Cancelled"})(cr||(cr={}));var Q2=0,By=1,Oc=2;function JH(r){r.forEach(function(n){n.isCurrent&&(n.isVisible=n.isLoaded)})}function t$(r){r.forEach(function(n){n.properties.state=Q2}),r.forEach(function(n){n.isCurrent&&!J2(n)&&ad(n)}),r.forEach(function(n){n.isVisible=Boolean(n.properties.state&Oc)})}function e$(r){r.forEach(function(t){t.properties.state=Q2}),r.forEach(function(t){t.isCurrent&&J2(t)});var n=r.slice().sort(function(t,e){return t.z-e.z});n.forEach(function(t){t.isVisible=Boolean(t.properties.state&Oc),t.children.length&&(t.isVisible||t.properties.state&By)?t.children.forEach(function(e){e.properties.state=By}):t.isCurrent&&ad(t)})}function J2(r){for(;r;){if(r.isLoaded)return r.properties.state|=Oc,!0;r=r.parent}return!1}function ad(r){r.children.forEach(function(n){n.isLoaded?n.properties.state|=Oc:ad(n)})}var Oo,tT=[-1/0,-1/0,1/0,1/0],r$=.2,n$=5,i$=(Oo={},S(Oo,Ga.Realtime,JH),S(Oo,Ga.Overlap,t$),S(Oo,Ga.Replace,e$),Oo),a$=function(){};function Zh(r,n,t){var e=Math.floor((r+180)/360*Math.pow(2,t)),i=Math.floor((1-Math.log(Math.tan(n*Math.PI/180)+1/Math.cos(n*Math.PI/180))/Math.PI)/2*Math.pow(2,t));return[e,i]}function Ny(r,n,t){var e=r/Math.pow(2,t)*360-180,i=Math.PI-2*Math.PI*n/Math.pow(2,t),a=180/Math.PI*Math.atan(.5*(Math.exp(i)-Math.exp(-i)));return[e,a]}var o$=function(n,t,e){var i=Ny(n,t,e),a=kt(i,2),o=a[0],s=a[1],u=Ny(n+1,t+1,e),l=kt(u,2),c=l[0],f=l[1];return[o,f,c,s]};function s$(r){var n=r.zoom,t=r.latLonBounds,e=r.maxZoom,i=e===void 0?1/0:e,a=r.minZoom,o=a===void 0?0:a,s=r.zoomOffset,u=s===void 0?0:s,l=r.extent,c=l===void 0?tT:l,f=Math.ceil(n)+u;if(Number.isFinite(o)&&f<o)return[];Number.isFinite(i)&&f>i&&(f=i);for(var h=kt(t,4),v=h[0],p=h[1],d=h[2],g=h[3],y=[Math.max(v,c[0]),Math.max(p,c[1]),Math.min(d,c[2]),Math.min(g,c[3])],m=[],x=Zh(y[0],y[1],f),_=kt(x,2),E=_[0],b=_[1],M=Zh(y[2],y[3],f),T=kt(M,2),k=T[0],L=T[1],O=E;O<=k;O++)for(var D=L;D<=b;D++)m.push({x:O,y:D,z:f});var W=(k+E)/2,j=(b+L)/2,ot=function(X,K){return Math.abs(X-W)+Math.abs(K-j)};return m.sort(function(z,X){return ot(z.x,z.y)-ot(X.x,X.y)}),m}var u$=function(n,t,e){var i=Math.pow(2,e),a=i-1,o=i,s=n,u=t;return s<0?s=s+o:s>a&&(s=s%o),{warpX:s,warpY:u}};function l$(r){var n=c$();return function(){var e=B(r),i;if(n){var a=B(this).constructor;i=Reflect.construct(e,arguments,a)}else i=e.apply(this,arguments);return et(this,i)}}function c$(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var f$=function(r){tt(t,r);var n=l$(t);function t(e){var i;$(this,t),i=n.call(this),S(I(i),"tileSize",256),S(I(i),"isVisible",!1),S(I(i),"isCurrent",!1),S(I(i),"isVisibleChange",!1),S(I(i),"parentLayerIDList",[]),S(I(i),"layerIDList",[]),S(I(i),"loadedLayers",0),S(I(i),"parent",null),S(I(i),"children",[]),S(I(i),"loadedChilds",0),S(I(i),"data",null),S(I(i),"properties",{}),S(I(i),"loadDataId",0);var a=e.x,o=e.y,s=e.z,u=e.tileSize;return i.x=a,i.y=o,i.z=s,i.tileSize=u,i}return H(t,[{key:"isLoading",get:function(){return this.loadStatus===cr.Loading}},{key:"isLoaded",get:function(){return this.loadStatus===cr.Loaded}},{key:"isFailure",get:function(){return this.loadStatus===cr.Failure}},{key:"isCancelled",get:function(){return this.loadStatus===cr.Cancelled}},{key:"isDone",get:function(){return[cr.Loaded,cr.Cancelled,cr.Failure].includes(this.loadStatus)}},{key:"bounds",get:function(){return o$(this.x,this.y,this.z)}},{key:"bboxPolygon",get:function(){var i=kt(this.bounds,4),a=i[0],o=i[1],s=i[2],u=i[3],l=[(s-a)/2,(u-o)/2],c=UM(this.bounds,{properties:{key:this.key,bbox:this.bounds,center:l,meta:`
      `.concat(this.key,`
      `)}});return c}},{key:"key",get:function(){var i="".concat(this.x,",").concat(this.y,",").concat(this.z);return i}},{key:"layerLoad",value:function(){this.loadedLayers++,this.emit("layerLoaded")}},{key:"loadData",value:function(){var e=Mt(st.mark(function a(o){var s,u,l,c,f,h,v,p,d,g,y,m,x,_,E,b;return st.wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return s=o.getData,u=o.onLoad,l=o.onError,this.loadDataId++,c=this.loadDataId,this.isLoading&&this.abortLoad(),this.abortController=new AbortController,this.loadStatus=cr.Loading,f=null,T.prev=7,v=this.x,p=this.y,d=this.z,g=this.bounds,y=this.tileSize,m=u$(v,p,d),x=m.warpX,_=m.warpY,E=this.abortController.signal,b={x,y:_,z:d,bounds:g,tileSize:y,signal:E},T.next=14,s(b,this);case 14:f=T.sent,T.next=20;break;case 17:T.prev=17,T.t0=T.catch(7),h=T.t0;case 20:if(c===this.loadDataId){T.next=22;break}return T.abrupt("return");case 22:if(!(this.isCancelled&&!f)){T.next=24;break}return T.abrupt("return");case 24:if(!(h||!f)){T.next=28;break}return this.loadStatus=cr.Failure,l(h,this),T.abrupt("return");case 28:this.loadStatus=cr.Loaded,this.data=f,u(this);case 31:case"end":return T.stop()}},a,this,[[7,17]])}));function i(a){return e.apply(this,arguments)}return i}()},{key:"reloadData",value:function(i){this.isLoading&&this.abortLoad(),this.loadData(i)}},{key:"abortLoad",value:function(){this.isLoaded||this.isCancelled||(this.loadStatus=cr.Cancelled,this.abortController.abort(),this.xhrCancel&&this.xhrCancel())}}]),t}(dn.exports.EventEmitter),h$=function(n,t){var e=El(n),i=Lc(e,t),a=360*3-180,o=85.0511287798065,s=[Math.max(i[0][0],-a),Math.max(i[0][1],-o),Math.min(i[1][0],a),Math.min(i[1][1],o)];return s},v$=function(n,t){var e=El(n),i=El(t),a=X2(e,i);return a};function $n(r,n){var t=typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(!t){if(Array.isArray(r)||(t=p$(r))||n&&r&&typeof r.length=="number"){t&&(r=t);var e=0,i=function(){};return{s:i,n:function(){return e>=r.length?{done:!0}:{done:!1,value:r[e++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){t=t.call(r)},n:function(){var l=t.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(o)throw s}}}}function p$(r,n){if(!!r){if(typeof r=="string")return zy(r,n);var t=Object.prototype.toString.call(r).slice(8,-1);if(t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set")return Array.from(r);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return zy(r,n)}}function zy(r,n){(n==null||n>r.length)&&(n=r.length);for(var t=0,e=new Array(n);t<n;t++)e[t]=r[t];return e}function d$(r){var n=g$();return function(){var e=B(r),i;if(n){var a=B(this).constructor;i=Reflect.construct(e,arguments,a)}else i=e.apply(this,arguments);return et(this,i)}}function g$(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var y$=function(r){tt(t,r);var n=d$(t);function t(e){var i;return $(this,t),i=n.call(this),S(I(i),"currentTiles",[]),S(I(i),"cacheTiles",new Map),S(I(i),"throttleUpdate",Y.exports.throttle(function(a,o){i.update(a,o)},16)),S(I(i),"onTileLoad",function(a){i.emit("tile-loaded",a),i.updateTileVisible()}),S(I(i),"onTileError",function(a,o){i.emit("tile-error",{error:a,tile:o}),i.updateTileVisible()}),S(I(i),"onTileUnload",function(a){i.emit("tile-unload",a)}),i.options={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0,extent:tT,getTileData:a$,updateStrategy:Ga.Replace},i.updateOptions(e),i}return H(t,[{key:"isLoaded",get:function(){return this.currentTiles.every(function(i){return i.isDone})}},{key:"tiles",get:function(){var i=Array.from(this.cacheTiles.values()).sort(function(a,o){return a.z-o.z});return i}},{key:"updateOptions",value:function(i){var a=i.minZoom===void 0?this.options.minZoom:Math.ceil(i.minZoom),o=i.maxZoom===void 0?this.options.maxZoom:Math.floor(i.maxZoom);this.options=U(U(U({},this.options),i),{},{minZoom:a,maxZoom:o})}},{key:"update",value:function(i,a){var o=this,s=Math.ceil(i);if(!(this.lastViewStates&&this.lastViewStates.zoom===s&&v$(this.lastViewStates.latLonBoundsBuffer,a))){var u=h$(a,r$);this.lastViewStates={zoom:s,latLonBounds:a,latLonBoundsBuffer:u};var l=!1,c=this.getTileIndices(s,u);this.currentTiles=c.map(function(f){var h=f.x,v=f.y,p=f.z,d=o.getTile(h,v,p);if(d){var g,y,m=((g=d)===null||g===void 0?void 0:g.isFailure)||((y=d)===null||y===void 0?void 0:y.isCancelled);return m&&d.loadData({getData:o.options.getTileData,onLoad:o.onTileLoad,onError:o.onTileError}),d}return d=o.createTile(h,v,p),l=!0,d}),l&&(this.resizeCacheTiles(),this.rebuildTileTree()),this.updateTileVisible(),this.pruneRequests()}}},{key:"reloadAll",value:function(){var i=$n(this.cacheTiles),a;try{for(i.s();!(a=i.n()).done;){var o=kt(a.value,2),s=o[0],u=o[1];this.currentTiles.includes(u)||(this.cacheTiles.delete(s),this.onTileUnload(u)),this.onTileUnload(u),u.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError})}}catch(l){i.e(l)}finally{i.f()}}},{key:"pruneRequests",value:function(){var i=[],a=$n(this.cacheTiles.values()),o;try{for(a.s();!(o=a.n()).done;){var s=o.value;s.isLoading&&!s.isCurrent&&!s.isVisible&&i.push(s)}}catch(l){a.e(l)}finally{a.f()}for(;i.length>0;){var u=i.shift();u.abortLoad()}}},{key:"destroy",value:function(){var i=$n(this.cacheTiles.values()),a;try{for(i.s();!(a=i.n()).done;){var o=a.value;o.isLoading&&o.abortLoad()}}catch(s){i.e(s)}finally{i.f()}this.cacheTiles.clear(),this.currentTiles=[],this.removeAllListeners()}},{key:"updateTileVisible",value:function(){var i=this.options.updateStrategy,a=new Map,o=$n(this.cacheTiles.values()),s;try{for(o.s();!(s=o.n()).done;){var u=s.value;a.set(u.key,u.isVisible),u.isCurrent=!1,u.isVisible=!1}}catch(p){o.e(p)}finally{o.f()}var l=$n(this.currentTiles),c;try{for(l.s();!(c=l.n()).done;){var f=c.value;f.isCurrent=!0,f.isVisible=!0}}catch(p){l.e(p)}finally{l.f()}var h=Array.from(this.cacheTiles.values());typeof i=="function"?i(h):i$[i](h);var v=!1;Array.from(this.cacheTiles.values()).forEach(function(p){p.isVisible!==a.get(p.key)?(p.isVisibleChange=!0,v=!0):p.isVisibleChange=!1}),v&&this.emit("tile-update")}},{key:"getTileIndices",value:function(i,a){var o=this.options,s=o.tileSize,u=o.extent,l=o.zoomOffset,c=Math.floor(this.options.maxZoom),f=Math.ceil(this.options.minZoom),h=s$({maxZoom:c,minZoom:f,zoomOffset:l,tileSize:s,zoom:i,latLonBounds:a,extent:u});return h}},{key:"getTileId",value:function(i,a,o){var s="".concat(i,",").concat(a,",").concat(o);return s}},{key:"getTile",value:function(i,a,o){var s=this.getTileId(i,a,o),u=this.cacheTiles.get(s);return u}},{key:"createTile",value:function(i,a,o){var s=this.getTileId(i,a,o),u=new f$({x:i,y:a,z:o,tileSize:this.options.tileSize});return this.cacheTiles.set(s,u),u.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError}),u}},{key:"resizeCacheTiles",value:function(){var i=n$*this.currentTiles.length,a=this.cacheTiles.size>i;if(a){var o=$n(this.cacheTiles),s;try{for(o.s();!(s=o.n()).done;){var u=kt(s.value,2),l=u[0],c=u[1];if(!c.isVisible&&!this.currentTiles.includes(c)&&(this.cacheTiles.delete(l),this.onTileUnload(c)),this.cacheTiles.size<=i)break}}catch(f){o.e(f)}finally{o.f()}}}},{key:"rebuildTileTree",value:function(){var i=$n(this.cacheTiles.values()),a;try{for(i.s();!(a=i.n()).done;){var o=a.value;o.parent=null,o.children.length=0}}catch(f){i.e(f)}finally{i.f()}var s=$n(this.cacheTiles.values()),u;try{for(s.s();!(u=s.n()).done;){var l=u.value,c=this.getNearestAncestor(l.x,l.y,l.z);l.parent=c,c!=null&&c.children&&c.children.push(l)}}catch(f){s.e(f)}finally{s.f()}}},{key:"getNearestAncestor",value:function(i,a,o){for(;o>this.options.minZoom;){i=Math.floor(i/2),a=Math.floor(a/2),o=o-1;var s=this.getTile(i,a,o);if(s)return s}return null}}]),t}(Cv),Uy;(function(r){r["GAODE1.x"]="GAODE1.x",r["GAODE2.x"]="GAODE2.x",r.MAPBOX="MAPBOX",r.L7MAP="L7MAP",r.SIMPLE="SIMPLE",r.GLOBEL="GLOBEL"})(Uy||(Uy={}));function eT(r,n){var t=typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(!t){if(Array.isArray(r)||(t=m$(r))||n&&r&&typeof r.length=="number"){t&&(r=t);var e=0,i=function(){};return{s:i,n:function(){return e>=r.length?{done:!0}:{done:!1,value:r[e++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){t=t.call(r)},n:function(){var l=t.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(o)throw s}}}}function m$(r,n){if(!!r){if(typeof r=="string")return Hy(r,n);var t=Object.prototype.toString.call(r).slice(8,-1);if(t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set")return Array.from(r);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Hy(r,n)}}function Hy(r,n){(n==null||n>r.length)&&(n=r.length);for(var t=0,e=new Array(n);t<n;t++)e[t]=r[t];return e}var Ro=30;function x$(r){var n=r.characterSet,t=r.getFontWidth,e=r.fontHeight,i=r.buffer,a=r.maxCanvasWidth,o=r.mapping,s=o===void 0?{}:o,u=r.xOffset,l=u===void 0?0:u,c=r.yOffset,f=c===void 0?0:c,h=0,v=l;Array.from(n).forEach(function(d,g){if(!s[d]){var y=t(d,g);v+Ro>a&&(v=0,h++),s[d]={x:v,y:f+h*Ro,width:Ro,height:Ro,advance:y},v+=Ro}});var p=e+i*2;return{mapping:s,xOffset:v,yOffset:f+h*p,canvasHeight:rT(f+(h+1)*p)}}function _$(r,n,t){var e=0,i=0,a=0,o=[],s={},u=eT(r),l;try{for(u.s();!(l=u.n()).done;){var c=l.value;if(!s[c.id]){var f=c.size;e+f+n>t&&($y(s,o,i),e=0,i=a+i+n,a=0,o=[]),o.push({icon:c,xOffset:e}),e=e+f+n,a=Math.max(a,f)}}}catch(v){u.e(v)}finally{u.f()}o.length>0&&$y(s,o,i);var h=rT(a+i+n);return{mapping:s,canvasHeight:h}}function $y(r,n,t){var e=eT(n),i;try{for(e.s();!(i=e.n()).done;){var a=i.value,o=a.icon,s=a.xOffset;r[o.id]=U(U({},o),{},{x:s,y:t,image:o.image,width:o.width,height:o.height})}}catch(u){e.e(u)}finally{e.f()}}function rT(r){return Math.pow(2,Math.ceil(Math.log2(r)))}var Gy,Vy;function Wy(r,n){var t=typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(!t){if(Array.isArray(r)||(t=C$(r))||n&&r&&typeof r.length=="number"){t&&(r=t);var e=0,i=function(){};return{s:i,n:function(){return e>=r.length?{done:!0}:{done:!1,value:r[e++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){t=t.call(r)},n:function(){var l=t.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(o)throw s}}}}function C$(r,n){if(!!r){if(typeof r=="string")return jy(r,n);var t=Object.prototype.toString.call(r).slice(8,-1);if(t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set")return Array.from(r);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return jy(r,n)}}function jy(r,n){(n==null||n>r.length)&&(n=r.length);for(var t=0,e=new Array(n);t<n;t++)e[t]=r[t];return e}var E$=k$(),S$="sans-serif",b$="normal",A$=24,T$=3,M$=.25,w$=8,Xy=1024,L$=1,Yy=1,F$=3;function k$(){for(var r=[],n=32;n<128;n++)r.push(String.fromCharCode(n));return r}function Zy(r,n,t,e){r.font="".concat(e," ").concat(t,"px ").concat(n),r.fillStyle="black",r.textBaseline="middle"}function qy(r,n){for(var t=0;t<r.length;t++)n.data[4*t+3]=r[t]}var O$=(Gy=xt(),Gy(Vy=function(){function r(){$(this,r),S(this,"fontAtlas",void 0),S(this,"iconFontMap",void 0),S(this,"iconFontGlyphs",{}),S(this,"fontOptions",void 0),S(this,"key",void 0),S(this,"cache",new PH(F$))}return H(r,[{key:"scale",get:function(){return Yy}},{key:"canvas",get:function(){var t=this.cache.get(this.key);return t&&t.data}},{key:"mapping",get:function(){var t=this.cache.get(this.key);return t&&t.mapping}},{key:"init",value:function(){this.cache.clear(),this.fontOptions={fontFamily:S$,fontWeight:b$,characterSet:E$,fontSize:A$,buffer:T$,sdf:!0,cutoff:M$,radius:w$,iconfont:!1},this.key="",this.iconFontMap=new Map}},{key:"addIconGlyphs",value:function(t){var e=this;t.forEach(function(i){e.iconFontGlyphs[i.name]=i.unicode})}},{key:"addIconFont",value:function(t,e){this.iconFontMap.set(t,e)}},{key:"getIconFontKey",value:function(t){return this.iconFontMap.get(t)||t}},{key:"getGlyph",value:function(t){return this.iconFontGlyphs[t]?String.fromCharCode(parseInt(this.iconFontGlyphs[t],16)):""}},{key:"setFontOptions",value:function(t){this.fontOptions=U(U({},this.fontOptions),t),this.key=this.getKey();var e=this.getNewChars(this.key,this.fontOptions.characterSet),i=this.cache.get(this.key);if(!(i&&e.length===0)){var a=this.generateFontAtlas(this.key,e,i);this.fontAtlas=a,this.cache.set(this.key,a)}}},{key:"destroy",value:function(){this.cache.clear(),this.iconFontMap.clear()}},{key:"generateFontAtlas",value:function(t,e,i){var a=this.fontOptions,o=a.fontFamily,s=a.fontWeight,u=a.fontSize,l=a.buffer,c=a.sdf,f=a.radius,h=a.cutoff,v=a.iconfont,p=i&&i.data;p||(p=Wt.document.createElement("canvas"),p.width=Xy);var d=p.getContext("2d");Zy(d,o,u,s);var g=x$(U({getFontWidth:function(X){return d.measureText(X).width},fontHeight:u*Yy,buffer:l,characterSet:e,maxCanvasWidth:Xy},i&&{mapping:i.mapping,xOffset:i.xOffset,yOffset:i.yOffset})),y=g.mapping,m=g.canvasHeight,x=g.xOffset,_=g.yOffset,E=d.getImageData(0,0,p.width,p.height);if(p.height=m,d.putImageData(E,0,0),Zy(d,o,u,s),c){var b=new YM.exports(u,l,f,h,o,s),M=d.getImageData(0,0,b.size,b.size),T=Wy(e),k;try{for(T.s();!(k=T.n()).done;){var L=k.value;if(v){var O=String.fromCharCode(parseInt(L.replace("&#x","").replace(";",""),16)),D=b.draw(O);qy(D,M)}else qy(b.draw(L),M);d.putImageData(M,y[L].x,y[L].y)}}catch(z){T.e(z)}finally{T.f()}}else{var W=Wy(e),j;try{for(W.s();!(j=W.n()).done;){var ot=j.value;d.fillText(ot,y[ot].x,y[ot].y+u*L$)}}catch(z){W.e(z)}finally{W.f()}}return{xOffset:x,yOffset:_,mapping:y,data:p,width:p.width,height:p.height}}},{key:"getKey",value:function(){return"key"}},{key:"getNewChars",value:function(t,e){var i=this.cache.get(t);if(!i)return e;var a=[],o=i.mapping,s=new Set(Object.keys(o)),u=new Set(e);return u.forEach(function(l){s.has(l)||a.push(l)}),a}}]),r}())||Vy),Ky,Qy;function R$(r){var n=I$();return function(){var e=B(r),i;if(n){var a=B(this).constructor;i=Reflect.construct(e,arguments,a)}else i=e.apply(this,arguments);return et(this,i)}}function I$(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var D$=3,Jy=1024,Io=64,P$=(Ky=xt(),Ky(Qy=function(r){tt(t,r);var n=R$(t);function t(){var e;$(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return e=n.call.apply(n,[this].concat(a)),S(I(e),"canvasHeight",128),S(I(e),"texture",void 0),S(I(e),"canvas",void 0),S(I(e),"iconData",void 0),S(I(e),"iconMap",void 0),S(I(e),"ctx",void 0),S(I(e),"loadingImageCount",0),e}return H(t,[{key:"isLoading",value:function(){return this.loadingImageCount===0}},{key:"init",value:function(){this.iconData=[],this.iconMap={},this.canvas=Wt.document.createElement("canvas"),this.canvas.width=128,this.canvas.height=128,this.ctx=this.canvas.getContext("2d")}},{key:"addImage",value:function(i,a){var o=this,s=new Image;if(this.loadingImageCount++,this.hasImage(i))throw new Error("Image Id already exists");this.iconData.push({id:i,size:Io}),this.updateIconMap(),this.loadImage(a).then(function(u){s=u;var l=o.iconData.find(function(c){return c.id===i});l&&(l.image=s,l.width=s.width,l.height=s.height),o.update()})}},{key:"addImageMini",value:function(i,a,o){var s=this,u=o.getSceneConfig().canvas,l=u.createImage();if(this.loadingImageCount++,this.hasImage(i))throw new Error("Image Id already exists");this.iconData.push({id:i,size:Io}),this.updateIconMap(),this.loadImageMini(a,u).then(function(c){l=c;var f=s.iconData.find(function(h){return h.id===i});f&&(f.image=l,f.width=l.width,f.height=l.height),s.update()})}},{key:"getTexture",value:function(){return this.texture}},{key:"getIconMap",value:function(){return this.iconMap}},{key:"getCanvas",value:function(){return this.canvas}},{key:"hasImage",value:function(i){return this.iconMap.hasOwnProperty(i)}},{key:"removeImage",value:function(i){this.hasImage(i)&&(this.iconData=this.iconData.filter(function(a){return a.id!==i}),delete this.iconMap[i],this.update())}},{key:"destroy",value:function(){this.removeAllListeners("imageUpdate"),this.iconData=[],this.iconMap={}}},{key:"loadImage",value:function(i){return new Promise(function(a,o){if(i instanceof HTMLImageElement){a(i);return}var s=new Image;s.crossOrigin="anonymous",s.onload=function(){a(s)},s.onerror=function(){o(new Error("Could not load image at "+i))},s.src=i instanceof File?URL.createObjectURL(i):i})}},{key:"update",value:function(){this.updateIconMap(),this.updateIconAtlas(),this.loadingImageCount--,this.loadingImageCount===0&&this.emit("imageUpdate")}},{key:"updateIconAtlas",value:function(){var i=this;this.canvas.width=Jy,this.canvas.height=this.canvasHeight,Object.keys(this.iconMap).forEach(function(a){var o=i.iconMap[a],s=o.x,u=o.y,l=o.image,c=o.width,f=c===void 0?64:c,h=o.height,v=h===void 0?64:h,p=Math.max(f,v),d=p/Io,g=v/d,y=f/d;l&&i.ctx.drawImage(l,s+(Io-y)/2,u+(Io-g)/2,y,g)})}},{key:"updateIconMap",value:function(){var i=_$(this.iconData,D$,Jy),a=i.mapping,o=i.canvasHeight;this.iconMap=a,this.canvasHeight=o}},{key:"loadImageMini",value:function(i,a){return new Promise(function(o,s){var u=a.createImage();u.crossOrigin="anonymous",u.onload=function(){o(u)},u.onerror=function(){s(new Error("Could not load image at "+i))},u.src=i})}}]),t}(dn.exports.EventEmitter))||Qy),tm,em,B$=(tm=xt(),tm(em=function(){function r(){$(this,r),S(this,"viewport",void 0),S(this,"overridedViewProjectionMatrix",void 0),S(this,"jitteredViewProjectionMatrix",void 0),S(this,"jitteredProjectionMatrix",void 0),S(this,"viewMatrixInverse",void 0),S(this,"cameraPosition",void 0)}return H(r,[{key:"init",value:function(){}},{key:"update",value:function(t){this.viewport=t,this.viewMatrixInverse=fr(),rM(this.viewMatrixInverse,t.getViewMatrix()),this.cameraPosition=[this.viewMatrixInverse[12],this.viewMatrixInverse[13],this.viewMatrixInverse[14]]}},{key:"getProjectionMatrix",value:function(){return this.jitteredProjectionMatrix||this.viewport.getProjectionMatrix()}},{key:"getModelMatrix",value:function(){return this.viewport.getModelMatrix()}},{key:"getViewMatrix",value:function(){return this.viewport.getViewMatrix()}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.getViewMatrixUncentered()}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.getViewProjectionMatrixUncentered()}},{key:"getViewProjectionMatrix",value:function(){return this.overridedViewProjectionMatrix||this.jitteredViewProjectionMatrix||this.viewport.getViewProjectionMatrix()}},{key:"getZoom",value:function(){return this.viewport.getZoom()}},{key:"getZoomScale",value:function(){return this.viewport.getZoomScale()}},{key:"getCenter",value:function(){var t=this.viewport.getCenter(),e=kt(t,2),i=e[0],a=e[1];return[i,a]}},{key:"getFocalDistance",value:function(){return this.viewport.getFocalDistance()}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"projectFlat",value:function(t,e){return this.viewport.projectFlat(t,e)}},{key:"setViewProjectionMatrix",value:function(t){this.overridedViewProjectionMatrix=t}},{key:"jitterProjectionMatrix",value:function(t,e){var i=nM(fr(),[t,e,0]);this.jitteredProjectionMatrix=Xi(fr(),i,this.viewport.getProjectionMatrix()),this.jitteredViewProjectionMatrix=Xi(fr(),this.jitteredProjectionMatrix,this.viewport.getViewMatrix())}},{key:"clearJitterProjectionMatrix",value:function(){this.jitteredProjectionMatrix=void 0,this.jitteredViewProjectionMatrix=void 0}}]),r}())||em),rm,nm;function N$(r,n){var t=typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(!t){if(Array.isArray(r)||(t=z$(r))||n&&r&&typeof r.length=="number"){t&&(r=t);var e=0,i=function(){};return{s:i,n:function(){return e>=r.length?{done:!0}:{done:!1,value:r[e++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){t=t.call(r)},n:function(){var l=t.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(o)throw s}}}}function z$(r,n){if(!!r){if(typeof r=="string")return im(r,n);var t=Object.prototype.toString.call(r).slice(8,-1);if(t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set")return Array.from(r);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return im(r,n)}}function im(r,n){(n==null||n>r.length)&&(n=r.length);for(var t=0,e=new Array(n);t<n;t++)e[t]=r[t];return e}var U$=(rm=xt(),rm(nm=function(){function r(){$(this,r),S(this,"container",void 0),S(this,"controlCorners",void 0),S(this,"controlContainer",void 0),S(this,"scene",void 0),S(this,"mapsService",void 0),S(this,"controls",[]),S(this,"unAddControls",[])}return H(r,[{key:"init",value:function(t,e){this.container=t.container,this.scene=e,this.mapsService=e.get(P.IMapService),this.initControlPos()}},{key:"addControl",value:function(t,e){var i=e.get(P.IMapService);i.map?(t.addTo(this.scene),this.controls.push(t)):this.unAddControls.push(t)}},{key:"getControlByName",value:function(t){return this.controls.find(function(e){return e.controlOption.name===t})}},{key:"removeControl",value:function(t){var e=this.controls.indexOf(t);return e>-1&&this.controls.splice(e,1),t.remove(),this}},{key:"addControls",value:function(){var t=this;this.unAddControls.forEach(function(e){e.addTo(t.scene),t.controls.push(e)}),this.unAddControls=[]}},{key:"destroy",value:function(){var t=N$(this.controls),e;try{for(t.s();!(e=t.n()).done;){var i=e.value;i.remove()}}catch(a){t.e(a)}finally{t.f()}this.controls=[],this.clearControlPos()}},{key:"initControlPos",value:function(){var t=this.controlCorners={},e="l7-",i=this.controlContainer=ye("div",e+"control-container",this.container);function a(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],s=o.map(function(u){return e+u}).join(" ");t[o.join("")]=ye("div",s,i)}a(["top","left"]),a(["top","right"]),a(["bottom","left"]),a(["bottom","right"]),a(["top","center"]),a(["right","center"]),a(["left","center"]),a(["bottom","center"])}},{key:"clearControlPos",value:function(){for(var t in this.controlCorners)this.controlCorners[t]&&Ms(this.controlCorners[t]);this.controlContainer&&Ms(this.controlContainer)}}]),r}())||nm),am,om,H$=(am=xt(),am(om=function(){function r(){$(this,r),S(this,"container",void 0),S(this,"scene",void 0),S(this,"mapsService",void 0),S(this,"markers",[]),S(this,"markerLayers",[]),S(this,"unAddMarkers",[]),S(this,"unAddMarkerLayers",[])}return H(r,[{key:"addMarkerLayer",value:function(t){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markerLayers.push(t),t.addTo(this.scene)):this.unAddMarkerLayers.push(t)}},{key:"removeMarkerLayer",value:function(t){t.destroy(),this.markerLayers.indexOf(t);var e=this.markerLayers.indexOf(t);e>-1&&this.markerLayers.splice(e,1)}},{key:"addMarker",value:function(t){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markers.push(t),t.addTo(this.scene)):this.unAddMarkers.push(t)}},{key:"addMarkers",value:function(){var t=this;this.unAddMarkers.forEach(function(e){e.addTo(t.scene),t.markers.push(e)}),this.unAddMarkers=[]}},{key:"addMarkerLayers",value:function(){var t=this;this.unAddMarkerLayers.forEach(function(e){t.markerLayers.push(e),e.addTo(t.scene)}),this.unAddMarkers=[]}},{key:"removeMarker",value:function(t){t.remove(),this.markers.indexOf(t);var e=this.markers.indexOf(t);e>-1&&this.markers.splice(e,1)}},{key:"removeAllMarkers",value:function(){this.destroy()}},{key:"init",value:function(t){this.scene=t,this.mapsService=t.get(P.IMapService)}},{key:"destroy",value:function(){this.markers.forEach(function(t){t.remove()}),this.markers=[],this.markerLayers.forEach(function(t){t.destroy()}),this.markerLayers=[]}},{key:"removeMakerLayerMarker",value:function(t){t.destroy()}}]),r}())||om),sm,um,$$=(sm=xt(),sm(um=function(){function r(){$(this,r),S(this,"scene",void 0),S(this,"popup",void 0),S(this,"mapsService",void 0),S(this,"unAddPopup",void 0)}return H(r,[{key:"removePopup",value:function(t){t.remove()}},{key:"destroy",value:function(){this.popup.remove()}},{key:"addPopup",value:function(t){this.popup&&this.popup.remove(),this.mapsService.map&&this.mapsService.getMarkerContainer()?(t.addTo(this.scene),this.popup=t):this.unAddPopup=t}},{key:"initPopup",value:function(){this.unAddPopup&&(this.addPopup(this.unAddPopup),this.unAddPopup=null)}},{key:"init",value:function(t){this.scene=t,this.mapsService=t.get(P.IMapService)}}]),r}())||um),G$={MapToken:"\u60A8\u6B63\u5728\u4F7F\u7528 Demo\u6D4B\u8BD5\u5730\u56FEtoken\uFF0C\u5982\u679C\u751F\u4EA7\u73AF\u5883\u4E2D\u4F7F\u7528\u53BB\u5BF9\u5E94\u5730\u56FE\u8BF7\u6CE8\u518CToken",SDK:"\u8BF7\u786E\u8BA4\u5F15\u5165\u4E86mapbox-gl api\u4E14\u5728L7\u4E4B\u524D\u5F15\u5165"},lm,cm,V$={id:"map",logoPosition:"bottomleft",logoVisible:!0,antialias:!0,preserveDrawingBuffer:!1,pickBufferScale:1,fitBoundsOptions:{animate:!1}},W$={colors:["rgb(103,0,31)","rgb(178,24,43)","rgb(214,96,77)","rgb(244,165,130)","rgb(253,219,199)","rgb(247,247,247)","rgb(209,229,240)","rgb(146,197,222)","rgb(67,147,195)","rgb(33,102,172)","rgb(5,48,97)"],size:10,shape:"circle",scales:{},shape2d:["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],shape3d:["cylinder","triangleColumn","hexagonColumn","squareColumn"],minZoom:-1,maxZoom:24,visible:!0,autoFit:!1,pickingBuffer:0,enablePropagation:!1,zIndex:0,blend:"normal",pickedFeatureID:-1,enableMultiPassRenderer:!1,enablePicking:!0,active:!1,activeColor:"#2f54eb",enableHighlight:!1,enableSelect:!1,highlightColor:"#2f54eb",activeMix:0,selectColor:"blue",selectMix:0,enableTAA:!1,jitterScale:1,enableLighting:!1,animateOption:{enable:!1,interval:.2,duration:4,trailLength:.15},forward:!0},j$=(lm=xt(),lm(cm=function(){function r(){$(this,r),S(this,"sceneConfigCache",{}),S(this,"layerConfigCache",{})}return H(r,[{key:"getSceneConfig",value:function(t){return this.sceneConfigCache[t]}},{key:"getSceneWarninfo",value:function(t){return G$[t]}},{key:"setSceneConfig",value:function(t,e){this.sceneConfigCache[t]=U(U({},V$),e)}},{key:"getLayerConfig",value:function(t){return this.layerConfigCache[t]}},{key:"setLayerConfig",value:function(t,e,i){this.layerConfigCache[e]=U({},Y.exports.merge({},this.sceneConfigCache[t],W$,i))}},{key:"clean",value:function(){this.sceneConfigCache={},this.layerConfigCache={}}}]),r}())||cm),Tf=Math.PI/180,X$=512,fm=4003e4;function hm(r){var n=r.latitude,t=n===void 0?0:n,e=r.zoom,i=e===void 0?0:e,a=r.scale,o=r.highPrecision,s=o===void 0?!1:o,u=r.flipY,l=u===void 0?!1:u;a=a!==void 0?a:Math.pow(2,i);var c={},f=X$*a,h=Math.cos(t*Tf),v=f/360,p=v/h,d=f/fm/h;if(c.pixelsPerMeter=[d,-d,d],c.metersPerPixel=[1/d,-1/d,1/d],c.pixelsPerDegree=[v,-p,d],c.degreesPerPixel=[1/v,-1/p,1/d],s){var g=Tf*Math.tan(t*Tf)/h,y=v*g/2,m=f/fm*g,x=m/p*d;c.pixelsPerDegree2=[0,-y,m],c.pixelsPerMeter2=[x,0,x],l&&(c.pixelsPerDegree2[1]=-c.pixelsPerDegree2[1],c.pixelsPerMeter2[1]=-c.pixelsPerMeter2[1])}return l&&(c.pixelsPerMeter[1]=-c.pixelsPerMeter[1],c.metersPerPixel[1]=-c.metersPerPixel[1],c.pixelsPerDegree[1]=-c.pixelsPerDegree[1],c.degreesPerPixel[1]=-c.degreesPerPixel[1]),c}var Fr;(function(r){r[r.LNGLAT=1]="LNGLAT",r[r.LNGLAT_OFFSET=2]="LNGLAT_OFFSET",r[r.VECTOR_TILE=3]="VECTOR_TILE",r[r.IDENTITY=4]="IDENTITY",r[r.P20=5]="P20",r[r.P20_OFFSET=6]="P20_OFFSET",r[r.METER_OFFSET=7]="METER_OFFSET",r[r.P20_2=8]="P20_2"})(Fr||(Fr={}));var wi={CoordinateSystem:"u_CoordinateSystem",ViewportCenter:"u_ViewportCenter",ViewportCenterProjection:"u_ViewportCenterProjection",PixelsPerDegree:"u_PixelsPerDegree",PixelsPerDegree2:"u_PixelsPerDegree2",PixelsPerMeter:"u_PixelsPerMeter",Mvp:"u_Mvp"},vm,pm,dm,Mf,gm,Y$=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],Z$=(vm=xt(),pm=At(P.ICameraService),vm(dm=(Mf=function(){function r(){$(this,r),S(this,"needRefresh",!0),St(this,"cameraService",gm,this),S(this,"coordinateSystem",void 0),S(this,"viewportCenter",void 0),S(this,"viewportCenterProjection",void 0),S(this,"pixelsPerDegree",void 0),S(this,"pixelsPerDegree2",void 0),S(this,"pixelsPerMeter",void 0)}return H(r,[{key:"refresh",value:function(t){var e=this.cameraService.getZoom(),i=this.cameraService.getZoomScale(),a=t||this.cameraService.getCenter(),o=hm({latitude:a[1],zoom:e}),s=o.pixelsPerMeter,u=o.pixelsPerDegree;this.viewportCenter=a,this.viewportCenterProjection=[0,0,0,0],this.pixelsPerMeter=s,this.pixelsPerDegree=u,this.pixelsPerDegree2=[0,0,0],this.coordinateSystem===Fr.LNGLAT||this.coordinateSystem===Fr.P20?this.cameraService.setViewProjectionMatrix(void 0):this.coordinateSystem===Fr.LNGLAT_OFFSET?this.calculateLnglatOffset(a,e):this.coordinateSystem===Fr.P20_OFFSET&&this.calculateLnglatOffset(a,e,i,!0),this.needRefresh=!1}},{key:"getCoordinateSystem",value:function(){return this.coordinateSystem}},{key:"setCoordinateSystem",value:function(t){this.coordinateSystem=t}},{key:"getViewportCenter",value:function(){return this.viewportCenter}},{key:"getViewportCenterProjection",value:function(){return this.viewportCenterProjection}},{key:"getPixelsPerDegree",value:function(){return this.pixelsPerDegree}},{key:"getPixelsPerDegree2",value:function(){return this.pixelsPerDegree2}},{key:"getPixelsPerMeter",value:function(){return this.pixelsPerMeter}},{key:"calculateLnglatOffset",value:function(t,e,i,a){var o=hm({latitude:t[1],zoom:e,scale:i,flipY:a,highPrecision:!0}),s=o.pixelsPerMeter,u=o.pixelsPerDegree,l=o.pixelsPerDegree2,c=this.cameraService.getViewMatrix(),f=this.cameraService.getProjectionMatrix(),h=Xi([],f,c),v=this.cameraService.projectFlat([Math.fround(t[0]),Math.fround(t[1])],Math.pow(2,e));this.viewportCenterProjection=XC([],[v[0],v[1],0,1],h),c=this.cameraService.getViewMatrixUncentered()||c,h=Xi([],f,c),h=Xi([],h,Y$),this.cameraService.setViewProjectionMatrix(h),this.pixelsPerMeter=s,this.pixelsPerDegree=u,this.pixelsPerDegree2=l}}]),r}(),gm=Ct(Mf.prototype,"cameraService",[pm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mf))||dm),Re;(function(r){r.Hover="hover",r.Click="click",r.Select="select",r.Active="active",r.Drag="drag"})(Re||(Re={}));var ym,mm,xm,wf,_m;function q$(r){var n=K$();return function(){var e=B(r),i;if(n){var a=B(this).constructor;i=Reflect.construct(e,arguments,a)}else i=e.apply(this,arguments);return et(this,i)}}function K$(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Q$={panstart:"dragstart",panmove:"dragging",panend:"dragend",pancancel:"dragcancel"},J$=(ym=xt(),mm=At(P.IMapService),ym(xm=(wf=function(r){tt(t,r);var n=q$(t);function t(){var e;$(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return e=n.call.apply(n,[this].concat(a)),S(I(e),"indragging",!1),St(I(e),"mapService",_m,I(e)),S(I(e),"hammertime",void 0),S(I(e),"lastClickTime",0),S(I(e),"lastClickXY",[-1,-1]),S(I(e),"clickTimer",void 0),S(I(e),"$containter",void 0),S(I(e),"onDrag",function(s){var u=e.interactionEvent(s);u.type=Q$[u.type],u.type==="dragging"?e.indragging=!0:e.indragging=!1,e.emit(Re.Drag,u)}),S(I(e),"onHammer",function(s){s.srcEvent.stopPropagation();var u=e.interactionEvent(s);e.emit(Re.Hover,u)}),S(I(e),"onTouch",function(s){var u=s.touches[0];e.onHover({x:u.pageX,y:u.pageY,type:"touch"})}),S(I(e),"onHover",function(s){var u=s.clientX,l=s.clientY,c=u,f=l,h=s.type,v=e.mapService.getMapContainer();if(v)if(hr)c=c-v.left-0,f=f-v.top-0;else{var p=v.getBoundingClientRect(),d=p.top,g=p.left;c=c-g-v.clientLeft,f=f-d-v.clientTop}var y=e.mapService.containerToLngLat([c,f]);if(h==="click"){if(!hr&&"ontouchstart"in document.documentElement)return;e.isDoubleTap(c,f,y);return}if(h==="touch"){e.isDoubleTap(c,f,y);return}h!=="click"&&h!=="dblclick"&&e.emit(Re.Hover,{x:c,y:f,lngLat:y,type:h,target:s})}),e}return H(t,[{key:"init",value:function(){this.addEventListenerOnMap(),this.$containter=this.mapService.getMapContainer()}},{key:"destroy",value:function(){this.hammertime&&this.hammertime.destroy(),this.removeEventListenerOnMap(),this.off(Re.Hover)}},{key:"triggerHover",value:function(i){var a=i.x,o=i.y;this.emit(Re.Hover,{x:a,y:o})}},{key:"triggerSelect",value:function(i){this.emit(Re.Select,{featureId:i})}},{key:"triggerActive",value:function(i){this.emit(Re.Active,{featureId:i})}},{key:"handleMiniEvent",value:function(i){this.onHover({clientX:i.touches[0].pageX,clientY:i.touches[0].pageY,type:"touch"})}},{key:"addEventListenerOnMap",value:function(){var i=this.mapService.getMapContainer();if(i)if(hr)Wt.document.addEventListener("touchstart",this.handleMiniEvent.bind(this));else{var a=new Co.Manager(i);a.add(new Co.Tap({event:"dblclick",taps:2})),a.add(new Co.Tap({event:"click"})),a.add(new Co.Pan({threshold:0,pointers:0})),a.add(new Co.Press({})),a.on("dblclick click",this.onHammer),a.on("panstart panmove panend pancancel",this.onDrag),i.addEventListener("mousemove",this.onHover),i.addEventListener("mousedown",this.onHover,!0),i.addEventListener("mouseup",this.onHover),i.addEventListener("contextmenu",this.onHover),this.hammertime=a}}},{key:"removeEventListenerOnMap",value:function(){if(hr)Wt.document.removeEventListener("touchstart",this.handleMiniEvent.bind(this));else{var i=this.mapService.getMapContainer();i&&(i.removeEventListener("mousemove",this.onHover),this.hammertime.off("dblclick click",this.onHammer),this.hammertime.off("panstart panmove panend pancancel",this.onDrag),i.removeEventListener("mousedown",this.onHover),i.removeEventListener("mouseup",this.onHover),i.removeEventListener("contextmenu",this.onHover))}}},{key:"interactionEvent",value:function(i){var a=i.type,o=i.pointerType,s,u;o==="touch"?(u=Math.floor(i.pointers[0].clientY),s=Math.floor(i.pointers[0].clientX)):(u=Math.floor(i.srcEvent.y),s=Math.floor(i.srcEvent.x));var l=this.mapService.getMapContainer();if(l){var c=l.getBoundingClientRect(),f=c.top,h=c.left;s-=h,u-=f}var v=this.mapService.containerToLngLat([s,u]);return{x:s,y:u,lngLat:v,type:a,target:i.srcEvent}}},{key:"isDoubleTap",value:function(i,a,o){var s=this,u=new Date().getTime(),l="click";u-this.lastClickTime<400&&Math.abs(this.lastClickXY[0]-i)<10&&Math.abs(this.lastClickXY[1]-a)<10?(this.lastClickTime=0,this.lastClickXY=[-1,-1],this.clickTimer&&clearTimeout(this.clickTimer),l="dblclick",this.emit(Re.Hover,{x:i,y:a,lngLat:o,type:l})):(this.lastClickTime=u,this.lastClickXY=[i,a],this.clickTimer=setTimeout(function(){l="click",s.emit(Re.Hover,{x:i,y:a,lngLat:o,type:l})},400))}}]),t}(Cv),_m=Ct(wf.prototype,"mapService",[mm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wf))||xm),tG=0;function eG(r){if(hr)return null;var n=r;if(typeof r=="string"&&(n=document.getElementById(r)),n){var t=document.createElement("div");return t.style.cssText+=`
      position: absolute;
      z-index:2;
      height: 100%;
      width: 100%;
      pointer-events: none;
    `,t.id="l7-scene-".concat(tG++),t.classList.add("l7-scene"),n.appendChild(t),t}return null}function rG(r){var n,t,e=!0;return r==null||(n=r.target)===null||n===void 0||(t=n.path)===null||t===void 0||t.map(function(i){if(i!=null&&i.classList){var a;i==null||(a=i.classList)===null||a===void 0||a.forEach(function(o){(o==="l7-marker"||o==="l7-popup")&&(e=!1)})}}),e}var A;(function(r){r[r.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",r[r.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",r[r.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",r[r.POINTS=0]="POINTS",r[r.LINES=1]="LINES",r[r.LINE_LOOP=2]="LINE_LOOP",r[r.LINE_STRIP=3]="LINE_STRIP",r[r.TRIANGLES=4]="TRIANGLES",r[r.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",r[r.TRIANGLE_FAN=6]="TRIANGLE_FAN",r[r.ZERO=0]="ZERO",r[r.ONE=1]="ONE",r[r.SRC_COLOR=768]="SRC_COLOR",r[r.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",r[r.SRC_ALPHA=770]="SRC_ALPHA",r[r.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",r[r.DST_ALPHA=772]="DST_ALPHA",r[r.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",r[r.DST_COLOR=774]="DST_COLOR",r[r.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",r[r.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",r[r.FUNC_ADD=32774]="FUNC_ADD",r[r.BLEND_EQUATION=32777]="BLEND_EQUATION",r[r.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",r[r.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",r[r.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",r[r.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",r[r.MAX_EXT=32776]="MAX_EXT",r[r.MIN_EXT=32775]="MIN_EXT",r[r.BLEND_DST_RGB=32968]="BLEND_DST_RGB",r[r.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",r[r.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",r[r.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",r[r.CONSTANT_COLOR=32769]="CONSTANT_COLOR",r[r.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",r[r.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",r[r.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",r[r.BLEND_COLOR=32773]="BLEND_COLOR",r[r.ARRAY_BUFFER=34962]="ARRAY_BUFFER",r[r.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",r[r.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",r[r.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",r[r.STREAM_DRAW=35040]="STREAM_DRAW",r[r.STATIC_DRAW=35044]="STATIC_DRAW",r[r.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",r[r.BUFFER_SIZE=34660]="BUFFER_SIZE",r[r.BUFFER_USAGE=34661]="BUFFER_USAGE",r[r.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",r[r.FRONT=1028]="FRONT",r[r.BACK=1029]="BACK",r[r.FRONT_AND_BACK=1032]="FRONT_AND_BACK",r[r.CULL_FACE=2884]="CULL_FACE",r[r.BLEND=3042]="BLEND",r[r.DITHER=3024]="DITHER",r[r.STENCIL_TEST=2960]="STENCIL_TEST",r[r.DEPTH_TEST=2929]="DEPTH_TEST",r[r.SCISSOR_TEST=3089]="SCISSOR_TEST",r[r.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",r[r.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",r[r.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",r[r.NO_ERROR=0]="NO_ERROR",r[r.INVALID_ENUM=1280]="INVALID_ENUM",r[r.INVALID_VALUE=1281]="INVALID_VALUE",r[r.INVALID_OPERATION=1282]="INVALID_OPERATION",r[r.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",r[r.CW=2304]="CW",r[r.CCW=2305]="CCW",r[r.LINE_WIDTH=2849]="LINE_WIDTH",r[r.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",r[r.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",r[r.CULL_FACE_MODE=2885]="CULL_FACE_MODE",r[r.FRONT_FACE=2886]="FRONT_FACE",r[r.DEPTH_RANGE=2928]="DEPTH_RANGE",r[r.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",r[r.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",r[r.DEPTH_FUNC=2932]="DEPTH_FUNC",r[r.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",r[r.STENCIL_FUNC=2962]="STENCIL_FUNC",r[r.STENCIL_FAIL=2964]="STENCIL_FAIL",r[r.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",r[r.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",r[r.STENCIL_REF=2967]="STENCIL_REF",r[r.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",r[r.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",r[r.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",r[r.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",r[r.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",r[r.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",r[r.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",r[r.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",r[r.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",r[r.VIEWPORT=2978]="VIEWPORT",r[r.SCISSOR_BOX=3088]="SCISSOR_BOX",r[r.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",r[r.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",r[r.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",r[r.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",r[r.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",r[r.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",r[r.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",r[r.RED_BITS=3410]="RED_BITS",r[r.GREEN_BITS=3411]="GREEN_BITS",r[r.BLUE_BITS=3412]="BLUE_BITS",r[r.ALPHA_BITS=3413]="ALPHA_BITS",r[r.DEPTH_BITS=3414]="DEPTH_BITS",r[r.STENCIL_BITS=3415]="STENCIL_BITS",r[r.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",r[r.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",r[r.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",r[r.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",r[r.SAMPLES=32937]="SAMPLES",r[r.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",r[r.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",r[r.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",r[r.DONT_CARE=4352]="DONT_CARE",r[r.FASTEST=4353]="FASTEST",r[r.NICEST=4354]="NICEST",r[r.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",r[r.BYTE=5120]="BYTE",r[r.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",r[r.SHORT=5122]="SHORT",r[r.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",r[r.INT=5124]="INT",r[r.UNSIGNED_INT=5125]="UNSIGNED_INT",r[r.FLOAT=5126]="FLOAT",r[r.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",r[r.ALPHA=6406]="ALPHA",r[r.RGB=6407]="RGB",r[r.RGBA=6408]="RGBA",r[r.LUMINANCE=6409]="LUMINANCE",r[r.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",r[r.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",r[r.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",r[r.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",r[r.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",r[r.VERTEX_SHADER=35633]="VERTEX_SHADER",r[r.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",r[r.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",r[r.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",r[r.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",r[r.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",r[r.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",r[r.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",r[r.SHADER_TYPE=35663]="SHADER_TYPE",r[r.DELETE_STATUS=35712]="DELETE_STATUS",r[r.LINK_STATUS=35714]="LINK_STATUS",r[r.VALIDATE_STATUS=35715]="VALIDATE_STATUS",r[r.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",r[r.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",r[r.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",r[r.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",r[r.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",r[r.NEVER=512]="NEVER",r[r.LESS=513]="LESS",r[r.EQUAL=514]="EQUAL",r[r.LEQUAL=515]="LEQUAL",r[r.GREATER=516]="GREATER",r[r.NOTEQUAL=517]="NOTEQUAL",r[r.GEQUAL=518]="GEQUAL",r[r.ALWAYS=519]="ALWAYS",r[r.KEEP=7680]="KEEP",r[r.REPLACE=7681]="REPLACE",r[r.INCR=7682]="INCR",r[r.DECR=7683]="DECR",r[r.INVERT=5386]="INVERT",r[r.INCR_WRAP=34055]="INCR_WRAP",r[r.DECR_WRAP=34056]="DECR_WRAP",r[r.VENDOR=7936]="VENDOR",r[r.RENDERER=7937]="RENDERER",r[r.VERSION=7938]="VERSION",r[r.NEAREST=9728]="NEAREST",r[r.LINEAR=9729]="LINEAR",r[r.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",r[r.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",r[r.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",r[r.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",r[r.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",r[r.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",r[r.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",r[r.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",r[r.TEXTURE_2D=3553]="TEXTURE_2D",r[r.TEXTURE=5890]="TEXTURE",r[r.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",r[r.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",r[r.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",r[r.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",r[r.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",r[r.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",r[r.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",r[r.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",r[r.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",r[r.TEXTURE0=33984]="TEXTURE0",r[r.TEXTURE1=33985]="TEXTURE1",r[r.TEXTURE2=33986]="TEXTURE2",r[r.TEXTURE3=33987]="TEXTURE3",r[r.TEXTURE4=33988]="TEXTURE4",r[r.TEXTURE5=33989]="TEXTURE5",r[r.TEXTURE6=33990]="TEXTURE6",r[r.TEXTURE7=33991]="TEXTURE7",r[r.TEXTURE8=33992]="TEXTURE8",r[r.TEXTURE9=33993]="TEXTURE9",r[r.TEXTURE10=33994]="TEXTURE10",r[r.TEXTURE11=33995]="TEXTURE11",r[r.TEXTURE12=33996]="TEXTURE12",r[r.TEXTURE13=33997]="TEXTURE13",r[r.TEXTURE14=33998]="TEXTURE14",r[r.TEXTURE15=33999]="TEXTURE15",r[r.TEXTURE16=34e3]="TEXTURE16",r[r.TEXTURE17=34001]="TEXTURE17",r[r.TEXTURE18=34002]="TEXTURE18",r[r.TEXTURE19=34003]="TEXTURE19",r[r.TEXTURE20=34004]="TEXTURE20",r[r.TEXTURE21=34005]="TEXTURE21",r[r.TEXTURE22=34006]="TEXTURE22",r[r.TEXTURE23=34007]="TEXTURE23",r[r.TEXTURE24=34008]="TEXTURE24",r[r.TEXTURE25=34009]="TEXTURE25",r[r.TEXTURE26=34010]="TEXTURE26",r[r.TEXTURE27=34011]="TEXTURE27",r[r.TEXTURE28=34012]="TEXTURE28",r[r.TEXTURE29=34013]="TEXTURE29",r[r.TEXTURE30=34014]="TEXTURE30",r[r.TEXTURE31=34015]="TEXTURE31",r[r.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",r[r.REPEAT=10497]="REPEAT",r[r.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",r[r.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",r[r.FLOAT_VEC2=35664]="FLOAT_VEC2",r[r.FLOAT_VEC3=35665]="FLOAT_VEC3",r[r.FLOAT_VEC4=35666]="FLOAT_VEC4",r[r.INT_VEC2=35667]="INT_VEC2",r[r.INT_VEC3=35668]="INT_VEC3",r[r.INT_VEC4=35669]="INT_VEC4",r[r.BOOL=35670]="BOOL",r[r.BOOL_VEC2=35671]="BOOL_VEC2",r[r.BOOL_VEC3=35672]="BOOL_VEC3",r[r.BOOL_VEC4=35673]="BOOL_VEC4",r[r.FLOAT_MAT2=35674]="FLOAT_MAT2",r[r.FLOAT_MAT3=35675]="FLOAT_MAT3",r[r.FLOAT_MAT4=35676]="FLOAT_MAT4",r[r.SAMPLER_2D=35678]="SAMPLER_2D",r[r.SAMPLER_CUBE=35680]="SAMPLER_CUBE",r[r.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",r[r.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",r[r.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",r[r.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",r[r.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",r[r.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",r[r.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",r[r.COMPILE_STATUS=35713]="COMPILE_STATUS",r[r.LOW_FLOAT=36336]="LOW_FLOAT",r[r.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",r[r.HIGH_FLOAT=36338]="HIGH_FLOAT",r[r.LOW_INT=36339]="LOW_INT",r[r.MEDIUM_INT=36340]="MEDIUM_INT",r[r.HIGH_INT=36341]="HIGH_INT",r[r.FRAMEBUFFER=36160]="FRAMEBUFFER",r[r.RENDERBUFFER=36161]="RENDERBUFFER",r[r.RGBA4=32854]="RGBA4",r[r.RGB5_A1=32855]="RGB5_A1",r[r.RGB565=36194]="RGB565",r[r.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",r[r.STENCIL_INDEX=6401]="STENCIL_INDEX",r[r.STENCIL_INDEX8=36168]="STENCIL_INDEX8",r[r.DEPTH_STENCIL=34041]="DEPTH_STENCIL",r[r.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",r[r.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",r[r.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",r[r.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",r[r.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",r[r.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",r[r.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",r[r.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",r[r.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",r[r.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",r[r.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",r[r.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",r[r.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",r[r.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",r[r.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",r[r.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",r[r.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",r[r.NONE=0]="NONE",r[r.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",r[r.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",r[r.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",r[r.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",r[r.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",r[r.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",r[r.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",r[r.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",r[r.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",r[r.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",r[r.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",r[r.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",r[r.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",r[r.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL"})(A||(A={}));var Cm,Em,Sm,bm,Am,Tm,Mm,Li,wm,Lm,Fm,km,Om,nG=(Cm=xt(),Em=At(P.IMapService),Sm=At(P.IRendererService),bm=At(P.IGlobalConfigService),Am=At(P.IInteractionService),Tm=At(P.ILayerService),Cm(Mm=(Li=function(){function r(){var n=this;$(this,r),S(this,"pickedColors",void 0),S(this,"pickedTileLayers",[]),St(this,"mapService",wm,this),St(this,"rendererService",Lm,this),St(this,"configService",Fm,this),St(this,"interactionService",km,this),St(this,"layerService",Om,this),S(this,"pickingFBO",void 0),S(this,"width",0),S(this,"height",0),S(this,"alreadyInPicking",!1),S(this,"pickBufferScale",1),S(this,"pickedLayers",[]),S(this,"pickFromPickingFBO",function(t,e){var i=e.x,a=e.y,o=e.lngLat,s=e.type,u=e.target,l=!1,c=n.rendererService,f=c.readPixels,h=c.getContainer,v=n.getContainerSize(h()),p=v.width,d=v.height;p*=se,d*=se;var g=t.getLayerConfig(),y=g.enableHighlight,m=g.enableSelect,x=i*se,_=a*se;if(x>p-1*se||x<0||_>d-1*se||_<0)return!1;var E=f({x:Math.floor(x/n.pickBufferScale),y:Math.floor((d-(a+1)*se)/n.pickBufferScale),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:n.pickingFBO});if(n.pickedColors=E,E[0]!==0||E[1]!==0||E[2]!==0){var b=cn(E),M=t.getSource().getFeatureById(b);b!==t.getCurrentPickId()&&s==="mousemove"&&(s="mouseenter");var T={x:i,y:a,type:s,lngLat:o,featureId:b,feature:M,target:u};M&&(l=!0,t.setCurrentPickId(b),n.pickedLayers=[t],n.triggerHoverOnLayer(t,T))}else{var k={x:i,y:a,lngLat:o,type:t.getCurrentPickId()!==null&&s==="mousemove"?"mouseout":"un"+s,featureId:null,target:u,feature:null};n.triggerHoverOnLayer(t,U(U({},k),{},{type:"unpick"})),n.triggerHoverOnLayer(t,k),t.setCurrentPickId(null),n.pickedLayers=[]}if(y&&n.highlightPickedFeature(t,E),m&&s==="click"&&(E==null?void 0:E.toString())!==[0,0,0,0].toString()){var L=cn(E);t.getCurrentSelectedId()===null||L!==t.getCurrentSelectedId()?(n.selectFeature(t,E),t.setCurrentSelectedId(L)):(n.selectFeature(t,new Uint8Array([0,0,0,0])),t.setCurrentSelectedId(null)),t.isVector||n.layerService.getLayers().filter(function(O){return O.tileLayer}).map(function(O){O.tileLayer.clearPickState()})}return l})}return H(r,[{key:"init",value:function(t){var e=this.rendererService,i=e.createTexture2D,a=e.createFramebuffer,o=e.getContainer,s=this.getContainerSize(o()),u=s.width,l=s.height;u*=se,l*=se,this.pickBufferScale=this.configService.getSceneConfig(t).pickBufferScale||1,this.pickingFBO=a({color:i({width:Math.round(u/this.pickBufferScale),height:Math.round(l/this.pickBufferScale),wrapS:A.CLAMP_TO_EDGE,wrapT:A.CLAMP_TO_EDGE})}),this.interactionService.on(Re.Hover,this.pickingAllLayer.bind(this))}},{key:"boxPickLayer",value:function(){var n=Mt(st.mark(function e(i,a,o){var s=this,u,l,c;return st.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:u=this.rendererService,l=u.useFramebuffer,c=u.clear,u.getContainer,this.resizePickingFBO(),l(this.pickingFBO,function(){c({framebuffer:s.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),i.hooks.beforePickingEncode.call(),i.renderModels(),i.hooks.afterPickingEncode.call();var v=s.pickBox(i,a);o(v)});case 3:case"end":return h.stop()}},e,this)}));function t(e,i,a){return n.apply(this,arguments)}return t}()},{key:"pickBox",value:function(t,e){var i=this,a=e.map(function(L){var O=L<0?0:L;return Math.floor(O*se/i.pickBufferScale)}),o=kt(a,4),s=o[0],u=o[1],l=o[2],c=o[3],f=this.rendererService,h=f.readPixels,v=f.getContainer,p=this.getContainerSize(v()),d=p.width,g=p.height;if(d*=se,g*=se,s>(d-1)*se/this.pickBufferScale||l<0||u>(g-1)*se/this.pickBufferScale||c<0)return[];for(var y=Math.min(d/this.pickBufferScale,l)-s,m=Math.min(g/this.pickBufferScale,c)-u,x=h({x:s,y:Math.floor(g/this.pickBufferScale-(c+1)),width:y,height:m,data:new Uint8Array(y*m*4),framebuffer:this.pickingFBO}),_=[],E={},b=0;b<x.length/4;b=b+1){var M=x.slice(b*4,b*4+4),T=cn(M);if(T!==-1&&!E[T]){var k=t.getSource().getFeatureById(T);_.push(U(U({},k),{},{pickedFeatureIdx:T})),E[T]=!0}}return _}},{key:"handleCursor",value:function(t,e){var i=t.getLayerConfig(),a=i.cursor,o=a===void 0?"":a,s=i.cursorEnabled;if(s){var u=this.mapService.version,l=u==="GAODE2.x"?this.mapService.getMapContainer():this.mapService.getMarkerContainer(),c=l==null?void 0:l.style.getPropertyValue("cursor");e==="unmousemove"&&c!==""?l==null||l.style.setProperty("cursor",""):e==="mousemove"&&(l==null||l.style.setProperty("cursor",o))}}},{key:"destroy",value:function(){this.pickingFBO.destroy(),this.pickingFBO=null}},{key:"getContainerSize",value:function(t){return t.getContext?{width:t.width/se,height:t.height/se}:t.getBoundingClientRect()}},{key:"pickingAllLayer",value:function(){var n=Mt(st.mark(function e(i){return st.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(this.isPickingAllLayer()){o.next=2;break}return o.abrupt("return");case 2:return this.alreadyInPicking=!0,o.next=5,this.pickingLayers(i);case 5:this.layerService.renderLayers(),this.alreadyInPicking=!1;case 7:case"end":return o.stop()}},e,this)}));function t(e){return n.apply(this,arguments)}return t}()},{key:"isPickingAllLayer",value:function(){return!(this.alreadyInPicking||this.layerService.alreadyInRendering||this.interactionService.indragging||!this.layerService.getShaderPickStat())}},{key:"resizePickingFBO",value:function(){var t=this.rendererService.getContainer,e=this.getContainerSize(t()),i=e.width,a=e.height;i*=se,a*=se,(this.width!==i||this.height!==a)&&(this.pickingFBO.resize({width:Math.round(i/this.pickBufferScale),height:Math.round(a/this.pickBufferScale)}),this.width=i,this.height=a)}},{key:"pickingLayers",value:function(){var n=Mt(st.mark(function e(i){var a=this,o,s,u;return st.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:o=this.rendererService,s=o.useFramebuffer,u=o.clear,this.resizePickingFBO(),s(this.pickingFBO,function(){var f=a.layerService.getRenderList();f.filter(function(h){return h.needPick(i.type)}).reverse().some(function(h){if(u({framebuffer:a.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),a.pickedLayers.filter(function(p){return!p.isVector}).map(function(p){a.selectFeature(p,new Uint8Array([0,0,0,0]))}),a.pickedTileLayers.map(function(p){var d;return(d=p.tileLayer)===null||d===void 0?void 0:d.clearPick(i.type)}),h.tileLayer&&h.tileLayer.pickLayers)return h.tileLayer.pickLayers(i);h.hooks.beforePickingEncode.call(),h.masks.length>0&&h.masks.map(function(p){p.hooks.beforeRenderData.call(),p.hooks.beforeRender.call(),p.render(),p.hooks.afterRender.call()}),h.renderModels(!0),h.hooks.afterPickingEncode.call();var v=a.pickFromPickingFBO(h,i);return a.layerService.pickedLayerId=v?+h.id:-1,v&&!h.getLayerConfig().enablePropagation})});case 3:case"end":return c.stop()}},e,this)}));function t(e){return n.apply(this,arguments)}return t}()},{key:"triggerHoverOnLayer",value:function(t,e){rG(e)&&(this.handleCursor(t,e.type),t.emit(e.type,e))}},{key:"highlightPickedFeature",value:function(t,e){var i=kt(e,3),a=i[0],o=i[1],s=i[2];t.hooks.beforeHighlight.call([a,o,s])}},{key:"selectFeature",value:function(t,e){var i=kt(e,3),a=i[0],o=i[1],s=i[2];t.hooks.beforeSelect.call([a,o,s])}}]),r}(),wm=Ct(Li.prototype,"mapService",[Em],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Lm=Ct(Li.prototype,"rendererService",[Sm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fm=Ct(Li.prototype,"configService",[bm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),km=Ct(Li.prototype,"interactionService",[Am],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Om=Ct(Li.prototype,"layerService",[Tm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Li))||Mm),iG=function(){function r(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;$(this,r),S(this,"autoStart",void 0),S(this,"startTime",0),S(this,"oldTime",0),S(this,"running",!1),S(this,"elapsedTime",0),this.autoStart=n}return H(r,[{key:"start",value:function(){this.startTime=(typeof performance>"u"?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var e=(typeof performance>"u"?Date:performance).now();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}}]),r}(),Rm,Im,Dm,Pm,Ou,Bm,Nm;function aG(r,n){var t=typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(!t){if(Array.isArray(r)||(t=oG(r))||n&&r&&typeof r.length=="number"){t&&(r=t);var e=0,i=function(){};return{s:i,n:function(){return e>=r.length?{done:!0}:{done:!1,value:r[e++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){t=t.call(r)},n:function(){var l=t.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(o)throw s}}}}function oG(r,n){if(!!r){if(typeof r=="string")return zm(r,n);var t=Object.prototype.toString.call(r).slice(8,-1);if(t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set")return Array.from(r);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return zm(r,n)}}function zm(r,n){(n==null||n>r.length)&&(n=r.length);for(var t=0,e=new Array(n);t<n;t++)e[t]=r[t];return e}var sG=(Rm=xt(),Im=At(P.IRendererService),Dm=At(P.IMapService),Rm(Pm=(Ou=function(){function r(){var n=this;$(this,r),S(this,"pickedLayerId",-1),S(this,"clock",new iG),S(this,"alreadyInRendering",!1),S(this,"layers",[]),S(this,"layerList",[]),S(this,"layerRenderID",void 0),S(this,"sceneInited",!1),S(this,"animateInstanceCount",0),S(this,"shaderPicking",!0),S(this,"enableRender",!0),St(this,"renderService",Bm,this),St(this,"mapService",Nm,this),S(this,"reRender",Y.exports.throttle(function(){n.updateLayerRenderList(),n.renderLayers()},32)),S(this,"throttleRenderLayers",Y.exports.throttle(function(){n.renderLayers()},16))}return H(r,[{key:"add",value:function(t){this.sceneInited&&t.init(),this.layers.push(t),this.updateLayerRenderList()}},{key:"addMask",value:function(t){this.sceneInited&&t.init()}},{key:"initLayers",value:function(){this.sceneInited=!0,this.layers.forEach(function(t){t.inited||t.init()}),this.updateLayerRenderList()}},{key:"getSceneInited",value:function(){return this.sceneInited}},{key:"getRenderList",value:function(){return this.layerList}},{key:"getLayers",value:function(){return this.layers}},{key:"getLayer",value:function(t){return this.layers.find(function(e){return e.id===t})}},{key:"getLayerByName",value:function(t){return this.layers.find(function(e){return e.name===t})}},{key:"cleanRemove",value:function(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,i=this.layers.indexOf(t);i>-1&&this.layers.splice(i,1),e&&this.throttleRenderLayers()}},{key:"remove",value:function(t,e){if(e){var i=e.layerChildren.indexOf(t);i>-1&&e.layerChildren.splice(i,1)}else{var a=this.layers.indexOf(t);a>-1&&this.layers.splice(a,1)}this.updateLayerRenderList(),t.destroy()}},{key:"removeAllLayers",value:function(){this.destroy()}},{key:"setEnableRender",value:function(t){this.enableRender=t}},{key:"renderLayers",value:function(){var n=Mt(st.mark(function e(){var i,a,o;return st.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(!(this.alreadyInRendering||!this.enableRender)){u.next=2;break}return u.abrupt("return");case 2:this.alreadyInRendering=!0,this.clear(),i=aG(this.layerList),u.prev=5,i.s();case 7:if((a=i.n()).done){u.next=21;break}if(o=a.value,o.hooks.beforeRenderData.call(),o.hooks.beforeRender.call(),o.masks.length>0&&(this.renderService.clear({stencil:0,depth:1,framebuffer:null}),o.masks.map(function(l){l.hooks.beforeRenderData.call(),l.hooks.beforeRender.call(),l.render(),l.hooks.afterRender.call()})),!o.getLayerConfig().enableMultiPassRenderer){u.next=17;break}return u.next=15,o.renderMultiPass();case 15:u.next=18;break;case 17:o.render();case 18:o.hooks.afterRender.call();case 19:u.next=7;break;case 21:u.next=26;break;case 23:u.prev=23,u.t0=u.catch(5),i.e(u.t0);case 26:return u.prev=26,i.f(),u.finish(26);case 29:this.alreadyInRendering=!1;case 30:case"end":return u.stop()}},e,this,[[5,23,26,29]])}));function t(){return n.apply(this,arguments)}return t}()},{key:"updateLayerRenderList",value:function(){var t=this;this.layerList=[],this.layers.filter(function(e){return e.inited}).filter(function(e){return e.isVisible()}).sort(function(e,i){return e.zIndex-i.zIndex}).forEach(function(e){t.layerList.push(e)})}},{key:"destroy",value:function(){this.layers.forEach(function(t){t.destroy()}),this.layers=[],this.layerList=[],this.renderLayers()}},{key:"startAnimate",value:function(){this.animateInstanceCount++===0&&(this.clock.start(),this.runRender())}},{key:"stopAnimate",value:function(){--this.animateInstanceCount===0&&(this.stopRender(),this.clock.stop())}},{key:"getOESTextureFloat",value:function(){return this.renderService.extensionObject.OES_texture_float}},{key:"enableShaderPick",value:function(){this.shaderPicking=!0}},{key:"disableShaderPick",value:function(){this.shaderPicking=!1}},{key:"getShaderPickStat",value:function(){return this.shaderPicking}},{key:"clear",value:function(){var t=Ut(this.mapService.bgColor);this.renderService.clear({color:t,depth:1,stencil:0,framebuffer:null})}},{key:"runRender",value:function(){this.renderLayers(),this.layerRenderID=Wt.requestAnimationFrame(this.runRender.bind(this))}},{key:"stopRender",value:function(){Wt.cancelAnimationFrame(this.layerRenderID)}}]),r}(),Bm=Ct(Ou.prototype,"renderService",[Im],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nm=Ct(Ou.prototype,"mapService",[Dm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ou))||Pm),uG=function(){function r(n){var t=this;$(this,r),S(this,"name",void 0),S(this,"type",void 0),S(this,"scale",void 0),S(this,"descriptor",void 0),S(this,"featureBufferLayout",[]),S(this,"needRescale",!1),S(this,"needRemapping",!1),S(this,"needRegenerateVertices",!1),S(this,"featureRange",{startIndex:0,endIndex:1/0}),S(this,"vertexAttribute",void 0),S(this,"defaultCallback",function(e){if(e.length===0){var i;return((i=t.scale)===null||i===void 0?void 0:i.defaultValues)||[]}return e.map(function(a,o){var s,u=(s=t.scale)===null||s===void 0?void 0:s.scalers[o].func,l=u(a);return l})}),this.setProps(n)}return H(r,[{key:"setProps",value:function(t){Object.assign(this,t)}},{key:"mapping",value:function(t){var e;if((e=this.scale)!==null&&e!==void 0&&e.callback){var i,a=(i=this.scale)===null||i===void 0?void 0:i.callback.apply(i,it(t));if(!Y.exports.isNil(a))return[a]}return this.defaultCallback(t)}},{key:"resetDescriptor",value:function(){this.descriptor&&(this.descriptor.buffer.data=[])}}]),r}(),lG=["modelType"],cG=["buffer","update","name"],fG=["buffer","update","name"],hG=["buffer","update","name"],Do,Um,Hm,$m,Lf,Gm,vG=(Do={},S(Do,A.FLOAT,4),S(Do,A.UNSIGNED_BYTE,1),S(Do,A.UNSIGNED_SHORT,2),Do),pG=(Um=xt(),Hm=At(P.IRendererService),Um($m=(Lf=function(){function r(){$(this,r),S(this,"attributesAndIndices",void 0),St(this,"rendererService",Gm,this),S(this,"attributes",[]),S(this,"triangulation",void 0),S(this,"featureLayout",{sizePerElement:0,elements:[]})}return H(r,[{key:"registerStyleAttribute",value:function(t){var e=this.getLayerStyleAttribute(t.name||"");return e?e.setProps(t):(e=new uG(t),this.attributes.push(e)),e}},{key:"updateStyleAttribute",value:function(t,e,i){var a=this.getLayerStyleAttribute(t);a||(a=this.registerStyleAttribute(U(U({},e),{},{name:t})));var o=e.scale;o&&a&&(a.scale=o,a.needRescale=!0,a.needRemapping=!0,a.needRegenerateVertices=!0,i&&i.featureRange&&(a.featureRange=i.featureRange))}},{key:"getLayerStyleAttributes",value:function(){return this.attributes}},{key:"getLayerStyleAttribute",value:function(t){return this.attributes.find(function(e){return e.name===t})}},{key:"getLayerAttributeScale",value:function(t){var e,i=this.getLayerStyleAttribute(t),a=i==null||(e=i.scale)===null||e===void 0?void 0:e.scalers;return a&&a[0]?a[0].func:null}},{key:"updateAttributeByFeatureRange",value:function(t,e){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,a=arguments.length>3?arguments[3]:void 0,o=this.attributes.find(function(_){return _.name===t});if(o&&o.descriptor){var s=o.descriptor,u=s.update,l=s.buffer,c=s.size,f=c===void 0?0:c,h=vG[l.type||A.FLOAT];if(u){var v=this.featureLayout,p=v.elements,d=v.sizePerElement,g=p.slice(i,a);if(!g.length)return;var y=g[0].offset,m=y*f*h,x=g.map(function(_,E){for(var b=_.featureIdx,M=_.vertices,T=_.normals,k=M.length/d,L=[],O=0;O<k;O++){var D=T?T.slice(O*3,O*3+3):[];L.push.apply(L,it(u(e[b],b,M.slice(O*d,O*d+d),E,D)))}return L}).reduce(function(_,E){return _.push.apply(_,it(E)),_},[]);o.vertexAttribute.updateBuffer({data:x,offset:m})}}}},{key:"createAttributesAndIndicesAscy",value:function(t,e,i){var a=this;this.featureLayout={sizePerElement:0,elements:[]};var o=this.attributes.map(function(p){return p.resetDescriptor(),p.descriptor}).filter(function(p){return p}),s=i.modelType,u=un(i,lG),l=this.rendererService,c=l.createAttribute,f=l.createBuffer,h=l.createElements,v={};return new Promise(function(p,d){KH(s,U({descriptors:a.getDescriptorsWithOutFunc(o),features:t,segmentNumber:e},u)).then(function(g){g.descriptors.forEach(function(m,x){if(m){var _=m.buffer;m.update,m.name;var E=un(m,cG),b=c(U({buffer:f(_)},E));v[m.name||""]=b,a.attributes[x].vertexAttribute=b}}),a.featureLayout=g.featureLayout;var y=h({data:g.indices,type:A.UNSIGNED_INT,count:g.indices.length});a.attributesAndIndices={attributes:v,elements:y,count:null},p(a.attributesAndIndices)}).catch(function(g){console.warn(g),d(g)})})}},{key:"createAttributesAndIndices",value:function(t,e,i){var a=this;this.featureLayout={sizePerElement:0,elements:[]},e&&(this.triangulation=e);var o=this.attributes.map(function(y){return y.resetDescriptor(),y.descriptor}),s=0,u=0,l=[],c=3;t.forEach(function(y,m){var x=a.triangulation(y,i),_=x.indices,E=x.vertices,b=x.normals,M=x.size,T=x.indexes,k=x.count;typeof k=="number"&&(u+=k),_.forEach(function(W){l.push(W+s)}),c=M;var L=E.length/M;a.featureLayout.sizePerElement=c,a.featureLayout.elements.push({featureIdx:m,vertices:E,normals:b,offset:s}),s+=L;for(var O=function(j){var ot=(b==null?void 0:b.slice(j*3,j*3+3))||[],z=E.slice(j*M,j*M+M),X=0;T&&T[j]!==void 0&&(X=T[j]),o.forEach(function(K,Q){if(K&&K.update){var q;(q=K.buffer.data).push.apply(q,it(K.update(y,m,z,j,ot,X)))}})},D=0;D<L;D++)O(D)});var f=this.rendererService,h=f.createAttribute,v=f.createBuffer,p=f.createElements,d={};o.forEach(function(y,m){if(y){var x=y.buffer;y.update,y.name;var _=un(y,fG),E=h(U({buffer:v(x)},_));d[y.name||""]=E,a.attributes[m].vertexAttribute=E}});var g=p({data:l,type:A.UNSIGNED_INT,count:l.length});return this.attributesAndIndices={attributes:d,elements:g,count:u},this.attributesAndIndices}},{key:"createAttributes",value:function(t,e){var i=this;this.featureLayout={sizePerElement:0,elements:[]},e&&(this.triangulation=e);var a=this.attributes.map(function(h){return h.resetDescriptor(),h.descriptor}),o=0,s=3;t.forEach(function(h,v){var p=i.triangulation(h),d=p.indices,g=p.vertices,y=p.normals,m=p.size,x=p.indexes;d.forEach(function(M){}),s=m;var _=g.length/m;i.featureLayout.sizePerElement=s,i.featureLayout.elements.push({featureIdx:v,vertices:g,normals:y,offset:o}),o+=_;for(var E=function(T){var k=(y==null?void 0:y.slice(T*3,T*3+3))||[],L=g.slice(T*m,T*m+m),O=0;x&&x[T]!==void 0&&(O=x[T]),a.forEach(function(D,W){if(D&&D.update){var j;(j=D.buffer.data).push.apply(j,it(D.update(h,v,L,T,k,O)))}})},b=0;b<_;b++)E(b)});var u=this.rendererService,l=u.createAttribute,c=u.createBuffer,f={};return a.forEach(function(h,v){if(h){var p=h.buffer;h.update,h.name;var d=un(h,hG),g=l(U({buffer:c(p)},d));f[h.name||""]=g,i.attributes[v].vertexAttribute=g}}),{attributes:f}}},{key:"clearAllAttributes",value:function(){var t;this.attributes.forEach(function(e){e.vertexAttribute&&e.vertexAttribute.destroy()}),(t=this.attributesAndIndices)===null||t===void 0||t.elements.destroy(),this.attributes=[]}},{key:"getDescriptorsWithOutFunc",value:function(t){return t.map(function(e){return{buffer:e.buffer,name:e.name,size:e.size}})}}]),r}(),Gm=Ct(Lf.prototype,"rendererService",[Hm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Lf))||$m);function dG(r,n,t,e){function i(a){return a instanceof t?a:new t(function(o){o(a)})}return new(t||(t=Promise))(function(a,o){function s(c){try{l(e.next(c))}catch(f){o(f)}}function u(c){try{l(e.throw(c))}catch(f){o(f)}}function l(c){c.done?a(c.value):i(c.value).then(s,u)}l((e=e.apply(r,n||[])).next())})}function gG(r,n){var t={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},e,i,a,o;return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(l){return function(c){return u([l,c])}}function u(l){if(e)throw new TypeError("Generator is already executing.");for(;t;)try{if(e=1,i&&(a=l[0]&2?i.return:l[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,l[1])).done)return a;switch(i=0,a&&(l=[l[0]&2,a.value]),l[0]){case 0:case 1:a=l;break;case 4:return t.label++,{value:l[1],done:!1};case 5:t.label++,i=l[1],l=[0];continue;case 7:l=t.ops.pop(),t.trys.pop();continue;default:if(a=t.trys,!(a=a.length>0&&a[a.length-1])&&(l[0]===6||l[0]===2)){t=0;continue}if(l[0]===3&&(!a||l[1]>a[0]&&l[1]<a[3])){t.label=l[1];break}if(l[0]===6&&t.label<a[1]){t.label=a[1],a=l;break}if(a&&t.label<a[2]){t.label=a[2],t.ops.push(l);break}a[2]&&t.ops.pop(),t.trys.pop();continue}l=n.call(r,t)}catch(c){l=[6,c],i=0}finally{e=a=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function nT(r,n){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var e=t.call(r),i,a=[],o;try{for(;(n===void 0||n-- >0)&&!(i=e.next()).done;)a.push(i.value)}catch(s){o={error:s}}finally{try{i&&!i.done&&(t=e.return)&&t.call(e)}finally{if(o)throw o.error}}return a}function iT(r,n,t){if(t||arguments.length===2)for(var e=0,i=n.length,a;e<i;e++)(a||!(e in n))&&(a||(a=Array.prototype.slice.call(n,0,e)),a[e]=n[e]);return r.concat(a||Array.prototype.slice.call(n))}function od(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var qh={exports:{}},Al={exports:{}},ks={exports:{}};(function(r,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=t;function t(e){return e&&typeof e.length=="number"&&e.length>=0&&e.length%1===0}r.exports=n.default})(ks,ks.exports);var rr={},Kh={exports:{}},Qh={exports:{}};(function(r,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(t){return function(){for(var e=[],i=arguments.length;i--;)e[i]=arguments[i];var a=e.pop();return t.call(this,e,a)}},r.exports=n.default})(Qh,Qh.exports);var Ei={};Object.defineProperty(Ei,"__esModule",{value:!0});Ei.fallback=aT;Ei.wrap=oT;var yG=Ei.hasQueueMicrotask=typeof queueMicrotask=="function"&&queueMicrotask,mG=Ei.hasSetImmediate=typeof setImmediate=="function"&&setImmediate,xG=Ei.hasNextTick=typeof process=="object"&&typeof process.nextTick=="function";function aT(r){setTimeout(r,0)}function oT(r){return function(n){for(var t=[],e=arguments.length-1;e-- >0;)t[e]=arguments[e+1];return r(function(){return n.apply(void 0,t)})}}var Xo;yG?Xo=queueMicrotask:mG?Xo=setImmediate:xG?Xo=process.nextTick:Xo=aT;Ei.default=oT(Xo);(function(r,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=u;var t=Qh.exports,e=s(t),i=Ei,a=s(i),o=rr;function s(f){return f&&f.__esModule?f:{default:f}}function u(f){return(0,o.isAsync)(f)?function(){for(var h=[],v=arguments.length;v--;)h[v]=arguments[v];var p=h.pop(),d=f.apply(this,h);return l(d,p)}:(0,e.default)(function(h,v){var p;try{p=f.apply(this,h)}catch(d){return v(d)}if(p&&typeof p.then=="function")return l(p,v);v(null,p)})}function l(f,h){return f.then(function(v){c(h,null,v)},function(v){c(h,v&&v.message?v:new Error(v))})}function c(f,h,v){try{f(h,v)}catch(p){(0,a.default)(function(d){throw d},p)}}r.exports=n.default})(Kh,Kh.exports);Object.defineProperty(rr,"__esModule",{value:!0});rr.isAsyncIterable=rr.isAsyncGenerator=rr.isAsync=void 0;var _G=Kh.exports,CG=EG(_G);function EG(r){return r&&r.__esModule?r:{default:r}}function sT(r){return r[Symbol.toStringTag]==="AsyncFunction"}function SG(r){return r[Symbol.toStringTag]==="AsyncGenerator"}function bG(r){return typeof r[Symbol.asyncIterator]=="function"}function AG(r){if(typeof r!="function")throw new Error("expected a function");return sT(r)?(0,CG.default)(r):r}rr.default=AG;rr.isAsync=sT;rr.isAsyncGenerator=SG;rr.isAsyncIterable=bG;var sa={exports:{}};(function(r,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=t;function t(e,i){if(i===void 0&&(i=e.length),!i)throw new Error("arity is undefined");function a(){for(var o=this,s=[],u=arguments.length;u--;)s[u]=arguments[u];return typeof s[i-1]=="function"?e.apply(this,s):new Promise(function(l,c){s[i-1]=function(f){for(var h=[],v=arguments.length-1;v-- >0;)h[v]=arguments[v+1];if(f)return c(f);l(h.length>1?h:h[0])},e.apply(o,s)})}return a}r.exports=n.default})(sa,sa.exports);(function(r,n){Object.defineProperty(n,"__esModule",{value:!0});var t=ks.exports,e=u(t),i=rr,a=u(i),o=sa.exports,s=u(o);function u(l){return l&&l.__esModule?l:{default:l}}n.default=(0,s.default)(function(l,c,f){var h=(0,e.default)(c)?[]:{};l(c,function(v,p,d){(0,a.default)(v)(function(g){for(var y,m=[],x=arguments.length-1;x-- >0;)m[x]=arguments[x+1];m.length<2&&(y=m,m=y[0]),h[p]=m,d(g)})},function(v){return f(v,h)})},3),r.exports=n.default})(Al,Al.exports);var Jh={exports:{}},Tl={exports:{}},tv={exports:{}},Os={exports:{}};(function(r,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=t;function t(e){function i(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];if(e!==null){var s=e;e=null,s.apply(this,a)}}return Object.assign(i,e),i}r.exports=n.default})(Os,Os.exports);var ev={exports:{}},rv={exports:{}};(function(r,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(t){return t[Symbol.iterator]&&t[Symbol.iterator]()},r.exports=n.default})(rv,rv.exports);(function(r,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=c;var t=ks.exports,e=o(t),i=rv.exports,a=o(i);function o(f){return f&&f.__esModule?f:{default:f}}function s(f){var h=-1,v=f.length;return function(){return++h<v?{value:f[h],key:h}:null}}function u(f){var h=-1;return function(){var p=f.next();return p.done?null:(h++,{value:p.value,key:h})}}function l(f){var h=f?Object.keys(f):[],v=-1,p=h.length;return function d(){var g=h[++v];return g==="__proto__"?d():v<p?{value:f[g],key:g}:null}}function c(f){if((0,e.default)(f))return s(f);var h=(0,a.default)(f);return h?u(h):l(f)}r.exports=n.default})(ev,ev.exports);var Rs={exports:{}};(function(r,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=t;function t(e){return function(){for(var i=[],a=arguments.length;a--;)i[a]=arguments[a];if(e===null)throw new Error("Callback was already called.");var o=e;e=null,o.apply(this,i)}}r.exports=n.default})(Rs,Rs.exports);var nv={exports:{}},Is={exports:{}};(function(r,n){Object.defineProperty(n,"__esModule",{value:!0});var t={};n.default=t,r.exports=n.default})(Is,Is.exports);(function(r,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=a;var t=Is.exports,e=i(t);function i(o){return o&&o.__esModule?o:{default:o}}function a(o,s,u,l){var c=!1,f=!1,h=!1,v=0,p=0;function d(){v>=s||h||c||(h=!0,o.next().then(function(m){var x=m.value,_=m.done;if(!(f||c)){if(h=!1,_){c=!0,v<=0&&l(null);return}v++,u(x,p,g),p++,d()}}).catch(y))}function g(m,x){if(v-=1,!f){if(m)return y(m);if(m===!1){c=!0,f=!0;return}if(x===e.default||c&&v<=0)return c=!0,l(null);d()}}function y(m){f||(h=!1,c=!0,l(m))}d()}r.exports=n.default})(nv,nv.exports);(function(r,n){Object.defineProperty(n,"__esModule",{value:!0});var t=Os.exports,e=v(t),i=ev.exports,a=v(i),o=Rs.exports,s=v(o),u=rr,l=nv.exports,c=v(l),f=Is.exports,h=v(f);function v(p){return p&&p.__esModule?p:{default:p}}n.default=function(p){return function(d,g,y){if(y=(0,e.default)(y),p<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!d)return y(null);if((0,u.isAsyncGenerator)(d))return(0,c.default)(d,p,g,y);if((0,u.isAsyncIterable)(d))return(0,c.default)(d[Symbol.asyncIterator](),p,g,y);var m=(0,a.default)(d),x=!1,_=!1,E=0,b=!1;function M(k,L){if(!_)if(E-=1,k)x=!0,y(k);else if(k===!1)x=!0,_=!0;else{if(L===h.default||x&&E<=0)return x=!0,y(null);b||T()}}function T(){for(b=!0;E<p&&!x;){var k=m();if(k===null){x=!0,E<=0&&y(null);return}E+=1,g(k.value,k.key,(0,s.default)(M))}b=!1}T()}},r.exports=n.default})(tv,tv.exports);(function(r,n){Object.defineProperty(n,"__esModule",{value:!0});var t=tv.exports,e=u(t),i=rr,a=u(i),o=sa.exports,s=u(o);function u(c){return c&&c.__esModule?c:{default:c}}function l(c,f,h,v){return(0,e.default)(f)(c,(0,a.default)(h),v)}n.default=(0,s.default)(l,4),r.exports=n.default})(Tl,Tl.exports);(function(r,n){Object.defineProperty(n,"__esModule",{value:!0});var t=Tl.exports,e=o(t),i=sa.exports,a=o(i);function o(u){return u&&u.__esModule?u:{default:u}}function s(u,l,c){return(0,e.default)(u,1,l,c)}n.default=(0,a.default)(s,3),r.exports=n.default})(Jh,Jh.exports);(function(r,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=s;var t=Al.exports,e=o(t),i=Jh.exports,a=o(i);function o(u){return u&&u.__esModule?u:{default:u}}function s(u,l){return(0,e.default)(a.default,u,l)}r.exports=n.default})(qh,qh.exports);var sd=od(qh.exports),nn=function(){function r(){this.args=[],this.tasks=[]}return r.prototype.call=function(){for(var n=arguments,t=[],e=0;e<arguments.length;e++)t[e]=n[e];return this.args=t,sd(this.tasks)},r.prototype.tap=function(n,t){var e=this;this.tasks.push(function(i){t.apply(void 0,iT([],nT(e.args),!1)),i(null,n)})},r}(),iv={exports:{}},av={exports:{}};(function(r,n){Object.defineProperty(n,"__esModule",{value:!0});var t=ks.exports,e=g(t),i=Is.exports,a=g(i),o=Tl.exports,s=g(o),u=Os.exports,l=g(u),c=Rs.exports,f=g(c),h=rr,v=g(h),p=sa.exports,d=g(p);function g(_){return _&&_.__esModule?_:{default:_}}function y(_,E,b){b=(0,l.default)(b);var M=0,T=0,k=_.length,L=!1;k===0&&b(null);function O(D,W){D===!1&&(L=!0),L!==!0&&(D?b(D):(++T===k||W===a.default)&&b(null))}for(;M<k;M++)E(_[M],M,(0,f.default)(O))}function m(_,E,b){return(0,s.default)(_,1/0,E,b)}function x(_,E,b){var M=(0,e.default)(_)?y:m;return M(_,(0,v.default)(E),b)}n.default=(0,d.default)(x,3),r.exports=n.default})(av,av.exports);(function(r,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=s;var t=av.exports,e=o(t),i=Al.exports,a=o(i);function o(u){return u&&u.__esModule?u:{default:u}}function s(u,l){return(0,a.default)(e.default,u,l)}r.exports=n.default})(iv,iv.exports);iv.exports;var ov={exports:{}};(function(r,n){Object.defineProperty(n,"__esModule",{value:!0});var t=Os.exports,e=c(t),i=Rs.exports,a=c(i),o=rr,s=c(o),u=sa.exports,l=c(u);function c(h){return h&&h.__esModule?h:{default:h}}function f(h,v){if(v=(0,e.default)(v),!Array.isArray(h))return v(new Error("First argument to waterfall must be an array of functions"));if(!h.length)return v();var p=0;function d(y){var m=(0,s.default)(h[p++]);m.apply(void 0,y.concat([(0,a.default)(g)]))}function g(y){for(var m=[],x=arguments.length-1;x-- >0;)m[x]=arguments[x+1];if(y!==!1){if(y||p===h.length)return v.apply(void 0,[y].concat(m));d(m)}}d([])}n.default=(0,l.default)(f),r.exports=n.default})(ov,ov.exports);var TG=od(ov.exports),MG=function(){function r(){this.tasks=[]}return r.prototype.call=function(){return TG(this.tasks)},r.prototype.tap=function(n,t){this.tasks.length===0?this.tasks.push(function(e){var i=t();e(i?null:!1,i)}):this.tasks.push(function(e,i){var a=t();i(a?null:!1,n)})},r}(),Ff=function(){function r(){this.tasks=[]}return r.prototype.call=function(){return sd(this.tasks)},r.prototype.tap=function(n,t){this.tasks.push(function(e){var i=t();e(i,n)})},r}(),wG=function(){function r(){this.args=[],this.tasks=[]}return r.prototype.promise=function(){for(var n=arguments,t=[],e=0;e<arguments.length;e++)t[e]=n[e];return this.args=t,sd(this.tasks)},r.prototype.tapPromise=function(n,t){var e=this;this.tasks.push(function(i){return dG(e,void 0,void 0,function(){return gG(this,function(a){switch(a.label){case 0:return[4,t.apply(void 0,iT([],nT(this.args),!1))];case 1:return a.sent(),i(null,n),[2]}})})})},r}(),Vm,Wm,jm,Xm,Ym,Zm,qm,Km,Qm,Jm,tx,ex,rx,nx,ix,ax,ox,ke,sx,ux,lx,cx,fx,hx,vx,px,dx,gx,yx,mx,xx,_x,Cx;function LG(r){var n=FG();return function(){var e=B(r),i;if(n){var a=B(this).constructor;i=Reflect.construct(e,arguments,a)}else i=e.apply(this,arguments);return et(this,i)}}function FG(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var kG=(Vm=xt(),Wm=At(P.SceneID),jm=At(P.IIconService),Xm=At(P.IFontService),Ym=At(P.IControlService),Zm=At(P.IGlobalConfigService),qm=At(P.IMapService),Km=At(P.ICoordinateSystemService),Qm=At(P.IRendererService),Jm=At(P.ILayerService),tx=At(P.ICameraService),ex=At(P.IInteractionService),rx=At(P.IPickingService),nx=At(P.IShaderModuleService),ix=At(P.IMarkerService),ax=At(P.IPopupService),Vm(ox=(ke=function(r){tt(t,r);var n=LG(t);function t(){var e;return $(this,t),e=n.call(this),S(I(e),"destroyed",!1),S(I(e),"loaded",!1),S(I(e),"loadFont",!1),S(I(e),"fontFamily",""),St(I(e),"id",sx,I(e)),St(I(e),"iconService",ux,I(e)),St(I(e),"fontService",lx,I(e)),St(I(e),"controlService",cx,I(e)),St(I(e),"configService",fx,I(e)),St(I(e),"map",hx,I(e)),St(I(e),"coordinateSystemService",vx,I(e)),St(I(e),"rendererService",px,I(e)),St(I(e),"layerService",dx,I(e)),St(I(e),"cameraService",gx,I(e)),St(I(e),"interactionService",yx,I(e)),St(I(e),"pickingService",mx,I(e)),St(I(e),"shaderModuleService",xx,I(e)),St(I(e),"markerService",_x,I(e)),St(I(e),"popupService",Cx,I(e)),S(I(e),"inited",!1),S(I(e),"initPromise",void 0),S(I(e),"rendering",!1),S(I(e),"$container",void 0),S(I(e),"canvas",void 0),S(I(e),"markerContainer",void 0),S(I(e),"hooks",void 0),S(I(e),"handleWindowResized",function(){e.emit("resize"),e.$container&&(e.initContainer(),dH(),e.coordinateSystemService.needRefresh=!0,e.render())}),S(I(e),"handleMapCameraChanged",function(i){e.cameraService.update(i),e.render()}),e.hooks={init:new wG},e}return H(t,[{key:"init",value:function(i){var a=this;this.configService.setSceneConfig(this.id,i),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",function(){return a.render()}),this.fontService.init(),this.hooks.init.tapPromise("initMap",Mt(st.mark(function o(){return st.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,new Promise(function(l){a.map.onCameraChanged(function(c){a.cameraService.init(),a.cameraService.update(c),l()}),a.map.init()});case 2:a.map.onCameraChanged(a.handleMapCameraChanged),a.map.addMarkerContainer(),a.markerService.addMarkers(),a.markerService.addMarkerLayers(),a.popupService.initPopup(),a.interactionService.init(),a.interactionService.on(Re.Drag,a.addSceneEvent.bind(a));case 9:case"end":return u.stop()}},o)}))),this.hooks.init.tapPromise("initRenderer",Mt(st.mark(function o(){var s,u;return st.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(s=a.map.getOverlayContainer(),s?a.$container=s:a.$container=eG(a.configService.getSceneConfig(a.id).id||""),!a.$container){c.next=12;break}return a.canvas=ye("canvas","",a.$container),a.setCanvas(),c.next=7,a.rendererService.init(a.canvas,a.configService.getSceneConfig(a.id),i.gl);case 7:a.initContainer(),ZM.exports(a.$container,a.handleWindowResized),Wt.matchMedia&&((u=Wt.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)"))===null||u===void 0||u.addListener(a.handleWindowResized)),c.next=13;break;case 12:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 13:a.pickingService.init(a.id);case 14:case"end":return c.stop()}},o)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"initMiniScene",value:function(i){var a=this;this.configService.setSceneConfig(this.id,i),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",function(){return a.render()}),this.fontService.init(),this.hooks.init.tapPromise("initMap",Mt(st.mark(function o(){return st.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,new Promise(function(l){a.map.onCameraChanged(function(c){a.cameraService.init(),a.cameraService.update(c),a.map.version!=="GAODE2.x"&&l()}),a.map.initMiniMap()});case 2:a.map.onCameraChanged(a.handleMapCameraChanged),a.interactionService.init(),a.interactionService.on(Re.Drag,a.addSceneEvent.bind(a));case 5:case"end":return u.stop()}},o)}))),this.hooks.init.tapPromise("initRenderer",Mt(st.mark(function o(){var s;return st.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(s=i.canvas,a.$container=s||null,!a.$container){l.next=7;break}return l.next=5,a.rendererService.init(i.canvas,a.configService.getSceneConfig(a.id),void 0);case 5:l.next=8;break;case 7:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 8:a.pickingService.init(a.id);case 9:case"end":return l.stop()}},o)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"addLayer",value:function(i){this.layerService.sceneService=this,this.layerService.add(i)}},{key:"addMask",value:function(i){this.layerService.sceneService=this,this.layerService.addMask(i)}},{key:"render",value:function(){var e=Mt(st.mark(function a(){return st.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(!(this.rendering||this.destroyed)){s.next=2;break}return s.abrupt("return");case 2:if(this.rendering=!0,this.inited){s.next=23;break}return s.next=6,this.initPromise;case 6:if(this.destroyed&&this.destroy(),!(this.loadFont&&document.fonts)){s.next=18;break}return s.prev=8,s.next=11,document.fonts.load("24px ".concat(this.fontFamily),"L7text");case 11:s.next=18;break;case 13:s.prev=13,s.t0=s.catch(8),console.warn("\u5F53\u524D\u73AF\u5883\u4E0D\u652F\u6301 document.fonts !"),console.warn("\u5F53\u524D\u73AF\u5883\u4E0D\u652F\u6301 iconfont !"),console.warn(s.t0);case 18:this.layerService.initLayers(),this.controlService.addControls(),this.loaded=!0,this.emit("loaded"),this.inited=!0;case 23:this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this.rendering=!1;case 26:case"end":return s.stop()}},a,this,[[8,13]])}));function i(){return e.apply(this,arguments)}return i}()},{key:"addFontFace",value:function(i,a){this.fontFamily=i;var o=document.createElement("style");o.type="text/css",o.innerText=`
        @font-face{
            font-family: '`.concat(i,`';
            src: url('`).concat(a,`') format('woff2'),
            url('`).concat(a,`') format('woff'),
            url('`).concat(a,`') format('truetype');
        }`),document.getElementsByTagName("head")[0].appendChild(o),this.loadFont=!0}},{key:"getSceneContainer",value:function(){return this.$container}},{key:"exportPng",value:function(i){var a,o=(a=this.$container)===null||a===void 0?void 0:a.getElementsByTagName("canvas")[0];this.render();var s=i==="jpg"?o==null?void 0:o.toDataURL("image/jpeg"):o==null?void 0:o.toDataURL("image/png");return s}},{key:"getSceneConfig",value:function(){return this.configService.getSceneConfig(this.id)}},{key:"getPointSizeRange",value:function(){return this.rendererService.getPointSizeRange()}},{key:"addMarkerContainer",value:function(){var i=this.$container.parentElement;i!==null&&(this.markerContainer=ye("div","l7-marker-container",i))}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"destroy",value:function(){var i=this,a,o;if(!this.inited){this.destroyed=!0;return}if(this.emit("destroy"),this.pickingService.destroy(),this.layerService.destroy(),setTimeout(function(){var u;(u=i.$container)===null||u===void 0||u.removeChild(i.canvas),i.canvas=null,i.rendererService.destroy()}),this.map.destroy(),this.interactionService.destroy(),this.controlService.destroy(),this.markerService.destroy(),this.fontService.destroy(),this.iconService.destroy(),(a=this.$container)===null||a===void 0||(o=a.parentNode)===null||o===void 0||o.removeChild(this.$container),this.removeAllListeners(),this.inited=!1,qM(this.$container,this.handleWindowResized),Wt.matchMedia){var s;(s=Wt.matchMedia("screen and (min-resolution: 2dppx)"))===null||s===void 0||s.removeListener(this.handleWindowResized)}}},{key:"initContainer",value:function(){var i,a,o=se,s=((i=this.$container)===null||i===void 0?void 0:i.clientWidth)||400,u=((a=this.$container)===null||a===void 0?void 0:a.clientHeight)||300,l=this.canvas;l&&(l.width=s*o,l.height=u*o),this.rendererService.viewport({x:0,y:0,width:o*s,height:o*u})}},{key:"setCanvas",value:function(){var i,a,o=se,s=((i=this.$container)===null||i===void 0?void 0:i.clientWidth)||400,u=((a=this.$container)===null||a===void 0?void 0:a.clientHeight)||300,l=this.canvas;l.width=s*o,l.height=u*o,l.style.width="100%",l.style.height="100%"}},{key:"addSceneEvent",value:function(i){this.emit(i.type,i)}}]),t}(dn.exports.EventEmitter),sx=Ct(ke.prototype,"id",[Wm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ux=Ct(ke.prototype,"iconService",[jm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lx=Ct(ke.prototype,"fontService",[Xm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cx=Ct(ke.prototype,"controlService",[Ym],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fx=Ct(ke.prototype,"configService",[Zm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hx=Ct(ke.prototype,"map",[qm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vx=Ct(ke.prototype,"coordinateSystemService",[Km],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),px=Ct(ke.prototype,"rendererService",[Qm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dx=Ct(ke.prototype,"layerService",[Jm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gx=Ct(ke.prototype,"cameraService",[tx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yx=Ct(ke.prototype,"interactionService",[ex],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mx=Ct(ke.prototype,"pickingService",[rx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xx=Ct(ke.prototype,"shaderModuleService",[nx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_x=Ct(ke.prototype,"markerService",[ix],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Cx=Ct(ke.prototype,"popupService",[ax],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ke))||ox);function OG(r){var n=0;switch(r){case"vec2":case"ivec2":n=2;break;case"vec3":case"ivec3":n=3;break;case"vec4":case"ivec4":case"mat2":n=4;break;case"mat3":n=9;break;case"mat4":n=16;break}return n}var RG=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function Ex(r){var n={};return r=r.replace(RG,function(t,e,i){var a=i.split(":"),o=a[0].trim(),s="";switch(a.length>1&&(s=a[1].trim()),e){case"bool":s=s==="true";break;case"float":case"int":s=Number(s);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":s?s=s.replace("[","").replace("]","").split(",").reduce(function(u,l){return u.push(Number(l.trim())),u},[]):s=new Array(OG(e)).fill(0);break}return n[o]=s,"uniform ".concat(e," ").concat(o,`;
`)}),{content:r,uniforms:n}}var Sx,bx,Ax="#define PI 3.14159265359",IG=`#define SHIFT_RIGHT17 1.0 / 131072.0
#define SHIFT_RIGHT18 1.0 / 262144.0
#define SHIFT_RIGHT19 1.0 / 524288.0
#define SHIFT_RIGHT20 1.0 / 1048576.0
#define SHIFT_RIGHT21 1.0 / 2097152.0
#define SHIFT_RIGHT22 1.0 / 4194304.0
#define SHIFT_RIGHT23 1.0 / 8388608.0
#define SHIFT_RIGHT24 1.0 / 16777216.0

#define SHIFT_LEFT17 131072.0
#define SHIFT_LEFT18 262144.0
#define SHIFT_LEFT19 524288.0
#define SHIFT_LEFT20 1048576.0
#define SHIFT_LEFT21 2097152.0
#define SHIFT_LEFT22 4194304.0
#define SHIFT_LEFT23 8388608.0
#define SHIFT_LEFT24 16777216.0

vec2 unpack_float(float packedValue) {
  int packedIntValue = int(packedValue);
  int v0 = packedIntValue / 256;
  return vec2(v0, packedIntValue - v0 * 256);
}

vec4 decode_color(vec2 encodedColor) {
  return vec4(
    unpack_float(encodedColor[0]) / 255.0,
    unpack_float(encodedColor[1]) / 255.0
  );
}
`,DG=`#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2


float calc_lighting(vec4 pos) {

    vec3 worldPos = vec3(pos * u_ModelMatrix);

    vec3 worldNormal = a_Normal;
      // //cal light weight
    vec3 viewDir = normalize(u_CameraPosition - worldPos);

    vec3 lightDir = normalize(vec3(1, -10.5, 12));

    vec3 halfDir = normalize(viewDir+lightDir);
      // //lambert
    float lambert = dot(worldNormal, lightDir);
        //specular
    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);
        //sum to light weight
    float lightWeight = ambientRatio + diffuseRatio * lambert + specularRatio * specular;

    return lightWeight;
}
`,PG=`// Blinn-Phong model
// apply lighting in vertex shader instead of fragment shader
// @see https://learnopengl.com/Advanced-Lighting/Advanced-Lighting
uniform float u_Ambient : 1.0;
uniform float u_Diffuse : 1.0;
uniform float u_Specular : 1.0;
uniform int u_NumOfDirectionalLights : 1;
uniform int u_NumOfSpotLights : 0;

#define SHININESS 32.0
#define MAX_NUM_OF_DIRECTIONAL_LIGHTS 3
#define MAX_NUM_OF_SPOT_LIGHTS 3

struct DirectionalLight {
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
};

struct SpotLight {
  vec3 position;
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
  float constant;
  float linear;
  float quadratic;
  float angle;
  float blur;
  float exponent;
};

uniform DirectionalLight u_DirectionalLights[MAX_NUM_OF_DIRECTIONAL_LIGHTS];
uniform SpotLight u_SpotLights[MAX_NUM_OF_SPOT_LIGHTS];

vec3 calc_directional_light(DirectionalLight light, vec3 normal, vec3 viewDir) {
  vec3 lightDir = normalize(light.direction);
  // diffuse shading
  float diff = max(dot(normal, lightDir), 0.0);
  // Blinn-Phong specular shading
  vec3 halfwayDir = normalize(lightDir + viewDir);
  float spec = pow(max(dot(normal, halfwayDir), 0.0), SHININESS);

  vec3 ambient = light.ambient * u_Ambient;
  vec3 diffuse = light.diffuse * diff * u_Diffuse;
  vec3 specular = light.specular * spec * u_Specular;

  return ambient + diffuse + specular;
}

// vec3 calc_spot_light(SpotLight light, vec3 normal, vec3 fragPos, vec3 viewDir) {
//   vec3 lightDir = normalize(light.position - fragPos);
//   // diffuse shading
//   float diff = max(dot(normal, lightDir), 0.0);
//   // specular shading
//   vec3 reflectDir = reflect(-lightDir, normal);
//   float spec = pow(max(dot(viewDir, reflectDir), 0.0), SHININESS);
//   // attenuation
//   float distance = length(light.position - fragPos);
//   float attenuation = 1.0 / (light.constant + light.linear * distance +
//           light.quadratic * (distance * distance));

//   vec3 ambient = light.ambient * u_Ambient;
//   vec3 diffuse = light.diffuse * diff * u_Diffuse;
//   vec3 specular = light.specular * spec * u_Specular;

//   float spotEffect = dot(normalize(light.direction), -lightDir);
//   float spotCosCutoff = cos(light.angle / 180.0 * PI);
//   float spotCosOuterCutoff = cos((light.angle + light.blur) / 180.0 * PI);
//   float spotCosInnerCutoff = cos((light.angle - light.blur) / 180.0 * PI);
//   if (spotEffect > spotCosCutoff) {
//     spotEffect = pow(smoothstep(spotCosOuterCutoff, spotCosInnerCutoff, spotEffect), light.exponent);
//   } else {
//     spotEffect = 0.0;
//   }

//   return ambient + attenuation * (spotEffect * diffuse + specular);
// }

vec3 calc_lighting(vec3 position, vec3 normal, vec3 viewDir) {
  vec3 weight = vec3(0.0);
  for (int i = 0; i < MAX_NUM_OF_DIRECTIONAL_LIGHTS; i++) {
    if (i >= u_NumOfDirectionalLights) {
      break;
    }
    weight += calc_directional_light(u_DirectionalLights[i], normal, viewDir);
  }
  // for (int i = 0; i < MAX_NUM_OF_SPOT_LIGHTS; i++) {
  //   if (i >= u_NumOfSpotLights) {
  //     break;
  //   }
  //   weight += calc_spot_light(u_SpotLights[i], normal, position, viewDir);
  // }
  return weight;
}
`,BG=`varying vec4 v_PickingResult;
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform vec4 u_SelectColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_shaderPick;

uniform float u_activeMix: 0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define HIGHLIGHT 1.0
#define SELECT 2.0

/*
 * Returns highlight color if this item is selected.
 */
vec4 filterHighlightColor(vec4 color, float weight) {
  // float selected = v_PickingResult.a;
  bool selected = bool(v_PickingResult.a);

  // if (selected == SELECT) {
  if (selected) {
  //   // \u70B9\u51FB\u9009\u4E2D\u72B6\u6001
  //   vec4 selectColor = u_SelectColor * COLOR_SCALE;
  //   return selectColor;
  // } else if (selected == HIGHLIGHT) {
  //   // hover \u9AD8\u4EAE\u72B6\u6001
    vec4 highLightColor = u_HighlightColor * COLOR_SCALE;

    float highLightAlpha = highLightColor.a;
    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));

    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);
    return vec4(mix(resultRGB * weight, color.rgb, u_activeMix), color.a);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 filterPickingColor(vec4 color) {
  vec3 pickingColor = v_PickingResult.rgb;
  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {
    discard;
  }
  return u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 filterColor(vec4 color) {
  // TODO: \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, 1.0));
  }
  
}

vec4 filterColorAlpha(vec4 color, float alpha) {
  // TODO: \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, alpha));
  }
}

`,NG=`attribute vec3 a_PickingColor;
varying vec4 v_PickingResult;

uniform vec3 u_PickingColor : [0, 0, 0];
uniform vec3 u_CurrentSelectedId : [0, 0, 0];
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform vec4 u_SelectColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_PickingThreshold : 1.0;
uniform float u_PickingBuffer: 0.0;
uniform float u_shaderPick;
uniform float u_EnableSelect: 0.0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define NORMAL 0.0
#define HIGHLIGHT 1.0
#define SELECT 2.0

bool isVertexPicked(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_PickingColor.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_PickingColor.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_PickingColor.b) < u_PickingThreshold;
}

// \u5224\u65AD\u5F53\u524D\u70B9\u662F\u5426\u5DF2\u7ECF\u88AB select \u9009\u4E2D
bool isVertexSelected(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_CurrentSelectedId.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_CurrentSelectedId.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_CurrentSelectedId.b) < u_PickingThreshold;
}

void setPickingColor(vec3 pickingColor) {
  if(u_shaderPick < 0.5) {
    return;
  }
  // compares only in highlight stage

  v_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && isVertexPicked(pickingColor));

  // if (u_EnableSelect == 1.0 && u_PickingStage == PICKING_HIGHLIGHT && isVertexSelected(pickingColor)) {
  //   // \u9009\u4E2D\u6001
  //   v_PickingResult.a = SELECT;
  // } else if (u_PickingStage == PICKING_HIGHLIGHT && isVertexPicked(pickingColor)) {
  //   // \u9AD8\u4EAE\u6001
  //   v_PickingResult.a = HIGHLIGHT;
  // } else {
  //   v_PickingResult.a = NORMAL;
  // }

  // Stores the picking color so that the fragment shader can render it during picking
  v_PickingResult.rgb = pickingColor * COLOR_SCALE;
}

float setPickingSize(float x) {
   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;
}

float setPickingOrder(float z) {
   bool selected = bool(v_PickingResult.a);
   return selected ? z + 1. : 0.;
}
`,zG=`
#define E 2.718281828459045
vec2 ProjectFlat(vec2 lnglat){
  float maxs=85.0511287798;
  float lat=max(min(maxs,lnglat.y),-maxs);
  float scale= 268435456.;
  float d=PI/180.;
  float x=lnglat.x*d;
  float y=lat*d;
  y=log(tan((PI/4.)+(y/2.)));

  float a=.5/PI,
  b=.5,
  c=-.5/PI;
  d=.5;
  x=scale*(a*x+b);
  y=scale*(c*y+d);
  return vec2(x,y);
}

vec2 unProjectFlat(vec2 px){
  float a=.5/PI;
  float b=.5;
  float c=-.5/PI;
  float d=.5;
  float scale = 268435456.;
  float x=(px.x/scale-b)/a;
  float y=(px.y/scale-d)/c;
  y=(atan(pow(E,y))-(PI/4.))*2.;
  d=PI/180.;
  float lat=y/d;
  float lng=x/d;
  return vec2(lng,lat);
}

float pixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}

// gaode2.0
vec2 customProject(vec2 lnglat) { // \u7ECF\u7EAC\u5EA6 => \u5E73\u9762\u5750\u6807
  float t = lnglat.x;
  float e = lnglat.y;
  float Sm = 180.0 / PI;
  float Tm = 6378137.0;
  float Rm = PI / 180.0;
  float r = 85.0511287798;
  e = max(min(r, e), -r);
  t *= Rm;
  e *= Rm;
  e = log(tan(PI / 4.0 + e / 2.0));
  return vec2(t * Tm, e * Tm);
}

vec2 unProjCustomCoord(vec2 point) { // \u5E73\u9762\u5750\u6807 => \u7ECF\u7EAC\u5EA6
  float Sm = 57.29577951308232; //180 / Math.PI
  float Tm = 6378137.0;
  float t = point.x;
  float e = point.y;
  return vec2(t / Tm * Sm, (2.0 * atan(exp(e / Tm)) - PI / 2.0) * Sm);
}


float customPixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}`,UG=`#define TILE_SIZE 512.0
#define PI 3.1415926536
#define WORLD_SCALE TILE_SIZE / (PI * 2.0)

#define COORDINATE_SYSTEM_LNGLAT 1.0        // mapbox
#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0 // mapbox offset
#define COORDINATE_SYSTEM_VECTOR_TILE 3.0
#define COORDINATE_SYSTEM_IDENTITY 4.0
#define COORDINATE_SYSTEM_P20 5.0           // amap
#define COORDINATE_SYSTEM_P20_OFFSET 6.0    // amap offset
#define COORDINATE_SYSTEM_METER_OFFSET 7.0

#define COORDINATE_SYSTEM_P20_2 8.0         // amap2.0

uniform mat4 u_ViewMatrix;
uniform mat4 u_ProjectionMatrix;
uniform mat4 u_ViewProjectionMatrix;
uniform float u_Zoom : 1;
uniform float u_ZoomScale : 1;

uniform float u_CoordinateSystem;
uniform vec2 u_ViewportCenter;
uniform vec4 u_ViewportCenterProjection;
uniform vec3 u_PixelsPerDegree;
uniform vec3 u_PixelsPerDegree2;
uniform vec3 u_PixelsPerMeter;

uniform vec2 u_ViewportSize;
uniform float u_DevicePixelRatio;
uniform float u_FocalDistance;
uniform vec3 u_CameraPosition;

// uniform mat4 u_Mvp;

// web mercator coords -> world coords
vec2 project_mercator(vec2 lnglat) {
  float x = lnglat.x;
  return vec2(
    radians(x) + PI,
    PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5))
  );
}

float project_scale(float meters) {
  return meters * u_PixelsPerMeter.z;
}


// offset coords -> world coords
vec4 project_offset(vec4 offset) {
  float dy = offset.y;
  dy = clamp(dy, -1., 1.);
  vec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;
  return vec4(offset.xyz * pixels_per_unit, offset.w);
}

vec3 project_normal(vec3 normal) {
  vec4 normal_modelspace = u_ModelMatrix * vec4(normal, 0.0);
  return normalize(normal_modelspace.xyz * u_PixelsPerMeter);
}

vec3 project_offset_normal(vec3 vector) {
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01
    || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // normals generated by the polygon tesselator are in lnglat offsets instead of meters
    return normalize(vector * u_PixelsPerDegree);
  }
  return project_normal(vector);
}
// || u_CoordinateSystem < COORDINATE_SYSTEM_P20_OFFSET + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_P20_OFFSET - 0.01
// reverse Y
vec3 reverse_offset_normal(vec3 vector) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 ||u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET ) {
    return vector * vec3(1.0, -1.0, 1.0);
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0
    return vector;
  }
  return vector;
}

vec4 project_mvt_offset_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    return project_offset(vec4(0.0, 0.0, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }
  return position;
}

vec4 project_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    float X = position.x - u_ViewportCenter.x;
    float Y = position.y - u_ViewportCenter.y;
    return project_offset(vec4(X, Y, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return vec4(
      (project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale - vec2(215440491., 106744817.)) * vec2(1., -1.),
      project_scale(position.z),
      position.w
    );
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // return vec4(
    //   (position.xy * WORLD_SCALE * u_ZoomScale) * vec2(1., -1.), 
    //   project_scale(position.z), 
    //   position.w);

     return vec4(
      position.xy, 
      project_scale(position.z), 
      position.w);
  }
  return position;

  // TODO: \u74E6\u7247\u5750\u6807\u7CFB & \u5E38\u89C4\u4E16\u754C\u5750\u6807\u7CFB
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / u_ViewportSize * u_DevicePixelRatio * 2.0;
  return offset * u_FocalDistance;
}

float project_pixel_allmap(float pixel) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
    return pixel * pow(2.0, u_Zoom);
  }
  return pixel;
}

// \u9002\u914D\u7EB9\u7406\u8D34\u56FE\u7684\u7B49\u50CF\u7D20\u5927\u5C0F
float project_pixel_texture(float pixel) {
  // mapbox zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    return pixel * pow(0.5, u_Zoom);
  }

  // amap2 zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }

  // amap zoom > 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    return pixel * pow(0.5, u_Zoom);
  }
  
  // amap zoom < 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return pixel * pow(2.0, (20.0 - u_Zoom));
  }
  return pixel * 2.0;
}

// \u5728\u4E0D\u8BBA\u4EC0\u4E48\u5E95\u56FE\u4E0B\u9700\u8981\u7EDF\u4E00\u5904\u7406\u7684\u65F6\u5019\u4F7F\u7528
float project_float_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // mapbox P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel;
}

float project_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel;
}
vec2 project_pixel(vec2 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel * -1.;
}
vec3 project_pixel(vec3 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel * -1.;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    position.w *= u_PixelsPerMeter.z;
  }

  return viewProjectionMatrix * position + center;
}

// Projects from common space coordinates to clip space
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(
    position,
    u_ViewProjectionMatrix,
    u_ViewportCenterProjection
  );
}

vec4 unproject_clipspace_to_position(vec4 clipspacePos, mat4 u_InverseViewProjectionMatrix) {
  vec4 pos = u_InverseViewProjectionMatrix * (clipspacePos - u_ViewportCenterProjection);

  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
     pos.w = pos.w / u_PixelsPerMeter.z;
  }
  return pos;
}


bool isEqual( float a,  float b) {
    return  a< b + 0.001 && a > b - 0.001;
}`,HG=`/**
 * 2D signed distance field functions
 * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm
 */

float ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }

float sdCircle(vec2 p, float r) {
  return length(p) - r;
}

float sdEquilateralTriangle(vec2 p) {
  float k = sqrt(3.0);
  p.x = abs(p.x) - 1.0;
  p.y = p.y + 1.0/k;
  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;
  p.x -= clamp( p.x, -2.0, 0.0 );
  return -length(p)*sign(p.y);
}

float sdBox(vec2 p, vec2 b) {
  vec2 d = abs(p)-b;
  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);
}

float sdPentagon(vec2 p, float r) {
  vec3 k = vec3(0.809016994,0.587785252,0.726542528);
  p.x = abs(p.x);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);
  return length(p)*sign(p.y);
}

float sdHexagon(vec2 p, float r) {
  vec3 k = vec3(-0.866025404,0.5,0.577350269);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdOctogon(vec2 p, float r) {
  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );
  p = abs(p);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdHexagram(vec2 p, float r) {
  vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;
  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);
  return length(p)*sign(p.y);
}

float sdRhombus(vec2 p, vec2 b) {
  vec2 q = abs(p);
  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);
  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );
  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );
}

float sdVesica(vec2 p, float r, float d) {
  p = abs(p);
  float b = sqrt(r*r-d*d); // can delay this sqrt
  return ((p.y-b)*d>p.x*b)
          ? length(p-vec2(0.0,b))
          : length(p-vec2(-d,0.0))-r;
}
`,$G=`attribute float a_vertexId;

uniform mat4 u_cellTypeLayout;      // \u63CF\u8FF0\u6570\u636E\u7EB9\u7406 cell \u7ED3\u6784\u7684\u77E9\u9635
uniform sampler2D u_dataTexture;    // \u6570\u636E\u7EB9\u7406

bool hasOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 opacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeOpacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeWidth() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeWidth \u7684\u6570\u636E
  return u_cellTypeLayout[1][2] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStroke() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 stroke \u7684\u6570\u636E
  return u_cellTypeLayout[1][3] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasOffsets() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 offsets \u7684\u6570\u636E
  return u_cellTypeLayout[2][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasThetaOffset() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 thetaOffset \u7684\u6570\u636E
  return u_cellTypeLayout[2][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

// \u6839\u636E\u5750\u6807\u4F4D\u7F6E\u5148\u662F\u8BA1\u7B97 uv \uFF0C\u7136\u540E\u6839\u636E uv \u4ECE\u6570\u636E\u7EB9\u7406\u4E2D\u53D6\u503C
float pos2value(vec2 pos, float columnWidth, float rowHeight) {
  float u = (pos.r - 1.0) * columnWidth + columnWidth/2.0;
  float v = 1.0 - ((pos.g - 1.0) * rowHeight + rowHeight/2.0);
  return texture2D(u_dataTexture, vec2(u, v)).r;
}

/*
  currentRow \u5F53\u524D\u884C
  currentColumn \u5F53\u524D\u5217
  columnCount \u6709\u591A\u5C11\u5217
  nextStep \u9700\u8981\u8BA1\u7B97\u5F53\u524D cell \u540E\u7684\u7B2C\u51E0\u4E2A cell \uFF08\u5F53\u524D cell \u5219 nextStep = 0\uFF09
*/
vec2 nextPos(float currentRow, float currentColumn, float columnCount, float nextStep) {
  float nextColumn = currentColumn;
  float nextRow = currentRow;
  if(currentColumn + nextStep <= columnCount){
    nextColumn = currentColumn + nextStep;
  } else {
    nextColumn = mod(currentColumn + nextStep, columnCount); // \u4E0D\u4F1A\u51FA\u73B0\u8DE8\u4E24\u884C
    nextRow = currentRow + 1.0;
  }
  return vec2(nextColumn, nextRow);
}

// \u8BA1\u7B97\u5F53\u524D\u5355\u4E2A cell \u7684\u5927\u5C0F
float calCellCount() { 
  //   u_cellTypeLayout
  //   cal_height, WIDTH, 0.0, 0.0, // rowCount columnCount - \u51E0\u884C\u51E0\u5217
  //   1.0, 1.0, 1.0, 0.0, // opacity strokeOpacity strokeWidth stroke - 1.0 \u8868\u793A\u6709\u6570\u636E\u6620\u5C04\u30010.0 \u8868\u793A\u6CA1\u6709
  //   1.0, 1.0, 0.0, 0.0, // offsets thetaOffset
  //   0.0, 0.0, 0.0, 0.0
  
  return  u_cellTypeLayout[1][0] +        // opacity
          u_cellTypeLayout[1][1] +        // strokeOpacity
          u_cellTypeLayout[1][2] +        // strokeWidth
          u_cellTypeLayout[1][3] * 4.0 +  // stroke
          u_cellTypeLayout[2][0] * 2.0 +  // offsets
          u_cellTypeLayout[2][1];         // thetaOffset
}`,GG=`
// \u8BA1\u7B97 opacity \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasOpacity()) { // \u6570\u636E\u7EB9\u7406\u4E2D\u4E0D\u5B58\u5728 opacity \u7684\u65F6\u5019\u53D6\u9ED8\u8BA4\u503C\uFF08\u7528\u6237\u5728 style \u4E2D\u4F20\u5165\u7684\u662F\u5E38\u91CF\uFF09
    return vec2(u_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureOpacity, textureOffset + 1.0);
  }
}
`,VG=`
// \u8BA1\u7B97 strokeOpaicty \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeOpacity()) {
    return vec2(u_stroke_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeOpacity, textureOffset + 1.0);
  }
}
`,WG=`
// \u8BA1\u7B97 strokeWidth \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeWidthAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeWidth()) {
    return vec2(u_stroke_width, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeWidth = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeWidth, textureOffset + 1.0);
  }
}
`,jG=`
// \u8BA1\u7B97 thetaOffset \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calThetaOffsetAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasThetaOffset()) { // \u6570\u636E\u7EB9\u7406\u4E2D\u4E0D\u5B58\u5728 thetaOffset \u7684\u65F6\u5019\u53D6\u9ED8\u8BA4\u503C\uFF08\u7528\u6237\u5728 style \u4E2D\u4F20\u5165\u7684\u662F\u5E38\u91CF\uFF09
    return vec2(u_thetaOffset, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureThetaOffset = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureThetaOffset, textureOffset + 1.0);
  }
}
`,XG=/precision\s+(high|low|medium)p\s+float/,YG=`#ifdef GL_FRAGMENT_PRECISION_HIGH
 precision highp float;
 #else
 precision mediump float;
#endif
`,ZG=/#pragma include (["^+"]?["[a-zA-Z_0-9](.*)"]*?)/g,qG=(Sx=xt(),Sx(bx=function(){function r(){$(this,r),S(this,"moduleCache",{}),S(this,"rawContentCache",{})}return H(r,[{key:"registerBuiltinModules",value:function(){this.destroy(),this.registerModule("common",{vs:Ax,fs:Ax}),this.registerModule("decode",{vs:IG,fs:""}),this.registerModule("projection",{vs:UG,fs:""}),this.registerModule("project",{vs:zG,fs:""}),this.registerModule("sdf_2d",{vs:"",fs:HG}),this.registerModule("lighting",{vs:PG,fs:""}),this.registerModule("light",{vs:DG,fs:""}),this.registerModule("picking",{vs:NG,fs:BG}),this.registerModule("styleMapping",{vs:$G,fs:""}),this.registerModule("styleMappingCalThetaOffset",{vs:jG,fs:""}),this.registerModule("styleMappingCalOpacity",{vs:GG,fs:""}),this.registerModule("styleMappingCalStrokeOpacity",{vs:VG,fs:""}),this.registerModule("styleMappingCalStrokeWidth",{vs:WG,fs:""})}},{key:"registerModule",value:function(t,e){if(!this.rawContentCache[t]){var i=e.vs,a=e.fs,o=e.uniforms,s=Ex(i),u=s.content,l=s.uniforms,c=Ex(a),f=c.content,h=c.uniforms;this.rawContentCache[t]={fs:f,uniforms:U(U(U({},l),h),o),vs:u}}}},{key:"destroy",value:function(){this.moduleCache={},this.rawContentCache={}}},{key:"getModule",value:function(t){var e=this;if(this.moduleCache[t])return this.moduleCache[t];var i=this.rawContentCache[t].vs,a=this.rawContentCache[t].fs,o=this.processModule(i,[],"vs"),s=o.content,u=o.includeList,l=this.processModule(a,[],"fs"),c=l.content,f=l.includeList,h=c,v=Y.exports.uniq(u.concat(f).concat(t)).reduce(function(p,d){return U(U({},p),e.rawContentCache[d].uniforms)},{});return XG.test(c)||(h=YG+c),this.moduleCache[t]={fs:h.trim(),uniforms:v,vs:s.trim()},this.moduleCache[t]}},{key:"processModule",value:function(t,e,i){var a=this,o=t.replace(ZG,function(s,u){var l=u.split(" "),c=l[0].replace(/"/g,"");if(e.indexOf(c)>-1)return"";var f=a.rawContentCache[c][i];e.push(c);var h=a.processModule(f,e,i),v=h.content;return v});return{content:o,includeList:e}}}]),r}())||bx),gi;(function(r){r.Normal="normal",r.PostProcessing="post-processing"})(gi||(gi={}));var Tx,Mx,Rc=(Tx=xt(),Tx(Mx=function(){function r(){$(this,r),S(this,"shaderModuleService",void 0),S(this,"rendererService",void 0),S(this,"cameraService",void 0),S(this,"mapService",void 0),S(this,"interactionService",void 0),S(this,"layerService",void 0),S(this,"config",void 0)}return H(r,[{key:"getName",value:function(){return""}},{key:"getType",value:function(){return gi.Normal}},{key:"init",value:function(t,e){this.config=e,this.rendererService=t.getContainer().get(P.IRendererService),this.cameraService=t.getContainer().get(P.ICameraService),this.mapService=t.getContainer().get(P.IMapService),this.interactionService=t.getContainer().get(P.IInteractionService),this.layerService=t.getContainer().get(P.ILayerService),this.shaderModuleService=t.getContainer().get(P.IShaderModuleService)}},{key:"render",value:function(t){}}]),r}())||Mx),Lx,Fx;function KG(r){var n=QG();return function(){var e=B(r),i;if(n){var a=B(this).constructor;i=Reflect.construct(e,arguments,a)}else i=e.apply(this,arguments);return et(this,i)}}function QG(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var JG=(Lx=xt(),Lx(Fx=function(r){tt(t,r);var n=KG(t);function t(){return $(this,t),n.apply(this,arguments)}return H(t,[{key:"getName",value:function(){return"clear"}},{key:"init",value:function(i,a){Ol(B(t.prototype),"init",this).call(this,i,a)}},{key:"render",value:function(){this.rendererService.clear({color:[0,0,0,0],depth:1,framebuffer:null})}}]),t}(Rc))||Fx),kx,Ox,Rx,kf,Ix;function tV(r,n){var t=typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(!t){if(Array.isArray(r)||(t=eV(r))||n&&r&&typeof r.length=="number"){t&&(r=t);var e=0,i=function(){};return{s:i,n:function(){return e>=r.length?{done:!0}:{done:!1,value:r[e++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){t=t.call(r)},n:function(){var l=t.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(o)throw s}}}}function eV(r,n){if(!!r){if(typeof r=="string")return Dx(r,n);var t=Object.prototype.toString.call(r).slice(8,-1);if(t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set")return Array.from(r);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Dx(r,n)}}function Dx(r,n){(n==null||n>r.length)&&(n=r.length);for(var t=0,e=new Array(n);t<n;t++)e[t]=r[t];return e}var rV=(kx=xt(),Ox=At(P.IPostProcessor),kx(Rx=(kf=function(){function r(){$(this,r),S(this,"passes",[]),St(this,"postProcessor",Ix,this),S(this,"layer",void 0),S(this,"renderFlag",void 0),S(this,"width",0),S(this,"height",0)}return H(r,[{key:"setLayer",value:function(t){this.layer=t}},{key:"setRenderFlag",value:function(t){this.renderFlag=t}},{key:"getRenderFlag",value:function(){return this.renderFlag}},{key:"getPostProcessor",value:function(){return this.postProcessor}},{key:"render",value:function(){var n=Mt(st.mark(function e(){var i,a,o;return st.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:i=tV(this.passes),u.prev=1,i.s();case 3:if((a=i.n()).done){u.next=9;break}return o=a.value,u.next=7,o.render(this.layer);case 7:u.next=3;break;case 9:u.next=14;break;case 11:u.prev=11,u.t0=u.catch(1),i.e(u.t0);case 14:return u.prev=14,i.f(),u.finish(14);case 17:return u.next=19,this.postProcessor.render(this.layer);case 19:case"end":return u.stop()}},e,this,[[1,11,14,17]])}));function t(){return n.apply(this,arguments)}return t}()},{key:"resize",value:function(t,e){(this.width!==t||this.height!==e)&&(this.postProcessor.resize(t,e),this.width=t,this.height=e)}},{key:"add",value:function(t,e){t.getType()===gi.PostProcessing?this.postProcessor.add(t,this.layer,e):(t.init(this.layer,e),this.passes.push(t))}},{key:"insert",value:function(t,e,i){t.init(this.layer,e),this.passes.splice(i,0,t)}},{key:"destroy",value:function(){this.passes.length=0}}]),r}(),Ix=Ct(kf.prototype,"postProcessor",[Ox],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kf))||Rx),Px,Bx;function nV(r){var n=iV();return function(){var e=B(r),i;if(n){var a=B(this).constructor;i=Reflect.construct(e,arguments,a)}else i=e.apply(this,arguments);return et(this,i)}}function iV(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var aV=(Px=xt(),Px(Bx=function(r){tt(t,r);var n=nV(t);function t(){var e;$(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return e=n.call.apply(n,[this].concat(a)),S(I(e),"pickingFBO",void 0),S(I(e),"layer",void 0),S(I(e),"width",0),S(I(e),"height",0),S(I(e),"alreadyInRendering",!1),S(I(e),"pickFromPickingFBO",function(s){var u=s.x,l=s.y,c=s.lngLat,f=s.type;if(!(!e.layer.isVisible()||!e.layer.needPick(f))){var h=e.rendererService,v=h.getViewportSize,p=h.readPixels,d=h.useFramebuffer,g=v(),y=g.width,m=g.height,x=e.layer.getLayerConfig(),_=x.enableHighlight,E=x.enableSelect,b=u*se,M=l*se;if(!(b>y||b<0||M>m||M<0)){var T;d(e.pickingFBO,function(){var k;if(T=p({x:Math.round(b),y:Math.round(m-(l+1)*se),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:e.pickingFBO}),T[0]!==0||T[1]!==0||T[2]!==0){var L=cn(T),O=e.layer.getSource().getFeatureById(L),D={x:u,y:l,type:f,lngLat:c,featureId:L,feature:O};O&&(e.layer.setCurrentPickId(L),e.triggerHoverOnLayer(D))}else{var W={x:u,y:l,lngLat:c,type:e.layer.getCurrentPickId()===null?"un"+f:"mouseout",featureId:null,feature:null};e.triggerHoverOnLayer(U(U({},W),{},{type:"unpick"})),e.triggerHoverOnLayer(W),e.layer.setCurrentPickId(null)}_&&e.highlightPickedFeature(T),E&&f==="click"&&((k=T)===null||k===void 0?void 0:k.toString())!==[0,0,0,0].toString()&&e.selectFeature(T)})}}}),e}return H(t,[{key:"getType",value:function(){return gi.Normal}},{key:"getName",value:function(){return"pixelPicking"}},{key:"init",value:function(i,a){Ol(B(t.prototype),"init",this).call(this,i,a),this.layer=i;var o=this.rendererService,s=o.createTexture2D,u=o.createFramebuffer,l=o.getViewportSize,c=l(),f=c.width,h=c.height;this.pickingFBO=u({color:s({width:f,height:h,wrapS:A.CLAMP_TO_EDGE,wrapT:A.CLAMP_TO_EDGE})}),this.interactionService.on(Re.Hover,this.pickFromPickingFBO),this.interactionService.on(Re.Select,this.selectFeatureHandle.bind(this)),this.interactionService.on(Re.Active,this.highlightFeatureHandle.bind(this))}},{key:"render",value:function(i){var a=this;if(!this.alreadyInRendering){var o=this.rendererService,s=o.getViewportSize,u=o.useFramebuffer,l=o.clear,c=s(),f=c.width,h=c.height;this.alreadyInRendering=!0,(this.width!==f||this.height!==h)&&(this.pickingFBO.resize({width:f,height:h}),this.width=f,this.height=h),u(this.pickingFBO,function(){l({framebuffer:a.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});var v=a.layer.multiPassRenderer.getRenderFlag();a.layer.multiPassRenderer.setRenderFlag(!1),i.hooks.beforePickingEncode.call(),i.render(),i.hooks.afterPickingEncode.call(),a.layer.multiPassRenderer.setRenderFlag(v),a.alreadyInRendering=!1})}}},{key:"triggerHoverOnLayer",value:function(i){this.layer.emit(i.type,i)}},{key:"highlightPickedFeature",value:function(i){var a=kt(i,3),o=a[0],s=a[1],u=a[2];this.layer.hooks.beforeHighlight.call([o,s,u]),this.layerService.renderLayers()}},{key:"selectFeature",value:function(i){var a=kt(i,3),o=a[0],s=a[1],u=a[2];this.layer.hooks.beforeSelect.call([o,s,u]),this.layerService.renderLayers()}},{key:"selectFeatureHandle",value:function(i){var a=i.featureId,o=di(a);this.selectFeature(new Uint8Array(o))}},{key:"highlightFeatureHandle",value:function(i){var a=i.featureId,o=di(a);this.highlightPickedFeature(new Uint8Array(o))}}]),t}(Rc))||Bx),Nx,zx,Ux,Of,Hx,oV=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Dn=(Nx=xt(),zx=At(P.IShaderModuleService),Nx(Ux=(Of=function(){function r(){$(this,r),St(this,"shaderModuleService",Hx,this),S(this,"rendererService",void 0),S(this,"config",void 0),S(this,"quad",oV),S(this,"enabled",!0),S(this,"renderToScreen",!1),S(this,"model",void 0),S(this,"name",void 0),S(this,"optionsToUpdate",{})}return H(r,[{key:"getName",value:function(){return this.name}},{key:"setName",value:function(t){this.name=t}},{key:"getType",value:function(){return gi.PostProcessing}},{key:"init",value:function(t,e){this.config=e,this.rendererService=t.getContainer().get(P.IRendererService),this.shaderModuleService=t.getContainer().get(P.IShaderModuleService);var i=this.rendererService,a=i.createAttribute,o=i.createBuffer,s=i.createModel,u=this.setupShaders(),l=u.vs,c=u.fs,f=u.uniforms;this.model=s({vs:l,fs:c,attributes:{a_Position:a({buffer:o({data:[-4,-4,4,-4,0,4],type:A.FLOAT}),size:2})},uniforms:U(U({u_Texture:null},f),this.config&&this.convertOptionsToUniforms(this.config)),depth:{enable:!1},count:3,blend:{enable:this.getName()==="copy"}})}},{key:"render",value:function(t,e){var i=this,a=t.multiPassRenderer.getPostProcessor(),o=this.rendererService,s=o.useFramebuffer,u=o.getViewportSize,l=o.clear,c=u(),f=c.width,h=c.height;s(this.renderToScreen?null:a.getWriteFBO(),function(){l({framebuffer:a.getWriteFBO(),color:[0,0,0,0],depth:1,stencil:0});var v=U({u_BloomFinal:0,u_Texture:a.getReadFBO(),u_ViewportSize:[f,h]},i.convertOptionsToUniforms(i.optionsToUpdate));e&&(v.u_BloomFinal=1,v.u_Texture2=e),i.model.draw({uniforms:v})})}},{key:"isEnabled",value:function(){return this.enabled}},{key:"setEnabled",value:function(t){this.enabled=t}},{key:"setRenderToScreen",value:function(t){this.renderToScreen=t}},{key:"updateOptions",value:function(t){this.optionsToUpdate=U(U({},this.optionsToUpdate),t)}},{key:"setupShaders",value:function(){throw new Error("Method not implemented.")}},{key:"convertOptionsToUniforms",value:function(t){var e={};return Object.keys(t).forEach(function(i){Y.exports.isNil(t[i])||(e["u_".concat(Y.exports.upperFirst(Y.exports.camelCase(i)))]=t[i])}),e}}]),r}(),Hx=Ct(Of.prototype,"shaderModuleService",[zx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Of))||Ux),$x,Gx;function sV(r){var n=uV();return function(){var e=B(r),i;if(n){var a=B(this).constructor;i=Reflect.construct(e,arguments,a)}else i=e.apply(this,arguments);return et(this,i)}}function uV(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var lV=`varying vec2 v_UV;

uniform float u_BloomFinal: 0.0;
uniform sampler2D u_Texture;
uniform sampler2D u_Texture2;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_radius: 5.0;
uniform float u_intensity: 0.3;
uniform float u_baseRadio: 0.5;

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

float luminance(vec4 color) {
  return  0.2125 * color.r + 0.7154 * color.g + 0.0721 * color.b;
}

void main() {
  // vec4 baseColor = texture2D(u_Texture, v_UV);

  float r = sqrt(u_radius);

  vec4 c1 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(u_radius, 0.0));
  // c1 *= luminance(c1);
  vec4 c2 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(0.0, u_radius));
  // c2 *= luminance(c2);
  vec4 c3 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, r));
  // c3 *= luminance(c3);
  vec4 c4 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, -r));
  // c4 *= luminance(c4);
  vec4 inbloomColor = (c1 + c2 + c3 + c4) * 0.25;

  // float lum = luminance(inbloomColor);
  // inbloomColor.rgb *= lum;

  if(u_BloomFinal > 0.0) {
    vec4 baseColor = texture2D(u_Texture2, v_UV);
    float baselum = luminance(baseColor);
    gl_FragColor = mix(inbloomColor, baseColor, u_baseRadio);
    if(baselum <= 0.2) {
      gl_FragColor = inbloomColor * u_intensity;
    }
  } else {
    gl_FragColor = inbloomColor;
  }
}`,cV=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,fV=($x=xt(),$x(Gx=function(r){tt(t,r);var n=sV(t);function t(){return $(this,t),n.apply(this,arguments)}return H(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:cV,fs:lV});var i=this.shaderModuleService.getModule("blur-pass"),a=i.vs,o=i.fs,s=i.uniforms,u=this.rendererService.getViewportSize(),l=u.width,c=u.height;return{vs:a,fs:o,uniforms:U(U({},s),{},{u_ViewportSize:[l,c]})}}},{key:"convertOptionsToUniforms",value:function(i){var a={};return Y.exports.isNil(i.bloomRadius)||(a.u_radius=i.bloomRadius),Y.exports.isNil(i.bloomIntensity)||(a.u_intensity=i.bloomIntensity),Y.exports.isNil(i.bloomBaseRadio)||(a.u_baseRadio=i.bloomBaseRadio),a}}]),t}(Dn))||Gx),Vx,Wx;function hV(r){var n=vV();return function(){var e=B(r),i;if(n){var a=B(this).constructor;i=Reflect.construct(e,arguments,a)}else i=e.apply(this,arguments);return et(this,i)}}function vV(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var pV=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,dV=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,gV=(Vx=xt(),Vx(Wx=function(r){tt(t,r);var n=hV(t);function t(){return $(this,t),n.apply(this,arguments)}return H(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:dV,fs:pV});var i=this.shaderModuleService.getModule("blur-pass"),a=i.vs,o=i.fs,s=i.uniforms,u=this.rendererService.getViewportSize(),l=u.width,c=u.height;return{vs:a,fs:o,uniforms:U(U({},s),{},{u_ViewportSize:[l,c]})}}},{key:"convertOptionsToUniforms",value:function(i){var a={};return Y.exports.isNil(i.blurRadius)||(a.u_BlurDir=[i.blurRadius,0]),a}}]),t}(Dn))||Wx),jx,Xx;function yV(r){var n=mV();return function(){var e=B(r),i;if(n){var a=B(this).constructor;i=Reflect.construct(e,arguments,a)}else i=e.apply(this,arguments);return et(this,i)}}function mV(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var xV=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,_V=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,CV=(jx=xt(),jx(Xx=function(r){tt(t,r);var n=yV(t);function t(){return $(this,t),n.apply(this,arguments)}return H(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:_V,fs:xV});var i=this.shaderModuleService.getModule("blur-pass"),a=i.vs,o=i.fs,s=i.uniforms,u=this.rendererService.getViewportSize(),l=u.width,c=u.height;return{vs:a,fs:o,uniforms:U(U({},s),{},{u_ViewportSize:[l,c]})}}},{key:"convertOptionsToUniforms",value:function(i){var a={};return Y.exports.isNil(i.blurRadius)||(a.u_BlurDir=[0,i.blurRadius]),a}}]),t}(Dn))||Xx),Yx,Zx;function EV(r){var n=SV();return function(){var e=B(r),i;if(n){var a=B(this).constructor;i=Reflect.construct(e,arguments,a)}else i=e.apply(this,arguments);return et(this,i)}}function SV(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var bV=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Angle : 0;
uniform float u_Size : 8;

#pragma include "common"

float scale = PI / u_Size;

float pattern(float u_Angle, vec2 texSize, vec2 texCoord) {
  float s = sin(u_Angle), c = cos(u_Angle);
  vec2 tex = texCoord * texSize - u_Center * texSize;
  vec2 point = vec2(
    c * tex.x - s * tex.y,
    s * tex.x + c * tex.y
  ) * scale;
  return (sin(point.x) * sin(point.y)) * 4.0;
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/colorhalftone.js
vec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {
  vec3 cmy = 1.0 - color.rgb;
  float k = min(cmy.x, min(cmy.y, cmy.z));
  cmy = (cmy - k) / (1.0 - k);
  cmy = clamp(
    cmy * 10.0 - 3.0 + vec3(
      pattern(u_Angle + 0.26179, texSize, texCoord),
      pattern(u_Angle + 1.30899, texSize, texCoord),
      pattern(u_Angle, texSize, texCoord)
    ),
    0.0,
    1.0
  );
  k = clamp(k * 10.0 - 5.0 + pattern(u_Angle + 0.78539, texSize, texCoord), 0.0, 1.0);
  return vec4(1.0 - cmy - k, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = colorHalftone_filterColor(gl_FragColor, u_ViewportSize, v_UV);
}`,AV=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,TV=(Yx=xt(),Yx(Zx=function(r){tt(t,r);var n=EV(t);function t(){return $(this,t),n.apply(this,arguments)}return H(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("colorhalftone-pass",{vs:AV,fs:bV});var i=this.shaderModuleService.getModule("colorhalftone-pass"),a=i.vs,o=i.fs,s=i.uniforms,u=this.rendererService.getViewportSize(),l=u.width,c=u.height;return{vs:a,fs:o,uniforms:U(U({},s),{},{u_ViewportSize:[l,c]})}}}]),t}(Dn))||Zx),qx,Kx;function MV(r){var n=wV();return function(){var e=B(r),i;if(n){var a=B(this).constructor;i=Reflect.construct(e,arguments,a)}else i=e.apply(this,arguments);return et(this,i)}}function wV(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var LV=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,FV=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,kV=(qx=xt(),qx(Kx=function(r){tt(t,r);var n=MV(t);function t(){return $(this,t),n.apply(this,arguments)}return H(t,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("copy-pass",{vs:FV,fs:LV}),this.shaderModuleService.getModule("copy-pass")}}]),t}(Dn))||Kx),Qx,Jx;function OV(r){var n=RV();return function(){var e=B(r),i;if(n){var a=B(this).constructor;i=Reflect.construct(e,arguments,a)}else i=e.apply(this,arguments);return et(this,i)}}function RV(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var IV=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Scale : 10;

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/hexagonalpixelate.js
vec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 tex = (texCoord * texSize - u_Center * texSize) / u_Scale;
  tex.y /= 0.866025404;
  tex.x -= tex.y * 0.5;
  vec2 a;
  if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {
    a = vec2(floor(tex.x), floor(tex.y));
  }
  else a = vec2(ceil(tex.x), ceil(tex.y));
  vec2 b = vec2(ceil(tex.x), floor(tex.y));
  vec2 c = vec2(floor(tex.x), ceil(tex.y));
  vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);
  vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);
  vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);
  vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);
  float alen = length(TEX - A);
  float blen = length(TEX - B);
  float clen = length(TEX - C);
  vec2 choice;
  if (alen < blen) {
    if (alen < clen) choice = a;
    else choice = c;
  } else {
    if (blen < clen) choice = b;
    else choice = c;
  }
  choice.x += choice.y * 0.5;
  choice.y *= 0.866025404;
  choice *= u_Scale / texSize;
  return texture2D(texture, choice + u_Center);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = hexagonalPixelate_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,DV=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,PV=(Qx=xt(),Qx(Jx=function(r){tt(t,r);var n=OV(t);function t(){return $(this,t),n.apply(this,arguments)}return H(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("hexagonalpixelate-pass",{vs:DV,fs:IV});var i=this.shaderModuleService.getModule("hexagonalpixelate-pass"),a=i.vs,o=i.fs,s=i.uniforms,u=this.rendererService.getViewportSize(),l=u.width,c=u.height;return{vs:a,fs:o,uniforms:U(U({},s),{},{u_ViewportSize:[l,c]})}}}]),t}(Dn))||Jx),t_,e_;function BV(r){var n=NV();return function(){var e=B(r),i;if(n){var a=B(this).constructor;i=Reflect.construct(e,arguments,a)}else i=e.apply(this,arguments);return et(this,i)}}function NV(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var zV=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_Strength : 0.6;

vec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 dx = vec2(1.0 / texSize.x, 0.0);
  vec2 dy = vec2(0.0, 1.0 / texSize.y);
  vec4 color = texture2D(texture, texCoord);
  float bigTotal = 0.0;
  float smallTotal = 0.0;
  vec3 bigAverage = vec3(0.0);
  vec3 smallAverage = vec3(0.0);
  for (float x = -2.0; x <= 2.0; x += 1.0) {
    for (float y = -2.0; y <= 2.0; y += 1.0) {
      vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;
      bigAverage += sample;
      bigTotal += 1.0;
      if (abs(x) + abs(y) < 2.0) {
        smallAverage += sample;
        smallTotal += 1.0;
      }
    }
  }
  vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);
  float power = u_Strength * u_Strength * u_Strength * u_Strength * u_Strength;
  return vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = ink_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,UV=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,HV=(t_=xt(),t_(e_=function(r){tt(t,r);var n=BV(t);function t(){return $(this,t),n.apply(this,arguments)}return H(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("ink-pass",{vs:UV,fs:zV});var i=this.shaderModuleService.getModule("ink-pass"),a=i.vs,o=i.fs,s=i.uniforms,u=this.rendererService.getViewportSize(),l=u.width,c=u.height;return{vs:a,fs:o,uniforms:U(U({},s),{},{u_ViewportSize:[l,c]})}}}]),t}(Dn))||e_),r_,n_;function $V(r){var n=GV();return function(){var e=B(r),i;if(n){var a=B(this).constructor;i=Reflect.construct(e,arguments,a)}else i=e.apply(this,arguments);return et(this,i)}}function GV(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var VV=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform float u_Amount : 0.5;

float rand(vec2 co) {
  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/noise.js
vec4 noise_filterColor(vec4 color, vec2 texCoord) {
  float diff = (rand(texCoord) - 0.5) * u_Amount;
  color.r += diff;
  color.g += diff;
  color.b += diff;
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = noise_filterColor(gl_FragColor, v_UV);
}`,WV=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,jV=(r_=xt(),r_(n_=function(r){tt(t,r);var n=$V(t);function t(){return $(this,t),n.apply(this,arguments)}return H(t,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("noise-pass",{vs:WV,fs:VV}),this.shaderModuleService.getModule("noise-pass")}}]),t}(Dn))||n_),i_,a_;function XV(r){var n=YV();return function(){var e=B(r),i;if(n){var a=B(this).constructor;i=Reflect.construct(e,arguments,a)}else i=e.apply(this,arguments);return et(this,i)}}function YV(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var ZV=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,qV=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform float u_Amount : 0.5;

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/sepia.js
vec4 sepia_filterColor(vec4 color) {
  float r = color.r;
  float g = color.g;
  float b = color.b;
  color.r =
    min(1.0, (r * (1.0 - (0.607 * u_Amount))) + (g * (0.769 * u_Amount)) + (b * (0.189 * u_Amount)));
  color.g = min(1.0, (r * 0.349 * u_Amount) + (g * (1.0 - (0.314 * u_Amount))) + (b * 0.168 * u_Amount));
  color.b = min(1.0, (r * 0.272 * u_Amount) + (g * 0.534 * u_Amount) + (b * (1.0 - (0.869 * u_Amount))));
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = sepia_filterColor(gl_FragColor);
}`,KV=(i_=xt(),i_(a_=function(r){tt(t,r);var n=XV(t);function t(){return $(this,t),n.apply(this,arguments)}return H(t,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("sepia-pass",{vs:ZV,fs:qV}),this.shaderModuleService.getModule("sepia-pass")}}]),t}(Dn))||a_),o_,s_,u_,l_,Aa,c_,QV=(o_=xt(),s_=At(P.IRendererService),u_=PM(),o_(l_=(Aa=function(){function r(){$(this,r),St(this,"rendererService",c_,this),S(this,"passes",[]),S(this,"readFBO",void 0),S(this,"writeFBO",void 0)}return H(r,[{key:"getReadFBO",value:function(){return this.readFBO}},{key:"getWriteFBO",value:function(){return this.writeFBO}},{key:"getCurrentFBOTex",value:function(){var t=this.rendererService,e=t.getViewportSize,i=t.createTexture2D,a=e(),o=a.width,s=a.height;return i({x:0,y:0,width:o,height:s,copy:!0})}},{key:"getReadFBOTex",value:function(){var t=this,e=this.rendererService.useFramebuffer;return new Promise(function(i,a){e(t.readFBO,Mt(st.mark(function o(){return st.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:i(t.getCurrentFBOTex());case 1:case"end":return u.stop()}},o)})))})}},{key:"renderBloomPass",value:function(){var n=Mt(st.mark(function e(i,a){var o,s;return st.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.getReadFBOTex();case 2:o=l.sent,s=0;case 4:if(!(s<4)){l.next=11;break}return l.next=7,a.render(i,o);case 7:this.swap(),s++,l.next=4;break;case 11:case"end":return l.stop()}},e,this)}));function t(e,i){return n.apply(this,arguments)}return t}()},{key:"render",value:function(){var n=Mt(st.mark(function e(i){var a,o;return st.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:a=0;case 1:if(!(a<this.passes.length)){u.next=15;break}if(o=this.passes[a],o.setRenderToScreen(this.isLastEnabledPass(a)),o.getName()!=="bloom"){u.next=9;break}return u.next=7,this.renderBloomPass(i,o);case 7:u.next=12;break;case 9:return u.next=11,o.render(i);case 11:a!==this.passes.length-1&&this.swap();case 12:a++,u.next=1;break;case 15:case"end":return u.stop()}},e,this)}));function t(e){return n.apply(this,arguments)}return t}()},{key:"resize",value:function(t,e){this.readFBO.resize({width:t,height:e}),this.writeFBO.resize({width:t,height:e})}},{key:"add",value:function(t,e,i){t.init(e,i),this.passes.push(t)}},{key:"insert",value:function(t,e,i,a){t.init(i,a),this.passes.splice(e,0,t)}},{key:"getPostProcessingPassByName",value:function(t){return this.passes.find(function(e){return e.getName()===t})}},{key:"init",value:function(){var t=this.rendererService,e=t.createFramebuffer,i=t.createTexture2D;this.readFBO=e({color:i({width:1,height:1,wrapS:A.CLAMP_TO_EDGE,wrapT:A.CLAMP_TO_EDGE})}),this.writeFBO=e({color:i({width:1,height:1,wrapS:A.CLAMP_TO_EDGE,wrapT:A.CLAMP_TO_EDGE})})}},{key:"isLastEnabledPass",value:function(t){for(var e=t+1;e<this.passes.length;e++)if(this.passes[e].isEnabled())return!1;return!0}},{key:"swap",value:function(){var t=this.readFBO;this.readFBO=this.writeFBO,this.writeFBO=t}}]),r}(),c_=Ct(Aa.prototype,"rendererService",[s_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ct(Aa.prototype,"init",[u_],Object.getOwnPropertyDescriptor(Aa.prototype,"init"),Aa.prototype),Aa))||l_),f_,h_;function JV(r){var n=tW();return function(){var e=B(r),i;if(n){var a=B(this).constructor;i=Reflect.construct(e,arguments,a)}else i=e.apply(this,arguments);return et(this,i)}}function tW(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var eW=(f_=xt(),f_(h_=function(r){tt(t,r);var n=JV(t);function t(){return $(this,t),n.apply(this,arguments)}return H(t,[{key:"getType",value:function(){return gi.Normal}},{key:"getName",value:function(){return"render"}},{key:"init",value:function(i,a){Ol(B(t.prototype),"init",this).call(this,i,a)}},{key:"render",value:function(i){var a=this.rendererService,o=a.useFramebuffer,s=a.clear,u=i.multiPassRenderer.getPostProcessor().getReadFBO();o(u,function(){s({color:[0,0,0,0],depth:1,stencil:0,framebuffer:u}),i.multiPassRenderer.setRenderFlag(!1),i.models.forEach(function(l){l.draw({uniforms:i.layerModel.getUninforms()})}),i.multiPassRenderer.setRenderFlag(!0)})}}]),t}(Rc))||h_),v_,p_,d_,Rf,g_;function rW(r){var n=nW();return function(){var e=B(r),i;if(n){var a=B(this).constructor;i=Reflect.construct(e,arguments,a)}else i=e.apply(this,arguments);return et(this,i)}}function nW(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var iW=`uniform float u_opacity : 1.0;
uniform float u_MixRatio : 0.5;

uniform sampler2D u_Diffuse1;
uniform sampler2D u_Diffuse2;

varying vec2 v_UV;

void main() {
  vec4 texel1 = texture2D(u_Diffuse1, v_UV);
  vec4 texel2 = texture2D(u_Diffuse2, v_UV);
  gl_FragColor = u_opacity * mix(texel1, texel2, u_MixRatio);
}
`,y_=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,aW=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;function m_(r,n){for(var t=0,e=1/n,i=r;i>0;)t=t+e*(i%n),i=Math.floor(i/n),e=e/n;return t}var oW=1,sW=(v_=xt(),p_=At(P.IShaderModuleService),v_(d_=(Rf=function(r){tt(t,r);var n=rW(t);function t(){var e;$(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return e=n.call.apply(n,[this].concat(a)),St(I(e),"shaderModuleService",g_,I(e)),S(I(e),"haltonSequence",[]),S(I(e),"accumulatingId",0),S(I(e),"frame",0),S(I(e),"timer",void 0),S(I(e),"sampleRenderTarget",void 0),S(I(e),"prevRenderTarget",void 0),S(I(e),"outputRenderTarget",void 0),S(I(e),"copyRenderTarget",void 0),S(I(e),"blendModel",void 0),S(I(e),"outputModel",void 0),S(I(e),"copyModel",void 0),e}return H(t,[{key:"getType",value:function(){return gi.Normal}},{key:"getName",value:function(){return"taa"}},{key:"init",value:function(i,a){Ol(B(t.prototype),"init",this).call(this,i,a);var o=this.rendererService,s=o.createFramebuffer,u=o.createTexture2D;this.sampleRenderTarget=s({color:u({width:1,height:1,wrapS:A.CLAMP_TO_EDGE,wrapT:A.CLAMP_TO_EDGE})}),this.prevRenderTarget=s({color:u({width:1,height:1,wrapS:A.CLAMP_TO_EDGE,wrapT:A.CLAMP_TO_EDGE})}),this.outputRenderTarget=s({color:u({width:1,height:1,wrapS:A.CLAMP_TO_EDGE,wrapT:A.CLAMP_TO_EDGE})}),this.copyRenderTarget=s({color:u({width:1,height:1,wrapS:A.CLAMP_TO_EDGE,wrapT:A.CLAMP_TO_EDGE})});for(var l=0;l<30;l++)this.haltonSequence.push([m_(l,2),m_(l,3)]);this.blendModel=this.createTriangleModel("blend-pass",iW),this.outputModel=this.createTriangleModel("copy-pass",y_,{blend:{enable:!0,func:{srcRGB:A.ONE,dstRGB:A.ONE_MINUS_SRC_ALPHA,srcAlpha:A.ONE,dstAlpha:A.ONE_MINUS_SRC_ALPHA},equation:{rgb:A.FUNC_ADD,alpha:A.FUNC_ADD}}}),this.copyModel=this.createTriangleModel("copy-pass",y_)}},{key:"render",value:function(i){var a=this,o=this.rendererService,s=o.clear,u=o.getViewportSize,l=o.useFramebuffer,c=u(),f=c.width,h=c.height;this.sampleRenderTarget.resize({width:f,height:h}),this.prevRenderTarget.resize({width:f,height:h}),this.outputRenderTarget.resize({width:f,height:h}),this.copyRenderTarget.resize({width:f,height:h}),this.resetFrame(),this.stopAccumulating();var v=i.multiPassRenderer.getPostProcessor().getReadFBO();l(v,function(){s({color:[0,0,0,0],depth:1,stencil:0,framebuffer:v}),i.multiPassRenderer.setRenderFlag(!1),i.render(),i.multiPassRenderer.setRenderFlag(!0)});var p=function d(g){!a.accumulatingId||g!==a.accumulatingId||a.isFinished()||(a.doRender(i),Wt.requestAnimationFrame(function(){d(g)}))};this.accumulatingId=oW++,this.timer=Wt.setTimeout(function(){p(a.accumulatingId)},50)}},{key:"doRender",value:function(i){var a=this,o=this.rendererService,s=o.clear,u=o.getViewportSize,l=o.useFramebuffer,c=u(),f=c.width,h=c.height,v=i.getLayerConfig(),p=v.jitterScale,d=p===void 0?1:p,g=this.haltonSequence[this.frame%this.haltonSequence.length];this.cameraService.jitterProjectionMatrix((g[0]*2-1)/f*d,(g[1]*2-1)/h*d),i.multiPassRenderer.setRenderFlag(!1),i.hooks.beforeRender.call(),l(this.sampleRenderTarget,function(){s({color:[0,0,0,0],depth:1,stencil:0,framebuffer:a.sampleRenderTarget}),i.render()}),i.hooks.afterRender.call(),i.multiPassRenderer.setRenderFlag(!0);var y=i.getLayerConfig();l(this.outputRenderTarget,function(){a.blendModel.draw({uniforms:{u_opacity:y.opacity||1,u_MixRatio:a.frame===0?1:.9,u_Diffuse1:a.sampleRenderTarget,u_Diffuse2:a.frame===0?i.multiPassRenderer.getPostProcessor().getReadFBO():a.prevRenderTarget}})}),this.frame===0&&s({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.copyRenderTarget}),this.frame>=1&&(l(this.copyRenderTarget,function(){a.outputModel.draw({uniforms:{u_Texture:a.outputRenderTarget}})}),l(i.multiPassRenderer.getPostProcessor().getReadFBO(),function(){a.copyModel.draw({uniforms:{u_Texture:a.copyRenderTarget}})}),i.multiPassRenderer.getPostProcessor().render(i));var m=this.prevRenderTarget;this.prevRenderTarget=this.outputRenderTarget,this.outputRenderTarget=m,this.frame++,this.cameraService.clearJitterProjectionMatrix()}},{key:"isFinished",value:function(){return this.frame>=this.haltonSequence.length}},{key:"resetFrame",value:function(){this.frame=0}},{key:"stopAccumulating",value:function(){this.accumulatingId=0,Wt.clearTimeout(this.timer)}},{key:"createTriangleModel",value:function(i,a,o){this.shaderModuleService.registerModule(i,{vs:aW,fs:a});var s=this.shaderModuleService.getModule(i),u=s.vs,l=s.fs,c=s.uniforms,f=this.rendererService,h=f.createAttribute,v=f.createBuffer,p=f.createModel;return p(U({vs:u,fs:l,attributes:{a_Position:h({buffer:v({data:[-4,-4,4,-4,0,4],type:A.FLOAT}),size:2})},uniforms:U({},c),depth:{enable:!1},count:3},o))}}]),t}(Rc),g_=Ct(Rf.prototype,"shaderModuleService",[p_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rf))||d_),Ne=new Ev;Ne.bind(P.IGlobalConfigService).to(j$).inSingletonScope();BM(xt(),dn.exports.EventEmitter);Ne.bind(P.IEventEmitter).to(dn.exports.EventEmitter);var uW=WM(Ne,!1),ud=function(n){var t=uW.lazyInject(n);return function(e,i,a){t.call(this,e,i),a&&(a.initializer=function(){return e[i]})}},lW=0;function cW(){var r=new Ev;return r.parent=Ne,r.bind(P.SceneID).toConstantValue("".concat(lW++)),r.bind(P.IShaderModuleService).to(qG).inSingletonScope(),r.bind(P.ILayerService).to(sG).inSingletonScope(),r.bind(P.ISceneService).to(kG).inSingletonScope(),r.bind(P.ICameraService).to(B$).inSingletonScope(),r.bind(P.ICoordinateSystemService).to(Z$).inSingletonScope(),r.bind(P.IInteractionService).to(J$).inSingletonScope(),r.bind(P.IPickingService).to(nG).inSingletonScope(),r.bind(P.IControlService).to(U$).inSingletonScope(),r.bind(P.IMarkerService).to(H$).inSingletonScope(),r.bind(P.IIconService).to(P$).inSingletonScope(),r.bind(P.IFontService).to(O$).inSingletonScope(),r.bind(P.IPopupService).to($$).inSingletonScope(),r.bind(P.INormalPass).to(JG).whenTargetNamed("clear"),r.bind(P.INormalPass).to(aV).whenTargetNamed("pixelPicking"),r.bind(P.INormalPass).to(eW).whenTargetNamed("render"),r.bind(P.INormalPass).to(sW).whenTargetNamed("taa"),r.bind(P.IFactoryNormalPass).toFactory(function(n){return function(t){return n.container.getNamed(P.INormalPass,t)}}),r.bind(P.IPostProcessingPass).to(kV).whenTargetNamed("copy"),r.bind(P.IPostProcessingPass).to(fV).whenTargetNamed("bloom"),r.bind(P.IPostProcessingPass).to(gV).whenTargetNamed("blurH"),r.bind(P.IPostProcessingPass).to(CV).whenTargetNamed("blurV"),r.bind(P.IPostProcessingPass).to(jV).whenTargetNamed("noise"),r.bind(P.IPostProcessingPass).to(KV).whenTargetNamed("sepia"),r.bind(P.IPostProcessingPass).to(TV).whenTargetNamed("colorHalftone"),r.bind(P.IPostProcessingPass).to(PV).whenTargetNamed("hexagonalPixelate"),r.bind(P.IPostProcessingPass).to(HV).whenTargetNamed("ink"),r.bind(P.IFactoryPostProcessingPass).toFactory(function(n){return function(t){var e=n.container.getNamed(P.IPostProcessingPass,t);return e.setName(t),e}}),r}function sv(r){var n=new Ev;return n.parent=r,n.bind(P.IStyleAttributeService).to(pG).inSingletonScope(),n.bind(P.IMultiPassRenderer).to(rV).inSingletonScope(),n.bind(P.IPostProcessor).to(QV).inSingletonScope(),n}var Wr;(function(r){r.normal="normal",r.additive="additive",r.subtractive="subtractive",r.min="min",r.max="max",r.none="none"})(Wr||(Wr={}));var Gt;(function(r){r.LINEAR="linear",r.SEQUENTIAL="sequential",r.POWER="power",r.LOG="log",r.IDENTITY="identity",r.TIME="time",r.QUANTILE="quantile",r.QUANTIZE="quantize",r.THRESHOLD="threshold",r.CAT="cat",r.DIVERGING="diverging"})(Gt||(Gt={}));var Qn;(function(r){r.CONSTANT="constant",r.VARIABLE="variable"})(Qn||(Qn={}));var nt;(function(r){r[r.Attribute=0]="Attribute",r[r.InstancedAttribute=1]="InstancedAttribute",r[r.Uniform=2]="Uniform"})(nt||(nt={}));var uv=["mapload","mapchange","mapAfterFrameChange"],Fi={ProjectionMatrix:"u_ProjectionMatrix",ViewMatrix:"u_ViewMatrix",ViewProjectionMatrix:"u_ViewProjectionMatrix",Zoom:"u_Zoom",ZoomScale:"u_ZoomScale",FocalDistance:"u_FocalDistance",CameraPosition:"u_CameraPosition"},If=["loaded","maploaded","resize","destroy","dragstart","dragging","dragend","dragcancel"],yi;(function(r){r.TOPRIGHT="topright",r.TOPLEFT="topleft",r.BOTTOMRIGHT="bottomright",r.BOTTOMLEFT="bottomleft",r.TOPCENTER="topcenter",r.BOTTOMCENTER="bottomcenter",r.LEFTCENTER="leftcenter",r.RIGHTCENTER="rightcenter"})(yi||(yi={}));function fW(r){var n=hW();return function(){var e=B(r),i;if(n){var a=B(this).constructor;i=Reflect.construct(e,arguments,a)}else i=e.apply(this,arguments);return et(this,i)}}function hW(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var vW=0,Ys=function(r){tt(t,r);var n=fW(t);function t(e){var i;return $(this,t),i=n.call(this),i.controlOption=U(U({},i.getDefault()),e||{}),i}return H(t,[{key:"getDefault",value:function(){return{position:yi.TOPRIGHT,name:"".concat(vW++)}}},{key:"setPosition",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:yi.BOTTOMRIGHT,a=this.controlService;return a&&a.removeControl(this),this.controlOption.position=i,a&&a.addControl(this,this.sceneContainer),this}},{key:"addTo",value:function(i){this.mapsService=i.get(P.IMapService),this.renderService=i.get(P.IRendererService),this.layerService=i.get(P.ILayerService),this.controlService=i.get(P.IControlService),this.sceneContainer=i,this.isShow=!0,this.container=this.onAdd();var a=this.container,o=this.controlOption.position,s=this.controlService.controlCorners[o];return oa(a,"l7-control"),o.indexOf("bottom")!==-1?s.insertBefore(a,s.firstChild):s.appendChild(a),this}},{key:"onAdd",value:function(){throw new Error("Method not implemented.")}},{key:"onRemove",value:function(){throw new Error("Method not implemented.")}},{key:"hide",value:function(){var i=this.container;oa(i,"l7-control-hide"),this.isShow=!1}},{key:"show",value:function(){var i=this.container;ws(i,"l7-control-hide"),this.isShow=!0}},{key:"remove",value:function(){if(!this.mapsService)return this;Ms(this.container),this.onRemove()}},{key:"_refocusOnMap",value:function(i){if(this.mapsService&&i&&i.screenX>0&&i.screenY>0){var a=this.mapsService.getContainer();a!==null&&a.focus()}}}]),t}(dn.exports.EventEmitter);function pW(r){var n=dW();return function(){var e=B(r),i;if(n){var a=B(this).constructor;i=Reflect.construct(e,arguments,a)}else i=e.apply(this,arguments);return et(this,i)}}function dW(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var gW=function(r){tt(t,r);var n=pW(t);function t(e){var i;return $(this,t),i=n.call(this,e),i.layerControlInputs=[],i.layers=[],i.lastZIndex=0,i.handlingClick=!1,i.initLayers(),Fc(["checkDisabledLayers","onLayerChange","collapse","extend","expand","onInputClick"],I(i)),i}return H(t,[{key:"getDefault",value:function(){return{collapsed:!0,position:yi.TOPRIGHT,autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,name:"layers"}}},{key:"onAdd",value:function(){var i=this;return this.initLayout(),this.update(),this.mapsService.on("zoomend",this.checkDisabledLayers),this.layers.forEach(function(a){a.layer.on("remove",i.onLayerChange),a.layer.on("add",i.onLayerChange)}),this.container}},{key:"addVisualLayer",value:function(i,a){return this.addLayer(i,a,!0),this.mapsService?this.update():this}},{key:"expand",value:function(){var i=this.renderService.getViewportSize(),a=i.height;oa(this.container,"l7-control-layers-expanded"),this.form.style.height="null";var o=a-(this.container.offsetTop+50);return o<this.form.clientHeight?(oa(this.form,"l7-control-layers-scrollbar"),this.form.style.height=o+"px"):ws(this.form,"l7-control-layers-scrollbar"),this.checkDisabledLayers(),this}},{key:"collapse",value:function(){return ws(this.container,"l7-control-layers-expanded"),this}},{key:"onRemove",value:function(){var i=this;!this.mapsService||(this.mapsService.off("click",this.collapse),this.layers.forEach(function(a){a.layer.off("remove",i.onLayerChange),a.layer.off("add",i.onLayerChange)}))}},{key:"initLayout",value:function(){var i="l7-control-layers",a=this.container=ye("div",i),o=this.controlOption.collapsed;a.setAttribute("aria-haspopup","true");var s=this.form=ye("form",i+"-list");o&&(this.mapsService.on("click",this.collapse),a.addEventListener("mouseenter",this.expand),a.addEventListener("mouseleave",this.collapse)),this.layersLink=ye("a",i+"-toggle",a);var u=this.layersLink;u.title="Layers",o||this.expand(),this.baseLayersList=ye("div",i+"-base",s),this.separator=ye("div",i+"-separator",s),this.overlaysList=ye("div",i+"-overlays",s),a.appendChild(s)}},{key:"initLayers",value:function(){var i=this,a=this.controlOption,o=a.baseLayers,s=o===void 0?{}:o,u=a.overlayers,l=u===void 0?{}:u;Object.keys(s).forEach(function(c){i.addLayer(s[c],c,!1)}),Object.keys(l).forEach(function(c){i.addLayer(l[c],c,!0)})}},{key:"update",value:function(){if(!this.container)return this;Ry(this.baseLayersList),Ry(this.overlaysList),this.layerControlInputs=[];var i,a,o,s,u=0;for(o=0;o<this.layers.length;o++)s=this.layers[o],this.addItem(s),a=a||s.overlay,i=i||!s.overlay,u+=s.overlay?0:1;return this.controlOption.hideSingleBase&&(i=i&&u>1,this.baseLayersList.style.display=i?"":"none"),this.separator.style.display=a&&i?"":"none",this}},{key:"checkDisabledLayers",value:function(){for(var i=this.layerControlInputs,a,o,s=this.mapsService.getZoom(),u=i.length-1;u>=0;u--)if(a=i[u],o=this.layerService.getLayer(a.layerId),o&&o.inited){var l=o.getMinZoom(),c=o.getMaxZoom();a.disabled=s<l||s>c}}},{key:"addLayer",value:function(i,a,o){this.mapsService&&(i.on("add",this.onLayerChange),i.on("remove",this.onLayerChange)),this.layers.push({layer:i,name:a,overlay:o});var s=this.controlOption,u=s.sortLayers,l=s.sortFunction,c=s.autoZIndex;u&&this.layers.sort(function(f,h){return l(f.layer,h.layer,f.name,h.name)}),c&&i.setZIndex&&(this.lastZIndex++,i.setZIndex(this.lastZIndex)),this.expandIfNotCollapsed()}},{key:"expandIfNotCollapsed",value:function(){return this.mapsService&&!this.controlOption.collapsed&&this.expand(),this}},{key:"onLayerChange",value:function(i){this.handlingClick||this.update();var a=this.layerService.getLayer(i.target.layerId),o=a!=null&&a.overlay?i.type==="add"?"overlayadd":"overlayremove":i.type==="add"?"baselayerchange":null;o&&this.emit(o,a)}},{key:"createRadioElement",value:function(i,a){var o='<input type="radio" class="l7-control-layers-selector" name="'+i+'"'+(a?' checked="checked"':"")+"/>",s=document.createElement("div");return s.innerHTML=o,s.firstChild}},{key:"addItem",value:function(i){var a=document.createElement("label"),o=this.layerService.getLayer(i.layer.id),s=o&&o.inited&&i.layer.isVisible(),u;i.overlay?(u=document.createElement("input"),u.type="checkbox",u.className="l7-control-layers-selector",u.defaultChecked=s):u=this.createRadioElement("l7-base-layers",s),this.layerControlInputs.push(u),u.layerId=i.layer.id,u.addEventListener("click",this.onInputClick);var l=document.createElement("span");l.innerHTML=" "+i.name;var c=document.createElement("div");a.appendChild(c),c.appendChild(u),c.appendChild(l);var f=i.overlay?this.overlaysList:this.baseLayersList;return f.appendChild(a),this.checkDisabledLayers(),a}},{key:"onInputClick",value:function(){var i=this.layerControlInputs,a,o,s=[],u=[];this.handlingClick=!0;for(var l=i.length-1;l>=0;l--)a=i[l],o=this.layerService.getLayer(a.layerId),a.checked?s.push(o):a.checked||u.push(o);u.forEach(function(c){c.hide()}),s.forEach(function(c){c.show()}),this.handlingClick=!1}}]),t}(Ys);function yW(r){var n=mW();return function(){var e=B(r),i;if(n){var a=B(this).constructor;i=Reflect.construct(e,arguments,a)}else i=e.apply(this,arguments);return et(this,i)}}function mW(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var xW=function(r){tt(t,r);var n=yW(t);function t(){return $(this,t),n.apply(this,arguments)}return H(t,[{key:"getDefault",value:function(){return{position:yi.BOTTOMLEFT,name:"logo"}}},{key:"onAdd",value:function(){var i="l7-control-logo",a=ye("div",i),o=ye("a","l7-ctrl-logo");return o.target="_blank",o.rel="noopener nofollow",o.href="https://antv.alipay.com/l7",o.setAttribute("aria-label","AntV logo"),o.setAttribute("rel","noopener nofollow"),a.appendChild(o),a}},{key:"onRemove",value:function(){return null}}]),t}(Ys);function _W(r){var n=CW();return function(){var e=B(r),i;if(n){var a=B(this).constructor;i=Reflect.construct(e,arguments,a)}else i=e.apply(this,arguments);return et(this,i)}}function CW(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var EW=function(r){tt(t,r);var n=_W(t);function t(e){var i;return $(this,t),i=n.call(this,e),Fc(["update"],I(i)),i}return H(t,[{key:"getDefault",value:function(){return{position:yi.BOTTOMLEFT,maxWidth:100,metric:!0,updateWhenIdle:!1,imperial:!1,name:"scale"}}},{key:"onAdd",value:function(){var i="l7-control-scale",a=ye("div",i);this.addScales(i+"-line",a);var o=this.controlOption.updateWhenIdle;return this.mapsService.on(o?"moveend":"mapmove",this.update),this.mapsService.on(o?"zoomend":"zoomchange",this.update),this.update(),a}},{key:"onRemove",value:function(){var i=this.controlOption.updateWhenIdle;this.mapsService.off(i?"zoomend":"zoomchange",this.update),this.mapsService.off(i?"moveend":"mapmove",this.update)}},{key:"update",value:function(){var i=this.mapsService,a=this.controlOption.maxWidth,o=i.getSize()[1]/2,s=i.containerToLngLat([0,o]),u=i.containerToLngLat([a,o]),l=IH([s.lng,s.lat],[u.lng,u.lat]);this.updateScales(l)}},{key:"updateScales",value:function(i){var a=this.controlOption,o=a.metric,s=a.imperial;o&&i&&this.updateMetric(i),s&&i&&this.updateImperial(i)}},{key:"updateMetric",value:function(i){var a=this.getRoundNum(i),o=a<1e3?a+" m":a/1e3+" km";this.updateScale(this.mScale,o,a/i)}},{key:"updateImperial",value:function(i){var a=i*3.2808399,o,s,u;a>5280?(o=a/5280,s=this.getRoundNum(o),this.updateScale(this.iScale,s+" mi",s/o)):(u=this.getRoundNum(a),this.updateScale(this.iScale,u+" ft",u/a))}},{key:"updateScale",value:function(i,a,o){var s=this.controlOption.maxWidth;i.style.width=Math.round(s*o)+"px",i.innerHTML=a}},{key:"getRoundNum",value:function(i){var a=Math.pow(10,(Math.floor(i)+"").length-1),o=i/a;return o=o>=10?10:o>=5?5:o>=3?3:o>=2?2:1,a*o}},{key:"addScales",value:function(i,a){var o=this.controlOption,s=o.metric,u=o.imperial;s&&(this.mScale=ye("div",i,a)),u&&(this.iScale=ye("div",i,a))}}]),t}(Ys);function SW(r){var n=bW();return function(){var e=B(r),i;if(n){var a=B(this).constructor;i=Reflect.construct(e,arguments,a)}else i=e.apply(this,arguments);return et(this,i)}}function bW(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var AW=function(r){tt(t,r);var n=SW(t);function t(e){var i;return $(this,t),i=n.call(this,e),Fc(["updateDisabled","zoomIn","zoomOut"],I(i)),i}return H(t,[{key:"getDefault",value:function(){return{position:yi.TOPLEFT,zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"&#x2212;",zoomOutTitle:"Zoom out",name:"zoom"}}},{key:"onAdd",value:function(){var i="l7-control-zoom",a=ye("div",i+" l7-bar");return this.zoomInButton=this.createButton(this.controlOption.zoomInText,this.controlOption.zoomInTitle,i+"-in",a,this.zoomIn),this.zoomOutButton=this.createButton(this.controlOption.zoomOutText,this.controlOption.zoomOutTitle,i+"-out",a,this.zoomOut),this.mapsService.on("zoomend",this.updateDisabled),this.mapsService.on("zoomchange",this.updateDisabled),this.updateDisabled(),a}},{key:"onRemove",value:function(){this.mapsService.off("zoomend",this.updateDisabled),this.mapsService.off("zoomchange",this.updateDisabled)}},{key:"disable",value:function(){return this.disabled=!0,this.updateDisabled(),this}},{key:"enable",value:function(){return this.disabled=!1,this.updateDisabled(),this}},{key:"zoomIn",value:function(){!this.disabled&&this.mapsService.getZoom()<this.mapsService.getMaxZoom()&&this.mapsService.zoomIn()}},{key:"zoomOut",value:function(){!this.disabled&&this.mapsService.getZoom()>this.mapsService.getMinZoom()&&this.mapsService.zoomOut()}},{key:"createButton",value:function(i,a,o,s,u){var l=ye("a",o,s);return l.innerHTML=i,l.title=a,l.href="javascript:void(0)",l.addEventListener("click",u),l}},{key:"updateDisabled",value:function(){var i=this.mapsService,a="l7-disabled";ws(this.zoomInButton,a),ws(this.zoomOutButton,a),(this.disabled||i.getZoom()<=i.getMinZoom())&&oa(this.zoomOutButton,a),(this.disabled||i.getZoom()>=i.getMaxZoom())&&oa(this.zoomInButton,a)}}]),t}(Ys);function TW(r){var n=MW();return function(){var e=B(r),i;if(n){var a=B(this).constructor;i=Reflect.construct(e,arguments,a)}else i=e.apply(this,arguments);return et(this,i)}}function MW(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var x_=function(r){tt(t,r);var n=TW(t);function t(e){var i;return $(this,t),i=n.call(this),S(I(i),"added",!1),S(I(i),"eventHandle",function(a){i.emit(a.type,{target:a,data:i.markerOption.extData,lngLat:i.lngLat})}),i.markerOption=U(U({},i.getDefault()),e),Fc(["update","onMove","onUp","addDragHandler","onMapClick"],I(i)),i.init(),i}return H(t,[{key:"getMarkerLayerContainerSize",value:function(){}},{key:"getDefault",value:function(){return{element:void 0,anchor:Sl.BOTTOM,offsets:[0,0],color:"#5B8FF9",draggable:!1}}},{key:"addTo",value:function(i){this.scene=i,this.mapsService=i.get(P.IMapService),this.sceneSerive=i.get(P.ISceneService);var a=this.markerOption.element;return this.mapsService.getMarkerContainer().appendChild(a),this.registerMarkerEvent(a),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.update(),this.added=!0,this.emit("added"),this}},{key:"remove",value:function(){this.mapsService&&(this.mapsService.off("click",this.onMapClick),this.mapsService.off("move",this.update),this.mapsService.off("moveend",this.update),this.mapsService.off("mousedown",this.addDragHandler),this.mapsService.off("touchstart",this.addDragHandler),this.mapsService.off("mouseup",this.onUp),this.mapsService.off("touchend",this.onUp)),this.unRegisterMarkerEvent(),this.removeAllListeners();var i=this.markerOption.element;return i&&Ms(i),this.popup&&this.popup.remove(),this}},{key:"setLnglat",value:function(i){return this.lngLat=i,Array.isArray(i)&&(this.lngLat={lng:i[0],lat:i[1]}),this.popup&&this.popup.setLnglat(this.lngLat),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"getElement",value:function(){return this.markerOption.element}},{key:"setElement",value:function(i){var a=this;if(!this.added)return this.once("added",function(){a.setElement(i)}),this;var o=this.markerOption.element;return o&&Ms(o),this.markerOption.element=i,this.init(),this.mapsService.getMarkerContainer().appendChild(i),this.registerMarkerEvent(i),this.update(),this}},{key:"openPopup",value:function(){var i=this;if(!this.added)return this.once("added",function(){i.openPopup()}),this;var a=this.popup;return a?(a.isOpen()||a.addTo(this.scene),this):this}},{key:"closePopup",value:function(){var i=this;this.added||this.once("added",function(){i.closePopup()});var a=this.popup;return a&&a.remove(),this}},{key:"setPopup",value:function(i){return this.popup=i,this.lngLat&&this.popup.setLnglat(this.lngLat),this}},{key:"togglePopup",value:function(){var i=this.popup;if(i)i.isOpen()?i.remove():i.addTo(this.scene);else return this;return this}},{key:"getPopup",value:function(){return this.popup}},{key:"getOffset",value:function(){return this.markerOption.offsets}},{key:"setDraggable",value:function(i){throw new Error("Method not implemented.")}},{key:"isDraggable",value:function(){return this.markerOption.draggable}},{key:"getExtData",value:function(){return this.markerOption.extData}},{key:"setExtData",value:function(i){this.markerOption.extData=i}},{key:"update",value:function(){if(!!this.mapsService){var i=this.markerOption,a=i.element,o=i.anchor;this.updatePosition(),pH(a,"".concat(Wh[o]))}}},{key:"onMapClick",value:function(i){var a=this.markerOption.element;this.popup&&a&&this.togglePopup()}},{key:"getCurrentContainerSize",value:function(){var i=this.mapsService.getContainer();return{containerHeight:(i==null?void 0:i.scrollHeight)||0,containerWidth:(i==null?void 0:i.scrollWidth)||0,bounds:this.mapsService.getBounds()}}},{key:"updatePosition",value:function(){if(!!this.mapsService){var i=this.markerOption,a=i.element,o=i.offsets,s=this.lngLat,u=s.lng,l=s.lat,c=this.mapsService.lngLatToContainer([u,l]);if(a){a.style.display="block",a.style.whiteSpace="nowrap";var f=this.getMarkerLayerContainerSize()||this.getCurrentContainerSize(),h=f.containerHeight,v=f.containerWidth,p=f.bounds;if(!p)return;if(Math.abs(p[0][0])>180||Math.abs(p[1][0])>180){if(c.x>v){var d=this.mapsService.lngLatToContainer([u-360,l]);c.x=d.x}if(c.x<0){var g=this.mapsService.lngLatToContainer([u+360,l]);c.x=g.x}}(c.x>v||c.x<0||c.y>h||c.y<0)&&(a.style.display="none"),a.style.left=c.x+o[0]+"px",a.style.top=c.y-o[1]+"px"}}}},{key:"init",value:function(){var i=this,a=this.markerOption.element,o=this.markerOption,s=o.color,u=o.anchor;if(!a){this.defaultMarker=!0,a=ye("div"),this.markerOption.element=a;var l=document.createElementNS("http://www.w3.org/2000/svg","svg");l.setAttributeNS(null,"display","block"),l.setAttributeNS(null,"height","48px"),l.setAttributeNS(null,"width","48px"),l.setAttributeNS(null,"viewBox","0 0 1024 1024");var c=document.createElementNS("http://www.w3.org/2000/svg","path");c.setAttributeNS(null,"d","M512 490.666667C453.12 490.666667 405.333333 442.88 405.333333 384 405.333333 325.12 453.12 277.333333 512 277.333333 570.88 277.333333 618.666667 325.12 618.666667 384 618.666667 442.88 570.88 490.666667 512 490.666667M512 85.333333C346.88 85.333333 213.333333 218.88 213.333333 384 213.333333 608 512 938.666667 512 938.666667 512 938.666667 810.666667 608 810.666667 384 810.666667 218.88 677.12 85.333333 512 85.333333Z"),c.setAttributeNS(null,"fill",s),l.appendChild(c),a.appendChild(l)}oa(a,"l7-marker"),Object.keys(this.markerOption.style||{}).forEach(function(f){var h,v,p=((h=i.markerOption)===null||h===void 0?void 0:h.style)&&((v=i.markerOption)===null||v===void 0?void 0:v.style[f]);a&&(a.style[f]=p)}),a.addEventListener("click",function(f){i.onMapClick(f)}),a.addEventListener("click",this.eventHandle),BH(a,u,"marker")}},{key:"registerMarkerEvent",value:function(i){i.addEventListener("mousemove",this.eventHandle),i.addEventListener("click",this.eventHandle),i.addEventListener("mousedown",this.eventHandle),i.addEventListener("mouseup",this.eventHandle),i.addEventListener("dblclick",this.eventHandle),i.addEventListener("contextmenu",this.eventHandle),i.addEventListener("mouseover",this.eventHandle),i.addEventListener("mouseout",this.eventHandle)}},{key:"unRegisterMarkerEvent",value:function(){var i=this.getElement();i.removeEventListener("mousemove",this.eventHandle),i.removeEventListener("click",this.eventHandle),i.removeEventListener("mousedown",this.eventHandle),i.removeEventListener("mouseup",this.eventHandle),i.removeEventListener("dblclick",this.eventHandle),i.removeEventListener("contextmenu",this.eventHandle),i.removeEventListener("mouseover",this.eventHandle),i.removeEventListener("mouseout",this.eventHandle)}},{key:"addDragHandler",value:function(i){throw new Error("Method not implemented.")}},{key:"onUp",value:function(i){throw new Error("Method not implemented.")}}]),t}(dn.exports.EventEmitter);function wW(r,n){var t=typeof my<"u"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,e=typeof wx<"u"&&wx!==null&&(typeof wx.request<"u"||typeof wx.miniProgram<"u");if(!(t||e)&&(n||(n=document),!!n)){var i=n.head||n.getElementsByTagName("head")[0];if(!i){i=n.createElement("head");var a=n.body||n.getElementsByTagName("body")[0];a?a.parentNode.insertBefore(i,a):n.documentElement.appendChild(i)}var o=n.createElement("style");return o.type="text/css",o.styleSheet?o.styleSheet.cssText=r:o.appendChild(n.createTextNode(r)),i.appendChild(o),o}}wW(`.l7-marker-container {
  width: 100%;
  height: 100%;
  overflow: hidden;
  position: absolute;
}

.l7-marker {
  position: absolute !important;
  top: 0;
  left: 0;
  z-index: 5;
  cursor: pointer;
}

.l7-marker-cluster {
  background-clip: padding-box;
  border-radius: 20px;
  background-color: rgba(181, 226, 140, 0.6);
  width: 40px;
  height: 40px;
}
.l7-marker-cluster div {
  width: 30px;
  height: 30px;
  margin-left: 5px;
  margin-top: 5px;
  text-align: center;
  border-radius: 15px;
  font: 12px 'Helvetica Neue', Arial, Helvetica, sans-serif;
  background-color: rgba(110, 204, 57, 0.6);
}
.l7-marker-cluster span {
  line-height: 30px;
}

.l7-popup-anchor-bottom,
.l7-popup-anchor-bottom-left,
.l7-popup-anchor-bottom-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: reverse;
      -ms-flex-direction: column-reverse;
          flex-direction: column-reverse;
}

.l7-popup-close-button {
  position: absolute;
  right: 0;
  top: 0;
  border: 0;
  border-radius: 0 3px 0 0;
  cursor: pointer;
  background-color: transparent;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

/* layers control */

.l7-control-layers {
  -webkit-box-shadow: 0 1px 5px rgba(0, 0, 0, 0.4);
          box-shadow: 0 1px 5px rgba(0, 0, 0, 0.4);
  background: #fff;
  border-radius: 5px;
}
.l7-popup-anchor-top,
.l7-popup-anchor-top-left,
.l7-popup-anchor-top-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}

.l7-popup-anchor-left {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}

.l7-popup-anchor-right {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: reverse;
      -ms-flex-direction: row-reverse;
          flex-direction: row-reverse;
}
.l7-popup {
  position: absolute;
  top: 0;
  left: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  will-change: transform;
  pointer-events: none;
  z-index: 5;
}
.l7-popup-tip {
  width: 0;
  height: 0;
  border: 10px solid transparent;
  z-index: 1;
}
.l7-popup-anchor-top .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-top: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-top-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-top: none;
  border-left: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-top-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-top: none;
  border-right: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-bottom .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-bottom: none;
  border-top-color: #fff;
}

.l7-popup-anchor-bottom-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-bottom: none;
  border-left: none;
  border-top-color: #fff;
}

.l7-popup-anchor-bottom-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-bottom: none;
  border-right: none;
  border-top-color: #fff;
}

.l7-popup-anchor-left .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-left: none;
  border-right-color: #fff;
}

.l7-popup-anchor-right .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-right: none;
  border-left-color: #fff;
}

.l7-popup-close-button {
  position: absolute;
  right: 0;
  top: 0;
  border: 0;
  padding: 0;
  font-size: 25px;
  line-height: 20px;
  border-radius: 0 3px 0 0;
  cursor: pointer;
  background-color: transparent;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

.l7-popup-anchor-top-left .l7-popup-content {
  border-top-left-radius: 0;
}

.l7-popup-anchor-top-right .l7-popup-content {
  border-top-right-radius: 0;
}

.l7-popup-anchor-bottom-left .l7-popup-content {
  border-bottom-left-radius: 0;
}

.l7-popup-anchor-bottom-right .l7-popup-content {
  border-bottom-right-radius: 0;
}

.l7-popup-track-pointer {
  display: none;
}

.l7-popup-track-pointer * {
  pointer-events: none;
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
}

.l7-map:hover .l7-popup-track-pointer {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
}

.l7-map:active .l7-popup-track-pointer {
  display: none;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

/* general toolbar styles */

.l7-bar {
  -webkit-box-shadow: 0 0 1px rgba(0, 0, 0, 0.3);
          box-shadow: 0 0 1px rgba(0, 0, 0, 0.3);
  border-radius: 4px;
}
.l7-bar a,
.l7-bar a:hover {
  background-color: #fff;
  width: 30px;
  height: 30px;
  font-size: 20px;
  display: block;
  text-align: center;
  text-decoration: none;
  color: #8e9dab;
}
.l7-bar a,
.l7-control-layers-toggle {
  background-position: 50% 50%;
  background-repeat: no-repeat;
  display: block;
}
.l7-bar a:hover {
  background-color: #f4f4f4;
}
.l7-bar a:first-child {
  border-top-left-radius: 2px;
  border-top-right-radius: 2px;
}
.l7-bar a:last-child {
  border-bottom-left-radius: 2px;
  border-bottom-right-radius: 2px;
  border-bottom: none;
}
.l7-bar a.l7-disabled {
  cursor: default;
  background-color: #f4f4f4;
  color: #bbb;
}

/* control positioning */

.l7-control-container {
  font: 12px/1.5 'Helvetica Neue', Arial, Helvetica, sans-serif;
}
.l7-control-hide {
  display: none;
}
.l7-control {
  position: relative;
  z-index: 800;
  pointer-events: visiblePainted; /* IE 9-10 doesn't have auto */
  pointer-events: auto;
}
.l7-control {
  float: left;
  clear: both;
}
.l7-top,
.l7-bottom {
  position: absolute;
  z-index: 1000;
  pointer-events: none;
}
.l7-top {
  top: 0;
}
.l7-right {
  right: 0;
}
.l7-bottom {
  bottom: 0;
}
.l7-left {
  left: 0;
}
.l7-center {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
}
.l7-bottom.l7-center,
.l7-top.l7-center {
  width: 100%;
}
.l7-right.l7-center,
.l7-left.l7-center {
  height: 100%;
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}

.l7-top.l7-center,
.l7-left.l7-center {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}

.l7-bottom.l7-center,
.l7-right.l7-center {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}

.l7-center .l7-control {
  margin-right: 10px;
  margin-bottom: 10px;
}

.l7-control {
  float: left;
  clear: both;
}
.l7-right .l7-control {
  float: right;
}
.l7-top .l7-control {
  margin-top: 10px;
}
.l7-bottom .l7-control {
  margin-bottom: 10px;
}
.l7-left .l7-control {
  margin-left: 10px;
}
.l7-right .l7-control {
  margin-right: 10px;
}

/* attribution and scale controls */

.l7-control-container .l7-control-attribution {
  background: #fff;
  background: rgba(59, 58, 58, 0.7);
  margin: 0;
}
.l7-control-attribution,
.l7-control-scale-line {
  padding: 0 5px;
  color: #333;
}
.l7-control-attribution a {
  text-decoration: none;
}
.l7-control-attribution a:hover {
  text-decoration: underline;
}
.l7-container .l7-control-attribution,
.l7-container .l7-control-scale {
  font-size: 11px;
  padding: 5px 5px 2px 5px;
  background: rgba(255, 255, 255, 0.7);
}
.l7-left .l7-control-scale {
  margin-left: 5px;
}
.l7-bottom .l7-control-scale {
  margin-bottom: 5px;
}
.l7-control-scale-line {
  border: 2px solid #000;
  border-top: none;
  color: #000;
  line-height: 1.1;
  padding: 2px 5px 1px;
  font-size: 11px;
  white-space: nowrap;
  overflow: hidden;
  -webkit-box-sizing: border-box;
          box-sizing: border-box;

  background: #fff;
}
.l7-control-scale-line:not(:first-child) {
  border-top: 2px solid #777;
  border-bottom: none;
  margin-top: -2px;
}
.l7-control-scale-line:not(:first-child):not(:last-child) {
  border-bottom: 2px solid #777;
}

.l7-touch .l7-control-attribution,
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  -webkit-box-shadow: none;
          box-shadow: none;
}
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  border: 2px solid rgba(0, 0, 0, 0.2);
  background-clip: padding-box;
}
/*logo */

.l7-ctrl-logo {
  background-size: 100% 100%;
  width: 89px;
  height: 16px;
  margin: 0 0 -3px -3px;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  background-repeat: no-repeat;
  cursor: pointer;
  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALIAAAAgCAYAAAHBIxK2AAAABGdBTUEAALGPC/xhBQAAIJZJREFUeAHtfAl8Tkf3/9z7PNmDRFbZSawhQcRSaqva1xCqpataqrT2UkuUUiqlaKtafe1VS1pUiypB0dIgIkpKRPZIELI/2/zO98akN48nltL3838//84nNzNzzpkzc+eee+bMOXMfxijNaMJ7LOrGO/HdYfZ8fb12gD2JJINJdR8WNHVQnRtSn7hilpz0u2DMKaEcFhZmhdzLNbiPyNVlwPxcm4Qh93Fr0gO4Ol5hfqiz6Q14G+QzGpYzQ9nXrUl7X/fgbrXdG3skX7m26+bNW2fQqJ5XmCs6RQKd6EQwB0zgtKgsvCidGF+N8wV/SBLqSKnXzx2WKIHw1xNxq2xtrKsBXqgrbePt1rivJFmloa5OoD129NcVQwa9Phxwaflw3ifvHCus1YIVjW7fwEF66dIhdYO/XV7Qk+9HY/5F7RA+w0G5TdRxq7gw10FBPWwA+3r9jpkYGcoJ5/7YiFxMiYCjLspsekOeCiJ1AhJJNER+8rfTX/j4BNcUMNCLMmhF+wC3cE9RZmMd/0IQjeTtGdwJjURD5EajsRQN1EwEHjAkUVce2LLhnKf8xGId3ZhkX4uxmj7MMKqJz0ZmMr3MJNZBmphV8WDBOCCgo+2QiE7DF3005wvU75e8vMLs4+P3HwwN7do5MzOu2NcjpPHRX/csCqjt2wvtxEAy8xJ3o+7j3jjkcurpn2xtrT0EPiS0oQPKSOfi/ygqL9H/qNbls8EXuer4+65xUa149QnBvGYFgapAN21EZ+pnuH3rrrnKdNA/zCRmjoqGzu36RoL21q38BLAAjRgo6iir63g1QAOcOoU27DAgwKtpPzVMKU+qBWIuve3Jx0zw4j/eQ0CASeNnjUi5mrYH72ZxUfFV0emJ479/BvrM9KxDAgZZEjziTp1d8+pL415sEdJloIAhF7QCZmnQoCkuLkkXNPfkozU8b4wVb30P4i4ADNQ41P08mtSBogHc27Vx70CPEHeUgRNwgUOuTqBR8wwODraGSIkrKipKxqVuI300mntri1jz9OOs0IHeHUdvms2t0iG+vn5nxmnan5QeUff6GGWttpidSjvGbCSZJdAAGTMwtjWSH2G5XrOp3oEv9wuWxqdeUPchZkW8OGqcedmcdujgUcMOH/zltmgL2YW2Fu22fbMz6q2xM+IEvmvHiCGyRq7AK3QLe959+T6v46co0uVBisLk0/9SqIIhcnQiVBPqULJ4dPVd2ypLg6Dx8wxuhAGDHrCOHTtqUfZ2b6KsYYIOuUiXL1/dKW4SMJRxkbbpG9nv5ecVutlt+PSoNvw7VPg8V4X5wqf4YQVp9g+NDQZDITr2cm/8lNIGlbvp+edGD/946eqJqOKmoBJRhjyjrclk0qlZAqeumw8YOEwE6ILdgh0raN9pcHeWx9n3mViPh9IKnlmBVBWI4bfoePDAEcOGPz9WWUDBzMe1cUdft5CnUfb2DvFR8rsz2avrkOdmT18wJisz5zDaqthVWjwAtzRgtBF9VbSdVofXIPWmB2CCouYqUBUFH59QbwwEqg0XykAi96/VuCEetRrm59msEfA+nqEtAUeqNEt324JGJEsDxpMi26gnaCpUxqJk6bahkGFp3akrZO8IBurcVGponpGW+VOdQP++uIAznzE1/cBBvRRZTc+OP0miUBJ78OiyxNxE6uX+KSP3vDIZuEE/z9BgWZZtHHj1oxZbkS6uJFNqIn+SWSy1AubjFtLd171xoHrQooyFQJRB7+0eHBrk2cxNtBW5mgYwoYNFXg5r7CvoFXWxajQ3mjiTc84wVkB2kTWt5NYk3lZ02SCvzphDDVrNZOY2p3mdA0wrhQoGSm5ig6SRyTsqwSxUaMKk+t4tXJIy4/IsoP82yNu7pYusKwk2WdslZmScvGHOyNs1tJ5GNrjVaeT2W2xsLCnuv5J6woQq/QtbXoLCMJqYtbWj208pKbGK4aamgWJR19XlCvpFEdxn6SDOl0byAjXB/cp8rlM/PteZ83k1T92PTuAw0Ly8GychmosWLB/v7xFSW+AeJQ/0auyLiYFEBgQ0dYKdDRsJfFOvpe0V76fgCVrgkNQTao63hAONr2vjFtAFltoTTFLzB415Al7RFdNipHRviWlLbzCHhZ05HxfEy9e7T/zX8FV+XLk+96e8Tl0xOJZfOpjdKp4kzboZXgGrouDj1rTunHnTQl1caoZ/unLNlKnTx32sNxobR0ZGakQTDCY8tEtEkG+LfihDg+NC2ccjpBXoyMTqVaLjTaFLduxe219XqH+67HYGKU5D0pbN30X5+vl0a9m6mZOPTxvFUIayPRAbM1RpS1uztp0a/SD6e9hcYlKVqgi7QEg/DAyRsAUsKSlNLyvT56Bs8e2Ias4LZzfnfEowJyOOVocZDs9jt8YnMDvUZzblZ+jis1rwtqg/KMHgwEThCUOCUS64U/An6iiL9oIGcFjwqMOQQB0JdTyEXd/tfR/1rMzsWCrPBxwPCxJMfJMELVYq0KO+fNkXk6CHRV/qXPSLXA0XZejpqiRZ0IgcY7hzu+AS2TB3quInaNnU2vzSlNqcT/fhHSqAVJgawAunEXxCPU4W9MMlcRN0ryZMAl2XcOHm6YlnYgMAToIOuxks+YBBErGrAa0YtKDDDkeYAaBFErjSUl2uKOfm5v1GE9y1nOLe/4IO+b3YchfKw0wy3lZ6m2arxyr4KV4RURH54qtS/fGufEMZZ7Hja/Ko0ptsgYML0+kKGM+4wbTbmGQUtPfLMfBrWWc3gIZenX4aJmUp9OQdqunk4nv2QmzMus0rO730wtj0qu2DqnuQjCYbrOjYrINq5JuRe/CKQp3QtRMweivm0yur+FBQf9xk6WFQX99Tvw2GDO0390jssWXW1vKf6n4q7Dc1EOXledJwQxF7RV/EomQbptMXssJlNyT5YSe4dq1m/s907eik1WprNKjdur9sW/1AWt7535Ur6/zvN2/lpcds/37eM892mEgTXGHuHD1y4qLRYK0YvrJsMly5knKu0tg0csmObbvfC2/ZbETK9bOnW4TU7xtGEw0a2geZbKysz/Xu9txQvV6fX6VOrMTw/hVsdF8b/tbGgX1feqF1m7Bq5hda+/o+pVgXm9Ztmzk0ctTBlMyEi/fnaoZ9g3HH1xmv5GgwI/m3+oAZUOzkj4fx7rQBt7qdxnhJDiuj/YlBe9dG1pLNbF9D8c2dem2xVMA3NQhjBk6WMyVaelmZVaL0+vmcB/Tz/zVa+8lIPlWW2SLMQh559ZSNCE2sbCq/FBuLyrrbLJVHsYZMr/sdfpiKJOv1pOxtyISp0tQRtHXqhNWQZffSy5d/LBOwJ5H71mrcAnzSSA2Z84ObJPlCbiujSZubkRefZI5X61hL5pavbzMvY4kuTCuzm6nXE4+Ztwf/lBRmcW1zcSkwxsXF6bWmEnbQSPJsoqWMZumwUqYC7QCVi3Y6tMmnCZdYDItiJezj0v3MaLJmRmXX58w0zKJ3w3ww2IwE+fk7JSUll9b2Crl4NfPcJXOav1OH7fyfdSs6cS7zl18Y65GRd36Pmk/S+dwex0/tHTN54pxNJ0/I2tTsM5WccqDFQgn9rW4nyphg4J95ut9gZis7p6Ym3BI4L9eQ+sS/ntrbLXDIE8/fLKaHVP7goyN5whKyKKMHcsWboSasqsznORfSRYEaz3v29uZt4JiDxMC8QVJLjzntg+ow+dBe7BhRJ1MwQ/AVkRbwQbBj7OtTXgVu49qt79LDrW/OX4yrqjEJ/OIPVrwlfM2CB/rW6XQ3wd9SgjsM41SsC9pLt+H0AptK2fdRjFdYHHwdhY0QOsL1VZDimkIHfLLD8xThcmCF+p3SjOxc0WlV+Zervm2x68dN/QQ+MLC2DVSHqOOVw6ZFXDRgCXjUBQ1y7Py+3bO+HyQLO0bArGV2auRrkxRv1orPPgjXF6XVARxJz0vCPvz4vbkoT50899yTenvAD0ljLx0L8Gr2Et4C9XXnTkEiecNKv/xiU/q1nHNXlQmN2iYVlpWwL0qLmSR3ZNFgQCpCogXuLDMa45WrTH8AcCVpTL8Q7ChbVDhAgO6XmwwGj7AWoa9lZ+UcBt3ufZvn6Ar0bUSbP/+42cJQ7NhbNjj3ybpW2p0G3LtP966DUIYk0TbZDr4Kk9Ho7lXLw1+0g6qo6Wtz8+f9sfmARQzqPZNWiCCBJ/NLtrOz9SkoKPxDlmT1SiJIHiuH6oAeF5e1o9XRGjWqa6pXrxbcqlm3YY7Wtifu6WDeU1xHF59an1cDki9wm8nnU7h3AV0fergDNrsln0+BtKUoP0yizYJr/57DhuJ1wnY5/mziepTVr6e3R0hrsbPLyck7BrxIZO/eAi2uuwE4I3Aok5rIAtzPPbjtxQuXtgCOOtQTwkqrPvlqMmBd2vcfDGeSpfGCXrS7H96SujCnBy+oj6LComSoEoGvUA0A6EvZ8DLaO9nYsUOoSzNy57Oi4mJyBu2SpuRcj2rGvZievUsRgleBf5gk6cpabd62egFoaYtr6NFl8DaUoz96LzTAq0kDlNWppLhE2UTg9Tuf8MdG2sw4DRjQU9H7e3b/FE2vomLoU3nJjm92rYSEwoXZuX3EJvDZsWtdz/+sjGlqMJqCXx/90jzALlz4syQl5awi7aj/EwnxPfC1srJy7ti232Sb6jZHRT+VJvm909I3pjKWayxjYdODeLkO1hnC2OLC/mhQWsJO6UvInCtjHQWDB+XKK2tvF3Dq5JkvVR4t/tzwiHk6namuefunwruvEq9ft86RW4Ef9sqQcK2WXRkzYtKBgtsFGYCNHjHpt3enzd+cnpvwo8pHbKQd2Wg9M3qDhjz9tqd+O7tao2XZqP+TKf8Ga3vyzP630EdGRpY+OTnutuiv0iQDqDOxVgaaSDLpjqMuResukoXHpwTw7jT5XnQlfHBBOgPcgxIiEqu+jG4NuoYN63a4mHzio0vJvy7Blhcwa2srWW0NAFZVgh0uaTSKj0LQYFERZVmy+WP1Z2uno25vZyd/tX5FO5T79x72faoF+xm4J5m4geLOPl7PHPvl1CeyLF1T875nkpdckq7qdOwIqY4aEz35i+XEXCYJ30MXs7dnSghSzaSqMunN2n36dZsBfG7uzYt3r0vpaVm/AHbkxJ4xJYWpD80PbapK6bmnL8+dvURRJXsPbXu5W49OU6n/ItA/zEapKr4PA8fC7OVVS1EXgwe8sq9Nh4aJ6nYWdyrFmayLvQsrIwleF8n4Jk9ntlCvo00gZ6ujE6UHBujQAZw2ZY52Cv8fvj/wwahXJu6VGFdu2sh4rdTs+M6+fl7dSAI+kTS0yfkbCWEndbhJIzPdjRu3TgcGBijqbcHc6Km21iz+b7C22KTEaGxFi1slHDyLsrGgKHr5kvYCsW3btkpeynskGYSrmaQnvTufLubhyL6WDGwK0zH9ypvSKMHoQXmuoaztz0diJoHu9VfePp6el3BYeOGstVYJ0Ys/VSR81OjhPmQqKAvbg3hqZNOd9PTsZNAt/3Rhi+5dW/cmy6SzaGfv7HS817NDlUUWsFWfrU9LzkxMFfjHyadMe3MZ7HPzCwJjMnK/8JbNI6rib1GSQfxpoTT7TRs+mYzLSJJoWkTYsKqYWIIbTNzWuaZTA0iWOT4l+2zKxx99fpXCUKxXv+5hn6/akP7n5eRztbw9O5rToi7cnx5+0rWIvi/uSU4/M2BgZJ/ZAwb2KiO9HynaXLp0rIAkTZeff/tc7MFju2Qm0T7r8RPcnJa43MjL1+PtocUif8SrE2ZkpWWX0Tmbex4q5q/KNFLLO8mcHSTXRc7nRsmzSkILCOzWsJkAypLjBXE4U+mdtmSCGclC+AEbC8US0Wh+u5Jz7jraIWREYfRGuJG064n7AAvxCHHIMxorpLcac4q9lHesYjLRb06qrgtZMoVpuecqzCi0tZRg2wq4pXEiKCDwlnIRMMD9WFvrjGqrwhK9RRj5kp+bwLgS37NI8C/wgTOgSPLyV7ibxoa9Rp7kV8nrVo1E3qSjJSr/CuNlBUxHTswSZmLFkhWTtLSGUqSEjO7yXEN1DZW1FBuQrQllxzK5FVuTc5HtnnOIwlRf1X6Waa1GM24KoNGQT69SkpiGFtIyYwwrMK1jb1+9/U9bApV6/7fyxGYAwewzZ1IdiosNBvF2PzHmD8FIWfcoKPIV7ZZ7Q8rImmJGPWPpR0jqdMxEAs5IgEkWCUm6mf6YRITIOXIFUC6heCvIyguhPIR5s1PE9TYrMixlWkM9ZqRwC2jLkywKSm4tPc005KKeOxe+qb+oKhE9fAUOvLLi0ubYH6AVNpoaLU++lnWezs8/OLbw8D09GUp8HkB7wHCEEwVHjBkOxqvX7x906kgOzMvn89qZWLm7SbSXmXwnqLHLMdVmWKAq5eolSY2wtDyp8aIcFNSqekl+Uftjhy5IbduGV0tKulrCdMEGrcRupeYm/iLoLOXkMpJqe4fUN+hZHRM3keQ9Wip3IGiSEIupmLjooXwByeoUA2daCrSw4nx2Kucye86qhJUq7MUKSznt+SqSHcq0KAqY1okZxqySrlcQUIEvJ7e+RDocW2JdmR3T8K0UT2lOwk1viKQnh2oUuaIqrFt120ct4ySGwaALHDPuVb8ZM9+OxjlFOh95oGXzrsvpxk2e/jb7ERB6VL6PQw9hS79427lUqzOOGBGZj5i64IcPYUp1paHDXxzs+UH07NUCvnrVumlzZ334h0ajuZqWc+68gKtz+Bq//CSmq4kbrRL/PDbPyalGKPDJySm7n27V+wtJywozshMPqduYl4Ugw/oHDm455A8ryDjEhp3CkV+/HxEYGKC0/XDRyreXLVmVbKeyE8HTPOE0DNmONhS3Gu0f4NPTHP+gOj7JGRwx4icYzRU7kUlfSzMW9+PJJMTLS03MztqahXs1YuuK8tmAqFgp70FM74eXxpeHTvhkR3eKY2wic6K5YmRoWBE51UdI825tuV/7h8Uh1qQzFAf26vusy8zZE1eKdt6+Xl1ooovbt+795fVUXRuC03rzzyecisZBYwoCsvETRgbcupFfunrl1mwSHtIW7EpqduKF5My4VBIG9w3rt7L+g3qtggsRI3t91IvzNq7d/sKVK1drk8bOtaSZ16zc3pw0sdV332/sLYSYzofd7tdj+H/Aw1O2/S0DhX8wlWvFv7eI0jpJqs1gs33brv09ej6TT7wqFKulIbt7utalw5RKxJwO4+yCEGMDFdjILbFCkNFw6k7py0XP8qu0Fm8nl4UTcW1nY81ORHXjPaL2SZcFcxq2xNbUXsSstB0oiCbA5TkWCCMvYQbda9KotCuVkCbTQGYyNCFb3ESh72wmayOlRbePV6L5m5UAOh+sK8wNh4tzxaeLF99lY6KjunGuri7h0BZf/GfZBfhQfDyaNEnPSUgw70o5bm8yuZrDUcdSTXftYL4EaiT5tobZJqXknsq+p52e+wB28vT+cfQyPYtyxOA+nw/oPXwPyiKl5ibE+Xs06UJb9x/OJB4OdXd3aUMmkPX2XWsnNAvu8EGZJDWhZfi62izyouPDRh2v9cabr/iGt2o6UvCa9c7CqfQFo0Gy0ZyJyyg/uiZw/0SuNocelX9qbvwv8F5+suxzv6VLPo211J6EvRZWnCXL5jUb+sKAoaDBh5SYKzyT1JxzRzAvlQQZRNN+kn6Oepq3JXn8gar+JKZBRPQbffnSJ+qEpAgdCTjnt/UbGCt7jkq+lbZwVmQqGPlcaVJWhRBHPcXd6ciG29xDbOecNtIGCm3VkKJLnqiy0JfcbIvxxx7fOc7Gxkpx6G3ZEDNn1rsLEy5cOb6GIkIuPXt3eef5FwaO3LxpByNteTM9Pb7yGO7az7+fPTBR+Km2bIyZPWPa/Pi1m1b0b0FONnt7Oz/0g0Su6oLLSVd+GP/G9G9154uLtZL2lsnGPo6XFjyDB0wx33JCC/8NBoavKQKBogB8noskH89jxs5dOw78MC7h5/VkUjiSQD+1fvPKDi8+/+ZhX0/lawzl5bv70jZ1dHTQTJ0xfr5gv+/HQ4vXr/smC/GC9Ixz6QL+T+aPo5ExrvT0E/BwX7I0RoR9TSajFebgmWc7TgINjk6OG/POKVnLctKzE06SECtNK2+67nKLOipdIEEOp7jI73QKg+lKWE3aDB56N5wPuUvCpInpCazEEM7yS86wQloh7tBVXFLEbpa8REL8fjkdl2Y158NItDOp/XnZimXM/ZW3lJY+WSH2dwttRt5o+6+3r+6C4A/6Tkq6EjNp4uz44pIS05wZi94V4164ZNYSN1cXKyz54hyowFnK+0X0GJGccXpneKuwQRcvJB3YvXPfAgSX6CPVeBK2avUb1huy79COLecuHp1Dx5fgU+wCId70zapnhNdZaGPwb9mq2SgBRx45uK87p1Xgjh3NjrV0FmHm92YtnirGggfYp09XV5PRFIBNIeDGohstke/9edtrCNmifC0l/YdXXxz3Cxy76dfPVz4DC4L/sYQvkhFh+HT1h62EEP+45+dFEGJ8xp6enXhSfUsWBRkEM45KubIDe5qE+DsE9XSlNM2lbMv0YP4OxaJIzsm+ePd6DivMb8vu6GKYviyJFRq7Se/d+hq4KMa104PZLBLgDXRiRkPhbU5h7s03PNgx4J9UCvBsGqDnBh/YoO07PDUefEtLyzK7tI9Yh80dQtTr1m7JPHL4+HLg6GxB9f2Hy0M1CNtg5wx4VUnWaO1bNn12YJBfizf69hr+5Zujpqx5PnLUp43rtZvVtFHHCBFAdHFxDlu28v1w8JEljf6FIaN/FseJ8DGe4I9wvYAj37Z113XZVnsaZxUyM8+nkYJJw5Gjn386/JFos3Tl+3NQ1nMpDB/aGbmpxkfL329Wu46fcqiD7je7U9u+n0M72jr5nhDt/ldzH7fgIJOJ+0+aNjaw34AeihI6ezph7YiX3zpGk3sjI/fsWfN7q1KQQUibvNIF51kECfMysmuNlFPUjy2sHchWvhzAyXNM9aWshDTsQOmD0vrShwWKkI704vZFddkXRDuXhJgsELKYS9n7CxKkF1b8KNFr8WQS3Gw6g74JztRNeefNDwXXyeNnzSIBI88gl40GpkRyhg4aeeD69RvKQ8aSHbNrfS+Exvy8yn9OQ7Q1z2kCd+D8BDZnGdcTTqTmJCTjRKgky3nQntezc0+JNl7etRT7WqM1XcOuX9ZoKnlvBB1yrdb6CmhwqU2cjNzEs/A2vPj82Nj0tMz9oLWzt/Pfd3DbYNjntJmr06x5Ywf6ZEIRbuBHvz5lWplOp7jrnvRxZPD/byZ8IE0u3IZ16wbaTpw8Zgn6pjBiQq9uQ2Po6/SyjJwEiy/qfQW5/AYkvviyNIEEcgIFqstweou07GgXA4sZ6cxrlNP89X9MDe7sILM9JK4v60CrYyUlejZy0Z/SrL+oHr8EB7w4q7hr78ZZcLMJritXL16jXr5FGZsoQdOqTfNRM2ZNrGvU81pVfXUGWnoZlN2seqOl8PgH/dFWtm4noF07te33KX0GmIv+GjdpOIzs4SCUN2xZ9Q5lyrPbuuW7uT/tPXjLykq6bMmzAfr/pVQs3WmG8W785rMRlCkr//w50eWrKWPx9zyHuzenvZs/MItOl1a85cGvajjbpJNYdYpd97C3YkfH2fGeK0qkdDCg3x4JoI3fXknH6hMNRnFLx9igZTnSwQd28IgExw9fpO9PTVbQVOR6CkFzslvP0pI/+36scLwRp+9A88a4Vxbt2bV3WHz8hUb0uzm3yn9i4H6tVbgHmCQqykcuptBX2/6uYXFk37d4+413pn62Jvo/YPLm+Nfmt+/QZouzs5PiL066dHnrhHEz4xB8QLDnkTv6hxuQtyWAPESKXV9VV5JReyM193QWBNTXlT4Y4boaeGF9fL26og3cbF9vjsmRtdqcq9nxVX6R9NCCDKYf50jfv+3EO5gYHYbjzItATZg1OzVG5t3IFrWmjeGPpL9cCQ8HXYpGw3rQB38XUX2SCd8ilOmMrouXzAmBpgJvsnUNg/u/shBlnMC2dD7Wzy24HTaAzVuFxtSrFxhBk6fd+u1X8+rXaT2Jlcmt6ZzVHQMYPKEk0SecYEVnd/WCpZNzjZoKjII28FrgvK9tDftjly//dkfQIL+WF5dF9nDyrl37WLeYZ+b3j+g5kzaX9s2aN3kV+OLC4iud2vXfiMMqdYJdfk2NBfT/jfTc0P49unXrVKXQiVEWFhUXvT12xgHaK+jpxf3doNH7IUjWf0DPZwXNvh8OHkFZMsiKshRw8/yRBBmNl+VLZ0fb8ZayzH4krdyEnpQnudbiKRxMAbry9Y5gJwnfOzpfUpZF804fp46dOwlxvY5dnnZ64aVIRbOC39ovN8/GAW9ZsrpoSYhBU82dnczPkbpiI5iUcrK1ra2Nl2M1x7oHf/lueOd2/TeYmEnxAID2iSSDdQbZVp6ff7J214IPZ3YnnnLdunUiyNSJuMvfSC/fi8eOnepAp6EOnss5Rydc/kp0EDORfuXOZeyoqSeDmzSIQVtg8Q3K4IGvzkSZW9vd87sdgP+3Ejw05n3hFxroMgffU6f7KBs4uM8fy5euTjFKRkf6ks4FRJ61PJojL7hTePH99z5Kwsuael3R2gBbTPcMwiKVBeBkxh0KtGw7mQ/dhbeUynihvrU2sKEr2JPb1Km7h238a+ylp4zc6IRNXsdObV3JTswqKCw0kUeCNmLxiWp68zLOBpTeLm5LGydt377dXJycnazhewUd/K/YLZPmk8aOf80/LSW96Ntvf8jFRGodXA5iyRf88Es5xQZda0GbkZZVtGP77ntocaKXlRW3wQOv5ugot+vUyqluUGB18CGT5hZ+jwuOfRx0FbzVOcLQaz7Z0Q6eCsDRHzayiodCI58URwXVbR6l/Lghavw6hYGZsDr/rYSNLSKQcfS7AwiOSGWF4eJewRAmRVAD59MPOjPytwUZncAN5yyzhVacDSFlbDJIbO1qkzQXuP9Gql+/bTXj7WLbUq1t4V3H+kN3q5zWOnq5Jn05Jdm6GvMTExPJnC9PCDgYC2/X1Mp6o38j1xv3m0Q1LT5wu985DghlzGcxdqUaKzvSRpLJXtaFhdUpND8mLsZhKQcPuhSTxRL+UWFCkM3bPexZC/N2/9b/nYF/Z+AxZuD/AA8zEhkTLyOGAAAAAElFTkSuQmCC');
}

/* layers control */

.l7-control-layers {
  -webkit-box-shadow: 0 1px 8px rgba(0, 0, 0, 0.4);
          box-shadow: 0 1px 8px rgba(0, 0, 0, 0.4);
  background: #fff;
  border-radius: 2px;
}
.l7-control-layers-toggle {
  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAkCAYAAAGf7Ah0AAAABGdBTUEAALGPC/xhBQAABzdJREFUWAnVV3lslEUUn/l2F0tpwdAih1HEqCReDcphNCo1EkgFkXa5PNpuC0Fo2e7Wgko8KiaKWrvbK5672xYFpNtiRRuNiY0aURA14BGviBcVlaKltVa6+42/N9v5Mrtt05rwj/PHzjt+8743b+a9N8vYwKgMNlUQyemnMtAkaJajvb3dToQSGp8e6boopkr4VYgEMYwO0vhCTfMVzBcMf8bx086YyODcuM80zTqp9IWat+7evW8sMdIxIqqCLa6oiAaJpuEtcBqcc2HEWMZ0JclgZR/Nchf++ubrzKjJSguXS4tVjXvPjfb3/UAAacGTn/MOMb7QnjNpNqP/bKZ50Ai0tqYmCi0n4zbM+W+lBc7JBOa+QPhDwcTsxJXE2+32edKCL9h8hRDmRzpIOWydAylhrcMfDN+ugBRKSdP3KwPhsFJIPth02FISIYQwYsDYcVfWhy/Bon4JgumffMGmiGTwQ0B/sHml4q2ZFAD3WQIQVhx0IdFw8B189lolN+w8w5PnjPmlhJgtA8/vfn3iye7u3yGzDljDxZEG4097Cp3rSSjBtMHunp6vFR+HHoIxmbgTe1xHKssDHecLNFUjMzbqMs5ZlHF7ute17M84+TMHDzr+OvR9JwKdCms9yRkzJq6bPTsWXh05QOPUN+PUHyPWMPhm6UHd7vaUohWZPSRE8OqxpTyibQa/qcTlbEP0vwF7AWUAT3JM9dy69FfSNza+MU4awNE8iQtXSkJuGLleV852ov2h5jkwVof0mUs8aO4LhTuYYFOAjExId0wcFIPahpaLTkWiX9ECfHG/sLNi1i8+HODfgLFFRI96+INNi0cNTgTS1obKQh03aAuk9DeELzcj4pACYivvwvXrFK/PcQZiQWo+hmidpYMUjQC7EOB6xdNsGfAHwk/RDdOVw9Dm+NTUSWtWLDohDVQ37JkbiUT2DwMeVswZP+gtdM4x3HnLDhjcGM2XLWOISaenIGee9MCSgqgMht/H/q/SZYk0qviV3oKcj5XcioESyOoqIseFYDYloxnAGm/hcrcuk3JV2XBMl+pKqn6mENux11+w12m6jpqMMFn7rPPTHdwfCm8yTfG4tMaNu+GepPUFiqbM7T105ARSPQU+dY/LOC/N2gI65WEkyWUEtjmSppfkLvlRLaQ5VnZFDtGGzbheNRROKZmbu/AvUvh3tE4Wff2/0IUC+y2q+4VVoXBW1BSvkR7Rb8BW84lWJQBdlGozcs7GLy3Nd35OSqTxBqtfgkc1+sPjcqbDgEl6xK0dH5lv545LOCVL1/F+3CoY4eyY1+WcBiC2KYEHQBd5XDkyndE17xCm2Ug6BLcSwb3LigE1AlOYu6TS4HUwVEw0Df1osfBnLDwnpiFDCQPuvQ73Fkqxg8/hEVYLXt66MXbbzOK8bKre1hhkgDT0RDja3fEHytwZxCMLH0YWPkD0fxqjqUZDejDSV3z1LbexqPkEPJxKWLqtKOGbvPnZL460NlE/KgfkIZiRrfjShsQcG2QQDUwwXjcuZcID61Ys6ErUJ/LDOiCfLUzUjVQdEg0O4jn/ABEq0iuIjrEcwE0x/KGWNbjPj4BO00Gni0ZOoIPzLR5X9vMqqaQDqDzzENra4V5zp8sBZQcROYjsLvYUOPdbEVBKeiZ193QjCmwtZCM+ldS6EWYTH3wuNSV1i+pFCj/IAaWgGUfBq0N78qPM3DZcp9TxcTQeyzZm3ON2LatXpSlOP8BIB6qDLddHmHnFrBlpNZmZmdZbNXEB9XsRlZXFennqGHzoXW5DaId4iSoc/Q365EjnRjszPnYXZL9NDWUtGsqzCjAw7xprTypbn7fkaILcYqkInzzeX06C8emO8sKlS7stZQLxVMPes/+O9FVAvEpXob+utY6gZmfrtMjf/RUI+2odhF7wJbq+Gzf3zTj5CAwyaoEwozVoCzN1KKK00z7WUbZx9dIOklsO6CAZpu87i5gpHoJ8gtLh9vZixSO2KckV7qysf5Sc5uq2tjOix3rL0FW3IJuSNV0XM/iDs85LqxvqeKUD8n3LxUobt5WVuLJlS9IM4O9i09VRwWtxLWfpcix+hXjs8mZdjn19YuOiuKRgufzXqOuqQi2r8O+yAk/tl2Q/RMW7ETe8UdX1GJhHDM5qjDHJ5e7bs07qBp7ZsTe9t6/vUXykkLKEdLFbLgLJSUn3rrt1yXEdX/1C23jzVG+5Keg/B5r2wJD9g/NcaUAJq4MvXxxl/TWoATcoGc0Av4eUKnIXZlsvXpLHO0CS2KgOtGQgdeuwqWuUjGbUgrdszLHRXXDLF0oe54AS0kyPnc5Iz/2CmV7EeIzSwcjvsHQPXkUhld/kCP6Xu+DRNjg/SWHh+SnODF+aPeVh9XCydAPEsA4kAqsCzcuiTPiw7+maTj6SwGsVk/9gY9xbUpizR8MNS47aAd0C7s35CG8VdrxYyjl/FcdUgo73nY77X9D/Au9RDMh+aBoVAAAAAElFTkSuQmCC');
  width: 30px;
  height: 30px;
  background-size: 20px 20px;
}

.l7-touch .l7-control-layers-toggle {
  width: 44px;
  height: 44px;
}
.l7-control-layers .l7-control-layers-list,
.l7-control-layers-expanded .l7-control-layers-toggle {
  display: none;
}
.l7-control-layers-expanded .l7-control-layers-list {
  display: block;
  position: relative;
}
.l7-control-layers-expanded {
  padding: 6px 10px 6px 6px;
  color: #59626b;
  background: #fff;
}
.l7-control-layers-scrollbar {
  overflow-y: scroll;
  overflow-x: hidden;
  padding-right: 5px;
}
.l7-control-layers-selector {
  margin-top: 2px;
  position: relative;
  top: 1px;
}
.l7-control-layers label {
  display: block;
  padding: 8px;
}
.l7-control-layers label input[type='radio'],
.l7-control-layers label input[type='checkbox'] {
  width: 14px;
  height: 14px;
  margin: 0;
}
.l7-control-layers-separator {
  height: 0;
  border-top: 1px solid #d8d8d8;
  margin: 5px -10px 5px -6px;
}
.mapboxgl-ctrl-logo {
  display: none !important;
}
.amap-logo {
  display: none !important;
}
`);var uT={},lT={},__=function(n){return lT[n]},Pn=function(n,t){lT[n]=t},LW=function(n){return uT[n]},yo=function(n,t){uT[n]=t};function cT(r,n){var t=n.x,e=n.y,i=n.x1,a=n.y1,o=n.coordinates,s=n.geometry,u=[];if(!Array.isArray(r))return{dataArray:[]};for(var l=function(v){var p=r[v];if(s){var d=U({},p[s]),g=Xf(d,!0);return QC(g,function(T){var k=JC(T),L=U(U({},p),{},{_id:v,coordinates:k});u.push(L)}),"continue"}var y=[];if(o){var m="Polygon";Array.isArray(o[0])||(m="Point"),Array.isArray(o[0])&&!Array.isArray(o[0][0])&&(m="LineString");var x={type:m,coordinates:it(p[o])},_=Xf(x,!0);y=_.coordinates}else if(t&&e&&i&&a){var E=[parseFloat(p[t]),parseFloat(p[e])],b=[parseFloat(p[i]),parseFloat(p[a])];y=[E,b]}else t&&e&&(y=[parseFloat(p[t]),parseFloat(p[e])]);var M=U(U({},p),{},{_id:v,coordinates:y});u.push(M)},c=0;c<r.length;c++)var f=l(c);return{dataArray:u}}function FW(r,n){var t=QM(r);return cT(t,n)}function kW(r){for(var n=r.toString(),t=5381,e=n.length;e;)t=t*33^n.charCodeAt(--e);return t>>>0}function OW(r,n){return n===void 0?null:n==="id"&&r.id?r.id:r[n]?r[n]:r.properties&&r.properties[n]?kW(r.properties[n]+"")%1000019:null}function RW(r,n){var t=[],e={};return r.features?(r.features=r.features.filter(function(i){var a=i.geometry;return i!=null&&a&&a.type&&a.coordinates&&a.coordinates.length>0}),Xf(r,!0),r.features.length===0?{dataArray:[],featureKeys:e}:(QC(r,function(i,a){var o=OW(i,n==null?void 0:n.featureId);o===null&&(o=a);var s=o,u=JC(i),l=U(U({},i.properties),{},{coordinates:u,_id:s});t.push(l)}),{dataArray:t,featureKeys:e})):(r.features=[],{dataArray:[]})}function fT(r,n){var t=n.extent,e=t===void 0?[121.168,30.2828,121.384,30.4219]:t,i=new Promise(function(o){r instanceof HTMLImageElement||CH(r)?o([r]):IW(r,function(s){o(s)})}),a={originData:r,images:i,_id:1,dataArray:[{_id:0,coordinates:[[e[0],e[1]],[e[2],e[3]]]}]};return a}function IW(r,n){var t=r,e=[];if(typeof t=="string")Vh({url:t},function(o,s){s&&(e.push(s),n(e))});else{var i=t.length,a=0;t.forEach(function(o){Vh({url:o},function(s,u){a++,u&&e.push(u),a===i&&n(e)})})}return fT}var DW={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0},PW=function(){var r=Mt(st.mark(function n(t,e,i){var a;return st.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return a=bl(t,e),s.abrupt("return",new Promise(function(u){var l=td({url:a},function(c,f){if(c||!f)u({layers:{}});else{for(var h=new KM(new JM(f)),v=0,p=Object.keys(h.layers);v<p.length;v++){for(var d=p[v],g=[],y=h.layers[d],m=0;m<h.layers[d].length;m++){var x=h.layers[d].feature(m),_=x.toGeoJSON(e.x,e.y,e.z);g.push(_)}y.features=g}u(h)}});i.xhrCancel=function(){return l.abort()}}));case 2:case"end":return s.stop()}},n)}));return function(t,e,i){return r.apply(this,arguments)}}();function BW(r,n){var t=Array.isArray(r)?r[0]:r,e=function(o,s){return PW(t,o,s)},i=U(U(U({},DW),n),{},{getTileData:e});return{data:t,dataArray:[],tilesetOptions:i,isTile:!0}}var NW={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0};function zW(r){for(var n=0,t=0,e=r.length,i=e-1,a,o;t<e;i=t++)a=r[t],o=r[i],n+=(o.x-a.x)*(a.y+o.y);return n}function UW(r){var n=r.length;if(n<=1)return[r];for(var t=[],e,i,a=0;a<n;a++){var o=zW(r[a]);o!==0&&(i===void 0&&(i=o<0),i===o<0?(e&&t.push(e),e=[r[a]]):e.push(r[a]))}return e&&t.push(e),t}var HW=["Unknown","Point","LineString","Polygon"];function $W(r,n,t,e,i){var a=i.geometry,o=i.type,s=i.tags,u=i.id,l=r*Math.pow(2,e),c=r*n,f=r*t,h=HW[o],v,p;function d(m){for(var x=0;x<m.length;x++){var _=m[x];if(_[3])break;var E=180-(_[1]+f)*360/l,b=(_[0]+c)*360/l-180,M=360/Math.PI*Math.atan(Math.exp(E*Math.PI/180))-90;m[x]=[b,M,0,1]}}switch(o){case 1:var g=[];for(v=0;v<a.length;v++)g[v]=a[v][0];a=g,d(a);break;case 2:for(v=0;v<a.length;v++)d(a[v]);break;case 3:for(a=UW(a),v=0;v<a.length;v++)for(p=0;p<a[v].length;p++)d(a[v][p]);break}a.length===1?a=a[0]:h="Multi"+h;var y={type:"Feature",geometry:{type:h,coordinates:a},properties:s,id:u,tileOrigin:[0,0],coord:""};return y}var GW=function(){var r=Mt(st.mark(function n(t,e,i,a){return st.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.abrupt("return",new Promise(function(u){var l=e.getTile(t.z,t.x,t.y),c=[];l.features.map(function(h){var v=$W(a,i.x,i.y,i.z,h);c.push(v)});var f={layers:{geojsonvt:{features:c}}};u(f)}));case 1:case"end":return s.stop()}},n)}));return function(t,e,i,a){return r.apply(this,arguments)}}();function VW(r){var n={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!0,debug:0};return r===void 0||typeof r.geojsonvtOptions>"u"||(r.geojsonvtOptions.maxZoom&&(n.maxZoom=r.geojsonvtOptions.maxZoom),r.geojsonvtOptions.indexMaxZoom&&(n.indexMaxZoom=r.geojsonvtOptions.indexMaxZoom),r.geojsonvtOptions.indexMaxPoints&&(n.indexMaxPoints=r.geojsonvtOptions.indexMaxPoints),r.geojsonvtOptions.tolerance&&(n.tolerance=r.geojsonvtOptions.tolerance),r.geojsonvtOptions.extent&&(n.extent=r.geojsonvtOptions.extent),r.geojsonvtOptions.buffer&&(n.buffer=r.geojsonvtOptions.buffer),r.geojsonvtOptions.lineMetrics&&(n.lineMetrics=r.geojsonvtOptions.lineMetrics),r.geojsonvtOptions.promoteId&&(n.promoteId=r.geojsonvtOptions.promoteId),r.geojsonvtOptions.generateId&&(n.generateId=r.geojsonvtOptions.generateId),r.geojsonvtOptions.debug&&(n.debug=r.geojsonvtOptions.debug)),n}function WW(r,n){var t=VW(n),e=t.extent||4096,i=tw(r,t),a=function(u,l){return GW(l,i,u,e)},o=U(U(U({},NW),n),{},{getTileData:a});return{data:r,dataArray:[],tilesetOptions:o,isTile:!0}}function jW(r,n){var t=n.extent,e=n.width,i=n.height,a=n.min,o=n.max,s={_id:1,dataArray:[{_id:1,data:Array.from(r),width:e,height:i,min:a,max:o,coordinates:[[t[0],t[1]],[t[2],t[3]]]}]};return s}var Va;(function(r){r.IMAGE="image",r.ARRAYBUFFER="arraybuffer"})(Va||(Va={}));var XW=function(){var r=Mt(st.mark(function n(t,e,i,a){var o;return st.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return o={url:ZW(t,e)},u.abrupt("return",new Promise(function(l,c){YW(i,o,function(f,h){f?c(f):h&&l(h)},a)}));case 2:case"end":return u.stop()}},n)}));return function(t,e,i,a){return r.apply(this,arguments)}}(),YW=function(){var r=Mt(st.mark(function n(t,e,i,a){var o,s,u,l,c,f,h,v,p,d,g,y,m,x,_,E,b;return st.wrap(function(T){for(;;)switch(T.prev=T.next){case 0:if(!Array.isArray(e.url)){T.next=35;break}o=[],s=[],u=[],l=e.url,c=0;case 6:if(!(c<l.length)){T.next=20;break}return f=U(U({},e),{},{url:l[c]}),T.next=10,AH(U(U({},f),{},{type:"arrayBuffer"}));case 10:h=T.sent,v=h.err,p=h.data,d=h.xhr,v&&u.push(v),s.push(d),o.push(p);case 17:c++,T.next=6;break;case 20:if(C_(t,s),!(u.length>0)){T.next=24;break}return i(u,null),T.abrupt("return");case 24:return T.next=26,a(o);case 26:g=T.sent,y=g.rasterData,m=g.width,x=g.height,_=0,E=8e3,i(null,{data:y,width:m,height:x,min:_,max:E}),T.next=37;break;case 35:b=td(e,function(k,L){k?i(k):L&&LH(L,i,a)}),C_(t,[b]);case 37:case"end":return T.stop()}},n)}));return function(t,e,i,a){return r.apply(this,arguments)}}();function C_(r,n){r.xhrCancel=function(){n.map(function(t){t.abort()})}}function ZW(r,n){return Array.isArray(r)?r.map(function(t){return bl(t,n)}):bl(r,n)}var E_=function(){var r=Mt(st.mark(function n(t,e,i){var a;return st.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return a=bl(Array.isArray(t)?t[0]:t,e),s.abrupt("return",new Promise(function(u,l){var c=Vh({url:a},function(f,h){f?l(f):h&&u(h)});i.xhrCancel=function(){return c.abort()}}));case 2:case"end":return s.stop()}},n)}));return function(t,e,i){return r.apply(this,arguments)}}(),qW=function(){return{rasterData:new Uint8Array([0]),width:1,height:1}},KW={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0},QW=[Va.ARRAYBUFFER];function JW(r,n){var t=(n==null?void 0:n.dataType)||Va.IMAGE,e=function(o,s){switch(t){case Va.IMAGE:return E_(r,o,s);case Va.ARRAYBUFFER:return XW(r,o,s,(n==null?void 0:n.format)||qW);default:return E_(r,o,s)}},i=U(U(U({},KW),n),{},{getTileData:e});return{data:r,dataArray:[],tilesetOptions:i,isTile:!0}}var tj={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0},ej=function(){var r=Mt(st.mark(function n(t){return st.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.abrupt("return",new Promise(function(a){var o=kt(t.bounds,4),s=o[0],u=o[1],l=o[2],c=o[3],f={layers:{testTile:{features:[{type:"Feature",properties:{key:t.x+"/"+t.y+"/"+t.z,textLng:(s+l)/2,textLat:(u+c)/2},geometry:{type:"LineString",coordinates:[[l,c],[l,u],[s,u],[s,u]]}}]}}};a(f)}));case 1:case"end":return i.stop()}},n)}));return function(t){return r.apply(this,arguments)}}();function rj(r,n){var t=function(a){return ej(a)},e=U(U(U({},tj),n),{},{getTileData:t});return{data:r,dataArray:[],tilesetOptions:e,isTile:!0}}function hT(r,n){var t=n.radius,e=t===void 0?40:t,i=n.maxZoom,a=i===void 0?18:i,o=n.minZoom,s=o===void 0?0:o,u=n.zoom,l=u===void 0?2:u;if(r.pointIndex){var c=r.pointIndex.getClusters(r.extent,Math.floor(l));return r.dataArray=nj(c),r}var f=new DM({radius:e,minZoom:s,maxZoom:a}),h={type:"FeatureCollection",features:[]};return h.features=r.dataArray.map(function(v){return{type:"Feature",geometry:{type:"Point",coordinates:v.coordinates},properties:U({},v)}}),f.load(h.features),f}function nj(r){return r.map(function(n,t){return U({coordinates:n.geometry.coordinates,_id:t+1},n.properties)})}function ij(r){if(r.length===0)throw new Error("max requires at least one data point");for(var n=r[0],t=1;t<r.length;t++)r[t]>n&&(n=r[t]);return n}function aj(r){if(r.length===0)throw new Error("min requires at least one data point");for(var n=r[0],t=1;t<r.length;t++)r[t]<n&&(n=r[t]);return n}function vT(r){if(r.length===0)return 0;for(var n=r[0],t=0,e,i=1;i<r.length;i++)e=n+r[i]*1,Math.abs(n)>=Math.abs(r[i])?t+=n-e+r[i]:t+=r[i]-e+n,n=e;return n+t*1}function oj(r){if(r.length===0)throw new Error("mean requires at least one data point");return vT(r)/r.length}var sj={min:aj,max:ij,mean:oj,sum:vT};function uj(r,n){return r.map(function(t){return t[n]*1})}function lj(r){var n=cj();return function(){var e=B(r),i;if(n){var a=B(this).constructor;i=Reflect.construct(e,arguments,a)}else i=e.apply(this,arguments);return et(this,i)}}function cj(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function fj(r,n){if(Array.isArray(n))return n}var hj=function(r){tt(t,r);var n=lj(t);function t(e,i){var a;return $(this,t),a=n.call(this),S(I(a),"inited",!1),S(I(a),"hooks",{init:new nn}),S(I(a),"parser",{type:"geojson"}),S(I(a),"transforms",[]),S(I(a),"cluster",!1),S(I(a),"clusterOptions",{enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"}),S(I(a),"invalidExtent",!1),S(I(a),"dataArrayChanged",!1),S(I(a),"cfg",{}),a.originData=e,a.initCfg(i),a.init(),a}return H(t,[{key:"getClusters",value:function(i){return this.clusterIndex.getClusters(this.caculClusterExtent(2),i)}},{key:"getClustersLeaves",value:function(i){return this.clusterIndex.getLeaves(i,1/0)}},{key:"getParserType",value:function(){return this.parser.type}},{key:"updateClusterData",value:function(i){var a=this,o=this.clusterOptions,s=o.method,u=s===void 0?"sum":s,l=o.field,c=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(i));this.clusterOptions.zoom=i,c.forEach(function(f){f.id||(f.properties.point_count=1)}),(l||Y.exports.isFunction(u))&&(c=c.map(function(f){var h=f.id;if(h){var v=a.clusterIndex.getLeaves(h,1/0),p=v.map(function(y){return y.properties}),d;if(Y.exports.isString(u)&&l){var g=uj(p,l);d=sj[u](g)}Y.exports.isFunction(u)&&(d=u(p)),f.properties.stat=d}else f.properties.point_count=1;return f})),this.data=__("geojson")({type:"FeatureCollection",features:c}),this.executeTrans()}},{key:"getFeatureById",value:function(i){var a=this.parser.type,o=a===void 0?"geojson":a;if(o==="geojson"&&!this.cluster){var s=i<this.originData.features.length?this.originData.features[i]:"null",u=Y.exports.cloneDeep(s);if(u!=null&&u.properties&&(this.transforms.length!==0||this.dataArrayChanged)){var l=this.data.dataArray.find(function(c){return c._id===i});u.properties=l}return u}else return i<this.data.dataArray.length?this.data.dataArray[i]:"null"}},{key:"updateFeaturePropertiesById",value:function(i,a){this.data.dataArray=this.data.dataArray.map(function(o){return o._id===i?U(U({},o),a):o}),this.dataArrayChanged=!0,this.emit("update")}},{key:"getFeatureId",value:function(i,a){var o=this.data.dataArray.find(function(s){return s[i]===a});return o==null?void 0:o._id}},{key:"setData",value:function(i,a){this.originData=i,this.dataArrayChanged=!1,this.initCfg(a),this.init()}},{key:"destroy",value:function(){var i;this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null,(i=this.tileset)===null||i===void 0||i.destroy()}},{key:"handleData",value:function(){var i=this;return new Promise(function(a,o){try{i.excuteParser(),i.initCluster(),i.executeTrans(),a({})}catch(s){o(s)}})}},{key:"initCfg",value:function(i){this.cfg=Y.exports.mergeWith(this.cfg,i,fj);var a=this.cfg;a&&(a.parser&&(this.parser=a.parser),a.transforms&&(this.transforms=a.transforms),this.cluster=a.cluster||!1,a.clusterOptions&&(this.cluster=!0,this.clusterOptions=U(U({},this.clusterOptions),a.clusterOptions)))}},{key:"init",value:function(){var i=this;this.inited=!1,this.handleData().then(function(){i.inited=!0,i.emit("sourceUpdate")})}},{key:"excuteParser",value:function(){var i=this.parser,a=i.type||"geojson",o=__(a);this.data=o(this.originData,i),this.tileset=this.initTileset(),!i.cancelExtent&&(this.extent=FH(this.data.dataArray),this.setCenter(this.extent),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3])}},{key:"setCenter",value:function(i){this.center=[(i[0]+i[2])/2,(i[1]+i[3])/2],(isNaN(this.center[0])||isNaN(this.center[1]))&&(this.center=[108.92361111111111,34.54083333333333])}},{key:"initTileset",value:function(){var i=this.data.tilesetOptions;if(!!i){if(this.tileset)return this.tileset.updateOptions(i),this.tileset;var a=new y$(U({},i));return a}}},{key:"executeTrans",value:function(){var i=this,a=this.transforms;a.forEach(function(o){var s=o.type,u=LW(s)(i.data,o);Object.assign(i.data,u)})}},{key:"initCluster",value:function(){if(!!this.cluster){var i=this.clusterOptions||{};this.clusterIndex=hT(this.data,i)}}},{key:"caculClusterExtent",value:function(i){var a=[[-1/0,-1/0],[1/0,1/0]];return this.invalidExtent||(a=Lc(El(this.extent),i)),a[0].concat(a[1])}}]),t}(dn.exports.EventEmitter);function vj(r,n){var t=n.callback;return t&&(r.dataArray=r.dataArray.filter(t)),r}function S_(r,n){var t=typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(!t){if(Array.isArray(r)||(t=pj(r))||n&&r&&typeof r.length=="number"){t&&(r=t);var e=0,i=function(){};return{s:i,n:function(){return e>=r.length?{done:!0}:{done:!1,value:r[e++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){t=t.call(r)},n:function(){var l=t.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(o)throw s}}}}function pj(r,n){if(!!r){if(typeof r=="string")return b_(r,n);var t=Object.prototype.toString.call(r).slice(8,-1);if(t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set")return Array.from(r);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return b_(r,n)}}function b_(r,n){(n==null||n>r.length)&&(n=r.length);for(var t=0,e=new Array(n);t<n;t++)e[t]=r[t];return e}var ld=6378e3;function dj(r,n){var t=r.dataArray,e=n.size,i=e===void 0?10:e,a=i/(2*Math.PI*ld)*(256<<20)/2,o=gj(t,i),s=o.gridHash,u=o.gridOffset,l=_j(s,u,n);return{yOffset:a,xOffset:a,radius:a,type:"grid",dataArray:l}}function gj(r,n){var t=1/0,e=-1/0,i,a=S_(r),o;try{for(a.s();!(o=a.n()).done;){var s=o.value;i=s.coordinates[1],Number.isFinite(i)&&(t=i<t?i:t,e=i>e?i:e)}}catch(x){a.e(x)}finally{a.f()}var u=(t+e)/2,l=yj(n,u);if(l.xOffset<=0||l.yOffset<=0)return{gridHash:{},gridOffset:l};var c={},f=S_(r),h;try{for(f.s();!(h=f.n()).done;){var v=h.value,p=v.coordinates[1],d=v.coordinates[0];if(Number.isFinite(p)&&Number.isFinite(d)){var g=Math.floor((p+90)/l.yOffset),y=Math.floor((d+180)/l.xOffset),m="".concat(g,"-").concat(y);c[m]=c[m]||{count:0,points:[]},c[m].count+=1,c[m].points.push(v)}}}catch(x){f.e(x)}finally{f.f()}return{gridHash:c,gridOffset:l}}function yj(r,n){var t=mj(r),e=xj(n,r);return{yOffset:t,xOffset:e}}function mj(r){return r/ld*(180/Math.PI)}function xj(r,n){return n/ld*(180/Math.PI)/Math.cos(r*Math.PI/180)}function _j(r,n,t){return Object.keys(r).reduce(function(e,i,a){var o=i.split("-"),s=parseInt(o[0],10),u=parseInt(o[1],10),l={};if(t.field&&t.method){var c=V2(r[i].points,t.field);l[t.method]=G2[t.method](c)}return Object.assign(l,{_id:a,coordinates:be([-180+n.xOffset*(u+.5),-90+n.yOffset*(s+.5)]),rawData:r[i].points,count:r[i].count}),e.push(l),e},[])}var Cj=6378e3;function Ej(r,n){var t=r.dataArray,e=n.size,i=e===void 0?10:e,a=n.method,o=a===void 0?"sum":a,s=i/(2*Math.PI*Cj)*(256<<20)/2,u=t.map(function(h){var v=be(h.coordinates),p=kt(v,2),d=p[0],g=p[1];return U(U({},h),{},{coordinates:[d,g]})}),l=ew().radius(s).x(function(h){return h.coordinates[0]}).y(function(h){return h.coordinates[1]}),c=l(u),f={dataArray:c.map(function(h,v){var p;if(n.field&&o){var d=V2(h,n.field);h[o]=G2[o](d)}return p={},S(p,n.method,h[o]),S(p,"count",h.length),S(p,"rawData",h),S(p,"coordinates",[h.x,h.y]),S(p,"_id",v),p}),radius:s,xOffset:s,yOffset:s,type:"hexagon"};return f}function Sj(r,n){var t=n.sourceField,e=n.targetField,i=n.data,a={};return i.forEach(function(o){a[o[t]]=o}),r.dataArray=r.dataArray.map(function(o){var s=o[e];return U(U({},o),a[s])}),r}function bj(r,n){var t=n.callback;return t&&(r.dataArray=r.dataArray.map(t)),r}Pn("rasterTile",JW);Pn("mvt",BW);Pn("geojsonvt",WW);Pn("testTile",rj);Pn("geojson",RW);Pn("image",fT);Pn("csv",FW);Pn("json",cT);Pn("raster",jW);yo("cluster",hT);yo("filter",vj);yo("join",Sj);yo("map",bj);yo("grid",dj);yo("hexagon",Ej);const ya=hj;var Gn,lv=(Gn={},S(Gn,Wr.additive,{enable:!0,func:{srcRGB:A.ONE,dstRGB:A.ONE,srcAlpha:1,dstAlpha:1}}),S(Gn,Wr.none,{enable:!1}),S(Gn,Wr.normal,{enable:!0,func:{srcRGB:A.SRC_ALPHA,dstRGB:A.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}),S(Gn,Wr.subtractive,{enable:!0,func:{srcRGB:A.ONE,dstRGB:A.ONE,srcAlpha:A.ZERO,dstAlpha:A.ONE_MINUS_SRC_COLOR},equation:{rgb:A.FUNC_SUBTRACT,alpha:A.FUNC_SUBTRACT}}),S(Gn,Wr.max,{enable:!0,func:{srcRGB:A.ONE,dstRGB:A.ONE},equation:{rgb:A.MAX_EXT}}),S(Gn,Wr.min,{enable:!0,func:{srcRGB:A.ONE,dstRGB:A.ONE},equation:{rgb:A.MIN_EXT}}),Gn);function $e(r,n,t,e,i){n.updateStyleAttribute(r,t,e,i)}function Aj(r,n){n.tileLayer||n.isTileLayer||(r.opacity&&Ru("opacity",n,r.opacity),r.strokeWidth&&Ru("strokeWidth",n,r.strokeWidth),r.strokeOpacity&&Ru("strokeOpacity",n,r.strokeOpacity),r.stroke&&Tj("stroke",n,r.stroke),r.offsets&&A_("offsets",n,r.offsets),r.textOffset&&A_("textOffset",n,r.textOffset),r.thetaOffset&&Ru("thetaOffset",n,r.thetaOffset))}function Ru(r,n,t){Y.exports.isString(t)?$e(r,n,t,function(e){return e}):Y.exports.isNumber(t)?$e(r,n,[t],void 0):Array.isArray(t)&&t.length===2?Y.exports.isString(t[0])&&Y.exports.isFunction(t[1])||Y.exports.isString(t[0])&&Array.isArray(t[1])&&Y.exports.isNumber(t[1][0])&&Y.exports.isNumber(t[1][1])?$e(r,n,t[0],t[1]):$e(r,n,[1],void 0):$e(r,n,[1],void 0)}function A_(r,n,t){Y.exports.isString(t)?$e(r,n,t,function(e){return e}):Array.isArray(t)&&t.length===2&&Y.exports.isString(t[0])&&Y.exports.isFunction(t[1])?$e(r,n,t[0],t[1]):Array.isArray(t)&&t.length===2&&Y.exports.isNumber(t[0])&&Y.exports.isNumber(t[1])?$e(r,n,t,void 0):$e(r,n,[0,0],void 0)}function Tj(r,n,t){Y.exports.isString(t)?$e(r,n,t,void 0):Array.isArray(t)&&t.length===2&&(Y.exports.isString(t[0])&&Y.exports.isFunction(t[1])||Y.exports.isString(t[0])&&Array.isArray(t[1])&&t[1].length>0)?$e(r,n,t[0],t[1]):$e(r,n,"#fff",void 0)}var T_,Df,M_,pT=(T_=ud(P.IGlobalConfigService),Df=function(){function r(n){$(this,r),St(this,"configService",M_,this),this.config=n}return H(r,[{key:"setContainer",value:function(t,e,i,a){t.bind(P.MapConfig).toConstantValue(U(U({},this.config),{},{id:e,canvas:i,hasBaseMap:a})),t.bind(P.IMapService).to(this.getServiceConstructor()).inSingletonScope()}},{key:"getServiceConstructor",value:function(){throw new Error("Method not implemented.")}}]),r}(),M_=Ct(Df.prototype,"configService",[T_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Df),ae;(function(r){r["GAODE1.x"]="GAODE1.x",r["GAODE2.x"]="GAODE2.x",r.MAPBOX="MAPBOX",r.L7MAP="L7MAP",r.SIMPLE="SIMPLE",r.GLOBEL="GLOBEL"})(ae||(ae={}));var w_=Math.PI/180,Mj=function(){function r(){$(this,r),S(this,"projectionMatrix",fr()),S(this,"viewMatrix",fr()),S(this,"viewProjectionMatrix",fr()),S(this,"ViewProjectionMatrixUncentered",fr()),S(this,"viewUncenteredMatrix",fr())}return H(r,[{key:"syncWithMapCamera",value:function(t){var e=t.zoom,i=e===void 0?1:e,a=t.pitch,o=a===void 0?0:a,s=t.bearing,u=s===void 0?0:s,l=t.center,c=l===void 0?[0,0]:l,f=t.offsetOrigin,h=f===void 0?[0,0]:f,v=t.cameraHeight,p=v===void 0?1:v,d=t.aspect,g=d===void 0?1:d,y=t.near,m=y===void 0?.1:y,x=t.far,_=x===void 0?1e3:x,E=t.fov,b=E===void 0?0:E;this.zoom=i,this.center=c;var M=o*w_,T=(360-u)*w_;iM(this.projectionMatrix,b,g,m,_);var k=_e(p*Math.sin(M)*Math.sin(T),-p*Math.sin(M)*Math.cos(T),p*Math.cos(M)),L=_e(-Math.cos(M)*Math.sin(T),Math.cos(M)*Math.cos(T),Math.sin(M));aM(this.viewMatrix,k,_e(0,0,0),L),this.viewUncenteredMatrix=oM(this.viewMatrix),Ll(this.viewMatrix,this.viewMatrix,_e(-h[0],h[1],0)),Xi(this.viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),Xi(this.ViewProjectionMatrixUncentered,this.projectionMatrix,this.viewMatrix)}},{key:"getZoom",value:function(){return this.zoom}},{key:"getZoomScale",value:function(){return 524288}},{key:"getCenter",value:function(){var t=kt(this.center,2),e=t[0],i=t[1];return[e,i]}},{key:"getProjectionMatrix",value:function(){return this.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewUncenteredMatrix}},{key:"getViewProjectionMatrix",value:function(){return this.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.ViewProjectionMatrixUncentered}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(t){var e=85.0511287798,i=Math.max(Math.min(e,t[1]),-e),a=256<<20,o=Math.PI/180,s=t[0]*o,u=i*o;u=Math.log(Math.tan(Math.PI/4+u/2));var l=.5/Math.PI,c=.5,f=-.5/Math.PI;return o=.5,s=a*(l*s+c)-215440491,u=-(a*(f*u+o)-106744817),[s,u]}}]),r}(),dT=function(){function r(n){$(this,r),S(this,"size",1e4),this.size=n||1e4}return H(r,[{key:"setSize",value:function(t){this.size=t}},{key:"getSize",value:function(){return[this.size,this.size]}},{key:"mercatorXfromLng",value:function(t){return(180+t)/360*this.size}},{key:"mercatorYfromLat",value:function(t){return(1-(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360)*this.size}},{key:"lngFromMercatorX",value:function(t){return t/this.size*360-180}},{key:"latFromMercatorY",value:function(t){var e=180-(1-t/this.size)*360;return 360/Math.PI*Math.atan(Math.exp(e*Math.PI/180))-90}},{key:"project",value:function(t){var e=this.mercatorXfromLng(t[0]),i=this.mercatorYfromLat(t[1]);return[e,i]}},{key:"unproject",value:function(t){var e=this.lngFromMercatorX(t[0]),i=this.latFromMercatorY(t[1]);return[e,i]}}]),r}();function L_(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n={top:0,right:0,bottom:0,left:0};if(typeof r=="number")return{top:r,right:r,bottom:r,left:r};if(Array.isArray(r)){if(r.length===4)return{top:r[0],right:r[1],bottom:r[2],left:r[3]};if(r.length===2)return{top:r[0],right:r[1],bottom:r[0],left:r[1]}}return Object.assign({},n,r)}var wj=function(){function r(){$(this,r)}return H(r,[{key:"syncWithMapCamera",value:function(t){var e=t.center,i=t.zoom,a=t.pitch,o=t.bearing,s=t.viewportHeight,u=t.viewportWidth,l=this.viewport?{width:this.viewport.width,height:this.viewport.height,longitude:this.viewport.center[0],latitude:this.viewport.center[1],zoom:this.viewport.zoom,pitch:this.viewport.pitch,bearing:this.viewport.bearing}:{};this.viewport=new KC(U(U({},l),{},{width:u,height:s,longitude:e&&e[0],latitude:e&&e[1],zoom:i,pitch:a,bearing:o}))}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(t,e){return this.viewport.projectFlat(t,e)}}]),r}(),F_={dark:"amap://styles/c9f1d10cae34f8ab05e425462c5a58d7?isPublic=true",light:"amap://styles/c422f5c0cfced5be9fe3a83f05f28a68?isPublic=true",normal:"amap://styles/normal",blank:"amap://styles/07c17002b38775b32a7a76c66cf90e99?isPublic=true"},Lj=["id","style","minZoom","maxZoom","token","mapInstance","plugin"],k_,O_,R_,I_,D_,P_,Ta,B_,N_,z_,U_;function Fj(r,n){var t=typeof my<"u"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,e=typeof wx<"u"&&wx!==null&&(typeof wx.request<"u"||typeof wx.miniProgram<"u");if(!(t||e)&&(n||(n=document),!!n)){var i=n.head||n.getElementsByTagName("head")[0];if(!i){i=n.createElement("head");var a=n.body||n.getElementsByTagName("body")[0];a?a.parentNode.insertBefore(i,a):n.documentElement.appendChild(i)}var o=n.createElement("style");return o.type="text/css",o.styleSheet?o.styleSheet.cssText=r:o.appendChild(n.createTextNode(r)),i.appendChild(o),o}}Fj(`.amap-logo{
 display: none !important;
}
`);var kj=0;window.forceWebGL=!0;var H_="15cd8a57710d40c9b7c0e3cc120f1200",Oj="1.4.15",Rj="amap-script",Pf=!1,Iu=[],Ij=12,Dj=(k_=xt(),O_=At(P.IGlobalConfigService),R_=At(P.MapConfig),I_=At(P.ICoordinateSystemService),D_=At(P.IEventEmitter),k_(P_=(Ta=function(){function r(){var n=this;$(this,r),S(this,"version",ae["GAODE1.x"]),S(this,"simpleMapCoord",new dT),S(this,"bgColor","rgba(0, 0, 0, 0)"),St(this,"configService",B_,this),St(this,"config",N_,this),St(this,"coordinateSystemService",z_,this),St(this,"eventEmitter",U_,this),S(this,"handleCameraChanged",function(t){var e=t.camera,i=e.fov,a=e.near,o=e.far,s=e.height,u=e.pitch,l=e.rotation,c=e.aspect,f=e.position,h=n.getCenter(),v=h.lng,p=h.lat;if(n.emit("mapchange"),n.cameraChangedCallback){n.viewport.syncWithMapCamera({aspect:c,bearing:360-l,far:o,fov:i,cameraHeight:s,near:a,pitch:u,zoom:n.map.getZoom()-1,center:[v,p],offsetOrigin:[f.x,f.y]});var d=n.config.offsetZoom,g=d===void 0?Ij:d;n.viewport.getZoom()>g?n.coordinateSystemService.setCoordinateSystem(Fr.P20_OFFSET):n.coordinateSystemService.setCoordinateSystem(Fr.P20),n.cameraChangedCallback(n.viewport)}})}return H(r,[{key:"setBgColor",value:function(t){this.bgColor=t}},{key:"addMarkerContainer",value:function(){var t=this.map.getContainer();if(t!==null){var e=t.getElementsByClassName("amap-maps")[0];this.markerContainer=ye("div","l7-marker-container",e)}}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(t,e){uv.indexOf(t)!==-1?this.eventEmitter.on(t,e):this.map.on(t,e)}},{key:"off",value:function(t,e){uv.indexOf(t)!==-1?this.eventEmitter.off(t,e):this.map.off(t,e)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){var t;return(t=this.map.getContainer())===null||t===void 0?void 0:t.getElementsByClassName("amap-maps")[0]}},{key:"getSize",value:function(){var t=this.map.getSize();return[t.getWidth(),t.getHeight()]}},{key:"getType",value:function(){return"amap"}},{key:"getZoom",value:function(){return this.map.getZoom()-1}},{key:"setZoom",value:function(t){return this.map.setZoom(t+1)}},{key:"getCenter",value:function(t){if(t!=null&&t.padding){var e=this.getCenter(),i=this.getSize(),a=kt(i,2);a[0],a[1];var o=L_(t.padding),s=this.lngLatToPixel([e.lng,e.lat]),u=[(o.right-o.left)/2,(o.bottom-o.top)/2],l=this.pixelToLngLat([s.x-u[0],s.y-u[1]]);return l}var c=this.map.getCenter();return{lng:c.getLng(),lat:c.getLat()}}},{key:"setCenter",value:function(t,e){if(e!=null&&e.padding){var i=L_(e.padding),a=this.lngLatToPixel(t),o=[(i.right-i.left)/2,(i.bottom-i.top)/2],s=this.pixelToLngLat([a.x+o[0],a.y+o[1]]);this.map.setCenter([s.lng,s.lat])}else this.map.setCenter(t)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return 360-this.map.getRotation()}},{key:"getBounds",value:function(){var t=this.map.getBounds().toBounds(),e=t.getNorthEast(),i=t.getSouthWest(),a=this.getCenter(),o=a.lng>e.getLng()||a.lng<i.getLng()?180-e.getLng():e.getLng(),s=a.lng<i.getLng()?i.getLng()-180:i.getLng();return[[s,i.getLat()],[o,e.getLat()]]}},{key:"getMinZoom",value:function(){var t=this.map.get("zooms");return t[0]-1}},{key:"getMaxZoom",value:function(){var t=this.map.get("zooms");return t[1]-1}},{key:"setRotation",value:function(t){return this.map.setRotation(t)}},{key:"setPitch",value:function(t){return this.map.setPitch(t)}},{key:"zoomIn",value:function(){this.map.zoomIn()}},{key:"zoomOut",value:function(){this.map.zoomOut()}},{key:"panTo",value:function(t){this.map.panTo(t)}},{key:"panBy",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;this.map.panBy(t,e)}},{key:"fitBounds",value:function(t){this.map.setBounds(new AMap.Bounds([t[0][0],t[0][1],t[1][0],t[1][1]]))}},{key:"setZoomAndCenter",value:function(t,e){this.map.setZoomAndCenter(t+1,e)}},{key:"setMapStyle",value:function(t){this.map.setMapStyle(this.getMapStyle(t))}},{key:"setMapStatus",value:function(t){this.map.setStatus(t)}},{key:"pixelToLngLat",value:function(t){var e=this.map.pixelToLngLat(new AMap.Pixel(t[0],t[1]));return{lng:e.getLng(),lat:e.getLat()}}},{key:"lngLatToPixel",value:function(t){var e=this.map.lnglatToPixel(new AMap.LngLat(t[0],t[1]));return{x:e.getX(),y:e.getY()}}},{key:"containerToLngLat",value:function(t){var e=new AMap.Pixel(t[0],t[1]),i=this.map.containerToLngLat(e);return{lng:i==null?void 0:i.getLng(),lat:i==null?void 0:i.getLat()}}},{key:"lngLatToContainer",value:function(t){var e=new AMap.LngLat(t[0],t[1]),i=this.map.lngLatToContainer(e);return{x:i.getX(),y:i.getY()}}},{key:"lngLatToCoord",value:function(t){var e=this.map.lngLatToGeodeticCoord(t),i=e.x,a=e.y;return[i,-a]}},{key:"lngLatToMercator",value:function(t,e){return{x:0,y:0,z:0}}},{key:"getModelMatrix",value:function(t,e,i){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],o=this.viewport.projectFlat(t),s=fr();return Ll(s,s,_e(o[0],o[1],e)),mv(s,s,_e(a[0],a[1],a[2])),Fl(s,s,i[0]),kl(s,s,i[1]),xv(s,s,i[2]),s}},{key:"init",value:function(){var n=Mt(st.mark(function e(){var i=this,a,o,s,u,l,c,f,h,v,p,d,g,y,m;return st.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return a=this.config,o=a.id,s=a.style,u=s===void 0?"light":s,l=a.minZoom,c=l===void 0?0:l,f=a.maxZoom,h=f===void 0?18:f,v=a.token,p=v===void 0?H_:v,d=a.mapInstance,g=a.plugin,y=g===void 0?[]:g,m=un(a,Lj),_.next=3,new Promise(function(E){var b=function(){if(d)i.map=d,i.$mapContainer=i.map.getContainer(),setTimeout(function(){i.map.on("camerachange",i.handleCameraChanged),E()},30);else{i.$mapContainer=i.creatMapContainer(o);var T=U({mapStyle:i.getMapStyle(u),zooms:[c,h],viewMode:"3D"},m);T.zoom&&(T.zoom+=1);var k=new AMap.Map(i.$mapContainer,T);k.on("camerachange",i.handleCameraChanged),k.on("camerachange",function(){setTimeout(function(){return i.handleAfterMapChange()})}),i.map=k,setTimeout(function(){E()},10)}};!Pf&&!d?(p===H_&&console.warn(i.configService.getSceneWarninfo("MapToken")),Pf=!0,y.push("Map3D"),qC.load({key:p,version:Oj,plugins:y}).then(function(M){b(),Iu.length&&(Iu.forEach(function(T){return T()}),Iu=[])}).catch(function(M){throw new Error(M)})):Pf&&window.AMap||d?b():Iu.push(b)});case 3:this.viewport=new wj;case 4:case"end":return _.stop()}},e,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"meterToCoord",value:function(t,e){var i=AMap.GeometryUtil.distance(nl(AMap.LngLat,it(t)),nl(AMap.LngLat,it(e))),a=this.lngLatToCoord(t),o=kt(a,2),s=o[0],u=o[1],l=this.lngLatToCoord(e),c=kt(l,2),f=c[0],h=c[1],v=Math.sqrt(Math.pow(s-f,2)+Math.pow(u-h,2));return v/i}},{key:"updateView",value:function(t){}},{key:"getOverlayContainer",value:function(){}},{key:"exportMap",value:function(t){var e,i=(e=this.getContainer())===null||e===void 0?void 0:e.getElementsByClassName("amap-layer")[0],a=t==="jpg"?i==null?void 0:i.toDataURL("image/jpeg"):i==null?void 0:i.toDataURL("image/png");return a}},{key:"emit",value:function(t){for(var e,i=arguments.length,a=new Array(i>1?i-1:0),o=1;o<i;o++)a[o-1]=arguments[o];(e=this.eventEmitter).emit.apply(e,[t].concat(a))}},{key:"once",value:function(t){for(var e,i=arguments.length,a=new Array(i>1?i-1:0),o=1;o<i;o++)a[o-1]=arguments[o];(e=this.eventEmitter).once.apply(e,[t].concat(a))}},{key:"destroy",value:function(){var t,e;this.map.destroy(),(t=this.$mapContainer)===null||t===void 0||(e=t.parentNode)===null||e===void 0||e.removeChild(this.$mapContainer),delete window.initAMap;var i=document.getElementById(Rj);i&&document.head.removeChild(i)}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"onCameraChanged",value:function(t){this.cameraChangedCallback=t}},{key:"handleAfterMapChange",value:function(){this.emit("mapAfterFrameChange")}},{key:"getMapStyle",value:function(t){return F_[t]?F_[t]:t}},{key:"creatMapContainer",value:function(t){var e=t;typeof t=="string"&&(e=document.getElementById(t));var i=document.createElement("div");return i.style.cssText+=`
       position: absolute;
       top: 0;
       height: 100%;
       width: 100%;
     `,i.id="l7_amap_div"+kj++,e.appendChild(i),i}}]),r}(),B_=Ct(Ta.prototype,"configService",[O_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),N_=Ct(Ta.prototype,"config",[R_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),z_=Ct(Ta.prototype,"coordinateSystemService",[I_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),U_=Ct(Ta.prototype,"eventEmitter",[D_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ta))||P_),Pj=["id","style","minZoom","maxZoom","token","mapInstance","plugin"],$_,G_;function Bj(r){var n=Nj();return function(){var e=B(r),i;if(n){var a=B(this).constructor;i=Reflect.construct(e,arguments,a)}else i=e.apply(this,arguments);return et(this,i)}}function Nj(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}window.forceWebGL=!0;var V_="15cd8a57710d40c9b7c0e3cc120f1200",zj="1.4.15",Bf=!1,Du=[],Uj=12,Hj=($_=xt(),$_(G_=function(r){tt(t,r);var n=Bj(t);function t(){var e;$(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return e=n.call.apply(n,[this].concat(a)),S(I(e),"version",ae["GAODE1.x"]),S(I(e),"handleCameraChanged",function(s){var u=s.camera,l=u.fov,c=u.near,f=u.far,h=u.height,v=u.pitch,p=u.rotation,d=u.aspect,g=u.position,y=e.getCenter(),m=y.lng,x=y.lat;if(e.emit("mapchange"),e.cameraChangedCallback){e.viewport.syncWithMapCamera({aspect:d,bearing:360-p,far:f,fov:l,cameraHeight:h,near:c,pitch:v,zoom:e.map.getZoom()-1,center:[m,x],offsetOrigin:[g.x,g.y]});var _=e.config.offsetZoom,E=_===void 0?Uj:_;e.viewport.getZoom()>E?e.coordinateSystemService.setCoordinateSystem(Fr.P20_OFFSET):e.coordinateSystemService.setCoordinateSystem(Fr.P20),e.cameraChangedCallback(e.viewport)}}),e}return H(t,[{key:"getModelMatrix",value:function(i,a,o){var s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],u=this.viewport.projectFlat(i),l=fr();return Ll(l,l,_e(u[0],u[1],a)),mv(l,l,_e(s[0],s[1],s[2])),Fl(l,l,o[0]),kl(l,l,o[1]),xv(l,l,o[2]),l}},{key:"init",value:function(){var e=Mt(st.mark(function a(){var o=this,s,u,l,c,f,h,v,p,d,g,y,m,x,_;return st.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return s=this.config,u=s.id,l=s.style,c=l===void 0?"light":l,f=s.minZoom,h=f===void 0?0:f,v=s.maxZoom,p=v===void 0?18:v,d=s.token,g=d===void 0?V_:d,y=s.mapInstance,m=s.plugin,x=m===void 0?[]:m,_=un(s,Pj),b.next=3,new Promise(function(M){var T=function(){if(y)o.map=y,o.$mapContainer=o.map.getContainer(),setTimeout(function(){o.map.on("camerachange",o.handleCameraChanged),M()},30);else{o.$mapContainer=o.creatMapContainer(u);var L=U({mapStyle:o.getMapStyle(c),zooms:[h,p],viewMode:"3D"},_);L.zoom&&(L.zoom+=1);var O=new AMap.Map(o.$mapContainer,L);O.on("camerachange",o.handleCameraChanged),O.on("camerachange",function(){setTimeout(function(){return o.handleAfterMapChange()})}),o.map=O,setTimeout(function(){M()},10)}};!Bf&&!y?(g===V_&&console.warn(o.configService.getSceneWarninfo("MapToken")),Bf=!0,x.push("Map3D"),qC.load({key:g,version:zj,plugins:x}).then(function(k){T(),Du.length&&(Du.forEach(function(L){return L()}),Du=[])}).catch(function(k){throw new Error(k)})):Bf&&window.AMap||y?T():Du.push(T)});case 3:this.viewport=new Mj;case 4:case"end":return b.stop()}},a,this)}));function i(){return e.apply(this,arguments)}return i}()},{key:"meterToCoord",value:function(i,a){var o=AMap.GeometryUtil.distance(nl(AMap.LngLat,it(i)),nl(AMap.LngLat,it(a))),s=this.lngLatToCoord(i),u=kt(s,2),l=u[0],c=u[1],f=this.lngLatToCoord(a),h=kt(f,2),v=h[0],p=h[1],d=Math.sqrt(Math.pow(l-v,2)+Math.pow(c-p,2));return d/o}},{key:"updateView",value:function(i){}},{key:"getOverlayContainer",value:function(){}},{key:"exportMap",value:function(i){var a,o=(a=this.getContainer())===null||a===void 0?void 0:a.getElementsByClassName("amap-layer")[0],s=i==="jpg"?o==null?void 0:o.toDataURL("image/jpeg"):o==null?void 0:o.toDataURL("image/png");return s}},{key:"onCameraChanged",value:function(i){this.cameraChangedCallback=i}}]),t}(Dj))||G_);function $j(r){var n=Gj();return function(){var e=B(r),i;if(n){var a=B(this).constructor;i=Reflect.construct(e,arguments,a)}else i=e.apply(this,arguments);return et(this,i)}}function Gj(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Vj=function(r){tt(t,r);var n=$j(t);function t(){return $(this,t),n.apply(this,arguments)}return H(t,[{key:"getServiceConstructor",value:function(){return Hj}}]),t}(pT),W_={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},j_,X_,Y_,Z_,q_,K_,Ma,Q_,J_,t1,e1,r1={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},Wj=12,jj=(j_=xt(),X_=At(P.MapConfig),Y_=At(P.IGlobalConfigService),Z_=At(P.ICoordinateSystemService),q_=At(P.IEventEmitter),j_(K_=(Ma=function(){function r(){var n=this;$(this,r),S(this,"version",ae.L7MAP),S(this,"simpleMapCoord",new dT),S(this,"bgColor","rgba(0.0, 0.0, 0.0, 0.0)"),St(this,"config",Q_,this),St(this,"configService",J_,this),St(this,"coordinateSystemService",t1,this),St(this,"eventEmitter",e1,this),S(this,"handleCameraChanged",function(t){var e=n.map.getCenter(),i=e.lat,a=e.lng;n.emit("mapchange"),n.viewport.syncWithMapCamera({bearing:n.map.getBearing(),center:[a,i],viewportHeight:n.map.transform.height,pitch:n.map.getPitch(),viewportWidth:n.map.transform.width,zoom:n.map.getZoom(),cameraHeight:0}),n.updateCoordinateSystemService(),n.cameraChangedCallback(n.viewport)})}return H(r,[{key:"setBgColor",value:function(t){this.bgColor=t}},{key:"addMarkerContainer",value:function(){var t=this.map.getCanvasContainer();this.markerContainer=ye("div","l7-marker-container",t),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"getOverlayContainer",value:function(){}},{key:"on",value:function(t,e){uv.indexOf(t)!==-1?this.eventEmitter.on(t,e):this.map.on(r1[t]||t,e)}},{key:"off",value:function(t,e){this.map.off(r1[t]||t,e),this.eventEmitter.off(t,e)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){if(this.version===ae.SIMPLE)return this.simpleMapCoord.getSize();var t=this.map.transform;return[t.width,t.height]}},{key:"getType",value:function(){return"default"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(t){return this.map.setZoom(t)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(t){this.map.setCenter(t)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(t){this.map.setBearing(t)}},{key:"zoomIn",value:function(t,e){this.map.zoomIn(t,e)}},{key:"zoomOut",value:function(t,e){this.map.zoomOut(t,e)}},{key:"setPitch",value:function(t){return this.map.setPitch(t)}},{key:"panTo",value:function(t){this.map.panTo(t)}},{key:"panBy",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;this.panTo([t,e])}},{key:"fitBounds",value:function(t,e){this.map.fitBounds(t,e)}},{key:"setMaxZoom",value:function(t){this.map.setMaxZoom(t)}},{key:"setMinZoom",value:function(t){this.map.setMinZoom(t)}},{key:"setMapStatus",value:function(t){t.doubleClickZoom===!0&&this.map.doubleClickZoom.enable(),t.doubleClickZoom===!1&&this.map.doubleClickZoom.disable(),t.dragEnable===!1&&this.map.dragPan.disable(),t.dragEnable===!0&&this.map.dragPan.enable(),t.rotateEnable===!1&&this.map.dragRotate.disable(),t.dragEnable===!0&&this.map.dragRotate.enable(),t.keyboardEnable===!1&&this.map.keyboard.disable(),t.keyboardEnable===!0&&this.map.keyboard.enable(),t.zoomEnable===!1&&this.map.scrollZoom.disable(),t.zoomEnable===!0&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(t,e){this.map.flyTo({zoom:t,center:e})}},{key:"setMapStyle",value:function(t){this.map.setStyle(this.getMapStyle(t))}},{key:"meterToCoord",value:function(t,e){return 1}},{key:"pixelToLngLat",value:function(t){return this.map.unproject(t)}},{key:"lngLatToPixel",value:function(t){return this.map.project(t)}},{key:"containerToLngLat",value:function(t){return this.map.unproject(t)}},{key:"lngLatToContainer",value:function(t){return this.map.project(t)}},{key:"destroy",value:function(){this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(t){for(var e,i=arguments.length,a=new Array(i>1?i-1:0),o=1;o<i;o++)a[o-1]=arguments[o];(e=this.eventEmitter).emit.apply(e,[t].concat(a))}},{key:"once",value:function(t){for(var e,i=arguments.length,a=new Array(i>1?i-1:0),o=1;o<i;o++)a[o-1]=arguments[o];(e=this.eventEmitter).once.apply(e,[t].concat(a))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"exportMap",value:function(t){var e=this.map.getCanvas(),i=t==="jpg"?e==null?void 0:e.toDataURL("image/jpeg"):e==null?void 0:e.toDataURL("image/png");return i}},{key:"onCameraChanged",value:function(t){this.cameraChangedCallback=t}},{key:"creatMapContainer",value:function(t){var e=t;return typeof t=="string"&&(e=document.getElementById(t)),e}},{key:"updateView",value:function(t){this.emit("mapchange"),this.viewport.syncWithMapCamera({bearing:t.bearing,center:t.center,viewportHeight:t.viewportHeight,pitch:t.pitch,viewportWidth:t.viewportWidth,zoom:t.zoom,cameraHeight:0}),this.updateCoordinateSystemService(),this.cameraChangedCallback(this.viewport)}},{key:"updateCoordinateSystemService",value:function(){var t=this.config.offsetCoordinate,e=t===void 0?!0:t;this.viewport.getZoom()>Wj&&e?this.coordinateSystemService.setCoordinateSystem(Fr.LNGLAT_OFFSET):this.coordinateSystemService.setCoordinateSystem(Fr.LNGLAT)}},{key:"getMapStyle",value:function(t){return typeof t!="string"?t:W_[t]?W_[t]:t}}]),r}(),Q_=Ct(Ma.prototype,"config",[X_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),J_=Ct(Ma.prototype,"configService",[Y_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),t1=Ct(Ma.prototype,"coordinateSystemService",[Z_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),e1=Ct(Ma.prototype,"eventEmitter",[q_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ma))||K_),Xj=function(){function r(){$(this,r)}return H(r,[{key:"syncWithMapCamera",value:function(t){var e=t.center,i=t.zoom,a=t.pitch,o=t.bearing,s=t.viewportHeight,u=t.viewportWidth;this.viewport=new KC({width:u,height:s,longitude:e&&e[0],latitude:e&&e[1],zoom:i,pitch:a,bearing:o})}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(t,e){return this.viewport.projectFlat(t,e)}}]),r}(),Yj=["id","attributionControl","style","token","rotation","mapInstance"],n1,i1;function Zj(r){var n=qj();return function(){var e=B(r),i;if(n){var a=B(this).constructor;i=Reflect.construct(e,arguments,a)}else i=e.apply(this,arguments);return et(this,i)}}function qj(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Kj(r,n){var t=typeof my<"u"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,e=typeof wx<"u"&&wx!==null&&(typeof wx.request<"u"||typeof wx.miniProgram<"u");if(!(t||e)&&(n||(n=document),!!n)){var i=n.head||n.getElementsByTagName("head")[0];if(!i){i=n.createElement("head");var a=n.body||n.getElementsByTagName("body")[0];a?a.parentNode.insertBefore(i,a):n.documentElement.appendChild(i)}var o=n.createElement("style");return o.type="text/css",o.styleSheet?o.styleSheet.cssText=r:o.appendChild(n.createTextNode(r)),i.appendChild(o),o}}Kj(`.mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mapboxgl-canvas{position:absolute;left:0;top:0}.mapboxgl-map:-webkit-full-screen{width:100%;height:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:-webkit-grab;cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:-webkit-grabbing;cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{-ms-touch-action:pan-x pan-y;touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:pinch-zoom;touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:none;touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{position:absolute;pointer-events:none;z-index:2}.mapboxgl-ctrl-top-left{top:0;left:0}.mapboxgl-ctrl-top-right{top:0;right:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{right:0;bottom:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;-webkit-transform:translate(0);transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{margin:10px 0 0 10px;float:left}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{margin:10px 10px 0 0;float:right}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{margin:0 0 10px 10px;float:left}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{margin:0 10px 10px 0;float:right}.mapboxgl-ctrl-group{border-radius:4px;background:#fff}.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 2px rgba(0,0,0,.1);box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 0 2px ButtonText;box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{width:29px;height:29px;display:block;padding:0;outline:none;border:0;-webkit-box-sizing:border-box;box-sizing:border-box;background-color:transparent;cursor:pointer}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl button::-moz-focus-inner{border:0;padding:0}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-group button:focus:focus-visible{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){-webkit-box-shadow:none;box-shadow:none}.mapboxgl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:focus:only-child{border-radius:inherit}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{-webkit-animation:mapboxgl-spin 2s linear infinite;animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}}@-webkit-keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{width:88px;height:23px;margin:0 0 -4px -4px;display:block;background-repeat:no-repeat;cursor:pointer;overflow:hidden;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg opacity='.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg opacity='.9' fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/svg%3E")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{padding:0 5px;background-color:hsla(0,0%,100%,.5);margin:0}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{min-height:20px;padding:2px 24px 2px 0;margin:10px;position:relative;background-color:#fff;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 8px 2px 28px;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{display:none;cursor:pointer;position:absolute;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E");background-color:hsla(0,0%,100%,.5);width:24px;height:24px;-webkit-box-sizing:border-box;box-sizing:border-box;border-radius:12px;outline:none;top:0;right:0;border:0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner,.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;right:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;left:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}.mapboxgl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:hsla(0,0%,100%,.75);font-size:10px;border:2px solid #333;border-top:#333;padding:0 5px;color:#333;-webkit-box-sizing:border-box;box-sizing:border-box}.mapboxgl-popup{position:absolute;top:0;left:0;display:-webkit-box;display:-ms-flexbox;display:flex;will-change:transform;pointer-events:none}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{-webkit-box-orient:vertical;-webkit-box-direction:reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.mapboxgl-popup-anchor-left{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row}.mapboxgl-popup-anchor-right{-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.mapboxgl-popup-tip{width:0;height:0;border:10px solid transparent;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-top:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-top:none;border-left:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-top:none;border-right:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-right:none;border-left-color:#fff}.mapboxgl-popup-close-button{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent}.mapboxgl-popup-close-button:hover{background-color:rgba(0,0,0,.05)}.mapboxgl-popup-content{position:relative;background:#fff;border-radius:3px;-webkit-box-shadow:0 1px 2px rgba(0,0,0,.1);box-shadow:0 1px 2px rgba(0,0,0,.1);padding:10px 10px 15px;pointer-events:auto}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:-webkit-box;display:-ms-flexbox;display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{position:absolute;top:0;left:0;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;width:15px;height:15px;border-radius:50%}.mapboxgl-user-location-dot:before{content:"";position:absolute;-webkit-animation:mapboxgl-user-location-dot-pulse 2s infinite;animation:mapboxgl-user-location-dot-pulse 2s infinite}.mapboxgl-user-location-dot:after{border-radius:50%;border:2px solid #fff;content:"";height:19px;left:-2px;position:absolute;top:-2px;width:19px;-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-box-shadow:0 0 3px rgba(0,0,0,.35);box-shadow:0 0 3px rgba(0,0,0,.35)}@-webkit-keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);opacity:0}to{-webkit-transform:scale(1);opacity:0}}@keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);transform:scale(3);opacity:0}to{-webkit-transform:scale(1);transform:scale(1);opacity:0}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:rgba(29,161,242,.2);width:1px;height:1px;border-radius:100%}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{position:absolute;top:0;left:0;width:0;height:0;background:#fff;border:2px dotted #202020;opacity:.5}@media print{.mapbox-improve-map{display:none}}`);window.mapboxgl=Uo;var Qj=0,a1="pk.eyJ1IjoiMTg5Njk5NDg2MTkiLCJhIjoiY2s5OXVzdHlzMDVneDNscDVjdzVmeXl0dyJ9.81SQ5qaJS0xExYLbDZAGpQ",Jj=(n1=xt(),n1(i1=function(r){tt(t,r);var n=Zj(t);function t(){var e;$(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return e=n.call.apply(n,[this].concat(a)),S(I(e),"version",ae.MAPBOX),e}return H(t,[{key:"getType",value:function(){return"mapbox"}},{key:"lngLatToCoord",value:function(i){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{x:0,y:0,z:0},o=this.lngLatToMercator(i,0),s=o.x,u=o.y;return[s-a.x,u-a.y]}},{key:"lngLatToMercator",value:function(i,a){var o=window.mapboxgl.MercatorCoordinate.fromLngLat(i,a),s=o.x,u=s===void 0?0:s,l=o.y,c=l===void 0?0:l,f=o.z,h=f===void 0?0:f;return{x:u,y:c,z:h}}},{key:"getModelMatrix",value:function(i,a,o){var s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],u=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{x:0,y:0,z:0},l=window.mapboxgl.MercatorCoordinate.fromLngLat(i,a),c=l.meterInMercatorCoordinateUnits(),f=fr();return Ll(f,f,_e(l.x-u.x,l.y-u.y,l.z||0-u.z)),mv(f,f,_e(c*s[0],-c*s[1],c*s[2])),Fl(f,f,o[0]),kl(f,f,o[1]),xv(f,f,o[2]),f}},{key:"init",value:function(){var e=Mt(st.mark(function a(){var o,s,u,l,c,f,h,v,p,d,g,y,m;return st.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:o=this.config,s=o.id,u=s===void 0?"map":s,l=o.attributionControl,c=l===void 0?!1:l,f=o.style,h=f===void 0?"light":f,v=o.token,p=v===void 0?a1:v,d=o.rotation,g=d===void 0?0:d,y=o.mapInstance,m=un(o,Yj),this.viewport=new Xj,!y&&!window.mapboxgl&&console.error(this.configService.getSceneWarninfo("SDK")),p===a1&&h!=="blank"&&!window.mapboxgl.accessToken&&!y&&console.warn(this.configService.getSceneWarninfo("MapToken")),!y&&!window.mapboxgl.accessToken&&(window.mapboxgl.accessToken=p),y?(this.map=y,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatMapContainer(u),this.map=new window.mapboxgl.Map(U({container:this.$mapContainer,style:this.getMapStyle(h),attributionControl:c,bearing:g},m))),this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged();case 9:case"end":return _.stop()}},a,this)}));function i(){return e.apply(this,arguments)}return i}()},{key:"destroy",value:function(){var i,a;(i=this.$mapContainer)===null||i===void 0||(a=i.parentNode)===null||a===void 0||a.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(i){for(var a,o=arguments.length,s=new Array(o>1?o-1:0),u=1;u<o;u++)s[u-1]=arguments[u];(a=this.eventEmitter).emit.apply(a,[i].concat(s))}},{key:"once",value:function(i){for(var a,o=arguments.length,s=new Array(o>1?o-1:0),u=1;u<o;u++)s[u-1]=arguments[u];(a=this.eventEmitter).once.apply(a,[i].concat(s))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"meterToCoord",value:function(i,a){var o=new Uo.LngLat(i[0],i[1]),s=new Uo.LngLat(a[0],a[1]),u=o.distanceTo(s),l=Uo.MercatorCoordinate.fromLngLat({lng:i[0],lat:i[1]}),c=Uo.MercatorCoordinate.fromLngLat({lng:a[0],lat:a[1]}),f=l.x,h=l.y,v=c.x,p=c.y,d=Math.sqrt(Math.pow(f-v,2)+Math.pow(h-p,2))*4194304*2;return d/u}},{key:"exportMap",value:function(i){var a=this.map.getCanvas(),o=i==="jpg"?a==null?void 0:a.toDataURL("image/jpeg"):a==null?void 0:a.toDataURL("image/png");return o}},{key:"creatMapContainer",value:function(i){var a=i;typeof i=="string"&&(a=document.getElementById(i));var o=document.createElement("div");return o.style.cssText+=`
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    `,o.id="l7_mapbox_div"+Qj++,a.appendChild(o),o}}]),t}(jj))||i1);function tX(r){var n=eX();return function(){var e=B(r),i;if(n){var a=B(this).constructor;i=Reflect.construct(e,arguments,a)}else i=e.apply(this,arguments);return et(this,i)}}function eX(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function rX(r,n){var t=typeof my<"u"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,e=typeof wx<"u"&&wx!==null&&(typeof wx.request<"u"||typeof wx.miniProgram<"u");if(!(t||e)&&(n||(n=document),!!n)){var i=n.head||n.getElementsByTagName("head")[0];if(!i){i=n.createElement("head");var a=n.body||n.getElementsByTagName("body")[0];a?a.parentNode.insertBefore(i,a):n.documentElement.appendChild(i)}var o=n.createElement("style");return o.type="text/css",o.styleSheet?o.styleSheet.cssText=r:o.appendChild(n.createTextNode(r)),i.appendChild(o),o}}rX(`.mapboxgl-ctrl-logo {
 display: none !important;
}
`);var nX=function(r){tt(t,r);var n=tX(t);function t(){return $(this,t),n.apply(this,arguments)}return H(t,[{key:"getServiceConstructor",value:function(){return Jj}}]),t}(pT);function iX(r,n){var t=[n[0]-r[0],n[1]-r[1]],e=Y2(t),i=[r[0]+e[0]*1e-4,r[1]+e[1]*1e-4];return i}function aX(r,n){var t=this;r.length>0&&n.version===ae["GAODE2.x"]&&(typeof r[0].coordinates[0]=="number"?r.filter(function(e){return!e.originCoordinates}).map(function(e){e.version=ae["GAODE2.x"],e.originCoordinates=cloneDeep(e.coordinates),e.coordinates=t.mapService.lngLatToCoord(e.coordinates)}):r.filter(function(e){return!e.originCoordinates}).map(function(e){e.version=ae["GAODE2.x"],e.originCoordinates=cloneDeep(e.coordinates),e.coordinates=t.mapService.lngLatToCoords(e.coordinates)}))}function oX(r,n){r.length>0&&n.version===ae.SIMPLE&&r.map(function(t){t.simpleCoordinate||(t.coordinates=sX(t.coordinates,n),t.simpleCoordinate=!0)})}function sX(r,n){if(typeof r[0]=="number")return n.simpleMapCoord.unproject(r);if(r[0]&&r[0][0]instanceof Array){var t=[];return r.map(function(i){var a=[];i.map(function(o){a.push(n.simpleMapCoord.unproject(o))}),t.push(a)}),t}else{var e=[];return r.map(function(i){e.push(n.simpleMapCoord.unproject(i))}),e}}function uX(r,n,t){var e;if(!r.scale)return[];var i=(r==null||(e=r.scale)===null||e===void 0?void 0:e.scalers)||[],a=[];i.forEach(function(s){var u,l=s.field;(n.hasOwnProperty(l)||((u=r.scale)===null||u===void 0?void 0:u.type)==="variable")&&a.push(n[l])});var o=r.mapping?r.mapping(a):[];return r.name==="color"&&!Z2(o[0])?[t]:o}function lX(r,n,t,e,i,a){var o=a==null?void 0:a.getLayerConfig(),s=o.arrow,u=s===void 0?{enable:!1}:s,l=n.map(function(c){var f={id:c._id,coordinates:c.coordinates};if(r.filter(function(p){return p.scale!==void 0}).forEach(function(p){var d=uX(p,c,i);p.needRemapping=!1,p.name==="color"&&(d=d.map(function(g){return Ut(g)})),f[p.name]=Array.isArray(d)&&d.length===1?d[0]:d,p.name==="shape"&&(f.shape=t.getIconFontKey(f[p.name]))}),f.shape==="line"&&u.enable){var h=f.coordinates,v=iX(h[0],h[1]);f.coordinates.splice(1,0,v,v)}return f});return aX(l,e),oX(l,e),l}function cX(r,n,t,e,i,a){var o=new ya(i,a),s=r.getBottomColor(),u=e.getLayerStyleAttributes()||[],l=o.data.dataArray,c=l,f=lX(u,c,n,t,s,r);return o.destroy(),f}function gT(r){return r.map(function(n){return typeof n=="string"&&(n=[n,{}]),n})}function yT(r,n,t,e){var i=r.multiPassRenderer,a=r.getLayerConfig();a.enablePicking;var o=a.enableTAA;return o?i.add(e("taa")):i.add(e("render")),gT(n).forEach(function(s){var u=kt(s,2),l=u[0],c=u[1];i.add(t(l),c)}),i.add(t("copy")),i}var fX=[["circle","cylinder"],["square","cylinder"],["triangle","cylinder"],["pentagon","cylinder"],["hexagon","cylinder"],["octogon","cylinder"],["hexagram","cylinder"],["rhombus","cylinder"],["vesica","cylinder"]];function hX(r,n,t){if(typeof n=="string"&&typeof t=="string"&&n!==t){if(r.type==="PointLayer"){r.dataState.dataSourceNeedUpdate=!0;return}fX.map(function(e){if(e.includes(n)&&e.includes(t)){r.dataState.dataSourceNeedUpdate=!0;return}})}}var vX=["passes"],pX=["moduleName","vertexShader","fragmentShader","triangulation","segmentNumber","workerEnabled","workerOptions"],o1,Nf,s1;function dX(r,n){var t=typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(!t){if(Array.isArray(r)||(t=gX(r))||n&&r&&typeof r.length=="number"){t&&(r=t);var e=0,i=function(){};return{s:i,n:function(){return e>=r.length?{done:!0}:{done:!1,value:r[e++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){t=t.call(r)},n:function(){var l=t.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(o)throw s}}}}function gX(r,n){if(!!r){if(typeof r=="string")return u1(r,n);var t=Object.prototype.toString.call(r).slice(8,-1);if(t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set")return Array.from(r);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return u1(r,n)}}function u1(r,n){(n==null||n>r.length)&&(n=r.length);for(var t=0,e=new Array(n);t<n;t++)e[t]=r[t];return e}function yX(r){var n=mX();return function(){var e=B(r),i;if(n){var a=B(this).constructor;i=Reflect.construct(e,arguments,a)}else i=e.apply(this,arguments);return et(this,i)}}function mX(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var l1=0,mo=(o1=ud(P.IGlobalConfigService),Nf=function(r){tt(t,r);var n=yX(t);function t(){var e,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return $(this,t),e=n.call(this),S(I(e),"id","".concat(l1++)),S(I(e),"name","".concat(l1)),S(I(e),"visible",!0),S(I(e),"zIndex",0),S(I(e),"inited",!1),S(I(e),"layerModelNeedUpdate",!1),S(I(e),"pickedFeatureID",null),S(I(e),"selectedFeatureID",null),S(I(e),"styleNeedUpdate",!1),S(I(e),"forceRender",!1),S(I(e),"clusterZoom",0),S(I(e),"defaultSourceConfig",{data:[],options:{parser:{type:"json"}}}),S(I(e),"dataState",{dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1}),S(I(e),"hooks",{init:new Ff,afterInit:new Ff,beforeRender:new Ff,beforeRenderData:new MG,afterRender:new nn,beforePickingEncode:new nn,afterPickingEncode:new nn,beforeHighlight:new nn(["pickedColor"]),afterHighlight:new nn,beforeSelect:new nn(["pickedColor"]),afterSelect:new nn,beforeDestroy:new nn,afterDestroy:new nn}),S(I(e),"models",[]),S(I(e),"modelLoaded",!1),S(I(e),"layerChildren",[]),S(I(e),"masks",[]),S(I(e),"isVector",!1),St(I(e),"configService",s1,I(e)),S(I(e),"animateOptions",{enable:!1}),S(I(e),"currentPickId",null),S(I(e),"pendingStyleAttributes",[]),S(I(e),"scaleOptions",{}),S(I(e),"animateStatus",!1),S(I(e),"bottomColor","rgba(0, 0, 0, 0)"),S(I(e),"isDestroyed",!1),S(I(e),"encodeDataLength",0),S(I(e),"sourceEvent",function(){e.dataState.dataSourceNeedUpdate=!0;var a=e.getLayerConfig();a&&a.autoFit&&e.fitBounds(a.fitBoundsOptions),e.reRender()}),e.name=i.name||e.id,e.zIndex=i.zIndex||0,e.rawConfig=i,e}return H(t,[{key:"addMaskLayer",value:function(i){this.masks.push(i)}},{key:"removeMaskLayer",value:function(i){var a=this.masks.indexOf(i);a>-1&&this.masks.splice(a,1),i.destroy()}},{key:"getAttribute",value:function(i){return this.styleAttributeService.getLayerStyleAttribute(i)}},{key:"getLayerConfig",value:function(){return this.configService.getLayerConfig(this.id)}},{key:"updateLayerConfig",value:function(i){var a=this;if(Object.keys(i).map(function(s){s in a.rawConfig&&(a.rawConfig[s]=i[s])}),!this.inited)this.needUpdateConfig=U(U({},this.needUpdateConfig),i);else{var o=this.container.get(P.SceneID);Aj(i,this),this.configService.setLayerConfig(o,this.id,U(U(U({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),i)),this.needUpdateConfig={}}}},{key:"setContainer",value:function(i,a){this.container=i,this.sceneContainer=a}},{key:"getContainer",value:function(){return this.container}},{key:"setBottomColor",value:function(i){this.bottomColor=i}},{key:"getBottomColor",value:function(){return this.bottomColor}},{key:"addPlugin",value:function(i){return this.plugins.push(i),this}},{key:"init",value:function(){var i=this,a=this.container.get(P.SceneID);this.configService.setLayerConfig(a,this.id,this.rawConfig),this.layerType=this.rawConfig.layerType,this.iconService=this.container.get(P.IIconService),this.fontService=this.container.get(P.IFontService),this.rendererService=this.container.get(P.IRendererService),this.layerService=this.container.get(P.ILayerService),this.interactionService=this.container.get(P.IInteractionService),this.pickingService=this.container.get(P.IPickingService),this.mapService=this.container.get(P.IMapService);var o=this.getLayerConfig(),s=o.enableMultiPassRenderer,u=o.passes;s&&u!==null&&u!==void 0&&u.length&&u.length>0&&this.mapService.on("mapAfterFrameChange",function(){i.renderLayers()}),this.cameraService=this.container.get(P.ICameraService),this.coordinateService=this.container.get(P.ICoordinateSystemService),this.shaderModuleService=this.container.get(P.IShaderModuleService),this.postProcessingPassFactory=this.container.get(P.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(P.IFactoryNormalPass),this.styleAttributeService=this.container.get(P.IStyleAttributeService),this.multiPassRenderer=this.container.get(P.IMultiPassRenderer),this.multiPassRenderer.setLayer(this),this.pendingStyleAttributes.forEach(function(h){var v=h.attributeName,p=h.attributeField,d=h.attributeValues,g=h.updateOptions;i.styleAttributeService.updateStyleAttribute(v,{scale:U({field:p},i.splitValuesAndCallbackInAttribute(d,i.getLayerConfig()[v]))},g)}),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(P.ILayerPlugin);var l=dX(this.plugins),c;try{for(l.s();!(c=l.n()).done;){var f=c.value;f.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}}catch(h){l.e(h)}finally{l.f()}return this.hooks.init.call(),this.hooks.afterInit.call(),this.emit("inited",{target:this,type:"inited"}),this.emit("add",{target:this,type:"add"}),this}},{key:"updateModelData",value:function(i){i.attributes&&i.elements?this.models.map(function(a){a.updateAttributesAndElements(i.attributes,i.elements)}):console.warn("data error")}},{key:"createModelData",value:function(i,a){var o;if((o=this.layerModel)!==null&&o!==void 0&&o.createModelData)return this.layerModel.createModelData(a);var s=this.calculateEncodeData(i,a),u=this.triangulation;return s&&u?this.styleAttributeService.createAttributesAndIndices(s,u):{attributes:void 0,elements:void 0}}},{key:"calculateEncodeData",value:function(i,a){return this.inited?cX(this,this.fontService,this.mapService,this.styleAttributeService,i,a):(console.warn("layer not inited!"),null)}},{key:"prepareBuildModel",value:function(){this.inited=!0,this.updateLayerConfig(U(U({},this.getDefaultConfig()),this.rawConfig));var i=this.getLayerConfig(),a=i.animateOption;a!=null&&a.enable&&(this.layerService.startAnimate(),this.animateStatus=!0)}},{key:"color",value:function(i,a,o){return this.updateStyleAttribute("color",i,a,o),this}},{key:"texture",value:function(i,a,o){return this.updateStyleAttribute("texture",i,a,o),this}},{key:"rotate",value:function(i,a,o){return this.updateStyleAttribute("rotate",i,a,o),this}},{key:"size",value:function(i,a,o){return this.updateStyleAttribute("size",i,a,o),this}},{key:"filter",value:function(i,a,o){return this.updateStyleAttribute("filter",i,a,o),this}},{key:"shape",value:function(i,a,o){var s,u,l,c=(s=this.styleAttributeService)===null||s===void 0||(u=s.getLayerStyleAttribute("shape"))===null||u===void 0||(l=u.scale)===null||l===void 0?void 0:l.field,f=i;return this.shapeOption={field:i,values:a},this.updateStyleAttribute("shape",i,a,o),this.tileLayer||hX(this,c,f),this}},{key:"label",value:function(i,a,o){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:i,attributeValues:a,updateOptions:o}),this}},{key:"animate",value:function(i){var a={};return Y.exports.isObject(i)?(a.enable=!0,a=U(U({},a),i)):a.enable=i,this.updateLayerConfig({animateOption:a}),this}},{key:"source",value:function(i,a){return i!=null&&i.data?(this.setSource(i),this):(this.sourceOption={data:i,options:a},this.clusterZoom=0,this)}},{key:"setData",value:function(i,a){var o=this;return this.inited?this.layerSource.setData(i,a):this.on("inited",function(){var s=o.getSource();s?o.layerSource.setData(i,a):(o.source(new ya(i,a)),o.sourceEvent())}),this}},{key:"style",value:function(i){var a=this,o=this.getLayerConfig(),s=i.passes,u=un(i,vX);return s&&gT(s).forEach(function(l){var c=a.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(l[0]);c&&c.updateOptions(l[1])}),this.rawConfig=U(U({},this.rawConfig),u),this.container&&(this.updateLayerConfig(this.rawConfig),this.styleNeedUpdate=!0),o&&o.mask===!0&&i.mask===!1&&(this.clearModels(),this.layerModel.buildModels(function(l){a.models=l})),this}},{key:"scale",value:function(i,a){return Y.exports.isObject(i)?this.scaleOptions=U(U({},this.scaleOptions),i):this.scaleOptions[i]=a,this}},{key:"renderLayers",value:function(){this.rendering=!0,this.layerService.renderLayers(),this.rendering=!1}},{key:"render",value:function(){return this.tileLayer?(this.tileLayer.render(),this):this.encodeDataLength<=0&&!this.forceRender?this:(this.renderModels(),this)}},{key:"renderMultiPass",value:function(){var e=Mt(st.mark(function a(){return st.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(!(this.encodeDataLength<=0&&!this.forceRender)){s.next=2;break}return s.abrupt("return");case 2:if(!(this.multiPassRenderer&&this.multiPassRenderer.getRenderFlag())){s.next=7;break}return s.next=5,this.multiPassRenderer.render();case 5:s.next=8;break;case 7:this.multiPassRenderer?this.renderModels():this.renderModels();case 8:case"end":return s.stop()}},a,this)}));function i(){return e.apply(this,arguments)}return i}()},{key:"active",value:function(i){var a={};return a.enableHighlight=Y.exports.isObject(i)?!0:i,Y.exports.isObject(i)?(a.enableHighlight=!0,i.color&&(a.highlightColor=i.color),i.mix&&(a.activeMix=i.mix)):a.enableHighlight=!!i,this.updateLayerConfig(a),this}},{key:"setActive",value:function(i,a){var o=this;if(Y.exports.isObject(i)){var s=i.x,u=s===void 0?0:s,l=i.y,c=l===void 0?0:l;this.updateLayerConfig({highlightColor:Y.exports.isObject(a)?a.color:this.getLayerConfig().highlightColor,activeMix:Y.exports.isObject(a)?a.mix:this.getLayerConfig().activeMix}),this.pick({x:u,y:c})}else this.updateLayerConfig({pickedFeatureID:i,highlightColor:Y.exports.isObject(a)?a.color:this.getLayerConfig().highlightColor,activeMix:Y.exports.isObject(a)?a.mix:this.getLayerConfig().activeMix}),this.hooks.beforeSelect.call(di(i)).then(function(){setTimeout(function(){o.reRender()},1)})}},{key:"select",value:function(i){var a={};return a.enableSelect=Y.exports.isObject(i)?!0:i,Y.exports.isObject(i)?(a.enableSelect=!0,i.color&&(a.selectColor=i.color),i.mix&&(a.selectMix=i.mix)):a.enableSelect=!!i,this.updateLayerConfig(a),this}},{key:"setSelect",value:function(i,a){var o=this;if(Y.exports.isObject(i)){var s=i.x,u=s===void 0?0:s,l=i.y,c=l===void 0?0:l;this.updateLayerConfig({selectColor:Y.exports.isObject(a)?a.color:this.getLayerConfig().selectColor,selectMix:Y.exports.isObject(a)?a.mix:this.getLayerConfig().selectMix}),this.pick({x:u,y:c})}else this.updateLayerConfig({pickedFeatureID:i,selectColor:Y.exports.isObject(a)?a.color:this.getLayerConfig().selectColor,selectMix:Y.exports.isObject(a)?a.mix:this.getLayerConfig().selectMix}),this.hooks.beforeSelect.call(di(i)).then(function(){setTimeout(function(){o.reRender()},1)})}},{key:"setBlend",value:function(i){return this.updateLayerConfig({blend:i}),this.layerModelNeedUpdate=!0,this.reRender(),this}},{key:"show",value:function(){return this.updateLayerConfig({visible:!0}),this.reRender(),this}},{key:"hide",value:function(){return this.updateLayerConfig({visible:!1}),this.reRender(),this}},{key:"setIndex",value:function(i){return this.zIndex=i,this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this}},{key:"setCurrentPickId",value:function(i){this.currentPickId=i}},{key:"getCurrentPickId",value:function(){return this.currentPickId}},{key:"setCurrentSelectedId",value:function(i){this.selectedFeatureID=i}},{key:"getCurrentSelectedId",value:function(){return this.selectedFeatureID}},{key:"isVisible",value:function(){var i=this.mapService.getZoom(),a=this.getLayerConfig(),o=a.visible,s=a.minZoom,u=s===void 0?-1/0:s,l=a.maxZoom,c=l===void 0?1/0:l;return!!o&&i>=u&&i<=c}},{key:"setMultiPass",value:function(i,a){if(this.updateLayerConfig({enableMultiPassRenderer:i}),a&&this.updateLayerConfig({passes:a}),i){var o=this.getLayerConfig(),s=o.passes,u=s===void 0?[]:s;this.multiPassRenderer=yT(this,u,this.postProcessingPassFactory,this.normalPassFactory),this.multiPassRenderer.setRenderFlag(!0);var l=this.rendererService.getViewportSize(),c=l.width,f=l.height;this.multiPassRenderer.resize(c,f)}return this}},{key:"setMinZoom",value:function(i){return this.updateLayerConfig({minZoom:i}),this}},{key:"getMinZoom",value:function(){var i=this.getLayerConfig(),a=i.minZoom;return a}},{key:"getMaxZoom",value:function(){var i=this.getLayerConfig(),a=i.maxZoom;return a}},{key:"get",value:function(i){var a=this.getLayerConfig();return a[i]}},{key:"setMaxZoom",value:function(i){return this.updateLayerConfig({maxZoom:i}),this}},{key:"setAutoFit",value:function(i){return this.updateLayerConfig({autoFit:i}),this}},{key:"fitBounds",value:function(i){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;var a=this.getSource(),o=a.extent,s=o.some(function(u){return Math.abs(u)===1/0});return s?this:(this.mapService.fitBounds([[o[0],o[1]],[o[2],o[3]]],i),this)}},{key:"destroy",value:function(){var i,a,o,s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.isDestroyed||(this.layerChildren.map(function(u){return u.destroy(!1)}),this.layerChildren=[],this.masks.map(function(u){return u.destroy(!1)}),this.masks=[],this.hooks.beforeDestroy.call(),this.layerSource.off("sourceUpdate",this.sourceEvent),(i=this.multiPassRenderer)===null||i===void 0||i.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),(a=this.layerModel)===null||a===void 0||a.clearModels(s),(o=this.tileLayer)===null||o===void 0||o.destroy(),this.models=[],this.layerService.cleanRemove(this,s),this.emit("remove",{target:this,type:"remove"}),this.emit("destroy",{target:this,type:"destroy"}),this.removeAllListeners(),this.isDestroyed=!0)}},{key:"clear",value:function(){this.styleAttributeService.clearAllAttributes()}},{key:"clearModels",value:function(){var i;this.models.forEach(function(a){return a.destroy()}),(i=this.layerModel)===null||i===void 0||i.clearModels(),this.models=[]}},{key:"isDirty",value:function(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter(function(i){return i.needRescale||i.needRemapping||i.needRegenerateVertices}).length}},{key:"setSource",value:function(i){var a=this;if(this.layerSource&&this.layerSource.off("sourceUpdate",this.sourceEvent),this.layerSource=i,this.clusterZoom=0,this.inited&&this.layerSource.cluster){var o=this.mapService.getZoom();this.layerSource.updateClusterData(o)}this.layerSource.inited&&this.sourceEvent(),this.layerSource.on("sourceUpdate",function(){a.sourceEvent()})}},{key:"getSource",value:function(){return this.layerSource}},{key:"getScaleOptions",value:function(){return this.scaleOptions}},{key:"setEncodedData",value:function(i){this.encodedData=i,this.encodeDataLength=i.length}},{key:"getEncodedData",value:function(){return this.encodedData}},{key:"getScale",value:function(i){return this.styleAttributeService.getLayerAttributeScale(i)}},{key:"getLegendItems",value:function(i){var a=this.styleAttributeService.getLayerAttributeScale(i);if(!a)return[];if(a.invertExtent){var o=a.range().map(function(l){return S({value:a.invertExtent(l)},i,l)});return o}else if(a.ticks){var s=a.ticks().map(function(l){return S({value:l},i,a(l))});return s}else if(a!=null&&a.domain){var u=a.domain().filter(function(l){return!Y.exports.isUndefined(l)}).map(function(l){return S({value:l},i,a(l))});return u}return[]}},{key:"pick",value:function(i){var a=i.x,o=i.y;this.interactionService.triggerHover({x:a,y:o})}},{key:"boxSelect",value:function(i,a){this.pickingService.boxPickLayer(this,i,a)}},{key:"buildLayerModel",value:function(i){var a=this,o=i.moduleName,s=i.vertexShader,u=i.fragmentShader,l=i.triangulation,c=i.segmentNumber,f=i.workerEnabled,h=f===void 0?!1:f,v=i.workerOptions,p=un(i,pX);this.shaderModuleService.registerModule(o,{vs:s,fs:u});var d=this.shaderModuleService.getModule(o),g=d.vs,y=d.fs,m=d.uniforms,x=this.rendererService.createModel;return new Promise(function(_,E){setTimeout(function(){if(v&&v.modelType in q2&&h)a.styleAttributeService.createAttributesAndIndicesAscy(a.encodedData,c,v).then(function(D){var W=D.attributes,j=D.elements,ot=x(U({attributes:W,uniforms:m,fs:y,vs:g,elements:j,blend:lv[Wr.normal]},p));_(ot)}).catch(function(D){return E(D)});else{var b=a.styleAttributeService.createAttributesAndIndices(a.encodedData,l,c),M=b.attributes,T=b.elements,k=b.count,L=U({attributes:M,uniforms:m,fs:y,vs:g,elements:T,blend:lv[Wr.normal]},p);k&&(L.count=k);var O=x(L);_(O)}})})}},{key:"createAttributes",value:function(i){var a=i.triangulation,o=this.styleAttributeService.createAttributes(this.encodedData,a),s=o.attributes;return s}},{key:"getTime",value:function(){return this.layerService.clock.getDelta()}},{key:"setAnimateStartTime",value:function(){this.animateStartTime=this.layerService.clock.getElapsedTime()}},{key:"stopAnimate",value:function(){this.animateStatus&&(this.layerService.stopAnimate(),this.animateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}},{key:"getLayerAnimateTime",value:function(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}},{key:"needPick",value:function(i){if(this.rawConfig.usage==="basemap")return!1;var a=this.getLayerConfig(),o=a.enableHighlight,s=o===void 0?!0:o,u=a.enableSelect,l=u===void 0?!0:u,c=this.eventNames().indexOf(i)!==-1||this.eventNames().indexOf("un"+i)!==-1;return(i==="click"||i==="dblclick")&&l&&(c=!0),i==="mousemove"&&(s||this.eventNames().indexOf("mouseenter")!==-1||this.eventNames().indexOf("unmousemove")!==-1||this.eventNames().indexOf("mouseout")!==-1)&&(c=!0),this.isVisible()&&c}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"rebuildModels",value:function(){throw new Error("Method not implemented.")}},{key:"renderMulPass",value:function(){var e=Mt(st.mark(function a(o){return st.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,o.render();case 2:case"end":return u.stop()}},a)}));function i(a){return e.apply(this,arguments)}return i}()},{key:"renderModels",value:function(i){var a=this;return this.encodeDataLength<=0&&!this.forceRender?this:(this.layerModelNeedUpdate&&this.layerModel&&this.layerModel.buildModels(function(o){a.models=o,a.hooks.beforeRender.call(),a.layerModelNeedUpdate=!1}),this.models.forEach(function(o){o.draw({uniforms:a.layerModel.getUninforms()},i)}),this)}},{key:"updateStyleAttribute",value:function(i,a,o,s){this.inited?this.styleAttributeService.updateStyleAttribute(i,{scale:U({field:a},this.splitValuesAndCallbackInAttribute(o,this.getLayerConfig()[a]))},s):this.pendingStyleAttributes.push({attributeName:i,attributeField:a,attributeValues:o,updateOptions:s})}},{key:"getShaderPickStat",value:function(){return this.layerService.getShaderPickStat()}},{key:"setEarthTime",value:function(i){console.warn("empty fn")}},{key:"getConfigSchema",value:function(){throw new Error("Method not implemented.")}},{key:"getModelType",value:function(){throw new Error("Method not implemented.")}},{key:"getDefaultConfig",value:function(){return{}}},{key:"dispatchModelLoad",value:function(i){this.models.forEach(function(a){return a.destroy()}),this.models=[],this.models=i,this.emit("modelLoaded",null),this.modelLoaded=!0,this.layerService.throttleRenderLayers()}},{key:"reRender",value:function(){this.inited&&this.layerService.reRender()}},{key:"splitValuesAndCallbackInAttribute",value:function(i,a){return{values:Y.exports.isFunction(i)?void 0:i||a,callback:Y.exports.isFunction(i)?i:void 0}}}]),t}(dn.exports.EventEmitter),s1=Ct(Nf.prototype,"configService",[o1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nf),c1,zf,f1;function xX(r,n){var t=typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(!t){if(Array.isArray(r)||(t=_X(r))||n&&r&&typeof r.length=="number"){t&&(r=t);var e=0,i=function(){};return{s:i,n:function(){return e>=r.length?{done:!0}:{done:!1,value:r[e++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){t=t.call(r)},n:function(){var l=t.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(o)throw s}}}}function _X(r,n){if(!!r){if(typeof r=="string")return h1(r,n);var t=Object.prototype.toString.call(r).slice(8,-1);if(t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set")return Array.from(r);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return h1(r,n)}}function h1(r,n){(n==null||n>r.length)&&(n=r.length);for(var t=0,e=new Array(n);t<n;t++)e[t]=r[t];return e}var qt=(c1=ud(P.IGlobalConfigService),zf=function(){function r(n){$(this,r),St(this,"configService",f1,this),this.layer=n,this.rendererService=n.getContainer().get(P.IRendererService),this.pickingService=n.getContainer().get(P.IPickingService),this.shaderModuleService=n.getContainer().get(P.IShaderModuleService),this.styleAttributeService=n.getContainer().get(P.IStyleAttributeService),this.mapService=n.getContainer().get(P.IMapService),this.iconService=n.getContainer().get(P.IIconService),this.fontService=n.getContainer().get(P.IFontService),this.cameraService=n.getContainer().get(P.ICameraService),this.layerService=n.getContainer().get(P.ILayerService),this.registerBuiltinAttributes(),this.startModelAnimate();var t=this.rendererService.createTexture2D;this.createTexture2D=t,this.DATA_TEXTURE_WIDTH=1024,this.rowCount=1,this.cellLength=0,this.cellProperties=[],this.cacheStyleProperties={thetaOffset:void 0,opacity:void 0,strokeOpacity:void 0,strokeWidth:void 0,stroke:void 0,offsets:void 0},this.stylePropertiesExist={hasThetaOffset:0,hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0},this.dataTextureTest=this.layerService.getOESTextureFloat(),this.dataTextureTest||(this.dataTexture=this.createTexture2D({data:new Uint8Array(4),mag:A.NEAREST,min:A.NEAREST,width:1,height:1}))}return H(r,[{key:"clearLastCalRes",value:function(){this.cellProperties=[],this.cellLength=0,this.stylePropertiesExist={hasThetaOffset:0,hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0}}},{key:"getCellTypeLayout",value:function(){return this.dataTextureTest?[this.rowCount,this.DATA_TEXTURE_WIDTH,0,0,this.stylePropertiesExist.hasOpacity,this.stylePropertiesExist.hasStrokeOpacity,this.stylePropertiesExist.hasStrokeWidth,this.stylePropertiesExist.hasStroke,this.stylePropertiesExist.hasOffsets,this.stylePropertiesExist.hasThetaOffset,0,0,0,0,0,1]:[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,-1]}},{key:"dataTextureNeedUpdate",value:function(t){var e=!1;return Y.exports.isEqual(t.thetaOffset,this.cacheStyleProperties.thetaOffset)||(e=!0,this.cacheStyleProperties.thetaOffset=t.thetaOffset),Y.exports.isEqual(t.opacity,this.cacheStyleProperties.opacity)||(e=!0,this.cacheStyleProperties.opacity=t.opacity),Y.exports.isEqual(t.strokeOpacity,this.cacheStyleProperties.strokeOpacity)||(e=!0,this.cacheStyleProperties.strokeOpacity=t.strokeOpacity),Y.exports.isEqual(t.strokeWidth,this.cacheStyleProperties.strokeWidth)||(e=!0,this.cacheStyleProperties.strokeWidth=t.strokeWidth),Y.exports.isEqual(t.stroke,this.cacheStyleProperties.stroke)||(e=!0,this.cacheStyleProperties.stroke=t.stroke),Y.exports.isEqual(t.offsets,this.cacheStyleProperties.offsets)||(e=!0,this.cacheStyleProperties.offsets=t.offsets),this.dataTexture===void 0&&(e=!0),e}},{key:"judgeStyleAttributes",value:function(t){this.clearLastCalRes(),t.opacity!==void 0&&!Y.exports.isNumber(t.opacity)&&(this.cellProperties.push({attr:"opacity",count:1}),this.stylePropertiesExist.hasOpacity=1,this.cellLength+=1),t.strokeOpacity!==void 0&&!Y.exports.isNumber(t.strokeOpacity)&&(this.cellProperties.push({attr:"strokeOpacity",count:1}),this.stylePropertiesExist.hasStrokeOpacity=1,this.cellLength+=1),t.strokeWidth!==void 0&&!Y.exports.isNumber(t.strokeWidth)&&(this.cellProperties.push({attr:"strokeWidth",count:1}),this.stylePropertiesExist.hasStrokeWidth=1,this.cellLength+=1),t.stroke!==void 0&&!this.isStaticColor(t.stroke)&&(this.cellProperties.push({attr:"stroke",count:4}),this.stylePropertiesExist.hasStroke=1,this.cellLength+=4),t.offsets!==void 0&&!this.isOffsetStatic(t.offsets)&&(this.cellProperties.push({attr:"offsets",count:2}),this.stylePropertiesExist.hasOffsets=1,this.cellLength+=2),t.thetaOffset!==void 0&&!Y.exports.isNumber(t.thetaOffset)&&(this.cellProperties.push({attr:"thetaOffset",count:1}),this.stylePropertiesExist.hasThetaOffset=1,this.cellLength+=1)}},{key:"isStaticColor",value:function(t){return Y.exports.isString(t)?!!Sv(t):!1}},{key:"getStrokeColor",value:function(t){if(this.isStaticColor(t)){var e=Ut(t);return e[0]=e[0]?e[0]:0,e[1]=e[1]?e[1]:0,e[2]=e[2]?e[2]:0,e[3]=e[3]?e[3]:0,e}else return[0,0,0,0]}},{key:"isOffsetStatic",value:function(t){return!!(Array.isArray(t)&&t.length===2&&Y.exports.isNumber(t[0])&&Y.exports.isNumber(t[1]))}},{key:"patchMod",value:function(t,e){for(var i=0;i<e;i++)t.push(-1)}},{key:"patchData",value:function(t,e,i){var a=xX(i),o;try{for(a.s();!(o=a.n()).done;){var s=o.value,u=s.attr,l=s.count,c=e[u];c!==void 0?u==="stroke"?t.push.apply(t,it(Ut(c))):u==="offsets"?this.isOffsetStatic(c)?t.push(-c[0],c[1]):t.push(0,0):t.push(Y.exports.isNumber(c)?c:1):this.patchMod(t,l)}}catch(f){a.e(f)}finally{a.f()}}},{key:"calDataFrame",value:function(t,e,i){for(var a=e.length,o=Math.ceil(a*t/this.DATA_TEXTURE_WIDTH),s=o*this.DATA_TEXTURE_WIDTH,u=[],l=0;l<a;l++){var c=e[l];this.patchData(u,c,i)}for(var f=u.length;f<s;f++)u.push(-1);return{data:u,width:this.DATA_TEXTURE_WIDTH,height:o}}},{key:"getBlend",value:function(){var t=this.layer.getLayerConfig(),e=t.blend,i=e===void 0?"normal":e;return lv[Wr[i]]}},{key:"getDefaultStyle",value:function(){return{}}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"needUpdate",value:function(){return!1}},{key:"buildModels",value:function(t){throw new Error("Method not implemented.")}},{key:"initModels",value:function(t){throw new Error("Method not implemented.")}},{key:"clearModels",value:function(){}},{key:"getAttribute",value:function(){throw new Error("Method not implemented.")}},{key:"render",value:function(){throw new Error("Method not implemented.")}},{key:"registerBuiltinAttributes",value:function(){throw new Error("Method not implemented.")}},{key:"animateOption2Array",value:function(t){return[t.enable?0:1,t.duration||4,t.interval||.2,t.trailLength||.1]}},{key:"startModelAnimate",value:function(){var t=this.layer.getLayerConfig(),e=t.animateOption;e.enable&&this.layer.setAnimateStartTime()}}]),r}(),f1=Ct(zf.prototype,"configService",[c1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zf),v1;(function(r){r[r.solid=0]="solid",r[r.dash=1]="dash"})(v1||(v1={}));var io;(function(r){r.VERTICAL="vertical",r.HORIZONTAL="horizontal"})(io||(io={}));var cv;(function(r){r.NORMAL="normal",r.REPLACE="replace"})(cv||(cv={}));var p1;(function(r){r.ALWAYS="always",r.DRAGEND="dragend"})(p1||(p1={}));var cd=100;function d1(r){return r/180*Math.acos(-1)}function mT(r){var n=d1(r[0])+Math.PI/2,t=d1(r[1]),e=cd+Math.random()*.4,i=e*Math.cos(t)*Math.cos(n),a=e*Math.cos(t)*Math.sin(n),o=e*Math.sin(t);return[a,o,i]}var Pu=Ft();Ft();var ge=Ft(),Vn=Ft(),wa=Ft();function Uf(r,n,t,e,i){Zt(r,t,e),kr(r,r),n=Ya(-r[1],r[0]);var a=Ya(-t[1],t[0]);return[i/Mn(n,a),n]}function Wn(r,n){return jC(r,-n[1],n[0])}function La(r,n,t){return vr(r,n,t),kr(r,r),r}function Hf(r,n){return r[0]===n[0]&&r[1]===n[1]}var CX=function(){function r(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};$(this,r),S(this,"lastFlip",-1),S(this,"miter",Ya(0,0)),S(this,"started",!1),S(this,"dash",!1),S(this,"totalDistance",0),S(this,"currentIndex",0),this.join=n.join||"miter",this.cap=n.cap||"butt",this.miterLimit=n.miterLimit||10,this.thickness=n.thickness||1,this.dash=n.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return H(r,[{key:"simpleExtrude",value:function(t){var e=this.complex;if(t.length<=1)return e;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var i=t.length,a=e.startIndex,o=1;o<i;o++){var s=t[o-1],u=t[o],l=o<t.length-1?t[o+1]:null,c=this.simpleSegment(e,a,s,u,l);a+=c}if(this.dash)for(var f=0;f<e.positions.length/6;f++)e.positions[f*6+5]=this.totalDistance;return e.startIndex=e.positions.length/6,e}},{key:"simpleExtrude_gaode2",value:function(t,e){var i=this.complex;if(t.length<=1)return i;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var a=t.length,o=i.startIndex,s=1;s<a;s++){var u,l,c,f=t[s-1];f.push((u=e[s-1][2])!==null&&u!==void 0?u:0);var h=e[s-1],v=t[s];v.push((l=e[s][2])!==null&&l!==void 0?l:0);var p=e[s],d=s<t.length-1?[].concat(it(t[s+1]),[(c=e[s+1][2])!==null&&c!==void 0?c:0]):null,g=s<e.length-1?e[s+1]:null,y=this.simpleSegment(i,o,f,v,d,h,p,g);o+=y}if(this.dash)for(var m=0;m<i.positions.length/6;m++)i.positions[m*6+5]=this.totalDistance;return i.startIndex=i.positions.length/6,i}},{key:"extrude_gaode2",value:function(t,e){var i=this.complex;if(t.length<=1)return i;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var a=t.length,o=i.startIndex,s=1;s<a;s++){var u,l,c,f=t[s-1];f.push((u=e[s-1][2])!==null&&u!==void 0?u:0);var h=e[s-1],v=t[s];v.push((l=e[s][2])!==null&&l!==void 0?l:0);var p=e[s],d=s<t.length-1?[].concat(it(t[s+1]),[(c=e[s+1][2])!==null&&c!==void 0?c:0]):null,g=s<e.length-1?e[s+1]:null,y=this.segment_gaode2(i,o,f,v,d,h,p,g);o+=y}if(this.dash)for(var m=0;m<i.positions.length/6;m++)i.positions[m*6+5]=this.totalDistance;return i.startIndex=i.positions.length/6,i}},{key:"extrude",value:function(t){var e=this.complex;if(t.length<=1)return e;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var i=t.length,a=e.startIndex,o=1;o<i;o++){var s=t[o-1],u=t[o],l=o<t.length-1?t[o+1]:null,c=this.segment(e,a,s,u,l);a+=c}if(this.dash)for(var f=0;f<e.positions.length/6;f++)e.positions[f*6+5]=this.totalDistance;return e.startIndex=e.positions.length/6,e}},{key:"simpleSegment",value:function(t,e,i,a,o){var s=0,u=t.indices,l=t.positions,c=t.normals,f=be([a[0],a[1]]),h=be([i[0],i[1]]);La(ge,f,h);var v=0;if(this.dash&&(v=this.lineSegmentDistance(f,h),this.totalDistance+=v),this.normal||(this.normal=Ft(),Wn(this.normal,ge)),this.started||(this.started=!0,this.extrusions(l,c,i,this.normal,this.thickness,this.totalDistance-v)),u.push(e+0,e+1,e+2),!o)Wn(this.normal,ge),this.extrusions(l,c,a,this.normal,this.thickness,this.totalDistance),u.push.apply(u,it(this.lastFlip===1?[e,e+2,e+3]:[e+2,e+1,e+3])),s+=2;else{var p=be([o[0],o[1]]);Hf(f,p)&&Zt(p,f,kr(p,ji(p,f,h))),La(Vn,p,f);var d=Uf(wa,Ft(),ge,Vn,this.thickness),g=kt(d,2),y=g[0],m=g[1],x=Mn(wa,this.normal)<0?-1:1;this.extrusions(l,c,a,m,y,this.totalDistance),u.push.apply(u,it(this.lastFlip===1?[e,e+2,e+3]:[e+2,e+1,e+3])),x=-1,sn(this.normal,m),s+=2,this.lastFlip=x}return s}},{key:"segment_gaode2",value:function(t,e,i,a,o,s,u,l){var c=0,f=t.indices,h=t.positions,v=t.normals,p=this.cap==="square",d=this.join==="bevel",g=be([u[0],u[1]]),y=be([s[0],s[1]]);La(ge,a,i);var m=0;if(this.dash&&(m=this.lineSegmentDistance(g,y),this.totalDistance+=m),this.normal||(this.normal=Ft(),Wn(this.normal,ge)),!this.started)if(this.started=!0,p){var x=Ft(),_=Ft();Zt(x,this.normal,ge),Zt(_,this.normal,ge),v.push(_[0],_[1],0),v.push(x[0],x[1],0),h.push(i[0],i[1],i[2]|0,this.totalDistance-m,-this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),h.push(i[0],i[1],i[2]|0,this.totalDistance-m,this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(h,v,i,this.normal,this.thickness,this.totalDistance-m);if(f.push(e+0,e+1,e+2),o){Hf(a,o)&&Zt(o,a,kr(o,ji(o,a,i))),La(Vn,o,a);var M=Uf(wa,Ft(),ge,Vn,this.thickness),T=kt(M,2),k=T[0],L=T[1],O=Mn(wa,this.normal)<0?-1:1,D=d;if(!D&&this.join==="miter"){var W=k;W>this.miterLimit&&(D=!0)}D?(v.push(this.normal[0],this.normal[1],0),v.push(L[0],L[1],0),h.push(a[0],a[1],a[2]|0,this.totalDistance,-this.thickness*O,a[2]|0),this.complex.indexes.push(this.currentIndex),h.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness*O,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,f.push.apply(f,it(this.lastFlip!==-O?[e,e+2,e+3]:[e+2,e+1,e+3])),f.push(e+2,e+3,e+4),Wn(Pu,Vn),sn(this.normal,Pu),v.push(this.normal[0],this.normal[1],0),h.push(a[0],a[1],a[2]|0,this.totalDistance,-this.thickness*O,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,c+=3):(this.extrusions(h,v,a,L,k,this.totalDistance),f.push.apply(f,it(this.lastFlip===1?[e,e+2,e+3]:[e+2,e+1,e+3])),O=-1,sn(this.normal,L),c+=2),this.lastFlip=O}else{if(Wn(this.normal,ge),p){var E=Ft(),b=Ft();vr(b,ge,this.normal),Zt(E,ge,this.normal),v.push(b[0],b[1],0),v.push(E[0],E[1],0),h.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),h.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(h,v,a,this.normal,this.thickness,this.totalDistance);f.push.apply(f,it(this.lastFlip===1?[e,e+2,e+3]:[e+2,e+1,e+3])),c+=2}return c}},{key:"segment",value:function(t,e,i,a,o){var s=0,u=t.indices,l=t.positions,c=t.normals,f=this.cap==="square",h=this.join==="bevel",v=be([a[0],a[1]]),p=be([i[0],i[1]]);La(ge,v,p);var d=0;if(this.dash&&(d=this.lineSegmentDistance(v,p),this.totalDistance+=d),this.normal||(this.normal=Ft(),Wn(this.normal,ge)),!this.started)if(this.started=!0,f){var g=Ft(),y=Ft();Zt(g,this.normal,ge),Zt(y,this.normal,ge),c.push(y[0],y[1],0),c.push(g[0],g[1],0),l.push(i[0],i[1],i[2]|0,this.totalDistance-d,-this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),l.push(i[0],i[1],i[2]|0,this.totalDistance-d,this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(l,c,i,this.normal,this.thickness,this.totalDistance-d);if(u.push(e+0,e+1,e+2),o){var _=be([o[0],o[1]]);Hf(v,_)&&Zt(_,v,kr(_,ji(_,v,p))),La(Vn,_,v);var E=Uf(wa,Ft(),ge,Vn,this.thickness),b=kt(E,2),M=b[0],T=b[1],k=Mn(wa,this.normal)<0?-1:1,L=h;if(!L&&this.join==="miter"){var O=M;O>this.miterLimit&&(L=!0)}L?(c.push(this.normal[0],this.normal[1],0),c.push(T[0],T[1],0),l.push(a[0],a[1],a[2]|0,this.totalDistance,-this.thickness*k,a[2]|0),this.complex.indexes.push(this.currentIndex),l.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness*k,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,u.push.apply(u,it(this.lastFlip!==-k?[e,e+2,e+3]:[e+2,e+1,e+3])),u.push(e+2,e+3,e+4),Wn(Pu,Vn),sn(this.normal,Pu),c.push(this.normal[0],this.normal[1],0),l.push(a[0],a[1],a[2]|0,this.totalDistance,-this.thickness*k,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,s+=3):(this.extrusions(l,c,a,T,M,this.totalDistance),u.push.apply(u,it(this.lastFlip===1?[e,e+2,e+3]:[e+2,e+1,e+3])),k=-1,sn(this.normal,T),s+=2),this.lastFlip=k}else{if(Wn(this.normal,ge),f){var m=Ft(),x=Ft();vr(x,ge,this.normal),Zt(m,ge,this.normal),c.push(x[0],x[1],0),c.push(m[0],m[1],0),l.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),l.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(l,c,a,this.normal,this.thickness,this.totalDistance);u.push.apply(u,it(this.lastFlip===1?[e,e+2,e+3]:[e+2,e+1,e+3])),s+=2}return s}},{key:"extrusions",value:function(t,e,i,a,o,s){e.push(a[0],a[1],0),e.push(a[0],a[1],0),t.push(i[0],i[1],i[2]|0,s,-o,i[2]|0),this.complex.indexes.push(this.currentIndex),t.push(i[0],i[1],i[2]|0,s,o,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(t,e){var i=e[0]-t[0],a=e[1]-t[1];return Math.sqrt(i*i+a*a)}}]),r}();function EX(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,t=r[0][0],e=r[0][r[0].length-1];t[0]===e[0]&&t[1]===e[1]&&(r[0]=r[0].slice(0,r[0].length-1));for(var i=r[0].length,a=Za.exports.flatten(r),o=a.vertices,s=a.dimensions,u=[],l=[],c=[],f=0;f<o.length/s;f++)s===2?u.push(o[f*2],o[f*2+1],1,-1,-1):u.push(o[f*3],o[f*3+1],1,-1,-1),c.push(0,0,1);var h=Za.exports(a.vertices,a.holes,a.dimensions);l.push.apply(l,it(h));for(var v=function(g){var y=a.vertices.slice(g*s,(g+1)*s),m=a.vertices.slice((g+1)*s,(g+2)*s);m.length===0&&(m=a.vertices.slice(0,s));var x=u.length/5;u.push(y[0],y[1],1,0,0,m[0],m[1],1,.1,0,y[0],y[1],0,0,.8,m[0],m[1],0,.1,.8);var _=SX([m[0],m[1],1],[y[0],y[1],0],[y[0],y[1],1],n);c.push.apply(c,it(_).concat(it(_),it(_),it(_))),l.push.apply(l,it([1,2,0,3,2,1].map(function(E){return E+x})))},p=0;p<i;p++)v(p);return{positions:u,index:l,normals:c}}function SX(r,n,t){var e=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,i=qs(),a=qs(),o=qs();e&&(r=Sf(r),n=Sf(n),t=Sf(t));var s=_e.apply(Pc,it(r)),u=_e.apply(Pc,it(n)),l=_e.apply(Pc,it(t));Md(i,l,u),Md(a,s,u),sM(o,i,a);var c=qs();return zo(c,o),c}var Sr,zi;(function(r){r.CYLINDER="cylinder",r.SQUARECOLUMN="squareColumn",r.TRIANGLECOLUMN="triangleColumn",r.HEXAGONCOLUMN="hexagonColumn",r.PENTAGONCOLUMN="pentagonColumn"})(zi||(zi={}));var Ui;(function(r){r.CIRCLE="circle",r.SQUARE="square",r.TRIANGLE="triangle",r.HEXAGON="hexagon",r.PENTAGON="pentagon"})(Ui||(Ui={}));function Zs(r){for(var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=Math.PI*2/r,e=[],i=0;i<r;i++)e.push(t*i+n*Math.PI/12);var a=e.map(function(o){var s=Math.sin(o+Math.PI/4),u=Math.cos(o+Math.PI/4);return[s,u,0]});return a}function g1(){return Zs(30)}function y1(){return Zs(4)}function m1(){return Zs(3)}function x1(){return Zs(6,1)}function _1(){return Zs(5)}var $f=(Sr={},S(Sr,Ui.CIRCLE,g1),S(Sr,Ui.HEXAGON,x1),S(Sr,Ui.TRIANGLE,m1),S(Sr,Ui.SQUARE,y1),S(Sr,Ui.PENTAGON,_1),S(Sr,zi.CYLINDER,g1),S(Sr,zi.HEXAGONCOLUMN,x1),S(Sr,zi.TRIANGLECOLUMN,m1),S(Sr,zi.SQUARECOLUMN,y1),S(Sr,zi.PENTAGONCOLUMN,_1),Sr),Bu={};function Ji(r){var n=Or(r.coordinates);return{vertices:[].concat(it(n),it(n),it(n),it(n)),indices:[0,1,2,2,3,0],size:n.length}}function C1(r){var n=Or(r.coordinates),t=mT(n);return{vertices:[].concat(it(t),it(t),it(t),it(t)),indices:[0,1,2,2,3,0],size:t.length}}function xT(r){var n=r.shape,t=LX(n,!1),e=t.positions,i=t.index,a=t.normals;return{vertices:e,indices:i,normals:a,size:5}}function bX(r){var n=Or(r.coordinates);return{vertices:it(n),indices:[0],size:n.length}}function ua(r){var n=r.coordinates,t=r.originCoordinates,e=r.version,i=new CX({dash:!0,join:"bevel"});if(e==="GAODE2.x"){var a=n;Array.isArray(a[0][0])||(a=[n]);var o=t;Array.isArray(o[0][0])||(o=[t]);for(var s=0;s<a.length;s++){var u=a[s],l=o[s];i.extrude_gaode2(u,l)}}else{var c=n;c[0]&&!Array.isArray(c[0][0])&&(c=[n]),c.forEach(function(h){i.extrude(h)})}var f=i.complex;return{vertices:f.positions,indices:f.indices,normals:f.normals,indexes:f.indexes,size:6}}function AX(r){var n=r.coordinates,t=[];if(!Array.isArray(n[0]))return{vertices:[],indices:[],normals:[],size:6,count:0};var e=MX(n),i=e.results,a=e.totalDistance;return i.map(function(o){t.push(o[0],o[1],o[2],o[3],0,a)}),{vertices:t,indices:[],normals:[],size:6,count:i.length}}function TX(r){var n=r.coordinates,t=[];if(!Array.isArray(n[0]))return{vertices:[],indices:[],size:4,count:0};var e=wX(n),i=e.results;return i.map(function(a){t.push(a[0],a[1],a[2],a[3])}),{vertices:t,indices:[],size:4,count:i.length}}function E1(r,n){var t=n[0]-r[0],e=n[1]-r[1];return Math.sqrt(t*t+e*e)}function Wa(r,n){return r.length<3&&r.push(0),n!==void 0&&r.push(n),r}function MX(r){var n=0;if(r.length<2)return{results:r,totalDistance:0};var t=[],e=Wa(r[0],n);t.push(e);for(var i=1;i<r.length-1;i++){var a=E1(r[i-1],r[i]);n+=a;var o=Wa(r[i],n);t.push(o),t.push(o)}var s=E1(r[r.length-2],r[r.length-1]);return n+=s,t.push(Wa(r[r.length-1],n)),{results:t,totalDistance:n}}function wX(r){if(r.length<2)return{results:r};var n=[],t=Wa(r[0]);n.push(t);for(var e=1;e<r.length-1;e++){var i=Wa(r[e]);n.push(i),n.push(i)}return n.push(Wa(r[r.length-1])),{results:n}}function fv(r){var n=r.coordinates,t=Za.exports.flatten(n),e=t.vertices,i=t.dimensions,a=t.holes;return{indices:Za.exports(e,a,i),vertices:e,size:i}}function Ic(r){var n=r.coordinates,t=[].concat(it(n[0]),[0,0,1,n[1][0],n[0][1],0,1,1],it(n[1]),[0,1,0],it(n[0]),[0,0,1],it(n[1]),[0,1,0,n[0][0],n[1][1],0,0,0]),e=[0,1,2,3,4,5];return{vertices:t,indices:e,size:5}}function Dc(r,n){for(var t=n||30,e=r.coordinates,i=[],a=[],o=function(l){i.push(l,1,l,e[0][0],e[0][1],e[1][0],e[1][1],l,-1,l,e[0][0],e[0][1],e[1][0],e[1][1]),l!==t-1&&a.push.apply(a,it([0,1,2,1,3,2].map(function(c){return l*2+c})))},s=0;s<t;s++)o(s);return{vertices:i,indices:a,size:7}}function LX(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(Bu&&Bu[r])return Bu[r];var t=$f[r]?$f[r]():$f.cylinder(),e=EX([t],n);return Bu[r]=e,e}function FX(r){var n=kX();return function(){var e=B(r),i;if(n){var a=B(this).constructor;i=Reflect.construct(e,arguments,a)}else i=e.apply(this,arguments);return et(this,i)}}function kX(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var OX=`precision mediump float;
uniform float u_opacity: 1.0;

uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;

varying vec2 v_texCoord;

uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;

uniform float u_pixelConstant;
uniform float u_pixelConstantR;
uniform float u_pixelConstantG;
uniform float u_pixelConstantB;
uniform float u_pixelConstantRGB;

void main() {
  vec4 baseColor = texture2D(u_texture, vec2(v_texCoord.x, v_texCoord.y));

  float r = baseColor.r;
  float g = baseColor.g;
  float b = baseColor.b;

  float value = u_pixelConstant + ((r * u_pixelConstantR + g * u_pixelConstantG + b * u_pixelConstantB) * u_pixelConstantRGB);
  if (value == u_noDataValue) {
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  } else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1])) {
    gl_FragColor = vec4(0, 0, 0, 0);
  } else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] - u_domain[0]);
    vec4 color = texture2D(u_colorTexture, vec2(normalisedValue, 0));
    gl_FragColor = color;
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
  }
}
`,RX=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,IX=function(r){tt(t,r);var n=FX(t);function t(){return $(this,t),n.apply(this,arguments)}return H(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=i.clampLow,s=o===void 0?!0:o,u=i.clampHigh,l=u===void 0?!0:u,c=i.noDataValue,f=c===void 0?-9999999:c,h=i.domain,v=h===void 0?[0,1]:h,p=i.rampColors,d=i.pixelConstant,g=d===void 0?0:d,y=i.pixelConstantR,m=y===void 0?256*256:y,x=i.pixelConstantG,_=x===void 0?256:x,E=i.pixelConstantB,b=E===void 0?1:E,M=i.pixelConstantRGB,T=M===void 0?.1:M;return Y.exports.isEqual(this.rampColors,p)||(this.updateColorTexture(),this.rampColors=p),{u_opacity:a||1,u_texture:this.texture,u_pixelConstant:g,u_pixelConstantR:m,u_pixelConstantG:_,u_pixelConstantB:b,u_pixelConstantRGB:T,u_domain:v,u_clampLow:s,u_clampHigh:typeof l<"u"?l:s,u_noDataValue:f,u_colorTexture:this.colorTexture}}},{key:"initModels",value:function(i){var a=this,o=this.layer.getLayerConfig(),s=o.mask,u=s===void 0?!1:s,l=o.maskInside,c=l===void 0?!0:l,f=o.rampColorsData,h=o.rampColors,v=this.layer.getSource(),p=this.rendererService.createTexture2D;this.texture=p({height:0,width:0}),v.data.images.then(function(g){a.texture=p({data:g[0],width:g[0].width,height:g[0].height}),a.layerService.reRender()});var d=f||Ls(h);this.colorTexture=p({data:d.data,width:d.width,height:d.height,flipY:!1}),this.layer.buildLayerModel({moduleName:"RasterImage",vertexShader:RX,fragmentShader:OX,triangulation:Ic,primitive:A.TRIANGLES,depth:{enable:!1},blend:this.getBlend(),stencil:le(u,c),pick:!1}).then(function(g){i([g])}).catch(function(g){console.warn(g),i([])})}},{key:"clearModels",value:function(){var i,a;(i=this.texture)===null||i===void 0||i.destroy(),(a=this.colorTexture)===null||a===void 0||a.destroy()}},{key:"buildModels",value:function(i){this.initModels(i)}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:nt.Attribute,descriptor:{name:"a_Uv",buffer:{usage:A.DYNAMIC_DRAW,data:[],type:A.FLOAT},size:2,update:function(a,o,s){return[s[3],s[4]]}}})}},{key:"updateColorTexture",value:function(){var i=this.rendererService.createTexture2D,a=this.layer.getLayerConfig(),o=a.rampColors,s=Ls(o);this.colorTexture=i({data:s.data,width:s.width,height:s.height,flipY:!1})}}]),t}(qt);function DX(r){var n=PX();return function(){var e=B(r),i;if(n){var a=B(this).constructor;i=Reflect.construct(e,arguments,a)}else i=e.apply(this,arguments);return et(this,i)}}function PX(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var BX=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
void main() {
  vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));
  gl_FragColor = color;
  gl_FragColor.a *= u_opacity;
}
`,NX=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,zX=function(r){tt(t,r);var n=DX(t);function t(){return $(this,t),n.apply(this,arguments)}return H(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity;return{u_opacity:a||1,u_texture:this.texture}}},{key:"initModels",value:function(i){var a=this,o=this.layer.getLayerConfig(),s=o.mask,u=s===void 0?!1:s,l=o.maskInside,c=l===void 0?!0:l,f=this.layer.getSource(),h=this.rendererService.createTexture2D;if(this.texture=h({height:0,width:0}),hr){var v=this.layerService.sceneService.getSceneConfig().canvas,p=v.createImage();p.crossOrigin="anonymous",p.src=f.data.originData,p.onload=function(){a.texture=h({data:p,width:p.width,height:p.height}),a.layerService.reRender()}}else f.data.images.then(function(d){a.texture=h({data:d[0],width:d[0].width,height:d[0].height,mag:A.LINEAR,min:A.LINEAR}),a.layerService.reRender()});this.layer.buildLayerModel({moduleName:"rasterImage",vertexShader:NX,fragmentShader:BX,triangulation:Ic,primitive:A.TRIANGLES,blend:{enable:!0},depth:{enable:!1},stencil:le(u,c),pick:!1}).then(function(d){i([d])}).catch(function(d){console.warn(d),i([])})}},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy()}},{key:"buildModels",value:function(i){this.initModels(i)}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:nt.Attribute,descriptor:{name:"a_Uv",buffer:{usage:A.DYNAMIC_DRAW,data:[],type:A.FLOAT},size:2,update:function(a,o,s){return[s[3],s[4]]}}})}}]),t}(qt);function UX(r){var n=HX();return function(){var e=B(r),i;if(n){var a=B(this).constructor;i=Reflect.construct(e,arguments,a)}else i=e.apply(this,arguments);return et(this,i)}}function HX(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var $X=`precision mediump float;
uniform float u_opacity: 1.0;

uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;

varying vec2 v_texCoord;

uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;

uniform float u_pixelConstant;
uniform float u_pixelConstantR;
uniform float u_pixelConstantG;
uniform float u_pixelConstantB;
uniform float u_pixelConstantRGB;

void main() {
  vec4 baseColor = texture2D(u_texture, vec2(v_texCoord.x, v_texCoord.y));

  float r = baseColor.r;
  float g = baseColor.g;
  float b = baseColor.b;

  float value = u_pixelConstant + ((r * u_pixelConstantR + g * u_pixelConstantG + b * u_pixelConstantB) * u_pixelConstantRGB);
  if (value == u_noDataValue) {
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  } else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1])) {
    gl_FragColor = vec4(0, 0, 0, 0);
  } else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] - u_domain[0]);
    vec4 color = texture2D(u_colorTexture, vec2(normalisedValue, 0));
    gl_FragColor = color;
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
  }
}
`,GX=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,VX=function(r){tt(t,r);var n=UX(t);function t(){return $(this,t),n.apply(this,arguments)}return H(t,[{key:"getUninforms",value:function(){var i=this.rendererService.createTexture2D,a=this.layer.getLayerConfig(),o=a.opacity,s=a.clampLow,u=s===void 0?!0:s,l=a.clampHigh,c=l===void 0?!0:l,f=a.noDataValue,h=f===void 0?-9999999:f,v=a.domain,p=v===void 0?[0,1]:v,d=a.colorTexture,g=d===void 0?i({height:0,width:0}):d,y=a.pixelConstant,m=y===void 0?0:y,x=a.pixelConstantR,_=x===void 0?256*256:x,E=a.pixelConstantG,b=E===void 0?256:E,M=a.pixelConstantB,T=M===void 0?1:M,k=a.pixelConstantRGB,L=k===void 0?.1:k;return{u_opacity:o||1,u_texture:this.texture,u_pixelConstant:m,u_pixelConstantR:_,u_pixelConstantG:b,u_pixelConstantB:T,u_pixelConstantRGB:L,u_domain:p,u_clampLow:u,u_clampHigh:typeof c<"u"?c:u,u_noDataValue:h,u_colorTexture:g}}},{key:"initModels",value:function(i){var a=this,o=this.layer.getLayerConfig(),s=o.mask,u=s===void 0?!1:s,l=o.maskInside,c=l===void 0?!0:l,f=this.layer.getSource(),h=this.rendererService.createTexture2D;this.texture=h({height:0,width:0}),f.data.images.then(function(v){a.texture=h({data:v[0],width:v[0].width,height:v[0].height}),a.layerService.reRender()}),this.layer.buildLayerModel({moduleName:"RasterTileDataImage",vertexShader:GX,fragmentShader:$X,triangulation:Ic,primitive:A.TRIANGLES,depth:{enable:!1},blend:this.getBlend(),stencil:le(u,c),pick:!1}).then(function(v){i([v])}).catch(function(v){console.warn(v),i([])})}},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy()}},{key:"buildModels",value:function(i){this.initModels(i)}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:nt.Attribute,descriptor:{name:"a_Uv",buffer:{usage:A.DYNAMIC_DRAW,data:[],type:A.FLOAT},size:2,update:function(a,o,s){return[s[3],s[4]]}}})}}]),t}(qt),WX={image:zX,dataImage:IX,tileDataImage:VX};const jX=WX;function XX(r){var n=YX();return function(){var e=B(r),i;if(n){var a=B(this).constructor;i=Reflect.construct(e,arguments,a)}else i=e.apply(this,arguments);return et(this,i)}}function YX(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var ZX=function(r){tt(t,r);var n=XX(t);function t(){var e;$(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return e=n.call.apply(n,[this].concat(a)),S(I(e),"type","ImageLayer"),e}return H(t,[{key:"buildModels",value:function(){var i=this,a=this.getModelType();this.layerModel=new jX[a](this),this.layerModel.initModels(function(o){i.dispatchModelLoad(o)})}},{key:"rebuildModels",value:function(){var i=this;this.layerModel.buildModels(function(a){i.dispatchModelLoad(a)})}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var i=this.getModelType(),a={image:{},dataImage:{},tileDataImage:{}};return a[i]}},{key:"getModelType",value:function(){var i,a=this.styleAttributeService.getLayerStyleAttribute("shape"),o=a==null||(i=a.scale)===null||i===void 0?void 0:i.field;return o==="dataImage"?"dataImage":o==="image"?"image":o==="tileDataImage"?"tileDataImage":"image"}}]),t}(mo);function qX(r){var n=KX();return function(){var e=B(r),i;if(n){var a=B(this).constructor;i=Reflect.construct(e,arguments,a)}else i=e.apply(this,arguments);return et(this,i)}}function KX(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var QX=`uniform float u_opacity : 1.0;
uniform vec4 u_color;

void main() {
  gl_FragColor = u_color;
  gl_FragColor.a *= u_opacity;
}
`,JX=`attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#pragma include "projection"

void main() {
  vec4 project_pos = project_position(vec4(a_Position, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
}

`,tY=function(r){tt(t,r);var n=qX(t);function t(){return $(this,t),n.apply(this,arguments)}return H(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=a===void 0?0:a,s=i.color,u=s===void 0?"#000":s;return{u_opacity:Y.exports.isNumber(o)?o:0,u_color:Ut(u)}}},{key:"initModels",value:function(i){this.buildModels(i)}},{key:"buildModels",value:function(){var e=Mt(st.mark(function a(o){return st.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:this.layer.buildLayerModel({moduleName:"mask",vertexShader:JX,fragmentShader:QX,triangulation:fv,depth:{enable:!1},blend:this.getBlend(),stencil:{enable:!0,mask:255,func:{cmp:A.ALWAYS,ref:1,mask:255},opFront:{fail:A.REPLACE,zfail:A.REPLACE,zpass:A.REPLACE}},pick:!1}).then(function(l){o([l])}).catch(function(l){console.warn(l),o([])});case 1:case"end":return u.stop()}},a,this)}));function i(a){return e.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;i&&this.layerService.clear()}},{key:"registerBuiltinAttributes",value:function(){return""}}]),t}(qt),eY={fill:tY};const rY=eY;function nY(r,n){var t=typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(!t){if(Array.isArray(r)||(t=iY(r))||n&&r&&typeof r.length=="number"){t&&(r=t);var e=0,i=function(){};return{s:i,n:function(){return e>=r.length?{done:!0}:{done:!1,value:r[e++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){t=t.call(r)},n:function(){var l=t.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(o)throw s}}}}function iY(r,n){if(!!r){if(typeof r=="string")return S1(r,n);var t=Object.prototype.toString.call(r).slice(8,-1);if(t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set")return Array.from(r);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return S1(r,n)}}function S1(r,n){(n==null||n>r.length)&&(n=r.length);for(var t=0,e=new Array(n);t<n;t++)e[t]=r[t];return e}function aY(r){var n=oY();return function(){var e=B(r),i;if(n){var a=B(this).constructor;i=Reflect.construct(e,arguments,a)}else i=e.apply(this,arguments);return et(this,i)}}function oY(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var _T=function(r){tt(t,r);var n=aY(t);function t(){var e;$(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return e=n.call.apply(n,[this].concat(a)),S(I(e),"type","MaskLayer"),e}return H(t,[{key:"init",value:function(){var i=this,a=this.container.get(P.SceneID);this.configService.setLayerConfig(a,this.id,this.rawConfig),this.layerType=this.rawConfig.layerType,this.rendererService=this.container.get(P.IRendererService),this.layerService=this.container.get(P.ILayerService),this.mapService=this.container.get(P.IMapService),this.cameraService=this.container.get(P.ICameraService),this.coordinateService=this.container.get(P.ICoordinateSystemService),this.shaderModuleService=this.container.get(P.IShaderModuleService),this.postProcessingPassFactory=this.container.get(P.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(P.IFactoryNormalPass),this.styleAttributeService=this.container.get(P.IStyleAttributeService),this.pendingStyleAttributes.forEach(function(l){var c=l.attributeName,f=l.attributeField,h=l.attributeValues,v=l.updateOptions;i.styleAttributeService.updateStyleAttribute(c,{scale:U({field:f},i.splitValuesAndCallbackInAttribute(h,i.getLayerConfig()[c]))},v)}),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(P.ILayerPlugin);var o=nY(this.plugins),s;try{for(o.s();!(s=o.n()).done;){var u=s.value;u.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}}catch(l){o.e(l)}finally{o.f()}return this.hooks.init.call(),this.hooks.afterInit.call(),this}},{key:"buildModels",value:function(){var i=this,a=this.getModelType();this.layerModel=new rY[a](this),this.layerModel.initModels(function(o){i.dispatchModelLoad(o)})}},{key:"rebuildModels",value:function(){var i=this;this.layerModel.buildModels(function(a){i.dispatchModelLoad(a)})}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){return"fill"}}]),t}(mo),sY=["mvt","geojsonvt","testTile"];function CT(r){return sY.indexOf(r)>=0}function fd(r,n){n.map(function(t){var e=sv(r.sceneContainer);t.setContainer(e,r.sceneContainer),t.init()})}function hd(r,n){var t,e=n.getAttribute("shape");if(e&&(t=e.scale)!==null&&t!==void 0&&t.field){var i;return((i=e.scale)===null||i===void 0?void 0:i.values)==="text"?[e.scale.field,e.scale.values]:e.scale.field}switch(r){case"PolygonLayer":return"fill";case"LineLayer":return"tileline";case"PointLayer":return"circle";case"RasterLayer":return"image";default:return""}}function ET(r,n){switch(r){case"PolygonLayer":return!0;case"LineLayer":return!0;case"PointLayer":return!1;case"RasterLayer":return n;default:return n}}function uY(r,n,t,e){var i,a,o,s,u=(r==null||(i=r.bboxPolygon)===null||i===void 0?void 0:i.bbox)||[0,0,10,-10],l=kt(u,4),c=l[0],f=c===void 0?0:c,h=l[1],v=h===void 0?0:h,p=l[2],d=p===void 0?10:p,g=l[3],y=g===void 0?-10:g,m=n.lngLatToContainer([f,v]),x=n.lngLatToContainer([d,y]),_=x.x-m.x,E=m.y-x.y,b=[(t-m.x)/_,(e-x.y)/E],M=(r==null||(a=r.data)===null||a===void 0?void 0:a.width)||1,T=(r==null||(o=r.data)===null||o===void 0?void 0:o.height)||1,k=Math.floor(b[0]*M),L=Math.floor(b[1]*T),O=Math.max(0,L-1)*M+k,D=r==null||(s=r.data)===null||s===void 0?void 0:s.data[O];return D}function vd(r){return r.layerIDList.length===r.loadedLayers}function lY(r){var n=r.children;return n.filter(function(t){return vd(t)}).length===n.length}function cY(r){var n=r.parent;return n?vd(n):!0}function fY(r,n){var t=window.setInterval(function(){var e=vd(r),i=lY(r),a=cY(r);e&&i&&a&&(n(),window.clearInterval(t))},36)}function Ml(r,n,t){r.map(function(e){n==="mask"?e.style({mask:t}):e.updateLayerConfig(S({},n,t))})}function hY(r,n){r.isVisible?n():fY(r,function(){n()})}function vY(r){var n=!0;return r.map(function(t){t.type!=="PointLayer"&&(n=!1)}),n}function ST(r,n,t){if(n.length!==0){if(vY(n)){Ml(n,"visible",r.isVisible),t.reRender();return}hY(r,function(){Ml(n,"visible",r.isVisible),t.reRender()})}}function pY(r){var n=dY();return function(){var e=B(r),i;if(n){var a=B(this).constructor;i=Reflect.construct(e,arguments,a)}else i=e.apply(this,arguments);return et(this,i)}}function dY(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var gY=`uniform float u_opacity : 1.0;
varying vec4 v_color;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,yY=`attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

// uniform vec2 u_tileOrigin;
// uniform float u_coord;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;


#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;

void main() {
  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // if(u_coord > 0.0) { // \u4F7F\u7528\u7ECF\u7EAC\u5EA6\u5750\u6807
      if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));
    } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));
    }
  // } else { // \u4F7F\u7528\u504F\u79FB\u5750\u6807
  //   vec2 pointPos = a_Position.xy;
  //   vec4 tileWorld = vec4(project_mvt_offset_position(vec4(u_tileOrigin, 0.0, 1.0)).xyz, 1.0); // \u74E6\u7247\u8D77\u59CB\u70B9\u7684\u4E16\u754C\u5750\u6807

  //   vec2 pointOffset =  pointPos *  pow(2.0, u_Zoom); // \u74E6\u7247\u5185\u7684\u70B9\u7684\u504F\u79FB\u5750\u6807
    
  //   tileWorld.xy += pointOffset;

  //   tileWorld.xy += offset;

  //   if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
  //     // Needs to be divided with project_uCommonUnitsPerMeter
  //     tileWorld.w *= u_PixelsPerMeter.z;
  //   }
  //   gl_Position = u_ViewProjectionMatrix * tileWorld + u_ViewportCenterProjection;
  // }

  setPickingColor(a_PickingColor);
}
`,mY=`uniform float u_opacity : 1.0;
uniform vec4 u_color;

void main() {
  gl_FragColor = u_color;
  gl_FragColor.a *= u_opacity;
}
`,xY=`attribute float a_Miter;
attribute vec4 a_Color;
attribute vec3 a_Normal;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_size;

#pragma include "projection"

void main() {

  vec3 size = a_Miter * u_size * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));
  }
}
`,hv=function(r){tt(t,r);var n=pY(t);function t(){return $(this,t),n.apply(this,arguments)}return H(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=a===void 0?1:a,s=i.usage,u=i.color,l=u===void 0?"#fff":u,c=i.size,f=c===void 0?1:c;return{u_opacity:Number(o),u_color:s==="basemap"?Ut(l):[0,0,0,0],u_size:s==="basemap"?f:1}}},{key:"initModels",value:function(i){this.buildModels(i)}},{key:"buildModels",value:function(){var e=Mt(st.mark(function a(o){var s,u,l,c,f,h,v,p;return st.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:s=this.layer.getLayerConfig(),u=s.mask,l=u===void 0?!1:u,c=s.maskInside,f=c===void 0?!0:c,h=s.depth,v=h===void 0?!1:h,p=s.usage,this.layer.triangulation=ua,this.layer.buildLayerModel({moduleName:"lineTile_"+p,vertexShader:p==="basemap"?xY:yY,fragmentShader:p==="basemap"?mY:gY,triangulation:ua,blend:this.getBlend(),depth:{enable:v},stencil:le(l,f),pick:p!=="basemap"}).then(function(y){o([y])}).catch(function(y){console.warn(y),o([])});case 3:case"end":return g.stop()}},a,this)}));function i(a){return e.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){var i=this.layer.getLayerConfig(),a=i.usage;a!=="basemap"&&this.styleAttributeService.registerStyleAttribute({name:"size",type:nt.Attribute,descriptor:{name:"a_Size",buffer:{usage:A.DYNAMIC_DRAW,data:[],type:A.FLOAT},size:2,update:function(s){var u=s.size,l=u===void 0?1:u;return Array.isArray(l)?[l[0],l[1]]:[l,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:nt.Attribute,descriptor:{name:"a_Normal",buffer:{usage:A.STATIC_DRAW,data:[],type:A.FLOAT},size:3,update:function(s,u,l,c,f){return f}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:nt.Attribute,descriptor:{name:"a_Miter",buffer:{usage:A.STATIC_DRAW,data:[],type:A.FLOAT},size:1,update:function(s,u,l){return[l[4]]}}})}}]),t}(qt);function _Y(r){var n=CY();return function(){var e=B(r),i;if(n){var a=B(this).constructor;i=Reflect.construct(e,arguments,a)}else i=e.apply(this,arguments);return et(this,i)}}function CY(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var EY=`uniform float u_opacity : 1.0;
uniform vec4 u_color;

void main() {
  gl_FragColor = u_color;
  gl_FragColor.a *= u_opacity;
}
`,SY=`attribute vec4 a_Color;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#pragma include "projection"

varying vec4 v_color;

void main() {
  v_color = a_Color; 

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, 0.0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0.0, 1.0));
  }
}
`,bY=`uniform float u_opacity : 1.0;
uniform vec4 u_color;

void main() {
  gl_FragColor = u_color;
  gl_FragColor.a *= u_opacity;
}
`,AY=`attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#pragma include "projection"

void main() {
  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, 0.0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0.0, 1.0));
  }
}`,TY=function(r){tt(t,r);var n=_Y(t);function t(){return $(this,t),n.apply(this,arguments)}return H(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=a===void 0?1:a,s=i.usage,u=i.color,l=u===void 0?"#fff":u;return{u_opacity:Y.exports.isNumber(o)?o:1,u_color:s==="basemap"?Ut(l):[0,0,0,0]}}},{key:"initModels",value:function(i){this.buildModels(i)}},{key:"clearModels",value:function(){}},{key:"buildModels",value:function(i){var a=this.layer.getLayerConfig(),o=a.mask,s=o===void 0?!1:o,u=a.maskInside,l=u===void 0?!0:u,c=a.usage;this.layer.buildLayerModel({moduleName:"lineTileSimpleNormal_"+c,vertexShader:c==="basemap"?AY:SY,fragmentShader:c==="basemap"?bY:EY,triangulation:TX,primitive:A.LINES,depth:{enable:!1},blend:this.getBlend(),stencil:le(s,l),pick:!1}).then(function(f){i([f])}).catch(function(f){console.warn(f),i([])})}},{key:"registerBuiltinAttributes",value:function(){}}]),t}(qt);function MY(r,n){var t=typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(!t){if(Array.isArray(r)||(t=wY(r))||n&&r&&typeof r.length=="number"){t&&(r=t);var e=0,i=function(){};return{s:i,n:function(){return e>=r.length?{done:!0}:{done:!1,value:r[e++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){t=t.call(r)},n:function(){var l=t.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(o)throw s}}}}function wY(r,n){if(!!r){if(typeof r=="string")return b1(r,n);var t=Object.prototype.toString.call(r).slice(8,-1);if(t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set")return Array.from(r);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return b1(r,n)}}function b1(r,n){(n==null||n>r.length)&&(n=r.length);for(var t=0,e=new Array(n);t<n;t++)e[t]=r[t];return e}var LY=function(){function r(n,t,e){$(this,r),S(this,"boxCells",[]);var i=this.boxCells;this.xCellCount=Math.ceil(n/e),this.yCellCount=Math.ceil(t/e);for(var a=0;a<this.xCellCount*this.yCellCount;a++)i.push([]);this.boxKeys=[],this.bboxes=[],this.width=n,this.height=t,this.xScale=this.xCellCount/n,this.yScale=this.yCellCount/t,this.boxUid=0}return H(r,[{key:"insert",value:function(t,e,i,a,o){this.forEachCell(e,i,a,o,this.insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(e),this.bboxes.push(i),this.bboxes.push(a),this.bboxes.push(o)}},{key:"query",value:function(t,e,i,a,o){return this.queryHitTest(t,e,i,a,!1,o)}},{key:"hitTest",value:function(t,e,i,a,o){return this.queryHitTest(t,e,i,a,!0,o)}},{key:"insertBoxCell",value:function(t,e,i,a,o,s){this.boxCells[o].push(s)}},{key:"queryHitTest",value:function(t,e,i,a,o,s){if(i<0||t>this.width||a<0||e>this.height)return o?!1:[];var u=[];if(t<=0&&e<=0&&this.width<=i&&this.height<=a){if(o)return!0;for(var l=0;l<this.boxKeys.length;l++)u.push({key:this.boxKeys[l],x1:this.bboxes[l*4],y1:this.bboxes[l*4+1],x2:this.bboxes[l*4+2],y2:this.bboxes[l*4+3]});return s?u.filter(s):u}var c={hitTest:o,seenUids:{box:{},circle:{}}};return this.forEachCell(t,e,i,a,this.queryCell,u,c,s),o?u.length>0:u}},{key:"queryCell",value:function(t,e,i,a,o,s,u,l){var c=u.seenUids,f=this.boxCells[o];if(f!==null){var h=this.bboxes,v=MY(f),p;try{for(v.s();!(p=v.n()).done;){var d=p.value;if(!c.box[d]){c.box[d]=!0;var g=d*4;if(t<=h[g+2]&&e<=h[g+3]&&i>=h[g+0]&&a>=h[g+1]&&(!l||l(this.boxKeys[d]))){if(u.hitTest)return s.push(!0),!0;s.push({key:this.boxKeys[d],x1:h[g],y1:h[g+1],x2:h[g+2],y2:h[g+3]})}}}}catch(y){v.e(y)}finally{v.f()}}return!1}},{key:"forEachCell",value:function(t,e,i,a,o,s,u,l){for(var c=this.convertToXCellCoord(t),f=this.convertToYCellCoord(e),h=this.convertToXCellCoord(i),v=this.convertToYCellCoord(a),p=c;p<=h;p++)for(var d=f;d<=v;d++){var g=this.xCellCount*d+p;if(o.call(this,t,e,i,a,g,s,u,l))return}}},{key:"convertToXCellCoord",value:function(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}},{key:"convertToYCellCoord",value:function(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}}]),r}();const FY=LY;var bT=function(){function r(n,t){$(this,r),S(this,"viewportPadding",100),this.width=n,this.height=t,this.viewportPadding=Math.max(n,t),this.grid=new FY(n+this.viewportPadding,t+this.viewportPadding,25),this.screenRightBoundary=n+this.viewportPadding,this.screenBottomBoundary=t+this.viewportPadding,this.gridRightBoundary=n+2*this.viewportPadding,this.gridBottomBoundary=t+2*this.viewportPadding}return H(r,[{key:"placeCollisionBox",value:function(t){var e=t.x1+t.anchorPointX+this.viewportPadding,i=t.y1+t.anchorPointY+this.viewportPadding,a=t.x2+t.anchorPointX+this.viewportPadding,o=t.y2+t.anchorPointY+this.viewportPadding;return!this.isInsideGrid(e,i,a,o)||this.grid.hitTest(e,i,a,o)?{box:[]}:{box:[e,i,a,o]}}},{key:"insertCollisionBox",value:function(t,e){var i={featureIndex:e};this.grid.insert(i,t[0],t[1],t[2],t[3])}},{key:"project",value:function(t,e,i){var a=uM(e,i,0,1),o=lM(),s=cM.apply(fM,it(t));return XC(o,a,s),{x:(o[0]/o[3]+1)/2*this.width+this.viewportPadding,y:(-o[1]/o[3]+1)/2*this.height+this.viewportPadding}}},{key:"isInsideGrid",value:function(t,e,i,a){return i>=0&&t<this.gridRightBoundary&&a>=0&&e<this.gridBottomBoundary}}]),r}();function AT(r,n){var t=typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(!t){if(Array.isArray(r)||(t=kY(r))||n&&r&&typeof r.length=="number"){t&&(r=t);var e=0,i=function(){};return{s:i,n:function(){return e>=r.length?{done:!0}:{done:!1,value:r[e++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){t=t.call(r)},n:function(){var l=t.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(o)throw s}}}}function kY(r,n){if(!!r){if(typeof r=="string")return A1(r,n);var t=Object.prototype.toString.call(r).slice(8,-1);if(t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set")return Array.from(r);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return A1(r,n)}}function A1(r,n){(n==null||n>r.length)&&(n=r.length);for(var t=0,e=new Array(n);t<n;t++)e[t]=r[t];return e}function TT(r){var n=.5,t=.5;switch(r){case"right":case"top-right":case"bottom-right":n=1;break;case"left":case"top-left":case"bottom-left":n=0;break;default:n=.5}switch(r){case"bottom":case"bottom-right":case"bottom-left":t=1;break;case"top":case"top-right":case"top-left":t=0;break;default:t=.5}return{horizontalAlign:n,verticalAlign:t}}function MT(r,n,t,e,i){if(!!i){var a=r[e],o=a.glyph;if(o)for(var s=n[o].advance*a.scale,u=(r[e].x+s)*i,l=t;l<=e;l++)r[l].x-=u}}function wT(r,n,t,e,i,a,o){var s=(n-t)*i,u=(-e*o+.5)*a,l=AT(r),c;try{for(l.s();!(c=l.n()).done;){var f=c.value;f.x+=s,f.y+=u}}catch(h){l.e(h)}finally{l.f()}}function OY(r,n,t,e,i,a,o){var s=-8,u=0,l=s,c=0,f=r.positionedGlyphs,h=a==="right"?1:a==="left"?0:.5,v=f.length;t.forEach(function(m){if(m.split("").forEach(function(_){var E=n[_],b=0;E&&(f.push({glyph:_,x:u,y:l+b,vertical:!1,scale:1,metrics:E}),u+=E.advance+o)}),f.length!==v){var x=u-o;c=Math.max(x,c),MT(f,n,v,f.length-1,h)}u=0,l-=e+5});var p=TT(i),d=p.horizontalAlign,g=p.verticalAlign;wT(f,h,d,g,c,e,t.length);var y=l-s;r.top+=-g*y,r.bottom=r.top-y,r.left+=-d*c,r.right=r.left+c}function RY(r,n,t,e,i,a,o){var s=-8,u=0,l=s,c=0,f=r.positionedGlyphs,h=a==="right"?1:a==="left"?0:.5,v=f.length;t.forEach(function(m){var x=n[m],_=0;if(x&&(f.push({glyph:m,x:x.advance/2,y:l+_,vertical:!1,scale:1,metrics:x}),u+=x.advance+o),f.length!==v){var E=u-o;c=Math.max(E,c),MT(f,n,v,f.length-1,h)}u=0,l-=e+5});var p=TT(i),d=p.horizontalAlign,g=p.verticalAlign;wT(f,h,d,g,c,e,t.length);var y=l-s;r.top+=-g*y,r.bottom=r.top-y,r.left+=-d*c,r.right=r.left+c}function LT(r,n,t,e,i,a){var o=arguments.length>6&&arguments[6]!==void 0?arguments[6]:[0,0],s=arguments.length>7?arguments[7]:void 0,u=r.split(`
`),l=[],c={positionedGlyphs:l,top:o[1],bottom:o[1],left:o[0],right:o[0],lineCount:u.length,text:r};return s?RY(c,n,u,t,e,i,a):OY(c,n,u,t,e,i,a),l.length?c:!1}function FT(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0],t=arguments.length>2?arguments[2]:void 0,e=r.positionedGlyphs,i=e===void 0?[]:e,a=[],o=AT(i),s;try{for(o.s();!(s=o.n()).done;){var u=s.value,l=u.metrics,c=4,f=l.advance*u.scale/2,h=t?[u.x+f,u.y]:[0,0],v=t?[0,0]:[u.x+f+n[0],u.y+n[1]],p=(0-c)*u.scale-f+v[0],d=(0-c)*u.scale+v[1],g=p+l.width*u.scale,y=d+l.height*u.scale,m={x:p,y:d},x={x:g,y:d},_={x:p,y},E={x:g,y};a.push({tl:m,tr:x,bl:_,br:E,tex:l,glyphOffset:h})}}catch(b){o.e(b)}finally{o.f()}return a}function IY(r,n){var t=typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(!t){if(Array.isArray(r)||(t=DY(r))||n&&r&&typeof r.length=="number"){t&&(r=t);var e=0,i=function(){};return{s:i,n:function(){return e>=r.length?{done:!0}:{done:!1,value:r[e++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){t=t.call(r)},n:function(){var l=t.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(o)throw s}}}}function DY(r,n){if(!!r){if(typeof r=="string")return T1(r,n);var t=Object.prototype.toString.call(r).slice(8,-1);if(t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set")return Array.from(r);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return T1(r,n)}}function T1(r,n){(n==null||n>r.length)&&(n=r.length);for(var t=0,e=new Array(n);t<n;t++)e[t]=r[t];return e}function PY(r){var n=BY();return function(){var e=B(r),i;if(n){var a=B(this).constructor;i=Reflect.construct(e,arguments,a)}else i=e.apply(this,arguments);return et(this,i)}}function BY(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var M1=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 48.0
uniform sampler2D u_sdf_map;
uniform float u_gamma_scale : 0.5;
// uniform float u_font_size : 24.0;
uniform float u_opacity : 1.0;
uniform vec4 u_stroke_color : [0, 0, 0, 1];
uniform float u_stroke_width : 2.0;
uniform float u_halo_blur : 0.5;
uniform float u_DevicePixelRatio;

varying vec4 v_color;
varying vec2 v_uv;
varying float v_gamma_scale;
varying float v_fontScale;

#pragma include "picking"
void main() {
  // get sdf from atlas
  float dist = texture2D(u_sdf_map, v_uv).a;

  lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;
  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;

  highp float gamma_scaled = gamma * v_gamma_scale;

  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);
  
  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), vec4(u_stroke_color.rgb, u_stroke_color.a * u_opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor.a= gl_FragColor.a * alpha;
  gl_FragColor = filterColor(gl_FragColor);
}
`,w1=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 24.0
attribute vec3 a_Position;
attribute vec2 a_tex;
attribute vec2 a_textOffsets;
attribute vec4 a_Color;
attribute float a_Size;

uniform vec2 u_sdf_map_size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec2 v_uv;
varying float v_gamma_scale;
varying vec4 v_color;
varying float v_fontScale;

uniform float u_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

#pragma include "projection"
#pragma include "picking"

void main() {
  v_color = a_Color;
  v_uv = a_tex / u_sdf_map_size;

  // \u6587\u672C\u7F29\u653E\u6BD4\u4F8B
  float fontScale = a_Size / FONT_SIZE;
  v_fontScale = fontScale;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));

  vec4 projected_position;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
   projected_position  = u_Mvp * (vec4(a_Position.xyz, 1.0));
  } else { // else
   projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  gl_Position = vec4(
    projected_position.xy / projected_position.w + a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);
  v_gamma_scale = gl_Position.w;
  setPickingColor(a_PickingColor);

}
`,L1=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 48.0
uniform sampler2D u_sdf_map;
uniform float u_gamma_scale : 0.5;

uniform float u_opacity : 1.0;
uniform vec4 u_stroke_color : [0, 0, 0, 1];
uniform float u_stroke_width : 2.0;
uniform float u_halo_blur : 0.5;
uniform float u_DevicePixelRatio;

varying vec2 v_uv;
varying float v_gamma_scale;
varying float v_fontScale;
uniform vec4 u_color;

void main() {
  // get sdf from atlas
  float dist = texture2D(u_sdf_map, v_uv).a;

  lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;
  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;

  highp float gamma_scaled = gamma * v_gamma_scale;

  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);
  
  gl_FragColor = mix(vec4(u_color.rgb, u_color.a * u_opacity), vec4(u_stroke_color.rgb, u_stroke_color.a * u_opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor.a= gl_FragColor.a * alpha;
}
`,F1=`#define FONT_SIZE 24.0
attribute vec3 a_Position;
attribute vec2 a_tex;
attribute vec2 a_textOffsets;

uniform vec2 u_sdf_map_size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_size;

varying vec2 v_uv;
varying float v_gamma_scale;
varying float v_fontScale;

#pragma include "projection"

void main() {
  v_uv = a_tex / u_sdf_map_size;

  // \u6587\u672C\u7F29\u653E\u6BD4\u4F8B
  float fontScale = u_size / FONT_SIZE;
  v_fontScale = fontScale;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));

  vec4 projected_position;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
   projected_position  = u_Mvp * (vec4(a_Position.xyz, 1.0));
  } else { // else
   projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  gl_Position = vec4(
    projected_position.xy / projected_position.w + a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);
  v_gamma_scale = gl_Position.w;

}
`;function k1(r){var n=this,t=r.id,e=[],i=[];if(!n.glyphInfoMap||!n.glyphInfoMap[t])return{vertices:[],indices:[],size:7};var a=n.glyphInfoMap[t].centroid,o=a.length===2?[a[0],a[1],0]:a;return n.glyphInfoMap[t].glyphQuads.forEach(function(s,u){e.push.apply(e,it(o).concat([s.tex.x,s.tex.y+s.tex.height,s.tl.x,s.tl.y],it(o),[s.tex.x+s.tex.width,s.tex.y+s.tex.height,s.tr.x,s.tr.y],it(o),[s.tex.x+s.tex.width,s.tex.y,s.br.x,s.br.y],it(o),[s.tex.x,s.tex.y,s.bl.x,s.bl.y])),i.push(0+u*4,1+u*4,2+u*4,2+u*4,3+u*4,0+u*4)}),{vertices:e,indices:i,size:7}}var kT=function(r){tt(t,r);var n=PY(t);function t(){var e;$(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return e=n.call.apply(n,[this].concat(a)),S(I(e),"glyphInfoMap",{}),S(I(e),"currentZoom",-1),S(I(e),"textureHeight",0),S(I(e),"textCount",0),S(I(e),"preTextStyle",{}),S(I(e),"buildModels",function(){var s=Mt(st.mark(function u(l){var c,f;return st.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:e.mapping(),c=e.layer.getLayerConfig(),f=c.usage,e.layer.buildLayerModel({moduleName:"pointTileText_"+f,vertexShader:f==="basemap"?F1:w1,fragmentShader:f==="basemap"?L1:M1,triangulation:k1.bind(I(e)),depth:{enable:!1},blend:e.getBlend(),pick:f!=="basemap"}).then(function(p){l([p])}).catch(function(p){console.warn(p),l([])});case 3:case"end":return v.stop()}},u)}));return function(u){return s.apply(this,arguments)}}()),S(I(e),"mapping",function(){e.initGlyph(),e.updateTexture(),e.filterGlyphs(),e.reBuildModel()}),e}return H(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=a===void 0?1:a,s=i.stroke,u=s===void 0?"#fff":s,l=i.strokeWidth,c=l===void 0?0:l,f=i.textAnchor,h=f===void 0?"center":f,v=i.textAllowOverlap,p=v===void 0?!1:v,d=i.halo,g=d===void 0?.5:d,y=i.gamma,m=y===void 0?2:y,x=i.usage,_=i.color,E=_===void 0?"#fff":_,b=i.size,M=b===void 0?1:b,T=this.fontService,k=T.canvas,L=T.mapping;return Object.keys(L).length!==this.textCount&&(this.updateTexture(),this.textCount=Object.keys(L).length),this.preTextStyle={textAnchor:h,textAllowOverlap:p},{u_opacity:Y.exports.isNumber(o)?o:1,u_stroke_width:Y.exports.isNumber(c)?c:1,u_stroke_color:this.getStrokeColor(u),u_sdf_map:this.texture,u_halo_blur:g,u_gamma_scale:m,u_sdf_map_size:[k.width,k.height],u_color:x==="basemap"?Ut(E):[0,0,0,0],u_size:x==="basemap"?M:1}}},{key:"initModels",value:function(i){this.extent=this.textExtent();var a=this.layer.getLayerConfig(),o=a.textAnchor,s=o===void 0?"center":o,u=a.textAllowOverlap,l=u===void 0?!0:u;this.preTextStyle={textAnchor:s,textAllowOverlap:l},this.buildModels(i)}},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy()}},{key:"registerBuiltinAttributes",value:function(){var i=this.layer.getLayerConfig(),a=i.usage;this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:nt.Attribute,descriptor:{name:"a_textOffsets",buffer:{usage:A.STATIC_DRAW,data:[],type:A.FLOAT},size:2,update:function(s,u,l){return[l[5],l[6]]}}}),a!=="basemap"&&this.styleAttributeService.registerStyleAttribute({name:"size",type:nt.Attribute,descriptor:{name:"a_Size",buffer:{usage:A.DYNAMIC_DRAW,data:[],type:A.FLOAT},size:1,update:function(s){var u=s.size,l=u===void 0?12:u;return Array.isArray(l)?[l[0]]:[l]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:nt.Attribute,descriptor:{name:"a_tex",buffer:{usage:A.DYNAMIC_DRAW,data:[],type:A.FLOAT},size:2,update:function(s,u,l){return[l[3],l[4]]}}})}},{key:"textExtent",value:function(){var i=this.mapService.getBounds();return Lc(i,.5)}},{key:"initTextFont",value:function(){var i=this.layer.getLayerConfig(),a=i.fontWeight,o=a===void 0?"400":a,s=i.fontFamily,u=s===void 0?"sans-serif":s,l=this.layer.getEncodedData(),c=[];l.forEach(function(f){var h=f.shape,v=h===void 0?"":h;v=v.toString();var p=IY(v),d;try{for(p.s();!(d=p.n()).done;){var g=d.value;c.indexOf(g)===-1&&c.push(g)}}catch(y){p.e(y)}finally{p.f()}}),this.fontService.setFontOptions({characterSet:c,fontWeight:o,fontFamily:u,iconfont:!1})}},{key:"generateGlyphLayout",value:function(){var i=this,a=this.fontService.mapping,o=this.layer.getLayerConfig(),s=o.spacing,u=s===void 0?2:s,l=o.textAnchor,c=l===void 0?"center":l,f=this.layer.getEncodedData();this.glyphInfo=f.map(function(h){var v=h.shape,p=v===void 0?"":v,d=h.id,g=h.size,y=g===void 0?1:g,m=h.textOffset,x=m===void 0?[0,0]:m,_=LT(p.toString(),a,y,c,"left",u,x,!1),E=FT(_,x,!1);return h.shaping=_,h.glyphQuads=E,h.centroid=Or(h.coordinates),h.originCentroid=h.version==="GAODE2.x"?Or(h.originCoordinates):h.originCentroid=h.centroid,i.glyphInfoMap[d]={shaping:_,glyphQuads:E,centroid:Or(h.coordinates)},h})}},{key:"filterGlyphs",value:function(){var i=this,a=this.layer.getLayerConfig(),o=a.padding,s=o===void 0?[4,4]:o,u=a.textAllowOverlap,l=u===void 0?!1:u;if(!l){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var c=this.rendererService.getViewportSize(),f=c.width,h=c.height,v=new bT(f,h),p=this.glyphInfo.filter(function(d){var g=d.shaping,y=d.id,m=y===void 0?0:y,x=d.version==="GAODE2.x"?d.originCentroid:d.centroid,_=d.size,E=_/24,b=i.mapService.lngLatToContainer(x),M=v.placeCollisionBox({x1:g.left*E-s[0],x2:g.right*E+s[0],y1:g.top*E-s[1],y2:g.bottom*E+s[1],anchorPointX:b.x,anchorPointY:b.y}),T=M.box;return T&&T.length?(v.insertCollisionBox(T,m),!0):!1});p.forEach(function(d){i.glyphInfoMap[d.id]=d})}}},{key:"initGlyph",value:function(){this.initTextFont(),this.generateGlyphLayout()}},{key:"updateTexture",value:function(){var i=this.rendererService.createTexture2D,a=this.fontService.canvas;this.textureHeight=a.height,this.texture&&this.texture.destroy(),this.texture=i({data:a,mag:A.LINEAR,min:A.LINEAR,width:a.width,height:a.height})}},{key:"reBuildModel",value:function(){var i=this,a=this.layer.getLayerConfig(),o=a.usage;this.filterGlyphs(),this.layer.buildLayerModel({moduleName:"pointTileText_"+o,vertexShader:o==="basemap"?F1:w1,fragmentShader:o==="basemap"?L1:M1,triangulation:k1.bind(this),depth:{enable:!1},blend:this.getBlend(),pick:o!=="basemap"}).then(function(s){i.layer.models=[s],i.layerService.throttleRenderLayers()}).catch(function(s){console.warn(s),i.layer.models=[]})}}]),t}(qt);function NY(r){var n=zY();return function(){var e=B(r),i;if(n){var a=B(this).constructor;i=Reflect.construct(e,arguments,a)}else i=e.apply(this,arguments);return et(this,i)}}function zY(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var UY=`uniform float u_additive;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"

void main() {
  int shape = int(floor(v_data.w + 0.5));


  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + u_stroke_width);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }


  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = u_stroke_width < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  if(u_stroke_width < 0.01) {
    gl_FragColor = vec4(v_color.rgb, v_color.a * u_opacity);
  } else {
    gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), u_stroke_color * u_stroke_opacity, color_t);
  }

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor.a *= opacity_t;
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,HY=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

// uniform vec2 u_tileOrigin;
// uniform float u_coord;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

#pragma include "projection"
#pragma include "picking"

void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  float newSize = setPickingSize(a_Size);

  // cal style mapping

  v_color = a_Color;
  v_radius = newSize;

  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, 0.0);

  vec2 offset = (extrude.xy * (newSize + u_stroke_width));
  offset = project_pixel(offset);

  v_data = vec4(extrude.x, extrude.y, antialiasblur,shape_type);

  vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
  }

// if(u_coord > 0.0) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));
  }
// } else {

  // vec2 pointPos = a_Position.xy;
  // vec4 world = vec4(project_mvt_offset_position(vec4(u_tileOrigin, 0.0, 1.0)).xyz, 1.0); // \u74E6\u7247\u8D77\u59CB\u70B9\u7684\u4E16\u754C\u5750\u6807

  // vec2 pointOffset =  pointPos *  pow(2.0, u_Zoom); // \u74E6\u7247\u5185\u7684\u70B9\u7684\u504F\u79FB\u5750\u6807
  
  // world.xy += offset;
  // world.xy += pointOffset;

  // if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
  //   // Needs to be divided with project_uCommonUnitsPerMeter
  //   world.w *= u_PixelsPerMeter.z;
  // }

  // gl_Position = u_ViewProjectionMatrix * world + u_ViewportCenterProjection;
// }

 
  setPickingColor(a_PickingColor);


}
`,tl=function(r){tt(t,r);var n=NY(t);function t(){return $(this,t),n.apply(this,arguments)}return H(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=a===void 0?1:a,s=i.strokeOpacity,u=s===void 0?1:s,l=i.strokeWidth,c=l===void 0?0:l,f=i.stroke,h=f===void 0?"rgba(0,0,0,0)":f,v=i.blend;return{u_additive:v==="additive"?1:0,u_opacity:Number(o),u_stroke_opacity:Number(u),u_stroke_width:Number(c),u_stroke_color:this.getStrokeColor(h)}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Ji)}},{key:"initModels",value:function(i){this.buildModels(i)}},{key:"buildModels",value:function(i){var a=this.layer.getLayerConfig(),o=a.workerEnabled,s=o===void 0?!1:o,u=a.usage;this.layer.triangulation=Ji,this.layer.buildLayerModel({moduleName:"pointTile_"+u,vertexShader:HY,fragmentShader:UY,triangulation:Ji,depth:{enable:!1},cull:{enable:!0,face:kc(this.mapService.version)},blend:this.getBlend(),workerEnabled:s,workerOptions:{modelType:"pointTile"},pick:u!=="basemap"}).then(function(l){i([l])}).catch(function(l){console.warn(l),i([])})}},{key:"clearModels",value:function(){}},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:nt.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:A.DYNAMIC_DRAW,data:[],type:A.FLOAT},size:3,update:function(o,s,u,l){var c=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],f=l%4*3;return[c[f],c[f+1],c[f+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:nt.Attribute,descriptor:{name:"a_Size",buffer:{usage:A.DYNAMIC_DRAW,data:[],type:A.FLOAT},size:1,update:function(o){var s=o.size,u=s===void 0?5:s;return Array.isArray(u)?[u[0]]:[u]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:nt.Attribute,descriptor:{name:"a_Shape",buffer:{usage:A.DYNAMIC_DRAW,data:[],type:A.FLOAT},size:1,update:function(o){var s=o.shape,u=s===void 0?2:s,l=i.layer.getLayerConfig().shape2d,c=l.indexOf(u);return[c]}}})}}]),t}(qt);function $Y(r){var n=GY();return function(){var e=B(r),i;if(n){var a=B(this).constructor;i=Reflect.construct(e,arguments,a)}else i=e.apply(this,arguments);return et(this,i)}}function GY(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var VY=`uniform float u_opacity : 1.0;
varying vec4 v_color;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,WY=`attribute vec4 a_Color;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

// uniform vec2 u_tileOrigin;
// uniform float u_coord;

varying vec4 v_color;

#pragma include "projection"
#pragma include "picking"

void main() {
  v_color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));

  // if(u_coord > 0.0) {
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
    } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
    }
  // } else {
  //   vec4 world = vec4(project_mvt_offset_position(vec4(u_tileOrigin, 0.0, 1.0)).xyz, 1.0); // \u74E6\u7247\u8D77\u59CB\u70B9\u7684\u4E16\u754C\u5750\u6807

  //   vec2 pointOffset = a_Position.xy *  pow(2.0, u_Zoom); // \u74E6\u7247\u5185\u7684\u70B9\u7684\u504F\u79FB\u5750\u6807
    
  //   world.xy += pointOffset;

  //   if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
  //     // Needs to be divided with project_uCommonUnitsPerMeter
  //     world.w *= u_PixelsPerMeter.z;
  //   }

  //   gl_Position = u_ViewProjectionMatrix * world + u_ViewportCenterProjection;
  // }

  setPickingColor(a_PickingColor);
}

`,jY=`uniform float u_opacity : 1.0;
uniform vec4 u_color;

void main() {
  gl_FragColor = u_color;
  gl_FragColor.a *= u_opacity;
}
`,XY=`attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#pragma include "projection"

void main() {
  vec4 project_pos = project_position(vec4(a_Position, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
}`,YY=function(r){tt(t,r);var n=$Y(t);function t(){return $(this,t),n.apply(this,arguments)}return H(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=a===void 0?1:a,s=i.usage,u=i.color,l=u===void 0?"#fff":u;return{u_opacity:o,u_color:s==="basemap"?Ut(l):[0,0,0,0]}}},{key:"initModels",value:function(i){this.buildModels(i)}},{key:"buildModels",value:function(i){var a=this.layer.getLayerConfig(),o=a.mask,s=o===void 0?!1:o,u=a.maskInside,l=u===void 0?!0:u,c=a.usage;this.layer.triangulation=fv,this.layer.buildLayerModel({moduleName:"polygonTile_"+c,vertexShader:c==="basemap"?XY:WY,fragmentShader:c==="basemap"?jY:VY,triangulation:fv,depth:{enable:!1},blend:this.getBlend(),stencil:le(s,l),pick:c!=="basemap"}).then(function(f){i([f])}).catch(function(f){console.warn(f),i([])})}},{key:"clearModels",value:function(){}},{key:"registerBuiltinAttributes",value:function(){}}]),t}(qt);function ZY(r,n){var t=typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(!t){if(Array.isArray(r)||(t=qY(r))||n&&r&&typeof r.length=="number"){t&&(r=t);var e=0,i=function(){};return{s:i,n:function(){return e>=r.length?{done:!0}:{done:!1,value:r[e++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){t=t.call(r)},n:function(){var l=t.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(o)throw s}}}}function qY(r,n){if(!!r){if(typeof r=="string")return O1(r,n);var t=Object.prototype.toString.call(r).slice(8,-1);if(t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set")return Array.from(r);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return O1(r,n)}}function O1(r,n){(n==null||n>r.length)&&(n=r.length);for(var t=0,e=new Array(n);t<n;t++)e[t]=r[t];return e}function KY(r){var n=QY();return function(){var e=B(r),i;if(n){var a=B(this).constructor;i=Reflect.construct(e,arguments,a)}else i=e.apply(this,arguments);return et(this,i)}}function QY(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var vv=function(r){tt(t,r);var n=KY(t);function t(){var e;$(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return e=n.call.apply(n,[this].concat(a)),S(I(e),"needListen",!0),S(I(e),"isVector",!0),S(I(e),"type",e.layerType||"vectorLayer"),S(I(e),"pickedID",null),S(I(e),"sourceEvent",function(){e.dataState.dataSourceNeedUpdate=!0,e.reRender()}),e}return H(t,[{key:"init",value:function(){var i=this,a=this.container.get(P.SceneID);this.configService.setLayerConfig(a,this.id,this.rawConfig),this.layerType=this.rawConfig.layerType,this.type==="PointLayer"&&(this.iconService=this.container.get(P.IIconService),this.fontService=this.container.get(P.IFontService)),this.rendererService=this.container.get(P.IRendererService),this.layerService=this.container.get(P.ILayerService),this.mapService=this.container.get(P.IMapService),this.cameraService=this.container.get(P.ICameraService),this.coordinateService=this.container.get(P.ICoordinateSystemService),this.shaderModuleService=this.container.get(P.IShaderModuleService),this.postProcessingPassFactory=this.container.get(P.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(P.IFactoryNormalPass),this.styleAttributeService=this.container.get(P.IStyleAttributeService),this.pendingStyleAttributes.forEach(function(l){var c=l.attributeName,f=l.attributeField,h=l.attributeValues,v=l.updateOptions;i.styleAttributeService.updateStyleAttribute(c,{scale:U({field:f},i.splitValuesAndCallbackInAttribute(h,i.getLayerConfig()[c]))},v)}),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(P.ILayerPlugin);var o=ZY(this.plugins),s;try{for(o.s();!(s=o.n()).done;){var u=s.value;u.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}}catch(l){o.e(l)}finally{o.f()}return this.hooks.init.call(),this.hooks.afterInit.call(),this}},{key:"renderModels",value:function(i){var a=this;return this.models.forEach(function(o){o.draw({uniforms:a.layerModel.getUninforms()},i)}),this}},{key:"getPickID",value:function(){return this.pickedID}},{key:"setPickID",value:function(){return this.pickedID}},{key:"buildModels",value:function(){var i=this,a=this.getModelType();this.layerModel=new a(this),this.layerModel.initModels(function(o){i.dispatchModelLoad(o)})}},{key:"rebuildModels",value:function(){var i=this;this.layerModel.buildModels(function(a){i.dispatchModelLoad(a)})}},{key:"getModelType",value:function(){switch(this.layerType){case"PolygonLayer":return YY;case"LineLayer":return this.getLineModel();case"PointLayer":return this.getPointModel();default:return tl}}},{key:"getLineModel",value:function(){var i,a=this.styleAttributeService.getLayerStyleAttribute("shape"),o=a==null||(i=a.scale)===null||i===void 0?void 0:i.field;switch(o){case"tileline":case"line":return hv;case"simple":return TY;default:return hv}}},{key:"getPointModel",value:function(){var i=this.getEncodedData(),a=this.getLayerConfig(),o=a.shape2d,s=i.find(function(l){return l.hasOwnProperty("shape")});if(s){var u=s.shape;return(o==null?void 0:o.indexOf(u))!==-1?tl:kT}else return tl}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){return{}}}]),t}(mo),R1={features:[],featureId:null,vectorTileLayer:null,source:null},xo=function(){function r(n){$(this,r),S(this,"outSideEventTimer",null),S(this,"eventCache",{click:0,mousemove:0,mouseup:0,mousedown:0,contextmenu:0}),this.parentLayer=n.parent,this.mapService=n.mapService,this.rendererService=n.rendererService;var t=this.parentLayer.getSource();this.zoomOffset=t.parser.zoomOffset||0,this.tilesetManager=t.tileset}return H(r,[{key:"createTile",value:function(t,e){return{layers:[],layerIDList:[]}}},{key:"getFeatureData",value:function(t,e){var i=e.sourceLayer,a=e.featureId,o=e.transforms,s=o===void 0?[]:o,u=e.layerType,l=e.shape;if(!i)return R1;var c=t.data.layers[i],f=c==null?void 0:c.features;if(Array.isArray(f)&&f.length>0){var h=[];u==="LineLayer"&&l==="simple"?f.map(function(p){var d=HM(p);if(d.geometry.type==="MultiPolygon"){var g,y=$M(d).features;(g=h).push.apply(g,it(y))}else d.geometry.type==="Polygon"&&(d.geometry.type="MultiLineString"),h.push(d)}):h=f;var v=new ya({type:"FeatureCollection",features:h},{parser:{type:"geojson",featureId:a,cancelExtent:!0},transforms:s});return{features:h,featureId:a,vectorTileLayer:c,source:v}}else return R1}},{key:"createLayer",value:function(t){var e=t.L7Layer,i=t.tile,a=t.initOptions,o=t.vectorTileLayer,s=t.source,u=t.needListen,l=u===void 0?!0:u,c=a.mask,f=a.color,h=a.layerType,v=a.size,p=a.shape,d=a.usage,g=a.basemapColor,y=a.basemapSize,m=e||vv,x=new m(U({visible:i.isVisible,tileOrigin:o==null?void 0:o.l7TileOrigin,coord:o==null?void 0:o.l7TileCoord,needListen:l},this.getLayerInitOption(a)));h&&(x.type=h),x.isTileLayer=!0,x.isVector&&d!=="basemap"&&(this.emitEvent([x]),x.select(!0)),x.source(s),this.setStyleAttributeField(x,"shape",p),d!=="basemap"?(this.setScale(x),this.setStyleAttributeField(x,"color",f),this.setStyleAttributeField(x,"size",v)):x.style({color:g,size:y});var _=[x];if(c&&x.isVector){var E=new _T().source({type:"FeatureCollection",features:[i.bboxPolygon]},{parser:{type:"geojson",cancelExtent:!0}});_.push(E),x.addMaskLayer(E)}return fd(this.parentLayer,_),this.layers=[x],x}},{key:"updateStyle",value:function(t){return""}},{key:"getDefautStyleAttributeField",value:function(t,e){switch(e){case"size":return 1;case"color":return"#fff";case"shape":return hd(this.parentLayer.type,t);default:return""}}},{key:"setStyleAttributeField",value:function(t,e,i){if(Array.isArray(i)){t[e].apply(t,it(i));return}if(typeof i=="string"){t[e](i);return}var a=this.getDefautStyleAttributeField(t,e);if(!i)return t[e](a),t;var o=this.parseScaleValue(i,e);o.length===0?t[e](a):t[e].apply(t,it(o))}},{key:"parseScaleValue",value:function(t,e){if(e==="shape")return typeof t=="string"?[t]:t!=null&&t.field?[t==null?void 0:t.field]:[];var i=t,a=i.field,o=i.values,s=i.callback;return a&&o&&Array.isArray(o)?[a,o]:a&&s?[a,s]:a?[a]:[]}},{key:"getTile",value:function(t,e){var i=this.mapService.getZoom(),a=Math.ceil(i)+this.zoomOffset,o=Zh(t,e,a),s=this.tilesetManager.tiles.filter(function(u){return u.key==="".concat(o[0],",").concat(o[1],",").concat(a)});return s[0]}},{key:"emitEvent",value:function(t,e){var i=this;t.map(function(a){a.once("inited",function(){a.on("click",function(o){if(i.eventCache.click=1,i.parentLayer.type==="RasterLayer"){var s=o.lngLat,u=s.lng,l=s.lat,c=i.getTile(u,l);c&&i.getFeatureAndEmitEvent(a,"subLayerClick",o,e,c)}else i.getFeatureAndEmitEvent(a,"subLayerClick",o)}),a.on("mousemove",function(o){if(i.eventCache.mousemove=1,i.parentLayer.type==="RasterLayer"){var s=o.lngLat,u=s.lng,l=s.lat,c=i.getTile(u,l);c&&i.getFeatureAndEmitEvent(a,"subLayerMouseMove",o,e,c)}else i.getFeatureAndEmitEvent(a,"subLayerMouseMove",o)}),a.on("mouseup",function(o){i.eventCache.mouseup=1,i.getFeatureAndEmitEvent(a,"subLayerMouseUp",o)}),a.on("mouseenter",function(o){if(i.parentLayer.type==="RasterLayer"){var s=o.lngLat,u=s.lng,l=s.lat,c=i.getTile(u,l);c&&i.getFeatureAndEmitEvent(a,"subLayerMouseMove",o,e,c)}else i.getFeatureAndEmitEvent(a,"subLayerMouseEnter",o)}),a.on("mouseout",function(o){i.getFeatureAndEmitEvent(a,"subLayerMouseOut",o)}),a.on("mousedown",function(o){i.eventCache.mousedown=1,i.getFeatureAndEmitEvent(a,"subLayerMouseDown",o)}),a.on("contextmenu",function(o){i.eventCache.contextmenu=1,i.getFeatureAndEmitEvent(a,"subLayerContextmenu",o)}),a.on("unclick",function(o){return i.handleOutsideEvent("click","subLayerUnClick",a,o)}),a.on("unmouseup",function(o){return i.handleOutsideEvent("mouseup","subLayerUnMouseUp",a,o)}),a.on("unmousedown",function(o){return i.handleOutsideEvent("mousedown","subLayerUnMouseDown",a,o)}),a.on("uncontextmenu",function(o){return i.handleOutsideEvent("contextmenu","subLayerUnContextmenu",a,o)})})})}},{key:"getCombineFeature",value:function(t){var e=null,i=t[0];return t.map(function(a){var o=GM(a.coordinates);e===null&&(e=o),e=VM(e,o)}),i&&(e.properties=U({},i)),e}},{key:"getFeatureAndEmitEvent",value:function(t,e,i,a,o){if(a===!1)i.value=uY(o,this.mapService,i.x,i.y);else{var s=i.featureId,u=this.getAllFeatures(s);try{i.feature=this.getCombineFeature(u)}catch{console.warn("Combine Featuer Err! Return First Feature!"),i.feature=u[0]}}this.parentLayer.emit(e,i)}},{key:"setScale",value:function(t){var e=this.parentLayer.tileLayer.scaleField,i=Object.keys(e);i.map(function(a){t.scale(a,e[a])})}},{key:"getAllFeatures",value:function(t){var e=this.parentLayer.tileLayer.children,i=[];return e.map(function(a){var o=a.getSource();o.data.dataArray.map(function(s){s._id===t&&i.push(s)})}),i}},{key:"getLayerInitOption",value:function(t){var e=U({},t);return delete e.color,delete e.shape,delete e.size,delete e.coords,delete e.sourceLayer,delete e.coords,e}},{key:"handleOutsideEvent",value:function(t,e,i,a){var o=this;this.outSideEventTimer&&(clearTimeout(this.outSideEventTimer),this.outSideEventTimer=null),this.outSideEventTimer=setTimeout(function(){o.eventCache[t]>0?o.eventCache[t]=0:o.getFeatureAndEmitEvent(i,e,a)},64)}}]),r}();function JY(r){var n=tZ();return function(){var e=B(r),i;if(n){var a=B(this).constructor;i=Reflect.construct(e,arguments,a)}else i=e.apply(this,arguments);return et(this,i)}}function tZ(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var eZ=function(r){tt(t,r);var n=JY(t);function t(e){var i;return $(this,t),i=n.call(this,e),i.parentLayer=e.parent,i}return H(t,[{key:"createTile",value:function(i,a){var o=this.getFeatureData(i,a),s=o.features,u=o.vectorTileLayer,l=o.source;if(s.length===0)return{layers:[],layerIDList:[]};var c=this.createLayer({tile:i,initOptions:a,vectorTileLayer:u,source:l});return c.once("modelLoaded",function(){i.layerLoad()}),{layers:[c],layerIDList:[c.id]}}}]),t}(xo);function rZ(r){var n=nZ();return function(){var e=B(r),i;if(n){var a=B(this).constructor;i=Reflect.construct(e,arguments,a)}else i=e.apply(this,arguments);return et(this,i)}}function nZ(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var iZ=function(r){tt(t,r);var n=rZ(t);function t(e){var i;return $(this,t),i=n.call(this,e),i.parentLayer=e.parent,i}return H(t,[{key:"createTile",value:function(i,a){var o=this.getFeatureData(i,a),s=o.features,u=o.vectorTileLayer,l=o.source;if(s.length===0)return{layers:[],layerIDList:[]};var c=this.createLayer({tile:i,initOptions:a,vectorTileLayer:u,source:l,needListen:!1});return c.once("modelLoaded",function(){i.layerLoad()}),{layers:[c],layerIDList:[c.id]}}}]),t}(xo);function aZ(r){var n=oZ();return function(){var e=B(r),i;if(n){var a=B(this).constructor;i=Reflect.construct(e,arguments,a)}else i=e.apply(this,arguments);return et(this,i)}}function oZ(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var sZ=function(r){tt(t,r);var n=aZ(t);function t(e){var i;return $(this,t),i=n.call(this,e),i.parentLayer=e.parent,i}return H(t,[{key:"createTile",value:function(i,a){var o=this.getFeatureData(i,a),s=o.features,u=o.vectorTileLayer,l=o.source;if(s.length===0)return{layers:[],layerIDList:[]};var c=this.createLayer({tile:i,initOptions:a,vectorTileLayer:u,source:l});return c.once("modelLoaded",function(){i.layerLoad()}),{layers:[c],layerIDList:[c.id]}}}]),t}(xo);function uZ(r){var n=lZ();return function(){var e=B(r),i;if(n){var a=B(this).constructor;i=Reflect.construct(e,arguments,a)}else i=e.apply(this,arguments);return et(this,i)}}function lZ(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var I1=function(r){tt(t,r);var n=uZ(t);function t(e){var i;return $(this,t),i=n.call(this,e),i.parentLayer=e.parent,i}return H(t,[{key:"createTile",value:function(i,a){var o=new ya(i.data,{parser:{type:"image",extent:i.bounds}}),s=this.createLayer({L7Layer:ZX,tile:i,initOptions:a,source:o});return s.once("modelLoaded",function(){i.layerLoad()}),{layers:[s],layerIDList:[s.id]}}}]),t}(xo);function cZ(r){var n=fZ();return function(){var e=B(r),i;if(n){var a=B(this).constructor;i=Reflect.construct(e,arguments,a)}else i=e.apply(this,arguments);return et(this,i)}}function fZ(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var hZ=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_min;
uniform float u_max;
uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;
varying vec2 v_texCoord;



// float getBlurIndusty() {
//   vec2 u_ViewportSize = vec2(1024);

//     float vW = 2.0/u_ViewportSize.x;
//     float vH = 2.0/u_ViewportSize.y;
//     vec2 vUv = v_texCoord;
//     float i11 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y + 1.0 * vH) ).r;
//     float i12 = texture2D( u_texture, vec2( vUv.x - 0.0 * vW, vUv.y + 1.0 * vH) ).r;
//     float i13 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y + 1.0 * vH) ).r;

//     float i21 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y) ).r;
//     float i22 = texture2D( u_texture, vec2( vUv.x , vUv.y) ).r;
//     float i23 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y) ).r;

//     float i31 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y-1.0*vH) ).r;
//     float i32 = texture2D( u_texture, vec2( vUv.x - 0.0 * vW, vUv.y-1.0*vH) ).r;
//     float i33 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y-1.0*vH) ).r;

//     return(
//         i11 + 
//         i12 + 
//         i13 + 
//         i21 + 
//         i21 + 
//         i22 + 
//         i23 + 
//         i31 + 
//         i32 + 
//         i33
//         )/9.0;
// }

void main() {

  float value = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).r;

  // float value = getBlurIndusty();


  if (value == u_noDataValue)
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1]))
    gl_FragColor = vec4(0, 0, 0, 0);
  else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] -u_domain[0]);
    vec4 color = texture2D(u_colorTexture,vec2(normalisedValue, 0));
    gl_FragColor = color;
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
  }
}
`,vZ=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));

   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,pZ=function(r){tt(t,r);var n=cZ(t);function t(){return $(this,t),n.apply(this,arguments)}return H(t,[{key:"getUninforms",value:function(){var i=this.rendererService.createTexture2D,a=this.layer.getLayerConfig(),o=a.colorTexture,s=o===void 0?i({data:[],width:0,height:0,flipY:!1}):o,u=a.opacity,l=u===void 0?1:u,c=a.clampLow,f=c===void 0?!0:c,h=a.clampHigh,v=h===void 0?!0:h,p=a.noDataValue,d=p===void 0?-9999999:p,g=a.domain,y=g===void 0?[0,1]:g;return{u_opacity:l||1,u_texture:this.texture,u_domain:y,u_clampLow:f,u_clampHigh:typeof v<"u"?v:f,u_noDataValue:d,u_colorTexture:s}}},{key:"initModels",value:function(i){var a=this.layer.getLayerConfig(),o=a.mask,s=o===void 0?!1:o,u=a.maskInside,l=u===void 0?!0:u,c=this.layer.getSource(),f=this.rendererService.createTexture2D,h=c.data.dataArray[0];this.texture=f({data:h.data,width:h.width,height:h.height,format:A.LUMINANCE,type:A.FLOAT}),this.layer.buildLayerModel({moduleName:"rasterTileImageData",vertexShader:vZ,fragmentShader:hZ,triangulation:Ic,depth:{enable:!1},stencil:le(s,l),pick:!1}).then(function(v){i([v])}).catch(function(v){console.warn(v),i([])})}},{key:"buildModels",value:function(i){this.initModels(i)}},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:nt.Attribute,descriptor:{name:"a_Uv",buffer:{usage:A.DYNAMIC_DRAW,data:[],type:A.FLOAT},size:2,update:function(a,o,s){return[s[3],s[4]]}}})}}]),t}(qt);function dZ(r){var n=gZ();return function(){var e=B(r),i;if(n){var a=B(this).constructor;i=Reflect.construct(e,arguments,a)}else i=e.apply(this,arguments);return et(this,i)}}function gZ(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var yZ=function(r){tt(t,r);var n=dZ(t);function t(){var e;$(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return e=n.call.apply(n,[this].concat(a)),S(I(e),"type",e.layerType),e}return H(t,[{key:"buildModels",value:function(){var i=this,a=this.getModelType();this.layerModel=new a(this),this.layerModel.initModels(function(o){i.dispatchModelLoad(o)})}},{key:"rebuildModels",value:function(){var i=this;this.layerModel.buildModels(function(a){i.dispatchModelLoad(a)})}},{key:"getModelType",value:function(){return pZ}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){return{}}}]),t}(mo);function mZ(r){var n=xZ();return function(){var e=B(r),i;if(n){var a=B(this).constructor;i=Reflect.construct(e,arguments,a)}else i=e.apply(this,arguments);return et(this,i)}}function xZ(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var _Z=function(r){tt(t,r);var n=mZ(t);function t(e){var i;return $(this,t),i=n.call(this,e),i.parentLayer=e.parent,i}return H(t,[{key:"createTile",value:function(i,a){var o=a.colorTexture,s=a.opacity,u=a.domain,l=a.clampHigh,c=a.clampLow,f=a.mask,h=i.data;if(!h.data)return console.warn("raster data not exist!"),{layers:[],layerIDList:[]};var v=new yZ({visible:i.isVisible,mask:f}).source(h.data,{parser:{type:"raster",width:h.width,height:h.height,extent:i.bboxPolygon.bbox}}).style({colorTexture:o,opacity:s,domain:u,clampHigh:l,clampLow:c});return this.emitEvent([v],!1),fd(this.parentLayer,[v]),v.once("modelLoaded",function(){i.layerLoad()}),{layers:[v],layerIDList:[v.id]}}}]),t}(xo);function CZ(r){var n=EZ();return function(){var e=B(r),i;if(n){var a=B(this).constructor;i=Reflect.construct(e,arguments,a)}else i=e.apply(this,arguments);return et(this,i)}}function EZ(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var SZ=function(r){tt(t,r);var n=CZ(t);function t(e){var i;return $(this,t),i=n.call(this,e),i.parentLayer=e.parent,i}return H(t,[{key:"createTile",value:function(i,a){var o=a.sourceLayer;if(!o)return{layers:[],layerIDList:[]};var s=i.data.layers[o],u=s==null?void 0:s.features;if(u.length===0)return{layers:[],layerIDList:[]};var l=u[0].properties,c=new vv({layerType:"PointLayer",usage:"basemap",needListen:!1}).source([l],{parser:{type:"json",x:"textLng",y:"textLat",cancelExtent:!0}}).shape("key","text").style({size:20,color:"#000",stroke:"#fff",strokeWidth:2}),f=new vv({layerType:"LineLayer",usage:"basemap",needListen:!1}).source({type:"FeatureCollection",features:u},{parser:{type:"geojson",cancelExtent:!0}}).shape("simple").style({color:"#000"});return c.isTileLayer=!0,f.isTileLayer=!0,fd(this.parentLayer,[f,c]),c.once("modelLoaded",function(){i.layerLoad()}),f.once("modelLoaded",function(){i.layerLoad()}),{layers:[f,c],layerIDList:[f.id,c.id]}}}]),t}(xo);function bZ(r,n){switch(r){case"PolygonLayer":return sZ;case"LineLayer":return eZ;case"PointLayer":return iZ;case"TileDebugLayer":return SZ;case"RasterLayer":return QW.includes(n.dataType)?_Z:I1;default:return console.warn("Current Tile Not Exist!"),I1}}var OT=function(){function r(){$(this,r)}return H(r,[{key:"createTile",value:function(t){return this.tileFactory.createTile(t,this.initOptions)}},{key:"addChild",value:function(t){this.children.push(t)}},{key:"addChilds",value:function(t){var e;(e=this.children).push.apply(e,it(t))}},{key:"removeChilds",value:function(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,i=[],a=[];this.children.filter(function(o){t.includes(o.id)?i.push(o):a.push(o)}),i.map(function(o){return o.destroy(e)}),this.children=a}},{key:"removeChild",value:function(t){var e=this.children.indexOf(t);e>-1&&this.children.splice(e,1),t.destroy()}},{key:"getChilds",value:function(t){return this.children.filter(function(e){return t.includes(e.id)})}},{key:"getChild",value:function(t){return this.children.filter(function(e){return e.id===t})[0]}},{key:"clearChild",value:function(){this.children.forEach(function(t){t.destroy()}),this.children.slice(0,this.children.length)}},{key:"hasChild",value:function(t){return this.children.includes(t)}},{key:"initTileFactory",value:function(){var t=this.parent.getSource(),e=bZ(this.parent.type,t.parser);this.tileFactory=new e({parent:this.parent,mapService:this.mapService,rendererService:this.rendererService})}},{key:"getSourceLayer",value:function(t,e){return t==="geojsonvt"?"geojsonvt":t==="testTile"?"testTile":e}},{key:"destroy",value:function(){}}]),r}();function AZ(r){var n=TZ();return function(){var e=B(r),i;if(n){var a=B(this).constructor;i=Reflect.construct(e,arguments,a)}else i=e.apply(this,arguments);return et(this,i)}}function TZ(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var MZ=function(r){tt(t,r);var n=AZ(t);function t(){var e;return $(this,t),e=n.call(this),S(I(e),"checkConfigList",[]),e.cacheConfig=new Map,e}return H(t,[{key:"setConfig",value:function(i,a){this.checkConfigList.includes(i)||this.checkConfigList.push(i),this.cacheConfig.set(i,a)}},{key:"removeConfig",value:function(i){var a=this.checkConfigList.indexOf(i);a>-1&&(this.cacheConfig.delete(i),this.checkConfigList.splice(a,1))}},{key:"checkConfig",value:function(i){var a=this;if(!!i.inited){var o=i.getLayerConfig(),s=[];this.checkConfigList.map(function(u){var l=a.cacheConfig.get(u),c;if(["color","size","shape"].includes(u)){var f;c=(f=i.getAttribute(u))===null||f===void 0?void 0:f.scale}else{if(!(u in o))return;c=o[u]}Y.exports.isEqual(l,c)||(s.push(u),a.setConfig(u,c))}),s.length>0&&(console.warn("tile config cache update!",s),this.emit("updateConfig",s))}}},{key:"getAttributeScale",value:function(i,a){var o=i.getAttribute(a),s={field:void 0,values:void 0,callback:void 0};if(o&&o.scale){var u=o.scale,l=u.field,c=u.values,f=u.callback;s.field=l,s.values=c,s.callback=f}return s}}]),t}(Cv);function wZ(r){var n=LZ();return function(){var e=B(r),i;if(n){var a=B(this).constructor;i=Reflect.construct(e,arguments,a)}else i=e.apply(this,arguments);return et(this,i)}}function LZ(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var FZ=function(r){tt(t,r);var n=wZ(t);function t(e,i,a,o){var s;return $(this,t),s=n.call(this),S(I(s),"isLastPicked",!1),s.parent=e,s.rendererService=i,s.pickingService=a,s.children=o,s}return H(t,[{key:"normalRender",value:function(i){var a=this;i.filter(function(o){return o.inited}).filter(function(o){return o.isVisible()}).map(function(o){o.hooks.beforeRenderData.call(),o.hooks.beforeRender.call(),o.masks.length>0&&(a.rendererService.clear({stencil:0,depth:1,framebuffer:null}),o.masks.map(function(s){s.hooks.beforeRenderData.call(),s.hooks.beforeRender.call(),s.render(),s.hooks.afterRender.call()})),o.render(),o.hooks.afterRender.call()})}},{key:"pickRender",value:function(i,a){var o=this;this.parent.type==="RasterLayer"&&this.renderMask(this.parent);var s=i.filter(function(u){return o.parent.needPick(a.type)&&u.inited&&u.isVisible()}).some(function(u){u.hooks.beforePickingEncode.call(),u.masks.length>0&&(o.rendererService.clear({stencil:0,depth:1,framebuffer:null}),u.masks.map(function(c){c.hooks.beforeRender.call(),c.render(),c.hooks.afterRender.call()})),u.renderModels(!0),u.hooks.afterPickingEncode.call();var l=o.pickingService.pickFromPickingFBO(u,a);return l&&o.parent.type!=="RasterLayer"&&(o.emit("pick",{type:a.type,pickedColors:o.pickingService.pickedColors,layer:u}),o.pickingService.pickedTileLayers=[o.parent]),l});return this.parent.type!=="RasterLayer"&&!s&&this.isLastPicked&&a.type!=="click"&&(this.pickingService.pickedTileLayers=[],this.emit("unpick",{}),this.beforeHighlight([0,0,0])),this.isLastPicked=s,s}},{key:"clearPick",value:function(){this.children.filter(function(i){return i.inited&&i.isVisible()}).map(function(i){i.hooks.beforeSelect.call([0,0,0])}),this.pickingService.pickedTileLayers=[]}},{key:"beforeHighlight",value:function(i){this.children.filter(function(a){return a.inited&&a.isVisible()}).map(function(a){a.hooks.beforeHighlight.call(i)})}},{key:"beforeSelect",value:function(i){this.children.filter(function(a){return a.inited&&a.isVisible()}).map(function(a){a.hooks.beforeSelect.call(i)})}},{key:"renderMask",value:function(i){i.inited&&i.isVisible()&&(i.hooks.beforeRender.call(),i.masks.length>0&&(this.rendererService.clear({stencil:0,depth:1,framebuffer:null}),i.masks.map(function(a){a.hooks.beforeRender.call(),a.render(),a.hooks.afterRender.call()})),i.hooks.afterRender.call())}},{key:"destroy",value:function(){this.removeAllListeners()}}]),t}(dn.exports.EventEmitter);function kZ(r){var n=OZ();return function(){var e=B(r),i;if(n){var a=B(this).constructor;i=Reflect.construct(e,arguments,a)}else i=e.apply(this,arguments);return et(this,i)}}function OZ(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var RZ=function(r){tt(t,r);var n=kZ(t);function t(e,i,a,o,s){var u;return $(this,t),u=n.call(this),u.parent=e,u.children=e.layerChildren,u.mapService=i,u.rendererService=a,u.transforms=s,u.tilePickManager=new FZ(e,a,o,u.children),u.tileConfigManager=new MZ,u.setSubLayerInitOption(),u.setConfigListener(),u.initTileFactory(),u}return H(t,[{key:"render",value:function(){var i,a;(i=this.tileConfigManager)===null||i===void 0||i.checkConfig(this.parent),(a=this.tilePickManager)===null||a===void 0||a.normalRender(this.children)}},{key:"pickLayers",value:function(i){var a;return(a=this.tilePickManager)===null||a===void 0?void 0:a.pickRender(this.children,i)}},{key:"setSubLayerInitOption",value:function(){var i,a=this.parent.getLayerConfig(),o=a.zIndex,s=o===void 0?0:o,u=a.opacity,l=u===void 0?1:u,c=a.mask,f=c===void 0?!1:c,h=a.stroke,v=h===void 0?"#fff":h,p=a.strokeWidth,d=p===void 0?0:p,g=a.strokeOpacity,y=g===void 0?1:g,m=a.clampLow,x=m===void 0?!0:m,_=a.clampHigh,E=_===void 0?!0:_,b=a.domain,M=b===void 0?[0,1]:b,T=a.rampColors,k=T===void 0?{colors:["rgb(166,97,26)","rgb(223,194,125)","rgb(245,245,245)","rgb(128,205,193)","rgb(1,133,113)"],positions:[0,.25,.5,.75,1]}:T,L=a.featureId,O=L===void 0?"id":L,D=a.workerEnabled,W=D===void 0?!1:D,j=a.sourceLayer,ot=a.pixelConstant,z=ot===void 0?0:ot,X=a.pixelConstantR,K=X===void 0?256*256:X,Q=a.pixelConstantG,q=Q===void 0?256:Q,at=a.pixelConstantB,pt=at===void 0?1:at,mt=a.pixelConstantRGB,ft=mt===void 0?.1:mt,vt=this.tileConfigManager.getAttributeScale(this.parent,"color"),Lt=this.tileConfigManager.getAttributeScale(this.parent,"size"),jt=this.parent.getSource(),Jt=(jt==null||(i=jt.data)===null||i===void 0?void 0:i.tilesetOptions)||{},xe=Jt.coords,Nr=jt.getParserType(),zr=hd(this.parent.type,this.parent);if(this.initOptions={layerType:this.parent.type,transforms:this.transforms,shape:zr,zIndex:s,opacity:l,sourceLayer:this.getSourceLayer(Nr,j),coords:xe,featureId:O,color:vt,size:Lt,mask:ET(this.parent.type,f),stroke:v,strokeWidth:d,strokeOpacity:y,clampLow:x,clampHigh:E,domain:M,rampColors:k,workerEnabled:W,pixelConstant:z,pixelConstantR:K,pixelConstantG:q,pixelConstantB:pt,pixelConstantRGB:ft},k){var Ur=this.rendererService.createTexture2D,Hr=Ls(k),Qr=Ur({data:Hr.data,width:Hr.width,height:Hr.height,flipY:!1});this.initOptions.colorTexture=Qr}}},{key:"setConfigListener",value:function(){var i=this;if(this.tileConfigManager.setConfig("opacity",this.initOptions.opacity),this.tileConfigManager.setConfig("zIndex",this.initOptions.zIndex),this.tileConfigManager.setConfig("mask",this.initOptions.mask),this.parent.type==="RasterLayer")this.tileConfigManager.setConfig("rampColors",this.initOptions.rampColors),this.tileConfigManager.setConfig("domain",this.initOptions.domain),this.tileConfigManager.setConfig("clampHigh",this.initOptions.clampHigh),this.tileConfigManager.setConfig("clampLow",this.initOptions.clampLow),this.tileConfigManager.setConfig("pixelConstant",this.initOptions.pixelConstant),this.tileConfigManager.setConfig("pixelConstantR",this.initOptions.pixelConstantR),this.tileConfigManager.setConfig("pixelConstantG",this.initOptions.pixelConstantG),this.tileConfigManager.setConfig("pixelConstantB",this.initOptions.pixelConstantB),this.tileConfigManager.setConfig("pixelConstantRGB",this.initOptions.pixelConstantRGB);else{var a,o,s;this.tileConfigManager.setConfig("stroke",this.initOptions.stroke),this.tileConfigManager.setConfig("strokeWidth",this.initOptions.strokeWidth),this.tileConfigManager.setConfig("strokeOpacity",this.initOptions.strokeOpacity),this.tileConfigManager.setConfig("color",(a=this.parent.getAttribute("color"))===null||a===void 0?void 0:a.scale),this.tileConfigManager.setConfig("shape",(o=this.parent.getAttribute("shape"))===null||o===void 0?void 0:o.scale),this.tileConfigManager.setConfig("size",(s=this.parent.getAttribute("size"))===null||s===void 0?void 0:s.scale)}this.tileConfigManager.on("updateConfig",function(u){u.map(function(l){return i.updateStyle(l),""})})}},{key:"updateStyle",value:function(i){var a=this,o=null;if(["size","color","shape"].includes(i)){var s,u=(s=this.parent.getAttribute(i))===null||s===void 0?void 0:s.scale;if(!u)return;o=u,this.children.map(function(v){return a.tileFactory.setStyleAttributeField(v,i,u),""})}else{var l=this.parent.getLayerConfig();if(!(i in l))return;var c=l[i];if(o=c,Ml(this.children,i,c),i==="rampColors"&&c){var f=this.rendererService.createTexture2D,h=Ls(c);this.initOptions.colorTexture=f({data:h.data,width:h.width,height:h.height,flipY:!1}),Ml(this.children,"colorTexture",this.initOptions.colorTexture)}}this.initOptions[i]=o}},{key:"destroy",value:function(){this.tilePickManager.destroy()}}]),t}(OT),IZ=function(){function r(n){var t,e=n.parent,i=n.rendererService,a=n.mapService,o=n.layerService,s=n.pickingService,u=n.transforms;$(this,r),S(this,"type","baseTile"),S(this,"initedTileset",!1),S(this,"pickColors",{select:null,active:null}),S(this,"viewchange",Y.exports.debounce(this.mapchange,200));var l=e.getSource(),c=(l==null||(t=l.data)===null||t===void 0?void 0:t.tilesetOptions)||{},f=c.sourceLayer;this.sourceLayer=f,this.parent=e,this.mapService=a,this.layerService=o,this.tileLayerManager=new RZ(e,a,i,s,u),this.initTileSetManager(),this.bindSubLayerEvent(),this.bindSubLayerPick(),this.scaleField=this.parent.getScaleOptions()}return H(r,[{key:"children",get:function(){return this.tileLayerManager.children}},{key:"render",value:function(){this.tileLayerManager&&this.tileLayerManager.render()}},{key:"clearPick",value:function(t){t==="mousemove"&&this.tileLayerManager.tilePickManager.clearPick()}},{key:"clearPickState",value:function(){var t=this;this.children.filter(function(e){return e.inited&&e.isVisible()}).filter(function(e){return e.getCurrentSelectedId()!==null}).map(function(e){t.selectFeature(e,new Uint8Array([0,0,0,0])),e.setCurrentSelectedId(null)})}},{key:"pickLayers",value:function(t){return this.tileLayerManager.pickLayers(t)}},{key:"tileLoaded",value:function(t){}},{key:"tileError",value:function(t){console.warn("error:",t)}},{key:"tileUnLoad",value:function(t){this.tileLayerManager.removeChilds(t.layerIDList,!1)}},{key:"tileUpdate",value:function(){!this.tilesetManager||this.tilesetManager.isLoaded&&this.parent.emit("tiles-loaded",this.tilesetManager.currentTiles)}},{key:"setPickState",value:function(t){var e=this;if(this.pickColors.select){var i=cn(this.pickColors.select);t.map(function(o){e.selectFeature(o,e.pickColors.select),o.setCurrentSelectedId(i)})}if(this.pickColors.active){var a=cn(this.pickColors.active);t.filter(function(o){return o.inited&&o.isVisible()}).map(function(o){o.hooks.beforeHighlight.call(e.pickColors.active),o.setCurrentPickId(a)})}}},{key:"bindSubLayerPick",value:function(){var t=this;this.tileLayerManager.tilePickManager.on("pick",function(e){var i=kt(e.pickedColors,3),a=i[0],o=i[1],s=i[2];if(e.type==="click"){var u=t.children.filter(function(l){return l.inited&&l.isVisible()&&l.isVector}).filter(function(l){return l!==e.layer});t.setSelect(u,[a,o,s])}else t.setHighlight([a,o,s])}),this.tileLayerManager.tilePickManager.on("unpick",function(){t.pickColors.active=null})}},{key:"setHighlight",value:function(t){var e=cn(t);this.pickColors.active=t,this.children.filter(function(i){return i.inited&&i.isVisible()&&i.isVector}).filter(function(i){return i.getPickID()!==e}).map(function(i){i.setPickID(e),i.hooks.beforeHighlight.call(t)})}},{key:"setSelect",value:function(t,e){var i=this,a=cn(e);t.map(function(s){s.getCurrentSelectedId()===null||a!==s.getCurrentSelectedId()?(i.selectFeature(s,e),s.setCurrentSelectedId(a),i.pickColors.select=e):(i.selectFeature(s,new Uint8Array([0,0,0,0])),s.setCurrentSelectedId(null),i.pickColors.select=null)});var o=this.layerService.getRenderList();o.filter(function(s){return s.inited&&!s.isVector&&s.isVisible()&&s.needPick("click")}).filter(function(s){return s.getCurrentSelectedId()!==null}).map(function(s){i.selectFeature(s,new Uint8Array([0,0,0,0])),s.setCurrentSelectedId(null)})}},{key:"selectFeature",value:function(t,e){var i=kt(e,3),a=i[0],o=i[1],s=i[2];t.hooks.beforeSelect.call([a,o,s])}},{key:"bindSubLayerEvent",value:function(){var t=this;this.parent.on("subLayerClick",function(e){t.parent.emit("click",U({},e))}),this.parent.on("subLayerMouseMove",function(e){return t.parent.emit("mousemove",U({},e))}),this.parent.on("subLayerMouseUp",function(e){return t.parent.emit("mouseup",U({},e))}),this.parent.on("subLayerMouseEnter",function(e){return t.parent.emit("mouseenter",U({},e))}),this.parent.on("subLayerMouseOut",function(e){return t.parent.emit("mouseout",U({},e))}),this.parent.on("subLayerMouseDown",function(e){return t.parent.emit("mousedown",U({},e))}),this.parent.on("subLayerContextmenu",function(e){return t.parent.emit("contextmenu",U({},e))}),this.parent.on("subLayerUnClick",function(e){return t.parent.emit("unclick",U({},e))}),this.parent.on("subLayerUnMouseMove",function(e){return t.parent.emit("unmousemove",U({},e))}),this.parent.on("subLayerUnMouseUp",function(e){return t.parent.emit("unmouseup",U({},e))}),this.parent.on("subLayerUnMouseDown",function(e){return t.parent.emit("unmousedown",U({},e))}),this.parent.on("subLayerUnContextmenu",function(e){return t.parent.emit("uncontextmenu",U({},e))})}},{key:"initTileSetManager",value:function(){var t,e=this.parent.getSource();this.tilesetManager=e.tileset,this.initedTileset||(this.bindTilesetEvent(),this.initedTileset=!0);var i=this.getCurrentView(),a=i.latLonBounds,o=i.zoom;(t=this.tilesetManager)===null||t===void 0||t.update(o,a)}},{key:"mapchange",value:function(){var t,e=this.getCurrentView(),i=e.latLonBounds,a=e.zoom;if(this.mapService.version==="GAODE1.x"){var o=this.parent.getLayerConfig(),s=o.visible;a<3&&s?(this.parent.updateLayerConfig({visible:!1}),this.layerService.reRender()):a>=3&&!s&&(this.parent.updateLayerConfig({visible:!0}),this.layerService.reRender())}this.lastViewStates&&this.lastViewStates.zoom===a&&this.lastViewStates.latLonBounds.toString()===i.toString()||(this.lastViewStates={zoom:a,latLonBounds:i},(t=this.tilesetManager)===null||t===void 0||t.throttleUpdate(a,i))}},{key:"bindTilesetEvent",value:function(){var t=this;!this.tilesetManager||(this.tilesetManager.on("tile-loaded",function(e){}),this.tilesetManager.on("tile-unload",function(e){t.tileUnLoad(e)}),this.tilesetManager.on("tile-error",function(e,i){t.tileError(e)}),this.tilesetManager.on("tile-update",function(){t.tileUpdate()}),this.mapService.on("zoomend",function(){return t.viewchange()}),this.mapService.on("moveend",function(){return t.viewchange()}))}},{key:"getCurrentView",value:function(){var t=this.mapService.getBounds(),e=[t[0][0],t[0][1],t[1][0],t[1][1]],i=this.mapService.getZoom();return{latLonBounds:e,zoom:i}}},{key:"destroy",value:function(){var t;(t=this.tilesetManager)===null||t===void 0||t.destroy(),this.tileLayerManager.destroy()}}]),r}();function DZ(r){var n=PZ();return function(){var e=B(r),i;if(n){var a=B(this).constructor;i=Reflect.construct(e,arguments,a)}else i=e.apply(this,arguments);return et(this,i)}}function PZ(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var BZ=function(r){tt(t,r);var n=DZ(t);function t(){var e;$(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return e=n.call.apply(n,[this].concat(a)),S(I(e),"type","TMS"),e}return H(t,[{key:"tileUnLoad",value:function(i){this.tileLayerManager.removeChilds(i.layerIDList,!1)}},{key:"tileUpdate",value:function(){var i=this;!this.tilesetManager||(this.tilesetManager.tiles.filter(function(a){return a.isLoaded}).map(function(a){var o;if((o=a.data)!==null&&o!==void 0&&o.layers&&i.sourceLayer){var s=a.data.layers[i.sourceLayer],u=s==null?void 0:s.features;if(!(Array.isArray(u)&&u.length>0))return}if(a.parentLayerIDList.includes(i.parent.id)){if(!a.isVisibleChange)return;var v=i.tileLayerManager.getChilds(a.layerIDList);ST(a,v,i.layerService),i.setPickState(v)}else{var l,c=i.tileLayerManager.createTile(a),f=c.layers,h=c.layerIDList;a.parentLayerIDList.push(i.parent.id),(l=a.layerIDList).push.apply(l,it(h)),i.tileLayerManager.addChilds(f),i.setPickState(f)}}),this.tilesetManager.isLoaded&&this.parent.emit("tiles-loaded",this.tilesetManager.currentTiles))}}]),t}(IZ);function NZ(r){var n=zZ();return function(){var e=B(r),i;if(n){var a=B(this).constructor;i=Reflect.construct(e,arguments,a)}else i=e.apply(this,arguments);return et(this,i)}}function zZ(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var UZ=function(r){tt(t,r);var n=NZ(t);function t(e,i,a){var o;return $(this,t),o=n.call(this),o.parent=e,o.children=e.layerChildren,o.mapService=i,o.rendererService=a,o.setSubLayerInitOption(),o.initTileFactory(),o}return H(t,[{key:"render",value:function(){var i=this;this.children.filter(function(a){return a.inited}).filter(function(a){return a.isVisible()}).map(function(a){a.hooks.beforeRenderData.call(),a.hooks.beforeRender.call(),a.masks.length>0&&(i.rendererService.clear({stencil:0,depth:1,framebuffer:null}),a.masks.map(function(o){o.hooks.beforeRenderData.call(),o.hooks.beforeRender.call(),o.render(),o.hooks.afterRender.call()})),a.render(),a.hooks.afterRender.call()})}},{key:"setSubLayerInitOption",value:function(){var i,a,o=this.parent.getLayerConfig(),s=o.zIndex,u=s===void 0?0:s,l=o.opacity,c=l===void 0?1:l,f=o.mask,h=f===void 0?!1:f,v=o.stroke,p=v===void 0?"#fff":v,d=o.strokeWidth,g=d===void 0?0:d,y=o.strokeOpacity,m=y===void 0?1:y,x=o.workerEnabled,_=x===void 0?!1:x,E=o.sourceLayer,b=this.parent.getSource(),M=b.getParserType(),T=this.parent.getAttribute("color"),k=(T==null||(i=T.scale)===null||i===void 0?void 0:i.field)||"#fff",L=this.parent.getAttribute("size"),O=(L==null||(a=L.scale)===null||a===void 0?void 0:a.field)||1,D=hd(this.parent.type,this.parent);this.initOptions={usage:"basemap",layerType:this.parent.type,shape:D,zIndex:u,opacity:c,sourceLayer:this.getSourceLayer(M,E),basemapColor:k,basemapSize:O,mask:ET(this.parent.type,h),stroke:p,strokeWidth:g,strokeOpacity:m,workerEnabled:_}}}]),t}(OT),HZ=function(){function r(n){var t,e=n.parent,i=n.rendererService,a=n.mapService,o=n.layerService;$(this,r),S(this,"type","baseTile"),S(this,"initedTileset",!1),S(this,"viewchange",Y.exports.debounce(this.mapchange,200));var s=e.getSource(),u=(s==null||(t=s.data)===null||t===void 0?void 0:t.tilesetOptions)||{},l=u.sourceLayer;this.sourceLayer=l,this.parent=e,this.mapService=a,this.layerService=o,this.tileLayerManager=new UZ(e,a,i),this.initTileSetManager()}return H(r,[{key:"children",get:function(){return this.tileLayerManager.children}},{key:"render",value:function(){this.tileLayerManager&&this.tileLayerManager.render()}},{key:"tileLoaded",value:function(t){}},{key:"tileError",value:function(t){console.warn("error:",t)}},{key:"tileUnLoad",value:function(t){this.tileLayerManager.removeChilds(t.layerIDList,!1)}},{key:"tileUpdate",value:function(){!this.tilesetManager||this.tilesetManager.isLoaded&&this.parent.emit("tiles-loaded",this.tilesetManager.currentTiles)}},{key:"initTileSetManager",value:function(){var t,e=this.parent.getSource();this.tilesetManager=e.tileset,this.initedTileset||(this.bindTilesetEvent(),this.initedTileset=!0);var i=this.getCurrentView(),a=i.latLonBounds,o=i.zoom;(t=this.tilesetManager)===null||t===void 0||t.update(o,a)}},{key:"mapchange",value:function(){var t,e=this.getCurrentView(),i=e.latLonBounds,a=e.zoom;if(this.mapService.version==="GAODE1.x"){var o=this.parent.getLayerConfig(),s=o.visible;a<3&&s?(this.parent.updateLayerConfig({visible:!1}),this.layerService.reRender()):a>=3&&!s&&(this.parent.updateLayerConfig({visible:!0}),this.layerService.reRender())}this.lastViewStates&&this.lastViewStates.zoom===a&&this.lastViewStates.latLonBounds.toString()===i.toString()||(this.lastViewStates={zoom:a,latLonBounds:i},(t=this.tilesetManager)===null||t===void 0||t.throttleUpdate(a,i))}},{key:"bindTilesetEvent",value:function(){var t=this;!this.tilesetManager||(this.tilesetManager.on("tile-loaded",function(e){}),this.tilesetManager.on("tile-unload",function(e){t.tileUnLoad(e)}),this.tilesetManager.on("tile-error",function(e,i){t.tileError(e)}),this.tilesetManager.on("tile-update",function(){t.tileUpdate()}),this.mapService.on("zoomend",function(){return t.viewchange()}),this.mapService.on("moveend",function(){return t.viewchange()}))}},{key:"getCurrentView",value:function(){var t=this.mapService.getBounds(),e=[t[0][0],t[0][1],t[1][0],t[1][1]],i=this.mapService.getZoom();return{latLonBounds:e,zoom:i}}},{key:"destroy",value:function(){var t;(t=this.tilesetManager)===null||t===void 0||t.destroy()}}]),r}();function $Z(r){var n=GZ();return function(){var e=B(r),i;if(n){var a=B(this).constructor;i=Reflect.construct(e,arguments,a)}else i=e.apply(this,arguments);return et(this,i)}}function GZ(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var VZ=function(r){tt(t,r);var n=$Z(t);function t(){var e;$(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return e=n.call.apply(n,[this].concat(a)),S(I(e),"type","BaseMapTMS"),e}return H(t,[{key:"tileUnLoad",value:function(i){this.tileLayerManager.removeChilds(i.layerIDList,!1)}},{key:"tileUpdate",value:function(){var i=this;!this.tilesetManager||(this.tilesetManager.tiles.filter(function(a){return a.isLoaded}).map(function(a){var o;if((o=a.data)!==null&&o!==void 0&&o.layers&&i.sourceLayer){var s=a.data.layers[i.sourceLayer],u=s==null?void 0:s.features;if(!(Array.isArray(u)&&u.length>0))return}if(a.parentLayerIDList.includes(i.parent.id)){if(!a.isVisibleChange)return;var v=i.tileLayerManager.getChilds(a.layerIDList);ST(a,v,i.layerService)}else{var l,c=i.tileLayerManager.createTile(a),f=c.layers,h=c.layerIDList;a.parentLayerIDList.push(i.parent.id),(l=a.layerIDList).push.apply(l,it(h)),i.tileLayerManager.addChilds(f)}}),this.tilesetManager.isLoaded&&this.parent.emit("tiles-loaded",this.tilesetManager.currentTiles))}}]),t}(HZ);function WZ(r){var n=jZ();return function(){var e=B(r),i;if(n){var a=B(this).constructor;i=Reflect.construct(e,arguments,a)}else i=e.apply(this,arguments);return et(this,i)}}function jZ(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var RT=function(r){tt(t,r);var n=WZ(t);function t(){return $(this,t),n.apply(this,arguments)}return H(t,[{key:"getUninforms",value:function(){return{}}},{key:"getTileLayer",value:function(i){switch(i){case"basemap":return VZ;default:return BZ}}},{key:"initModels",value:function(){var i=this.layer.getSource(),a=this.layer.getLayerConfig(),o=a.usage;if(i!=null&&i.data.isTile&&!this.layer.tileLayer){var s=this.getTileLayer(o);this.layer.tileLayer=new s({parent:this.layer,rendererService:this.rendererService,mapService:this.mapService,layerService:this.layerService,pickingService:this.pickingService,transforms:i.transforms})}return this.buildModels()}},{key:"clearModels",value:function(){}},{key:"buildModels",value:function(){return[]}},{key:"registerBuiltinAttributes",value:function(){}}]),t}(qt);function XZ(r){var n=YZ();return function(){var e=B(r),i;if(n){var a=B(this).constructor;i=Reflect.construct(e,arguments,a)}else i=e.apply(this,arguments);return et(this,i)}}function YZ(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var ZZ=`
uniform float u_opacity;

varying vec4 v_dash_array;
varying vec4 v_color;

uniform float segmentNumber;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].b; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u6BD4\u4F8B

  gl_FragColor = v_color;
  gl_FragColor.a *= opacity;

  float flag = 0.;
  float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
    flag = 1.;
  };
  gl_FragColor.a *=flag;
  
  gl_FragColor = filterColor(gl_FragColor);
}`,qZ=`
attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
varying vec4 v_color;


uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_lineDir: 1.0;
varying vec4 v_dash_array;

uniform float u_thetaOffset: 0.314;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
  // dash: index / (segmentNumber - 1.);
  // normal: smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
  return index / (segmentNumber - 1.);
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);

  vec2 s = source;
  vec2 t = target;
  
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    s = unProjCustomCoord(source);
    t = unProjCustomCoord(target);
  }
  float total_Distance = pixelDistance(s, t) / 2.0 * PI;
  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / total_Distance;

  styleMappingMat[3].b = segmentIndex / segmentNumber;

  // styleMappingMat[0][1] - arcThetaOffset
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  gl_PointSize = 5.0;
  setPickingColor(a_PickingColor);
}
`,KZ=`
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying vec2 v_iconMapUV;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_segmentIndex = styleMappingMat[3].r;   // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  float d_distance_ratio = styleMappingMat[3].b; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u6BD4\u4F8B

  gl_FragColor = v_color;
  
  gl_FragColor.a *= opacity;

  if(u_animate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }

  // \u5F53\u5B58\u5728\u8D34\u56FE\u65F6\u5728\u5E95\u8272\u4E0A\u8D34\u4E0A\u8D34\u56FE
  if(u_line_texture == LineTexture) { // while load texture
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / segmentNumber));
    // float arcRadio = smoothstep( 0.0, 1.0, d_distance_ratio);

    float count = styleMappingMat[3].g; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_animate.x == Animate) {
      time = u_time / u_animate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);
    float v = styleMappingMat[3].a; // \u6A2A\u5411 v
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;

    vec4 pattern = texture2D(u_texture, uv);

    if(u_animate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_animate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
    
  } else {
     gl_FragColor = filterColor(gl_FragColor);
  }
}`,QZ=`#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
varying vec4 v_color;

uniform float u_lineDir: 1.0;

uniform float u_thetaOffset: 0.314;
uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    // dash: index / (segmentNumber - 1.);
    // normal: smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
    //  return index / (segmentNumber - 1.);
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;
  
  if(u_animate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
      if(u_lineDir != 1.0) {
        d_distance_ratio = 1.0 - d_distance_ratio;
      }
  }

   styleMappingMat[3].b = d_distance_ratio;

  // styleMappingMat[0][1] - arcThetaOffset
  float arcThetaOffset = styleMappingMat[0][1];
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, arcThetaOffset), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, arcThetaOffset), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  styleMappingMat[3].r = d_segmentIndex;

  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F

    float arcDistrance = length(source - target); // \u8D77\u59CB\u70B9\u548C\u7EC8\u70B9\u7684\u8DDD\u79BB
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      arcDistrance *= 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      // arcDistrance *= 8.0;
      arcDistrance = project_pixel_allmap(arcDistrance);
    }
    v_iconMapUV = a_iconMapUV;

    float pixelLen = project_pixel_texture(u_icon_step); // \u8D34\u56FE\u6CBF\u5F27\u7EBF\u65B9\u5411\u7684\u957F\u5EA6 - \u968F\u5730\u56FE\u7F29\u653E\u6539\u53D8
    float texCount = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
     styleMappingMat[3].g = texCount;

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size); // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB
     styleMappingMat[3].a = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,JZ=`#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying vec2 v_iconMapUV;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float d_segmentIndex = styleMappingMat[3].r;   // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}`,tq=`
attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
varying vec4 v_color;

uniform float u_lineDir: 1.0;

uniform float u_thetaOffset: 0.314;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;

   styleMappingMat[3].b = d_distance_ratio;

  // styleMappingMat[0][1] - arcThetaOffset
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  styleMappingMat[3].r = d_segmentIndex;

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,eq={solid:0,dash:1},rq=function(r){tt(t,r);var n=XZ(t);function t(){var e;$(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return e=n.call.apply(n,[this].concat(a)),S(I(e),"updateTexture",function(){var s=e.rendererService.createTexture2D;if(e.texture){e.texture.update({data:e.iconService.getCanvas()}),e.layer.render();return}e.texture=s({data:e.iconService.getCanvas(),mag:A.NEAREST,min:A.NEAREST,premultiplyAlpha:!1,width:1024,height:e.iconService.canvasHeight||128})}),e}return H(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=a===void 0?1:a,s=i.sourceColor,u=i.targetColor,l=i.textureBlend,c=l===void 0?"normal":l,f=i.lineType,h=f===void 0?"solid":f,v=i.dashArray,p=v===void 0?[10,5]:v,d=i.forward,g=d===void 0?!0:d,y=i.lineTexture,m=y===void 0?!1:y,x=i.iconStep,_=x===void 0?100:x,E=i.segmentNumber,b=E===void 0?30:E,M=i.thetaOffset,T=M===void 0?.314:M;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:o,thetaOffset:T})){this.judgeStyleAttributes({opacity:o,thetaOffset:T});var k=this.layer.getEncodedData(),L=this.calDataFrame(this.cellLength,k,this.cellProperties),O=L.data,D=L.width,W=L.height;this.rowCount=W,this.dataTexture=this.cellLength>0&&O.length>0?this.createTexture2D({flipY:!0,data:O,format:A.LUMINANCE,type:A.FLOAT,width:D,height:W}):this.createTexture2D({flipY:!0,data:[1],format:A.LUMINANCE,type:A.FLOAT,width:1,height:1})}p.length===2&&p.push(0,0);var j=0,ot=[0,0,0,0],z=[0,0,0,0];return s&&u&&(ot=Ut(s),z=Ut(u),j=1),this.rendererService.getDirty()&&this.texture.bind(),{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_thetaOffset:Y.exports.isNumber(T)?T:0,u_opacity:Y.exports.isNumber(o)?o:1,u_textureBlend:c==="normal"?0:1,segmentNumber:b,u_line_type:eq[h||"solid"],u_dash_array:p,u_blur:.9,u_lineDir:g?1:-1,u_texture:this.texture,u_line_texture:m?1:0,u_icon_step:_,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:j,u_sourceColor:ot,u_targetColor:z}}},{key:"getAnimateUniforms",value:function(){var i=this.layer.getLayerConfig(),a=i.animateOption;return{u_animate:this.animateOption2Array(a),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(i){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels(i)}},{key:"clearModels",value:function(){var i,a;(i=this.texture)===null||i===void 0||i.destroy(),(a=this.dataTexture)===null||a===void 0||a.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var i=this.layer.getLayerConfig(),a=i.sourceColor,o=i.targetColor,s=i.lineType;return s==="dash"?{frag:ZZ,vert:qZ,type:"Dash"}:a&&o?{frag:JZ,vert:tq,type:"Linear"}:{frag:KZ,vert:QZ,type:""}}},{key:"buildModels",value:function(i){var a=this.layer.getLayerConfig(),o=a.segmentNumber,s=o===void 0?30:o,u=a.mask,l=u===void 0?!1:u,c=a.maskInside,f=c===void 0?!0:c,h=this.getShaders(),v=h.frag,p=h.vert,d=h.type;this.layer.buildLayerModel({moduleName:"lineArc2d"+d,vertexShader:p,fragmentShader:v,triangulation:Dc,depth:{enable:!1},blend:this.getBlend(),segmentNumber:s,stencil:le(l,f)}).then(function(g){i([g])}).catch(function(g){console.warn(g),i([])})}},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:nt.Attribute,descriptor:{name:"a_Size",buffer:{usage:A.DYNAMIC_DRAW,data:[],type:A.FLOAT},size:1,update:function(o){var s=o.size,u=s===void 0?1:s;return Array.isArray(u)?[u[0]]:[u]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:nt.Attribute,descriptor:{name:"a_Instance",buffer:{usage:A.STATIC_DRAW,data:[],type:A.FLOAT},size:4,update:function(o,s,u){return[u[3],u[4],u[5],u[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:nt.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:A.DYNAMIC_DRAW,data:[],type:A.FLOAT},size:2,update:function(o){var s=i.iconService.getIconMap(),u=o.texture,l=s[u]||{x:0,y:0},c=l.x,f=l.y;return[c,f]}}})}}]),t}(qt);function nq(r){var n=iq();return function(){var e=B(r),i;if(n){var a=B(this).constructor;i=Reflect.construct(e,arguments,a)}else i=e.apply(this,arguments);return et(this,i)}}function iq(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var aq=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying float v_segmentIndex;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;

  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_animate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);

      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_animate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_animate.x == Animate) {
      time = u_time / u_animate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);

    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    if(u_animate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_animate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          gl_FragColor = filterColor(pattern);
        }
    }

  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,oq=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
varying vec4 v_color;

uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_animate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,sq=`
#define Animate 0.0

uniform float u_opacity;
uniform float u_blur : 0.9;
varying float v_segmentIndex;
uniform float segmentNumber;

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);

  gl_FragColor.a *= opacity;

  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);

      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_animate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,uq=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;
attribute vec2 a_iconMapUV;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
uniform float u_opacity: 1.0;

varying vec4 v_dash_array;
varying vec4 v_color;
varying float v_segmentIndex;
varying vec2 v_iconMapUV;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143


#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_animate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,lq={solid:0,dash:1},cq=function(r){tt(t,r);var n=nq(t);function t(){var e;$(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return e=n.call.apply(n,[this].concat(a)),S(I(e),"updateTexture",function(){var s=e.rendererService.createTexture2D;if(e.texture){e.texture.update({data:e.iconService.getCanvas()}),e.layer.render();return}e.texture=s({data:e.iconService.getCanvas(),mag:A.NEAREST,min:A.NEAREST,premultiplyAlpha:!1,width:1024,height:e.iconService.canvasHeight||128})}),e}return H(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=a===void 0?1:a,s=i.sourceColor,u=i.targetColor,l=i.textureBlend,c=l===void 0?"normal":l,f=i.lineType,h=f===void 0?"solid":f,v=i.dashArray,p=v===void 0?[10,5]:v,d=i.lineTexture,g=d===void 0?!1:d,y=i.iconStep,m=y===void 0?100:y,x=i.segmentNumber,_=x===void 0?30:x,E=i.globalArcHeight,b=E===void 0?10:E;p.length===2&&p.push(0,0);var M=0,T=[0,0,0,0],k=[0,0,0,0];if(s&&u&&(T=Ut(s),k=Ut(u),M=1),this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:o})){this.judgeStyleAttributes({opacity:o});var L=this.layer.getEncodedData(),O=this.calDataFrame(this.cellLength,L,this.cellProperties),D=O.data,W=O.width,j=O.height;this.rowCount=j,this.dataTexture=this.cellLength>0&&D.length>0?this.createTexture2D({flipY:!0,data:D,format:A.LUMINANCE,type:A.FLOAT,width:W,height:j}):this.createTexture2D({flipY:!0,data:[1],format:A.LUMINANCE,type:A.FLOAT,width:1,height:1})}return{u_globel:this.mapService.version==="GLOBEL"?1:0,u_globel_radius:cd,u_global_height:b,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Y.exports.isNumber(o)?o:1,u_textureBlend:c==="normal"?0:1,segmentNumber:_,u_line_type:lq[h]||0,u_dash_array:p,u_texture:this.texture,u_line_texture:g?1:0,u_icon_step:m,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:M,u_sourceColor:T,u_targetColor:k}}},{key:"getAnimateUniforms",value:function(){var i=this.layer.getLayerConfig(),a=i.animateOption;return{u_animate:this.animateOption2Array(a),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(i){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels(i)}},{key:"clearModels",value:function(){var i,a;(i=this.texture)===null||i===void 0||i.destroy(),(a=this.dataTexture)===null||a===void 0||a.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var i=this.layer.getLayerConfig(),a=i.sourceColor,o=i.targetColor;return a&&o?{frag:sq,vert:uq,type:"Linear"}:{frag:aq,vert:oq,type:""}}},{key:"buildModels",value:function(i){var a=this.layer.getLayerConfig(),o=a.segmentNumber,s=o===void 0?30:o,u=a.mask,l=u===void 0?!1:u,c=a.maskInside,f=c===void 0?!0:c,h=this.getShaders(),v=h.frag,p=h.vert,d=h.type;this.layer.buildLayerModel({moduleName:"lineArc3d"+d,vertexShader:p,fragmentShader:v,triangulation:Dc,blend:this.getBlend(),segmentNumber:s,stencil:le(l,f)}).then(function(g){i([g])}).catch(function(g){console.warn(g),i([])})}},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:nt.Attribute,descriptor:{name:"a_Size",buffer:{usage:A.DYNAMIC_DRAW,data:[],type:A.FLOAT},size:1,update:function(o){var s=o.size,u=s===void 0?1:s;return Array.isArray(u)?[u[0]]:[u]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:nt.Attribute,descriptor:{name:"a_Instance",buffer:{usage:A.STATIC_DRAW,data:[],type:A.FLOAT},size:4,update:function(o,s,u){return[u[3],u[4],u[5],u[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:nt.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:A.DYNAMIC_DRAW,data:[],type:A.FLOAT},size:2,update:function(o){var s=i.iconService.getIconMap(),u=o.texture,l=s[u]||{x:0,y:0},c=l.x,f=l.y;return[c,f]}}})}}]),t}(qt);function fq(r){var n=hq();return function(){var e=B(r),i;if(n){var a=B(this).constructor;i=Reflect.construct(e,arguments,a)}else i=e.apply(this,arguments);return et(this,i)}}function hq(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var vq=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying float v_segmentIndex;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;

  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_animate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);

      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_animate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_animate.x == Animate) {
      time = u_time / u_animate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);

    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    if(u_animate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_animate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          gl_FragColor = filterColor(pattern);
        }
    }

  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,pq=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
varying vec4 v_color;

uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_animate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,dq=`
#define Animate 0.0

uniform float u_opacity;
uniform float u_blur : 0.9;
varying float v_segmentIndex;
uniform float segmentNumber;

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);

  gl_FragColor.a *= opacity;

  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);

      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_animate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,gq=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;
attribute vec2 a_iconMapUV;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
uniform float u_opacity: 1.0;

varying vec4 v_dash_array;
varying vec4 v_color;
varying float v_segmentIndex;
varying vec2 v_iconMapUV;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143


#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_animate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,yq={solid:0,dash:1},mq=function(r){tt(t,r);var n=fq(t);function t(){var e;$(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return e=n.call.apply(n,[this].concat(a)),S(I(e),"updateTexture",function(){var s=e.rendererService.createTexture2D;if(e.texture){e.texture.update({data:e.iconService.getCanvas()}),e.layer.render();return}e.texture=s({data:e.iconService.getCanvas(),mag:A.NEAREST,min:A.NEAREST,premultiplyAlpha:!1,width:1024,height:e.iconService.canvasHeight||128})}),e}return H(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=a===void 0?1:a,s=i.sourceColor,u=i.targetColor,l=i.textureBlend,c=l===void 0?"normal":l,f=i.lineType,h=f===void 0?"solid":f,v=i.dashArray,p=v===void 0?[10,5]:v,d=i.lineTexture,g=d===void 0?!1:d,y=i.iconStep,m=y===void 0?100:y,x=i.segmentNumber,_=x===void 0?30:x,E=i.globalArcHeight,b=E===void 0?10:E;p.length===2&&p.push(0,0);var M=0,T=[0,0,0,0],k=[0,0,0,0];if(s&&u&&(T=Ut(s),k=Ut(u),M=1),this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:o})){this.judgeStyleAttributes({opacity:o});var L=this.layer.getEncodedData(),O=this.calDataFrame(this.cellLength,L,this.cellProperties),D=O.data,W=O.width,j=O.height;this.rowCount=j,this.dataTexture=this.cellLength>0&&D.length>0?this.createTexture2D({flipY:!0,data:D,format:A.LUMINANCE,type:A.FLOAT,width:W,height:j}):this.createTexture2D({flipY:!0,data:[1],format:A.LUMINANCE,type:A.FLOAT,width:1,height:1})}return{u_globel:1,u_globel_radius:cd,u_global_height:b,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Y.exports.isNumber(o)?o:1,u_textureBlend:c==="normal"?0:1,segmentNumber:_,u_line_type:yq[h]||0,u_dash_array:p,u_texture:this.texture,u_line_texture:g?1:0,u_icon_step:m,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:M,u_sourceColor:T,u_targetColor:k}}},{key:"getAnimateUniforms",value:function(){var i=this.layer.getLayerConfig(),a=i.animateOption;return{u_animate:this.animateOption2Array(a),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(i){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels(i)}},{key:"clearModels",value:function(){var i,a;(i=this.texture)===null||i===void 0||i.destroy(),(a=this.dataTexture)===null||a===void 0||a.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var i=this.layer.getLayerConfig(),a=i.sourceColor,o=i.targetColor;return a&&o?{frag:dq,vert:gq,type:"Linear"}:{frag:vq,vert:pq,type:""}}},{key:"buildModels",value:function(i){var a=this.layer.getLayerConfig(),o=a.segmentNumber,s=o===void 0?30:o,u=a.mask,l=u===void 0?!1:u,c=a.maskInside,f=c===void 0?!0:c,h=this.getShaders(),v=h.frag,p=h.vert,d=h.type;this.layer.buildLayerModel({moduleName:"lineEarthArc3d"+d,vertexShader:p,fragmentShader:v,triangulation:Dc,depth:{enable:!0},blend:this.getBlend(),segmentNumber:s,stencil:le(l,f)}).then(function(g){i([g])}).catch(function(g){console.warn(g),i([])})}},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:nt.Attribute,descriptor:{name:"a_Size",buffer:{usage:A.DYNAMIC_DRAW,data:[],type:A.FLOAT},size:1,update:function(o){var s=o.size,u=s===void 0?1:s;return Array.isArray(u)?[u[0]]:[u]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:nt.Attribute,descriptor:{name:"a_Instance",buffer:{usage:A.STATIC_DRAW,data:[],type:A.FLOAT},size:4,update:function(o,s,u){return[u[3],u[4],u[5],u[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:nt.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:A.DYNAMIC_DRAW,data:[],type:A.FLOAT},size:2,update:function(o){var s=i.iconService.getIconMap(),u=o.texture,l=s[u]||{x:0,y:0},c=l.x,f=l.y;return[c,f]}}})}}]),t}(qt);function xq(r){var n=_q();return function(){var e=B(r),i;if(n){var a=B(this).constructor;i=Reflect.construct(e,arguments,a)}else i=e.apply(this,arguments);return et(this,i)}}function _q(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Cq=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying float v_distance_ratio;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"
#pragma include "project"
#pragma include "projection"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0;
  float d_segmentIndex = styleMappingMat[3].g;
  
  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      // \u5B9E\u7EBF\u90E8\u5206
    } else {
      // \u865A\u7EBF\u90E8\u5206
      discard;
    };
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u52A8\u753B\u6A21\u5F0F
  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u8D34\u56FE
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { 
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / (segmentNumber - 1.0)));
    // float arcRadio = d_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
    float u = fract(arcRadio * count - animateSpeed * count);
    // float u = fract(arcRadio * count - animateSpeed);
    if(u_animate.x == Animate) {
      u = gl_FragColor.a/opacity;
    }

    float v = styleMappingMat[3].a; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);
    
    // \u8BBE\u7F6E\u8D34\u56FE\u548C\u5E95\u8272\u7684\u53E0\u52A0\u6A21\u5F0F
    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}`,Eq=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
varying vec4 v_color;

varying float v_distance_ratio;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
    return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
    return index / (segmentNumber - 1.);
}

float paraboloid(vec2 source, vec2 target, float ratio) {
    vec2 x = mix(source, target, ratio);
    vec2 center = mix(source, target, 0.5);
    float dSourceCenter = distance(source, center);
    float dXCenter = distance(x, center);
    return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
     float vertex_height = paraboloid(source, target, segmentRatio);

    return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
    );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size)/ 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}
float getAngularDist (vec2 source, vec2 target) {
  vec2 delta = source - target;
  vec2 sin_half_delta = sin(delta / 2.0);
  float a =
    sin_half_delta.y * sin_half_delta.y +
    cos(source.y) * cos(target.y) *
    sin_half_delta.x * sin_half_delta.x;
  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));
}

vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = 0.314;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  return mid;
}
float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}

vec2 interpolate (vec2 source, vec2 target, float angularDist, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    vec2 mid = midPoint(source, target);
    vec3 x = vec3(source.x, mid.x, target.x);
    vec3 y = vec3(source.y, mid.y, target.y);
    return vec2(bezier3(x ,t), bezier3(y,t));
  }else {
    if(abs(angularDist - PI) < 0.001) {
      return (1.0 - t) * source + t * target;
    }
    float a = sin((1.0 - t) * angularDist) / sin(angularDist);
    float b = sin(t * angularDist) / sin(angularDist);
    vec2 sin_source = sin(source);
    vec2 cos_source = cos(source);
    vec2 sin_target = sin(target);
    vec2 cos_target = cos(target);
    float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;
    float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;
    float z = a * sin_source.y + b * sin_target.y;
    return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));
  }
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = radians(a_Instance.rg);
  vec2 target = radians(a_Instance.ba);
  float angularDist = getAngularDist(source, target);
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  if(u_line_type == LineTypeDash) {
    v_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    total_Distance = total_Distance*16.0; // total_Distance*16.0 \u8C03\u6574\u9ED8\u8BA4\u7684\u6548\u679C
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / total_Distance;
  }

  if(u_animate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  v_distance_ratio = segmentIndex / segmentNumber;
  vec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0));
  vec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  //  vec4 project_pos = project_position(vec4(curr.xy, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));

  styleMappingMat[3].g = a_Position.x; // \u8BE5\u9876\u70B9\u5728\u5F27\u7EBF\u4E0A\u7684\u5206\u6BB5\u6392\u5E8F
  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  
    // float mapZoomScale = u_CoordinateSystem !== COORDINATE_SYSTEM_P20_2?10000000.0:1.0;
    float d_arcDistrance = length(source - target);
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      d_arcDistrance = d_arcDistrance * 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      d_arcDistrance = project_pixel_allmap(d_arcDistrance);
    }
    float d_pixelLen = project_pixel(u_icon_step)/8.0;
    styleMappingMat[3].b = floor(d_arcDistrance/d_pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + offset, curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));
  }
  setPickingColor(a_PickingColor);
}

`,Sq={solid:0,dash:1},bq=function(r){tt(t,r);var n=xq(t);function t(){var e;$(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return e=n.call.apply(n,[this].concat(a)),S(I(e),"updateTexture",function(){var s=e.rendererService.createTexture2D;if(e.texture){e.texture.update({data:e.iconService.getCanvas()}),e.layer.render();return}e.texture=s({data:e.iconService.getCanvas(),mag:A.NEAREST,min:A.NEAREST,premultiplyAlpha:!1,width:1024,height:e.iconService.canvasHeight||128})}),e}return H(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=a===void 0?1:a,s=i.sourceColor,u=i.targetColor,l=i.textureBlend,c=l===void 0?"normal":l,f=i.lineType,h=f===void 0?"solid":f,v=i.dashArray,p=v===void 0?[10,5]:v,d=i.lineTexture,g=d===void 0?!1:d,y=i.iconStep,m=y===void 0?100:y,x=i.segmentNumber,_=x===void 0?30:x;p.length===2&&p.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var E=0,b=[0,0,0,0],M=[0,0,0,0];if(s&&u&&(b=Ut(s),M=Ut(u),E=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:o})){this.judgeStyleAttributes({opacity:o});var T=this.layer.getEncodedData(),k=this.calDataFrame(this.cellLength,T,this.cellProperties),L=k.data,O=k.width,D=k.height;this.rowCount=D,this.dataTexture=this.cellLength>0&&L.length>0?this.createTexture2D({flipY:!0,data:L,format:A.LUMINANCE,type:A.FLOAT,width:O,height:D}):this.createTexture2D({flipY:!0,data:[1],format:A.LUMINANCE,type:A.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Y.exports.isNumber(o)?o:1,u_textureBlend:c==="normal"?0:1,segmentNumber:_,u_line_type:Sq[h]||0,u_dash_array:p,u_texture:this.texture,u_line_texture:g?1:0,u_icon_step:m,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:E,u_sourceColor:b,u_targetColor:M}}},{key:"getAnimateUniforms",value:function(){var i=this.layer.getLayerConfig(),a=i.animateOption;return{u_animate:this.animateOption2Array(a),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(i){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels(i)}},{key:"clearModels",value:function(){var i,a;(i=this.texture)===null||i===void 0||i.destroy(),(a=this.dataTexture)===null||a===void 0||a.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(i){var a=this.layer.getLayerConfig(),o=a.mask,s=o===void 0?!1:o,u=a.maskInside,l=u===void 0?!0:u;this.layer.buildLayerModel({moduleName:"lineGreatCircle",vertexShader:Eq,fragmentShader:Cq,triangulation:Dc,depth:{enable:!1},blend:this.getBlend(),stencil:le(s,l)}).then(function(c){i([c])}).catch(function(c){console.warn(c),i([])})}},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:nt.Attribute,descriptor:{name:"a_Size",buffer:{usage:A.DYNAMIC_DRAW,data:[],type:A.FLOAT},size:1,update:function(o,s,u,l){var c=o.size,f=c===void 0?1:c;return Array.isArray(f)?[f[0]]:[f]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:nt.Attribute,descriptor:{name:"a_Instance",buffer:{usage:A.STATIC_DRAW,data:[],type:A.FLOAT},size:4,update:function(o,s,u,l){return[u[3],u[4],u[5],u[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:nt.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:A.DYNAMIC_DRAW,data:[],type:A.FLOAT},size:2,update:function(o,s,u,l){var c=i.iconService.getIconMap(),f=o.texture,h=c[f]||{x:0,y:0},v=h.x,p=h.y;return[v,p]}}})}}]),t}(qt);function Aq(r){var n=Tq();return function(){var e=B(r),i;if(n){var a=B(this).constructor;i=Reflect.construct(e,arguments,a)}else i=e.apply(this,arguments);return et(this,i)}}function Tq(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Mq=`#define COORDINATE_SYSTEM_LNGLAT 1.0        // mapbox
#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0 // mapbox offset
#define COORDINATE_SYSTEM_VECTOR_TILE 3.0
#define COORDINATE_SYSTEM_IDENTITY 4.0
#define COORDINATE_SYSTEM_P20 5.0           // amap
#define COORDINATE_SYSTEM_P20_OFFSET 6.0    // amap offset
#define COORDINATE_SYSTEM_METER_OFFSET 7.0

#define COORDINATE_SYSTEM_P20_2 8.0         // amap2.0
uniform float u_CoordinateSystem;
varying vec4 v_color;
uniform float u_arrow: 0.0;
uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

varying mat4 styleMappingMat;
void main() {
  float distanceAndIndex = styleMappingMat[0][3];
  float miter = styleMappingMat[0][2];

  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B


  if(u_arrow > 0.0 && distanceAndIndex < 2.0) { // arrow
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) { 
      if(cross(vec3(styleMappingMat[1].rg, 0.0), vec3(styleMappingMat[1].ba, 0.0)).z < 0.0) { // amap
        discard;
      }
    } else { // amap2 mapbox map
      if(cross(vec3(styleMappingMat[1].rg, 0.0), vec3(styleMappingMat[1].ba, 0.0)).z > 0.0) { 
        discard;
      }
    }
  } else { // line body
    if(miter < 0.0) {
      discard;
    }
  }


  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_distance_ratio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
    gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  gl_FragColor = filterColor(gl_FragColor);
}
`,wq=`attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

// dash line
attribute vec4 a_dirPoints;
attribute vec3 a_DistanceAndIndex;

uniform vec4 u_lineDir;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;

uniform float u_linearColor: 0;
uniform float u_arrow: 0.0;
uniform float u_arrowHeight: 3.0;
uniform float u_arrowWidth: 2.0;
uniform float u_tailWidth: 1.0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

vec2 calculateArrow(vec2 offset) {
  /*
  * \u5728\u652F\u6301\u7BAD\u5934\u7684\u65F6\u5019\uFF0C\u7B2C\u4E8C\u3001\u7B2C\u4E09\u7EC4\u9876\u70B9\u662F\u989D\u5916\u63D2\u5165\u7528\u4E8E\u6784\u5EFA\u9876\u70B9\u7684
  */
  float arrowFlag = -1.0;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // \u9AD8\u5FB7 2.0 \u7684\u65CB\u8F6C\u89D2\u5EA6\u4E0D\u540C
    arrowFlag = 1.0;
  }
  float pi = arrowFlag * 3.1415926/2.;
  if(a_Miter < 0.) {
    // \u6839\u636E\u7EBF\u7684\u4E24\u4FA7\u504F\u79FB\u4E0D\u540C\u3001\u65CB\u8F6C\u7684\u65B9\u5411\u76F8\u53CD
    pi = -pi;
  }
  highp float angle_sin = sin(pi);
  highp float angle_cos = cos(pi);
  // \u8BA1\u7B97\u5782\u76F4\u4E0E\u7EBF\u65B9\u5411\u7684\u65CB\u8F6C\u77E9\u9635
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  float arrowWidth = u_arrowWidth;
  float arrowHeight = u_arrowHeight;

  vec2 arrowOffset = vec2(0.0);
  /*
  * a_DistanceAndIndex.y \u7528\u4E8E\u6807\u8BB0\u5F53\u524D\u9876\u70B9\u5C5E\u4E8E\u54EA\u4E00\u7EC4\uFF08\u4E24\u4E2A\u9876\u70B9\u4E00\u7EC4\uFF0C\u6784\u6210\u7EBF\u7684\u5176\u5B9E\u662F\u77E9\u5F62\uFF0C\u6700\u7B80\u9700\u8981\u56DB\u4E2A\u9876\u70B9\u3001\u4E24\u7EC4\u9876\u70B9\u6784\u6210\uFF09
  */
  if(a_DistanceAndIndex.y == 0.0) {
    // \u7BAD\u5934\u5C16\u90E8
    offset = vec2(0.0);
  } else if(a_DistanceAndIndex.y == 1.0) {
    // \u7BAD\u5934\u4E24\u4FA7
    arrowOffset = rotation_matrix*(offset * arrowHeight);
    offset += arrowOffset; // \u6CBF\u7EBF\u504F\u79FB
    offset = offset * arrowWidth; // \u5782\u76F4\u7EBF\u5411\u5916\u504F\u79FB\uFF08\u662F\u6784\u5EFA\u7BAD\u5934\u4E24\u4FA7\u7684\u9876\u70B9\uFF09
  } else if(a_DistanceAndIndex.y == 2.0 || a_DistanceAndIndex.y == 3.0 || a_DistanceAndIndex.y == 4.0) {
    // \u504F\u79FB\u5176\u4F59\u7684\u70B9\u4F4D\uFF08\u5C06\u957F\u5EA6\u8BA9\u4F4D\u7ED9\u7BAD\u5934\uFF09
    arrowOffset = rotation_matrix*(offset * arrowHeight) * arrowWidth;
    offset += arrowOffset;// \u6CBF\u7EBF\u504F\u79FB
  }

  return offset;
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - a_Miter - a_DistanceAndIndex
    0.0, 0.0, 0.0, 0.0, // originX - originY - vectorX - vectorY
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );
  styleMappingMat[0][3] = a_DistanceAndIndex.y;
  styleMappingMat[0][2] = a_Miter;

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97


  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  // styleMappingMat[1].rg = a_Position.xy + offset;

  vec2 copyOffset = vec2(offset.x, offset.y);

  float lineDistance = a_DistanceAndIndex.x;
  float total_Distance = a_DistanceAndIndex.z;
  float currentLinePointRatio = lineDistance / total_Distance;
 
  if(u_arrow > 0.0) {
      //  \u8BA1\u7B97\u7BAD\u5934
    offset = calculateArrow(offset);

    if(a_DistanceAndIndex.y > 4.0) {
      offset *= mix(1.0, u_tailWidth, currentLinePointRatio);
    }
  }

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = currentLinePointRatio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = lineDistance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z); // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight, 1.0));
  }
  
  if(u_arrow > 0.0 && a_DistanceAndIndex.y < 2.0) {
    vec2 startPoint = a_dirPoints.rg;
    vec2 endPoint = a_dirPoints.ba;
    vec4 t1 = project_position(vec4(startPoint, 0, 1.0));
    vec4 t2 = project_position(vec4(endPoint, 0, 1.0));
    // TODO\uFF1A \u540E\u7EED\u4F18\u5316\u53EF\u4EE5\u628A\u4F4D\u7F6E\u8BA1\u7B97\u653E\u5728 cpu \u4E2D\u5B8C\u6210
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      vec2 p1 = (u_Mvp * vec4(t1.xy, 0.0, 1.0)).xy;
      vec2 p2 = (u_Mvp * vec4(t2.xy, 0.0, 1.0)).xy;
      styleMappingMat[1].rg = normalize(p1 - p2);
      styleMappingMat[1].ba = normalize(gl_Position.xy - p2);
    } else {
      vec2 p1 = project_common_position_to_clipspace(vec4(t1.xy, 0.0, 1.0)).xy;
      vec2 p2 = project_common_position_to_clipspace(vec4(t2.xy, 0.0, 1.0)).xy;
      styleMappingMat[1].rg = normalize(p1 - p2);
      styleMappingMat[1].ba = normalize(gl_Position.xy - p2);
    }
  }

  setPickingColor(a_PickingColor);
}
`,Lq=function(r){tt(t,r);var n=Aq(t);function t(){return $(this,t),n.apply(this,arguments)}return H(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=a===void 0?1:a,s=i.sourceColor,u=i.targetColor,l=i.arrow,c=l===void 0?{enable:!1,arrowWidth:2,arrowHeight:3,tailWidth:1}:l,f=0,h=[0,0,0,0],v=[0,0,0,0];if(s&&u&&(h=Ut(s),v=Ut(u),f=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:o})){this.judgeStyleAttributes({opacity:o});var p=this.layer.getEncodedData(),d=this.calDataFrame(this.cellLength,p,this.cellProperties),g=d.data,y=d.width,m=d.height;this.rowCount=m,this.dataTexture=this.cellLength>0&&g.length>0?this.createTexture2D({flipY:!0,data:g,format:A.LUMINANCE,type:A.FLOAT,width:y,height:m}):this.createTexture2D({flipY:!0,data:[1],format:A.LUMINANCE,type:A.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Y.exports.isNumber(o)?o:1,u_linearColor:f,u_sourceColor:h,u_targetColor:v,u_arrow:Number(c.enable),u_arrowHeight:c.arrowHeight||3,u_arrowWidth:c.arrowWidth||2,u_tailWidth:c.tailWidth===void 0?1:c.tailWidth}}},{key:"initModels",value:function(i){this.buildModels(i)}},{key:"clearModels",value:function(){var i;(i=this.dataTexture)===null||i===void 0||i.destroy()}},{key:"buildModels",value:function(){var e=Mt(st.mark(function a(o){var s,u,l,c,f,h,v,p,d,g;return st.wrap(function(m){for(;;)switch(m.prev=m.next){case 0:s=this.layer.getLayerConfig(),u=s.mask,l=u===void 0?!1:u,c=s.maskInside,f=c===void 0?!0:c,h=s.depth,v=h===void 0?!1:h,p=this.getShaders(),d=p.frag,g=p.vert,this.layer.triangulation=ua,this.layer.buildLayerModel({moduleName:"lineHalf",vertexShader:g,fragmentShader:d,triangulation:ua,depth:{enable:v},blend:this.getBlend(),stencil:le(l,f)}).then(function(x){o([x])}).catch(function(x){console.warn(x),o([])});case 4:case"end":return m.stop()}},a,this)}));function i(a){return e.apply(this,arguments)}return i}()},{key:"getShaders",value:function(){return{frag:Mq,vert:wq,type:"normal"}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:nt.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:A.STATIC_DRAW,data:[],type:A.FLOAT},size:3,update:function(a,o,s,u,l,c){return c===void 0?[s[3],10,s[5]]:[s[3],c,s[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"dirPoints",type:nt.Attribute,descriptor:{name:"a_dirPoints",buffer:{usage:A.STATIC_DRAW,data:[],type:A.FLOAT},size:4,update:function(a){var o=a.coordinates[0]||[0,0],s=a.coordinates[3]||[0,0];return[o[0],o[1],s[0],s[1]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:nt.Attribute,descriptor:{name:"a_Size",buffer:{usage:A.DYNAMIC_DRAW,data:[],type:A.FLOAT},size:2,update:function(a){var o=a.size,s=o===void 0?1:o;return Array.isArray(s)?[s[0],s[1]]:[s,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:nt.Attribute,descriptor:{name:"a_Normal",buffer:{usage:A.STATIC_DRAW,data:[],type:A.FLOAT},size:3,update:function(a,o,s,u,l){return l}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:nt.Attribute,descriptor:{name:"a_Miter",buffer:{usage:A.STATIC_DRAW,data:[],type:A.FLOAT},size:1,update:function(a,o,s){return[s[4]]}}})}}]),t}(qt);function Fq(r){var n=kq();return function(){var e=B(r),i;if(n){var a=B(this).constructor;i=Reflect.construct(e,arguments,a)}else i=e.apply(this,arguments);return et(this,i)}}function kq(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Oq=`#define LineTypeSolid 0.0
uniform float u_opacity : 1.0;

varying vec4 v_color;

// dash
varying vec4 v_dash_array;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
 
  float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
    // \u5B9E\u7EBF\u90E8\u5206
  } else {
    // \u865A\u7EBF\u90E8\u5206
    discard;
  };

  gl_FragColor = filterColor(gl_FragColor);
}
`,Rq=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];

uniform float u_vertexScale: 1.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;
varying vec4 v_dash_array;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_Total_Distance;
  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  vec2 offset = project_pixel(size.xy);

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = a_DistanceAndIndex.x / a_Total_Distance; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = a_DistanceAndIndex.x;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, project_pixel(a_Size.y), 1.0));
  } else {
    float lineHeight = a_Size.y;
 
    // #define COORDINATE_SYSTEM_P20 5.0
    // #define COORDINATE_SYSTEM_P20_OFFSET 6.0
    // amap1.x
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      lineHeight *= pow(2.0, 20.0 - u_Zoom);
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,Iq=`#define Animate 0.0
#define LineTexture 1.0
uniform float u_opacity : 1.0;
uniform float u_textureBlend;

uniform float u_borderWidth: 0.0;

uniform vec3 u_blur;
uniform vec4 u_borderColor;
varying vec4 v_color;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

varying vec2 v_iconMapUV;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_animate: [ 1, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;
  // anti-alias
  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + animateSpeed);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = styleMappingMat[3].g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = styleMappingMat[3].b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // v = max(smoothstep(0.95, 1.0, v), v);
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, vec2(u, v)));
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, uv));
     vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor += pattern;
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = pattern;
    }
  } 

  float v = styleMappingMat[3].a;
  float borderWidth = min(0.5, u_borderWidth);
  // \u7ED8\u5236 border
  if(borderWidth > 0.01) {
    float borderOuterWidth = borderWidth/2.0;

    if(v >= 1.0 - borderWidth || v <= borderWidth) {
      if(v > borderWidth) {
        float linear = smoothstep(0.0, 1.0, (v - (1.0 - borderWidth))/borderWidth);
        gl_FragColor.rgb = mix(gl_FragColor.rgb, u_borderColor.rgb, linear);
      } else if(v <= borderWidth) {
        float linear = smoothstep(0.0, 1.0, v/borderWidth);
        gl_FragColor.rgb = mix(u_borderColor.rgb, gl_FragColor.rgb, linear);
      }
    }

    if(v < borderOuterWidth) {
      gl_FragColor.a = mix(0.0, gl_FragColor.a, v/borderOuterWidth);
    } else if(v > 1.0 - borderOuterWidth) {
      gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - borderOuterWidth))/borderOuterWidth);
    }
  }

  // blur
  float blurV = styleMappingMat[3][3];
  if(blurV < 0.5) {
    gl_FragColor.a *= mix(u_blur.r, u_blur.g, blurV/0.5);
  } else {
    gl_FragColor.a *= mix(u_blur.g, u_blur.b, (blurV - 0.5)/0.5);
  }
  
  gl_FragColor = filterColor(gl_FragColor);
}
`,D1=`
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;

uniform float u_heightfixed: 0.0;
uniform float u_vertexScale: 1.0;
uniform float u_raisingHeight: 0.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;


uniform float u_linearColor: 0;
uniform float u_arrow: 0.0;
uniform float u_arrowHeight: 3.0;
uniform float u_arrowWidth: 2.0;
uniform float u_tailWidth: 1.0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

vec2 calculateArrow(vec2 offset) {
  /*
  * \u5728\u652F\u6301\u7BAD\u5934\u7684\u65F6\u5019\uFF0C\u7B2C\u4E8C\u3001\u7B2C\u4E09\u7EC4\u9876\u70B9\u662F\u989D\u5916\u63D2\u5165\u7528\u4E8E\u6784\u5EFA\u9876\u70B9\u7684
  */
  float arrowFlag = -1.0;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // \u9AD8\u5FB7 2.0 \u7684\u65CB\u8F6C\u89D2\u5EA6\u4E0D\u540C
    arrowFlag = 1.0;
  }
  float pi = arrowFlag * 3.1415926/2.;
  if(a_Miter < 0.) {
    // \u6839\u636E\u7EBF\u7684\u4E24\u4FA7\u504F\u79FB\u4E0D\u540C\u3001\u65CB\u8F6C\u7684\u65B9\u5411\u76F8\u53CD
    pi = -pi;
  }
  highp float angle_sin = sin(pi);
  highp float angle_cos = cos(pi);
  // \u8BA1\u7B97\u5782\u76F4\u4E0E\u7EBF\u65B9\u5411\u7684\u65CB\u8F6C\u77E9\u9635
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  float arrowWidth = u_arrowWidth;
  float arrowHeight = u_arrowHeight;

  vec2 arrowOffset = vec2(0.0);
  /*
  * a_DistanceAndIndex.y \u7528\u4E8E\u6807\u8BB0\u5F53\u524D\u9876\u70B9\u5C5E\u4E8E\u54EA\u4E00\u7EC4\uFF08\u4E24\u4E2A\u9876\u70B9\u4E00\u7EC4\uFF0C\u6784\u6210\u7EBF\u7684\u5176\u5B9E\u662F\u77E9\u5F62\uFF0C\u6700\u7B80\u9700\u8981\u56DB\u4E2A\u9876\u70B9\u3001\u4E24\u7EC4\u9876\u70B9\u6784\u6210\uFF09
  */
  if(a_DistanceAndIndex.y == 0.0) {
    // \u7BAD\u5934\u5C16\u90E8
    offset = vec2(0.0);
  } else if(a_DistanceAndIndex.y == 1.0) {
    // \u7BAD\u5934\u4E24\u4FA7
    arrowOffset = rotation_matrix*(offset * arrowHeight);
    offset += arrowOffset; // \u6CBF\u7EBF\u504F\u79FB
    offset = offset * arrowWidth; // \u5782\u76F4\u7EBF\u5411\u5916\u504F\u79FB\uFF08\u662F\u6784\u5EFA\u7BAD\u5934\u4E24\u4FA7\u7684\u9876\u70B9\uFF09
  } else if(a_DistanceAndIndex.y == 2.0 || a_DistanceAndIndex.y == 3.0 || a_DistanceAndIndex.y == 4.0) {
    // \u504F\u79FB\u5176\u4F59\u7684\u70B9\u4F4D\uFF08\u5C06\u957F\u5EA6\u8BA9\u4F4D\u7ED9\u7BAD\u5934\uFF09
    arrowOffset = rotation_matrix*(offset * arrowHeight) * arrowWidth;
    offset += arrowOffset;// \u6CBF\u7EBF\u504F\u79FB
  }

  return offset;
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  d_texPixelLen = project_float_pixel(u_icon_step);
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  float lineDistance = a_DistanceAndIndex.x;
  float currentLinePointRatio = lineDistance / a_Total_Distance;
 
  if(u_arrow > 0.0) {
      //  \u8BA1\u7B97\u7BAD\u5934
    offset = calculateArrow(offset);

    if(a_DistanceAndIndex.y > 4.0) {
      offset *= mix(1.0, u_tailWidth, currentLinePointRatio);
    }
  }

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = currentLinePointRatio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = lineDistance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  styleMappingMat[3][2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  styleMappingMat[3][3] = texV;             // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    h *= 0.2;
    if(u_heightfixed < 1.0) {
      lineHeight = project_pixel(a_Size.y);
    }
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));
  } else {
    // mapbox -  amap
    
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // mapbox
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      h *= mapboxZoomScale;
      h += u_raisingHeight * mapboxZoomScale;
      if(u_heightfixed > 0.0) {
        lineHeight *= mapboxZoomScale;
      }
      
    } else {
      // amap
      h += u_raisingHeight;
      // lineHeight \u9876\u70B9\u504F\u79FB\u9AD8\u5EA6
      if(u_heightfixed < 1.0) {
        lineHeight *= pow(2.0, 20.0 - u_Zoom);
      }
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,Dq=`varying vec4 v_color;
uniform float u_linearDir: 1.0;
uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"


varying mat4 styleMappingMat;

void main() {
  float opacity = styleMappingMat[0][0];
  float linearRadio = styleMappingMat[3][0]; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  if(u_linearDir < 1.0) {
    linearRadio = styleMappingMat[3][3];
  }

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, linearRadio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  gl_FragColor = filterColor(gl_FragColor);
}
`,Pq={solid:0,dash:1},Bq=function(r){tt(t,r);var n=Fq(t);function t(){var e;$(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return e=n.call.apply(n,[this].concat(a)),S(I(e),"updateTexture",function(){var s=e.rendererService.createTexture2D;if(e.texture){e.texture.update({data:e.iconService.getCanvas()}),e.layer.render();return}e.texture=s({data:e.iconService.getCanvas(),mag:A.NEAREST,min:A.NEAREST,premultiplyAlpha:!1,width:1024,height:e.iconService.canvasHeight||128})}),e}return H(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=a===void 0?1:a,s=i.sourceColor,u=i.targetColor,l=i.textureBlend,c=l===void 0?"normal":l,f=i.lineType,h=f===void 0?"solid":f,v=i.dashArray,p=v===void 0?[10,5,0,0]:v,d=i.lineTexture,g=d===void 0?!1:d,y=i.iconStep,m=y===void 0?100:y,x=i.vertexHeightScale,_=x===void 0?20:x,E=i.borderWidth,b=E===void 0?0:E,M=i.borderColor,T=M===void 0?"#ccc":M,k=i.raisingHeight,L=k===void 0?0:k,O=i.heightfixed,D=O===void 0?!1:O,W=i.linearDir,j=W===void 0?io.VERTICAL:W,ot=i.blur,z=ot===void 0?[1,1,1]:ot,X=i.arrow,K=X===void 0?{enable:!1,arrowWidth:2,arrowHeight:3,tailWidth:1}:X;p.length===2&&p.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var Q=0,q=[0,0,0,0],at=[0,0,0,0];if(s&&u&&(q=Ut(s),at=Ut(u),Q=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:o})){this.judgeStyleAttributes({opacity:o});var pt=this.layer.getEncodedData(),mt=this.calDataFrame(this.cellLength,pt,this.cellProperties),ft=mt.data,vt=mt.width,Lt=mt.height;this.rowCount=Lt,this.dataTexture=this.cellLength>0&&ft.length>0?this.createTexture2D({flipY:!0,data:ft,format:A.LUMINANCE,type:A.FLOAT,width:vt,height:Lt}):this.createTexture2D({flipY:!0,data:[1],format:A.LUMINANCE,type:A.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Y.exports.isNumber(o)?o:1,u_textureBlend:c===cv.NORMAL?0:1,u_line_type:Pq[h],u_dash_array:p,u_blur:z,u_texture:this.texture,u_line_texture:g?1:0,u_icon_step:m,u_textSize:[1024,this.iconService.canvasHeight||128],u_borderWidth:b,u_borderColor:Ut(T),u_linearDir:j===io.VERTICAL?1:0,u_linearColor:Q,u_sourceColor:q,u_targetColor:at,u_heightfixed:Number(D),u_vertexScale:_,u_raisingHeight:Number(L),u_arrow:Number(K.enable),u_arrowHeight:K.arrowHeight||3,u_arrowWidth:K.arrowWidth||2,u_tailWidth:K.tailWidth===void 0?1:K.tailWidth}}},{key:"getAnimateUniforms",value:function(){var i=this.layer.getLayerConfig(),a=i.animateOption;return{u_animate:this.animateOption2Array(a),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(i){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels(i)}},{key:"clearModels",value:function(){var i,a;(i=this.texture)===null||i===void 0||i.destroy(),(a=this.dataTexture)===null||a===void 0||a.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(i){var a=this.layer.getLayerConfig(),o=a.mask,s=o===void 0?!1:o,u=a.maskInside,l=u===void 0?!0:u,c=a.depth,f=c===void 0?!1:c,h=a.workerEnabled,v=h===void 0?!1:h,p=a.enablePicking,d=this.getShaders(),g=d.frag,y=d.vert,m=d.type;this.layer.triangulation=jh,this.layer.buildLayerModel({moduleName:"line"+m,vertexShader:y,fragmentShader:g,triangulation:jh,depth:{enable:f},blend:this.getBlend(),stencil:le(s,l),workerEnabled:v,workerOptions:{modelType:"line"+m,enablePicking:p,iconMap:this.iconService.getIconMap()}}).then(function(x){i([x])}).catch(function(x){console.warn(x),i([])})}},{key:"getShaders",value:function(){var i=this.layer.getLayerConfig(),a=i.sourceColor,o=i.targetColor,s=i.lineType;return s==="dash"?{frag:Oq,vert:Rq,type:"Dash"}:a&&o?{frag:Dq,vert:D1,type:"Linear"}:{frag:Iq,vert:D1,type:""}}},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:nt.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:A.STATIC_DRAW,data:[],type:A.FLOAT},size:2,update:function(o,s,u,l,c,f){return f===void 0?[u[3],10]:[u[3],f]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:nt.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:A.STATIC_DRAW,data:[],type:A.FLOAT},size:1,update:function(o,s,u){return[u[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:nt.Attribute,descriptor:{name:"a_Size",buffer:{usage:A.DYNAMIC_DRAW,data:[],type:A.FLOAT},size:2,update:function(o){var s=o.size,u=s===void 0?1:s;return Array.isArray(u)?[u[0],u[1]]:[u,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:nt.Attribute,descriptor:{name:"a_Normal",buffer:{usage:A.STATIC_DRAW,data:[],type:A.FLOAT},size:3,update:function(o,s,u,l,c){return c}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:nt.Attribute,descriptor:{name:"a_Miter",buffer:{usage:A.STATIC_DRAW,data:[],type:A.FLOAT},size:1,update:function(o,s,u){return[u[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:nt.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:A.DYNAMIC_DRAW,data:[],type:A.FLOAT},size:2,update:function(o){var s=i.iconService.getIconMap(),u=o.texture,l=s[u]||{x:0,y:0},c=l.x,f=l.y;return[c,f]}}})}}]),t}(qt);function Nq(r){var n=zq();return function(){var e=B(r),i;if(n){var a=B(this).constructor;i=Reflect.construct(e,arguments,a)}else i=e.apply(this,arguments);return et(this,i)}}function zq(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Uq=`uniform float u_opacity : 1.0;
uniform sampler2D u_texture;
uniform float u_linearDir: 1.0;

#pragma include "picking"

varying mat4 styleMappingMat;

void main() {
  float opacity = styleMappingMat[0][0];
  float linearRadio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  if(u_linearDir < 1.0) {
    linearRadio = styleMappingMat[3][3];
  }

  gl_FragColor = texture2D(u_texture, vec2(linearRadio, 0.5));

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  gl_FragColor = filterColor(gl_FragColor);
}
`,Hq=`
attribute float a_Miter;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_heightfixed: 0.0;
uniform float u_vertexScale: 1.0;
uniform float u_raisingHeight: 0.0;

uniform float u_opacity: 1.0;

#pragma include "projection"
#pragma include "picking"

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  float lineDistance = a_DistanceAndIndex.x;
  float currentLinePointRatio = lineDistance / a_Total_Distance;
 

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = currentLinePointRatio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][3] = texV;             // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    h *= 0.2;
    if(u_heightfixed < 1.0) {
      lineHeight = project_pixel(a_Size.y);
    }
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));
  } else {
    // mapbox -  amap
    
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // mapbox
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      h *= mapboxZoomScale;
      h += u_raisingHeight * mapboxZoomScale;
      if(u_heightfixed > 0.0) {
        lineHeight *= mapboxZoomScale;
      }
      
    } else {
      // amap
      h += u_raisingHeight;
      // lineHeight \u9876\u70B9\u504F\u79FB\u9AD8\u5EA6
      if(u_heightfixed < 1.0) {
        lineHeight *= pow(2.0, 20.0 - u_Zoom);
      }
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,$q=function(r){tt(t,r);var n=Nq(t);function t(){var e;$(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return e=n.call.apply(n,[this].concat(a)),S(I(e),"updateTexture",function(){var s=e.rendererService.createTexture2D;e.colorTexture&&e.colorTexture.destroy();var u=e.layer.getLayerConfig(),l=u.rampColors,c=Ls(l);e.colorTexture=s({data:new Uint8Array(c.data),width:c.width,height:c.height,wrapS:A.CLAMP_TO_EDGE,wrapT:A.CLAMP_TO_EDGE,min:A.NEAREST,mag:A.NEAREST,flipY:!1})}),e}return H(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=a===void 0?1:a,s=i.vertexHeightScale,u=s===void 0?20:s,l=i.raisingHeight,c=l===void 0?0:l,f=i.heightfixed,h=f===void 0?!1:f,v=i.linearDir,p=v===void 0?io.VERTICAL:v;if(this.rendererService.getDirty()&&this.colorTexture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:o})){this.judgeStyleAttributes({opacity:o});var d=this.layer.getEncodedData(),g=this.calDataFrame(this.cellLength,d,this.cellProperties),y=g.data,m=g.width,x=g.height;this.rowCount=x,this.dataTexture=this.cellLength>0&&y.length>0?this.createTexture2D({flipY:!0,data:y,format:A.LUMINANCE,type:A.FLOAT,width:m,height:x}):this.createTexture2D({flipY:!0,data:[1],format:A.LUMINANCE,type:A.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_linearDir:p===io.VERTICAL?1:0,u_opacity:Y.exports.isNumber(o)?o:1,u_texture:this.colorTexture,u_heightfixed:Number(h),u_vertexScale:u,u_raisingHeight:Number(c)}}},{key:"initModels",value:function(i){this.updateTexture(),this.buildModels(i)}},{key:"clearModels",value:function(){var i,a;(i=this.colorTexture)===null||i===void 0||i.destroy(),(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"buildModels",value:function(i){var a=this.layer.getLayerConfig(),o=a.mask,s=o===void 0?!1:o,u=a.maskInside,l=u===void 0?!0:u,c=a.depth,f=c===void 0?!1:c;this.layer.triangulation=ua,this.layer.buildLayerModel({moduleName:"lineRampColors",vertexShader:Hq,fragmentShader:Uq,triangulation:ua,depth:{enable:f},blend:this.getBlend(),stencil:le(s,l)}).then(function(h){i([h])}).catch(function(h){console.warn(h),i([])})}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:nt.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:A.STATIC_DRAW,data:[],type:A.FLOAT},size:2,update:function(a,o,s,u,l,c){return c===void 0?[s[3],10]:[s[3],c]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:nt.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:A.STATIC_DRAW,data:[],type:A.FLOAT},size:1,update:function(a,o,s){return[s[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:nt.Attribute,descriptor:{name:"a_Size",buffer:{usage:A.DYNAMIC_DRAW,data:[],type:A.FLOAT},size:2,update:function(a){var o=a.size,s=o===void 0?1:o;return Array.isArray(s)?[s[0],s[1]]:[s,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:nt.Attribute,descriptor:{name:"a_Normal",buffer:{usage:A.STATIC_DRAW,data:[],type:A.FLOAT},size:3,update:function(a,o,s,u,l){return l}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:nt.Attribute,descriptor:{name:"a_Miter",buffer:{usage:A.STATIC_DRAW,data:[],type:A.FLOAT},size:1,update:function(a,o,s){return[s[4]]}}})}}]),t}(qt);function Gq(r){var n=Vq();return function(){var e=B(r),i;if(n){var a=B(this).constructor;i=Reflect.construct(e,arguments,a)}else i=e.apply(this,arguments);return et(this,i)}}function Vq(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Wq=`
varying vec4 v_color;
varying mat4 styleMappingMat;
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = v_color;
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
}
`,jq=`uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;
void main() {
  float opacity = styleMappingMat[0][0];

  // styleMappingMat[3][0] \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = mix(u_sourceColor, u_targetColor, styleMappingMat[3][0]);
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
}
`,P1=`attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Position;

attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_opacity: 1.0;
uniform float u_vertexScale: 1.0;

#pragma include "projection"

varying vec4 v_color;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  v_color = a_Color; 
  styleMappingMat[3][0] = a_Distance / a_Total_Distance;

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, project_pixel(a_Size.y) + h * 0.2, 1.0));
  } else {
    float lineHeight = a_Size.y;
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      h *= 2.0/pow(2.0, 20.0 - u_Zoom);
    }

    // #define COORDINATE_SYSTEM_P20 5.0
    // #define COORDINATE_SYSTEM_P20_OFFSET 6.0
    // amap1.x
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      lineHeight *= pow(2.0, 20.0 - u_Zoom);
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, lineHeight + h, 1.0));
    gl_PointSize = 10.0;
  }
}
`,Xq=function(r){tt(t,r);var n=Gq(t);function t(){return $(this,t),n.apply(this,arguments)}return H(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=a===void 0?1:a,s=i.sourceColor,u=i.targetColor,l=i.vertexHeightScale,c=l===void 0?20:l,f=0,h=[0,0,0,0],v=[0,0,0,0];if(s&&u&&(h=Ut(s),v=Ut(u),f=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:o})){this.judgeStyleAttributes({opacity:o});var p=this.layer.getEncodedData(),d=this.calDataFrame(this.cellLength,p,this.cellProperties),g=d.data,y=d.width,m=d.height;this.rowCount=m,this.dataTexture=this.cellLength>0&&g.length>0?this.createTexture2D({flipY:!0,data:g,format:A.LUMINANCE,type:A.FLOAT,width:y,height:m}):this.createTexture2D({flipY:!0,data:[1],format:A.LUMINANCE,type:A.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Y.exports.isNumber(o)?o:1,u_linearColor:f,u_sourceColor:h,u_targetColor:v,u_vertexScale:c}}},{key:"initModels",value:function(i){this.buildModels(i)}},{key:"clearModels",value:function(){var i;(i=this.dataTexture)===null||i===void 0||i.destroy()}},{key:"getShaders",value:function(){var i=this.layer.getLayerConfig(),a=i.sourceColor,o=i.targetColor;return a&&o?{frag:jq,vert:P1,type:"lineSimpleLinear"}:{frag:Wq,vert:P1,type:"lineSimpleNormal"}}},{key:"buildModels",value:function(i){var a=this.layer.getLayerConfig(),o=a.mask,s=o===void 0?!1:o,u=a.maskInside,l=u===void 0?!0:u,c=this.getShaders(),f=c.frag,h=c.vert,v=c.type;this.layer.buildLayerModel({moduleName:v,vertexShader:h,fragmentShader:f,triangulation:AX,primitive:A.LINES,depth:{enable:!1},blend:this.getBlend(),stencil:le(s,l),pick:!1}).then(function(p){i([p])}).catch(function(p){console.warn(p),i([])})}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distance",type:nt.Attribute,descriptor:{name:"a_Distance",buffer:{usage:A.STATIC_DRAW,data:[],type:A.FLOAT},size:1,update:function(a,o,s){return[s[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:nt.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:A.STATIC_DRAW,data:[],type:A.FLOAT},size:1,update:function(a,o,s){return[s[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:nt.Attribute,descriptor:{name:"a_Size",buffer:{usage:A.DYNAMIC_DRAW,data:[],type:A.FLOAT},size:2,update:function(a){var o=a.size,s=o===void 0?1:o;return Array.isArray(s)?[s[0],s[1]]:[s,0]}}})}}]),t}(qt);function Yq(r){var n=Zq();return function(){var e=B(r),i;if(n){var a=B(this).constructor;i=Reflect.construct(e,arguments,a)}else i=e.apply(this,arguments);return et(this,i)}}function Zq(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var qq=`#define Animate 0.0
#define LineTexture 1.0

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_opacity : 1.0;
uniform float u_textureBlend;
uniform float u_iconStepCount;
uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying vec2 v_iconMapUV;
varying float v_blur;
varying float v_radio;
varying vec4 v_color;
varying vec4 v_dataset;

#pragma include "picking"

void main() {
  float opacity = u_opacity;
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = v_dataset.r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float v = v_dataset.a;

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + animateSpeed);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = v_dataset.g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = v_dataset.b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = v_dataset.a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 start
    float flag = 0.0;
    if(u > 1.0/u_iconStepCount) {
      flag = 1.0;
    }
    u = fract(u*u_iconStepCount);
    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 end

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    // Tip: \u5224\u65AD\u7EB9\u7406\u95F4\u9694
    if(flag > 0.0) {
      pattern = vec4(0.0);
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  }
  

  // blur - AA
  if(v < v_blur) {
    gl_FragColor.a = mix(0.0, gl_FragColor.a, v/v_blur);
  } else if(v > 1.0 - v_blur) {
    gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - v_blur))/v_blur);
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,Kq=`#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;
attribute vec2 a_iconMapUV;
attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;
uniform float u_heightfixed;
uniform float u_linearColor: 0;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;
varying vec4 v_color;
varying float v_blur;
varying float v_radio;
varying vec4 v_dataset;

void main() {


  float d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  if(u_heightfixed < 1.0) {     // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
    d_texPixelLen = project_pixel(u_icon_step);
  } else {
    d_texPixelLen = u_icon_step;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  if(u_animate.x == Animate || u_linearColor == 1.0) {
      d_distance_ratio = a_Distance / a_Total_Distance;
  }

  float miter = (a_Miter + 1.0)/2.0;
  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  v_dataset[0] = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  v_dataset[1] = a_Distance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  v_dataset[2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  v_dataset[3] = miter;          // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C 0 - 1

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float originSize = a_Size.x;  // \u56FA\u5B9A\u9AD8\u5EA6
  if(u_heightfixed < 1.0) {     // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
    originSize = project_float_pixel(a_Size.x);
  }

  float wallHeight = originSize * miter;
  float lightWeight = calc_lighting(vec4(project_pos.xy, wallHeight, 1.0));

  v_blur = min(project_float_pixel(2.0) / originSize, 0.05);
  v_color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, wallHeight, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, wallHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,Qq=function(r){tt(t,r);var n=Yq(t);function t(){var e;$(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return e=n.call.apply(n,[this].concat(a)),S(I(e),"updateTexture",function(){var s=e.rendererService.createTexture2D;if(e.texture){e.texture.update({data:e.iconService.getCanvas()}),e.layer.render();return}e.texture=s({data:e.iconService.getCanvas(),mag:A.NEAREST,min:A.NEAREST,premultiplyAlpha:!1,width:1024,height:e.iconService.canvasHeight||128})}),e}return H(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=a===void 0?1:a,s=i.sourceColor,u=i.targetColor,l=i.textureBlend,c=l===void 0?"normal":l,f=i.heightfixed,h=f===void 0?!1:f,v=i.lineTexture,p=v===void 0?!1:v,d=i.iconStep,g=d===void 0?100:d,y=i.iconStepCount,m=y===void 0?1:y;this.rendererService.getDirty()&&this.texture.bind();var x=0,_=[0,0,0,0],E=[0,0,0,0];return s&&u&&(_=Ut(s),E=Ut(u),x=1),{u_heightfixed:Number(h),u_opacity:Y.exports.isNumber(o)?o:1,u_textureBlend:c==="normal"?0:1,u_texture:this.texture,u_line_texture:p?1:0,u_iconStepCount:m,u_icon_step:g,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:x,u_sourceColor:_,u_targetColor:E}}},{key:"getAnimateUniforms",value:function(){var i=this.layer.getLayerConfig(),a=i.animateOption;return{u_animate:this.animateOption2Array(a),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(i){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels(i)}},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(i){this.layer.buildLayerModel({moduleName:"lineWall",vertexShader:Kq,fragmentShader:qq,triangulation:ua,depth:{enable:!1},blend:this.getBlend()}).then(function(a){i([a])}).catch(function(a){console.warn(a),i([])})}},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"distance",type:nt.Attribute,descriptor:{name:"a_Distance",buffer:{usage:A.STATIC_DRAW,data:[],type:A.FLOAT},size:1,update:function(o,s,u){return[u[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:nt.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:A.STATIC_DRAW,data:[],type:A.FLOAT},size:1,update:function(o,s,u){return[u[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:nt.Attribute,descriptor:{name:"a_Size",buffer:{usage:A.DYNAMIC_DRAW,data:[],type:A.FLOAT},size:2,update:function(o){var s=o.size,u=s===void 0?1:s;return Array.isArray(u)?[u[0],u[1]]:[u,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:nt.Attribute,descriptor:{name:"a_Normal",buffer:{usage:A.STATIC_DRAW,data:[],type:A.FLOAT},size:3,update:function(o,s,u,l,c){return c}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:nt.Attribute,descriptor:{name:"a_Miter",buffer:{usage:A.STATIC_DRAW,data:[],type:A.FLOAT},size:1,update:function(o,s,u){return[u[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:nt.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:A.DYNAMIC_DRAW,data:[],type:A.FLOAT},size:2,update:function(o){var s=i.iconService.getIconMap(),u=o.texture,l=s[u]||{x:0,y:0},c=l.x,f=l.y;return[c,f]}}})}}]),t}(qt),Jq={arc:rq,arc3d:cq,greatcircle:bq,wall:Qq,line:Bq,halfLine:Lq,simple:Xq,linearline:$q,vectorline:RT,tileLine:hv,earthArc3d:mq};const tK=Jq;function eK(r){var n=rK();return function(){var e=B(r),i;if(n){var a=B(this).constructor;i=Reflect.construct(e,arguments,a)}else i=e.apply(this,arguments);return et(this,i)}}function rK(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var nK=function(r){tt(t,r);var n=eK(t);function t(){var e;$(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return e=n.call.apply(n,[this].concat(a)),S(I(e),"type","LineLayer"),S(I(e),"arrowInsertCount",0),S(I(e),"defaultSourceConfig",{data:[{lng1:100,lat1:30,lng2:130,lat2:30}],options:{parser:{type:"json",x:"lng1",y:"lat1",x1:"lng2",y1:"lat2"}}}),e}return H(t,[{key:"buildModels",value:function(){var i=this,a=this.getModelType();this.layerModel=new tK[a](this),this.layerModel.initModels(function(o){i.dispatchModelLoad(o)})}},{key:"rebuildModels",value:function(){var i=this;this.layerModel.buildModels(function(a){i.dispatchModelLoad(a)})}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var i=this.getModelType(),a={line:{},linearline:{},simple:{},wall:{},arc3d:{blend:"additive"},arc:{blend:"additive"},greatcircle:{blend:"additive"},vectorline:{},tileLine:{},halfLine:{},earthArc3d:{}};return a[i]}},{key:"getModelType",value:function(){var i;if(this.layerType)return this.layerType;var a=this.layerSource.getParserType();if(CT(a))return"vectorline";var o=this.styleAttributeService.getLayerStyleAttribute("shape"),s=o==null||(i=o.scale)===null||i===void 0?void 0:i.field;return s||"line"}}]),t}(mo);function iK(r){var n=aK();return function(){var e=B(r),i;if(n){var a=B(this).constructor;i=Reflect.construct(e,arguments,a)}else i=e.apply(this,arguments);return et(this,i)}}function aK(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var oK=`varying vec4 v_color;
uniform float u_opacity: 1.0;

uniform float u_pickLight: 0.0;

#pragma include "picking"

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

uniform float u_opacitylinear: 0.0;
uniform float u_opacitylinear_dir: 1.0;

void main() {
  float opacity = styleMappingMat[0][0];
  float lightWeight = styleMappingMat[1][3];
  float barLinearZ = styleMappingMat[2][3];

  // \u8BBE\u7F6E\u5706\u67F1\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, barLinearZ);
    gl_FragColor.rgb *= lightWeight;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // \u5E94\u7528\u900F\u660E\u5EA6
  gl_FragColor.a *= opacity;

  // \u5F00\u542F\u900F\u660E\u5EA6\u6E10\u53D8
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_opacitylinear_dir > 0.0 ? (1.0 - barLinearZ): barLinearZ;
  }

  // picking
  if(u_pickLight > 0.0) {
    gl_FragColor = filterColorAlpha(gl_FragColor, lightWeight);
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,sK=`precision highp float;

#define pi 3.1415926535
#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec3 a_Position;
attribute vec3 a_Pos;
attribute vec4 a_Color;
attribute vec3 a_Size;
attribute vec3 a_Normal;

uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_globel;
uniform float u_r;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform float u_lightEnable: 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) + 
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA - lightWeight
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1] - linearZ(\u5782\u76F4\u65B9\u5411 0 - 1 \u7684\u503C)
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec3 size = a_Size * a_Position;

  // a_Position.z \u662F\u5728\u6784\u5EFA\u7F51\u683C\u7684\u65F6\u5019\u4F20\u5165\u7684\u6807\u51C6\u503C 0 - 1\uFF0C\u5728\u63D2\u503C\u5668\u63D2\u503C\u53EF\u4EE5\u83B7\u53D6 0\uFF5E1 \u7EBF\u6027\u6E10\u53D8\u7684\u503C
  styleMappingMat[2][3] =  a_Position.z;

  vec3 offset = size; // \u63A7\u5236\u5706\u67F1\u4F53\u7684\u5927\u5C0F - \u4ECE\u6807\u51C6\u5355\u4F4D\u5706\u67F1\u4F53\u8FDB\u884C\u504F\u79FB
  if(u_heightfixed < 1.0) { // \u5706\u67F1\u4F53\u4E0D\u56FA\u5B9A\u9AD8\u5EA6
    
    if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
      offset = offset * pow(2.0, (19.0 - u_Zoom));
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
      // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
      offset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));
    }
  } else {// \u5706\u67F1\u4F53\u56FA\u5B9A\u9AD8\u5EA6 \uFF08 \u5904\u7406 mapbox \uFF09
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);
    }
  }


  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  // u_r \u63A7\u5236\u5706\u67F1\u7684\u751F\u957F
  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);

  // \u5706\u67F1\u5149\u7167\u6548\u679C
  float lightWeight = 1.0;
  if(u_lightEnable > 0.0) { // \u53D6\u6D88\u4E09\u5143\u8868\u8FBE\u5F0F\uFF0C\u589E\u5F3A\u5065\u58EE\u6027
    lightWeight = calc_lighting(pos);
  }
  styleMappingMat[1][3] = lightWeight;

  v_color =vec4(a_Color.rgb * lightWeight, a_Color.w);

  
  // \u5728\u5730\u7403\u6A21\u5F0F\u4E0B\uFF0C\u5C06\u539F\u672C\u5782\u76F4\u4E8E xy \u5E73\u9762\u7684\u5706\u67F1\u8C03\u6574\u59FF\u6001\u5230\u9002\u5E94\u5706\u7684\u89D2\u5EA6
  //\u65CB\u8F6C\u77E9\u9635mx\uFF0C\u521B\u5EFA\u7ED5x\u8F74\u65CB\u8F6C\u77E9\u9635
  float r = sqrt(a_Pos.z*a_Pos.z + a_Pos.x*a_Pos.x);
  float xRadian = getXRadian(a_Pos.y, r);
  float xcos = cos(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
  float xsin = sin(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
  mat4 mx = mat4(
    1,0,0,0,  
    0,xcos,-xsin,0,  
    0,xsin,xcos,0,  
    0,0,0,1);

  //\u65CB\u8F6C\u77E9\u9635my\uFF0C\u521B\u5EFA\u7ED5y\u8F74\u65CB\u8F6C\u77E9\u9635
  float yRadian = getYRadian(a_Pos.x, a_Pos.z);
  float ycos = cos(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
  float ysin = sin(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
  mat4 my = mat4(
    ycos,0,-ysin,0,  
    0,1,0,0,  
    ysin,0,ycos,0,  
    0,0,0,1);

  gl_Position = u_ViewProjectionMatrix * vec4(( my * mx *  vec4(a_Position * a_Size, 1.0)).xyz + a_Pos, 1.0);
  

  setPickingColor(a_PickingColor);
}
`,uK=function(r){tt(t,r);var n=iK(t);function t(){var e;$(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return e=n.call.apply(n,[this].concat(a)),S(I(e),"raiseCount",0),S(I(e),"raiseRepeat",0),e}return H(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.animateOption,o=a===void 0?{enable:!1,speed:.01,repeat:!1}:a,s=i.opacity,u=s===void 0?1:s,l=i.sourceColor,c=i.targetColor,f=i.pickLight,h=f===void 0?!1:f,v=i.heightfixed,p=v===void 0?!1:v,d=i.opacityLinear,g=d===void 0?{enable:!1,dir:"up"}:d,y=i.lightEnable,m=y===void 0?!0:y;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var x=this.layer.getEncodedData(),_=this.calDataFrame(this.cellLength,x,this.cellProperties),E=_.data,b=_.width,M=_.height;this.rowCount=M,this.dataTexture=this.cellLength>0&&E.length>0?this.createTexture2D({flipY:!0,data:E,format:A.LUMINANCE,type:A.FLOAT,width:b,height:M}):this.createTexture2D({flipY:!0,data:[1],format:A.LUMINANCE,type:A.FLOAT,width:1,height:1})}var T=0,k=[0,0,0,0],L=[0,0,0,0];if(l&&c&&(k=Ut(l),L=Ut(c),T=1),this.raiseCount<1&&this.raiseRepeat>0&&o.enable){var O=o.speed,D=O===void 0?.01:O;this.raiseCount+=D,this.raiseCount>=1&&(this.raiseRepeat>1?(this.raiseCount=0,this.raiseRepeat--):this.raiseCount=1)}return{u_pickLight:Number(h),u_heightfixed:Number(p),u_r:o.enable&&this.raiseRepeat>0?this.raiseCount:1,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Y.exports.isNumber(u)?u:1,u_linearColor:T,u_sourceColor:k,u_targetColor:L,u_opacitylinear:Number(g.enable),u_opacitylinear_dir:g.dir==="up"?1:0,u_lightEnable:Number(m)}}},{key:"initModels",value:function(i){this.buildModels(i)}},{key:"buildModels",value:function(i){var a=this.layer.getLayerConfig(),o=a.animateOption.repeat,s=o===void 0?1:o;this.raiseRepeat=s,this.layer.buildLayerModel({moduleName:"pointEarthExtrude",vertexShader:sK,fragmentShader:oK,triangulation:xT,depth:{enable:!0},cull:{enable:!0,face:kc(this.mapService.version)},blend:this.getBlend()}).then(function(u){i([u])}).catch(function(u){console.warn(u),i([])})}},{key:"clearModels",value:function(){var i;(i=this.dataTexture)===null||i===void 0||i.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:nt.Attribute,descriptor:{name:"a_Size",buffer:{usage:A.DYNAMIC_DRAW,data:[],type:A.FLOAT},size:3,update:function(a){var o=a.size;if(o){var s=[];return Array.isArray(o)&&(s=o.length===2?[o[0],o[0],o[1]]:o),Array.isArray(o)||(s=[o,o,o]),s}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:nt.Attribute,descriptor:{name:"a_Normal",buffer:{usage:A.STATIC_DRAW,data:[],type:A.FLOAT},size:3,update:function(a,o,s,u,l){return l}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:nt.Attribute,descriptor:{name:"a_Pos",buffer:{usage:A.DYNAMIC_DRAW,data:[],type:A.FLOAT},size:3,update:function(a){var o=Or(a.coordinates);return mT([o[0],o[1]])}}})}}]),t}(qt);function lK(r){var n=cK();return function(){var e=B(r),i;if(n){var a=B(this).constructor;i=Reflect.construct(e,arguments,a)}else i=e.apply(this,arguments);return et(this,i)}}function cK(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var fK=`uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"


void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];
  float stroke_opacity = styleMappingMat[0][1];
  float strokeWidth = styleMappingMat[0][2];
  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + strokeWidth);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  if(outer_df > antialiasblur + 0.018) discard;

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  if(strokeWidth < 0.01) {
    gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);
  } else {
    gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), strokeColor * stroke_opacity, color_t);
  }

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor.a *= opacity_t;
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,hK=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
uniform vec2 u_offsets;

uniform float u_blur : 0.0;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"


void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  /*
  *  setPickingSize \u8BBE\u7F6E\u62FE\u53D6\u5927\u5C0F
  */
  float newSize = setPickingSize(a_Size);
  // float newSize = setPickingSize(a_Size) * 0.00001038445708445579;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 strokeOpacityAndOffset = calStrokeOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = strokeOpacityAndOffset.r;
  textureOffset = strokeOpacityAndOffset.g;

  vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }

  // cal style mapping

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur);

  // TODP: /abs(extrude.x) \u662F\u4E3A\u4E86\u517C\u5BB9\u5730\u7403\u6A21\u5F0F
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);


  gl_Position = u_ViewProjectionMatrix * vec4(a_Position + extrude * newSize * 0.1, 1.0);

  setPickingColor(a_PickingColor);
}
`,vK=function(r){tt(t,r);var n=lK(t);function t(){return $(this,t),n.apply(this,arguments)}return H(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=a===void 0?1:a,s=i.strokeOpacity,u=s===void 0?1:s,l=i.strokeWidth,c=l===void 0?0:l,f=i.stroke,h=f===void 0?"rgba(0,0,0,0)":f,v=i.offsets,p=v===void 0?[0,0]:v,d=i.blend,g=i.blur,y=g===void 0?0:g;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:o,strokeOpacity:u,strokeWidth:c,stroke:h,offsets:p})){this.judgeStyleAttributes({opacity:o,strokeOpacity:u,strokeWidth:c,stroke:h,offsets:p});var m=this.layer.getEncodedData(),x=this.calDataFrame(this.cellLength,m,this.cellProperties),_=x.data,E=x.width,b=x.height;this.rowCount=b,this.dataTexture=this.cellLength>0&&_.length>0?this.createTexture2D({flipY:!0,data:_,format:A.LUMINANCE,type:A.FLOAT,width:E,height:b}):this.createTexture2D({flipY:!0,data:[1],format:A.LUMINANCE,type:A.FLOAT,width:1,height:1})}return{u_blur:y,u_additive:d==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Y.exports.isNumber(o)?o:1,u_stroke_opacity:Y.exports.isNumber(u)?u:1,u_stroke_width:Y.exports.isNumber(c)?c:1,u_stroke_color:this.getStrokeColor(h),u_offsets:this.isOffsetStatic(p)?p:[0,0]}}},{key:"getAnimateUniforms",value:function(){var i=this.layer.getLayerConfig(),a=i.animateOption,o=a===void 0?{enable:!1}:a;return{u_animate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(i){this.buildModels(i)}},{key:"buildModels",value:function(i){this.layer.triangulation=C1,this.layer.buildLayerModel({moduleName:"pointEarthFill",vertexShader:hK,fragmentShader:fK,triangulation:C1,depth:{enable:!0},blend:this.getBlend()}).then(function(a){i([a])}).catch(function(a){console.warn(a),i([])})}},{key:"clearModels",value:function(){var i;(i=this.dataTexture)===null||i===void 0||i.destroy()}},{key:"animateOption2Array",value:function(i){return[i.enable?0:1,i.speed||1,i.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:nt.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:A.DYNAMIC_DRAW,data:[],type:A.FLOAT},size:3,update:function(o,s,u,l){var c=kt(u,3),f=c[0],h=c[1],v=c[2],p=_e(0,0,1),d=_e(f,0,v),g=f>=0?wd(p,d):Math.PI*2-wd(p,d),y=Math.PI*2-Math.asin(h/100),m=fr();kl(m,m,g),Fl(m,m,y);var x=_e(1,1,0);Ks(x,x,m),zo(x,x);var _=_e(-1,1,0);Ks(_,_,m),zo(_,_);var E=_e(-1,-1,0);Ks(E,E,m),zo(E,E);var b=_e(1,-1,0);Ks(b,b,m),zo(b,b);var M=[].concat(it(x),it(_),it(E),it(b)),T=l%4*3;return[M[T],M[T+1],M[T+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:nt.Attribute,descriptor:{name:"a_Size",buffer:{usage:A.DYNAMIC_DRAW,data:[],type:A.FLOAT},size:1,update:function(o,s,u,l){var c=o.size,f=c===void 0?5:c;return Array.isArray(f)?[f[0]]:[f]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:nt.Attribute,descriptor:{name:"a_Shape",buffer:{usage:A.DYNAMIC_DRAW,data:[],type:A.FLOAT},size:1,update:function(o,s,u,l){var c=o.shape,f=c===void 0?2:c,h=i.layer.getLayerConfig().shape2d,v=h.indexOf(f);return[v]}}})}}]),t}(qt);function pK(r){var n=dK();return function(){var e=B(r),i;if(n){var a=B(this).constructor;i=Reflect.construct(e,arguments,a)}else i=e.apply(this,arguments);return et(this,i)}}function dK(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var gK=`varying vec4 v_color;
uniform float u_opacity: 1.0;

uniform float u_pickLight: 0.0;

#pragma include "picking"

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

uniform float u_opacitylinear: 0.0;
uniform float u_opacitylinear_dir: 1.0;

void main() {
  float opacity = styleMappingMat[0][0];
  float lightWeight = styleMappingMat[1][3];
  float barLinearZ = styleMappingMat[2][3];

  // \u8BBE\u7F6E\u5706\u67F1\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, barLinearZ);
    gl_FragColor.rgb *= lightWeight;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // \u5E94\u7528\u900F\u660E\u5EA6
  gl_FragColor.a *= opacity;

  // \u5F00\u542F\u900F\u660E\u5EA6\u6E10\u53D8
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_opacitylinear_dir > 0.0 ? (1.0 - barLinearZ): barLinearZ;
  }

  // picking
  if(u_pickLight > 0.0) {
    gl_FragColor = filterColorAlpha(gl_FragColor, lightWeight);
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,yK=`precision highp float;

#define pi 3.1415926535
#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec3 a_Position;
attribute vec3 a_Pos;
attribute vec4 a_Color;
attribute vec3 a_Size;
attribute vec3 a_Normal;

uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_r;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform float u_lightEnable: 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) + 
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA - lightWeight
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1] - linearZ(\u5782\u76F4\u65B9\u5411 0 - 1 \u7684\u503C)
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec3 size = a_Size * a_Position;

  // a_Position.z \u662F\u5728\u6784\u5EFA\u7F51\u683C\u7684\u65F6\u5019\u4F20\u5165\u7684\u6807\u51C6\u503C 0 - 1\uFF0C\u5728\u63D2\u503C\u5668\u63D2\u503C\u53EF\u4EE5\u83B7\u53D6 0\uFF5E1 \u7EBF\u6027\u6E10\u53D8\u7684\u503C
  styleMappingMat[2][3] =  a_Position.z;

  vec3 offset = size; // \u63A7\u5236\u5706\u67F1\u4F53\u7684\u5927\u5C0F - \u4ECE\u6807\u51C6\u5355\u4F4D\u5706\u67F1\u4F53\u8FDB\u884C\u504F\u79FB
  if(u_heightfixed < 1.0) { // \u5706\u67F1\u4F53\u4E0D\u56FA\u5B9A\u9AD8\u5EA6
    
    if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
      offset = offset * pow(2.0, (19.0 - u_Zoom));
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
      // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
      offset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));
    }
  } else {// \u5706\u67F1\u4F53\u56FA\u5B9A\u9AD8\u5EA6 \uFF08 \u5904\u7406 mapbox \uFF09
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);
    }
  }


  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  // u_r \u63A7\u5236\u5706\u67F1\u7684\u751F\u957F
  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);

  // \u5706\u67F1\u5149\u7167\u6548\u679C
  float lightWeight = 1.0;
  if(u_lightEnable > 0.0) { // \u53D6\u6D88\u4E09\u5143\u8868\u8FBE\u5F0F\uFF0C\u589E\u5F3A\u5065\u58EE\u6027
    lightWeight = calc_lighting(pos);
  }
  styleMappingMat[1][3] = lightWeight;

  v_color =vec4(a_Color.rgb * lightWeight, a_Color.w);

  // gl_Position = project_common_position_to_clipspace(pos);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * pos;
  } else {
    gl_Position = project_common_position_to_clipspace(pos);
  }

  setPickingColor(a_PickingColor);
}
`,mK=function(r){tt(t,r);var n=pK(t);function t(){var e;$(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return e=n.call.apply(n,[this].concat(a)),S(I(e),"raiseCount",0),S(I(e),"raiseRepeat",0),e}return H(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.animateOption,o=a===void 0?{enable:!1,speed:.01,repeat:!1}:a,s=i.opacity,u=s===void 0?1:s,l=i.sourceColor,c=i.targetColor,f=i.pickLight,h=f===void 0?!1:f,v=i.heightfixed,p=v===void 0?!1:v,d=i.opacityLinear,g=d===void 0?{enable:!1,dir:"up"}:d,y=i.lightEnable,m=y===void 0?!0:y;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var x=this.layer.getEncodedData(),_=this.calDataFrame(this.cellLength,x,this.cellProperties),E=_.data,b=_.width,M=_.height;this.rowCount=M,this.dataTexture=this.cellLength>0&&E.length>0?this.createTexture2D({flipY:!0,data:E,format:A.LUMINANCE,type:A.FLOAT,width:b,height:M}):this.createTexture2D({flipY:!0,data:[1],format:A.LUMINANCE,type:A.FLOAT,width:1,height:1})}var T=0,k=[0,0,0,0],L=[0,0,0,0];if(l&&c&&(k=Ut(l),L=Ut(c),T=1),this.raiseCount<1&&this.raiseRepeat>0&&o.enable){var O=o.speed,D=O===void 0?.01:O;this.raiseCount+=D,this.raiseCount>=1&&(this.raiseRepeat>1?(this.raiseCount=0,this.raiseRepeat--):this.raiseCount=1)}return{u_pickLight:Number(h),u_heightfixed:Number(p),u_r:o.enable&&this.raiseRepeat>0?this.raiseCount:1,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Y.exports.isNumber(u)?u:1,u_linearColor:T,u_sourceColor:k,u_targetColor:L,u_opacitylinear:Number(g.enable),u_opacitylinear_dir:g.dir==="up"?1:0,u_lightEnable:Number(m)}}},{key:"initModels",value:function(i){this.buildModels(i)}},{key:"buildModels",value:function(){var e=Mt(st.mark(function a(o){var s,u,l,c,f;return st.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:s=this.layer.getLayerConfig(),u=s.depth,l=u===void 0?!0:u,c=s.animateOption.repeat,f=c===void 0?1:c,this.raiseRepeat=f,this.layer.buildLayerModel({moduleName:"pointExtrude",vertexShader:yK,fragmentShader:gK,triangulation:xT,blend:this.getBlend(),cull:{enable:!0,face:kc(this.mapService.version)},depth:{enable:l}}).then(function(p){o([p])}).catch(function(p){console.warn(p),o([])});case 3:case"end":return v.stop()}},a,this)}));function i(a){return e.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.dataTexture)===null||i===void 0||i.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:nt.Attribute,descriptor:{name:"a_Size",buffer:{usage:A.DYNAMIC_DRAW,data:[],type:A.FLOAT},size:3,update:function(a){var o=a.size;if(o){var s=[];return Array.isArray(o)&&(s=o.length===2?[o[0],o[0],o[1]]:o),Array.isArray(o)||(s=[o,o,o]),s}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:nt.Attribute,descriptor:{name:"a_Normal",buffer:{usage:A.STATIC_DRAW,data:[],type:A.FLOAT},size:3,update:function(a,o,s,u,l){return l}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:nt.Attribute,descriptor:{name:"a_Pos",buffer:{usage:A.DYNAMIC_DRAW,data:[],type:A.FLOAT},size:3,update:function(a){var o=Or(a.coordinates);return[o[0],o[1],0]}}})}}]),t}(qt);function xK(r){var n=_K();return function(){var e=B(r),i;if(n){var a=B(this).constructor;i=Reflect.construct(e,arguments,a)}else i=e.apply(this,arguments);return et(this,i)}}function _K(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var B1=`
uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

#pragma include "sdf_2d"
#pragma include "picking"

void main() {

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  
  outer_df = sdCircle(v_data.xy, 1.0);
  inner_df = sdCircle(v_data.xy, r);


  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );
  float PI = 3.14159;
  float N_RINGS = 3.0;
  float FREQ = 1.0;

 gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);

  float d = length(v_data.xy);
  if(d > 0.5) {
    discard;
  }
  float intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_animate.z - u_animate.y * u_time)), 0.0, 1.0);
  
  // \u6839\u636E\u53E0\u52A0\u6A21\u5F0F\u9009\u62E9\u6548\u679C
  if(u_additive > 0.0) {
    gl_FragColor *= intensity;
    // \u4F18\u5316\u6C34\u6CE2\u70B9 blend additive \u6A21\u5F0F\u4E0B\u6709\u7684\u62FE\u53D6\u6548\u679C 
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor = vec4(gl_FragColor.xyz, gl_FragColor.a * intensity);
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,CK=`uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"


void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];
  float stroke_opacity = styleMappingMat[0][1];
  float strokeWidth = styleMappingMat[0][2];
  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + strokeWidth);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  if(strokeWidth < 0.01) {
    gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);
  } else {
    gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), strokeColor * stroke_opacity, color_t);
  }

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor.a *= opacity_t;
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,Gf=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_meter2coord;
uniform float u_meteryScale;
uniform float u_isMeter;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
uniform vec2 u_offsets;

uniform float u_blur : 0.0;
uniform float u_raisingHeight: 0.0;
uniform float u_heightfixed: 0.0;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"


void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  /*
  *  setPickingSize \u8BBE\u7F6E\u62FE\u53D6\u5927\u5C0F
  *  u_meter2coord \u5728\u7B49\u9762\u79EF\u5927\u5C0F\u7684\u65F6\u5019\u8BBE\u7F6E\u5355\u4F4D
  */
  float newSize = setPickingSize(a_Size) * u_meter2coord;
  // float newSize = setPickingSize(a_Size) * 0.00001038445708445579;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 strokeOpacityAndOffset = calStrokeOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = strokeOpacityAndOffset.r;
  textureOffset = strokeOpacityAndOffset.g;

  vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur);

  vec2 offset = (extrude.xy * (newSize + u_stroke_width) + textrueOffsets);
  vec3 aPosition = a_Position;
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    if(newSize * pow(2.0, u_Zoom) < 48.0) {
      antialiasblur = max(antialiasblur, -0.05);
    } else if(newSize * pow(2.0, u_Zoom) < 128.0) {
      antialiasblur = max(antialiasblur, -0.6/pow(u_Zoom, 2.0));
    } else {
      antialiasblur = max(antialiasblur, -0.8/pow(u_Zoom, 2.0));
    }
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      aPosition.x += offset.x / u_meteryScale;
      aPosition.y += offset.y;
      offset = vec2(0.0);
    }
  }

  // TODP: /abs(extrude.x) \u662F\u4E3A\u4E86\u517C\u5BB9\u5730\u7403\u6A21\u5F0F
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);


  // vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));
  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  float raisingHeight = u_raisingHeight;

  if(u_heightfixed < 1.0) { // false
    raisingHeight = project_pixel(u_raisingHeight);
  } else {
     if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_raisingHeight * mapboxZoomScale;
    }
  }
 

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, raisingHeight, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, raisingHeight, 1.0));
  }
 
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,EK=function(r){tt(t,r);var n=xK(t);function t(){var e;$(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return e=n.call.apply(n,[this].concat(a)),S(I(e),"meter2coord",1),S(I(e),"meterYScale",1),S(I(e),"isMeter",!1),S(I(e),"unit","l7size"),e}return H(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=a===void 0?1:a,s=i.strokeOpacity,u=s===void 0?1:s,l=i.strokeWidth,c=l===void 0?0:l,f=i.stroke,h=f===void 0?"rgba(0,0,0,0)":f,v=i.offsets,p=v===void 0?[0,0]:v,d=i.blend,g=i.blur,y=g===void 0?0:g,m=i.raisingHeight,x=m===void 0?0:m,_=i.heightfixed,E=_===void 0?!1:_,b=i.unit,M=b===void 0?"l7size":b;if(this.updateUnit(M),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:o,strokeOpacity:u,strokeWidth:c,stroke:h,offsets:p})){this.judgeStyleAttributes({opacity:o,strokeOpacity:u,strokeWidth:c,stroke:h,offsets:p});var T=this.layer.getEncodedData(),k=this.calDataFrame(this.cellLength,T,this.cellProperties),L=k.data,O=k.width,D=k.height;this.rowCount=D,this.dataTexture=this.cellLength>0&&L.length>0?this.createTexture2D({flipY:!0,data:L,format:A.LUMINANCE,type:A.FLOAT,width:O,height:D}):this.createTexture2D({flipY:!0,data:[1],format:A.LUMINANCE,type:A.FLOAT,width:1,height:1})}return{u_raisingHeight:Number(x),u_heightfixed:Number(E),u_meter2coord:this.meter2coord,u_meteryScale:this.meterYScale,u_isMeter:Number(this.isMeter),u_blur:y,u_additive:d==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Y.exports.isNumber(o)?o:1,u_stroke_opacity:Y.exports.isNumber(u)?u:1,u_stroke_width:Y.exports.isNumber(c)?c:1,u_stroke_color:this.getStrokeColor(h),u_offsets:this.isOffsetStatic(p)?p:[0,0]}}},{key:"getAnimateUniforms",value:function(){var i=this.layer.getLayerConfig(),a=i.animateOption,o=a===void 0?{enable:!1}:a;return{u_animate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Ju)}},{key:"initModels",value:function(i){this.updateUnit("l7size"),this.buildModels(i)}},{key:"calMeter2Coord",value:function(){var i=kt(this.layer.getSource().extent,4),a=i[0],o=i[1],s=i[2],u=i[3],l=[(a+s)/2,(o+u)/2],c=this.mapService.version,f=Wt==null?void 0:Wt.mapboxgl;if(c===ae.MAPBOX&&f!==null&&f!==void 0&&f.MercatorCoordinate){var h=f.MercatorCoordinate.fromLngLat({lng:l[0],lat:l[1]},0),v=h.meterInMercatorCoordinateUnits(),p=new f.MercatorCoordinate(h.x-v,h.y,h.z),d=p.toLngLat(),g=new f.MercatorCoordinate(h.x,h.y-v,h.z),y=g.toLngLat();this.meter2coord=l[0]-d.lng,this.meterYScale=(y.lat-l[1])/this.meter2coord;return}var m=this.mapService.meterToCoord(l,[a,o]),x=this.mapService.meterToCoord(l,[s===a?s+.1:s,u===o?o+.1:u]);this.meter2coord=(m+x)/2,this.meter2coord||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:function(){var e=Mt(st.mark(function a(o){var s,u,l,c,f,h,v,p,d,g,y,m,x,_,E;return st.wrap(function(M){for(;;)switch(M.prev=M.next){case 0:s=this.layer.getLayerConfig(),u=s.mask,l=u===void 0?!1:u,c=s.maskInside,f=c===void 0?!0:c,h=s.animateOption,v=h===void 0?{enable:!1}:h,p=s.workerEnabled,d=p===void 0?!1:p,g=s.enablePicking,y=s.shape2d,m=this.getShaders(v),x=m.frag,_=m.vert,E=m.type,this.layer.triangulation=Ju,this.layer.buildLayerModel({moduleName:E,vertexShader:_,fragmentShader:x,triangulation:Ju,depth:{enable:!1},blend:this.getBlend(),stencil:le(l,f),workerEnabled:d,workerOptions:{modelType:E,enablePicking:g,shape2d:y}}).then(function(T){o([T])}).catch(function(T){console.warn(T),o([])});case 4:case"end":return M.stop()}},a,this)}));function i(a){return e.apply(this,arguments)}return i}()},{key:"getShaders",value:function(i){if(i.enable)switch(i.type){case"wave":return{frag:B1,vert:Gf,type:"pointWave"};default:return{frag:B1,vert:Gf,type:"pointWave"}}else return{frag:CK,vert:Gf,type:"pointFill"}}},{key:"clearModels",value:function(){var i;(i=this.dataTexture)===null||i===void 0||i.destroy()}},{key:"animateOption2Array",value:function(i){return[i.enable?0:1,i.speed||1,i.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var i=this.layer.getLayerConfig().shape2d;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:nt.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:A.DYNAMIC_DRAW,data:[],type:A.FLOAT},size:3,update:function(o,s,u,l){var c=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],f=l%4*3;return[c[f],c[f+1],c[f+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:nt.Attribute,descriptor:{name:"a_Size",buffer:{usage:A.DYNAMIC_DRAW,data:[],type:A.FLOAT},size:1,update:function(o){var s=o.size,u=s===void 0?5:s;return Array.isArray(u)?[u[0]]:[u]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:nt.Attribute,descriptor:{name:"a_Shape",buffer:{usage:A.DYNAMIC_DRAW,data:[],type:A.FLOAT},size:1,update:function(o){var s=o.shape,u=s===void 0?2:s,l=i.indexOf(u);return[l]}}})}},{key:"updateUnit",value:function(i){var a=this.mapService.version;this.unit!==i&&(this.unit!=="meter"&&i==="meter"&&a!==ae.L7MAP&&a!==ae.GLOBEL?(this.isMeter=!0,this.calMeter2Coord()):this.unit==="meter"&&i!=="meter"&&(this.isMeter=!1,this.meter2coord=1),this.unit=i)}}]),t}(qt);function SK(r){var n=bK();return function(){var e=B(r),i;if(n){var a=B(this).constructor;i=Reflect.construct(e,arguments,a)}else i=e.apply(this,arguments);return et(this,i)}}function bK(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var AK=`uniform sampler2D u_texture;
uniform vec2 u_textSize;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "sdf_2d"
#pragma include "picking"
varying vec2 v_uv; // \u672C\u8EAB\u7684 uv \u5750\u6807
varying vec2 v_Iconuv;

void main() {

  float opacity = styleMappingMat[0][0];

  vec2 pos = v_Iconuv / u_textSize + v_uv / u_textSize * 64.;
  gl_FragColor = texture2D(u_texture, pos);
  gl_FragColor.a *= opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,TK=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute vec2 a_Uv;
attribute float a_Rotate;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform mat2 u_RotateMatrix;
uniform float u_isMeter;

varying vec2 v_uv; // \u672C\u8EAB\u7684 uv \u5750\u6807
varying vec2 v_Iconuv; // icon \u8D34\u56FE\u7684 uv \u5750\u6807

uniform float u_raisingHeight: 0.0;
uniform float u_heightfixed: 0.0;
uniform float u_opacity : 1;
uniform vec2 u_offsets;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  vec3 extrude = a_Extrude;

  v_uv = (a_Extrude.xy + 1.0)/2.0;
  v_uv.y = 1.0 - v_uv.y;
  v_Iconuv = a_Uv;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // empty - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  highp float angle_sin = sin(a_Rotate);
  highp float angle_cos = cos(a_Rotate);
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);

  // vec2 offset = (u_RotateMatrix * extrude.xy * (a_Size) + textrueOffsets);
  vec2 offset = (rotation_matrix * u_RotateMatrix * extrude.xy * (a_Size) + textrueOffsets);
  vec3 aPosition = a_Position;
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      aPosition.xy += offset;
      offset.x = 0.0;
      offset.y = 0.0;
    }
  }

  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  float raisingHeight = u_raisingHeight;
  if(u_heightfixed < 1.0) { // height fixed
    raisingHeight = project_pixel(u_raisingHeight);
  } else {
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_raisingHeight * mapboxZoomScale;
    }
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, raisingHeight, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, raisingHeight, 1.0));
  }
 
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,MK=function(r){tt(t,r);var n=SK(t);function t(){var e;$(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return e=n.call.apply(n,[this].concat(a)),S(I(e),"meter2coord",1),S(I(e),"isMeter",!1),S(I(e),"radian",0),S(I(e),"updateTexture",function(){var s=e.rendererService.createTexture2D;if(e.texture){e.texture.update({data:e.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),e.layerService.throttleRenderLayers();return}e.texture=s({data:e.iconService.getCanvas(),mag:A.LINEAR,min:A.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:e.iconService.canvasHeight||128,mipmap:!0})}),e}return H(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=a===void 0?1:a,s=i.offsets,u=s===void 0?[0,0]:s,l=i.rotation,c=i.raisingHeight,f=c===void 0?0:c,h=i.heightfixed,v=h===void 0?!1:h;this.rendererService.getDirty()&&this.texture.bind();var p=1;if((this.mapService.version==="GAODE2.x"||this.mapService.version==="GAODE1.x")&&(p=-1),this.radian=l!==void 0?p*Math.PI*l/180:p*Math.PI*(this.mapService.getRotation()%360)/180,this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:o,offsets:u})){this.judgeStyleAttributes({opacity:o,offsets:u});var d=this.layer.getEncodedData(),g=this.calDataFrame(this.cellLength,d,this.cellProperties),y=g.data,m=g.width,x=g.height;this.rowCount=x,this.dataTexture=this.cellLength>0&&y.length>0?this.createTexture2D({flipY:!0,data:y,format:A.LUMINANCE,type:A.FLOAT,width:m,height:x}):this.createTexture2D({flipY:!0,data:[1],format:A.LUMINANCE,type:A.FLOAT,width:1,height:1})}return{u_raisingHeight:Number(f),u_heightfixed:Number(v),u_isMeter:Number(this.isMeter),u_RotateMatrix:new Float32Array([Math.cos(this.radian),Math.sin(this.radian),-Math.sin(this.radian),Math.cos(this.radian)]),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:Y.exports.isNumber(o)?o:1,u_offsets:this.isOffsetStatic(u)?u:[0,0]}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Ji)}},{key:"initModels",value:function(i){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture);var a=this.layer.getLayerConfig(),o=a.unit,s=o===void 0?"l7size":o,u=this.mapService.version;s==="meter"&&u!==ae.L7MAP&&u!==ae.GLOBEL&&(this.isMeter=!0,this.calMeter2Coord()),this.buildModels(i)}},{key:"calMeter2Coord",value:function(){var i=kt(this.layer.getSource().extent,4),a=i[0],o=i[1],s=i[2],u=i[3],l=[(a+s)/2,(o+u)/2],c=this.mapService.version;if(c===ae.MAPBOX&&window.mapboxgl.MercatorCoordinate){var f=window.mapboxgl.MercatorCoordinate.fromLngLat({lng:l[0],lat:l[1]},0),h=1,v=h*f.meterInMercatorCoordinateUnits(),p=new window.mapboxgl.MercatorCoordinate(f.x-v,f.y,f.z),d=p.toLngLat();this.meter2coord=l[0]-d.lng;return}var g=this.mapService.meterToCoord(l,[a,o]),y=this.mapService.meterToCoord(l,[s===a?s+.1:s,u===o?o+.1:u]);this.meter2coord=(g+y)/2,this.meter2coord||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:function(i){var a=this.layer.getLayerConfig(),o=a.mask,s=o===void 0?!1:o,u=a.maskInside,l=u===void 0?!0:u;this.layer.buildLayerModel({moduleName:"pointFillImage",vertexShader:TK,fragmentShader:AK,triangulation:Ji,depth:{enable:!1},blend:this.getBlend(),stencil:le(s,l),cull:{enable:!0,face:kc(this.mapService.version)}}).then(function(c){i([c])}).catch(function(c){console.warn(c),i([])})}},{key:"clearModels",value:function(){var i,a;this.iconService.off("imageUpdate",this.updateTexture),(i=this.texture)===null||i===void 0||i.destroy(),(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"rotate",type:nt.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:A.DYNAMIC_DRAW,data:[],type:A.FLOAT},size:1,update:function(o){var s=o.rotate,u=s===void 0?0:s;return Array.isArray(u)?[u[0]]:[u]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:nt.Attribute,descriptor:{name:"a_Uv",buffer:{usage:A.DYNAMIC_DRAW,data:[],type:A.FLOAT},size:2,update:function(o){var s=i.iconService.getIconMap(),u=o.shape,l=s[u]||{x:0,y:0},c=l.x,f=l.y;return[c,f]}}}),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:nt.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:A.DYNAMIC_DRAW,data:[],type:A.FLOAT},size:3,update:function(o,s,u,l){var c=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],f=l%4*3;return[c[f],c[f+1],c[f+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:nt.Attribute,descriptor:{name:"a_Size",buffer:{usage:A.DYNAMIC_DRAW,data:[],type:A.FLOAT},size:1,update:function(o){var s=o.size,u=s===void 0?5:s;return Array.isArray(u)?[u[0]*i.meter2coord]:[u*i.meter2coord]}}})}}]),t}(qt);function wK(r){var n=LK();return function(){var e=B(r),i;if(n){var a=B(this).constructor;i=Reflect.construct(e,arguments,a)}else i=e.apply(this,arguments);return et(this,i)}}function LK(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var FK=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main(){
      float opacity = styleMappingMat[0][0];
      float size = styleMappingMat[1][0];
      vec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor;

      // Y = 0.299R + 0.587G + 0.114B // \u4EAE\u5EA6\u63D0\u53D6
     
      textureColor = texture2D(u_texture, pos);

      // Tip: \u53BB\u9664\u8FB9\u7F18\u90E8\u5206 mipmap \u5BFC\u81F4\u7684\u6DF7\u5408\u53D8\u6697
      float fragmengTocenter = distance(vec2(0.5), gl_PointCoord);
      if(fragmengTocenter >= 0.5) {
            float luma = 0.299 * textureColor.r + 0.587 * textureColor.g + 0.114 * textureColor.b;
            textureColor.a *= luma;
      }
      
      

      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }

      gl_FragColor.a = gl_FragColor.a * opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,kK=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec2 u_offsets;

uniform float u_opacity : 1;
uniform float u_raisingHeight: 0.0;
uniform float u_heightfixed: 0.0;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  styleMappingMat[1][0] = a_Size;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  v_color = a_Color;
  v_uv = a_Uv;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  vec2 offset = project_pixel(textrueOffsets);

  float raisingHeight = u_raisingHeight;
  if(u_heightfixed < 1.0) { // false
    raisingHeight = project_pixel(u_raisingHeight);
  } else {
     if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_raisingHeight * mapboxZoomScale;
    }
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, raisingHeight, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, raisingHeight, 1.0));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`,OK=function(r){tt(t,r);var n=wK(t);function t(){var e;$(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return e=n.call.apply(n,[this].concat(a)),S(I(e),"updateTexture",function(){var s=e.rendererService.createTexture2D;if(e.texture){e.texture.update({data:e.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),e.layerService.throttleRenderLayers();return}e.texture=s({data:e.iconService.getCanvas(),mag:A.LINEAR,min:A.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:e.iconService.canvasHeight||128,mipmap:!0})}),e}return H(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=a===void 0?1:a,s=i.offsets,u=s===void 0?[0,0]:s,l=i.raisingHeight,c=l===void 0?0:l,f=i.heightfixed,h=f===void 0?!1:f;if(this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:o,offsets:u})){this.judgeStyleAttributes({opacity:o,offsets:u});var v=this.layer.getEncodedData(),p=this.calDataFrame(this.cellLength,v,this.cellProperties),d=p.data,g=p.width,y=p.height;this.rowCount=y,this.dataTexture=this.cellLength>0&&d.length>0?this.createTexture2D({flipY:!0,data:d,format:A.LUMINANCE,type:A.FLOAT,width:g,height:y}):this.createTexture2D({flipY:!0,data:[1],format:A.LUMINANCE,type:A.FLOAT,width:1,height:1})}return{u_raisingHeight:Number(c),u_heightfixed:Number(h),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:Y.exports.isNumber(o)?o:1,u_offsets:this.isOffsetStatic(u)?u:[0,0]}}},{key:"initModels",value:function(i){this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels(i)}},{key:"clearModels",value:function(){var i,a;(i=this.texture)===null||i===void 0||i.destroy(),(a=this.dataTexture)===null||a===void 0||a.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(i){var a=this.layer.getLayerConfig(),o=a.mask,s=o===void 0?!1:o,u=a.maskInside,l=u===void 0?!0:u;this.layer.buildLayerModel({moduleName:"pointImage",vertexShader:kK,fragmentShader:FK,triangulation:bX,depth:{enable:!1},primitive:A.POINTS,blend:this.getBlend(),stencil:le(s,l)}).then(function(c){i([c])}).catch(function(c){console.warn(c),i([])})}},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:nt.Attribute,descriptor:{name:"a_Size",buffer:{usage:A.DYNAMIC_DRAW,data:[],type:A.FLOAT},size:1,update:function(o){var s=o.size,u=s===void 0?5:s;return Array.isArray(u)?[u[0]]:[u]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:nt.Attribute,descriptor:{name:"a_Uv",buffer:{usage:A.DYNAMIC_DRAW,data:[],type:A.FLOAT},size:2,update:function(o,s,u,l){var c=i.iconService.getIconMap(),f=o.shape,h=c[f]||{x:0,y:0},v=h.x,p=h.y;return[v,p]}}})}}]),t}(qt);function RK(r){var n=IK();return function(){var e=B(r),i;if(n){var a=B(this).constructor;i=Reflect.construct(e,arguments,a)}else i=e.apply(this,arguments);return et(this,i)}}function IK(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var DK=`uniform float u_opacity : 1;
varying vec4 v_color;
void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;
}
`,PK=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;

varying vec4 v_color;

#pragma include "projection"
#pragma include "project"

void main() {
  v_color = a_Color;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(a_Position.xy, a_Position.z, 1.0);
  } else {
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
}
`;function N1(r){var n=r.coordinates;return{vertices:it(n),indices:[0],size:n.length}}var BK=function(r){tt(t,r);var n=RK(t);function t(){return $(this,t),n.apply(this,arguments)}return H(t,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=a===void 0?1:a;return{u_opacity:Y.exports.isNumber(o)?o:1}}},{key:"initModels",value:function(i){this.buildModels(i)}},{key:"buildModels",value:function(i){var a=this.layer.getLayerConfig(),o=a.mask,s=o===void 0?!1:o,u=a.maskInside,l=u===void 0?!0:u;this.layer.triangulation=N1,this.layer.buildLayerModel({moduleName:"pointNormal",vertexShader:PK,fragmentShader:DK,triangulation:N1,depth:{enable:!1},primitive:A.POINTS,blend:this.getBlend(),stencil:le(s,l),pick:!1}).then(function(c){i([c])}).catch(function(c){console.warn(c),i([])})}},{key:"clearModels",value:function(){}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:nt.Attribute,descriptor:{name:"a_Size",buffer:{usage:A.DYNAMIC_DRAW,data:[],type:A.FLOAT},size:1,update:function(a){var o=a.size,s=o===void 0?1:o;return Array.isArray(s)?[s[0]]:[s]}}})}}]),t}(qt);function NK(r){var n=zK();return function(){var e=B(r),i;if(n){var a=B(this).constructor;i=Reflect.construct(e,arguments,a)}else i=e.apply(this,arguments);return et(this,i)}}function zK(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var UK=`
uniform float u_additive;
uniform float u_opacity: 1.0;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
varying vec2 v_exteude;
#pragma include "sdf_2d"
#pragma include "picking"

void main() {

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius);

  float outer_df = sdCircle(v_data.xy, 1.0);
  float inner_df = sdCircle(v_data.xy, r);

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  gl_FragColor = vec4(v_color.rgb, v_color.a * u_opacity);

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
  } else {
    gl_FragColor.a *= opacity_t;
  }

  if(gl_FragColor.a > 0.0) {
    gl_FragColor = filterColor(gl_FragColor);
  }

  vec2 extrude =  v_exteude;
  vec2 dir = normalize(extrude);
  vec2 baseDir = vec2(1.0, 0.0);
  float pi = 3.14159265359;
  // full circle
  // float rades = dot(dir, baseDir);
  // float flag = sign(dir.y);
  // float radar_v = (flag - 1.0) * -0.5 + flag * acos(rades)/pi/2.0;
  
  // half circle
  float flag = sign(dir.y);
  float rades = dot(dir, baseDir);
  float radar_v = (flag - 1.0) * -0.5 * acos(rades)/pi;
  // simple AA
  if(radar_v > 0.99) {
    radar_v = 1.0 - (radar_v - 0.99)/0.01;
  }

  gl_FragColor.a *= radar_v;
}
`,HK=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
uniform float u_speed: 1.0;
uniform float u_time;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_isMeter;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
varying vec2 v_exteude;

#pragma include "projection"
#pragma include "picking"

void main() {
  vec3 extrude = a_Extrude;
  float newSize = setPickingSize(a_Size);

  float time = u_time * u_speed;
  mat2 rotateMatrix = mat2( 
    cos(time), sin(time), 
    -sin(time), cos(time)
  );
  v_exteude = rotateMatrix * a_Extrude.xy;

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // anti-alias
  float blur = 0.0;
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, blur);

  vec2 offset = (extrude.xy * (newSize));
  vec3 aPosition = a_Position;
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    antialiasblur *= pow(19.0 - u_Zoom, 2.0);
    antialiasblur = max(antialiasblur, -0.01);
    // offset *= 0.5;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      aPosition.xy += offset;
      offset.x = 0.0;
      offset.y = 0.0;
    }
  }

  v_data = vec4(extrude.x, extrude.y, antialiasblur, -1.0);

  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,$K=function(r){tt(t,r);var n=NK(t);function t(){var e;$(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return e=n.call.apply(n,[this].concat(a)),S(I(e),"meter2coord",1),S(I(e),"isMeter",!1),e}return H(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=a===void 0?1:a,s=i.blend,u=i.speed,l=u===void 0?1:u;return{u_isMeter:Number(this.isMeter),u_speed:l,u_additive:s==="additive"?1:0,u_opacity:Y.exports.isNumber(o)?o:1}}},{key:"getAnimateUniforms",value:function(){var i=this.layer.getLayerConfig(),a=i.animateOption,o=a===void 0?{enable:!1}:a;return{u_animate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Ji)}},{key:"initModels",value:function(i){var a=this.layer.getLayerConfig(),o=a.unit,s=o===void 0?"l7size":o,u=this.mapService.version;s==="meter"&&u!==ae.L7MAP&&u!==ae.GLOBEL&&(this.isMeter=!0,this.calMeter2Coord()),this.buildModels(i)}},{key:"calMeter2Coord",value:function(){var i=kt(this.layer.getSource().extent,4),a=i[0],o=i[1],s=i[2],u=i[3],l=[(a+s)/2,(o+u)/2],c=this.mapService.version;if(c===ae.MAPBOX&&window.mapboxgl.MercatorCoordinate){var f=window.mapboxgl.MercatorCoordinate.fromLngLat({lng:l[0],lat:l[1]},0),h=1,v=h*f.meterInMercatorCoordinateUnits(),p=new window.mapboxgl.MercatorCoordinate(f.x-v,f.y,f.z),d=p.toLngLat();this.meter2coord=l[0]-d.lng;return}var g=this.mapService.meterToCoord(l,[a,o]),y=this.mapService.meterToCoord(l,[s===a?s+.1:s,u===o?o+.1:u]);this.meter2coord=(g+y)/2,this.meter2coord||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:function(i){var a=this.layer.getLayerConfig(),o=a.mask,s=o===void 0?!1:o,u=a.maskInside,l=u===void 0?!0:u;this.layer.buildLayerModel({moduleName:"pointRadar",vertexShader:HK,fragmentShader:UK,triangulation:Ji,depth:{enable:!1},blend:this.getBlend(),stencil:le(s,l)}).then(function(c){i([c])}).catch(function(c){console.warn(c),i([])})}},{key:"clearModels",value:function(){var i;(i=this.dataTexture)===null||i===void 0||i.destroy()}},{key:"animateOption2Array",value:function(i){return[i.enable?0:1,i.speed||1,i.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:nt.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:A.DYNAMIC_DRAW,data:[],type:A.FLOAT},size:3,update:function(o,s,u,l){var c=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],f=l%4*3;return[c[f],c[f+1],c[f+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:nt.Attribute,descriptor:{name:"a_Size",buffer:{usage:A.DYNAMIC_DRAW,data:[],type:A.FLOAT},size:1,update:function(o){var s=o.size,u=s===void 0?5:s;return Array.isArray(u)?[u[0]*i.meter2coord]:[u*i.meter2coord]}}})}}]),t}(qt);function GK(r){var n=VK();return function(){var e=B(r),i;if(n){var a=B(this).constructor;i=Reflect.construct(e,arguments,a)}else i=e.apply(this,arguments);return et(this,i)}}function VK(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var WK=`
uniform float u_opacity : 1;
uniform vec2 u_offsets;
uniform float u_additive;

uniform float u_stroke_opacity : 1;

uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

varying vec4 v_color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
varying float v_blur;
varying float v_innerRadius;

#pragma include "picking"
void main() {
  vec2 center = vec2(0.5);

  float opacity = styleMappingMat[0][0];
  // Tip: \u7247\u5143\u5230\u4E2D\u5FC3\u70B9\u7684\u8DDD\u79BB 0 - 1
  float fragmengTocenter = distance(center, gl_PointCoord) * 2.0;
  // Tip: \u7247\u5143\u7684\u526A\u5207\u6210\u5706\u5F62
  float circleClipOpacity = 1.0 - smoothstep(v_blur, 1.0, fragmengTocenter);


  if(v_innerRadius < 0.99) {
    // \u5F53\u5B58\u5728 stroke \u4E14 stroke > 0.01
    float blurWidth = (1.0 - v_blur)/2.0;
    vec4 stroke = vec4(u_stroke_color.rgb, u_stroke_opacity);
    if(fragmengTocenter > v_innerRadius + blurWidth) {
      gl_FragColor = stroke;
    } else if(fragmengTocenter > v_innerRadius - blurWidth){
      float mixR = (fragmengTocenter - (v_innerRadius - blurWidth)) / (blurWidth * 2.0);
      gl_FragColor = mix(v_color, stroke, mixR);
    } else {
      gl_FragColor = v_color;
    }
  } else {
    // \u5F53\u4E0D\u5B58\u5728 stroke \u6216 stroke <= 0.01
    gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity;

  gl_FragColor = filterColor(gl_FragColor);
  
  if(u_additive > 0.0) {
    gl_FragColor *= circleClipOpacity;
  } else {
    gl_FragColor.a *= circleClipOpacity;
  }

}
`,jK=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform vec2 u_offsets;
uniform float u_stroke_width;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143
varying float v_blur;
varying float v_innerRadius;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = a_Color;
  v_blur = 1.0 - max(2.0/a_Size, 0.05);
  v_innerRadius = max((a_Size - u_stroke_width) / a_Size, 0.0);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping
  
  vec2 offset = project_pixel(textrueOffsets);
  
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function z1(r){var n=r.coordinates;return{vertices:it(n),indices:[0],size:n.length}}var XK=function(r){tt(t,r);var n=GK(t);function t(){return $(this,t),n.apply(this,arguments)}return H(t,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=a===void 0?1:a,s=i.offsets,u=s===void 0?[0,0]:s,l=i.blend,c=i.strokeOpacity,f=c===void 0?1:c,h=i.strokeWidth,v=h===void 0?0:h,p=i.stroke,d=p===void 0?"#fff":p;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:o,offsets:u})){this.judgeStyleAttributes({opacity:o,offsets:u});var g=this.layer.getEncodedData(),y=this.calDataFrame(this.cellLength,g,this.cellProperties),m=y.data,x=y.width,_=y.height;this.rowCount=_,this.dataTexture=this.cellLength>0&&m.length>0?this.createTexture2D({flipY:!0,data:m,format:A.LUMINANCE,type:A.FLOAT,width:x,height:_}):this.createTexture2D({flipY:!0,data:[1],format:A.LUMINANCE,type:A.FLOAT,width:1,height:1})}return{u_additive:l==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Y.exports.isNumber(o)?o:1,u_offsets:this.isOffsetStatic(u)?u:[0,0],u_stroke_opacity:Y.exports.isNumber(f)?f:1,u_stroke_width:Y.exports.isNumber(v)?v:1,u_stroke_color:this.getStrokeColor(d)}}},{key:"initModels",value:function(i){this.buildModels(i)}},{key:"buildModels",value:function(i){var a=this.layer.getLayerConfig(),o=a.mask,s=o===void 0?!1:o,u=a.maskInside,l=u===void 0?!0:u;this.layer.triangulation=z1,this.layer.buildLayerModel({moduleName:"pointSimple",vertexShader:jK,fragmentShader:WK,triangulation:z1,depth:{enable:!1},primitive:A.POINTS,blend:this.getBlend(),stencil:le(s,l)}).then(function(c){i([c])}).catch(function(c){console.warn(c),i([])})}},{key:"clearModels",value:function(){var i;(i=this.dataTexture)===null||i===void 0||i.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:nt.Attribute,descriptor:{name:"a_Size",buffer:{usage:A.DYNAMIC_DRAW,data:[],type:A.FLOAT},size:1,update:function(a){var o=a.size,s=o===void 0?1:o;return Array.isArray(s)?[s[0]]:[s]}}})}}]),t}(qt);function YK(r,n){var t=typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(!t){if(Array.isArray(r)||(t=ZK(r))||n&&r&&typeof r.length=="number"){t&&(r=t);var e=0,i=function(){};return{s:i,n:function(){return e>=r.length?{done:!0}:{done:!1,value:r[e++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){t=t.call(r)},n:function(){var l=t.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(o)throw s}}}}function ZK(r,n){if(!!r){if(typeof r=="string")return U1(r,n);var t=Object.prototype.toString.call(r).slice(8,-1);if(t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set")return Array.from(r);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return U1(r,n)}}function U1(r,n){(n==null||n>r.length)&&(n=r.length);for(var t=0,e=new Array(n);t<n;t++)e[t]=r[t];return e}function qK(r){var n=KK();return function(){var e=B(r),i;if(n){var a=B(this).constructor;i=Reflect.construct(e,arguments,a)}else i=e.apply(this,arguments);return et(this,i)}}function KK(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var H1=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 48.0
uniform sampler2D u_sdf_map;
uniform float u_gamma_scale : 0.5;
// uniform float u_font_size : 24.0;
uniform float u_opacity : 1.0;
uniform vec4 u_stroke_color : [0, 0, 0, 1];
uniform float u_stroke_width : 2.0;
uniform float u_halo_blur : 0.5;
uniform float u_DevicePixelRatio;

varying vec4 v_color;
varying vec2 v_uv;
varying float v_gamma_scale;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  // get style data mapping
  float opacity = styleMappingMat[0][0];
  float strokeWidth = styleMappingMat[0][2];
  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  // get sdf from atlas
  float dist = texture2D(u_sdf_map, v_uv).a;

  // float fontScale = u_font_size / FONT_SIZE;

  // lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;
  lowp float buff = (6.0 - strokeWidth / v_fontScale) / SDF_PX;
  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;

  highp float gamma_scaled = gamma * v_gamma_scale;

  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);
  // gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), vec4(u_stroke_color.rgb, u_stroke_color.a * u_opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), vec4(textrueStroke.rgb, textrueStroke.a * opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor.a= gl_FragColor.a * alpha;
  gl_FragColor = filterColor(gl_FragColor);
}
`,$1=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 24.0
attribute vec3 a_Position;
attribute vec2 a_tex;
attribute vec2 a_textOffsets;
attribute vec4 a_Color;
attribute float a_Size;
attribute float a_Rotate;

uniform vec2 u_sdf_map_size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_raisingHeight: 0.0;

varying vec2 v_uv;
varying float v_gamma_scale;
varying vec4 v_color;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

   vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  v_uv = a_tex / u_sdf_map_size;

  // \u6587\u672C\u7F29\u653E\u6BD4\u4F8B
  float fontScale = a_Size / FONT_SIZE;
  v_fontScale = fontScale;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  highp float angle_sin = sin(a_Rotate);
  highp float angle_cos = cos(a_Rotate);
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  
  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);

  float raiseHeight = u_raisingHeight;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    raiseHeight = u_raisingHeight * mapboxZoomScale;
  }

  vec4 projected_position;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
   projected_position  = u_Mvp * (vec4(a_Position.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));
  } else { // else
   projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));
  }

  gl_Position = vec4(
    projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);
  v_gamma_scale = gl_Position.w;
  setPickingColor(a_PickingColor);

}
`;function G1(r){var n=this,t=r.id,e=[],i=[];if(!n.glyphInfoMap||!n.glyphInfoMap[t])return{vertices:[],indices:[],size:7};var a=n.glyphInfoMap[t].centroid,o=a.length===2?[a[0],a[1],0]:a;return n.glyphInfoMap[t].glyphQuads.forEach(function(s,u){e.push.apply(e,it(o).concat([s.tex.x,s.tex.y+s.tex.height,s.tl.x,s.tl.y],it(o),[s.tex.x+s.tex.width,s.tex.y+s.tex.height,s.tr.x,s.tr.y],it(o),[s.tex.x+s.tex.width,s.tex.y,s.br.x,s.br.y],it(o),[s.tex.x,s.tex.y,s.bl.x,s.bl.y])),i.push(0+u*4,1+u*4,2+u*4,2+u*4,3+u*4,0+u*4)}),{vertices:e,indices:i,size:7}}var QK=function(r){tt(t,r);var n=qK(t);function t(){var e;$(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return e=n.call.apply(n,[this].concat(a)),S(I(e),"glyphInfoMap",{}),S(I(e),"currentZoom",-1),S(I(e),"textureHeight",0),S(I(e),"textCount",0),S(I(e),"preTextStyle",{}),S(I(e),"buildModels",function(){var s=Mt(st.mark(function u(l){var c,f,h,v,p;return st.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:c=e.layer.getLayerConfig(),f=c.mask,h=f===void 0?!1:f,v=c.maskInside,p=v===void 0?!0:v,e.mapping(),e.layer.buildLayerModel({moduleName:"pointText",vertexShader:$1,fragmentShader:H1,triangulation:G1.bind(I(e)),depth:{enable:!1},blend:e.getBlend(),stencil:le(h,p)}).then(function(y){l([y])}).catch(function(y){console.warn(y),l([])});case 3:case"end":return g.stop()}},u)}));return function(u){return s.apply(this,arguments)}}()),S(I(e),"mapping",function(){e.initGlyph(),e.updateTexture(),e.filterGlyphs(),e.reBuildModel()}),e}return H(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=a===void 0?1:a,s=i.stroke,u=s===void 0?"#fff":s,l=i.strokeWidth,c=l===void 0?0:l,f=i.textAnchor,h=f===void 0?"center":f,v=i.textAllowOverlap,p=v===void 0?!1:v,d=i.halo,g=d===void 0?.5:d,y=i.gamma,m=y===void 0?2:y,x=i.raisingHeight,_=x===void 0?0:x,E=this.fontService,b=E.canvas,M=E.mapping;if(Object.keys(M).length!==this.textCount&&(this.updateTexture(),this.textCount=Object.keys(M).length),this.preTextStyle={textAnchor:h,textAllowOverlap:p},this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:o,strokeWidth:c,stroke:u})){this.judgeStyleAttributes({opacity:o,strokeWidth:c,stroke:u});var T=this.layer.getEncodedData(),k=this.calDataFrame(this.cellLength,T,this.cellProperties),L=k.data,O=k.width,D=k.height;this.rowCount=D,this.dataTexture=this.cellLength>0&&L.length>0?this.createTexture2D({flipY:!0,data:L,format:A.LUMINANCE,type:A.FLOAT,width:O,height:D}):this.createTexture2D({flipY:!0,data:[1],format:A.LUMINANCE,type:A.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(_),u_opacity:Y.exports.isNumber(o)?o:1,u_stroke_width:Y.exports.isNumber(c)?c:1,u_stroke_color:this.getStrokeColor(u),u_sdf_map:this.texture,u_halo_blur:g,u_gamma_scale:m,u_sdf_map_size:[b.width,b.height]}}},{key:"initModels",value:function(i){this.layer.on("remapping",this.mapping),this.extent=this.textExtent();var a=this.layer.getLayerConfig(),o=a.textAnchor,s=o===void 0?"center":o,u=a.textAllowOverlap,l=u===void 0?!0:u;this.preTextStyle={textAnchor:s,textAllowOverlap:l},this.buildModels(i)}},{key:"needUpdate",value:function(){var i=this.layer.getLayerConfig(),a=i.textAllowOverlap,o=a===void 0?!1:a,s=this.mapService.getZoom(),u=this.mapService.getBounds(),l=X2(this.extent,u);return!o&&(Math.abs(this.currentZoom-s)>1||!l)||o!==this.preTextStyle.textAllowOverlap?(this.reBuildModel(),!0):!1}},{key:"clearModels",value:function(){var i,a;(i=this.texture)===null||i===void 0||i.destroy(),(a=this.dataTexture)===null||a===void 0||a.destroy(),this.layer.off("remapping",this.mapping)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"rotate",type:nt.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:A.DYNAMIC_DRAW,data:[],type:A.FLOAT},size:1,update:function(a){var o=a.rotate,s=o===void 0?0:o;return Array.isArray(s)?[s[0]]:[s]}}}),this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:nt.Attribute,descriptor:{name:"a_textOffsets",buffer:{usage:A.STATIC_DRAW,data:[],type:A.FLOAT},size:2,update:function(a,o,s){return[s[5],s[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:nt.Attribute,descriptor:{name:"a_Size",buffer:{usage:A.DYNAMIC_DRAW,data:[],type:A.FLOAT},size:1,update:function(a){var o=a.size,s=o===void 0?12:o;return Array.isArray(s)?[s[0]]:[s]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:nt.Attribute,descriptor:{name:"a_tex",buffer:{usage:A.DYNAMIC_DRAW,data:[],type:A.FLOAT},size:2,update:function(a,o,s){return[s[3],s[4]]}}})}},{key:"textExtent",value:function(){var i=this.mapService.getBounds();return Lc(i,.5)}},{key:"initTextFont",value:function(){var i=this.layer.getLayerConfig(),a=i.fontWeight,o=a===void 0?"400":a,s=i.fontFamily,u=s===void 0?"sans-serif":s,l=this.layer.getEncodedData(),c=[];l.forEach(function(f){var h=f.shape,v=h===void 0?"":h;v=v.toString();var p=YK(v),d;try{for(p.s();!(d=p.n()).done;){var g=d.value;c.indexOf(g)===-1&&c.push(g)}}catch(y){p.e(y)}finally{p.f()}}),this.fontService.setFontOptions({characterSet:c,fontWeight:o,fontFamily:u,iconfont:!1})}},{key:"initIconFontTex",value:function(){var i=this.layer.getLayerConfig(),a=i.fontWeight,o=a===void 0?"400":a,s=i.fontFamily,u=s===void 0?"sans-serif":s,l=this.layer.getEncodedData(),c=[];l.forEach(function(f){var h=f.shape,v=h===void 0?"":h;v="".concat(v),c.indexOf(v)===-1&&c.push(v)}),this.fontService.setFontOptions({characterSet:c,fontWeight:o,fontFamily:u,iconfont:!0})}},{key:"generateGlyphLayout",value:function(i){var a=this,o=this.fontService.mapping,s=this.layer.getLayerConfig(),u=s.spacing,l=u===void 0?2:u,c=s.textAnchor,f=c===void 0?"center":c,h=this.layer.getEncodedData();this.glyphInfo=h.map(function(v){var p=v.shape,d=p===void 0?"":p,g=v.id,y=v.size,m=y===void 0?1:y,x=v.textOffset,_=x===void 0?[0,0]:x,E=LT(d.toString(),o,m,f,"left",l,_,i),b=FT(E,_,!1);return v.shaping=E,v.glyphQuads=b,v.centroid=Or(v.coordinates),v.originCentroid=v.version==="GAODE2.x"?Or(v.originCoordinates):v.originCentroid=v.centroid,a.glyphInfoMap[g]={shaping:E,glyphQuads:b,centroid:Or(v.coordinates)},v})}},{key:"filterGlyphs",value:function(){var i=this,a=this.layer.getLayerConfig(),o=a.padding,s=o===void 0?[4,4]:o,u=a.textAllowOverlap,l=u===void 0?!1:u;if(!l){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var c=this.rendererService.getViewportSize(),f=c.width,h=c.height,v=new bT(f,h),p=this.glyphInfo.filter(function(d){var g=d.shaping,y=d.id,m=y===void 0?0:y,x=d.version==="GAODE2.x"?d.originCentroid:d.centroid,_=d.size,E=_/24,b=i.mapService.lngLatToContainer(x),M=v.placeCollisionBox({x1:g.left*E-s[0],x2:g.right*E+s[0],y1:g.top*E-s[1],y2:g.bottom*E+s[1],anchorPointX:b.x,anchorPointY:b.y}),T=M.box;return T&&T.length?(v.insertCollisionBox(T,m),!0):!1});p.forEach(function(d){i.glyphInfoMap[d.id]=d})}}},{key:"initGlyph",value:function(){var i=this.layer.getLayerConfig(),a=i.iconfont,o=a===void 0?!1:a;o?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(o)}},{key:"updateTexture",value:function(){var i=this.rendererService.createTexture2D,a=this.fontService.canvas;this.textureHeight=a.height,this.texture&&this.texture.destroy(),this.texture=i({data:a,mag:A.LINEAR,min:A.LINEAR,width:a.width,height:a.height})}},{key:"reBuildModel",value:function(){var i=this,a=this.layer.getLayerConfig(),o=a.mask,s=o===void 0?!1:o,u=a.maskInside,l=u===void 0?!0:u;this.filterGlyphs(),this.layer.buildLayerModel({moduleName:"pointText",vertexShader:$1,fragmentShader:H1,triangulation:G1.bind(this),depth:{enable:!1},blend:this.getBlend(),stencil:le(s,l)}).then(function(c){i.layer.models=[c],i.layerService.throttleRenderLayers()}).catch(function(c){console.warn(c),i.layer.models=[]})}}]),t}(qt),JK={fillImage:MK,fill:EK,radar:$K,image:OK,normal:BK,simplePoint:XK,extrude:mK,text:QK,vectorPoint:RT,tile:tl,tileText:kT,earthFill:vK,earthExtrude:uK};const tQ=JK;function eQ(r,n){var t=typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(!t){if(Array.isArray(r)||(t=rQ(r))||n&&r&&typeof r.length=="number"){t&&(r=t);var e=0,i=function(){};return{s:i,n:function(){return e>=r.length?{done:!0}:{done:!1,value:r[e++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){t=t.call(r)},n:function(){var l=t.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(o)throw s}}}}function rQ(r,n){if(!!r){if(typeof r=="string")return V1(r,n);var t=Object.prototype.toString.call(r).slice(8,-1);if(t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set")return Array.from(r);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return V1(r,n)}}function V1(r,n){(n==null||n>r.length)&&(n=r.length);for(var t=0,e=new Array(n);t<n;t++)e[t]=r[t];return e}function nQ(r){var n=iQ();return function(){var e=B(r),i;if(n){var a=B(this).constructor;i=Reflect.construct(e,arguments,a)}else i=e.apply(this,arguments);return et(this,i)}}function iQ(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var IT=function(r){tt(t,r);var n=nQ(t);function t(){var e;$(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return e=n.call.apply(n,[this].concat(a)),S(I(e),"type","PointLayer"),S(I(e),"defaultSourceConfig",{data:[],options:{parser:{type:"json",x:"lng",y:"lat"}}}),e}return H(t,[{key:"buildModels",value:function(){var i=this,a=this.getModelType();this.layerModel=new tQ[a](this),this.layerModel.initModels(function(o){i.dispatchModelLoad(o)})}},{key:"rebuildModels",value:function(){var i=this;this.layerModel.buildModels(function(a){i.dispatchModelLoad(a)})}},{key:"getModelTypeWillEmptyData",value:function(){if(this.shapeOption){var i=this.shapeOption,a=i.field,o=i.values,s=this.getLayerConfig(),u=s.shape2d,l=this.iconService.getIconMap();if(a&&(u==null?void 0:u.indexOf(a))!==-1)return"fill";if(o&&o instanceof Array){var c=eQ(o),f;try{for(c.s();!(f=c.n()).done;){var h=f.value;if(typeof h=="string"&&l.hasOwnProperty(h))return"image"}}catch(v){c.e(v)}finally{c.f()}}}return"normal"}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var i=this.getModelType(),a={fillImage:{},normal:{blend:"additive"},radar:{},simplePoint:{},fill:{blend:"normal"},extrude:{},image:{},text:{blend:"normal"},vectorPoint:{},tile:{},tileText:{},earthFill:{},earthExtrude:{}};return a[i]}},{key:"getModelType",value:function(){var i=this.layerSource.getParserType();if(CT(i))return"vectorPoint";var a=this.getEncodedData(),o=this.getLayerConfig(),s=o.shape2d,u=o.shape3d,l=this.iconService.getIconMap(),c=a.find(function(h){return h.hasOwnProperty("shape")});if(c){var f=c.shape;return f==="dot"?"normal":f==="simple"?"simplePoint":f==="radar"?"radar":this.layerType==="fillImage"?"fillImage":(s==null?void 0:s.indexOf(f))!==-1?this.mapService.version==="GLOBEL"?"earthFill":"fill":(u==null?void 0:u.indexOf(f))!==-1?this.mapService.version==="GLOBEL"?"earthExtrude":"extrude":l.hasOwnProperty(f)?"image":"text"}else return this.getModelTypeWillEmptyData()}}]),t}(mo),W1,j1,X1,Y1,Nu,Z1,q1,aQ=(W1=xt(),j1=At(P.IMapService),X1=At(P.IFontService),W1(Y1=(Nu=function(){function r(){$(this,r),St(this,"mapService",Z1,this),St(this,"fontService",q1,this)}return H(r,[{key:"apply",value:function(t,e){var i=this,a=e.styleAttributeService;t.hooks.init.tap("DataMappingPlugin",function(){var o=t.getSource();o.inited?i.generateMaping(t,{styleAttributeService:a}):o.once("sourceUpdate",function(){i.generateMaping(t,{styleAttributeService:a})})}),t.hooks.beforeRenderData.tap("DataMappingPlugin",function(){t.dataState.dataMappingNeedUpdate=!1;var o=t.getSource();return o.inited?i.generateMaping(t,{styleAttributeService:a}):o.once("sourceUpdate",function(){i.generateMaping(t,{styleAttributeService:a})}),!0}),t.hooks.beforeRender.tap("DataMappingPlugin",function(){var o=t.getLayerConfig(),s=o.usage;if(s!=="basemap"){var u=t.getSource();if(!(t.layerModelNeedUpdate||!u||!u.inited)){var l=t.getBottomColor(),c=a.getLayerStyleAttributes()||[],f=a.getLayerStyleAttribute("filter"),h=u.data.dataArray,v=c.filter(function(y){return y.needRemapping}),p=h;if(f!=null&&f.needRemapping&&f!==null&&f!==void 0&&f.scale&&(p=h.filter(function(y){return i.applyAttributeMapping(f,y,l)[0]})),v.length){if(f!=null&&f.needRemapping){var d=i.mapping(t,c,p,void 0,l);t.setEncodedData(d),f.needRemapping=!1}else{var g=i.mapping(t,v,p,t.getEncodedData(),l);t.setEncodedData(g)}t.emit("remapping",null)}}}})}},{key:"generateMaping",value:function(t,e){var i=this,a=e.styleAttributeService,o=t.getBottomColor(),s=a.getLayerStyleAttributes()||[],u=a.getLayerStyleAttribute("filter"),l=t.getSource().data.dataArray,c=l;u!=null&&u.scale&&(c=l.filter(function(h){return i.applyAttributeMapping(u,h,o)[0]}));var f=this.mapping(t,s,c,void 0,o);t.setEncodedData(f),t.emit("dataUpdate",null)}},{key:"mapping",value:function(t,e,i,a,o){var s=this,u=t.getLayerConfig(),l=u.arrow,c=l===void 0?{enable:!1}:l,f=u.usage;if(f==="basemap")return this.mapLayerMapping(t,e,i,a);var h=e.filter(function(p){return p.scale!==void 0}),v=i.map(function(p,d){var g=a?a[d]:{},y=U({id:p._id,coordinates:p.coordinates},g);if(h.forEach(function(_){var E=s.applyAttributeMapping(_,p,o);_.needRemapping=!1,_.name==="color"&&(E=E.map(function(b){return Ut(b)})),y[_.name]=Array.isArray(E)&&E.length===1?E[0]:E,_.name==="shape"&&(y.shape=s.fontService.getIconFontKey(y[_.name]))}),c.enable&&(y.shape==="line"||y.shape==="halfLine")){var m=y.coordinates;if(t.arrowInsertCount<t.encodeDataLength){var x=s.getArrowPoints(m[0],m[1]);y.coordinates.splice(1,0,x,x),t.arrowInsertCount++}}return y});return this.adjustData2Amap2Coordinates(v,t),this.adjustData2SimpleCoordinates(v),v}},{key:"mapLayerMapping",value:function(t,e,i,a){var o=this,s=e.filter(function(l){return l.scale!==void 0}),u=i.map(function(l,c){var f=a?a[c]:{},h=U({id:l._id,coordinates:l.coordinates},f);return s.forEach(function(v){var p;if(v.name==="shape"&&((p=t.shapeOption)===null||p===void 0?void 0:p.field)==="simple")h[v.name]="simple",v.needRemapping=!1;else{var d=o.applyMapLayerAttributeMapping(v,l);v.needRemapping=!1,h[v.name]=Array.isArray(d)&&d.length===1?d[0]:d,v.name==="shape"&&(h.shape=o.fontService.getIconFontKey(h[v.name]))}}),h.size===void 0&&(h.size=1),h});return this.adjustData2Amap2Coordinates(u,t),u}},{key:"adjustData2Amap2Coordinates",value:function(t,e){var i=this;if(t.length>0&&this.mapService.version===ae["GAODE2.x"]){var a=this.getLayerCenter(e);typeof t[0].coordinates[0]=="number"?t.filter(function(o){return!o.originCoordinates}).map(function(o){o.version=ae["GAODE2.x"],o.originCoordinates=Y.exports.cloneDeep(o.coordinates),o.coordinates=i.mapService.lngLatToCoordByLayer(o.coordinates,a)}):t.filter(function(o){return!o.originCoordinates}).map(function(o){o.version=ae["GAODE2.x"],o.originCoordinates=Y.exports.cloneDeep(o.coordinates),o.coordinates=i.mapService.lngLatToCoordsByLayer(o.coordinates,a)})}}},{key:"adjustData2SimpleCoordinates",value:function(t){var e=this;t.length>0&&this.mapService.version===ae.SIMPLE&&t.map(function(i){i.simpleCoordinate||(i.coordinates=e.unProjectCoordinates(i.coordinates),i.simpleCoordinate=!0)})}},{key:"getLayerCenter",value:function(t){var e=t.getSource();return e.center}},{key:"unProjectCoordinates",value:function(t){var e=this;if(typeof t[0]=="number")return this.mapService.simpleMapCoord.unproject(t);if(t[0]&&t[0][0]instanceof Array){var i=[];return t.map(function(o){var s=[];o.map(function(u){s.push(e.mapService.simpleMapCoord.unproject(u))}),i.push(s)}),i}else{var a=[];return t.map(function(o){a.push(e.mapService.simpleMapCoord.unproject(o))}),a}}},{key:"applyAttributeMapping",value:function(t,e,i){var a;if(!t.scale)return[];var o=(t==null||(a=t.scale)===null||a===void 0?void 0:a.scalers)||[],s=[];o.forEach(function(l){var c,f=l.field;(e.hasOwnProperty(f)||((c=t.scale)===null||c===void 0?void 0:c.type)==="variable")&&s.push(e[f])});var u=t.mapping?t.mapping(s):[];return t.name==="color"&&!Z2(u[0])?[i]:u}},{key:"applyMapLayerAttributeMapping",value:function(t,e){var i;if(!t.scale)return[];var a=(t==null||(i=t.scale)===null||i===void 0?void 0:i.scalers)||[],o=[];a.forEach(function(u){var l,c=u.field;(e.hasOwnProperty(c)||((l=t.scale)===null||l===void 0?void 0:l.type)==="variable")&&o.push(e[c])});var s=t.mapping?t.mapping(o):[];return s}},{key:"getArrowPoints",value:function(t,e){var i=[e[0]-t[0],e[1]-t[1]],a=Y2(i),o=[t[0]+a[0]*1e-4,t[1]+a[1]*1e-4];return o}}]),r}(),Z1=Ct(Nu.prototype,"mapService",[j1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),q1=Ct(Nu.prototype,"fontService",[X1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nu))||Y1),K1,Q1,oQ=(K1=xt(),K1(Q1=function(){function r(){$(this,r)}return H(r,[{key:"apply",value:function(t){var e=this;this.mapService=t.getContainer().get(P.IMapService),t.hooks.init.tap("DataSourcePlugin",function(){var i=t.getSource();if(!i){var a=t.sourceOption||t.defaultSourceConfig,o=a.data,s=a.options;i=new ya(o,s),t.setSource(i)}i.inited?e.updateClusterData(t):i.once("sourceUpdate",function(){e.updateClusterData(t)})}),t.hooks.beforeRenderData.tap("DataSourcePlugin",function(){var i=e.updateClusterData(t),a=t.dataState.dataSourceNeedUpdate;return t.dataState.dataSourceNeedUpdate=!1,i||a})}},{key:"updateClusterData",value:function(t){if(t.isTileLayer||t.tileLayer)return!1;var e=t.getSource(),i=e.cluster,a=e.clusterOptions.zoom,o=a===void 0?0:a,s=this.mapService.getZoom()-1,u=t.dataState.dataSourceNeedUpdate;return i&&u&&e.updateClusterData(Math.floor(s)),i&&Math.abs(t.clusterZoom-s)>=1?(o!==Math.floor(s)&&e.updateClusterData(Math.floor(s)),t.clusterZoom=s,!0):!1}}]),r}())||Q1),lr,J1,tC,sQ=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,uQ=(lr={},S(lr,Gt.LINEAR,rw),S(lr,Gt.POWER,nw),S(lr,Gt.LOG,iw),S(lr,Gt.IDENTITY,aw),S(lr,Gt.SEQUENTIAL,ow),S(lr,Gt.TIME,sw),S(lr,Gt.QUANTILE,uw),S(lr,Gt.QUANTIZE,lw),S(lr,Gt.THRESHOLD,cw),S(lr,Gt.CAT,Yf),S(lr,Gt.DIVERGING,fw),lr),lQ=(J1=xt(),J1(tC=function(){function r(){$(this,r),S(this,"scaleOptions",{})}return H(r,[{key:"getSourceData",value:function(t,e){var i=t.getSource();i.inited?e(i.data):i.once("sourceUpdate",function(){e(i.data)})}},{key:"apply",value:function(t,e){var i=this,a=e.styleAttributeService;t.hooks.init.tap("FeatureScalePlugin",function(){i.scaleOptions=t.getScaleOptions();var o=a.getLayerStyleAttributes();i.getSourceData(t,function(s){var u=s.dataArray;Array.isArray(u)&&u.length===0||i.caculateScalesForAttributes(o||[],u)})}),t.hooks.beforeRenderData.tap("FeatureScalePlugin",function(){i.scaleOptions=t.getScaleOptions();var o=a.getLayerStyleAttributes();return i.getSourceData(t,function(s){var u=s.dataArray;Array.isArray(u)&&u.length===0||(i.caculateScalesForAttributes(o||[],u),t.layerModelNeedUpdate=!0)}),!0}),t.hooks.beforeRender.tap("FeatureScalePlugin",function(){var o=t.getLayerConfig(),s=o.usage;if(!(t.layerModelNeedUpdate||s==="basemap")){i.scaleOptions=t.getScaleOptions();var u=a.getLayerStyleAttributes();u&&i.getSourceData(t,function(l){var c=l.dataArray;if(c.length!==0){var f=u.filter(function(h){return h.needRescale});f.length&&i.caculateScalesForAttributes(f,c)}})}})}},{key:"isNumber",value:function(t){return!isNaN(parseFloat(t))&&isFinite(t)}},{key:"caculateScalesForAttributes",value:function(t,e){var i=this;t.forEach(function(a){if(a.scale){var o=a.scale;o.names=i.parseFields(a.scale.field||[]);var s=[];o.names.forEach(function(u){var l;s.push(i.createScale(u,a.name,(l=a.scale)===null||l===void 0?void 0:l.values,e))}),s.some(function(u){return u.type===Qn.VARIABLE})?(o.type=Qn.VARIABLE,s.forEach(function(u){var l;if(!o.callback&&o.values!=="text")switch((l=u.option)===null||l===void 0?void 0:l.type){case Gt.LOG:case Gt.LINEAR:case Gt.POWER:if(o.values&&o.values.length>2){var c=u.scale.ticks(o.values.length);u.scale.domain(c)}o.values?u.scale.range(o.values):u.scale.range(u.option.domain);break;case Gt.QUANTILE:case Gt.QUANTIZE:case Gt.THRESHOLD:u.scale.range(o.values);break;case Gt.CAT:o.values?u.scale.range(o.values):u.scale.range(u.option.domain);break;case Gt.DIVERGING:case Gt.SEQUENTIAL:u.scale.interpolator(pM(o.values));break}if(o.values==="text"){var f;u.scale.range((f=u.option)===null||f===void 0?void 0:f.domain)}})):(o.type=Qn.CONSTANT,o.defaultValues=s.map(function(u,l){return u.scale(o.names[l])})),o.scalers=s.map(function(u){return{field:u.field,func:u.scale,option:u.option}}),a.needRescale=!1}})}},{key:"parseFields",value:function(t){return Array.isArray(t)?t:Y.exports.isString(t)?t.split("*"):[t]}},{key:"createScale",value:function(t,e,i,a){var o,s,u=this.scaleOptions[e]&&((o=this.scaleOptions[e])===null||o===void 0?void 0:o.field)===t?this.scaleOptions[e]:this.scaleOptions[t],l={field:t,scale:void 0,type:Qn.VARIABLE,option:u};if(!a||!a.length)return u&&u.type?l.scale=this.createDefaultScale(u):(l.scale=Yf([t]),l.type=Qn.CONSTANT),l;var c=(s=a.find(function(v){return!Y.exports.isNil(v[t])}))===null||s===void 0?void 0:s[t];if(this.isNumber(t)||Y.exports.isNil(c)&&!u)l.scale=Yf([t]),l.type=Qn.CONSTANT;else{var f=u&&u.type||this.getDefaultType(c);i==="text"&&(f=Gt.CAT);var h=this.createScaleConfig(f,t,u,a);l.scale=this.createDefaultScale(h),l.option=h}return l}},{key:"getDefaultType",value:function(t){var e=Gt.LINEAR;return typeof t=="string"&&(e=sQ.test(t)?Gt.TIME:Gt.CAT),e}},{key:"createScaleConfig",value:function(t,e,i,a){var o={type:t},s=(a==null?void 0:a.map(function(c){return c[e]}))||[];if(i!=null&&i.domain)o.domain=i==null?void 0:i.domain;else if(t!==Gt.CAT&&t!==Gt.QUANTILE&&t!==Gt.DIVERGING)o.domain=Dd(s);else if(t===Gt.CAT)o.domain=Y.exports.uniq(s);else if(t===Gt.QUANTILE)o.domain=s;else if(t===Gt.DIVERGING){var u=Dd(s),l=(i==null?void 0:i.neutral)!==void 0?i==null?void 0:i.neutral:(u[0]+u[1])/2;o.domain=[u[0],l,u[1]]}return U(U({},o),i)}},{key:"createDefaultScale",value:function(t){var e=t.type,i=t.domain,a=t.unknown,o=t.clamp,s=t.nice,u=uQ[e]();return i&&u.domain&&u.domain(i),a&&u.unknown(a),o!==void 0&&u.clamp&&u.clamp(o),s!==void 0&&u.nice&&u.nice(s),u}}]),r}())||tC),eC,rC,cQ=(eC=xt(),eC(rC=function(){function r(){$(this,r)}return H(r,[{key:"apply",value:function(t){t.hooks.beforeRender.tap("LayerAnimateStylePlugin",function(){var e=t.animateStatus;e&&t.models.forEach(function(i){i.addUniforms(U({},t.layerModel.getAnimateUniforms()))})})}}]),r}())||rC),nC,iC,fQ=(nC=xt(),nC(iC=function(){function r(){$(this,r)}return H(r,[{key:"initLayerModel",value:function(t){t.prepareBuildModel(),t.buildModels(),t.styleNeedUpdate=!1}},{key:"prepareLayerModel",value:function(t){var e;t.prepareBuildModel(),(e=t.layerModel)===null||e===void 0||e.clearModels(),t.buildModels(),t.layerModelNeedUpdate=!1}},{key:"apply",value:function(t){var e=this;t.hooks.init.tap("LayerModelPlugin",function(){t.inited=!0,t.modelLoaded=!1;var i=t.getSource();i.inited&&e.initLayerModel(t)}),t.hooks.beforeRenderData.tap("DataSourcePlugin",function(){var i=t.getSource();return t.modelLoaded=!1,i.inited?e.prepareLayerModel(t):i.once("sourceUpdate",function(){e.prepareLayerModel(t)}),!1})}}]),r}())||iC),aC,oC,hQ=(aC=xt(),aC(oC=function(){function r(){$(this,r)}return H(r,[{key:"apply",value:function(t){t.hooks.afterInit.tap("LayerStylePlugin",function(){t.updateLayerConfig({});var e=t.getLayerConfig(),i=e.autoFit,a=e.fitBoundsOptions;i&&setTimeout(function(){t.fitBounds(a)},100)})}}]),r}())||oC),sC,uC,vQ=["type"],lC={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},pQ={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},dQ={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},gQ={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5};function yQ(r){var n={u_DirectionalLights:new Array(3).fill(U({},dQ)),u_NumOfDirectionalLights:0,u_SpotLights:new Array(3).fill(U({},gQ)),u_NumOfSpotLights:0};return(!r||!r.length)&&(r=[pQ]),r.forEach(function(t,e){var i=t.type,a=i===void 0?"directional":i,o=un(t,vQ),s=lC[a].lights,u=lC[a].num,l=n[u];n[s][l]=U(U({},n[s][l]),o),n[u]++}),n}var mQ=(sC=xt(),sC(uC=function(){function r(){$(this,r)}return H(r,[{key:"apply",value:function(t){t.hooks.beforeRender.tap("LightingPlugin",function(){var e=t.getLayerConfig(),i=e.enableLighting;i&&t.models.forEach(function(a){return a.addUniforms(U({},yQ()))})})}}]),r}())||uC),cC,fC,xQ=(cC=xt(),cC(fC=function(){function r(){$(this,r)}return H(r,[{key:"apply",value:function(t,e){var i=this,a=e.rendererService,o=e.postProcessingPassFactory,s=e.normalPassFactory;t.hooks.init.tap("MultiPassRendererPlugin",function(){var u=t.getLayerConfig(),l=u.enableMultiPassRenderer,c=u.passes,f=c===void 0?[]:c;i.enabled=!!l&&t.getLayerConfig().enableMultiPassRenderer!==!1,i.enabled&&(t.multiPassRenderer=yT(t,f,o,s),t.multiPassRenderer.setRenderFlag(!0))}),t.hooks.beforeRender.tap("MultiPassRendererPlugin",function(){if(i.enabled){var u=a.getViewportSize(),l=u.width,c=u.height;t.multiPassRenderer.resize(l,c)}})}}]),r}())||fC),hC,vC,zu={NONE:0,ENCODE:1,HIGHLIGHT:2},_Q=(hC=xt(),hC(vC=function(){function r(){$(this,r)}return H(r,[{key:"apply",value:function(t,e){var i=e.styleAttributeService;t.hooks.init.tap("PixelPickingPlugin",function(){var a=t.getLayerConfig(),o=a.enablePicking;i.registerStyleAttribute({name:"pickingColor",type:nt.Attribute,descriptor:{name:"a_PickingColor",buffer:{data:[],type:A.FLOAT},size:3,update:function(u){var l=u.id;return o?di(l):[0,0,0]}}})}),t.hooks.beforePickingEncode.tap("PixelPickingPlugin",function(){var a=t.getLayerConfig(),o=a.enablePicking;o&&t.isVisible()&&t.models.forEach(function(s){return s.addUniforms({u_PickingStage:zu.ENCODE})})}),t.hooks.afterPickingEncode.tap("PixelPickingPlugin",function(){var a=t.getLayerConfig(),o=a.enablePicking;o&&t.isVisible()&&t.models.forEach(function(s){return s.addUniforms({u_PickingStage:zu.HIGHLIGHT})})}),t.hooks.beforeHighlight.tap("PixelPickingPlugin",function(a){var o=t.getLayerConfig(),s=o.highlightColor,u=o.activeMix,l=u===void 0?0:u,c=typeof s=="string"?Ut(s):s||[1,0,0,1];t.updateLayerConfig({pickedFeatureID:cn(new Uint8Array(a))}),t.models.forEach(function(f){return f.addUniforms({u_PickingStage:zu.HIGHLIGHT,u_PickingColor:a,u_HighlightColor:c.map(function(h){return h*255}),u_activeMix:l})})}),t.hooks.beforeSelect.tap("PixelPickingPlugin",function(a){var o=t.getLayerConfig(),s=o.selectColor,u=o.selectMix,l=u===void 0?0:u,c=typeof s=="string"?Ut(s):s||[1,0,0,1];t.updateLayerConfig({pickedFeatureID:cn(new Uint8Array(a))}),t.models.forEach(function(f){return f.addUniforms({u_PickingStage:zu.HIGHLIGHT,u_PickingColor:a,u_HighlightColor:c.map(function(h){return h*255}),u_activeMix:l,u_CurrentSelectedId:a,u_SelectColor:c.map(function(h){return h*255}),u_EnableSelect:1})})})}}]),r}())||vC),pC,dC,CQ=(pC=xt(),pC(dC=function(){function r(){$(this,r)}return H(r,[{key:"apply",value:function(t,e){var i=this,a=e.styleAttributeService;t.hooks.init.tap("RegisterStyleAttributePlugin",function(){i.registerBuiltinAttributes(a,t)})}},{key:"registerBuiltinAttributes",value:function(t,e){var i=e.getSource();switch(i.parser.type){case"mvt":case"testTile":case"rasterTile":return}if(e.type==="MaskLayer"){this.registerPositionAttribute(t);return}var a=e.getLayerConfig(),o=a.usage;if(o==="basemap "){this.registerPositionAttribute(t);return}if(e.isTileLayer){this.registerPositionAttribute(t),this.registerColorAttribute(t);return}this.registerPositionAttribute(t),this.registerFilterAttribute(t),this.registerColorAttribute(t),this.registerVertexIdAttribute(t)}},{key:"registerPositionAttribute",value:function(t){t.registerStyleAttribute({name:"position",type:nt.Attribute,descriptor:{name:"a_Position",buffer:{data:[],type:A.FLOAT},size:3,update:function(i,a,o){return o.length===2?[o[0],o[1],0]:[o[0],o[1],o[2]]}}})}},{key:"registerFilterAttribute",value:function(t){t.registerStyleAttribute({name:"filter",type:nt.Attribute,descriptor:{name:"filter",buffer:{usage:A.DYNAMIC_DRAW,data:[],type:A.FLOAT},size:1,update:function(i){var a=i.filter;return a?[1]:[0]}}})}},{key:"registerColorAttribute",value:function(t){t.registerStyleAttribute({name:"color",type:nt.Attribute,descriptor:{name:"a_Color",buffer:{usage:A.DYNAMIC_DRAW,data:[],type:A.FLOAT},size:4,update:function(i){var a=i.color;return!a||!a.length?[1,1,1,1]:a}}})}},{key:"registerVertexIdAttribute",value:function(t){t.registerStyleAttribute({name:"vertexId",type:nt.Attribute,descriptor:{name:"a_vertexId",buffer:{usage:A.DYNAMIC_DRAW,data:[],type:A.FLOAT},size:1,update:function(i,a){return[a]}}})}}]),r}())||dC),gC,yC,mC,xC,_C,CC,Fa,EC,SC,bC,AC,EQ=(gC=xt(),yC=At(P.ICameraService),mC=At(P.ICoordinateSystemService),xC=At(P.IRendererService),_C=At(P.IMapService),gC(CC=(Fa=function(){function r(){$(this,r),St(this,"cameraService",EC,this),St(this,"coordinateSystemService",SC,this),St(this,"rendererService",bC,this),St(this,"mapService",AC,this)}return H(r,[{key:"apply",value:function(t){var e=this,i=this.mapService.version,a=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],o=[0,0];t.hooks.beforeRender.tap("ShaderUniformPlugin",function(){var s=t.getLayerConfig().tileOrigin;if(e.coordinateSystemService.refresh(s),i==="GAODE2.x"){var u=e.getLayerCenter(t);e.mapService.map.customCoords.setCenter(u),e.mapService.setCustomCoordCenter(u),a=e.mapService.map.customCoords.getMVPMatrix(),o=e.mapService.getCustomCoordCenter()}var l=e.rendererService.getViewportSize(),c=l.width,f=l.height;t.models.forEach(function(h){var v;h.addUniforms((v={},S(v,Fi.ProjectionMatrix,e.cameraService.getProjectionMatrix()),S(v,Fi.ViewMatrix,e.cameraService.getViewMatrix()),S(v,Fi.ViewProjectionMatrix,e.cameraService.getViewProjectionMatrix()),S(v,Fi.Zoom,e.cameraService.getZoom()),S(v,Fi.ZoomScale,e.cameraService.getZoomScale()),S(v,Fi.FocalDistance,e.cameraService.getFocalDistance()),S(v,Fi.CameraPosition,e.cameraService.getCameraPosition()),S(v,wi.CoordinateSystem,e.coordinateSystemService.getCoordinateSystem()),S(v,wi.ViewportCenter,e.coordinateSystemService.getViewportCenter()),S(v,wi.ViewportCenterProjection,e.coordinateSystemService.getViewportCenterProjection()),S(v,wi.PixelsPerDegree,e.coordinateSystemService.getPixelsPerDegree()),S(v,wi.PixelsPerDegree2,e.coordinateSystemService.getPixelsPerDegree2()),S(v,wi.PixelsPerMeter,e.coordinateSystemService.getPixelsPerMeter()),S(v,wi.Mvp,a),S(v,"u_SceneCenterMKT",o),S(v,"u_ViewportSize",[c,f]),S(v,"u_ModelMatrix",e.cameraService.getModelMatrix()),S(v,"u_DevicePixelRatio",Wt.devicePixelRatio),S(v,"u_PickingBuffer",t.getLayerConfig().pickingBuffer||0),S(v,"u_shaderPick",Number(t.getShaderPickStat())),v))})})}},{key:"getLayerCenter",value:function(t){var e=t.getSource();return e.center}}]),r}(),EC=Ct(Fa.prototype,"cameraService",[yC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SC=Ct(Fa.prototype,"coordinateSystemService",[mC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bC=Ct(Fa.prototype,"rendererService",[xC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),AC=Ct(Fa.prototype,"mapService",[_C],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fa))||CC),TC,MC,SQ=(TC=xt(),TC(MC=function(){function r(){$(this,r)}return H(r,[{key:"apply",value:function(t){t.hooks.beforeRender.tap("UpdateModelPlugin",function(){t.layerModel&&t.layerModel.needUpdate()})}}]),r}())||MC),wC,LC,bQ=(wC=xt(),wC(LC=function(){function r(){$(this,r)}return H(r,[{key:"apply",value:function(t,e){var i=this,a=e.styleAttributeService;t.hooks.init.tap("UpdateStyleAttributePlugin",function(){i.initStyleAttribute(t,{styleAttributeService:a})}),t.hooks.beforeRender.tap("UpdateStyleAttributePlugin",function(){var o=t.getLayerConfig(),s=o.usage;t.layerModelNeedUpdate||t.tileLayer||s==="basemap"||t.modelLoaded&&i.updateStyleAttribute(t,{styleAttributeService:a})})}},{key:"updateStyleAttribute",value:function(t,e){var i=e.styleAttributeService,a=i.getLayerStyleAttributes()||[],o=i.getLayerStyleAttribute("filter");if(o&&o.needRegenerateVertices){t.layerModelNeedUpdate=!0,a.forEach(function(s){return s.needRegenerateVertices=!1});return}a.filter(function(s){return s.needRegenerateVertices}).forEach(function(s){i.updateAttributeByFeatureRange(s.name,t.getEncodedData(),s.featureRange.startIndex,s.featureRange.endIndex),s.needRegenerateVertices=!1})}},{key:"initStyleAttribute",value:function(t,e){var i=e.styleAttributeService,a=i.getLayerStyleAttributes()||[];a.filter(function(o){return o.needRegenerateVertices}).forEach(function(o){i.updateAttributeByFeatureRange(o.name,t.getEncodedData(),o.featureRange.startIndex,o.featureRange.endIndex),o.needRegenerateVertices=!1})}}]),r}())||LC);Ne.bind(P.ILayerPlugin).to(oQ).inRequestScope();Ne.bind(P.ILayerPlugin).to(CQ).inRequestScope();Ne.bind(P.ILayerPlugin).to(lQ).inRequestScope();Ne.bind(P.ILayerPlugin).to(aQ).inRequestScope();Ne.bind(P.ILayerPlugin).to(hQ).inRequestScope();Ne.bind(P.ILayerPlugin).to(bQ).inRequestScope();Ne.bind(P.ILayerPlugin).to(SQ).inRequestScope();Ne.bind(P.ILayerPlugin).to(xQ).inRequestScope();Ne.bind(P.ILayerPlugin).to(EQ).inRequestScope();Ne.bind(P.ILayerPlugin).to(cQ).inRequestScope();Ne.bind(P.ILayerPlugin).to(mQ).inRequestScope();Ne.bind(P.ILayerPlugin).to(_Q).inRequestScope();Ne.bind(P.ILayerPlugin).to(fQ).inRequestScope();var AQ=function(){function r(n,t){$(this,r);var e=t.buffer,i=t.offset,a=t.stride,o=t.normalized,s=t.size,u=t.divisor;this.buffer=e,this.attribute={buffer:e.get(),offset:i||0,stride:a||0,normalized:o||!1,divisor:u||0},s&&(this.attribute.size=s)}return H(r,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(t){this.buffer.subData(t)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),r}(),_n,Po,Cn,br,Bo,jn,No,Uu,tn,ki,Oe,en,rn,Hu,TQ=(_n={},S(_n,A.POINTS,"points"),S(_n,A.LINES,"lines"),S(_n,A.LINE_LOOP,"line loop"),S(_n,A.LINE_STRIP,"line strip"),S(_n,A.TRIANGLES,"triangles"),S(_n,A.TRIANGLE_FAN,"triangle fan"),S(_n,A.TRIANGLE_STRIP,"triangle strip"),_n),DT=(Po={},S(Po,A.STATIC_DRAW,"static"),S(Po,A.DYNAMIC_DRAW,"dynamic"),S(Po,A.STREAM_DRAW,"stream"),Po),pd=(Cn={},S(Cn,A.BYTE,"int8"),S(Cn,A.UNSIGNED_INT,"int16"),S(Cn,A.INT,"int32"),S(Cn,A.UNSIGNED_BYTE,"uint8"),S(Cn,A.UNSIGNED_SHORT,"uint16"),S(Cn,A.UNSIGNED_INT,"uint32"),S(Cn,A.FLOAT,"float"),Cn),MQ=(br={},S(br,A.ALPHA,"alpha"),S(br,A.LUMINANCE,"luminance"),S(br,A.LUMINANCE_ALPHA,"luminance alpha"),S(br,A.RGB,"rgb"),S(br,A.RGBA,"rgba"),S(br,A.RGBA4,"rgba4"),S(br,A.RGB5_A1,"rgb5 a1"),S(br,A.RGB565,"rgb565"),S(br,A.DEPTH_COMPONENT,"depth"),S(br,A.DEPTH_STENCIL,"depth stencil"),br),wQ=(Bo={},S(Bo,A.DONT_CARE,"dont care"),S(Bo,A.NICEST,"nice"),S(Bo,A.FASTEST,"fast"),Bo),FC=(jn={},S(jn,A.NEAREST,"nearest"),S(jn,A.LINEAR,"linear"),S(jn,A.LINEAR_MIPMAP_LINEAR,"mipmap"),S(jn,A.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),S(jn,A.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),S(jn,A.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),jn),kC=(No={},S(No,A.REPEAT,"repeat"),S(No,A.CLAMP_TO_EDGE,"clamp"),S(No,A.MIRRORED_REPEAT,"mirror"),No),LQ=(Uu={},S(Uu,A.NONE,"none"),S(Uu,A.BROWSER_DEFAULT_WEBGL,"browser"),Uu),FQ=(tn={},S(tn,A.NEVER,"never"),S(tn,A.ALWAYS,"always"),S(tn,A.LESS,"less"),S(tn,A.LEQUAL,"lequal"),S(tn,A.GREATER,"greater"),S(tn,A.GEQUAL,"gequal"),S(tn,A.EQUAL,"equal"),S(tn,A.NOTEQUAL,"notequal"),tn),OC=(ki={},S(ki,A.FUNC_ADD,"add"),S(ki,A.MIN_EXT,"min"),S(ki,A.MAX_EXT,"max"),S(ki,A.FUNC_SUBTRACT,"subtract"),S(ki,A.FUNC_REVERSE_SUBTRACT,"reverse subtract"),ki),$u=(Oe={},S(Oe,A.ZERO,"zero"),S(Oe,A.ONE,"one"),S(Oe,A.SRC_COLOR,"src color"),S(Oe,A.ONE_MINUS_SRC_COLOR,"one minus src color"),S(Oe,A.SRC_ALPHA,"src alpha"),S(Oe,A.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),S(Oe,A.DST_COLOR,"dst color"),S(Oe,A.ONE_MINUS_DST_COLOR,"one minus dst color"),S(Oe,A.DST_ALPHA,"dst alpha"),S(Oe,A.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),S(Oe,A.CONSTANT_COLOR,"constant color"),S(Oe,A.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),S(Oe,A.CONSTANT_ALPHA,"constant alpha"),S(Oe,A.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),S(Oe,A.SRC_ALPHA_SATURATE,"src alpha saturate"),Oe),kQ=(en={},S(en,A.NEVER,"never"),S(en,A.ALWAYS,"always"),S(en,A.LESS,"less"),S(en,A.LEQUAL,"lequal"),S(en,A.GREATER,"greater"),S(en,A.GEQUAL,"gequal"),S(en,A.EQUAL,"equal"),S(en,A.NOTEQUAL,"notequal"),en),ka=(rn={},S(rn,A.ZERO,"zero"),S(rn,A.KEEP,"keep"),S(rn,A.REPLACE,"replace"),S(rn,A.INVERT,"invert"),S(rn,A.INCR,"increment"),S(rn,A.DECR,"decrement"),S(rn,A.INCR_WRAP,"increment wrap"),S(rn,A.DECR_WRAP,"decrement wrap"),rn),OQ=(Hu={},S(Hu,A.FRONT,"front"),S(Hu,A.BACK,"back"),Hu),RQ=function(){function r(n,t){$(this,r);var e=t.data,i=t.usage,a=t.type;this.buffer=n.buffer({data:e,usage:DT[i||A.STATIC_DRAW],type:pd[a||A.UNSIGNED_BYTE]})}return H(r,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.buffer.destroy()}},{key:"subData",value:function(t){var e=t.data,i=t.offset;this.buffer.subdata(e,i)}}]),r}(),IQ=function(){function r(n,t){$(this,r);var e=t.data,i=t.usage,a=t.type,o=t.count;this.elements=n.elements({data:e,usage:DT[i||A.STATIC_DRAW],type:pd[a||A.UNSIGNED_BYTE],count:o})}return H(r,[{key:"get",value:function(){return this.elements}},{key:"subData",value:function(t){var e=t.data;this.elements.subdata(e)}},{key:"destroy",value:function(){}}]),r}(),DQ=function(){function r(n,t){$(this,r);var e=t.width,i=t.height,a=t.color,o=t.colors;t.depth,t.stencil;var s={width:e,height:i};Array.isArray(o)&&(s.colors=o.map(function(u){return u.get()})),a&&typeof a!="boolean"&&(s.color=a.get()),this.framebuffer=n.framebuffer(s)}return H(r,[{key:"get",value:function(){return this.framebuffer}},{key:"destroy",value:function(){this.framebuffer.destroy()}},{key:"resize",value:function(t){var e=t.width,i=t.height;this.framebuffer.resize(e,i)}}]),r}(),PQ=function(){function r(n,t){$(this,r),S(this,"destroyed",!1),S(this,"uniforms",{}),this.reGl=n;var e=t.pick,i=e===void 0?!0:e,a=t.vs,o=t.fs,s=t.attributes,u=t.uniforms,l=t.primitive,c=t.count,f=t.elements,h=t.depth,v=t.blend,p=t.stencil,d=t.cull,g=t.instances,y={};this.options=t,u&&(this.uniforms=this.extractUniforms(u),Object.keys(u).forEach(function(E){y[E]=n.prop(E)}));var m={};Object.keys(s).forEach(function(E){m[E]=s[E].get()});var x={attributes:m,frag:o,uniforms:y,vert:a,blend:{},primitive:TQ[l===void 0?A.TRIANGLES:l]};if(g&&(x.instances=g),c?x.count=c:f&&(x.elements=f.get()),this.initDepthDrawParams({depth:h},x),this.initBlendDrawParams({blend:v},x),this.initStencilDrawParams({stencil:p},x),this.initCullDrawParams({cull:d},x),this.drawCommand=n(x),i){var _=Y.exports.cloneDeep(x);_.blend=U(U({},_.blend),{},{enable:!1}),this.drawPickCommand=n(_)}this.drawParams=x}return H(r,[{key:"updateAttributesAndElements",value:function(t,e){var i={};if(Object.keys(t).forEach(function(o){i[o]=t[o].get()}),this.drawParams.attributes=i,this.drawParams.elements=e.get(),this.drawCommand=this.reGl(this.drawParams),this.options.pick){var a=Y.exports.cloneDeep(this.drawParams);a.blend=U(U({},a.blend),{},{enable:!1}),this.drawPickCommand=this.reGl(a)}}},{key:"updateAttributes",value:function(t){var e={};if(Object.keys(t).forEach(function(a){e[a]=t[a].get()}),this.drawParams.attributes=e,this.drawCommand=this.reGl(this.drawParams),this.options.pick){var i=Y.exports.cloneDeep(this.drawParams);i.blend=U(U({},i.blend),{},{enable:!1}),this.drawPickCommand=this.reGl(i)}}},{key:"addUniforms",value:function(t){this.uniforms=U(U({},this.uniforms),this.extractUniforms(t))}},{key:"draw",value:function(t,e){if(!(this.drawParams.attributes&&Object.keys(this.drawParams.attributes).length===0)){var i=U(U({},this.uniforms),this.extractUniforms(t.uniforms||{})),a={};Object.keys(i).forEach(function(o){var s=ZC(i[o]);s==="boolean"||s==="number"||Array.isArray(i[o])||i[o].BYTES_PER_ELEMENT?a[o]=i[o]:a[o]=i[o].get()}),e?this.drawPickCommand&&this.drawPickCommand(a):this.drawCommand(a)}}},{key:"destroy",value:function(){var t,e;(t=this.drawParams)===null||t===void 0||(e=t.elements)===null||e===void 0||e.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach(function(i){i==null||i.destroy()}),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(t,e){var i=t.depth;i&&(e.depth={enable:i.enable===void 0?!0:!!i.enable,mask:i.mask===void 0?!0:!!i.mask,func:FQ[i.func||A.LESS],range:i.range||[0,1]})}},{key:"initBlendDrawParams",value:function(t,e){var i=t.blend;if(i){var a=i.enable,o=i.func,s=i.equation,u=i.color,l=u===void 0?[0,0,0,0]:u;e.blend={enable:!!a,func:{srcRGB:$u[o&&o.srcRGB||A.SRC_ALPHA],srcAlpha:$u[o&&o.srcAlpha||A.SRC_ALPHA],dstRGB:$u[o&&o.dstRGB||A.ONE_MINUS_SRC_ALPHA],dstAlpha:$u[o&&o.dstAlpha||A.ONE_MINUS_SRC_ALPHA]},equation:{rgb:OC[s&&s.rgb||A.FUNC_ADD],alpha:OC[s&&s.alpha||A.FUNC_ADD]},color:l}}}},{key:"initStencilDrawParams",value:function(t,e){var i=t.stencil;if(i){var a=i.enable,o=i.mask,s=o===void 0?-1:o,u=i.func,l=u===void 0?{cmp:A.ALWAYS,ref:0,mask:-1}:u,c=i.opFront,f=c===void 0?{fail:A.KEEP,zfail:A.KEEP,zpass:A.KEEP}:c,h=i.opBack,v=h===void 0?{fail:A.KEEP,zfail:A.KEEP,zpass:A.KEEP}:h;e.stencil={enable:!!a,mask:s,func:U(U({},l),{},{cmp:kQ[l.cmp]}),opFront:{fail:ka[f.fail],zfail:ka[f.zfail],zpass:ka[f.zpass]},opBack:{fail:ka[v.fail],zfail:ka[v.zfail],zpass:ka[v.zpass]}}}}},{key:"initCullDrawParams",value:function(t,e){var i=t.cull;if(i){var a=i.enable,o=i.face,s=o===void 0?A.BACK:o;e.cull={enable:!!a,face:OQ[s]}}}},{key:"extractUniforms",value:function(t){var e=this,i={};return Object.keys(t).forEach(function(a){e.extractUniformsRecursively(a,t[a],i,"")}),i}},{key:"extractUniformsRecursively",value:function(t,e,i,a){var o=this;if(e===null||typeof e=="number"||typeof e=="boolean"||Array.isArray(e)&&typeof e[0]=="number"||Y.exports.isTypedArray(e)||e===""||"resize"in e){i["".concat(a&&a+".").concat(t)]=e;return}Y.exports.isPlainObject(e)&&Object.keys(e).forEach(function(s){o.extractUniformsRecursively(s,e[s],i,"".concat(a&&a+".").concat(t))}),Array.isArray(e)&&e.forEach(function(s,u){Object.keys(s).forEach(function(l){o.extractUniformsRecursively(l,s[l],i,"".concat(a&&a+".").concat(t,"[").concat(u,"]"))})})}}]),r}(),BQ=function(){function r(n,t){$(this,r),S(this,"isDistroy",!1);var e=t.data,i=t.type,a=i===void 0?A.UNSIGNED_BYTE:i,o=t.width,s=t.height,u=t.flipY,l=u===void 0?!1:u,c=t.format,f=c===void 0?A.RGBA:c,h=t.mipmap,v=h===void 0?!1:h,p=t.wrapS,d=p===void 0?A.CLAMP_TO_EDGE:p,g=t.wrapT,y=g===void 0?A.CLAMP_TO_EDGE:g,m=t.aniso,x=m===void 0?0:m,_=t.alignment,E=_===void 0?1:_,b=t.premultiplyAlpha,M=b===void 0?!1:b,T=t.mag,k=T===void 0?A.NEAREST:T,L=t.min,O=L===void 0?A.NEAREST:L,D=t.colorSpace,W=D===void 0?A.BROWSER_DEFAULT_WEBGL:D,j=t.x,ot=j===void 0?0:j,z=t.y,X=z===void 0?0:z,K=t.copy,Q=K===void 0?!1:K;this.width=o,this.height=s;var q={width:o,height:s,type:pd[a],format:MQ[f],wrapS:kC[d],wrapT:kC[y],mag:FC[k],min:FC[O],alignment:E,flipY:l,colorSpace:LQ[W],premultiplyAlpha:M,aniso:x,x:ot,y:X,copy:Q};e&&(q.data=e),typeof v=="number"?q.mipmap=wQ[v]:typeof v=="boolean"&&(q.mipmap=v),this.texture=n.texture(q)}return H(r,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.texture(t)}},{key:"bind",value:function(){this.texture._texture.bind()}},{key:"resize",value:function(t){var e=t.width,i=t.height;this.texture.resize(e,i),this.width=e,this.height=i}},{key:"destroy",value:function(){if(!this.isDistroy){var t;(t=this.texture)===null||t===void 0||t.destroy()}this.isDistroy=!0}}]),r}(),RC,IC,NQ=(RC=xt(),RC(IC=function(){function r(){var n=this;$(this,r),S(this,"createModel",function(t){return new PQ(n.gl,t)}),S(this,"createAttribute",function(t){return new AQ(n.gl,t)}),S(this,"createBuffer",function(t){return new RQ(n.gl,t)}),S(this,"createElements",function(t){return new IQ(n.gl,t)}),S(this,"createTexture2D",function(t){return new BQ(n.gl,t)}),S(this,"createFramebuffer",function(t){return new DQ(n.gl,t)}),S(this,"useFramebuffer",function(t,e){n.gl({framebuffer:t?t.get():null})(e)}),S(this,"clear",function(t){var e,i=t.color,a=t.depth,o=t.stencil,s=t.framebuffer,u=s===void 0?null:s,l={color:i,depth:a,stencil:o};l.framebuffer=u===null?u:u.get(),(e=n.gl)===null||e===void 0||e.clear(l)}),S(this,"viewport",function(t){var e=t.x,i=t.y,a=t.width,o=t.height;n.gl._gl.viewport(e,i,a,o),n.width=a,n.height=o,n.gl._refresh()}),S(this,"readPixels",function(t){var e=t.framebuffer,i=t.x,a=t.y,o=t.width,s=t.height,u={x:i,y:a,width:o,height:s};return e&&(u.framebuffer=e.get()),n.gl.read(u)}),S(this,"getViewportSize",function(){return{width:n.gl._gl.drawingBufferWidth,height:n.gl._gl.drawingBufferHeight}}),S(this,"getContainer",function(){if(hr)return n.canvas;var t;return(t=n.canvas)===null||t===void 0?void 0:t.parentElement}),S(this,"getCanvas",function(){return n.canvas}),S(this,"getGLContext",function(){return n.gl._gl}),S(this,"destroy",function(){var t,e,i;n.canvas=null,(t=n.gl)===null||t===void 0||(e=t._gl)===null||e===void 0||(i=e.getExtension("WEBGL_lose_context"))===null||i===void 0||i.loseContext(),n.gl.destroy(),n.gl=null})}return H(r,[{key:"init",value:function(){var n=Mt(st.mark(function e(i,a,o){var s=this;return st.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(this.canvas=i,!o){l.next=5;break}this.gl=o,l.next=8;break;case 5:return l.next=7,new Promise(function(c,f){NM({canvas:s.canvas,attributes:{alpha:!0,antialias:a.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:a.preserveDrawingBuffer,stencil:a.stencil},extensions:["OES_element_index_uint","OES_standard_derivatives","ANGLE_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture"],profile:!0,onDone:function(v,p){(v||!p)&&f(v),c(p)}})});case 7:this.gl=l.sent;case 8:this.extensionObject={OES_texture_float:this.testExtension("OES_texture_float")};case 9:case"end":return l.stop()}},e,this)}));function t(e,i,a){return n.apply(this,arguments)}return t}()},{key:"getPointSizeRange",value:function(){return this.gl._gl.getParameter(this.gl._gl.ALIASED_POINT_SIZE_RANGE)}},{key:"testExtension",value:function(t){return!!this.getGLContext().getExtension(t)}},{key:"setState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!0,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setBaseState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setCustomLayerDefaults",value:function(){var t=this.getGLContext();t.disable(t.CULL_FACE)}},{key:"setDirty",value:function(t){this.isDirty=t}},{key:"getDirty",value:function(){return this.isDirty}}]),r}())||IC),zQ=function(){function r(n){$(this,r);var t=n.id,e=n.map,i=n.canvas,a=n.hasBaseMap,o=cW();this.container=o,e.setContainer(o,t,i,a),o.bind(P.IRendererService).to(NQ).inSingletonScope(),this.sceneService=o.get(P.ISceneService),this.mapService=o.get(P.IMapService),this.iconService=o.get(P.IIconService),this.fontService=o.get(P.IFontService),this.controlService=o.get(P.IControlService),this.layerService=o.get(P.ILayerService),this.markerService=o.get(P.IMarkerService),this.interactionService=o.get(P.IInteractionService),this.popupService=o.get(P.IPopupService),hr?this.sceneService.initMiniScene(n):(this.initComponent(t),this.sceneService.init(n),this.initControl())}return H(r,[{key:"map",get:function(){return this.mapService.map}},{key:"loaded",get:function(){return this.sceneService.loaded}},{key:"getServiceContainer",value:function(){return this.container}},{key:"getSize",value:function(){return this.mapService.getSize()}},{key:"getMinZoom",value:function(){return this.mapService.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.mapService.getMaxZoom()}},{key:"getType",value:function(){return this.mapService.getType()}},{key:"getMapContainer",value:function(){return this.mapService.getMapContainer()}},{key:"getMapCanvasContainer",value:function(){return this.mapService.getMapCanvasContainer()}},{key:"getMapService",value:function(){return this.mapService}},{key:"exportPng",value:function(t){return this.sceneService.exportPng(t)}},{key:"exportMap",value:function(t){return this.sceneService.exportPng(t)}},{key:"registerRenderService",value:function(t){var e=this;if(this.sceneService.loaded){var i=new t(this);i.init()}else this.on("loaded",function(){var a=new t(e);a.init()})}},{key:"setBgColor",value:function(t){this.mapService.setBgColor(t)}},{key:"addLayer",value:function(t){var e=sv(this.container);t.setContainer(e,this.container),this.sceneService.addLayer(t);var i=t.getLayerConfig();if(i){var a=i.mask,o=i.maskfence,s=i.maskColor,u=s===void 0?"#000":s,l=i.maskOpacity,c=l===void 0?0:l;if(a&&o){var f=new _T().source(o).shape("fill").style({color:u,opacity:c});this.addMask(f,t.id)}}else console.warn("addLayer should run after scene loaded!")}},{key:"addMask",value:function(t,e){var i=this.getLayer(e);if(i){var a=sv(this.container);t.setContainer(a,this.container),i.addMaskLayer(t),this.sceneService.addLayer(t)}else console.warn("parent layer not find!")}},{key:"getPickedLayer",value:function(){return this.layerService.pickedLayerId}},{key:"getLayers",value:function(){return this.layerService.getLayers()}},{key:"getLayer",value:function(t){return this.layerService.getLayer(t)}},{key:"getLayerByName",value:function(t){return this.layerService.getLayerByName(t)}},{key:"removeLayer",value:function(t,e){this.layerService.remove(t,e)}},{key:"removeAllLayer",value:function(){this.layerService.removeAllLayers()}},{key:"render",value:function(){this.sceneService.render()}},{key:"setEnableRender",value:function(t){this.layerService.setEnableRender(t)}},{key:"addIconFont",value:function(t,e){this.fontService.addIconFont(t,e)}},{key:"addIconFonts",value:function(t){var e=this;t.forEach(function(i){var a=kt(i,2),o=a[0],s=a[1];e.fontService.addIconFont(o,s)})}},{key:"addFontFace",value:function(t,e){this.sceneService.addFontFace(t,e)}},{key:"addImage",value:function(t,e){hr?this.iconService.addImageMini(t,e,this.sceneService):this.iconService.addImage(t,e)}},{key:"hasImage",value:function(t){return this.iconService.hasImage(t)}},{key:"removeImage",value:function(t){this.iconService.removeImage(t)}},{key:"addIconFontGlyphs",value:function(t,e){this.fontService.addIconGlyphs(e)}},{key:"addControl",value:function(t){this.controlService.addControl(t,this.container)}},{key:"removeControl",value:function(t){this.controlService.removeControl(t)}},{key:"getControlByName",value:function(t){return this.controlService.getControlByName(t)}},{key:"addMarker",value:function(t){this.markerService.addMarker(t)}},{key:"addMarkerLayer",value:function(t){this.markerService.addMarkerLayer(t)}},{key:"removeMarkerLayer",value:function(t){this.markerService.removeMarkerLayer(t)}},{key:"removeAllMakers",value:function(){this.markerService.removeAllMarkers()}},{key:"addPopup",value:function(t){this.popupService.addPopup(t)}},{key:"on",value:function(t,e){If.indexOf(t)===-1?this.mapService.on(t,e):this.sceneService.on(t,e)}},{key:"once",value:function(t,e){If.indexOf(t)===-1?this.mapService.once(t,e):this.sceneService.once(t,e)}},{key:"off",value:function(t,e){If.indexOf(t)===-1?this.mapService.off(t,e):this.sceneService.off(t,e)}},{key:"getZoom",value:function(){return this.mapService.getZoom()}},{key:"getCenter",value:function(t){return this.mapService.getCenter(t)}},{key:"setCenter",value:function(t,e){return this.mapService.setCenter(t,e)}},{key:"getPitch",value:function(){return this.mapService.getPitch()}},{key:"setPitch",value:function(t){return this.mapService.setPitch(t)}},{key:"getRotation",value:function(){return this.mapService.getRotation()}},{key:"getBounds",value:function(){return this.mapService.getBounds()}},{key:"setRotation",value:function(t){this.mapService.setRotation(t)}},{key:"zoomIn",value:function(){this.mapService.zoomIn()}},{key:"zoomOut",value:function(){this.mapService.zoomOut()}},{key:"panTo",value:function(t){this.mapService.panTo(t)}},{key:"panBy",value:function(t,e){this.mapService.panBy(t,e)}},{key:"getContainer",value:function(){return this.mapService.getContainer()}},{key:"setZoom",value:function(t){this.mapService.setZoom(t)}},{key:"fitBounds",value:function(t,e){var i=this.sceneService.getSceneConfig(),a=i.fitBoundsOptions,o=i.animate;this.mapService.fitBounds(t,e||U(U({},a),{},{animate:o}))}},{key:"setZoomAndCenter",value:function(t,e){this.mapService.setZoomAndCenter(t,e)}},{key:"setMapStyle",value:function(t){this.mapService.setMapStyle(t)}},{key:"setMapStatus",value:function(t){this.mapService.setMapStatus(t)}},{key:"pixelToLngLat",value:function(t){return this.mapService.pixelToLngLat(t)}},{key:"lngLatToPixel",value:function(t){return this.mapService.lngLatToPixel(t)}},{key:"containerToLngLat",value:function(t){return this.mapService.containerToLngLat(t)}},{key:"lngLatToContainer",value:function(t){return this.mapService.lngLatToContainer(t)}},{key:"destroy",value:function(){this.sceneService.destroy()}},{key:"registerPostProcessingPass",value:function(t,e){this.container.bind(P.IPostProcessingPass).to(t).whenTargetNamed(e)}},{key:"enableShaderPick",value:function(){this.layerService.enableShaderPick()}},{key:"diasbleShaderPick",value:function(){this.layerService.disableShaderPick()}},{key:"getPointSizeRange",value:function(){return this.sceneService.getPointSizeRange()}},{key:"initComponent",value:function(t){this.controlService.init({container:lH(t)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}},{key:"initControl",value:function(){var t=this.sceneService.getSceneConfig(),e=t.logoVisible,i=t.logoPosition;e&&this.addControl(new xW({position:i}))}}]),r}(),DC;(function(r){r[r.solid=0]="solid",r[r.dash=1]="dash"})(DC||(DC={}));var pv;(function(r){r.TextLayer="textLayer",r.DotLayer="dotLayer",r.IconLayer="iconLayer",r.DotDensity="dotDensityLayer",r.ColumnLayer="columnLayer",r.HeatmapLayer="heatmapLayer",r.GridLayer="gridLayer",r.HexbinLayer="hexbinLayer",r.LinesLayer="linesLayer",r.PathLayer="pathLayer",r.ArcLayer="arcLayer",r.AreaLayer="areaLayer",r.PrismLayer="prismLayer"})(pv||(pv={}));var ja;(function(r){r.Amap="amap",r.Mapbox="mapbox"})(ja||(ja={}));var dv;(function(r){r.Dot="dot",r.DotDensity="dotDensity",r.Heatmap="heatmap",r.Grid="grid",r.Hexbin="hexbin",r.Path="path",r.Flow="flow",r.Area="area",r.Choropleth="choropleth"})(dv||(dv={}));const dd={fontFamily:`
  "-apple-system", BlinkMacSystemFont, "Segoe UI", Roboto,"Helvetica Neue",
  Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei",
  SimSun, "sans-serif"`};var gd="l7plot-tooltip",yd="l7plot-tooltip__title",md="l7plot-tooltip__list",PT="l7plot-tooltip__list-item",BT="l7plot-tooltip__name",NT="l7plot-tooltip__value",UQ='<div class="'.concat(gd,`">
  <div class="`).concat(yd,`"></div>
  <ul class="`).concat(md,`"></ul>
</div>`),PC='<li class="'.concat(PT,`" data-index={index}>
  <span class="`).concat(BT,`">{name}</span>
  <span class="`).concat(NT,`">{value}</span>
</li>`),Xn;const HQ=(Xn={},Xn[gd]={visibility:"visible",zIndex:999,transition:"visibility 0.2s cubic-bezier(0.23, 1, 0.32, 1), left 0.4s cubic-bezier(0.23, 1, 0.32, 1), top 0.4s cubic-bezier(0.23, 1, 0.32, 1)",backgroundColor:"rgba(255, 255, 255, 0.9)",boxShadow:"rgb(0 0 0 / 16%) 0px 6px 12px 0px",borderRadius:"2px",color:"rgb(87, 87, 87)",fontSize:"12px",fontFamily:dd.fontFamily,lineHeight:"20px",padding:"10px 10px 6px 10px"},Xn[yd]={marginBottom:"4px"},Xn[md]={margin:"0px",listStyleType:"none",padding:"0px"},Xn[PT]={listStyleType:"none",marginBottom:"4px",whiteSpace:"nowrap",display:"flex",justifyContent:"space-between"},Xn[BT]={},Xn[NT]={marginLeft:"30px"},Xn);function $Q(r,n){return!!r.className.match(new RegExp("(\\s|^)".concat(n,"(\\s|$)")))}function xd(r){for(var n=r.childNodes,t=n.length,e=t-1;e>=0;e--)r.removeChild(n[e])}var _d=function(){function r(n){this.destroyed=!1,this.options=J({},this.getDefaultOptions(),n),this.container=this.initContainer(),this.initDom(),this.applyStyles(),this.initEvent(),this.initCapture(),this.initVisible(),this.render()}return r.prototype.getDefaultOptions=function(){return{name:"",containerTpl:"<div></div>",visible:!0,capture:!0,domStyles:{}}},r.prototype.getContainer=function(){return this.container},r.prototype.getParentContainer=function(){var n=this.options.parent,t;if(!n)return t;if(lt(n)){var e=document.getElementById(n);if(e)t=e;else throw new Error("No parent id ".concat(n))}else t=n;return t},r.prototype.initContainer=function(){var n=this.createDom(this.options.containerTpl),t=this.getParentContainer();return t&&t.appendChild(n),n},r.prototype.initVisible=function(){this.options.visible?this.show():this.hide()},r.prototype.initCapture=function(){this.setCapture(this.options.capture)},r.prototype.update=function(n){this.options=J({},this.options,n),this.updateInner(n),this.afterUpdate(n)},r.prototype.updateInner=function(n){n.domStyles&&this.applyStyles()},r.prototype.afterUpdate=function(n){n.capture&&this.setCapture(n.capture)},r.prototype.setCapture=function(n){var t=this.container,e=n?"auto":"none";t.style.pointerEvents=e},r.prototype.applyStyles=function(){var n=this.options.domStyles;if(!!n){var t=this.container;this.applyChildrenStyles(t,n);var e=this.options.className;if(e&&$Q(t,e)){var i=n[e];Xt(t,i)}}},r.prototype.applyChildrenStyles=function(n,t){w(t,function(e,i){var a=n.getElementsByClassName(i);w(a,function(o){Xt(o,e)})})},r.prototype.applyStyle=function(n,t){var e=this.options.domStyles;e&&Xt(t,e[n])},r.prototype.createDom=function(n){return n===void 0&&(n="<div></div>"),wn(n)},r.prototype.removeDom=function(){var n=this.container;n&&n.parentNode&&n.parentNode.removeChild(n)},r.prototype.destroy=function(){this.removeEvent(),this.removeDom(),this.destroyed=!0},r}(),GQ=function(r){R(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.getDefaultOptions=function(){return J({},r.prototype.getDefaultOptions.call(this),{id:"l7plot-tooltip",name:"l7plot-tooltip",title:"",showTitle:!0,items:[],containerTpl:UQ,itemTpl:PC,domStyles:HQ,className:gd})},n.prototype.initContainer=function(){var t=this.options.customContent;if(t){var e=this.getHtmlContentNode(t),i=this.getParentContainer();return i&&i.appendChild(e),e}else return r.prototype.initContainer.call(this)},n.prototype.initDom=function(){this.cacheDoms()},n.prototype.initEvent=function(){},n.prototype.removeEvent=function(){},n.prototype.cacheDoms=function(){var t=this.container,e=t.getElementsByClassName(yd)[0],i=t.getElementsByClassName(md)[0];this.titleDom=e,this.listDom=i},n.prototype.render=function(){this.options.customContent?this.renderCustomContent(this.options.customContent):(this.resetTitle(),this.renderItems())},n.prototype.show=function(){var t=this.container;!t||this.destroyed||Xt(t,{visibility:"visible"})},n.prototype.hide=function(){var t=this.container;!t||this.destroyed||Xt(t,{visibility:"hidden"})},n.prototype.updateInner=function(t){this.options.customContent?this.renderCustomContent(this.options.customContent):(t.title&&this.resetTitle(),t.items&&this.renderItems()),r.prototype.updateInner.call(this,t)},n.prototype.renderCustomContent=function(t){var e=this.container.parentNode,i=this.getHtmlContentNode(t),a=this.container;e&&e.replaceChild(i,a),this.container=i,this.applyStyles()},n.prototype.getHtmlContentNode=function(t){var e,i=t(this.options.title||"",this.options.items);return lt(i)?e=this.createDom(i):e=i,e},n.prototype.resetTitle=function(){var t=this.options.title,e=this.options.showTitle;e&&t?(this.showTitle(),this.setTitle(t)):this.hideTitle()},n.prototype.showTitle=function(){var t=this.titleDom;t&&Xt(t,{display:"block"})},n.prototype.hideTitle=function(){var t=this.titleDom;t&&Xt(t,{display:"none"})},n.prototype.setTitle=function(t){var e=this.titleDom;e&&(e.innerHTML=t)},n.prototype.renderItems=function(){var t=this;this.clearItemDoms();var e=this.options.items,i=this.options.itemTpl||PC,a=this.listDom;a&&(e.forEach(function(o){var s=C({},o),u=Ps(i,s),l=t.createDom(u);a.appendChild(l)}),this.applyChildrenStyles(a,this.options.domStyles))},n.prototype.clearItemDoms=function(){this.listDom&&xd(this.listDom)},n.prototype.clear=function(){this.setTitle(""),this.clearItemDoms()},n}(_d),Cd="l7plot-legend l7plot-legend__category",Ed="l7plot-legend__title",Sd="l7plot-legend__category-list",zT="l7plot-legend__list-item",UT="l7plot-legend__category-marker",HT="l7plot-legend__category-value",VQ='<div class="'.concat(Cd,`">
  <div class="`).concat(Ed,`"></div>
  <ul class="`).concat(Sd,`"></ul>
</div>`),BC='<li class="'.concat(zT,`" data-index={index}>
  <span class="`).concat(UT,`" style="background:{color}"></span>
  <span class="`).concat(HT,`">{value}</span>
</li>`),Yn;const WQ=(Yn={},Yn[Cd]={visibility:"visible",zIndex:1,backgroundColor:"rgba(255, 255, 255, 0.9)",boxShadow:"rgb(0 0 0 / 16%) 0px 6px 12px 0px",borderRadius:"2px",color:"rgb(87, 87, 87)",fontFamily:dd.fontFamily,padding:"10px 10px 6px 10px",lineHeight:1,fontSize:"12px"},Yn[Ed]={fontSize:"13px",lineHeight:"19px",marginBottom:"8px"},Yn[Sd]={margin:"0px",listStyleType:"none",padding:"0px"},Yn[zT]={listStyleType:"none",display:"flex",alignItems:"center",marginBottom:"2px"},Yn[UT]={width:"10px",height:"10px"},Yn[HT]={paddingLeft:"8px"},Yn);var jQ=function(r){R(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.getDefaultOptions=function(){return J({},r.prototype.getDefaultOptions.call(this),{id:"l7plot-category-legend",name:"l7plot-category-legend",title:"",items:[],containerTpl:VQ,itemTpl:BC,domStyles:WQ,className:Cd})},n.prototype.initContainer=function(){var t=this.options.customContent;if(t){var e=this.getHtmlContentNode(t),i=this.getParentContainer();return i&&i.appendChild(e),e}else return r.prototype.initContainer.call(this)},n.prototype.initDom=function(){this.cacheDoms()},n.prototype.initEvent=function(){},n.prototype.removeEvent=function(){},n.prototype.cacheDoms=function(){var t=this.container,e=t.getElementsByClassName(Ed)[0],i=t.getElementsByClassName(Sd)[0];this.titleDom=e,this.listDom=i},n.prototype.render=function(){this.options.customContent?this.renderCustomContent(this.options.customContent):(this.resetTitle(),this.renderItems())},n.prototype.show=function(){var t=this.container;!t||this.destroyed||Xt(t,{visibility:"visible"})},n.prototype.hide=function(){var t=this.container;!t||this.destroyed||Xt(t,{visibility:"hidden"})},n.prototype.updateInner=function(t){this.options.customContent?this.renderCustomContent(this.options.customContent):(t.title&&this.resetTitle(),t.items&&this.renderItems()),r.prototype.updateInner.call(this,t)},n.prototype.renderCustomContent=function(t){var e=this.container.parentNode,i=this.getHtmlContentNode(t),a=this.container;e&&e.replaceChild(i,a),this.container=i,this.applyStyles()},n.prototype.getHtmlContentNode=function(t){var e,i=t(this.options.title||"",this.options.items);return lt(i)?e=this.createDom(i):e=i,e},n.prototype.resetTitle=function(){var t=this.options.title;t?(this.showTitle(),this.setTitle(t)):this.hideTitle()},n.prototype.showTitle=function(){var t=this.titleDom;t&&Xt(t,{display:"block"})},n.prototype.hideTitle=function(){var t=this.titleDom;t&&Xt(t,{display:"none"})},n.prototype.setTitle=function(t){var e=this.titleDom;e&&(e.innerHTML=t)},n.prototype.renderItems=function(){var t=this;this.clearItemDoms();var e=this.options.items.length>30?this.options.items.slice(0,30):this.options.items,i=this.options.itemTpl||BC,a=this.listDom;a&&(e.forEach(function(o){var s=o.value==="",u=s?"\u2014":Array.isArray(o.value)?o.value.join(" - "):o.value,l=C(C({},o),{value:u}),c=Ps(i,l),f=t.createDom(c);a.appendChild(f)}),this.applyChildrenStyles(a,this.options.domStyles))},n.prototype.clearItemDoms=function(){this.listDom&&xd(this.listDom)},n.prototype.clear=function(){this.setTitle(""),this.clearItemDoms()},n}(_d),bd="l7plot-legend l7plot-legend__continue",Ad="l7plot-legend__title",$T="l7plot-legend__ribbon-container",GT="l7plot-legend__ribbon",VT="l7plot-legend__gradient-bar",gv="l7plot-legend__value-range",XQ='<div class="'.concat(bd,`">
  <div class="`).concat(Ad,`"></div>
  <div class="`).concat($T,`"></div>
</div>`),NC='<div class="'.concat(GT,`">
  <span class="`).concat(gv,`">{min}</span>
  <div class="`).concat(VT,`" style="background-image: {backgroundImage}"></div>
  <span class="`).concat(gv,`">{max}</span>
</div>`),Oi;const YQ=(Oi={},Oi[bd]={visibility:"visible",zIndex:1,backgroundColor:"rgba(255, 255, 255, 0.9)",boxShadow:"rgb(0 0 0 / 16%) 0px 6px 12px 0px",borderRadius:"2px",color:"rgb(87, 87, 87)",fontFamily:dd.fontFamily,padding:"10px",lineHeight:1,fontSize:"12px"},Oi[Ad]={fontSize:"13px",lineHeight:"19px",marginBottom:"8px"},Oi[GT]={display:"flex",alignItems:"center"},Oi[VT]={width:"140px",height:"14px",margin:"0px 5px"},Oi[gv]={padding:"0px"},Oi);var ZQ=function(r){R(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.getDefaultOptions=function(){return J({},r.prototype.getDefaultOptions.call(this),{id:"l7plot-continue-legend",name:"l7plot-continue-legend",title:"",containerTpl:XQ,ribbonTpl:NC,domStyles:YQ,className:bd})},n.prototype.initContainer=function(){var t=this.options.customContent;if(t){var e=this.getHtmlContentNode(t),i=this.getParentContainer();return i&&i.appendChild(e),e}else return r.prototype.initContainer.call(this)},n.prototype.initDom=function(){this.cacheDoms()},n.prototype.initEvent=function(){},n.prototype.removeEvent=function(){},n.prototype.cacheDoms=function(){var t=this.container,e=t.getElementsByClassName(Ad)[0],i=t.getElementsByClassName($T)[0];this.titleDom=e,this.ribbonContainerDom=i},n.prototype.render=function(){this.options.customContent?this.renderCustomContent(this.options.customContent):(this.resetTitle(),this.renderRibbon())},n.prototype.show=function(){var t=this.container;!t||this.destroyed||Xt(t,{visibility:"visible"})},n.prototype.hide=function(){var t=this.container;!t||this.destroyed||Xt(t,{visibility:"hidden"})},n.prototype.updateInner=function(t){this.options.customContent?this.renderCustomContent(this.options.customContent):(t.title&&this.resetTitle(),t.colors&&this.renderRibbon()),r.prototype.updateInner.call(this,t)},n.prototype.renderCustomContent=function(t){var e=this.container.parentNode,i=this.getHtmlContentNode(t),a=this.container;e&&e.replaceChild(i,a),this.container=i,this.applyStyles()},n.prototype.getHtmlContentNode=function(t){var e,i=t(this.options.title||"",this.options.min,this.options.max,this.options.colors);return lt(i)?e=this.createDom(i):e=i,e},n.prototype.resetTitle=function(){var t=this.options.title;t?(this.showTitle(),this.setTitle(t)):this.hideTitle()},n.prototype.showTitle=function(){var t=this.titleDom;t&&Xt(t,{display:"block"})},n.prototype.hideTitle=function(){var t=this.titleDom;t&&Xt(t,{display:"none"})},n.prototype.setTitle=function(t){var e=this.titleDom;e&&(e.innerHTML=t)},n.prototype.renderRibbon=function(){this.clearRibbonContainerDoms();var t=this.options,e=t.min,i=t.max,a=t.colors,o=t.ribbonTpl,s=o===void 0?NC:o,u=this.ribbonContainerDom;if(u){var l="linear-gradient(to right, ".concat(a.join(", "),")"),c={min:e,max:i,backgroundImage:l},f=Ps(s,c),h=this.createDom(f);u.appendChild(h),this.applyChildrenStyles(u,this.options.domStyles)}},n.prototype.clearRibbonContainerDoms=function(){this.ribbonContainerDom&&xd(this.ribbonContainerDom)},n.prototype.clear=function(){this.setTitle(""),this.clearRibbonContainerDoms()},n}(_d),qQ=5,KQ=new Object().toString,WT=function(r,n){return KQ.call(r)==="[object "+n+"]"},QQ=function(r){return WT(r,"Array")},JQ=function(r){return typeof r=="object"&&r!==null},zC=function(r){if(!JQ(r)||!WT(r,"Object"))return!1;for(var n=r;Object.getPrototypeOf(n)!==null;)n=Object.getPrototypeOf(n);return Object.getPrototypeOf(r)===n},jT=function(r,n,t,e){t=t||0,e=e||qQ;for(var i in n)if(Object.prototype.hasOwnProperty.call(n,i)){var a=n[i];a?zC(a)?(zC(r[i])||(r[i]={}),t<e?jT(r[i],a,t+1,e):r[i]=n[i]):QQ(a)?(r[i]=[],r[i]=r[i].concat(a)):r[i]=a:r[i]=a}},He=function(r){for(var n=[],t=1;t<arguments.length;t++)n[t-1]=arguments[t];for(var e=0;e<n.length;e+=1)jT(r,n[e]);return r},tJ=["mousemove","click"],eJ=function(r){R(n,r);function n(t,e,i){var a=r.call(this)||this;a.currentVisible=!1,a.interactionTriggerHander=function(p){var d=p.feature,g=p.featureId,y=a.options,m=y.title,x=y.customTitle,_=y.items,E=y.customItems,b=d.type==="Feature"&&d.geometry&&d.properties,M=b?d.properties:d,T=[];if(E){var k=E(d);if(Array.isArray(k))T=k;else throw new Error("customItems return array")}else _&&_.forEach(function(O){if(lt(O)){var D=O.split(".").pop()||O,W=Rd(M,O);W!==void 0&&T.push({name:D,value:W})}else{var j=O.field,ot=O.alias,z=O.customValue,X=ot||j.split(".").pop()||j,W=Rd(M,j);W!==void 0&&T.push({name:X,value:z?z(W,M,g):W})}});var L={title:x?x(M):m,items:T};a.updateTooltip(p,L)},a.interactionUntriggerHander=function(){a.hideTooltip()},a.scene=t,a.interactionLayers=e,a.options=He({},a.getDefaultOptions(),i);var o=a.options,s=o.offsets,u=o.title,l=o.showTitle,c=o.customContent,f=o.domStyles,h=o.anchor,v=o.className;return a.marker=new x_({offsets:s,anchor:h,draggable:!1}),a.tooltipComponent=new GQ({title:u,showTitle:l,items:[],customContent:c,domStyles:f,className:v}),a.setComponent(),a.initInteractionEvent(),a}return n.prototype.getDefaultOptions=function(){return{showTitle:!0,showComponent:!0,items:[],offsets:[15,0],trigger:"mousemove",anchor:Sl["TOP-LEFT"]}},n.prototype.update=function(t){this.marker.remove(),this.currentVisible=!1,this.options=He({},this.options,t);var e=this.options,i=e.offsets,a=e.showTitle,o=e.customContent,s=e.domStyles,u=e.anchor,l=e.className;this.marker=new x_({offsets:i,anchor:u,draggable:!1}),this.tooltipComponent.update({showTitle:a,customContent:o,domStyles:s,className:l}),this.setComponent()},n.prototype.initInteractionEvent=function(){var t=this,e=this.options.trigger||"mousemove";if(!tJ.includes(e))throw new Error("trigger is mousemove or click");this.interactionLayers.forEach(function(i){var a=i.layer;a.on(e,t.interactionTriggerHander),a.on("un".concat(e),t.interactionUntriggerHander)})},n.prototype.unBindInteractionEvent=function(){var t=this,e=this.options.trigger||"mousemove";this.interactionLayers.forEach(function(i){var a=i.layer;a.off(e,t.interactionTriggerHander),a.off("un".concat(e),t.interactionUntriggerHander)})},n.prototype.updateTooltip=function(t,e){var i=t.lngLat,a=t.x,o=t.y;if(this.options.showComponent&&(this.updateComponent(e),this.setPostion(i)),this.currentVisible){var s={type:"tooltip:change",data:e,lngLat:i,x:a,y:o};this.emit("tooltip:change",s)}else{this.showTooltip();var u={type:"tooltip:show",data:e,lngLat:i,x:a,y:o};this.emit("tooltip:show",u)}},n.prototype.showTooltip=function(){this.currentVisible||(this.options.showComponent&&this.scene.addMarker(this.marker),this.currentVisible=!0)},n.prototype.hideTooltip=function(){if(!!this.currentVisible){this.options.showComponent&&this.marker.remove(),this.currentVisible=!1;var t={type:"tooltip:hide"};this.emit("tooltip:hide",t)}},n.prototype.updateComponent=function(t){Dt(this.lastComponentOptions,t)||(this.tooltipComponent.update(t),this.lastComponentOptions=t)},n.prototype.setComponent=function(){var t=this.tooltipComponent.getContainer(),e=window.document.createElement("div");e.style.cursor="auto",e.style.userSelect="text",e.className="l7plot-tooltip-container",["mousemove","mousedown","mouseup","click","dblclick"].forEach(function(i){e.addEventListener(i,function(a){return a.stopPropagation()})}),e.appendChild(t),this.marker.setElement(e)},n.prototype.setPostion=function(t){this.marker.setLnglat(t)},n.prototype.destroy=function(){this.unBindInteractionEvent(),this.off(),this.marker.remove(),this.tooltipComponent.destroy()},n}(fa),rJ=function(r){R(n,r);function n(t){var e=r.call(this,t)||this;return e.legendComponents=[],e.options=t,e.legendComponents=e.initLegendComponents(t.items),e}return n.prototype.initLegendComponents=function(t){for(var e=[],i=0;i<t.length;i++){var a=t[i];if(a.type==="category"){var o=new jQ({title:a.options.title,items:a.options.items,className:a.options.className,customContent:a.options.customContent,domStyles:a.options.domStyles});e.push(o)}else if(a.type==="continue"){var o=new ZQ({title:a.options.title,min:a.options.min,max:a.options.max,colors:a.options.colors,className:a.options.className,customContent:a.options.customContent,domStyles:a.options.domStyles});e.push(o)}}return e},n.prototype.getDefaultOptions=function(){return{position:"bottomleft"}},n.prototype.onAdd=function(){var t=window.document.createElement("div");return t.className="l7plot-legend-container",this.legendComponents.forEach(function(e){var i=e.getContainer();t.appendChild(i)}),t},n.prototype.onRemove=function(){this.legendComponents.forEach(function(t){t.destroy()})},n}(Ys),Td=function(r){R(n,r);function n(t,e){t===void 0&&(t=[]),e===void 0&&(e={});var i=r.call(this)||this;return i.name=e.name?e.name:Ir("layerGroup"),i.layers=t,i}return n.prototype.addTo=function(t){var e=this;this.scene=t;var i=0,a=this.layers.length;this.layers.forEach(function(o){o.once("inited",function(s){i++,e.emit("inited",s),i===a&&e.emit("inited-all")}),o.addTo(t)})},n.prototype.hasLayer=function(t){return this.layers.some(function(e){return e===t})},n.prototype.addLayer=function(t){var e=this;this.layers.push(t),this.scene&&(t.once("inited",function(i){return e.emit("inited",i)}),t.addTo(this.scene))},n.prototype.removeLayer=function(t){var e=this.layers.findIndex(function(i){return i===t});return e===-1?!1:(this.layers.splice(e,1),this.scene&&t.remove(this.scene),!0)},n.prototype.getLayers=function(){return this.layers},n.prototype.getInteractionLayers=function(){return this.layers.filter(function(t){var e=t.interaction;return e})},n.prototype.getLayer=function(t){return this.layers.find(function(e){var i=e.layer;return i.id===t})},n.prototype.getLayerByName=function(t){return this.layers.find(function(e){return e.name===t})},n.prototype.removeAllLayer=function(){var t=this;this.layers.forEach(function(e){t.scene&&e.remove(t.scene)}),this.layers=[]},n.prototype.isEmpty=function(){return this.layers.length===0},n}(fa),nJ=[{original:"loaded",adaptation:"scene-loaded"},{original:"resize",adaptation:"resize"},{original:"destroy",adaptation:"destroy"},{original:"resize",adaptation:"resize"}],iJ=["mapmove","movestart","moveend","zoomchange","zoomstart","zoomend","click","dblclick","contextmenu","mousemove","mousewheel","mouseover","mouseout","mouseup","mousedown","dragstart","dragging","dragend"],el=["inited","add","remove","dataUpdate","click","unclick","contextmenu","uncontextmenu","mouseenter","mousemove","unmousemove","mouseout","mouseup","unmouseup","mousedown","uncontextmenu","unpick"],UC={map:{type:ja.Amap},logo:!0},aJ=function(r){R(n,r);function n(t){var e=r.call(this)||this;return e.inited=!1,e.sceneLoaded=!1,e.layersLoaded=!1,e.loaded=!1,e.layerGroup=new Td,e.options=He({},e.getDefaultOptions(),t),e.lastOptions=e.options,e}return n.prototype.getDefaultOptions=function(){return n.DefaultOptions},n.prototype.createContainer=function(t){var e=this.options,i=e.width,a=e.height,o=typeof t=="string"?document.getElementById(t):t;return o.style.position||(o.style.position="relative"),i&&(o.style.width||(o.style.width="".concat(i,"px"))),a&&(o.style.height||(o.style.height="".concat(a,"px"))),o},n.prototype.createTheme=function(){var t=wt(this.options.theme)?He({},Nh("default"),M2(this.options.theme)):Nh(this.options.theme);return t},n.prototype.createMap=function(){var t=this.options.map?this.options.map:UC.map,e=t.type,i=Tt(t,["type"]),a=Object.assign({style:this.theme.mapStyle},i);return e===ja.Amap?new Vj(a):new nX(a)},n.prototype.createScene=function(){var t=this.options,e=t.logo,i=t.antialias,a=t.preserveDrawingBuffer,o=ui(e)?{logoVisible:e}:{logoVisible:e==null?void 0:e.visible,logoPosition:e==null?void 0:e.position},s=Object.assign({antialias:i,preserveDrawingBuffer:a},o),u=this.createMap(),l=new zQ(C({id:this.container,map:u},s));return l},n.prototype.registerResources=function(){var t=this;_y.size&&_y.forEach(function(e,i){!t.scene.hasImage(i)&&t.scene.addImage(i,e)}),Cy.size&&Cy.forEach(function(e,i){t.scene.addFontFace(i,e)}),Ey.size&&Ey.forEach(function(e,i){t.scene.addIconFont(i,e)})},n.prototype.update=function(t){this.updateOption(t),t.map&&!Dt(this.lastOptions.map,this.options.map)&&this.updateMap(t.map),this.render(),this.emit("update")},n.prototype.updateOption=function(t){this.lastOptions=this.options,this.options=He({},this.options,t)},n.prototype.updateMap=function(t){var e;if(!!this.scene){var i=t.style,a=t.center,o=t.zoom,s=t.rotation,u=t.pitch;Je(u)||this.scene.setPitch(u),Je(s)||this.scene.setRotation(s),i&&i!==((e=this.lastOptions.map)===null||e===void 0?void 0:e.style)&&this.scene.setMapStyle(i),o&&a&&this.scene.setZoomAndCenter(o,a)}},n.prototype.changeSize=function(t,e){this.options.width===t&&this.options.height===e||(this.container.style.width="".concat(t,"px"),this.container.style.height="".concat(e,"px"),this.options=Object.assign(this.options,{width:t,height:e}))},n.prototype.on=function(t,e){return this.proxyEventHander("on",t,e),this},n.prototype.once=function(t,e){return this.proxyEventHander("once",t,e),this},n.prototype.off=function(t,e){return this.proxyEventHander("off",t,e),this},n.prototype.proxyEventHander=function(t,e,i){var a=nJ.find(function(c){return c.adaptation===e});if(a)this.scene[t](a.original,i);else if(iJ.indexOf(e)!==-1)this.scene[t](e,i);else if(e.includes("Layer:")){var o=ut(e.split(":"),2),s=o[0],u=o[1],l=this[s]&&this[s][t];if(l&&el.indexOf(u)!==-1)this[s][t](u,i);else throw new Error('No event name "'.concat(e,'"'))}else r.prototype[t].call(this,e,i)},n.prototype.getScene=function(){return this.scene},n.prototype.getMap=function(){var t,e;return((t=this.options.map)===null||t===void 0?void 0:t.type)===ja.Amap?this.scene.map:((e=this.options.map)===null||e===void 0?void 0:e.type)===ja.Mapbox?this.scene.map:this.scene.map},n.prototype.addLayer=function(t){this.layerGroup.addLayer(t)},n.prototype.getLayes=function(){return console.warn("Replace to use getLayers()"),this.getLayers()},n.prototype.getLayers=function(){return this.layerGroup.getLayers()},n.prototype.getLayerByName=function(t){return this.layerGroup.getLayerByName(t)},n.prototype.removeLayer=function(t){return this.layerGroup.removeLayer(t)},n.prototype.removeAllLayer=function(){this.layerGroup.removeAllLayer()},n.prototype.zoomIn=function(){this.scene.zoomIn()},n.prototype.zoomOut=function(){this.scene.zoomOut()},n.prototype.setPitch=function(t){this.scene.setPitch(t)},n.prototype.fitBounds=function(t){this.scene.fitBounds(t)},n.prototype.setMapStatus=function(t){this.scene.setMapStatus(t)},n.prototype.setBgColor=function(t){this.scene.setBgColor(t)},n.prototype.initComponents=function(){this.initControls(),this.initTooltip()},n.prototype.updateComponents=function(){this.updateControls(),this.initTooltip()},n.prototype.initControls=function(){var t=this.options,e=t.zoom,i=t.scale,a=t.layerMenu,o=t.legend;i&&this.addScaleControl(i),e&&this.addZoomControl(e),a&&this.addLayerMenuControl(a),o&&this.addLegendControl(o)},n.prototype.updateControls=function(){var t=this.options,e=t.zoom,i=t.scale,a=t.layerMenu,o=t.legend;Dt(this.lastOptions.zoom,e)||(e?this.updateZoomControl(e):this.removeZoomControl()),Dt(this.lastOptions.scale,i)||(i?this.updateScaleControl(i):this.removeScaleControl()),Dt(this.lastOptions.layerMenu,a)||(a?this.updateLayerMenuControl(a):this.removeLayerMenuControl()),Dt(this.lastOptions.legend,o)||(o?this.updateLegendControl(o):this.removeLegendControl())},n.prototype.addZoomControl=function(t){this.zoomControl||(this.zoomControl=new AW(t),this.scene.addControl(this.zoomControl))},n.prototype.updateZoomControl=function(t){if(!this.zoomControl){this.addZoomControl(t);return}this.removeZoomControl(),this.addZoomControl(t)},n.prototype.removeZoomControl=function(){this.zoomControl&&(this.zoomControl.remove(),this.zoomControl=void 0)},n.prototype.addScaleControl=function(t){this.scaleControl||(this.scaleControl=new EW(t),this.scene.addControl(this.scaleControl))},n.prototype.updateScaleControl=function(t){if(!this.scaleControl){this.addScaleControl(t);return}this.removeScaleControl(),this.addScaleControl(t)},n.prototype.removeScaleControl=function(){this.scaleControl&&(this.scaleControl.remove(),this.scaleControl=void 0)},n.prototype.addLayerMenuControl=function(t){if(!this.layerMenuControl){var e={},i={};this.layerGroup.getLayers().forEach(function(a){var o=a.name,s=a.layer;i[o]=s}),this.layerMenuControl=new gW(Object.assign({},t,{baseLayers:e,overlayers:i})),this.scene.addControl(this.layerMenuControl)}},n.prototype.updateLayerMenuControl=function(t){if(!this.layerMenuControl){this.addLayerMenuControl(t);return}this.removeLayerMenuControl(),this.addLayerMenuControl(t)},n.prototype.removeLayerMenuControl=function(){this.layerMenuControl&&(this.layerMenuControl.remove(),this.layerMenuControl=void 0)},n.prototype.getLegendOptions=function(){return{}},n.prototype.addLegendControl=function(t){if(!this.legendControl){var e=this.theme.components.legend,i=He({},this.getLegendOptions(),t),a=i.type,o=i.position,s=Tt(i,["type","position"]),u=[];if(a==="category"){var l=He({},{domStyles:e.category.domStyles},s);u.push({type:a,options:l})}else if(a==="continue"){var c=He({},{domStyles:e.continue.domStyles},s);u.push({type:a,options:c})}u.length&&(this.legendControl=new rJ({position:o,items:u}),this.scene.addControl(this.legendControl))}},n.prototype.updateLegendControl=function(t){if(!this.legendControl){this.addLegendControl(t);return}this.removeLegendControl(),this.addLegendControl(t)},n.prototype.removeLegendControl=function(){this.legendControl&&(this.legendControl.remove(),this.legendControl=void 0)},n.prototype.initTooltip=function(){var t=this;this.tooltip&&this.tooltip.destroy();var e=this.options.tooltip;if(e){var i=He({},{domStyles:this.theme.components.tooltip.domStyles},e),a=this.layerGroup.getInteractionLayers();this.tooltip=new eJ(this.scene,a,i),this.tooltip.on("*",function(o){return t.emit(o.type,o)})}},n.prototype.exportPng=function(t){return this.scene.exportPng(t)},n.prototype.destroy=function(){var t;r.prototype.off.call(this,"*"),this.removeScaleControl(),this.removeZoomControl(),this.removeLayerMenuControl(),this.removeLegendControl(),(t=this.tooltip)===null||t===void 0||t.destroy(),this.scene.destroy()},n.DefaultOptions=UC,n}(fa),yv=function(){function r(){}return r.aggregation=function(n,t){var e=t.type,i=e===void 0?"grid":e,a=t.radius,o=t.method,s=t.field,u={type:i,size:a,method:o,field:s};n.transforms?(n.transforms=n.transforms.filter(function(l){return l.type!==u.type}),n.transforms.push(u)):n.transforms=[u]},r}(),HC=["name","zIndex","visible","minZoom","maxZoom","pickingBuffer","autoFit","blend"],kn=function(r){R(n,r);function n(t){var e=r.call(this)||this;return e.options=He({},e.getDefaultOptions(),t),e.lastOptions=e.options,e}return n.prototype.getDefaultOptions=function(){return{}},n.prototype.pickLayerConfig=function(t){var e=li(t,HC);return e},n.prototype.addTo=function(t){t.addLayer(this.layer)},n.prototype.remove=function(t){t.removeLayer(this.layer)},n.prototype.update=function(t){this.updateOption(t),this.updateConfig(t)},n.prototype.updateOption=function(t){this.lastOptions=this.options,this.options=He({},this.options,t)},n.prototype.updateConfig=function(t){!Je(t.zIndex)&&!Dt(this.lastOptions.zIndex,this.options.zIndex)&&this.setIndex(t.zIndex),!Je(t.blend)&&!Dt(this.lastOptions.blend,this.options.blend)&&this.setBlend(t.blend),!Je(t.minZoom)&&!Dt(this.lastOptions.minZoom,this.options.minZoom)&&this.setMinZoom(t.minZoom),!Je(t.maxZoom)&&!Dt(this.lastOptions.maxZoom,this.options.maxZoom)&&this.setMinZoom(t.maxZoom),!Je(t.visible)&&!Dt(this.lastOptions.visible,this.options.visible)&&(t.visible?this.show():this.hide())},n.prototype.render=function(){this.layer.renderLayers()},n.prototype.setSource=function(t){if(t instanceof ya)this.layer.setSource(t);else{var e=t.data,i=t.aggregation,a=Tt(t,["data","aggregation"]);i&&yv.aggregation(a,i);var o=this.layer.getSource();o?this.layer.setData(e,a):this.layer.source(e,a)}},n.prototype.changeData=function(t){this.setSource(t)},n.prototype.setIndex=function(t){this.layer.setIndex(t)},n.prototype.setBlend=function(t){this.layer.setBlend(t)},n.prototype.setMinZoom=function(t){this.layer.setMinZoom(t)},n.prototype.setMaxZoom=function(t){this.layer.setMaxZoom(t)},n.prototype.show=function(){this.layer.inited&&this.layer.show()},n.prototype.hide=function(){this.layer.inited&&this.layer.hide()},n.prototype.toggleVisible=function(){this.isVisible()?this.hide():this.show()},n.prototype.isVisible=function(){return this.layer.inited?this.layer.isVisible():this.options.visible},n.prototype.fitBounds=function(t){this.layer.fitBounds(t)},n.prototype.on=function(t,e){return el.indexOf(t)!==-1?this.layer.on(t,e):r.prototype.on.call(this,t,e),this},n.prototype.once=function(t,e){return el.indexOf(t)!==-1?this.layer.once(t,e):r.prototype.once.call(this,t,e),this},n.prototype.off=function(t,e){return el.indexOf(t)!==-1?this.layer.off(t,e):r.prototype.off.call(this,t,e),this},n.LayerType=pv,n.LayerConfigkeys=HC,n}(fa);function Ri(r,n){return function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i={};return r.forEach(function(a,o){i[a]=t[o]}),delete i.undefined,n(i)}}var Me=function(){function r(){}return r.shape=function(n,t){if(lt(t))n.shape(t);else if(rt(t)){var e=[];n.shape(e.join("*"),Ri(e,t))}else if(wt(t)){var i=t.field?t.field:"";if(rt(t.value)){var e=V(i)?i:i.split("*");n.shape(i,Ri(e,t.value))}else n.shape(i,t.value);lt(i)&&t.scale&&r.scale(n,i,t.scale)}},r.size=function(n,t){if(dt(t))n.size(t);else if(V(t))n.size(t);else if(rt(t)){var e=[];n.size(e.join("*"),Ri(e,t))}else if(wt(t)){var i=t.field?t.field:"";if(rt(t.value)){var e=V(i)?i:i.split("*");n.size(i,Ri(e,t.value))}else n.size(i,t.value);lt(i)&&t.scale&&r.scale(n,i,t.scale)}},r.color=function(n,t){if(lt(t))n.color(t);else if(rt(t)){var e=[];n.color(e.join("*"),Ri(e,t))}else if(wt(t)){var i=t.field?t.field:"";if(rt(t.value)){var e=V(i)?i:i.split("*");n.color(i,Ri(e,t.value))}else n.color(i,t.value);lt(i)&&t.scale&&r.scale(n,i,t.scale)}},r.style=function(n,t){t&&n.style(t)},r.state=function(n,t){var e=t.active,i=t.select;e&&n.active(e),i&&n.select(i)},r.rotate=function(n,t){lt(t)||rt(t)},r.texture=function(n,t){lt(t)&&n.texture(t)},r.animate=function(n,t){(ui(t)||wt(t))&&n.animate(t)},r.scale=function(n,t,e){n.scale(t,e)},r.filter=function(n,t){var e=t.field?t.field:"",i=V(e)?e:e.split("*");n.filter(i.join("*"),Ri(i,t.value))},r}();function oJ(r,n){var t=n.field,e=n.content,i=n.style,a=i===void 0?{}:i,o=n.state,s=a.fontSize,u=a.fill,l=t||e||"",c={field:l,value:"text"};Me.shape(r,c),s&&Me.size(r,s),u&&Me.color(r,u),a&&Me.style(r,a),o&&Me.state(r,o)}var $C={style:{fontSize:12}},sJ=[],XT=function(r){R(n,r);function n(t){var e=r.call(this,t)||this;e.type=kn.LayerType.TextLayer,e.interaction=!1;var i=e.options,a=i.name,o=i.source,s=e.pickLayerConfig(e.options);return e.name=a||Ir(e.type),e.layer=new IT(C(C({},s),{name:e.name})),e.mappingLayer(e.layer,e.options),e.setSource(o),e}return n.prototype.getDefaultOptions=function(){return $C},n.prototype.mappingLayer=function(t,e){oJ(t,e)},n.prototype.update=function(t){r.prototype.update.call(this,t),this.mappingLayer(this.layer,this.options)},n.DefaultOptions=$C,n.LayerOptionsKeys=kn.LayerConfigkeys.concat(sJ),n}(kn),uJ={autoFit:!1},ao=function(r){R(n,r);function n(t,e){var i=this;if(typeof t=="string"||t instanceof Element){if(e===void 0)throw new Error("options is undefined");i=r.call(this,e)||this,i.container=i.createContainer(t),i.theme=i.createTheme(),i.scene=i.createScene(),i.registerResources(),i.initSource()}else i=r.call(this,t)||this;return i}return n.prototype.initSource=function(){this.source=this.createSource(),this.render(),this.inited=!0},n.prototype.initLayersEvent=function(){},n.prototype.getDefaultOptions=function(){return n.DefaultOptions},n.prototype.createSource=function(){var t=this.options.source,e=t.data,i=t.aggregation,a=Tt(t,["data","aggregation"]);i&&yv.aggregation(a,i);var o=new ya(e,a);return o},n.prototype.createLabelLayer=function(t,e,i){var a=i||{},o=a.visible,s=a.minZoom,u=a.maxZoom,l=a.zIndex,c=l===void 0?0:l,f=new XT(C({name:"labelLayer",visible:o,minZoom:s,maxZoom:u,zIndex:c+.1,source:t},e));return f},n.prototype.updateLabelLayer=function(t,e,i,a){e?a?a.update(C({},e)):(a=this.createLabelLayer(t,e,i),this.layerGroup.addLayer(a)):e===!1&&a&&this.layerGroup.removeLayer(a)},n.prototype.render=function(){var t=this,e=this.createLayers(this.source);this.inited?(this.layerGroup.removeAllLayer(),e.addTo(this.scene),this.layerGroup=e):(this.layerGroup=e,this.scene.sceneService.loaded?this.onSceneLoaded():this.scene.once("loaded",function(){t.onSceneLoaded()})),this.initLayersEvent()},n.prototype.onSceneLoaded=function(){var t=this;this.sceneLoaded=!0,this.layerGroup.isEmpty()?this.onLayersLoaded():this.layerGroup.once("inited-all",function(){t.onLayersLoaded()}),this.layerGroup.addTo(this.scene)},n.prototype.onLayersLoaded=function(){this.layersLoaded=!0,this.initComponents(),this.loaded=!0,this.emit("loaded")},n.prototype.attachToScene=function(t,e){this.scene=t,this.theme=e||Nh("default"),this.registerResources(),this.initSource()},n.prototype.unattachFromScene=function(){var t;this.removeAllLayer(),(t=this.tooltip)===null||t===void 0||t.destroy()},n.prototype.addToScene=function(t){this.attachToScene(t)},n.prototype.removeFromScene=function(){var t;this.removeAllLayer(),this.removeScaleControl(),this.removeZoomControl(),this.removeLayerMenuControl(),this.removeLegendControl(),(t=this.tooltip)===null||t===void 0||t.destroy()},n.prototype.update=function(t){if(this.updateOption(t),t.map&&!Dt(this.lastOptions.map,this.options.map)&&this.updateMap(t.map),this.scene.setEnableRender(!1),t.source&&!Dt(this.lastOptions.source,this.options.source)){var e=t.source,i=e.data,a=Tt(e,["data"]);this.changeData(i,a)}this.scene.setEnableRender(!0),this.render(),this.updateComponents(),this.emit("update")},n.prototype.changeData=function(t,e){var i=this;this.options.source=He({},this.options.source,C({data:t},e));var a=this.options.source,o=a.aggregation,s=Tt(a,["aggregation"]);o&&yv.aggregation(s,o),this.source.setData(this.options.source.data,s);var u=this.options.legend;u&&setTimeout(function(){i.updateLegendControl(u)}),this.emit("change-data")},n.DefaultOptions=uJ,n.PlotType=dv,n}(aJ),lJ=He({},ao.DefaultOptions,{source:{data:[],parser:{type:"json",x:"x",y:"y"}}});function cJ(r,n){var t=n.shape,e=n.color,i=n.size,a=n.style,o=n.state,s=n.animate;t&&Me.shape(r,t),i&&Me.size(r,i),e&&Me.color(r,e),a&&Me.style(r,a),o&&Me.state(r,o),s&&Me.animate(r,s)}var fJ=function(r){return!Array.isArray(r[0].value)},YT=function(r){if(fJ(r))return r;var n=r.map(function(t){return C(C({},t),{value:[Id(t.value[0],2),Id(t.value[1],2)]})});return n},GC={source:{data:[],parser:{type:"json",x:"x",y:"y"}},shape:"circle",size:12,color:"#5FD3A6"},hJ=["shape","color","size","style","state","animate"],rl=function(r){R(n,r);function n(t){var e=r.call(this,t)||this;e.type=kn.LayerType.DotLayer,e.interaction=!0;var i=e.options,a=i.name,o=i.source,s=e.pickLayerConfig(e.options);return e.name=a||Ir(e.type),e.layer=new IT(C(C({},s),{name:e.name})),e.mappingLayer(e.layer,e.options),e.setSource(o),e}return n.prototype.getDefaultOptions=function(){return GC},n.prototype.mappingLayer=function(t,e){cJ(t,e)},n.prototype.update=function(t){r.prototype.update.call(this,t),this.mappingLayer(this.layer,this.options)},n.prototype.getColorLegendItems=function(){var t=this.layer.getLegendItems("color");if(Array.isArray(t)&&t.length!==0){var e=YT(t);return e}return[]},n.DefaultOptions=GC,n.LayerOptionsKeys=kn.LayerConfigkeys.concat(hJ),n}(kn),rtt=function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=ao.PlotType.Dot,t}return n.prototype.getDefaultOptions=function(){return n.DefaultOptions},n.prototype.createLayers=function(t){this.dotLayer=new rl(C({source:t},li(this.options,rl.LayerOptionsKeys)));var e=new Td([this.dotLayer]);return this.options.label&&(this.labelLayer=this.createLabelLayer(t,this.options.label,this.options),e.addLayer(this.labelLayer)),e},n.prototype.updateLayers=function(t){var e=li(t,rl.LayerOptionsKeys);this.dotLayer.update(e),this.updateLabelLayer(this.source,t.label,this.options,this.labelLayer)},n.prototype.getLegendOptions=function(){var t=this.dotLayer.getColorLegendItems();return t.length!==0?{type:"category",items:t}:{}},n.DefaultOptions=lJ,n}(ao);function vJ(r,n){var t=n.shape,e=n.color,i=n.size,a=n.style,o=n.state,s=n.animate,u=n.texture;t&&Me.shape(r,t),i&&Me.size(r,i),e&&Me.color(r,e),a&&Me.style(r,a),o&&Me.state(r,o),s&&Me.animate(r,s),u&&Me.texture(r,u)}var VC={},pJ=["shape","color","size","style","state","animate"],Vf=function(r){R(n,r);function n(t){var e=r.call(this,t)||this;e.type=kn.LayerType.LinesLayer,e.interaction=!0;var i=e.options,a=i.name,o=i.source,s=e.pickLayerConfig(e.options);return e.name=a||Ir(e.type),e.layer=new nK(C(C({},s),{name:e.name})),e.mappingLayer(e.layer,e.options),e.setSource(o),e}return n.prototype.getDefaultOptions=function(){return VC},n.prototype.mappingLayer=function(t,e){vJ(t,e)},n.prototype.update=function(t){r.prototype.update.call(this,t),this.mappingLayer(this.layer,this.options)},n.prototype.getColorLegendItems=function(){var t=this.layer.getLegendItems("color");if(Array.isArray(t)&&t.length!==0){var e=YT(t);return e}return[]},n.DefaultOptions=VC,n.LayerOptionsKeys=kn.LayerConfigkeys.concat(pJ),n}(kn),dJ=He({},ao.DefaultOptions,{source:{data:[],parser:{type:"json"}},shape:"arc"}),Wf=function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=Vf.LayerType.ArcLayer,t}return n.prototype.getDefaultOptions=function(){return He({},Vf.DefaultOptions,{shape:"arc"})},n}(Vf),ntt=function(r){R(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=ao.PlotType.Flow,t}return n.prototype.getDefaultOptions=function(){return n.DefaultOptions},n.prototype.createLayers=function(t){this.flowLayer=new Wf(C({name:"flowLayer",source:t},li(this.options,Wf.LayerOptionsKeys)));var e=new Td([this.flowLayer]);return this.options.radiation&&(this.radiationLayer=this.createRadiationLayer(t),e.addLayer(this.radiationLayer)),this.options.label&&(this.labelLayer=this.createLabelLayer(t,this.options.label),e.addLayer(this.labelLayer)),e},n.prototype.parserPointData=function(t){var e=[];return t.data.dataArray.forEach(function(i){var a=i.coordinates,o=ut(a,2),s=o[1];e.push(C(C({},i),{coordinates:s}))}),e},n.prototype.createRadiationLayer=function(t){var e=this,i=this.parserPointData(t),a=this.options.radiation||{},o=a.enabled,s=o===void 0?!0:o,u=a.color,l=a.size,c=l===void 0?20:l,f=a.shape,h=f===void 0?"circle":f,v=a.animate,p=v===void 0?!0:v,d=new rl({name:"radiationLayer",source:{data:i,parser:{type:"json",coordinates:"coordinates"}},visible:s,color:u,size:c,shape:h,animate:p}),g=function(){var y=e.parserPointData(e.source);d.layer.setData(y)};return t.on("update",g),d.on("remove",function(){t.off("update",g)}),d},n.prototype.createLabelLayer=function(t,e){var i=this,a=this.parserPointData(t),o=this.options,s=o.visible,u=o.minZoom,l=o.maxZoom,c=o.zIndex,f=c===void 0?0:c,h=new XT(C({name:"labelLayer",source:{data:a,parser:{type:"json",coordinates:"coordinates"}},visible:s,minZoom:u,maxZoom:l,zIndex:f+.1},e)),v=function(){var p=i.parserPointData(i.source);h.layer.setData(p)};return t.on("update",v),h.on("remove",function(){t.off("update",v)}),h},n.prototype.updateLayers=function(t){var e=li(t,Wf.LayerOptionsKeys);if(this.flowLayer.update(e),t.radiation)if(this.radiationLayer){var i=C(C({},t.radiation),{visible:t.radiation.enabled});this.radiationLayer.update(i)}else this.radiationLayer=this.createRadiationLayer(this.source),this.layerGroup.addLayer(this.radiationLayer);this.updateLabelLayer(this.source,t.label,this.options,this.labelLayer)},n.prototype.getLegendOptions=function(){var t=this.flowLayer.getColorLegendItems();return t.length!==0?{type:"category",items:t}:{}},n.DefaultOptions=dJ,n}(ao);export{P4 as A,rtt as D,ntt as F,_3 as P,ttt as R,ett as a};
