var C=d;function d(t,e){var i=t&&t.type,n;if(i==="FeatureCollection")for(n=0;n<t.features.length;n++)d(t.features[n],e);else if(i==="GeometryCollection")for(n=0;n<t.geometries.length;n++)d(t.geometries[n],e);else if(i==="Feature")d(t.geometry,e);else if(i==="Polygon")V(t.coordinates,e);else if(i==="MultiPolygon")for(n=0;n<t.coordinates.length;n++)V(t.coordinates[n],e);return t}function V(t,e){if(t.length!==0){m(t[0],e);for(var i=1;i<t.length;i++)m(t[i],!e)}}function m(t,e){for(var i=0,n=0,s=0,o=t.length,r=o-1;s<o;r=s++){var a=(t[s][0]-t[r][0])*(t[r][1]+t[s][1]),h=i+a;n+=Math.abs(i)>=Math.abs(a)?i-h+a:a-h+i,i=h}i+n>=0!=!!e&&t.reverse()}var P=f;function f(t,e){this.x=t,this.y=e}f.prototype={clone:function(){return new f(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,i=t.y-this.y;return e*e+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[0]*this.x+t[1]*this.y,i=t[2]*this.x+t[3]*this.y;return this.x=e,this.y=i,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),i=Math.sin(t),n=e*this.x-i*this.y,s=i*this.x+e*this.y;return this.x=n,this.y=s,this},_rotateAround:function(t,e){var i=Math.cos(t),n=Math.sin(t),s=e.x+i*(this.x-e.x)-n*(this.y-e.y),o=e.y+n*(this.x-e.x)+i*(this.y-e.y);return this.x=s,this.y=o,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}};f.convert=function(t){return t instanceof f?t:Array.isArray(t)?new f(t[0],t[1]):t};var S=P,g=c;function c(t,e,i,n,s){this.properties={},this.extent=i,this.type=0,this._pbf=t,this._geometry=-1,this._keys=n,this._values=s,t.readFields(F,this,e)}function F(t,e,i){t==1?e.id=i.readVarint():t==2?T(i,e):t==3?e.type=i.readVarint():t==4&&(e._geometry=i.pos)}function T(t,e){for(var i=t.readVarint()+t.pos;t.pos<i;){var n=e._keys[t.readVarint()],s=e._values[t.readVarint()];e.properties[n]=s}}c.types=["Unknown","Point","LineString","Polygon"];c.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,i=1,n=0,s=0,o=0,r=[],a;t.pos<e;){if(n<=0){var h=t.readVarint();i=h&7,n=h>>3}if(n--,i===1||i===2)s+=t.readSVarint(),o+=t.readSVarint(),i===1&&(a&&r.push(a),a=[]),a.push(new S(s,o));else if(i===7)a&&a.push(a[0].clone());else throw new Error("unknown command "+i)}return a&&r.push(a),r};c.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,i=1,n=0,s=0,o=0,r=1/0,a=-1/0,h=1/0,u=-1/0;t.pos<e;){if(n<=0){var l=t.readVarint();i=l&7,n=l>>3}if(n--,i===1||i===2)s+=t.readSVarint(),o+=t.readSVarint(),s<r&&(r=s),s>a&&(a=s),o<h&&(h=o),o>u&&(u=o);else if(i!==7)throw new Error("unknown command "+i)}return[r,h,a,u]};c.prototype.toGeoJSON=function(t,e,i){var n=this.extent*Math.pow(2,i),s=this.extent*t,o=this.extent*e,r=this.loadGeometry(),a=c.types[this.type],h,u;function l(x){for(var y=0;y<x.length;y++){var p=x[y],M=180-(p.y+o)*360/n;x[y]=[(p.x+s)*360/n-180,360/Math.PI*Math.atan(Math.exp(M*Math.PI/180))-90]}}switch(this.type){case 1:var v=[];for(h=0;h<r.length;h++)v[h]=r[h][0];r=v,l(r);break;case 2:for(h=0;h<r.length;h++)l(r[h]);break;case 3:for(r=B(r),h=0;h<r.length;h++)for(u=0;u<r[h].length;u++)l(r[h][u]);break}r.length===1?r=r[0]:a="Multi"+a;var _={type:"Feature",geometry:{type:a,coordinates:r},properties:this.properties};return"id"in this&&(_.id=this.id),_};function B(t){var e=t.length;if(e<=1)return[t];for(var i=[],n,s,o=0;o<e;o++){var r=k(t[o]);r!==0&&(s===void 0&&(s=r<0),s===r<0?(n&&i.push(n),n=[t[o]]):n.push(t[o]))}return n&&i.push(n),i}function k(t){for(var e=0,i=0,n=t.length,s=n-1,o,r;i<n;s=i++)o=t[i],r=t[s],e+=(r.x-o.x)*(o.y+r.y);return e}var A=g,I=w;function w(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(q,this,e),this.length=this._features.length}function q(t,e,i){t===15?e.version=i.readVarint():t===1?e.name=i.readString():t===5?e.extent=i.readVarint():t===2?e._features.push(i.pos):t===3?e._keys.push(i.readString()):t===4&&e._values.push(G(i))}function G(t){for(var e=null,i=t.readVarint()+t.pos;t.pos<i;){var n=t.readVarint()>>3;e=n===1?t.readString():n===2?t.readFloat():n===3?t.readDouble():n===4?t.readVarint64():n===5?t.readVarint():n===6?t.readSVarint():n===7?t.readBoolean():null}return e}w.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new A(this._pbf,e,this.extent,this._keys,this._values)};var R=I,$=E;function E(t,e){this.layers=t.readFields(W,{},e)}function W(t,e,i){if(t===3){var n=new R(i,i.readVarint()+i.pos);n.length&&(e[n.name]=n)}}var L=$;export{L as V,C as g};
