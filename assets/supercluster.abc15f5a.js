import{c as ot}from"./@amap.5b2c865e.js";var W={exports:{}};(function(X,it){(function(x,Z){X.exports=Z()})(ot,function(){function x(n,t,r,e,a,o){if(!(a-e<=r)){var s=e+a>>1;Z(n,t,s,e,a,o%2),x(n,t,r,e,s-1,o+1),x(n,t,r,s+1,a,o+1)}}function Z(n,t,r,e,a,o){for(;a>e;){if(a-e>600){var s=a-e+1,v=r-e+1,f=Math.log(s),i=.5*Math.exp(2*f/3),u=.5*Math.sqrt(f*i*(s-i)/s)*(v-s/2<0?-1:1),p=Math.max(e,Math.floor(r-v*i/s+u)),l=Math.min(a,Math.floor(r+(s-v)*i/s+u));Z(n,t,r,p,l,o)}var g=t[2*r+o],d=e,h=a;for(M(n,t,e,r),t[2*a+o]>g&&M(n,t,e,a);d<h;){for(M(n,t,d,h),d++,h--;t[2*d+o]<g;)d++;for(;t[2*h+o]>g;)h--}t[2*e+o]===g?M(n,t,e,h):(h++,M(n,t,h,a)),h<=r&&(e=h+1),r<=h&&(a=h-1)}}function M(n,t,r,e){D(n,r,e),D(t,2*r,2*e),D(t,2*r+1,2*e+1)}function D(n,t,r){var e=n[t];n[t]=n[r],n[r]=e}function Y(n,t,r,e,a,o,s){for(var v=[0,n.length-1,0],f=[],i,u;v.length;){var p=v.pop(),l=v.pop(),g=v.pop();if(l-g<=s){for(var d=g;d<=l;d++)i=t[2*d],u=t[2*d+1],i>=r&&i<=a&&u>=e&&u<=o&&f.push(n[d]);continue}var h=Math.floor((g+l)/2);i=t[2*h],u=t[2*h+1],i>=r&&i<=a&&u>=e&&u<=o&&f.push(n[h]);var c=(p+1)%2;(p===0?r<=i:e<=u)&&(v.push(g),v.push(h-1),v.push(c)),(p===0?a>=i:o>=u)&&(v.push(h+1),v.push(l),v.push(c))}return f}function q(n,t,r,e,a,o){for(var s=[0,n.length-1,0],v=[],f=a*a;s.length;){var i=s.pop(),u=s.pop(),p=s.pop();if(u-p<=o){for(var l=p;l<=u;l++)A(t[2*l],t[2*l+1],r,e)<=f&&v.push(n[l]);continue}var g=Math.floor((p+u)/2),d=t[2*g],h=t[2*g+1];A(d,h,r,e)<=f&&v.push(n[g]);var c=(i+1)%2;(i===0?r-a<=d:e-a<=h)&&(s.push(p),s.push(g-1),s.push(c)),(i===0?r+a>=d:e+a>=h)&&(s.push(g+1),s.push(u),s.push(c))}return v}function A(n,t,r,e){var a=n-r,o=t-e;return a*a+o*o}var z=function(n){return n[0]},k=function(n){return n[1]},I=function(t,r,e,a,o){r===void 0&&(r=z),e===void 0&&(e=k),a===void 0&&(a=64),o===void 0&&(o=Float64Array),this.nodeSize=a,this.points=t;for(var s=t.length<65536?Uint16Array:Uint32Array,v=this.ids=new s(t.length),f=this.coords=new o(t.length*2),i=0;i<t.length;i++)v[i]=i,f[2*i]=r(t[i]),f[2*i+1]=e(t[i]);x(v,f,a,0,v.length-1,0)};I.prototype.range=function(t,r,e,a){return Y(this.ids,this.coords,t,r,e,a,this.nodeSize)},I.prototype.within=function(t,r,e){return q(this.ids,this.coords,t,r,e,this.nodeSize)};var j={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(n){return n}},C=Math.fround||function(n){return function(t){return n[0]=+t,n[0]}}(new Float32Array(1)),m=function(t){this.options=w(Object.create(j),t),this.trees=new Array(this.options.maxZoom+1)};m.prototype.load=function(t){var r=this.options,e=r.log,a=r.minZoom,o=r.maxZoom,s=r.nodeSize;e&&console.time("total time");var v="prepare "+t.length+" points";e&&console.time(v),this.points=t;for(var f=[],i=0;i<t.length;i++)!t[i].geometry||f.push($(t[i],i));this.trees[o+1]=new I(f,B,N,s,Float32Array),e&&console.timeEnd(v);for(var u=o;u>=a;u--){var p=+Date.now();f=this._cluster(f,u),this.trees[u]=new I(f,B,N,s,Float32Array),e&&console.log("z%d: %d clusters in %dms",u,f.length,+Date.now()-p)}return e&&console.timeEnd("total time"),this},m.prototype.getClusters=function(t,r){var e=((t[0]+180)%360+360)%360-180,a=Math.max(-90,Math.min(90,t[1])),o=t[2]===180?180:((t[2]+180)%360+360)%360-180,s=Math.max(-90,Math.min(90,t[3]));if(t[2]-t[0]>=360)e=-180,o=180;else if(e>o){var v=this.getClusters([e,a,180,s],r),f=this.getClusters([-180,a,o,s],r);return v.concat(f)}for(var i=this.trees[this._limitZoom(r)],u=i.range(L(e),F(s),L(o),F(a)),p=[],l=0,g=u;l<g.length;l+=1){var d=g[l],h=i.points[d];p.push(h.numPoints?G(h):this.points[h.index])}return p},m.prototype.getChildren=function(t){var r=this._getOriginId(t),e=this._getOriginZoom(t),a="No cluster with the specified id.",o=this.trees[e];if(!o)throw new Error(a);var s=o.points[r];if(!s)throw new Error(a);for(var v=this.options.radius/(this.options.extent*Math.pow(2,e-1)),f=o.within(s.x,s.y,v),i=[],u=0,p=f;u<p.length;u+=1){var l=p[u],g=o.points[l];g.parentId===t&&i.push(g.numPoints?G(g):this.points[g.index])}if(i.length===0)throw new Error(a);return i},m.prototype.getLeaves=function(t,r,e){r=r||10,e=e||0;var a=[];return this._appendLeaves(a,t,r,e,0),a},m.prototype.getTile=function(t,r,e){var a=this.trees[this._limitZoom(t)],o=Math.pow(2,t),s=this.options,v=s.extent,f=s.radius,i=f/v,u=(e-i)/o,p=(e+1+i)/o,l={features:[]};return this._addTileFeatures(a.range((r-i)/o,u,(r+1+i)/o,p),a.points,r,e,o,l),r===0&&this._addTileFeatures(a.range(1-i/o,u,1,p),a.points,o,e,o,l),r===o-1&&this._addTileFeatures(a.range(0,u,i/o,p),a.points,-1,e,o,l),l.features.length?l:null},m.prototype.getClusterExpansionZoom=function(t){for(var r=this._getOriginZoom(t)-1;r<=this.options.maxZoom;){var e=this.getChildren(t);if(r++,e.length!==1)break;t=e[0].properties.cluster_id}return r},m.prototype._appendLeaves=function(t,r,e,a,o){for(var s=this.getChildren(r),v=0,f=s;v<f.length;v+=1){var i=f[v],u=i.properties;if(u&&u.cluster?o+u.point_count<=a?o+=u.point_count:o=this._appendLeaves(t,u.cluster_id,e,a,o):o<a?o++:t.push(i),t.length===e)break}return o},m.prototype._addTileFeatures=function(t,r,e,a,o,s){for(var v=0,f=t;v<f.length;v+=1){var i=f[v],u=r[i],p=u.numPoints,l=void 0,g=void 0,d=void 0;if(p)l=K(u),g=u.x,d=u.y;else{var h=this.points[u.index];l=h.properties,g=L(h.geometry.coordinates[0]),d=F(h.geometry.coordinates[1])}var c={type:1,geometry:[[Math.round(this.options.extent*(g*o-e)),Math.round(this.options.extent*(d*o-a))]],tags:l},_=void 0;p?_=u.id:this.options.generateId?_=u.index:this.points[u.index].id&&(_=this.points[u.index].id),_!==void 0&&(c.id=_),s.features.push(c)}},m.prototype._limitZoom=function(t){return Math.max(this.options.minZoom,Math.min(Math.floor(+t),this.options.maxZoom+1))},m.prototype._cluster=function(t,r){for(var e=[],a=this.options,o=a.radius,s=a.extent,v=a.reduce,f=a.minPoints,i=o/(s*Math.pow(2,r)),u=0;u<t.length;u++){var p=t[u];if(!(p.zoom<=r)){p.zoom=r;for(var l=this.trees[r+1],g=l.within(p.x,p.y,i),d=p.numPoints||1,h=d,c=0,_=g;c<_.length;c+=1){var et=_[c],U=l.points[et];U.zoom>r&&(h+=U.numPoints||1)}if(h>d&&h>=f){for(var J=p.x*d,H=p.y*d,E=v&&d>1?this._map(p,!0):null,O=(u<<5)+(r+1)+this.points.length,S=0,Q=g;S<Q.length;S+=1){var nt=Q[S],y=l.points[nt];if(!(y.zoom<=r)){y.zoom=r;var R=y.numPoints||1;J+=y.x*R,H+=y.y*R,y.parentId=O,v&&(E||(E=this._map(p,!0)),v(E,this._map(y)))}}p.parentId=O,e.push(b(J/h,H/h,O,h,E))}else if(e.push(p),h>1)for(var T=0,V=g;T<V.length;T+=1){var at=V[T],P=l.points[at];P.zoom<=r||(P.zoom=r,e.push(P))}}}return e},m.prototype._getOriginId=function(t){return t-this.points.length>>5},m.prototype._getOriginZoom=function(t){return(t-this.points.length)%32},m.prototype._map=function(t,r){if(t.numPoints)return r?w({},t.properties):t.properties;var e=this.points[t.index].properties,a=this.options.map(e);return r&&a===e?w({},a):a};function b(n,t,r,e,a){return{x:C(n),y:C(t),zoom:1/0,id:r,parentId:-1,numPoints:e,properties:a}}function $(n,t){var r=n.geometry.coordinates,e=r[0],a=r[1];return{x:C(L(e)),y:C(F(a)),zoom:1/0,index:t,parentId:-1}}function G(n){return{type:"Feature",id:n.id,properties:K(n),geometry:{type:"Point",coordinates:[tt(n.x),rt(n.y)]}}}function K(n){var t=n.numPoints,r=t>=1e4?Math.round(t/1e3)+"k":t>=1e3?Math.round(t/100)/10+"k":t;return w(w({},n.properties),{cluster:!0,cluster_id:n.id,point_count:t,point_count_abbreviated:r})}function L(n){return n/360+.5}function F(n){var t=Math.sin(n*Math.PI/180),r=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return r<0?0:r>1?1:r}function tt(n){return(n-.5)*360}function rt(n){var t=(180-n*360)*Math.PI/180;return 360*Math.atan(Math.exp(t))/Math.PI-90}function w(n,t){for(var r in t)n[r]=t[r];return n}function B(n){return n.x}function N(n){return n.y}return m})})(W);const st=W.exports;export{st as S};
